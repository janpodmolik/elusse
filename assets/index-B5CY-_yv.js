import{r as Cr,g as Tr}from"./phaser-DFK5Ua9d.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();var kr=Cr();const D=Tr(kr),_n=!1;var bi=Array.isArray,Mr=Array.prototype.indexOf,kn=Array.from,Si=Object.defineProperty,Ct=Object.getOwnPropertyDescriptor,Ii=Object.getOwnPropertyDescriptors,Or=Object.prototype,Lr=Array.prototype,Mn=Object.getPrototypeOf,Un=Object.isExtensible;const De=()=>{};function Pr(t){return t()}function zt(t){for(var e=0;e<t.length;e++)t[e]()}function Ei(){var t,e,n=new Promise((i,r)=>{t=i,e=r});return{promise:n,resolve:t,reject:e}}const q=2,On=4,on=8,Rr=1<<24,Oe=16,Le=32,ot=64,an=128,he=512,U=1024,ie=2048,we=4096,se=8192,He=16384,Ln=32768,et=65536,Vn=1<<17,xi=1<<18,bt=1<<19,Di=1<<20,tt=32768,yn=1<<21,Pn=1<<22,$e=1<<23,ft=Symbol("$state"),Nr=Symbol(""),dt=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Ai(t){return t===this.v}function Ci(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function Ti(t){return!Ci(t,this.v)}function Hr(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function $r(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Zr(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Br(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Yr(t){throw new Error("https://svelte.dev/e/effect_orphan")}function Xr(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Wr(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Gr(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Kr(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function Fr(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}let Rt=!1,zr=!1;function Ur(){Rt=!0}const Vr=1,qr=2,jr=16,Jr=1,Qr=2,J=Symbol(),es="http://www.w3.org/1999/xhtml";let X=null;function vt(t){X=t}function Xe(t,e=!1,n){X={p:X,i:!1,c:null,e:null,s:t,x:null,l:Rt&&!e?{s:null,u:null,$:[]}:null}}function We(t){var e=X,n=e.e;if(n!==null){e.e=null;for(var i of n)qi(i)}return e.i=!0,X=e.p,{}}function Nt(){return!Rt||X!==null&&X.l===null}let ht=[];function ts(){var t=ht;ht=[],zt(t)}function Ht(t){if(ht.length===0){var e=ht;queueMicrotask(()=>{e===ht&&ts()})}ht.push(t)}function ns(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function Ne(t){if(typeof t!="object"||t===null||ft in t)return t;const e=Mn(t);if(e!==Or&&e!==Lr)return t;var n=new Map,i=bi(t),r=G(0),s=Qe,o=a=>{if(Qe===s)return a();var l=O,c=Qe;te(null),Qn(s);var u=a();return te(l),Qn(c),u};return i&&n.set("length",G(t.length)),new Proxy(t,{defineProperty(a,l,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&Wr();var u=n.get(l);return u===void 0?u=o(()=>{var f=G(c.value);return n.set(l,f),f}):k(u,c.value,!0),!0},deleteProperty(a,l){var c=n.get(l);if(c===void 0){if(l in a){const u=o(()=>G(J));n.set(l,u),kt(r)}}else k(c,J),kt(r);return!0},get(a,l,c){if(l===ft)return t;var u=n.get(l),f=l in a;if(u===void 0&&(!f||Ct(a,l)?.writable)&&(u=o(()=>{var g=Ne(f?a[l]:J),p=G(g);return p}),n.set(l,u)),u!==void 0){var h=d(u);return h===J?void 0:h}return Reflect.get(a,l,c)},getOwnPropertyDescriptor(a,l){var c=Reflect.getOwnPropertyDescriptor(a,l);if(c&&"value"in c){var u=n.get(l);u&&(c.value=d(u))}else if(c===void 0){var f=n.get(l),h=f?.v;if(f!==void 0&&h!==J)return{enumerable:!0,configurable:!0,value:h,writable:!0}}return c},has(a,l){if(l===ft)return!0;var c=n.get(l),u=c!==void 0&&c.v!==J||Reflect.has(a,l);if(c!==void 0||$!==null&&(!u||Ct(a,l)?.writable)){c===void 0&&(c=o(()=>{var h=u?Ne(a[l]):J,g=G(h);return g}),n.set(l,c));var f=d(c);if(f===J)return!1}return u},set(a,l,c,u){var f=n.get(l),h=l in a;if(i&&l==="length")for(var g=c;g<f.v;g+=1){var p=n.get(g+"");p!==void 0?k(p,J):g in a&&(p=o(()=>G(J)),n.set(g+"",p))}if(f===void 0)(!h||Ct(a,l)?.writable)&&(f=o(()=>G(void 0)),k(f,Ne(c)),n.set(l,f));else{h=f.v!==J;var b=o(()=>Ne(c));k(f,b)}var A=Reflect.getOwnPropertyDescriptor(a,l);if(A?.set&&A.set.call(u,c),!h){if(i&&typeof l=="string"){var L=n.get("length"),C=Number(l);Number.isInteger(C)&&C>=L.v&&k(L,C+1)}kt(r)}return!0},ownKeys(a){d(r);var l=Reflect.ownKeys(a).filter(f=>{var h=n.get(f);return h===void 0||h.v!==J});for(var[c,u]of n)u.v!==J&&!(c in a)&&l.push(c);return l},setPrototypeOf(){Gr()}})}var qn,ki,Mi,Oi,Li;function is(){if(qn===void 0){qn=window,ki=document,Mi=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,n=Text.prototype;Oi=Ct(e,"firstChild").get,Li=Ct(e,"nextSibling").get,Un(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),Un(n)&&(n.__t=void 0)}}function Te(t=""){return document.createTextNode(t)}function Ut(t){return Oi.call(t)}function $t(t){return Li.call(t)}function H(t,e){return Ut(t)}function at(t,e=!1){{var n=Ut(t);return n instanceof Comment&&n.data===""?$t(n):n}}function N(t,e=1,n=!1){let i=t;for(;e--;)i=$t(i);return i}function rs(t){t.textContent=""}function Pi(){return!1}function Ri(t){var e=$;if(e===null)return O.f|=$e,t;if((e.f&Ln)===0){if((e.f&an)===0)throw t;e.b.error(t)}else mt(t,e)}function mt(t,e){for(;e!==null;){if((e.f&an)!==0)try{e.b.error(t);return}catch(n){t=n}e=e.parent}throw t}const Yt=new Set;let Y=null,le=null,ge=[],Rn=null,wn=!1;class me{committed=!1;current=new Map;previous=new Map;#e=new Set;#t=new Set;#i=0;#n=0;#l=null;#s=[];#r=[];skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#n>0}process(e){ge=[],this.apply();var n={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const i of e)this.#o(i,n);this.is_fork||this.#u(),this.is_deferred()?(this.#a(n.effects),this.#a(n.render_effects),this.#a(n.block_effects)):(Y=null,jn(n.render_effects),jn(n.effects),this.#l?.resolve()),le=null}#o(e,n){e.f^=U;for(var i=e.first;i!==null;){var r=i.f,s=(r&(Le|ot))!==0,o=s&&(r&U)!==0,a=o||(r&se)!==0||this.skipped_effects.has(i);if((i.f&an)!==0&&i.b?.is_pending()&&(n={parent:n,effect:i,effects:[],render_effects:[],block_effects:[]}),!a&&i.fn!==null){s?i.f^=U:(r&On)!==0?n.effects.push(i):It(i)&&((i.f&Oe)!==0&&n.block_effects.push(i),_t(i));var l=i.first;if(l!==null){i=l;continue}}var c=i.parent;for(i=i.next;i===null&&c!==null;)c===n.effect&&(this.#a(n.effects),this.#a(n.render_effects),this.#a(n.block_effects),n=n.parent),i=c.next,c=c.parent}}#a(e){for(const n of e)((n.f&ie)!==0?this.#s:this.#r).push(n),this.#c(n.deps),V(n,U)}#c(e){if(e!==null)for(const n of e)(n.f&q)===0||(n.f&tt)===0||(n.f^=tt,this.#c(n.deps))}capture(e,n){this.previous.has(e)||this.previous.set(e,n),(e.f&$e)===0&&(this.current.set(e,e.v),le?.set(e,e.v))}activate(){Y=this,this.apply()}deactivate(){Y===this&&(Y=null,le=null)}flush(){if(this.activate(),ge.length>0){if(ss(),Y!==null&&Y!==this)return}else this.#i===0&&this.process([]);this.deactivate()}discard(){for(const e of this.#t)e(this);this.#t.clear()}#u(){if(this.#n===0){for(const e of this.#e)e();this.#e.clear()}this.#i===0&&this.#d()}#d(){if(Yt.size>1){this.previous.clear();var e=le,n=!0,i={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const s of Yt){if(s===this){n=!1;continue}const o=[];for(const[l,c]of this.current){if(s.current.has(l))if(n&&c!==s.current.get(l))s.current.set(l,c);else continue;o.push(l)}if(o.length===0)continue;const a=[...s.current.keys()].filter(l=>!this.current.has(l));if(a.length>0){var r=ge;ge=[];const l=new Set,c=new Map;for(const u of o)Ni(u,a,l,c);if(ge.length>0){Y=s,s.apply();for(const u of ge)s.#o(u,i);s.deactivate()}ge=r}}Y=null,le=e}this.committed=!0,Yt.delete(this)}increment(e){this.#i+=1,e&&(this.#n+=1)}decrement(e){this.#i-=1,e&&(this.#n-=1),this.revive()}revive(){for(const e of this.#s)V(e,ie),nt(e);for(const e of this.#r)V(e,we),nt(e);this.#s=[],this.#r=[],this.flush()}oncommit(e){this.#e.add(e)}ondiscard(e){this.#t.add(e)}settled(){return(this.#l??=Ei()).promise}static ensure(){if(Y===null){const e=Y=new me;Yt.add(Y),me.enqueue(()=>{Y===e&&e.flush()})}return Y}static enqueue(e){Ht(e)}apply(){}}function ss(){var t=Be;wn=!0;var e=null;try{var n=0;for(qt(!0);ge.length>0;){var i=me.ensure();if(n++>1e3){var r,s;os()}i.process(ge),Ze.clear()}}finally{wn=!1,qt(t),Rn=null}}function os(){try{Xr()}catch(t){mt(t,Rn)}}let Ie=null;function jn(t){var e=t.length;if(e!==0){for(var n=0;n<e;){var i=t[n++];if((i.f&(He|se))===0&&It(i)&&(Ie=new Set,_t(i),i.deps===null&&i.first===null&&i.nodes_start===null&&(i.teardown===null&&i.ac===null?Qi(i):i.fn=null),Ie?.size>0)){Ze.clear();for(const r of Ie){if((r.f&(He|se))!==0)continue;const s=[r];let o=r.parent;for(;o!==null;)Ie.has(o)&&(Ie.delete(o),s.push(o)),o=o.parent;for(let a=s.length-1;a>=0;a--){const l=s[a];(l.f&(He|se))===0&&_t(l)}}Ie.clear()}}Ie=null}}function Ni(t,e,n,i){if(!n.has(t)&&(n.add(t),t.reactions!==null))for(const r of t.reactions){const s=r.f;(s&q)!==0?Ni(r,e,n,i):(s&(Pn|Oe))!==0&&(s&ie)===0&&Hi(r,e,i)&&(V(r,ie),nt(r))}}function Hi(t,e,n){const i=n.get(t);if(i!==void 0)return i;if(t.deps!==null)for(const r of t.deps){if(e.includes(r))return!0;if((r.f&q)!==0&&Hi(r,e,n))return n.set(r,!0),!0}return n.set(t,!1),!1}function nt(t){for(var e=Rn=t;e.parent!==null;){e=e.parent;var n=e.f;if(wn&&e===$&&(n&Oe)!==0&&(n&xi)===0)return;if((n&(ot|Le))!==0){if((n&U)===0)return;e.f^=U}}ge.push(e)}function as(t){let e=0,n=it(0),i;return()=>{Lt()&&(d(n),cn(()=>(e===0&&(i=lt(()=>t(()=>kt(n)))),e+=1,()=>{Ht(()=>{e-=1,e===0&&(i?.(),i=void 0,kt(n))})})))}}var ls=et|bt|an;function cs(t,e,n){new us(t,e,n)}class us{parent;#e=!1;#t;#i=null;#n;#l;#s;#r=null;#o=null;#a=null;#c=null;#u=null;#d=0;#h=0;#g=!1;#f=null;#y=as(()=>(this.#f=it(this.#d),()=>{this.#f=null}));constructor(e,n,i){this.#t=e,this.#n=n,this.#l=i,this.parent=$.b,this.#e=!!this.#n.pending,this.#s=un(()=>{$.b=this;{var r=this.#m();try{this.#r=ae(()=>i(r))}catch(s){this.error(s)}this.#h>0?this.#v():this.#e=!1}return()=>{this.#u?.remove()}},ls)}#w(){try{this.#r=ae(()=>this.#l(this.#t))}catch(e){this.error(e)}this.#e=!1}#b(){const e=this.#n.pending;e&&(this.#o=ae(()=>e(this.#t)),me.enqueue(()=>{var n=this.#m();this.#r=this.#p(()=>(me.ensure(),ae(()=>this.#l(n)))),this.#h>0?this.#v():(gt(this.#o,()=>{this.#o=null}),this.#e=!1)}))}#m(){var e=this.#t;return this.#e&&(this.#u=Te(),this.#t.before(this.#u),e=this.#u),e}is_pending(){return this.#e||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!this.#n.pending}#p(e){var n=$,i=O,r=X;ye(this.#s),te(this.#s),vt(this.#s.ctx);try{return e()}catch(s){return Ri(s),null}finally{ye(n),te(i),vt(r)}}#v(){const e=this.#n.pending;this.#r!==null&&(this.#c=document.createDocumentFragment(),this.#c.append(this.#u),nr(this.#r,this.#c)),this.#o===null&&(this.#o=ae(()=>e(this.#t)))}#_(e){if(!this.has_pending_snippet()){this.parent&&this.parent.#_(e);return}this.#h+=e,this.#h===0&&(this.#e=!1,this.#o&&gt(this.#o,()=>{this.#o=null}),this.#c&&(this.#t.before(this.#c),this.#c=null))}update_pending_count(e){this.#_(e),this.#d+=e,this.#f&&Mt(this.#f,this.#d)}get_effect_pending(){return this.#y(),d(this.#f)}error(e){var n=this.#n.onerror;let i=this.#n.failed;if(this.#g||!n&&!i)throw e;this.#r&&(ne(this.#r),this.#r=null),this.#o&&(ne(this.#o),this.#o=null),this.#a&&(ne(this.#a),this.#a=null);var r=!1,s=!1;const o=()=>{if(r){ns();return}r=!0,s&&Fr(),me.ensure(),this.#d=0,this.#a!==null&&gt(this.#a,()=>{this.#a=null}),this.#e=this.has_pending_snippet(),this.#r=this.#p(()=>(this.#g=!1,ae(()=>this.#l(this.#t)))),this.#h>0?this.#v():this.#e=!1};var a=O;try{te(null),s=!0,n?.(e,o),s=!1}catch(l){mt(l,this.#s&&this.#s.parent)}finally{te(a)}i&&Ht(()=>{this.#a=this.#p(()=>{me.ensure(),this.#g=!0;try{return ae(()=>{i(this.#t,()=>e,()=>o)})}catch(l){return mt(l,this.#s.parent),null}finally{this.#g=!1}})})}}function bn(t,e){return e}function ds(t,e,n){for(var i=[],r=e.length,s=0;s<r;s++)Bn(e[s].e,i,!0);er(i,()=>{var o=i.length===0&&n!==null;if(o){var a=n,l=a.parentNode;rs(l),l.append(a),t.items.clear(),fe(t,e[0].prev,e[r-1].next)}for(var c=0;c<r;c++){var u=e[c];o||(t.items.delete(u.k),fe(t,u.prev,u.next)),ne(u.e,!o)}t.first===e[0]&&(t.first=e[0].prev)})}function Sn(t,e,n,i,r,s=null){var o=t,a=new Map,l=null;{var c=t;o=c.appendChild(Te())}var u=null,f=Tt(()=>{var L=n();return bi(L)?L:L==null?[]:kn(L)}),h,g=!0;function p(){hs(A,h,o,e,i),u!==null&&(h.length===0?(u.fragment?(o.before(u.fragment),u.fragment=null):Yn(u.effect),b.first=u.effect):gt(u.effect,()=>{u=null}))}var b=un(()=>{h=d(f);for(var L=h.length,C=new Set,m=Y,E=null,T=Pi(),_=0;_<L;_+=1){var M=h[_],P=i(M,_),S=g?null:a.get(P);S?(Mt(S.v,M),S.i=_,T&&m.skipped_effects.delete(S.e)):(S=fs(g?o:null,E,M,P,_,r,e,n),g&&(S.o=!0,E===null?l=S:E.next=S,E=S),a.set(P,S)),C.add(P)}if(L===0&&s&&!u)if(g)u={fragment:null,effect:ae(()=>s(o))};else{var v=document.createDocumentFragment(),w=Te();v.append(w),u={fragment:v,effect:ae(()=>s(w))}}if(!g)if(T){for(const[R,y]of a)C.has(R)||m.skipped_effects.add(y.e);m.oncommit(p),m.ondiscard(()=>{})}else p();d(f)}),A={effect:b,items:a,first:l};g=!1}function hs(t,e,n,i,r){var s=e.length,o=t.items,a=t.first,l,c=null,u=[],f=[],h,g,p,b;for(b=0;b<s;b+=1){if(h=e[b],g=r(h,b),p=o.get(g),t.first??=p,!p.o){p.o=!0;var A=c?c.next:a;fe(t,c,p),fe(t,p,A),pn(p,A,n),c=p,u=[],f=[],a=c.next;continue}if((p.e.f&se)!==0&&Yn(p.e),p!==a){if(l!==void 0&&l.has(p)){if(u.length<f.length){var L=f[0],C;c=L.prev;var m=u[0],E=u[u.length-1];for(C=0;C<u.length;C+=1)pn(u[C],L,n);for(C=0;C<f.length;C+=1)l.delete(f[C]);fe(t,m.prev,E.next),fe(t,c,m),fe(t,E,L),a=L,c=E,b-=1,u=[],f=[]}else l.delete(p),pn(p,a,n),fe(t,p.prev,p.next),fe(t,p,c===null?t.first:c.next),fe(t,c,p),c=p;continue}for(u=[],f=[];a!==null&&a.k!==g;)(a.e.f&se)===0&&(l??=new Set).add(a),f.push(a),a=a.next;if(a===null)continue;p=a}u.push(p),c=p,a=p.next}if(a!==null||l!==void 0){for(var T=l===void 0?[]:kn(l);a!==null;)(a.e.f&se)===0&&T.push(a),a=a.next;var _=T.length;if(_>0){var M=s===0?n:null;ds(t,T,M)}}}function fs(t,e,n,i,r,s,o,a){var l=(o&Vr)!==0,c=(o&jr)===0,u=l?c?Hn(n,!1,!1):it(n):n,f=(o&qr)===0?r:it(r),h={i:f,v:u,k:i,a:null,e:null,o:!1,prev:e,next:null};try{if(t===null){var g=document.createDocumentFragment();g.append(t=Te())}return h.e=ae(()=>s(t,u,f,a)),e!==null&&(e.next=h),h}finally{}}function pn(t,e,n){for(var i=t.next?t.next.e.nodes_start:n,r=e?e.e.nodes_start:n,s=t.e.nodes_start;s!==null&&s!==i;){var o=$t(s);r.before(s),s=o}}function fe(t,e,n){e===null?(t.first=n,t.effect.first=n&&n.e):(e.e.next&&(e.e.next.prev=null),e.next=n,e.e.next=n&&n.e),n===null?t.effect.last=e&&e.e:(n.e.prev&&(n.e.prev.next=null),n.prev=e,n.e.prev=e&&e.e)}function gs(t,e,n,i){const r=Nt()?ln:Tt;if(n.length===0&&t.length===0){i(e.map(r));return}var s=Y,o=$,a=ps();function l(){Promise.all(n.map(c=>vs(c))).then(c=>{a();try{i([...e.map(r),...c])}catch(u){(o.f&He)===0&&mt(u,o)}s?.deactivate(),Vt()}).catch(c=>{mt(c,o)})}t.length>0?Promise.all(t).then(()=>{a();try{return l()}finally{s?.deactivate(),Vt()}}):l()}function ps(){var t=$,e=O,n=X,i=Y;return function(s=!0){ye(t),te(e),vt(n),s&&i?.activate()}}function Vt(){ye(null),te(null),vt(null)}function ln(t){var e=q|ie,n=O!==null&&(O.f&q)!==0?O:null;return $!==null&&($.f|=bt),{ctx:X,deps:null,effects:null,equals:Ai,f:e,fn:t,reactions:null,rv:0,v:J,wv:0,parent:n??$,ac:null}}function vs(t,e){let n=$;n===null&&$r();var i=n.b,r=void 0,s=it(J),o=!O,a=new Map;return Cs(()=>{var l=Ei();r=l.promise;try{Promise.resolve(t()).then(l.resolve,l.reject).then(()=>{c===Y&&c.committed&&c.deactivate(),Vt()})}catch(h){l.reject(h),Vt()}var c=Y;if(o){var u=!i.is_pending();i.update_pending_count(1),c.increment(u),a.get(c)?.reject(dt),a.delete(c),a.set(c,l)}const f=(h,g=void 0)=>{if(c.activate(),g)g!==dt&&(s.f|=$e,Mt(s,g));else{(s.f&$e)!==0&&(s.f^=$e),Mt(s,h);for(const[p,b]of a){if(a.delete(p),p===c)break;b.reject(dt)}}o&&(i.update_pending_count(-1),c.decrement(u))};l.promise.then(f,h=>f(null,h||"unknown"))}),Zn(()=>{for(const l of a.values())l.reject(dt)}),new Promise(l=>{function c(u){function f(){u===r?l(s):c(r)}u.then(f,f)}c(r)})}function xe(t){const e=ln(t);return Xi(e),e}function Tt(t){const e=ln(t);return e.equals=Ti,e}function $i(t){var e=t.effects;if(e!==null){t.effects=null;for(var n=0;n<e.length;n+=1)ne(e[n])}}function ms(t){for(var e=t.parent;e!==null;){if((e.f&q)===0)return(e.f&He)===0?e:null;e=e.parent}return null}function Nn(t){var e,n=$;ye(ms(t));try{t.f&=~tt,$i(t),e=Fi(t)}finally{ye(n)}return e}function Zi(t){var e=Nn(t);if(t.equals(e)||(Y?.is_fork||(t.v=e),t.wv=Gi()),!St)if(le!==null)(Lt()||Y?.is_fork)&&le.set(t,e);else{var n=(t.f&he)===0?we:U;V(t,n)}}let In=new Set;const Ze=new Map;let Bi=!1;function it(t,e){var n={f:0,v:t,reactions:null,equals:Ai,rv:0,wv:0};return n}function G(t,e){const n=it(t);return Xi(n),n}function Hn(t,e=!1,n=!0){const i=it(t);return e||(i.equals=Ti),Rt&&n&&X!==null&&X.l!==null&&(X.l.s??=[]).push(i),i}function k(t,e,n=!1){O!==null&&(!_e||(O.f&Vn)!==0)&&Nt()&&(O.f&(q|Oe|Pn|Vn))!==0&&!Ae?.includes(t)&&Kr();let i=n?Ne(e):e;return Mt(t,i)}function Mt(t,e){if(!t.equals(e)){var n=t.v;St?Ze.set(t,e):Ze.set(t,n),t.v=e;var i=me.ensure();i.capture(t,n),(t.f&q)!==0&&((t.f&ie)!==0&&Nn(t),V(t,(t.f&he)!==0?U:we)),t.wv=Gi(),Yi(t,ie),Nt()&&$!==null&&($.f&U)!==0&&($.f&(Le|ot))===0&&(oe===null?ys([t]):oe.push(t)),!i.is_fork&&In.size>0&&!Bi&&_s()}return e}function _s(){Bi=!1;var t=Be;qt(!0);const e=Array.from(In);try{for(const n of e)(n.f&U)!==0&&V(n,we),It(n)&&_t(n)}finally{qt(t)}In.clear()}function kt(t){k(t,t.v+1)}function Yi(t,e){var n=t.reactions;if(n!==null)for(var i=Nt(),r=n.length,s=0;s<r;s++){var o=n[s],a=o.f;if(!(!i&&o===$)){var l=(a&ie)===0;if(l&&V(o,e),(a&q)!==0){var c=o;le?.delete(c),(a&tt)===0&&(a&he&&(o.f|=tt),Yi(c,we))}else l&&((a&Oe)!==0&&Ie!==null&&Ie.add(o),nt(o))}}}function $n(t){var e=O,n=$;te(null),ye(null);try{return t()}finally{te(e),ye(n)}}let Be=!1;function qt(t){Be=t}let St=!1;function Jn(t){St=t}let O=null,_e=!1;function te(t){O=t}let $=null;function ye(t){$=t}let Ae=null;function Xi(t){O!==null&&(Ae===null?Ae=[t]:Ae.push(t))}let Q=null,re=0,oe=null;function ys(t){oe=t}let Wi=1,Ot=0,Qe=Ot;function Qn(t){Qe=t}function Gi(){return++Wi}function It(t){var e=t.f;if((e&ie)!==0)return!0;if(e&q&&(t.f&=~tt),(e&we)!==0){var n=t.deps;if(n!==null)for(var i=n.length,r=0;r<i;r++){var s=n[r];if(It(s)&&Zi(s),s.wv>t.wv)return!0}(e&he)!==0&&le===null&&V(t,U)}return!1}function Ki(t,e,n=!0){var i=t.reactions;if(i!==null&&!Ae?.includes(t))for(var r=0;r<i.length;r++){var s=i[r];(s.f&q)!==0?Ki(s,e,!1):e===s&&(n?V(s,ie):(s.f&U)!==0&&V(s,we),nt(s))}}function Fi(t){var e=Q,n=re,i=oe,r=O,s=Ae,o=X,a=_e,l=Qe,c=t.f;Q=null,re=0,oe=null,O=(c&(Le|ot))===0?t:null,Ae=null,vt(t.ctx),_e=!1,Qe=++Ot,t.ac!==null&&($n(()=>{t.ac.abort(dt)}),t.ac=null);try{t.f|=yn;var u=t.fn,f=u(),h=t.deps;if(Q!==null){var g;if(jt(t,re),h!==null&&re>0)for(h.length=re+Q.length,g=0;g<Q.length;g++)h[re+g]=Q[g];else t.deps=h=Q;if(Be&&Lt()&&(t.f&he)!==0)for(g=re;g<h.length;g++)(h[g].reactions??=[]).push(t)}else h!==null&&re<h.length&&(jt(t,re),h.length=re);if(Nt()&&oe!==null&&!_e&&h!==null&&(t.f&(q|we|ie))===0)for(g=0;g<oe.length;g++)Ki(oe[g],t);return r!==null&&r!==t&&(Ot++,oe!==null&&(i===null?i=oe:i.push(...oe))),(t.f&$e)!==0&&(t.f^=$e),f}catch(p){return Ri(p)}finally{t.f^=yn,Q=e,re=n,oe=i,O=r,Ae=s,vt(o),_e=a,Qe=l}}function ws(t,e){let n=e.reactions;if(n!==null){var i=Mr.call(n,t);if(i!==-1){var r=n.length-1;r===0?n=e.reactions=null:(n[i]=n[r],n.pop())}}n===null&&(e.f&q)!==0&&(Q===null||!Q.includes(e))&&(V(e,we),(e.f&he)!==0&&(e.f^=he,e.f&=~tt),$i(e),jt(e,0))}function jt(t,e){var n=t.deps;if(n!==null)for(var i=e;i<n.length;i++)ws(t,n[i])}function _t(t){var e=t.f;if((e&He)===0){V(t,U);var n=$,i=Be;$=t,Be=!0;try{(e&(Oe|Rr))!==0?Ts(t):Ji(t),ji(t);var r=Fi(t);t.teardown=typeof r=="function"?r:null,t.wv=Wi;var s;_n&&zr&&(t.f&ie)!==0&&t.deps}finally{Be=i,$=n}}}function d(t){var e=t.f,n=(e&q)!==0;if(O!==null&&!_e){var i=$!==null&&($.f&He)!==0;if(!i&&!Ae?.includes(t)){var r=O.deps;if((O.f&yn)!==0)t.rv<Ot&&(t.rv=Ot,Q===null&&r!==null&&r[re]===t?re++:Q===null?Q=[t]:Q.includes(t)||Q.push(t));else{(O.deps??=[]).push(t);var s=t.reactions;s===null?t.reactions=[O]:s.includes(O)||s.push(O)}}}if(St){if(Ze.has(t))return Ze.get(t);if(n){var o=t,a=o.v;return((o.f&U)===0&&o.reactions!==null||Ui(o))&&(a=Nn(o)),Ze.set(o,a),a}}else n&&(!le?.has(t)||Y?.is_fork&&!Lt())&&(o=t,It(o)&&Zi(o),Be&&Lt()&&(o.f&he)===0&&zi(o));if(le?.has(t))return le.get(t);if((t.f&$e)!==0)throw t.v;return t.v}function zi(t){if(t.deps!==null){t.f^=he;for(const e of t.deps)(e.reactions??=[]).push(t),(e.f&q)!==0&&(e.f&he)===0&&zi(e)}}function Ui(t){if(t.v===J)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(Ze.has(e)||(e.f&q)!==0&&Ui(e))return!0;return!1}function lt(t){var e=_e;try{return _e=!0,t()}finally{_e=e}}const bs=-7169;function V(t,e){t.f=t.f&bs|e}function Ss(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(ft in t)En(t);else if(!Array.isArray(t))for(let e in t){const n=t[e];typeof n=="object"&&n&&ft in n&&En(n)}}}function En(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let i in t)try{En(t[i],e)}catch{}const n=Mn(t);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const i=Ii(n);for(let r in i){const s=i[r].get;if(s)try{s.call(t)}catch{}}}}}function Vi(t){$===null&&(O===null&&Yr(),Br()),St&&Zr()}function Is(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function be(t,e,n){var i=$;i!==null&&(i.f&se)!==0&&(t|=se);var r={ctx:X,deps:null,nodes_start:null,nodes_end:null,f:t|ie|he,first:null,fn:e,last:null,next:null,parent:i,b:i&&i.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(n)try{_t(r),r.f|=Ln}catch(a){throw ne(r),a}else e!==null&&nt(r);var s=r;if(n&&s.deps===null&&s.teardown===null&&s.nodes_start===null&&s.first===s.last&&(s.f&bt)===0&&(s=s.first,(t&Oe)!==0&&(t&et)!==0&&s!==null&&(s.f|=et)),s!==null&&(s.parent=i,i!==null&&Is(s,i),O!==null&&(O.f&q)!==0&&(t&ot)===0)){var o=O;(o.effects??=[]).push(s)}return r}function Lt(){return O!==null&&!_e}function Zn(t){const e=be(on,null,!1);return V(e,U),e.teardown=t,e}function yt(t){Vi();var e=$.f,n=!O&&(e&Le)!==0&&(e&Ln)===0;if(n){var i=X;(i.e??=[]).push(t)}else return qi(t)}function qi(t){return be(On|Di,t,!1)}function Es(t){return Vi(),be(on|Di,t,!0)}function xs(t){me.ensure();const e=be(ot|bt,t,!0);return(n={})=>new Promise(i=>{n.outro?gt(e,()=>{ne(e),i(void 0)}):(ne(e),i(void 0))})}function Ds(t){return be(On,t,!1)}function ei(t,e){var n=X,i={effect:null,ran:!1,deps:t};n.l.$.push(i),i.effect=cn(()=>{t(),!i.ran&&(i.ran=!0,lt(e))})}function As(){var t=X;cn(()=>{for(var e of t.l.$){e.deps();var n=e.effect;(n.f&U)!==0&&V(n,we),It(n)&&_t(n),e.ran=!1}})}function Cs(t){return be(Pn|bt,t,!0)}function cn(t,e=0){return be(on|e,t,!0)}function ue(t,e=[],n=[],i=[]){gs(i,e,n,r=>{be(on,()=>t(...r.map(d)),!0)})}function un(t,e=0){var n=be(Oe|e,t,!0);return n}function ae(t){return be(Le|bt,t,!0)}function ji(t){var e=t.teardown;if(e!==null){const n=St,i=O;Jn(!0),te(null);try{e.call(null)}finally{Jn(n),te(i)}}}function Ji(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){const r=n.ac;r!==null&&$n(()=>{r.abort(dt)});var i=n.next;(n.f&ot)!==0?n.parent=null:ne(n,e),n=i}}function Ts(t){for(var e=t.first;e!==null;){var n=e.next;(e.f&Le)===0&&ne(e),e=n}}function ne(t,e=!0){var n=!1;(e||(t.f&xi)!==0)&&t.nodes_start!==null&&t.nodes_end!==null&&(ks(t.nodes_start,t.nodes_end),n=!0),Ji(t,e&&!n),jt(t,0),V(t,He);var i=t.transitions;if(i!==null)for(const s of i)s.stop();ji(t);var r=t.parent;r!==null&&r.first!==null&&Qi(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes_start=t.nodes_end=t.ac=null}function ks(t,e){for(;t!==null;){var n=t===e?null:$t(t);t.remove(),t=n}}function Qi(t){var e=t.parent,n=t.prev,i=t.next;n!==null&&(n.next=i),i!==null&&(i.prev=n),e!==null&&(e.first===t&&(e.first=i),e.last===t&&(e.last=n))}function gt(t,e,n=!0){var i=[];Bn(t,i,!0),er(i,()=>{n&&ne(t),e&&e()})}function er(t,e){var n=t.length;if(n>0){var i=()=>--n||e();for(var r of t)r.out(i)}else e()}function Bn(t,e,n){if((t.f&se)===0){if(t.f^=se,t.transitions!==null)for(const o of t.transitions)(o.is_global||n)&&e.push(o);for(var i=t.first;i!==null;){var r=i.next,s=(i.f&et)!==0||(i.f&Le)!==0&&(t.f&Oe)!==0;Bn(i,e,s?n:!1),i=r}}}function Yn(t){tr(t,!0)}function tr(t,e){if((t.f&se)!==0){t.f^=se,(t.f&U)===0&&(V(t,ie),nt(t));for(var n=t.first;n!==null;){var i=n.next,r=(n.f&et)!==0||(n.f&Le)!==0;tr(n,r?e:!1),n=i}if(t.transitions!==null)for(const s of t.transitions)(s.is_global||e)&&s.in()}}function nr(t,e){for(var n=t.nodes_start,i=t.nodes_end;n!==null;){var r=n===i?null:$t(n);e.append(n),n=r}}const Ms=["touchstart","touchmove"];function Os(t){return Ms.includes(t)}const ir=new Set,xn=new Set;function Ls(t,e,n,i={}){function r(s){if(i.capture||xt.call(e,s),!s.cancelBubble)return $n(()=>n?.call(this,s))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?Ht(()=>{e.addEventListener(t,r,i)}):e.addEventListener(t,r,i),r}function Jt(t,e,n,i,r){var s={capture:i,passive:r},o=Ls(t,e,n,s);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&Zn(()=>{e.removeEventListener(t,o,s)})}function Et(t){for(var e=0;e<t.length;e++)ir.add(t[e]);for(var n of xn)n(t)}let ti=null;function xt(t){var e=this,n=e.ownerDocument,i=t.type,r=t.composedPath?.()||[],s=r[0]||t.target;ti=t;var o=0,a=ti===t&&t.__root;if(a){var l=r.indexOf(a);if(l!==-1&&(e===document||e===window)){t.__root=e;return}var c=r.indexOf(e);if(c===-1)return;l<=c&&(o=l)}if(s=r[o]||t.target,s!==e){Si(t,"currentTarget",{configurable:!0,get(){return s||n}});var u=O,f=$;te(null),ye(null);try{for(var h,g=[];s!==null;){var p=s.assignedSlot||s.parentNode||s.host||null;try{var b=s["__"+i];b!=null&&(!s.disabled||t.target===s)&&b.call(s,t)}catch(A){h?g.push(A):h=A}if(t.cancelBubble||p===e||p===null)break;s=p}if(h){for(let A of g)queueMicrotask(()=>{throw A});throw h}}finally{t.__root=e,delete t.currentTarget,te(u),ye(f)}}}function Ps(t){var e=document.createElement("template");return e.innerHTML=t.replaceAll("<!>","<!---->"),e.content}function Qt(t,e){var n=$;n.nodes_start===null&&(n.nodes_start=t,n.nodes_end=e)}function B(t,e){var n=(e&Jr)!==0,i=(e&Qr)!==0,r,s=!t.startsWith("<!>");return()=>{r===void 0&&(r=Ps(s?t:"<!>"+t),n||(r=Ut(r)));var o=i||Mi?document.importNode(r,!0):r.cloneNode(!0);if(n){var a=Ut(o),l=o.lastChild;Qt(a,l)}else Qt(o,o);return o}}function pe(t=""){{var e=Te(t+"");return Qt(e,e),e}}function dn(){var t=document.createDocumentFragment(),e=document.createComment(""),n=Te();return t.append(e,n),Qt(e,n),t}function x(t,e){t!==null&&t.before(e)}function ke(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??=t.nodeValue)&&(t.__t=n,t.nodeValue=n+"")}function Rs(t,e){return Ns(t,e)}const ct=new Map;function Ns(t,{target:e,anchor:n,props:i={},events:r,context:s,intro:o=!0}){is();var a=new Set,l=f=>{for(var h=0;h<f.length;h++){var g=f[h];if(!a.has(g)){a.add(g);var p=Os(g);e.addEventListener(g,xt,{passive:p});var b=ct.get(g);b===void 0?(document.addEventListener(g,xt,{passive:p}),ct.set(g,1)):ct.set(g,b+1)}}};l(kn(ir)),xn.add(l);var c=void 0,u=xs(()=>{var f=n??e.appendChild(Te());return cs(f,{pending:()=>{}},h=>{if(s){Xe({});var g=X;g.c=s}r&&(i.$$events=r),c=t(h,i)||{},s&&We()}),()=>{for(var h of a){e.removeEventListener(h,xt);var g=ct.get(h);--g===0?(document.removeEventListener(h,xt),ct.delete(h)):ct.set(h,g)}xn.delete(l),f!==n&&f.parentNode?.removeChild(f)}});return Hs.set(c,u),c}let Hs=new WeakMap;class rr{anchor;#e=new Map;#t=new Map;#i=new Map;#n=new Set;#l=!0;constructor(e,n=!0){this.anchor=e,this.#l=n}#s=()=>{var e=Y;if(this.#e.has(e)){var n=this.#e.get(e),i=this.#t.get(n);if(i)Yn(i),this.#n.delete(n);else{var r=this.#i.get(n);r&&(this.#t.set(n,r.effect),this.#i.delete(n),r.fragment.lastChild.remove(),this.anchor.before(r.fragment),i=r.effect)}for(const[s,o]of this.#e){if(this.#e.delete(s),s===e)break;const a=this.#i.get(o);a&&(ne(a.effect),this.#i.delete(o))}for(const[s,o]of this.#t){if(s===n||this.#n.has(s))continue;const a=()=>{if(Array.from(this.#e.values()).includes(s)){var c=document.createDocumentFragment();nr(o,c),c.append(Te()),this.#i.set(s,{effect:o,fragment:c})}else ne(o);this.#n.delete(s),this.#t.delete(s)};this.#l||!i?(this.#n.add(s),gt(o,a,!1)):a()}}};#r=e=>{this.#e.delete(e);const n=Array.from(this.#e.values());for(const[i,r]of this.#i)n.includes(i)||(ne(r.effect),this.#i.delete(i))};ensure(e,n){var i=Y,r=Pi();if(n&&!this.#t.has(e)&&!this.#i.has(e))if(r){var s=document.createDocumentFragment(),o=Te();s.append(o),this.#i.set(e,{effect:ae(()=>n(o)),fragment:s})}else this.#t.set(e,ae(()=>n(this.anchor)));if(this.#e.set(i,e),r){for(const[a,l]of this.#t)a===e?i.skipped_effects.delete(l):i.skipped_effects.add(l);for(const[a,l]of this.#i)a===e?i.skipped_effects.delete(l.effect):i.skipped_effects.add(l.effect);i.oncommit(this.#s),i.ondiscard(this.#r)}else this.#s()}}function z(t,e,n=!1){var i=new rr(t),r=n?et:0;function s(o,a){i.ensure(o,a)}un(()=>{var o=!1;e((a,l=!0)=>{o=!0,s(l,a)}),o||s(!1,null)},r)}function Dn(t,e,...n){var i=new rr(t);un(()=>{const r=e()??null;i.ensure(r,r&&(s=>r(s,...n)))},et)}const ni=[...` 	
\r\f \v\uFEFF`];function $s(t,e,n){var i=t==null?"":""+t;if(e&&(i=i?i+" "+e:e),n){for(var r in n)if(n[r])i=i?i+" "+r:r;else if(i.length)for(var s=r.length,o=0;(o=i.indexOf(r,o))>=0;){var a=o+s;(o===0||ni.includes(i[o-1]))&&(a===i.length||ni.includes(i[a]))?i=(o===0?"":i.substring(0,o))+i.substring(a+1):o=a}}return i===""?null:i}function Zs(t,e){return t==null?null:String(t)}function wt(t,e,n,i,r,s){var o=t.__className;if(o!==n||o===void 0){var a=$s(n,i,s);a==null?t.removeAttribute("class"):t.className=a,t.__className=n}else if(s&&r!==s)for(var l in s){var c=!!s[l];(r==null||c!==!!r[l])&&t.classList.toggle(l,c)}return s}function Ye(t,e,n,i){var r=t.__style;if(r!==e){var s=Zs(e);s==null?t.removeAttribute("style"):t.style.cssText=s,t.__style=e}return i}const Bs=Symbol("is custom element"),Ys=Symbol("is html");function ii(t,e){var n=sr(t);n.value===(n.value=e??void 0)||t.value===e&&(e!==0||t.nodeName!=="PROGRESS")||(t.value=e??"")}function pt(t,e,n,i){var r=sr(t);r[e]!==(r[e]=n)&&(e==="loading"&&(t[Nr]=n),n==null?t.removeAttribute(e):typeof n!="string"&&Xs(t).includes(e)?t[e]=n:t.setAttribute(e,n))}function sr(t){return t.__attributes??={[Bs]:t.nodeName.includes("-"),[Ys]:t.namespaceURI===es}}var ri=new Map;function Xs(t){var e=t.getAttribute("is")||t.nodeName,n=ri.get(e);if(n)return n;ri.set(e,n=[]);for(var i,r=t,s=Element.prototype;s!==r;){i=Ii(r);for(var o in i)i[o].set&&n.push(o);r=Mn(r)}return n}function si(t,e){return t===e||t?.[ft]===e}function Xn(t={},e,n,i){return Ds(()=>{var r,s;return cn(()=>{r=s,s=[],lt(()=>{t!==n(...s)&&(e(t,...s),r&&si(n(...r),t)&&e(null,...r))})}),()=>{Ht(()=>{s&&si(n(...s),t)&&e(null,...s)})}}),t}function Wn(t=!1){const e=X,n=e.l.u;if(!n)return;let i=()=>Ss(e.s);if(t){let r=0,s={};const o=ln(()=>{let a=!1;const l=e.s;for(const c in l)l[c]!==s[c]&&(s[c]=l[c],a=!0);return a&&r++,r});i=()=>d(o)}n.b.length&&Es(()=>{oi(e,i),zt(n.b)}),yt(()=>{const r=lt(()=>n.m.map(Pr));return()=>{for(const s of r)typeof s=="function"&&s()}}),n.a.length&&yt(()=>{oi(e,i),zt(n.a)})}function oi(t,e){if(t.l.s)for(const n of t.l.s)d(n);e()}let An=Symbol();function ee(t,e,n){const i=n[e]??={store:null,source:Hn(void 0),unsubscribe:De};if(i.store!==t&&!(An in n))if(i.unsubscribe(),i.store=t??null,t==null)i.source.v=void 0,i.unsubscribe=De;else{var r=!0;i.unsubscribe=Gn(t,s=>{r?i.source.v=s:k(i.source,s)}),r=!1}return t&&An in n?or(t):d(i.source)}function Zt(){const t={};function e(){Zn(()=>{for(var n in t)t[n].unsubscribe();Si(t,An,{enumerable:!1,value:!0})})}return[t,e]}function Ee(t,e,n,i){var r=i,s=!0,o=()=>(s&&(s=!1,r=i),r),a;a=t[e],a===void 0&&i!==void 0&&(a=o());var l;return l=()=>{var c=t[e];return c===void 0?o():(s=!0,c)},l}function Ws(t){X===null&&Hr(),Rt&&X.l!==null?Gs(X).m.push(t):yt(()=>{const e=lt(t);if(typeof e=="function")return e})}function Gs(t){var e=t.l;return e.u??={a:[],b:[],m:[]}}function Gn(t,e,n){if(t==null)return e(void 0),n&&n(void 0),De;const i=lt(()=>t.subscribe(e,n));return i.unsubscribe?()=>i.unsubscribe():i}const ut=[];function Ks(t,e){return{subscribe:de(t,e).subscribe}}function de(t,e=De){let n=null;const i=new Set;function r(a){if(Ci(t,a)&&(t=a,n)){const l=!ut.length;for(const c of i)c[1](),ut.push(c,t);if(l){for(let c=0;c<ut.length;c+=2)ut[c][0](ut[c+1]);ut.length=0}}}function s(a){r(a(t))}function o(a,l=De){const c=[a,l];return i.add(c),i.size===1&&(n=e(r,s)||De),a(t),()=>{i.delete(c),i.size===0&&n&&(n(),n=null)}}return{set:r,update:s,subscribe:o}}function Ge(t,e,n){const i=!Array.isArray(t),r=i?[t]:t;if(!r.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const s=e.length<2;return Ks(n,(o,a)=>{let l=!1;const c=[];let u=0,f=De;const h=()=>{if(u)return;f();const p=e(i?c[0]:c,o,a);s?o(p):f=typeof p=="function"?p:De},g=r.map((p,b)=>Gn(p,A=>{c[b]=A,u&=~(1<<b),l&&h()},()=>{u|=1<<b}));return l=!0,h(),function(){zt(g),f(),l=!1}})}function or(t){let e;return Gn(t,n=>e=n)(),e}function Fs(){return`zone_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const Cn=["#e74c3c","#e67e22","#f1c40f","#2ecc71","#1abc9c","#3498db","#9b59b6","#e91e8f"];function zs(){return Cn[Math.floor(Math.random()*Cn.length)]}function Us(t,e=200){return{id:Fs(),x:t,width:e,color:zs(),texts:[{language:"cs",title:"",content:""}]}}function Vs(t,e){const n=t.texts.find(i=>i.language===e);return n||t.texts[0]||null}const en=de("cs"),qs=de("orange"),js=de("Forest"),Tn=de(!1),Dt=de(!1),ar=de(!1),lr=de(!1),cr=de(null),Js=Ge([cr,en],([t,e])=>t?Vs(t,e):null);function ai(t){cr.set(t)}const Me={BACKGROUND_BASE:-100,BACKGROUND_LAYER_START:-99,GROUND_REFERENCE:-1,ITEMS_BEHIND:5,PLAYER:10,ITEMS_FRONT:15,SELECTION_GRAPHICS:999,GRID_OVERLAY:1e3};function ur(t){return t==="behind"?Me.ITEMS_BEHIND:Me.ITEMS_FRONT}const Se=["orange","white"];class Qs{currentSkin=Se[0];currentIndex=0;setSkin(e){Se.includes(e)&&(this.currentSkin=e,this.currentIndex=Se.indexOf(e),localStorage.setItem("catSkin",e))}getSkin(){const e=localStorage.getItem("catSkin");return e&&Se.includes(e)&&(this.currentSkin=e,this.currentIndex=Se.indexOf(e)),this.currentSkin}toggleSkin(){return this.currentIndex=(this.currentIndex+1)%Se.length,this.currentSkin=Se[this.currentIndex],this.setSkin(this.currentSkin),this.currentSkin}getAllSkins(){return Se}}const dr=new Qs,eo={FAST_VELOCITY_THRESHOLD:100,ROTATION_FULL:15,ROTATION_SLIGHT:8};class to{scene;currentSkin;constructor(e,n="white"){this.scene=e,this.currentSkin=n}createAll(){dr.getAllSkins().forEach(n=>{this.createAnimationsForSkin(n)})}createAnimationsForSkin(e){const n=this.scene;n.anims.exists(`cat-idle-${e}`)||n.anims.create({key:`cat-idle-${e}`,frames:n.anims.generateFrameNumbers(`cat-idle-${e}`,{start:0,end:3}),frameRate:6,repeat:-1}),n.anims.exists(`cat-walk-${e}`)||n.anims.create({key:`cat-walk-${e}`,frames:n.anims.generateFrameNumbers(`cat-walk-${e}`,{start:0,end:5}),frameRate:12,repeat:-1}),[{key:`cat-jump-up-${e}`,frame:2},{key:`cat-jump-peak-up-${e}`,frame:3},{key:`cat-jump-peak-down-${e}`,frame:3},{key:`cat-jump-down-${e}`,frame:4}].forEach(({key:r,frame:s})=>{n.anims.exists(r)||n.anims.create({key:r,frames:[{key:`cat-walk-${e}`,frame:s}],frameRate:1,repeat:0})})}getSkin(){return this.currentSkin}setSkin(e){this.currentSkin=e}getAnimationKey(e){return`cat-${e}-${this.currentSkin}`}play(e,n){const i=this.getAnimationKey(n);e.anims.currentAnim?.key!==i&&e.play(i)}getJumpAnimationState(e){const{FAST_VELOCITY_THRESHOLD:n,ROTATION_FULL:i,ROTATION_SLIGHT:r}=eo;return e<-n?{animation:this.getAnimationKey("jump-up"),rotation:i,flipMultiplier:1}:e<-20?{animation:this.getAnimationKey("jump-peak-up"),rotation:r,flipMultiplier:1}:e<=n?{animation:this.getAnimationKey("jump-peak-down"),rotation:r,flipMultiplier:-1}:{animation:this.getAnimationKey("jump-down"),rotation:i,flipMultiplier:-1}}handleSkinChange(e,n){const i=this.currentSkin;this.currentSkin=n;const r=e.anims.currentAnim?.key;if(r){const o=`cat-${r.replace("cat-","").replace(`-${i}`,"")}-${n}`;this.scene.anims.exists(o)&&e.play(o)}}}const qe={THRESHOLD_X:20,LANGUAGE_BUTTON:{width:120,height:60},SKIN_BUTTON:{width:120,height:60,yOffset:60}},li={SPEED:350,JUMP_STRENGTH:-500};class no{scene;getPlayerPosition;keyUp;keyLeft;keyRight;keyA;keyD;keyW;keySpace;touchLeft=!1;touchRight=!1;touchJump=!1;touchHandlers;constructor(e){this.scene=e.scene,this.getPlayerPosition=e.getPlayerPosition,this.setupKeyboardControls(),this.setupTouchControls()}setupKeyboardControls(){this.scene.input.keyboard&&(this.keyUp=this.scene.input.keyboard.addKey(D.Input.Keyboard.KeyCodes.UP,!1),this.keyLeft=this.scene.input.keyboard.addKey(D.Input.Keyboard.KeyCodes.LEFT,!1),this.keyRight=this.scene.input.keyboard.addKey(D.Input.Keyboard.KeyCodes.RIGHT,!1),this.keyA=this.scene.input.keyboard.addKey(D.Input.Keyboard.KeyCodes.A,!1),this.keyD=this.scene.input.keyboard.addKey(D.Input.Keyboard.KeyCodes.D,!1),this.keyW=this.scene.input.keyboard.addKey(D.Input.Keyboard.KeyCodes.W,!1),this.keySpace=this.scene.input.keyboard.addKey(D.Input.Keyboard.KeyCodes.SPACE,!1))}setupTouchControls(){const e=this.scene,n=o=>{const a=o.x,l=o.y,c=e.scale.width;if(a>c-qe.LANGUAGE_BUTTON.width&&l<qe.LANGUAGE_BUTTON.height||a>c-qe.SKIN_BUTTON.width&&l>=qe.SKIN_BUTTON.yOffset&&l<qe.SKIN_BUTTON.yOffset+qe.SKIN_BUTTON.height)return;const u=e.cameras.main,f=this.getPlayerPosition(),h=f.x-u.scrollX,g=f.y-u.scrollY,p=a-h,b=l-g;p<-20?(this.touchLeft=!0,this.touchRight=!1):p>qe.THRESHOLD_X?(this.touchRight=!0,this.touchLeft=!1):(this.touchLeft=!1,this.touchRight=!1),this.touchJump=b<-80},i=o=>{n(o)},r=o=>{o.isDown&&n(o)},s=()=>{this.touchLeft=!1,this.touchRight=!1,this.touchJump=!1};e.input.on("pointerdown",i),e.input.on("pointermove",r),e.input.on("pointerup",s),this.touchHandlers={pointerdown:i,pointermove:r,pointerup:s}}getInputState(){const e=this.keyA?.isDown||this.keyLeft?.isDown||this.touchLeft||!1,n=this.keyD?.isDown||this.keyRight?.isDown||this.touchRight||!1,i=this.keySpace?.isDown||this.keyW?.isDown||this.keyUp?.isDown||this.touchJump||!1;return{left:e,right:n,jump:i}}hasAnyInput(){const e=this.getInputState();return e.left||e.right||e.jump}destroy(){this.touchHandlers&&(this.scene.input.off("pointerdown",this.touchHandlers.pointerdown),this.scene.input.off("pointermove",this.touchHandlers.pointermove),this.scene.input.off("pointerup",this.touchHandlers.pointerup),this.touchHandlers=void 0)}}class io extends D.Physics.Arcade.Sprite{animations;inputController;animState="idle";hasNotifiedMovement=!1;hasReceivedInput=!1;constructor(e,n,i){const r="white";super(e,n,i,`cat-idle-${r}`),e.add.existing(this),e.physics.add.existing(this),this.animations=new to(e,r),this.animations.createAll(),this.inputController=new no({scene:e,getPlayerPosition:()=>({x:this.x,y:this.y})}),this.setCollideWorldBounds(!0),this.setBounce(0),this.setSize(40,40),this.setOffset(4,8),this.setScale(5),this.setDepth(Me.PLAYER),this.animations.play(this,"idle")}changeSkin(e){this.animations.handleSkinChange(this,e)}updateJumpAnimation(e){const{animation:n,rotation:i,flipMultiplier:r}=this.animations.getJumpAnimationState(e);this.anims.currentAnim?.key!==n&&this.play(n);const s=this.flipX?i*r:-i*r;this.setAngle(s)}update(){const e=this.inputController.getInputState(),n=this.body,i=n&&(n.blocked.down||n.touching.down);switch(this.inputController.hasAnyInput()&&!this.hasReceivedInput&&(this.hasReceivedInput=!0),this.hasReceivedInput&&this.inputController.hasAnyInput()&&!this.hasNotifiedMovement&&(this.hasNotifiedMovement=!0,lr.set(!0)),e.left?(this.setVelocityX(-350),this.setFlipX(!0),i&&(this.animState="running")):e.right?(this.setVelocityX(li.SPEED),this.setFlipX(!1),i&&(this.animState="running")):(this.setVelocityX(0),i&&(this.animState="idle")),e.jump&&i&&(this.setVelocityY(li.JUMP_STRENGTH),this.animState="jumping"),!i&&n&&n.velocity.y!==0&&(this.animState="jumping"),this.animState){case"idle":this.animations.play(this,"idle"),this.setAngle(0);break;case"running":this.animations.play(this,"walk"),this.setAngle(0);break;case"jumping":this.updateJumpAnimation(n.velocity.y);break}}destroy(e){this.inputController.destroy(),super.destroy(e)}}const je=[{name:"FOREST",folder:"forest",scrollFactors:[1,.8,.85,.9,.95,1]},{name:"FOREST BLUE",folder:"forest_blue",scrollFactors:[1,.8,.85,.9,.95,1]}];class ro{currentIndex=0;constructor(){const e=localStorage.getItem("background");if(e){const n=je.findIndex(i=>i.folder===e);n!==-1&&(this.currentIndex=n)}}getBackground(){return je[this.currentIndex].folder}getCurrentConfig(){return je[this.currentIndex]}setBackground(e){const n=je.findIndex(i=>i.folder===e);n!==-1&&(this.currentIndex=n,localStorage.setItem("background",e))}toggleBackground(){this.currentIndex=(this.currentIndex+1)%je.length;const e=je[this.currentIndex];return localStorage.setItem("background",e.folder),e}getAllBackgrounds(){return je}}const tn=new ro;function hr(t,e){return new Promise(n=>{t.load.image(`bg0-${e.folder}`,`assets/backgrounds/${e.folder}/0.png`);for(let i=0;i<e.scrollFactors.length;i++){const r=i+1;t.load.image(`bg${r}-${e.folder}`,`assets/backgrounds/${e.folder}/${r}.png`)}t.load.once("complete",()=>{n(!0)}),t.load.once("loaderror",i=>{console.error(`Failed to load background asset: ${i.key}`),n(!1)}),t.load.start()})}function fr(t,e,n,i){const r=Math.max(n,t.scale.height),s=t.add.tileSprite(0,0,e,r,`bg0-${i.folder}`);s.setOrigin(0,0),s.setScrollFactor(1),s.setDepth(Me.BACKGROUND_BASE),s.tilePositionX=0,s.tilePositionY=0;const o=[];for(let a=0;a<i.scrollFactors.length;a++){const c=`bg${a+1}-${i.folder}`;if(t.textures.exists(c)){const u=t.add.image(0,0,c);u.setOrigin(0,0),u.setScrollFactor(i.scrollFactors[a]),u.setDepth(Me.BACKGROUND_LAYER_START+a),u.setDisplaySize(e,n),o.push(u)}}return{baseLayer:s,bgLayers:o}}function gr(t,e){t&&(t.tilePositionX=e.scrollX)}function so(t){t.bgLayers.forEach(e=>e.destroy()),t.baseLayer.destroy()}const oo={isActive:!1,config:null,selectedItemId:null,itemDepthLayer:"behind",editMode:"items",selectedDialogZoneId:null},W=de(oo),ao=Ge(W,t=>t.isActive),lo=Ge(W,t=>t.config),pr=Ge(W,t=>t.selectedItemId),vr=Ge(W,t=>t.itemDepthLayer),hn=Ge(W,t=>t.editMode),mr=Ge(W,t=>t.selectedDialogZoneId),_r=Ge(W,t=>t.config?.dialogZones||[]);function ci(t,e){W.update(n=>n.config?{...n,config:{...n.config,playerStartX:t,playerStartY:e}}:n)}function co(t){W.update(e=>{if(!e.config)return e;const n=e.config.placedItems||[];return{...e,config:{...e.config,placedItems:[...n,t]}}})}function yr(t,e){W.update(n=>!n.config||!n.config.placedItems?n:{...n,config:{...n.config,placedItems:n.config.placedItems.map(i=>i.id===t?{...i,...e}:i)}})}function wr(t){W.update(e=>!e.config||!e.config.placedItems?e:{...e,config:{...e.config,placedItems:e.config.placedItems.filter(n=>n.id!==t)},selectedItemId:e.selectedItemId===t?null:e.selectedItemId})}function nn(t){W.update(e=>({...e,selectedItemId:t}))}function Kn(){W.update(t=>({...t,selectedItemId:null}))}function uo(){W.update(t=>({...t,itemDepthLayer:t.itemDepthLayer==="behind"?"front":"behind"}))}function ho(t,e){yr(t,{depth:e})}function fo(t){W.set({isActive:!0,config:{...t,placedItems:t.placedItems||[],dialogZones:t.dialogZones||[]},selectedItemId:null,itemDepthLayer:"behind",editMode:"items",selectedDialogZoneId:null}),Bt.set(!1)}function go(){W.update(t=>({...t,isActive:!1,selectedItemId:null})),Bt.set(!1)}function po(){return or(W).config}const Bt=de(!1);function ui(t){Bt.set(t)}const br=de({scrollX:0,scrollY:0,viewWidth:0,viewHeight:0,worldWidth:0,worldHeight:0,zoom:1,playerX:0,playerY:0});function vo(t){br.update(e=>({...e,...t}))}function mo(){W.update(t=>({...t,editMode:t.editMode==="items"?"dialogs":"items",selectedItemId:null,selectedDialogZoneId:null}))}function _o(t){W.update(e=>{if(!e.config)return e;const n=e.config.dialogZones||[];return{...e,config:{...e.config,dialogZones:[...n,t]}}})}function At(t,e){W.update(n=>!n.config||!n.config.dialogZones?n:{...n,config:{...n.config,dialogZones:n.config.dialogZones.map(i=>i.id===t?{...i,...e}:i)}})}function yo(t){W.update(e=>!e.config||!e.config.dialogZones?e:{...e,config:{...e.config,dialogZones:e.config.dialogZones.filter(n=>n.id!==t)},selectedDialogZoneId:e.selectedDialogZoneId===t?null:e.selectedDialogZoneId})}function Gt(t){W.update(e=>({...e,selectedDialogZoneId:t}))}function di(t,e,n){W.update(i=>!i.config||!i.config.dialogZones?i:{...i,config:{...i.config,dialogZones:i.config.dialogZones.map(r=>{if(r.id!==t)return r;const s=r.texts.findIndex(a=>a.language===e);let o;return s>=0?o=r.texts.map((a,l)=>l===s?{...a,...n}:a):o=[...r.texts,{language:e,title:"",content:"",...n}],{...r,texts:o}})}})}const Fn=[{key:"tent",name:"Tent",path:"assets/ui/tent.png",scale:6,category:"structures"},{key:"lamp",name:"Lamp",path:"assets/ui/lamp.png",scale:8,category:"props"},{key:"sign_left",name:"Sign ←",path:"assets/ui/sign_left.png",scale:7,category:"signs"},{key:"sign_right",name:"Sign →",path:"assets/ui/sign_right.png",scale:7,category:"signs"},{key:"stone_0",name:"Stone 0",path:"assets/ui/stone_0.png",scale:4,category:"nature"},{key:"stone_1",name:"Stone 1",path:"assets/ui/stone_1.png",scale:5,category:"nature"},{key:"stone_2",name:"Stone 2",path:"assets/ui/stone_2.png",scale:4,category:"nature"}];function wo(t){return Fn.find(e=>e.key===t)}function bo(t){return wo(t)?.scale||1}class hi{scene;groundY;constructor(e,n){this.scene=e,this.groundY=n}static preloadAssets(e){Fn.forEach(n=>{e.load.image(n.key,n.path)})}createSprite(e){const{id:n,assetKey:i,x:r,scale:s=1,depth:o=5,yOffset:a=0}=e,l=this.groundY+a,c=this.scene.add.sprite(r,l,i);return c.setScale(s),c.setDepth(o),c.setData("itemId",n),c}updatePosition(e,n,i){e.x=n,e.y=this.groundY+i}updateScale(e,n){e.setScale(n)}updateDepth(e,n){e.setDepth(n)}applyUpdates(e,n){n.x!==void 0&&(e.x=n.x),n.yOffset!==void 0&&(e.y=this.groundY+n.yOffset),n.scale!==void 0&&e.setScale(n.scale),n.depth!==void 0&&e.setDepth(n.depth)}worldYToOffset(e){return e-this.groundY}getGroundY(){return this.groundY}}class So{scene;groundY;isDragging=!1;callbacks;constructor(e,n,i={}){this.scene=e,this.groundY=n,this.callbacks=i}getIsDragging(){return this.isDragging}makeInteractive(e,n){e.setInteractive({cursor:"pointer"}),this.scene.input.setDraggable(e),e.on("pointerdown",()=>{this.isDragging||nn(n)}),e.on("dragstart",()=>{this.isDragging=!1,e.setTint(4886754),this.scene.data?.set("isDraggingItem",!0),this.callbacks.onDragStart?.(n)}),e.on("drag",(i,r,s)=>{this.isDragging=!0,e.setPosition(r,s),this.callbacks.onDrag?.(n,r,s)}),e.on("dragend",()=>{e.clearTint(),this.scene.data?.set("isDraggingItem",!1);const i=Math.round(e.x),s=Math.round(e.y)-this.groundY;yr(n,{x:i,yOffset:s}),this.callbacks.onDragEnd?.(n,i,s),this.scene.time.delayedCall(50,()=>{this.isDragging=!1})})}removeInteractivity(e){!e||!e.scene||(e.removeInteractive(),e.off("pointerdown"),e.off("dragstart"),e.off("drag"),e.off("dragend"))}}const Io={lineWidth:3,lineColor:4886754,lineAlpha:1,handleSize:8,handleColor:4886754,padding:5};class Eo{scene;graphics;style;selectedId=null;constructor(e,n={}){this.scene=e,this.style={...Io,...n},this.graphics=e.add.graphics(),this.graphics.setDepth(Me.SELECTION_GRAPHICS)}setSelectedId(e){this.selectedId=e}getSelectedId(){return this.selectedId}updateVisuals(e){if(this.graphics.clear(),!e||!this.selectedId)return;const n=e.getBounds(),{lineWidth:i,lineColor:r,lineAlpha:s,handleSize:o,handleColor:a,padding:l}=this.style;this.graphics.lineStyle(i,r,s),this.graphics.strokeRect(n.x-l,n.y-l,n.width+l*2,n.height+l*2),this.graphics.fillStyle(a,1),this.graphics.fillCircle(n.x,n.y,o),this.graphics.fillCircle(n.x+n.width,n.y,o),this.graphics.fillCircle(n.x,n.y+n.height,o),this.graphics.fillCircle(n.x+n.width,n.y+n.height,o)}clearVisuals(){this.graphics.clear(),this.selectedId=null}setupBackgroundDeselect(e){this.scene.input.on("pointerdown",n=>{if(e())return;this.scene.input.hitTestPointer(n).find(r=>r.type==="Sprite"&&r.getData("itemId"))||(Kn(),this.clearVisuals())})}destroy(){this.graphics?.destroy()}}class rn{scene;items=new Map;isBuilderMode=!1;renderer;dragController;selectionManager;constructor(e,n,i=!1){this.scene=e,this.isBuilderMode=i,this.renderer=new hi(e,n),this.isBuilderMode&&(this.dragController=new So(e,n,{onDrag:()=>this.updateSelectionVisuals()}),this.selectionManager=new Eo(e))}static preloadAssets(e){hi.preloadAssets(e)}createItems(e){e.forEach(n=>{this.createItem(n)})}createItem(e){const n=this.renderer.createSprite(e);this.items.set(e.id,{sprite:n,data:e}),this.isBuilderMode&&this.dragController&&(this.dragController.makeInteractive(n,e.id),n.on("pointerdown",()=>{this.dragController?.getIsDragging()||(nn(e.id),this.updateSelectionVisuals())}))}updateSelectionVisuals(){if(!this.selectionManager)return;const e=this.scene.data.get("selectedItemId");if(this.selectionManager.setSelectedId(e),!e){this.selectionManager.clearVisuals();return}const n=this.items.get(e);this.selectionManager.updateVisuals(n?.sprite??null)}updateItem(e,n){const i=this.items.get(e);i&&(this.renderer.applyUpdates(i.sprite,n),i.data={...i.data,...n})}removeItem(e){const n=this.items.get(e);n&&(this.dragController&&this.dragController.removeInteractivity(n.sprite),n.sprite.destroy(),this.items.delete(e))}removeAllItems(){this.items.forEach(e=>{!e.sprite||!e.sprite.scene||(this.dragController&&this.dragController.removeInteractivity(e.sprite),e.sprite.destroy())}),this.items.clear()}getItem(e){return this.items.get(e)?.data}getAllItems(){return Array.from(this.items.values()).map(e=>e.data)}setInteractiveEnabled(e){!this.isBuilderMode||!this.dragController||(this.items.forEach(({sprite:n,data:i})=>{e?(this.dragController.makeInteractive(n,i.id),n.setAlpha(1),n.on("pointerdown",()=>{this.dragController?.getIsDragging()||(nn(i.id),this.updateSelectionVisuals())})):(n.disableInteractive(),n.off("pointerdown"),n.setAlpha(.6))}),!e&&this.selectionManager&&this.selectionManager.clearVisuals())}destroy(){this.removeAllItems(),this.selectionManager?.destroy()}setupBackgroundDeselect(){!this.isBuilderMode||!this.selectionManager||this.selectionManager.setupBackgroundDeselect(()=>this.dragController?.getIsDragging()??!1)}}async function fi(){const t=await fetch("./config/map.json");if(!t.ok)throw new Error(`Failed to load map config: ${t.status}`);const e=await t.json();if(!e.worldWidth||!e.worldHeight)throw new Error("Invalid map config structure");return e}const Kt={generateId(){return`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`},create(t){const{assetKey:e,x:n,yOffset:i=0,depthLayer:r="behind",scale:s}=t;return{id:Kt.generateId(),assetKey:e,x:Math.round(n),y:0,scale:s??bo(e),depth:ur(r),yOffset:Math.round(i)}},createAtWorldPosition(t,e,n,i,r="behind"){return Kt.create({assetKey:t,x:e,yOffset:n-i,depthLayer:r})},clone(t,e=50){return{...t,id:Kt.generateId(),x:t.x+e}}},Je={HEIGHT:40,VISUAL:{COLOR:9139029,ALPHA:.3},PHYSICS:{COLOR:0,ALPHA:0}},Pt={getGroundY(t,e=Je.HEIGHT){return t-e},createVisualGround(t,e){const n=e.height??Je.HEIGHT,i=Pt.getGroundY(e.worldHeight,n),r=t.add.rectangle(0,i,e.worldWidth,n,e.color??Je.VISUAL.COLOR,e.alpha??Je.VISUAL.ALPHA);return r.setOrigin(0,0),r.setDepth(e.depth??Me.GROUND_REFERENCE),{ground:r,groundY:i}},createPhysicsGround(t,e){const n=e.height??Je.HEIGHT,i=Pt.getGroundY(e.worldHeight,n),r=t.add.rectangle(0,i,e.worldWidth,n,e.color??Je.PHYSICS.COLOR,e.alpha??Je.PHYSICS.ALPHA);return r.setOrigin(0,0),t.physics.add.existing(r,!0),{ground:r,groundY:i}},addPlayerCollision(t,e,n){return t.physics.add.collider(e,n)}},Ce={GAME:"GameScene",BUILDER:"BuilderScene"};class xo extends D.Scene{player;mapConfig;parallaxLayers=null;loadedBackgrounds=new Set;itemManager;dialogZones=[];currentDialogZone=null;unsubscribers=[];initData;constructor(){super({key:Ce.GAME})}init(e){this.initData=e}preload(){Se.forEach(e=>{this.load.spritesheet(`cat-idle-${e}`,`assets/sprites/${e}/Idle.png`,{frameWidth:48,frameHeight:48}),this.load.spritesheet(`cat-walk-${e}`,`assets/sprites/${e}/Walk.png`,{frameWidth:48,frameHeight:48})}),rn.preloadAssets(this)}create(){this.initializeScene()}async initializeScene(){Tn.set(!0);try{await this.loadMapConfiguration();const e=tn.getCurrentConfig();await this.loadBackgroundIfNeeded(e),this.createParallaxBackground();const{ground:n,groundY:i}=Pt.createPhysicsGround(this,{worldWidth:this.mapConfig.worldWidth,worldHeight:this.mapConfig.worldHeight});this.player=new io(this,this.mapConfig.playerStartX,this.mapConfig.playerStartY),Pt.addPlayerCollision(this,this.player,n),this.itemManager=new rn(this,i,!1),this.mapConfig.placedItems&&this.mapConfig.placedItems.length>0&&this.itemManager.createItems(this.mapConfig.placedItems),this.dialogZones=this.mapConfig.dialogZones||[],this.cameras.main.startFollow(this.player,!0,.1,.1),this.cameras.main.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.physics.world.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.scale.on("resize",this.handleResize,this)}catch(e){console.error("[GameScene] Failed to initialize scene:",e)}finally{Tn.set(!1)}}async loadMapConfiguration(){try{if(this.initData?.useBuilderConfig){const e=po();this.mapConfig=e||await fi()}else this.mapConfig=await fi()}catch(e){console.error("[GameScene] Failed to load map configuration:",e),this.mapConfig={worldWidth:3200,worldHeight:600,playerStartX:400,playerStartY:300,placedItems:[]}}}createParallaxBackground(){const e=tn.getCurrentConfig();this.parallaxLayers=fr(this,this.mapConfig.worldWidth,this.mapConfig.worldHeight,e)}async loadBackgroundIfNeeded(e){if(this.loadedBackgrounds.has(e.folder))return!0;const n=await hr(this,e);return n&&this.loadedBackgrounds.add(e.folder),n}handleResize(e){if(!(!this.cameras?.main||!this.mapConfig)&&(this.cameras.main.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.parallaxLayers?.baseLayer)){const n=Math.max(this.mapConfig.worldHeight,e.height);this.parallaxLayers.baseLayer.setSize(this.mapConfig.worldWidth,n)}}shutdown(){this.scale.off("resize",this.handleResize,this),ai(null),this.currentDialogZone=null,this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.itemManager&&this.itemManager.destroy()}update(){this.player&&(this.player.update(),this.checkDialogZones(),this.parallaxLayers&&gr(this.parallaxLayers.baseLayer,this.cameras.main))}checkDialogZones(){const e=this.player.x;let n=null;for(const i of this.dialogZones)if(e>=i.x&&e<=i.x+i.width){n=i;break}n?.id!==this.currentDialogZone?.id&&(this.currentDialogZone=n,ai(n))}}function Ft(){const t=document.activeElement;if(!t)return!1;const e=t.tagName.toUpperCase();return e==="INPUT"||e==="TEXTAREA"||t.getAttribute("contenteditable")==="true"}const Do=.3,Ao=1,Xt=400;class Co{scene;camera;worldWidth;worldHeight;isPanning=!1;panStartX=0;cameraDragStartX=0;isDraggingToScroll=!1;dragScrollStartX=0;dragScrollStartY=0;dragScrollCameraStartX=0;dragScrollCameraStartY=0;isZoomedOut=!1;isAnimating=!1;savedScrollX=0;savedScrollY=0;constructor(e,n,i){this.scene=e,this.camera=e.cameras.main,this.worldWidth=n,this.worldHeight=i}setup(){this.setupCamera(),this.setupMouseControls(),this.setupKeyboardControls()}setupCamera(){this.camera.setBounds(0,0,this.worldWidth,this.worldHeight),this.camera.setZoom(1)}centerOn(e,n){this.camera.centerOn(e,n)}setupMouseControls(){this.scene.input.on("wheel",(e,n,i,r)=>{if(this.isZoomedOut)return;const s=i!==0?i:r,o=this.camera.scrollX+s;this.camera.setScroll(D.Math.Clamp(o,0,this.worldWidth-this.camera.width),this.camera.scrollY)}),this.scene.input.on("pointerdown",e=>{this.isZoomedOut||(e.rightButtonDown()||e.middleButtonDown()?(this.isPanning=!0,this.panStartX=e.x,this.cameraDragStartX=this.camera.scrollX):e.leftButtonDown()&&!this.isDraggingObject()&&(this.scene.data.get("isDraggingItem")===!0||(this.dragScrollStartX=e.x,this.dragScrollStartY=e.y,this.dragScrollCameraStartX=this.camera.scrollX,this.dragScrollCameraStartY=this.camera.scrollY)))}),this.scene.input.on("pointermove",e=>{if(!this.isZoomedOut){if(this.isPanning){const n=e.x-this.panStartX,i=this.cameraDragStartX-n;this.camera.setScroll(D.Math.Clamp(i,0,this.worldWidth-this.camera.width),this.camera.scrollY)}else if(e.leftButtonDown()&&!this.isDraggingToScroll&&!this.isDraggingObject()&&!(this.scene.data.get("isDraggingItem")===!0)){const i=Math.abs(e.x-this.dragScrollStartX),r=Math.abs(e.y-this.dragScrollStartY);Math.sqrt(i*i+r*r)>10&&(this.isDraggingToScroll=!0,this.scene.input.setDefaultCursor("grabbing"))}if(this.isDraggingToScroll){const n=e.x-this.dragScrollStartX,i=e.y-this.dragScrollStartY,r=this.dragScrollCameraStartX-n,s=this.dragScrollCameraStartY-i;this.camera.setScroll(D.Math.Clamp(r,0,this.worldWidth-this.camera.width),D.Math.Clamp(s,0,this.worldHeight-this.camera.height))}}}),this.scene.input.on("pointerup",e=>{!e.rightButtonDown()&&!e.middleButtonDown()&&(this.isPanning=!1),this.isDraggingToScroll&&(this.isDraggingToScroll=!1,this.scene.input.setDefaultCursor("default"))})}setupKeyboardControls(){const e={up:this.scene.input.keyboard.addKey(D.Input.Keyboard.KeyCodes.UP,!1),down:this.scene.input.keyboard.addKey(D.Input.Keyboard.KeyCodes.DOWN,!1),left:this.scene.input.keyboard.addKey(D.Input.Keyboard.KeyCodes.LEFT,!1),right:this.scene.input.keyboard.addKey(D.Input.Keyboard.KeyCodes.RIGHT,!1)},n={w:this.scene.input.keyboard.addKey(D.Input.Keyboard.KeyCodes.W,!1),a:this.scene.input.keyboard.addKey(D.Input.Keyboard.KeyCodes.A,!1),s:this.scene.input.keyboard.addKey(D.Input.Keyboard.KeyCodes.S,!1),d:this.scene.input.keyboard.addKey(D.Input.Keyboard.KeyCodes.D,!1)};this.scene.input.keyboard.addKey(D.Input.Keyboard.KeyCodes.SPACE,!1).on("down",()=>{Ft()||this.isZoomedOut||this.centerOnPlayer()}),this.scene.input.keyboard.addKey(D.Input.Keyboard.KeyCodes.F,!1).on("down",()=>{Ft()||this.toggleZoomToFit()}),this.scene.events.on("update",()=>{if(this.isZoomedOut||Ft())return;const s=10;e.left.isDown||n.a.isDown?this.camera.scrollX=Math.max(0,this.camera.scrollX-s):(e.right.isDown||n.d.isDown)&&(this.camera.scrollX=Math.min(this.worldWidth-this.camera.width,this.camera.scrollX+s)),e.up.isDown||n.w.isDown?this.camera.scrollY=Math.max(0,this.camera.scrollY-s):(e.down.isDown||n.s.isDown)&&(this.camera.scrollY=Math.min(this.worldHeight-this.camera.height,this.camera.scrollY+s))})}centerOnPlayer(){const e=this.scene.data.get("playerSprite");e&&this.camera.centerOn(e.x,e.y)}isDraggingObject(){return this.scene.data.get("isDraggingObject")===!0}getIsZoomedOut(){return this.isZoomedOut}toggleZoomToFit(){this.isZoomedOut?this.resetZoom():this.zoomToFit()}zoomToFit(){if(this.isZoomedOut||this.isAnimating)return;this.savedScrollX=this.camera.scrollX,this.savedScrollY=this.camera.scrollY,this.isZoomedOut=!0,this.isAnimating=!0,ui(!0);const e=this.camera.width/this.worldWidth,n=this.camera.height/this.worldHeight;let i=Math.min(e,n);i=Math.max(i,Do);const r=this.worldWidth/2,s=this.worldHeight/2;this.camera.removeBounds(),this.camera.pan(r,s,Xt,"Sine.easeInOut"),this.camera.zoomTo(i,Xt,"Sine.easeInOut",!1,(o,a)=>{a===1&&(this.isAnimating=!1)})}resetZoom(){if(!this.isZoomedOut||this.isAnimating)return;this.isZoomedOut=!1,this.isAnimating=!0,ui(!1);const e=this.savedScrollX+this.camera.width/2,n=this.savedScrollY+this.camera.height/2;this.camera.pan(e,n,Xt,"Sine.easeInOut"),this.camera.zoomTo(Ao,Xt,"Sine.easeInOut",!1,(i,r)=>{r===1&&(this.camera.setBounds(0,0,this.worldWidth,this.worldHeight),this.isAnimating=!1)})}destroy(){}}const sn=40,To=48,gi=5,ko=Me.PLAYER,pi=100,Mo=4871528,Oo=.4,Lo=1,Sr=Me.GRID_OVERLAY,vn=16711680,Po=2,Ro=.6,No=.1,Ho=1,$o=.2,vi=50,Zo=50,Bo=10,Yo=4886754;class Xo{scene;player;worldWidth;worldHeight;groundY;unsubscribers=[];constructor(e,n,i){this.scene=e,this.worldWidth=n,this.worldHeight=i,this.groundY=i-sn}create(e,n){this.player=this.scene.add.sprite(e,n,"cat-idle-white",0),this.player.setScale(gi),this.player.setDepth(ko);const i=new D.Geom.Rectangle(8,4,32,40);return this.player.setInteractive({hitArea:i,hitAreaCallback:D.Geom.Rectangle.Contains,draggable:!0,cursor:"grab"}),this.scene.data.set("playerSprite",this.player),this.setupDragHandlers(),this.setupEditModeSubscription(),this.player}setupEditModeSubscription(){const e=hn.subscribe(n=>{if(n==="dialogs")this.player.disableInteractive(),this.player.setAlpha(.6);else{const i=new D.Geom.Rectangle(8,4,32,40);this.player.setInteractive({hitArea:i,hitAreaCallback:D.Geom.Rectangle.Contains,draggable:!0,cursor:"grab"}),this.player.setAlpha(1)}});this.unsubscribers.push(e)}setupDragHandlers(){this.player.on("dragstart",()=>{this.player.setTint(Yo),this.scene.data.set("isDraggingObject",!0)}),this.player.on("drag",(e,n,i)=>{const r=D.Math.Clamp(n,vi,this.worldWidth-vi),s=D.Math.Clamp(i,Zo,this.worldHeight-Bo);this.player.setPosition(r,s),ci(Math.round(r),Math.round(s))}),this.player.on("dragend",()=>{this.player.clearTint(),this.scene.data.set("isDraggingObject",!1);let e=this.player.y;const n=To*gi;this.player.y+n/2>this.groundY&&(e=this.groundY-n/2,this.player.setY(e)),ci(Math.round(this.player.x),Math.round(e))})}getSprite(){return this.player}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.player&&this.player.destroy()}}class Wo{scene;graphics;worldWidth;worldHeight;constructor(e,n,i){this.scene=e,this.worldWidth=n,this.worldHeight=i}create(){return this.graphics=this.scene.add.graphics(),this.graphics.setDepth(Sr),this.draw(),this.graphics}draw(){this.graphics.clear(),this.graphics.lineStyle(Lo,Mo,Oo);const e=Math.max(this.worldHeight,this.scene.scale.height);for(let i=0;i<=this.worldWidth;i+=pi)this.graphics.beginPath(),this.graphics.moveTo(i,0),this.graphics.lineTo(i,e),this.graphics.strokePath();for(let i=0;i<=e;i+=pi)this.graphics.beginPath(),this.graphics.moveTo(0,i),this.graphics.lineTo(this.worldWidth,i),this.graphics.strokePath();const n=this.worldHeight-sn;this.graphics.lineStyle(Po,vn,Ro),this.graphics.beginPath(),this.graphics.moveTo(0,n),this.graphics.lineTo(this.worldWidth,n),this.graphics.strokePath(),this.graphics.lineStyle(Ho,vn,$o),this.graphics.fillStyle(vn,No),this.graphics.fillRect(0,n,this.worldWidth,e-n)}getGraphics(){return this.graphics}redraw(){this.draw()}destroy(){this.graphics&&this.graphics.destroy()}}class Go{listeners=new Map;on(e,n){this.listeners.has(e)||this.listeners.set(e,new Set);const i=this.listeners.get(e);return i.add(n),{unsubscribe:()=>{i.delete(n),i.size===0&&this.listeners.delete(e)}}}once(e,n){const i=this.on(e,r=>{i.unsubscribe(),n(r)});return i}emit(e,n){const i=this.listeners.get(e);i&&i.forEach(r=>{try{r(n)}catch(s){console.error(`[EventBus] Error in listener for "${e}":`,s)}})}off(e){this.listeners.delete(e)}clear(){this.listeners.clear()}listenerCount(e){return this.listeners.get(e)?.size??0}}const rt=new Go,st={ASSET_DROPPED:"asset:dropped",MINIMAP_NAVIGATE:"minimap:navigate",DIALOG_ZONE_CREATE:"dialogZone:create"};class Ko{scene;groundY;itemManager;unsubscribers=[];constructor(e,n){this.scene=e,this.groundY=n}create(e){return this.itemManager=new rn(this.scene,this.groundY,!0),e&&e.length>0&&this.itemManager.createItems(e),this.setupBackgroundDeselect(),this.setupStoreSubscriptions(),this.setupAssetDropListener(),this.setupDeleteKeys(),this.itemManager}setupBackgroundDeselect(){this.itemManager.setupBackgroundDeselect()}setupStoreSubscriptions(){const e=pr.subscribe(s=>{this.scene.data.set("selectedItemId",s),this.itemManager.updateSelectionVisuals()});this.unsubscribers.push(e);const n=hn.subscribe(s=>{s==="dialogs"?(Kn(),this.itemManager.setInteractiveEnabled(!1)):this.itemManager.setInteractiveEnabled(!0)});this.unsubscribers.push(n);let i=[];const r=lo.subscribe(s=>{if(!s?.placedItems)return;const o=s.placedItems;i.forEach(a=>{o.find(c=>c.id===a.id)||this.itemManager.removeItem(a.id)}),o.forEach(a=>{const l=i.find(c=>c.id===a.id);l&&JSON.stringify(l)!==JSON.stringify(a)&&this.itemManager.updateItem(a.id,a)}),i=o.map(a=>({...a}))});this.unsubscribers.push(r)}setupAssetDropListener(){const e=rt.on(st.ASSET_DROPPED,n=>{const{assetKey:i,canvasX:r,canvasY:s}=n,a=this.scene.cameras.main.getWorldPoint(r,s),l=a.x,c=a.y;let u="behind";vr.subscribe(g=>{u=g})();const h=Kt.createAtWorldPosition(i,l,c,this.groundY,u);co(h),this.itemManager.createItem(h),nn(h.id)});this.unsubscribers.push(()=>e.unsubscribe())}setupDeleteKeys(){const e=this.scene.input.keyboard.addKey(D.Input.Keyboard.KeyCodes.DELETE,!1),n=this.scene.input.keyboard.addKey(D.Input.Keyboard.KeyCodes.BACKSPACE,!1),i=()=>{if(Ft())return;const r=this.scene.data.get("selectedItemId");r&&wr(r)};e.on("down",i),n.on("down",i)}getManager(){return this.itemManager}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.itemManager&&this.itemManager.destroy()}}const Wt=Sr-1,Re=50,mi=150,Fo=.3,zo=.5,mn=16,_i=16777215,yi=.6,wi=0;class Uo{scene;worldWidth;worldHeight;graphics=null;zoneAreas=new Map;leftHandles=new Map;rightHandles=new Map;dragging=null;unsubscribers=[];createZoneSubscription;currentEditMode="items";currentZones=[];currentSelectedId=null;constructor(e,n,i){this.scene=e,this.worldWidth=n,this.worldHeight=i}create(){this.graphics=this.scene.add.graphics(),this.graphics.setDepth(Wt);const e=hn.subscribe(r=>{this.currentEditMode=r,this.render()});this.unsubscribers.push(e);const n=_r.subscribe(r=>{this.currentZones=r,this.render()});this.unsubscribers.push(n);const i=mr.subscribe(r=>{this.currentSelectedId=r,this.render()});this.unsubscribers.push(i),this.scene.input.on("pointermove",this.handlePointerMove,this),this.scene.input.on("pointerup",this.handlePointerUp,this),this.scene.input.on("pointerdown",this.handlePointerDown,this),this.createZoneSubscription=rt.on(st.DIALOG_ZONE_CREATE,()=>{this.createNewZone()}),this.render()}clearVisuals(){this.graphics&&this.graphics.clear(),this.zoneAreas.forEach(e=>e.destroy()),this.zoneAreas.clear(),this.leftHandles.forEach(e=>e.destroy()),this.leftHandles.clear(),this.rightHandles.forEach(e=>e.destroy()),this.rightHandles.clear()}render(){if(this.clearVisuals(),this.currentEditMode==="dialogs")for(const e of this.currentZones)this.renderZone(e,e.id===this.currentSelectedId)}renderZone(e,n){if(!this.graphics)return;const i=D.Display.Color.HexStringToColor(e.color).color,r=n?zo:Fo;this.graphics.fillStyle(i,r),this.graphics.fillRect(e.x,0,e.width,this.worldHeight),this.graphics.lineStyle(2,i,.8),this.graphics.strokeRect(e.x,0,e.width,this.worldHeight);const s=this.scene.add.rectangle(e.x+e.width/2,this.worldHeight/2,e.width-mn*2,this.worldHeight);s.setOrigin(.5,.5),s.setInteractive({cursor:n?"grab":"pointer"}),s.setDepth(Wt+.1),s.setAlpha(.001),s.setData("zoneId",e.id),s.on("pointerdown",o=>{this.scene.data.set("isDraggingItem",!0),this.currentSelectedId===e.id?this.startDrag(e.id,"move",o.worldX):(Gt(e.id),this.scene.data.set("isDraggingItem",!1))}),this.zoneAreas.set(e.id,s),n&&this.createHandles(e)}createHandles(e){const n=this.scene.add.rectangle(e.x,this.worldHeight/2,mn,this.worldHeight);n.setOrigin(.5,.5),n.setInteractive({cursor:"ew-resize"}),n.setDepth(Wt+.2),n.setFillStyle(_i,yi),n.setData("zoneId",e.id),n.setData("type","left"),n.on("pointerdown",r=>{this.startDrag(e.id,"left",r.worldX)}),this.leftHandles.set(e.id,n);const i=this.scene.add.rectangle(e.x+e.width,this.worldHeight/2,mn,this.worldHeight);i.setOrigin(.5,.5),i.setInteractive({cursor:"ew-resize"}),i.setDepth(Wt+.2),i.setFillStyle(_i,yi),i.setData("zoneId",e.id),i.setData("type","right"),i.on("pointerdown",r=>{this.startDrag(e.id,"right",r.worldX)}),this.rightHandles.set(e.id,i)}startDrag(e,n,i){const r=this.currentZones.find(s=>s.id===e);r&&(this.scene.data.set("isDraggingItem",!0),this.dragging={zoneId:e,type:n,startX:i,originalX:r.x,originalWidth:r.width})}getZoneBounds(e){let n=0,i=this.worldWidth;for(const r of this.currentZones){if(r.id===e)continue;const s=r.x+r.width,o=this.currentZones.find(a=>a.id===e);o&&(s<=o.x+o.width/2&&(n=Math.max(n,s+wi)),r.x>=o.x+o.width/2&&(i=Math.min(i,r.x-wi)))}return{minX:n,maxX:i-Re,maxRight:i}}wouldOverlap(e,n,i){const r=n+i;for(const s of this.currentZones){if(s.id===e)continue;const o=s.x,a=s.x+s.width;if(n<a&&r>o)return!0}return!1}handlePointerMove(e){if(!this.dragging)return;e.event?.stopPropagation?.();const n=e.worldX-this.dragging.startX,i=this.currentZones.find(s=>s.id===this.dragging?.zoneId);if(!i)return;const r=this.getZoneBounds(i.id);if(this.dragging.type==="left"){let s=this.dragging.originalX+n,o=this.dragging.originalWidth-n;if(s<0&&(o+=s,s=0),o<Re&&(s=this.dragging.originalX+this.dragging.originalWidth-Re,o=Re),s<r.minX){const a=r.minX-s;s=r.minX,o-=a}o>=Re&&!this.wouldOverlap(i.id,s,o)&&At(i.id,{x:s,width:o})}else if(this.dragging.type==="right"){let s=this.dragging.originalWidth+n;s<Re&&(s=Re),i.x+s>this.worldWidth&&(s=this.worldWidth-i.x),i.x+s>r.maxRight&&(s=r.maxRight-i.x),s>=Re&&!this.wouldOverlap(i.id,i.x,s)&&At(i.id,{width:s})}else if(this.dragging.type==="move"){let s=this.dragging.originalX+n;const o=i.width;if(s<0&&(s=0),s+o>this.worldWidth&&(s=this.worldWidth-o),!this.wouldOverlap(i.id,s,o))At(i.id,{x:s});else{const a=this.findNonOverlappingPosition(i.id,s,o);a!==null&&At(i.id,{x:a})}}}findNonOverlappingPosition(e,n,i){const r=this.currentZones.filter(u=>u.id!==e).sort((u,f)=>u.x-f.x);if(r.length===0)return Math.max(0,Math.min(n,this.worldWidth-i));let s=n,o=1/0;const a=r[0];if(a.x>=i){const u=a.x-i,f=Math.max(0,Math.min(n,u)),h=Math.abs(f-n);h<o&&(o=h,s=f)}for(let u=0;u<r.length-1;u++){const f=r[u],h=r[u+1],g=f.x+f.width,p=h.x;if(p-g>=i){const A=g,L=p-i,C=Math.max(A,Math.min(n,L)),m=Math.abs(C-n);m<o&&(o=m,s=C)}}const l=r[r.length-1],c=l.x+l.width;if(this.worldWidth-c>=i){const u=c,f=this.worldWidth-i,h=Math.max(u,Math.min(n,f)),g=Math.abs(h-n);g<o&&(o=g,s=h)}return o<1/0&&!this.wouldOverlap(e,s,i)?s:null}handlePointerUp(){this.dragging&&this.scene.data.set("isDraggingItem",!1),this.dragging=null}handlePointerDown(e){if(this.currentEditMode!=="dialogs"||this.dragging)return;const n=e.downElement;if(n&&n.tagName?.toUpperCase()!=="CANVAS")return;const i=e.worldX;for(const r of this.currentZones)if(i>=r.x&&i<=r.x+r.width)return;this.currentSelectedId&&Gt(null)}createNewZone(){const e=this.scene.cameras.main;let i=e.scrollX+e.width/2-mi/2;const r=mi;if(i=Math.max(0,Math.min(this.worldWidth-r,i)),this.wouldOverlap("",i,r)){const o=this.findNonOverlappingPosition("",i,r);if(o===null){console.warn("No room for a new dialog zone");return}i=o}const s=Us(i,r);s.x=i,_o(s),Gt(s.id)}destroy(){for(const e of this.unsubscribers)e();this.unsubscribers=[],this.createZoneSubscription&&this.createZoneSubscription.unsubscribe(),this.scene.input.off("pointerdown",this.handlePointerDown,this),this.scene.input.off("pointermove",this.handlePointerMove,this),this.scene.input.off("pointerup",this.handlePointerUp,this),this.clearVisuals(),this.graphics&&(this.graphics.destroy(),this.graphics=null),this.dragging=null}}class Vo extends D.Scene{parallaxLayers=null;cameraController;playerController;gridOverlay;itemsController;dialogZoneRenderer;config;minimapSubscription;isShuttingDown=!1;get itemManager(){return this.itemsController?.getManager()}toggleZoom(){this.cameraController?.toggleZoomToFit()}constructor(){super({key:Ce.BUILDER})}init(e){this.config=e.config}preload(){this.load.spritesheet("cat-idle-white","assets/sprites/white/Idle.png",{frameWidth:48,frameHeight:48}),rn.preloadAssets(this)}create(){this.isShuttingDown=!1,this.physics.world.setBounds(0,0,this.config.worldWidth,this.config.worldHeight);const e=this.config.worldHeight-sn;this.cameraController=new Co(this,this.config.worldWidth,this.config.worldHeight),this.playerController=new Xo(this,this.config.worldWidth,this.config.worldHeight),this.gridOverlay=new Wo(this,this.config.worldWidth,this.config.worldHeight),this.itemsController=new Ko(this,e),this.dialogZoneRenderer=new Uo(this,this.config.worldWidth,this.config.worldHeight),this.createBackground(),this.gridOverlay.create(),this.createGroundReference(),this.playerController.create(this.config.playerStartX,this.config.playerStartY),this.itemsController.create(this.config.placedItems||[]),this.dialogZoneRenderer.create(),this.cameraController.setup(),this.cameraController.centerOn(this.config.playerStartX,this.config.playerStartY),this.minimapSubscription=rt.on(st.MINIMAP_NAVIGATE,n=>{this.navigateToPosition(n.worldX,n.worldY)}),this.scale.on("resize",this.handleResize,this),this.events.on("shutdown",this.shutdown,this)}async createBackground(){const e=tn.getCurrentConfig();try{await hr(this,e)}catch(n){console.error("Failed to load background:",n);return}this.parallaxLayers&&(so(this.parallaxLayers),this.parallaxLayers=null),this.parallaxLayers=fr(this,this.config.worldWidth,this.config.worldHeight,e)}createGroundReference(){Pt.createVisualGround(this,{worldWidth:this.config.worldWidth,worldHeight:this.config.worldHeight,height:sn})}update(){this.parallaxLayers&&gr(this.parallaxLayers.baseLayer,this.cameras.main);const e=this.cameras.main,n=this.data.get("playerSprite");vo({scrollX:e.scrollX,scrollY:e.scrollY,viewWidth:e.width,viewHeight:e.height,worldWidth:this.config.worldWidth,worldHeight:this.config.worldHeight,zoom:e.zoom,playerX:n?.x??this.config.playerStartX,playerY:n?.y??this.config.playerStartY})}navigateToPosition(e,n){this.cameraController.getIsZoomedOut()||this.cameraController.centerOn(e,n)}handleResize(e){if(!(!this.cameras?.main||!this.config)){if(this.cameraController?.getIsZoomedOut()||this.cameras.main.setBounds(0,0,this.config.worldWidth,this.config.worldHeight),this.parallaxLayers?.baseLayer){const n=Math.max(this.config.worldHeight,e.height);this.parallaxLayers.baseLayer.setSize(this.config.worldWidth,n)}this.gridOverlay&&this.gridOverlay.redraw()}}shutdown(){this.isShuttingDown||(this.isShuttingDown=!0,this.scale.off("resize",this.handleResize,this),this.minimapSubscription&&this.minimapSubscription.unsubscribe(),this.cameraController&&this.cameraController.destroy(),this.playerController&&this.playerController.destroy(),this.gridOverlay&&this.gridOverlay.destroy(),this.itemsController&&this.itemsController.destroy(),this.dialogZoneRenderer&&this.dialogZoneRenderer.destroy())}}const qo="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(qo);Ur();class jo{currentLanguage="cs";setLanguage(e){this.currentLanguage=e,localStorage.setItem("language",e)}getLanguage(){const e=localStorage.getItem("language");return(e==="cs"||e==="en")&&(this.currentLanguage=e),this.currentLanguage}toggleLanguage(){return this.currentLanguage=this.currentLanguage==="cs"?"en":"cs",this.setLanguage(this.currentLanguage),this.currentLanguage}}const Ir=new jo;let ce=null;function Jo(t){ce=t}function Qo(){if(!ce)return console.error("Scene manager not initialized"),null;try{return ce.scene.getScene(Ce.GAME)?.mapConfig||null}catch(t){return console.error("Failed to get map config:",t),null}}function ea(t){if(!ce)return console.error("Scene manager not initialized"),!1;try{return ce.scene.getScene(Ce.GAME)?(ce.scene.stop(Ce.GAME),fo(t),ce.scene.start(Ce.BUILDER,{config:t}),!0):(console.error("GameScene not found"),!1)}catch(e){return console.error("Failed to switch to builder:",e),!1}}function ta(){if(!ce)return console.error("Scene manager not initialized"),!1;try{return ce.scene.stop(Ce.BUILDER),go(),ce.scene.start(Ce.GAME,{useBuilderConfig:!0}),!0}catch(t){return console.error("Failed to switch to game:",t),!1}}function na(){if(ce)try{ce.scene.getScene(Ce.BUILDER)?.toggleZoom()}catch(t){console.error("Failed to toggle zoom:",t)}}var ia=B("<button><!></button>");function ve(t,e){let n=Ee(e,"position",3,"inline"),i=Ee(e,"variant",3,"default"),r=Ee(e,"disabled",3,!1),s=Ee(e,"title",3,"");const o={default:{base:"#4a90e2",hover:"#357abd",active:"#2a5f8f"},green:{base:"#27ae60",hover:"#229954",active:"#1e8449"},blue:{base:"#3498db",hover:"#2980b9",active:"#21618c"},orange:{base:"#ffa500",hover:"#ff8c00",active:"#e67e00"},red:{base:"#e74c3c",hover:"#c0392b",active:"#a02e22"}},a=xe(()=>o[i()]),l=xe(()=>e.width?`--btn-width: ${e.width};`:"");var c=ia();let u;c.__click=function(...h){e.onclick?.apply(this,h)};var f=H(c);Dn(f,()=>e.children??De),ue(()=>{u=wt(c,1,`pixel-btn pixel-btn--${n()??""}`,"svelte-lwc0vq",u,{disabled:r()}),Ye(c,`${d(l)??""} --color-base: ${d(a).base??""}; --color-hover: ${d(a).hover??""}; --color-active: ${d(a).active??""}`),c.disabled=r(),pt(c,"title",s())}),x(t,c)}Et(["click"]);var ra=B('<button class="close-btn svelte-yrmttr" title="Close">×</button>'),sa=B('<div class="panel-body svelte-yrmttr"><!></div>'),oa=B('<div><div class="panel-header svelte-yrmttr"><span class="panel-title svelte-yrmttr"> </span> <!> <div class="header-buttons svelte-yrmttr"><button class="minimize-btn svelte-yrmttr"> </button> <!></div></div> <!></div>');function Er(t,e){Xe(e,!0);let n=Ee(e,"initialRight",3,10),i=Ee(e,"initialTop",3,60),r=Ee(e,"width",3,280),s=Ee(e,"startMinimized",3,!1),o=Ee(e,"showClose",3,!1),a=G(Ne(s())),l=G(Ne({x:0,y:0})),c=G(!1),u=G(Ne({x:0,y:0})),f=G(null),h=G(!1);yt(()=>{if(typeof window>"u")return;const I=localStorage.getItem(`panel-position-${e.panelId}`);if(I)try{const j=JSON.parse(I);k(l,{x:j.x,y:j.y},!0)}catch{k(l,{x:window.innerWidth-r()-n(),y:i()},!0)}else k(l,{x:window.innerWidth-r()-n(),y:i()},!0);k(h,!0)}),yt(()=>{d(h)&&localStorage.setItem(`panel-position-${e.panelId}`,JSON.stringify(d(l)))});function g(){k(a,!d(a))}function p(){e.onclose?.()}function b(I){I.target.closest("button")||(k(c,!0),k(u,{x:I.clientX-d(l).x,y:I.clientY-d(l).y},!0),I.currentTarget.setPointerCapture(I.pointerId),I.preventDefault())}function A(I){if(!d(c))return;const j=I.clientX-d(u).x,Ke=I.clientY-d(u).y,fn=window.innerWidth-(d(f)?.offsetWidth??r()),gn=window.innerHeight-40;k(l,{x:Math.max(0,Math.min(j,fn)),y:Math.max(0,Math.min(Ke,gn))},!0)}function L(I){d(c)&&(k(c,!1),I.currentTarget.releasePointerCapture(I.pointerId))}function C(I){I.stopPropagation()}var m=oa();let E;m.__pointerdown=C,m.__click=C;var T=H(m);T.__pointerdown=b,T.__pointermove=A,T.__pointerup=L;var _=H(T),M=H(_),P=N(_,2);{var S=I=>{var j=dn(),Ke=at(j);Dn(Ke,()=>e.headerExtra),x(I,j)};z(P,I=>{e.headerExtra&&I(S)})}var v=N(P,2),w=H(v);w.__click=g;var R=H(w),y=N(w,2);{var Z=I=>{var j=ra();j.__click=p,x(I,j)};z(y,I=>{o()&&I(Z)})}var F=N(T,2);{var K=I=>{var j=sa(),Ke=H(j);Dn(Ke,()=>e.children),x(I,j)};z(F,I=>{d(a)||I(K)})}Xn(m,I=>k(f,I),()=>d(f)),ue(()=>{E=wt(m,1,"draggable-panel svelte-yrmttr",null,E,{minimized:d(a),dragging:d(c)}),Ye(m,`left: ${d(l).x??""}px; top: ${d(l).y??""}px; width: ${d(a)?"auto":`${r()}px`};`),ke(M,e.title),pt(w,"title",d(a)?"Expand":"Minimize"),ke(R,d(a)?"▲":"▼")}),Jt("pointercancel",T,L),x(t,m),We()}Et(["pointerdown","click","pointermove","pointerup"]);var aa=B('<span class="palette-hint svelte-1ahretz">Drag to place</span>'),la=B('<div draggable="true" role="button" tabindex="0"><img class="asset-preview svelte-1ahretz"/> <span class="asset-name svelte-1ahretz"> </span></div>'),ca=B('<div class="palette-content svelte-1ahretz" role="toolbar" tabindex="-1"><div class="palette-grid svelte-1ahretz"></div></div>'),ua=B("<!> <!>",1);function da(t,e){Xe(e,!0);const n=Fn;let i=G(!0),r=G(null),s=G(null);function o(){k(i,!d(i))}function a(m,E){if(!m.dataTransfer)return;k(r,E,!0),m.dataTransfer.effectAllowed="copy",m.dataTransfer.setData("assetKey",E);const _=m.target.querySelector("img")?.cloneNode(!0);_&&(_.style.position="absolute",_.style.top="-1000px",document.body.appendChild(_),m.dataTransfer.setDragImage(_,24,24),setTimeout(()=>_.remove(),0))}function l(){k(r,null)}function c(m,E){if(m.touches.length!==1)return;const T=m.touches[0];k(r,E,!0);const M=m.currentTarget.querySelector("img");if(M){const P=document.createElement("div");P.className="touch-drag-preview",P.innerHTML=`<img src="${M.src}" alt="" />`,P.style.cssText=`
        position: fixed;
        top: ${T.clientY-24}px;
        left: ${T.clientX-24}px;
        width: 48px;
        height: 48px;
        pointer-events: none;
        z-index: 10000;
        opacity: 0.9;
        image-rendering: pixelated;
        filter: drop-shadow(3px 3px 0 rgba(0, 0, 0, 0.5));
        border: 2px solid #4a90e2;
        background: rgba(26, 26, 46, 0.9);
      `,P.querySelector("img").style.cssText=`
        width: 100%;
        height: 100%;
        object-fit: contain;
        image-rendering: pixelated;
      `,document.body.appendChild(P),k(s,P,!0)}}function u(m){if(!d(r)||!d(s))return;const E=m.touches[0];d(s).style.top=`${E.clientY-24}px`,d(s).style.left=`${E.clientX-24}px`,m.preventDefault()}function f(m){if(!d(r))return;const E=m.changedTouches[0],T=document.querySelector("canvas");if(d(s)&&(d(s).remove(),k(s,null)),T){const _=T.getBoundingClientRect(),M=E.clientX,P=E.clientY;if(M>=_.left&&M<=_.right&&P>=_.top&&P<=_.bottom){const S=M-_.left,v=P-_.top;rt.emit(st.ASSET_DROPPED,{assetKey:d(r),canvasX:S,canvasY:v})}}k(r,null)}function h(m){m.stopPropagation()}function g(m){m.preventDefault(),m.dataTransfer&&(m.dataTransfer.dropEffect="copy")}function p(m){m.preventDefault();const E=m.dataTransfer?.getData("assetKey");if(!E)return;const _=m.target.getBoundingClientRect(),M=m.clientX-_.left,P=m.clientY-_.top;rt.emit(st.ASSET_DROPPED,{assetKey:E,canvasX:M,canvasY:P})}Ws(()=>{const m=document.querySelector("canvas");if(m)return m.addEventListener("dragover",g),m.addEventListener("drop",p),()=>{m.removeEventListener("dragover",g),m.removeEventListener("drop",p)}}),yt(()=>(document.addEventListener("touchmove",u,{passive:!1}),document.addEventListener("touchend",f),document.addEventListener("touchcancel",f),()=>{document.removeEventListener("touchmove",u),document.removeEventListener("touchend",f),document.removeEventListener("touchcancel",f)}));var b=ua(),A=at(b);{let m=xe(()=>d(i)?"orange":"blue");ve(A,{onclick:o,position:"top-right",get variant(){return d(m)},width:"120px",title:"Toggle Asset Palette",children:(E,T)=>{var _=pe("ASSETS");x(E,_)},$$slots:{default:!0}})}var L=N(A,2);{var C=m=>{Er(m,{panelId:"asset-palette",title:"Assets",initialRight:10,initialTop:60,width:280,headerExtra:T=>{var _=aa();x(T,_)},children:(T,_)=>{var M=ca();M.__pointerdown=h;var P=H(M);Sn(P,21,()=>n,bn,(S,v)=>{var w=la();let R;w.__touchstart=K=>c(K,d(v).key);var y=H(w),Z=N(y,2),F=H(Z);ue(()=>{R=wt(w,1,"asset-item svelte-1ahretz",null,R,{dragging:d(r)===d(v).key}),pt(w,"title",d(v).name),pt(y,"src",d(v).path),pt(y,"alt",d(v).name),ke(F,d(v).name)}),Jt("dragstart",w,K=>a(K,d(v).key)),Jt("dragend",w,l),x(S,w)}),x(T,M)},$$slots:{headerExtra:!0,default:!0}})};z(L,m=>{d(i)&&m(C)})}x(t,b),We()}Et(["pointerdown","touchstart"]);var ha=B('<div><div class="minimap-bg svelte-1ycb7lo"></div> <div class="viewport-indicator svelte-1ycb7lo"></div> <div class="player-marker svelte-1ycb7lo"></div> <div class="minimap-frame svelte-1ycb7lo"></div></div>');function fa(t,e){Xe(e,!0);const n=()=>ee(br,"$builderCameraInfo",r),i=()=>ee(Bt,"$isBuilderZoomedOut",r),[r,s]=Zt(),o=120,a=60,l=200,c=100;let u=G(!1),f=G(null),h=xe(()=>d(u)?l:o),g=xe(()=>d(u)?c:a),p=xe(()=>{const v=n();if(!v||v.worldWidth===0)return"display: none;";const w=d(h)/v.worldWidth,R=d(g)/v.worldHeight,y=v.viewWidth/v.zoom*w,Z=v.viewHeight/v.zoom*R,F=v.scrollX*w,K=v.scrollY*R;return`
      left: ${Math.max(0,F)}px;
      top: ${Math.max(0,K)}px;
      width: ${Math.min(y,d(h)-F)}px;
      height: ${Math.min(Z,d(g)-K)}px;
    `}),b=xe(()=>{const v=n();if(!v||v.worldWidth===0)return"display: none;";const w=d(h)/v.worldWidth,R=d(g)/v.worldHeight,y=v.playerX*w,Z=v.playerY*R;return`
      left: ${y}px;
      top: ${Z}px;
    `});function A(v,w){const R=n();if(!R||R.worldWidth===0||!d(f))return;const y=d(f).getBoundingClientRect(),Z=v-y.left,F=w-y.top,K=Z/d(h)*R.worldWidth,I=F/d(g)*R.worldHeight;rt.emit(st.MINIMAP_NAVIGATE,{worldX:K,worldY:I})}function L(v){v.stopPropagation(),v.preventDefault(),k(u,!0),A(v.clientX,v.clientY),window.addEventListener("mousemove",C),window.addEventListener("mouseup",m)}function C(v){d(u)&&(v.preventDefault(),A(v.clientX,v.clientY))}function m(){k(u,!1),window.removeEventListener("mousemove",C),window.removeEventListener("mouseup",m)}function E(v){v.stopPropagation(),v.preventDefault(),k(u,!0);const w=v.touches[0];A(w.clientX,w.clientY),window.addEventListener("touchmove",T,{passive:!1}),window.addEventListener("touchend",_)}function T(v){if(!d(u))return;v.preventDefault();const w=v.touches[0];A(w.clientX,w.clientY)}function _(){k(u,!1),window.removeEventListener("touchmove",T),window.removeEventListener("touchend",_)}var M=dn(),P=at(M);{var S=v=>{var w=ha();let R;w.__mousedown=L,w.__touchstart=E;var y=N(H(w),2),Z=N(y,2);Xn(w,F=>k(f,F),()=>d(f)),ue(()=>{R=wt(w,1,"minimap-container svelte-1ycb7lo",null,R,{enlarged:d(u)}),Ye(w,`width: ${d(h)??""}px; height: ${d(g)??""}px;`),Ye(y,d(p)),Ye(Z,d(b))}),x(v,w)};z(P,v=>{i()||v(S)})}x(t,M),We(),s()}Et(["mousedown","touchstart"]);var ga=B('<div class="landscape-hint svelte-ugg786"><div class="hint-content svelte-ugg786"><div class="rotate-icon svelte-ugg786">📱↻</div> <p class="hint-text svelte-ugg786">Rotate your phone for a better experience</p> <button class="dismiss-btn svelte-ugg786">OK</button></div></div>');function pa(t){let e=G(!1);function n(){k(e,!0)}var i=dn(),r=at(i);{var s=o=>{var a=ga(),l=H(a),c=N(H(l),4);c.__click=n,x(o,a)};z(r,o=>{d(e)||o(s)})}x(t,i)}Et(["click"]);var va=B("<button> </button>"),ma=B("<button></button>"),_a=B('<div class="color-picker svelte-zzlycq"></div>'),ya=B('<div class="panel-content svelte-zzlycq"><div class="language-tabs svelte-zzlycq"></div> <div class="form-section svelte-zzlycq"><div class="form-group svelte-zzlycq"><label for="dialog-title" class="svelte-zzlycq">Title</label> <input id="dialog-title" type="text" placeholder="Enter title..." class="svelte-zzlycq"/></div> <div class="form-group svelte-zzlycq"><label for="dialog-content" class="svelte-zzlycq">Content</label> <textarea id="dialog-content" placeholder="Enter dialog text..." rows="6" class="svelte-zzlycq"></textarea></div> <div class="color-section svelte-zzlycq"><span class="color-label-title svelte-zzlycq">Color</span> <button class="color-button svelte-zzlycq" title="Change zone color"><span class="zone-color svelte-zzlycq"></span> <span class="color-label svelte-zzlycq">Change</span></button> <!></div></div> <div class="panel-footer svelte-zzlycq"><!></div></div>'),wa=B("<!> <!>",1);function ba(t,e){Xe(e,!0);const n=()=>ee(_r,"$dialogZones",r),i=()=>ee(mr,"$selectedDialogZoneId",r),[r,s]=Zt(),o=[{code:"cs",label:"CZ"},{code:"en",label:"EN"}];let a=G("cs"),l=G(!1),c=xe(()=>n().find(_=>_.id===i())??null),u=xe(()=>d(c)?.texts.find(_=>_.language===d(a))??null);function f(_){const M=_.target;i()&&di(i(),d(a),{title:M.value})}function h(_){const M=_.target;i()&&di(i(),d(a),{content:M.value})}function g(){i()&&yo(i())}function p(){Gt(null)}function b(){rt.emit(st.DIALOG_ZONE_CREATE)}function A(_){i()&&(At(i(),{color:_}),k(l,!1))}function L(){k(l,!d(l))}var C=wa(),m=at(C);ve(m,{position:"stack-3",variant:"green",onclick:b,title:"Create new dialog zone at center of view",children:(_,M)=>{var P=pe("+ ZONE");x(_,P)},$$slots:{default:!0}});var E=N(m,2);{var T=_=>{Er(_,{panelId:"dialog-zone-panel",title:"Dialog Zone",initialRight:10,initialTop:160,width:280,showClose:!0,onclose:p,children:(M,P)=>{var S=ya(),v=H(S);Sn(v,21,()=>o,bn,(Fe,ze)=>{var Pe=va();let Ue;Pe.__click=()=>k(a,d(ze).code,!0);var Ve=H(Pe);ue(()=>{Ue=wt(Pe,1,"lang-tab svelte-zzlycq",null,Ue,{active:d(a)===d(ze).code}),ke(Ve,d(ze).label)}),x(Fe,Pe)});var w=N(v,2),R=H(w),y=N(H(R),2);y.__input=f;var Z=N(R,2),F=N(H(Z),2);F.__input=h;var K=N(Z,2),I=N(H(K),2);I.__click=L;var j=H(I),Ke=N(I,2);{var fn=Fe=>{var ze=_a();Sn(ze,21,()=>Cn,bn,(Pe,Ue)=>{var Ve=ma();let zn;Ve.__click=()=>A(d(Ue)),ue(()=>{zn=wt(Ve,1,"color-swatch svelte-zzlycq",null,zn,{selected:d(c).color===d(Ue)}),Ye(Ve,`background: ${d(Ue)??""}`),pt(Ve,"title",d(Ue))}),x(Pe,Ve)}),x(Fe,ze)};z(Ke,Fe=>{d(l)&&Fe(fn)})}var gn=N(w,2),Ar=H(gn);ve(Ar,{variant:"red",onclick:g,children:(Fe,ze)=>{var Pe=pe("DELETE ZONE");x(Fe,Pe)},$$slots:{default:!0}}),ue(()=>{ii(y,d(u)?.title??""),ii(F,d(u)?.content??""),Ye(j,`background: ${d(c).color??""}`)}),x(M,S)},$$slots:{default:!0}})};z(E,_=>{d(c)&&_(T)})}x(t,C),We(),s()}Et(["click","input"]);var Sa=B('<div class="item-controls svelte-1vm8op7"><!> <!></div>'),Ia=B('<!> <!> <!> <div class="top-left-buttons svelte-1vm8op7"><!> <!></div> <!> <!>',1);function Ea(t,e){Xe(e,!1);const n=()=>ee(pr,"$selectedItemId",o),i=()=>ee(vr,"$itemDepthLayer",o),r=()=>ee(hn,"$builderEditMode",o),s=()=>ee(Bt,"$isBuilderZoomedOut",o),[o,a]=Zt();function l(){ta()}function c(){na()}function u(){if(!n())return;const S=i()==="behind"?"front":"behind",v=ur(S);uo(),ho(n(),v)}function f(){n()&&(wr(n()),Kn())}function h(){mo()}Wn();var g=Ia(),p=at(g);{var b=S=>{da(S,{})},A=S=>{ba(S,{})};z(p,S=>{r()==="items"?S(b):S(A,!1)})}var L=N(p,2);fa(L,{});var C=N(L,2);pa(C);var m=N(C,2),E=H(m);ve(E,{variant:"green",width:"100px",onclick:l,children:(S,v)=>{var w=pe("SAVE");x(S,w)},$$slots:{default:!0}});var T=N(E,2);{let S=Tt(()=>s()?"orange":"blue");ve(T,{get variant(){return d(S)},width:"80px",onclick:c,title:"Toggle zoom (F)",children:(v,w)=>{var R=pe();ue(()=>ke(R,s()?"1:1":"FIT")),x(v,R)},$$slots:{default:!0}})}var _=N(m,2);{let S=Tt(()=>r()==="dialogs"?"orange":"blue");ve(_,{position:"stack-2",get variant(){return d(S)},onclick:h,title:"Toggle edit mode: items or dialog zones",children:(v,w)=>{var R=pe("DIALOGS");x(v,R)},$$slots:{default:!0}})}var M=N(_,2);{var P=S=>{var v=Sa(),w=H(v);{let y=Tt(()=>i()==="behind"?"blue":"orange");ve(w,{get variant(){return d(y)},title:"Toggle item depth: behind or in front of player",onclick:u,children:(Z,F)=>{var K=pe();ue(()=>ke(K,i()==="behind"?"Behind":"Front")),x(Z,K)},$$slots:{default:!0}})}var R=N(w,2);ve(R,{variant:"red",title:"Delete selected item",onclick:f,children:(y,Z)=>{var F=pe("DELETE");x(y,F)},$$slots:{default:!0}}),x(S,v)};z(M,S=>{r()==="items"&&n()&&S(P)})}x(t,g),We(),a()}var xa=B('<div class="dialog-title svelte-1jd14ss"> </div>'),Da=B('<div class="dialog-content svelte-1jd14ss"> </div>'),Aa=B('<div class="dialog-bubble svelte-1jd14ss"><!> <!></div>');function Ca(t,e){Xe(e,!1);const n=()=>ee(Js,"$activeDialogText",i),[i,r]=Zt();Wn();var s=dn(),o=at(s);{var a=l=>{var c=Aa();Ye(c,"max-width: 300px; max-height: 200px;");var u=H(c);{var f=p=>{var b=xa(),A=H(b);ue(()=>ke(A,n().title)),x(p,b)};z(u,p=>{n().title&&p(f)})}var h=N(u,2);{var g=p=>{var b=Da(),A=H(b);ue(()=>ke(A,n().content)),x(p,b)};z(h,p=>{n().content&&p(g)})}x(l,c)};z(o,l=>{n()&&l(a)})}x(t,s),We(),r()}var Ta=B('<div class="touch-controls"><p class="touch-text">Tap and hold<br/>where you want<br/>to move</p></div>'),ka=B('<div class="desktop-controls"><div class="key-row"><div class="pixel-key">A</div> <div class="pixel-key">W</div> <div class="pixel-key">D</div></div> <p class="or-text">or</p> <div class="key-row"><div class="pixel-key">←</div> <div class="pixel-key">↑</div> <div class="pixel-key">→</div></div></div>'),Ma=B('<div class="loader-overlay"><div class="pixel-loader"></div></div>'),Oa=B('<div class="game-ui-wrapper svelte-13dvmla"><!> <!> <!> <dialog class="pixel-dialog"><h1>CONTROLS</h1> <div class="controls-content"><!></div></dialog> <!></div>');function La(t,e){Xe(e,!1);const n=()=>ee(Dt,"$showControlsDialog",l),i=()=>ee(lr,"$hasPlayerMoved",l),r=()=>ee(ao,"$isBuilderMode",l),s=()=>ee(en,"$currentLanguage",l),o=()=>ee(ar,"$isTouchDevice",l),a=()=>ee(Tn,"$isLoading",l),[l,c]=Zt();let u=Hn();function f(){const y=Ir.toggleLanguage();en.set(y)}function h(y){!d(u)?.open||y.target.closest(".pixel-button")||Dt.set(!1)}function g(){const y=Qo();if(!y){console.error("Cannot enter builder mode: map config not found");return}ea(y)}ei(()=>(d(u),n()),()=>{d(u)&&(n()?d(u).showModal():d(u).close())}),ei(()=>(i(),d(u),Dt),()=>{i()&&d(u)?.open&&Dt.set(!1)}),As(),Wn();var p=Oa();Jt("pointerdown",ki,h);var b=H(p);{var A=y=>{Ea(y,{})},L=y=>{Ca(y,{})};z(b,y=>{r()?y(A):y(L,!1)})}var C=N(b,2);{var m=y=>{ve(y,{position:"top-left",variant:"green",width:"120px",onclick:g,title:"Toggle Builder Mode",children:(Z,F)=>{var K=pe("BUILD");x(Z,K)},$$slots:{default:!0}})};z(C,y=>{r()||y(m)})}var E=N(C,2);{var T=y=>{ve(y,{position:"top-right",variant:"default",width:"100px",onclick:f,title:"Toggle Language (L)",children:(Z,F)=>{var K=pe();ue(I=>ke(K,I),[()=>(s(),lt(()=>s().toUpperCase()))]),x(Z,K)},$$slots:{default:!0}})};z(E,y=>{r()||y(T)})}var _=N(E,2),M=N(H(_),2),P=H(M);{var S=y=>{var Z=Ta();x(y,Z)},v=y=>{var Z=ka();x(y,Z)};z(P,y=>{o()?y(S):y(v,!1)})}Xn(_,y=>k(u,y),()=>d(u));var w=N(_,2);{var R=y=>{var Z=Ma();x(y,Z)};z(w,y=>{a()&&y(R)})}x(t,p),We(),c()}const xr=document.getElementById("game-ui");if(!xr)throw new Error("game-ui element not found!");Rs(La,{target:xr});en.set(Ir.getLanguage());qs.set(dr.getSkin());js.set(tn.getCurrentConfig().name);const Pa={type:D.AUTO,width:800,height:600,parent:"game-container",backgroundColor:"#000000",pixelArt:!0,roundPixels:!0,scale:{mode:D.Scale.RESIZE,autoCenter:D.Scale.CENTER_BOTH},physics:{default:"arcade",arcade:{gravity:{y:800,x:0},debug:!1}},audio:{noAudio:!0},scene:[xo,Vo]},Dr=new D.Game(Pa);Jo(Dr);const Ra=Dr.device.input.touch;ar.set(Ra);const Na=performance.getEntriesByType("navigation")[0]&&performance.getEntriesByType("navigation")[0].type==="reload",Ha=sessionStorage.getItem("hasSeenControlsHint");(!Ha||Na)&&(sessionStorage.setItem("hasSeenControlsHint","true"),Dt.set(!0));
//# sourceMappingURL=index-B5CY-_yv.js.map
