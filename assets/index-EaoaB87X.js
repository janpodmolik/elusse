import{r as Yr,g as Wr}from"./phaser-DFK5Ua9d.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function i(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=i(r);fetch(r.href,s)}})();var Xr=Yr();const M=Wr(Xr),ki=!1;var Pn=Array.isArray,Gr=Array.prototype.indexOf,Xi=Array.from,Rn=Object.defineProperty,Zt=Object.getOwnPropertyDescriptor,Hn=Object.getOwnPropertyDescriptors,Kr=Object.prototype,zr=Array.prototype,Gi=Object.getPrototypeOf,on=Object.isExtensible;const Re=()=>{};function Fr(t){return t()}function oi(t){for(var e=0;e<t.length;e++)t[e]()}function Nn(){var t,e,i=new Promise((n,r)=>{t=n,e=r});return{promise:i,resolve:t,reject:e}}const j=2,Ki=4,_i=8,Ur=1<<24,We=16,Xe=32,ht=64,yi=128,ve=512,V=1024,se=2048,xe=4096,oe=8192,Ke=16384,zi=32768,st=65536,ln=1<<17,$n=1<<18,Tt=1<<19,Zn=1<<20,at=32768,Oi=1<<21,Fi=1<<22,ze=1<<23,bt=Symbol("$state"),Vr=Symbol(""),yt=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Bn(t){return t===this.v}function Yn(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function Wn(t){return!Yn(t,this.v)}function qr(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function jr(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Jr(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Qr(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function es(t){throw new Error("https://svelte.dev/e/effect_orphan")}function ts(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function is(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function ns(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function rs(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function ss(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}let zt=!1,as=!1;function os(){zt=!0}const ls=1,cs=2,us=16,ds=1,hs=2,J=Symbol(),fs="http://www.w3.org/1999/xhtml";let K=null;function xt(t){K=t}function qe(t,e=!1,i){K={p:K,i:!1,c:null,e:null,s:t,x:null,l:zt&&!e?{s:null,u:null,$:[]}:null}}function je(t){var e=K,i=e.e;if(i!==null){e.e=null;for(var n of i)cr(n)}return e.i=!0,K=e.p,{}}function Ft(){return!zt||K!==null&&K.l===null}let wt=[];function gs(){var t=wt;wt=[],oi(t)}function Ut(t){if(wt.length===0){var e=wt;queueMicrotask(()=>{e===wt&&gs()})}wt.push(t)}function ps(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function Pe(t){if(typeof t!="object"||t===null||bt in t)return t;const e=Gi(t);if(e!==Kr&&e!==zr)return t;var i=new Map,n=Pn(t),r=B(0),s=rt,a=o=>{if(rt===s)return o();var l=L,c=rt;ne(null),hn(s);var u=o();return ne(l),hn(c),u};return n&&i.set("length",B(t.length)),new Proxy(t,{defineProperty(o,l,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&is();var u=i.get(l);return u===void 0?u=a(()=>{var g=B(c.value);return i.set(l,g),g}):x(u,c.value,!0),!0},deleteProperty(o,l){var c=i.get(l);if(c===void 0){if(l in o){const u=a(()=>B(J));i.set(l,u),Yt(r)}}else x(c,J),Yt(r);return!0},get(o,l,c){if(l===bt)return t;var u=i.get(l),g=l in o;if(u===void 0&&(!g||Zt(o,l)?.writable)&&(u=a(()=>{var f=Pe(g?o[l]:J),p=B(f);return p}),i.set(l,u)),u!==void 0){var h=d(u);return h===J?void 0:h}return Reflect.get(o,l,c)},getOwnPropertyDescriptor(o,l){var c=Reflect.getOwnPropertyDescriptor(o,l);if(c&&"value"in c){var u=i.get(l);u&&(c.value=d(u))}else if(c===void 0){var g=i.get(l),h=g?.v;if(g!==void 0&&h!==J)return{enumerable:!0,configurable:!0,value:h,writable:!0}}return c},has(o,l){if(l===bt)return!0;var c=i.get(l),u=c!==void 0&&c.v!==J||Reflect.has(o,l);if(c!==void 0||$!==null&&(!u||Zt(o,l)?.writable)){c===void 0&&(c=a(()=>{var h=u?Pe(o[l]):J,f=B(h);return f}),i.set(l,c));var g=d(c);if(g===J)return!1}return u},set(o,l,c,u){var g=i.get(l),h=l in o;if(n&&l==="length")for(var f=c;f<g.v;f+=1){var p=i.get(f+"");p!==void 0?x(p,J):f in o&&(p=a(()=>B(J)),i.set(f+"",p))}if(g===void 0)(!h||Zt(o,l)?.writable)&&(g=a(()=>B(void 0)),x(g,Pe(c)),i.set(l,g));else{h=g.v!==J;var b=a(()=>Pe(c));x(g,b)}var D=Reflect.getOwnPropertyDescriptor(o,l);if(D?.set&&D.set.call(u,c),!h){if(n&&typeof l=="string"){var k=i.get("length"),T=Number(l);Number.isInteger(T)&&T>=k.v&&x(k,T+1)}Yt(r)}return!0},ownKeys(o){d(r);var l=Reflect.ownKeys(o).filter(g=>{var h=i.get(g);return h===void 0||h.v!==J});for(var[c,u]of i)u.v!==J&&!(c in o)&&l.push(c);return l},setPrototypeOf(){ns()}})}var cn,Xn,Gn,Kn,zn;function vs(){if(cn===void 0){cn=window,Xn=document,Gn=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,i=Text.prototype;Kn=Zt(e,"firstChild").get,zn=Zt(e,"nextSibling").get,on(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),on(i)&&(i.__t=void 0)}}function Ze(t=""){return document.createTextNode(t)}function li(t){return Kn.call(t)}function Vt(t){return zn.call(t)}function N(t,e){return li(t)}function He(t,e=!1){{var i=li(t);return i instanceof Comment&&i.data===""?Vt(i):i}}function O(t,e=1,i=!1){let n=t;for(;e--;)n=Vt(n);return n}function ms(t){t.textContent=""}function Fn(){return!1}function Un(t){var e=$;if(e===null)return L.f|=ze,t;if((e.f&zi)===0){if((e.f&yi)===0)throw t;e.b.error(t)}else Dt(t,e)}function Dt(t,e){for(;e!==null;){if((e.f&yi)!==0)try{e.b.error(t);return}catch(i){t=i}e=e.parent}throw t}const ti=new Set;let G=null,he=null,ye=[],Ui=null,Li=!1;class Se{committed=!1;current=new Map;previous=new Map;#e=new Set;#t=new Set;#n=0;#i=0;#l=null;#s=[];#r=[];skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#i>0}process(e){ye=[],this.apply();var i={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const n of e)this.#a(n,i);this.is_fork||this.#u(),this.is_deferred()?(this.#o(i.effects),this.#o(i.render_effects),this.#o(i.block_effects)):(G=null,un(i.render_effects),un(i.effects),this.#l?.resolve()),he=null}#a(e,i){e.f^=V;for(var n=e.first;n!==null;){var r=n.f,s=(r&(Xe|ht))!==0,a=s&&(r&V)!==0,o=a||(r&oe)!==0||this.skipped_effects.has(n);if((n.f&yi)!==0&&n.b?.is_pending()&&(i={parent:i,effect:n,effects:[],render_effects:[],block_effects:[]}),!o&&n.fn!==null){s?n.f^=V:(r&Ki)!==0?i.effects.push(n):kt(n)&&((n.f&We)!==0&&i.block_effects.push(n),At(n));var l=n.first;if(l!==null){n=l;continue}}var c=n.parent;for(n=n.next;n===null&&c!==null;)c===i.effect&&(this.#o(i.effects),this.#o(i.render_effects),this.#o(i.block_effects),i=i.parent),n=c.next,c=c.parent}}#o(e){for(const i of e)((i.f&se)!==0?this.#s:this.#r).push(i),this.#c(i.deps),q(i,V)}#c(e){if(e!==null)for(const i of e)(i.f&j)===0||(i.f&at)===0||(i.f^=at,this.#c(i.deps))}capture(e,i){this.previous.has(e)||this.previous.set(e,i),(e.f&ze)===0&&(this.current.set(e,e.v),he?.set(e,e.v))}activate(){G=this,this.apply()}deactivate(){G===this&&(G=null,he=null)}flush(){if(this.activate(),ye.length>0){if(_s(),G!==null&&G!==this)return}else this.#n===0&&this.process([]);this.deactivate()}discard(){for(const e of this.#t)e(this);this.#t.clear()}#u(){if(this.#i===0){for(const e of this.#e)e();this.#e.clear()}this.#n===0&&this.#d()}#d(){if(ti.size>1){this.previous.clear();var e=he,i=!0,n={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const s of ti){if(s===this){i=!1;continue}const a=[];for(const[l,c]of this.current){if(s.current.has(l))if(i&&c!==s.current.get(l))s.current.set(l,c);else continue;a.push(l)}if(a.length===0)continue;const o=[...s.current.keys()].filter(l=>!this.current.has(l));if(o.length>0){var r=ye;ye=[];const l=new Set,c=new Map;for(const u of a)Vn(u,o,l,c);if(ye.length>0){G=s,s.apply();for(const u of ye)s.#a(u,n);s.deactivate()}ye=r}}G=null,he=e}this.committed=!0,ti.delete(this)}increment(e){this.#n+=1,e&&(this.#i+=1)}decrement(e){this.#n-=1,e&&(this.#i-=1),this.revive()}revive(){for(const e of this.#s)q(e,se),ot(e);for(const e of this.#r)q(e,xe),ot(e);this.#s=[],this.#r=[],this.flush()}oncommit(e){this.#e.add(e)}ondiscard(e){this.#t.add(e)}settled(){return(this.#l??=Nn()).promise}static ensure(){if(G===null){const e=G=new Se;ti.add(G),Se.enqueue(()=>{G===e&&e.flush()})}return G}static enqueue(e){Ut(e)}apply(){}}function _s(){var t=Ue;Li=!0;var e=null;try{var i=0;for(ui(!0);ye.length>0;){var n=Se.ensure();if(i++>1e3){var r,s;ys()}n.process(ye),Fe.clear()}}finally{Li=!1,ui(t),Ui=null}}function ys(){try{ts()}catch(t){Dt(t,Ui)}}let Le=null;function un(t){var e=t.length;if(e!==0){for(var i=0;i<e;){var n=t[i++];if((n.f&(Ke|oe))===0&&kt(n)&&(Le=new Set,At(n),n.deps===null&&n.first===null&&n.nodes_start===null&&(n.teardown===null&&n.ac===null?hr(n):n.fn=null),Le?.size>0)){Fe.clear();for(const r of Le){if((r.f&(Ke|oe))!==0)continue;const s=[r];let a=r.parent;for(;a!==null;)Le.has(a)&&(Le.delete(a),s.push(a)),a=a.parent;for(let o=s.length-1;o>=0;o--){const l=s[o];(l.f&(Ke|oe))===0&&At(l)}}Le.clear()}}Le=null}}function Vn(t,e,i,n){if(!i.has(t)&&(i.add(t),t.reactions!==null))for(const r of t.reactions){const s=r.f;(s&j)!==0?Vn(r,e,i,n):(s&(Fi|We))!==0&&(s&se)===0&&qn(r,e,n)&&(q(r,se),ot(r))}}function qn(t,e,i){const n=i.get(t);if(n!==void 0)return n;if(t.deps!==null)for(const r of t.deps){if(e.includes(r))return!0;if((r.f&j)!==0&&qn(r,e,i))return i.set(r,!0),!0}return i.set(t,!1),!1}function ot(t){for(var e=Ui=t;e.parent!==null;){e=e.parent;var i=e.f;if(Li&&e===$&&(i&We)!==0&&(i&$n)===0)return;if((i&(ht|Xe))!==0){if((i&V)===0)return;e.f^=V}}ye.push(e)}function ws(t){let e=0,i=lt(0),n;return()=>{Gt()&&(d(i),bi(()=>(e===0&&(n=ft(()=>t(()=>Yt(i)))),e+=1,()=>{Ut(()=>{e-=1,e===0&&(n?.(),n=void 0,Yt(i))})})))}}var bs=st|Tt|yi;function Ss(t,e,i){new Is(t,e,i)}class Is{parent;#e=!1;#t;#n=null;#i;#l;#s;#r=null;#a=null;#o=null;#c=null;#u=null;#d=0;#h=0;#g=!1;#f=null;#y=ws(()=>(this.#f=lt(this.#d),()=>{this.#f=null}));constructor(e,i,n){this.#t=e,this.#i=i,this.#l=n,this.parent=$.b,this.#e=!!this.#i.pending,this.#s=Si(()=>{$.b=this;{var r=this.#m();try{this.#r=de(()=>n(r))}catch(s){this.error(s)}this.#h>0?this.#v():this.#e=!1}return()=>{this.#u?.remove()}},bs)}#w(){try{this.#r=de(()=>this.#l(this.#t))}catch(e){this.error(e)}this.#e=!1}#b(){const e=this.#i.pending;e&&(this.#a=de(()=>e(this.#t)),Se.enqueue(()=>{var i=this.#m();this.#r=this.#p(()=>(Se.ensure(),de(()=>this.#l(i)))),this.#h>0?this.#v():(St(this.#a,()=>{this.#a=null}),this.#e=!1)}))}#m(){var e=this.#t;return this.#e&&(this.#u=Ze(),this.#t.before(this.#u),e=this.#u),e}is_pending(){return this.#e||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!this.#i.pending}#p(e){var i=$,n=L,r=K;Ee(this.#s),ne(this.#s),xt(this.#s.ctx);try{return e()}catch(s){return Un(s),null}finally{Ee(i),ne(n),xt(r)}}#v(){const e=this.#i.pending;this.#r!==null&&(this.#c=document.createDocumentFragment(),this.#c.append(this.#u),pr(this.#r,this.#c)),this.#a===null&&(this.#a=de(()=>e(this.#t)))}#_(e){if(!this.has_pending_snippet()){this.parent&&this.parent.#_(e);return}this.#h+=e,this.#h===0&&(this.#e=!1,this.#a&&St(this.#a,()=>{this.#a=null}),this.#c&&(this.#t.before(this.#c),this.#c=null))}update_pending_count(e){this.#_(e),this.#d+=e,this.#f&&Wt(this.#f,this.#d)}get_effect_pending(){return this.#y(),d(this.#f)}error(e){var i=this.#i.onerror;let n=this.#i.failed;if(this.#g||!i&&!n)throw e;this.#r&&(re(this.#r),this.#r=null),this.#a&&(re(this.#a),this.#a=null),this.#o&&(re(this.#o),this.#o=null);var r=!1,s=!1;const a=()=>{if(r){ps();return}r=!0,s&&ss(),Se.ensure(),this.#d=0,this.#o!==null&&St(this.#o,()=>{this.#o=null}),this.#e=this.has_pending_snippet(),this.#r=this.#p(()=>(this.#g=!1,de(()=>this.#l(this.#t)))),this.#h>0?this.#v():this.#e=!1};var o=L;try{ne(null),s=!0,i?.(e,a),s=!1}catch(l){Dt(l,this.#s&&this.#s.parent)}finally{ne(o)}n&&Ut(()=>{this.#o=this.#p(()=>{Se.ensure(),this.#g=!0;try{return de(()=>{n(this.#t,()=>e,()=>a)})}catch(l){return Dt(l,this.#s.parent),null}finally{this.#g=!1}})})}}function Pi(t,e){return e}function Es(t,e,i){for(var n=[],r=e.length,s=0;s<r;s++)Qi(e[s].e,n,!0);fr(n,()=>{var a=n.length===0&&i!==null;if(a){var o=i,l=o.parentNode;ms(l),l.append(o),t.items.clear(),_e(t,e[0].prev,e[r-1].next)}for(var c=0;c<r;c++){var u=e[c];a||(t.items.delete(u.k),_e(t,u.prev,u.next)),re(u.e,!a)}t.first===e[0]&&(t.first=e[0].prev)})}function Ri(t,e,i,n,r,s=null){var a=t,o=new Map,l=null;{var c=t;a=c.appendChild(Ze())}var u=null,g=Bt(()=>{var k=i();return Pn(k)?k:k==null?[]:Xi(k)}),h,f=!0;function p(){xs(D,h,a,e,n),u!==null&&(h.length===0?(u.fragment?(a.before(u.fragment),u.fragment=null):en(u.effect),b.first=u.effect):St(u.effect,()=>{u=null}))}var b=Si(()=>{h=d(g);for(var k=h.length,T=new Set,R=G,X=null,U=Fn(),C=0;C<k;C+=1){var m=h[C],P=n(m,C),y=f?null:o.get(P);y?(Wt(y.v,m),y.i=C,U&&R.skipped_effects.delete(y.e)):(y=Ds(f?a:null,X,m,P,C,r,e,i),f&&(y.o=!0,X===null?l=y:X.next=y,X=y),o.set(P,y)),T.add(P)}if(k===0&&s&&!u)if(f)u={fragment:null,effect:de(()=>s(a))};else{var v=document.createDocumentFragment(),w=Ze();v.append(w),u={fragment:v,effect:de(()=>s(w))}}if(!f)if(U){for(const[S,_]of o)T.has(S)||R.skipped_effects.add(_.e);R.oncommit(p),R.ondiscard(()=>{})}else p();d(g)}),D={effect:b,items:o,first:l};f=!1}function xs(t,e,i,n,r){var s=e.length,a=t.items,o=t.first,l,c=null,u=[],g=[],h,f,p,b;for(b=0;b<s;b+=1){if(h=e[b],f=r(h,b),p=a.get(f),t.first??=p,!p.o){p.o=!0;var D=c?c.next:o;_e(t,c,p),_e(t,p,D),Ci(p,D,i),c=p,u=[],g=[],o=c.next;continue}if((p.e.f&oe)!==0&&en(p.e),p!==o){if(l!==void 0&&l.has(p)){if(u.length<g.length){var k=g[0],T;c=k.prev;var R=u[0],X=u[u.length-1];for(T=0;T<u.length;T+=1)Ci(u[T],k,i);for(T=0;T<g.length;T+=1)l.delete(g[T]);_e(t,R.prev,X.next),_e(t,c,R),_e(t,X,k),o=k,c=X,b-=1,u=[],g=[]}else l.delete(p),Ci(p,o,i),_e(t,p.prev,p.next),_e(t,p,c===null?t.first:c.next),_e(t,c,p),c=p;continue}for(u=[],g=[];o!==null&&o.k!==f;)(o.e.f&oe)===0&&(l??=new Set).add(o),g.push(o),o=o.next;if(o===null)continue;p=o}u.push(p),c=p,o=p.next}if(o!==null||l!==void 0){for(var U=l===void 0?[]:Xi(l);o!==null;)(o.e.f&oe)===0&&U.push(o),o=o.next;var C=U.length;if(C>0){var m=s===0?i:null;Es(t,U,m)}}}function Ds(t,e,i,n,r,s,a,o){var l=(a&ls)!==0,c=(a&us)===0,u=l?c?qi(i,!1,!1):lt(i):i,g=(a&cs)===0?r:lt(r),h={i:g,v:u,k:n,a:null,e:null,o:!1,prev:e,next:null};try{if(t===null){var f=document.createDocumentFragment();f.append(t=Ze())}return h.e=de(()=>s(t,u,g,o)),e!==null&&(e.next=h),h}finally{}}function Ci(t,e,i){for(var n=t.next?t.next.e.nodes_start:i,r=e?e.e.nodes_start:i,s=t.e.nodes_start;s!==null&&s!==n;){var a=Vt(s);r.before(s),s=a}}function _e(t,e,i){e===null?(t.first=i,t.effect.first=i&&i.e):(e.e.next&&(e.e.next.prev=null),e.next=i,e.e.next=i&&i.e),i===null?t.effect.last=e&&e.e:(i.e.prev&&(i.e.prev.next=null),i.prev=e,i.e.prev=e&&e.e)}function As(t,e,i,n){const r=Ft()?wi:Bt;if(i.length===0&&t.length===0){n(e.map(r));return}var s=G,a=$,o=Cs();function l(){Promise.all(i.map(c=>Ts(c))).then(c=>{o();try{n([...e.map(r),...c])}catch(u){(a.f&Ke)===0&&Dt(u,a)}s?.deactivate(),ci()}).catch(c=>{Dt(c,a)})}t.length>0?Promise.all(t).then(()=>{o();try{return l()}finally{s?.deactivate(),ci()}}):l()}function Cs(){var t=$,e=L,i=K,n=G;return function(s=!0){Ee(t),ne(e),xt(i),s&&n?.activate()}}function ci(){Ee(null),ne(null),xt(null)}function wi(t){var e=j|se,i=L!==null&&(L.f&j)!==0?L:null;return $!==null&&($.f|=Tt),{ctx:K,deps:null,effects:null,equals:Bn,f:e,fn:t,reactions:null,rv:0,v:J,wv:0,parent:i??$,ac:null}}function Ts(t,e){let i=$;i===null&&jr();var n=i.b,r=void 0,s=lt(J),a=!L,o=new Map;return Ys(()=>{var l=Nn();r=l.promise;try{Promise.resolve(t()).then(l.resolve,l.reject).then(()=>{c===G&&c.committed&&c.deactivate(),ci()})}catch(h){l.reject(h),ci()}var c=G;if(a){var u=!n.is_pending();n.update_pending_count(1),c.increment(u),o.get(c)?.reject(yt),o.delete(c),o.set(c,l)}const g=(h,f=void 0)=>{if(c.activate(),f)f!==yt&&(s.f|=ze,Wt(s,f));else{(s.f&ze)!==0&&(s.f^=ze),Wt(s,h);for(const[p,b]of o){if(o.delete(p),p===c)break;b.reject(yt)}}a&&(n.update_pending_count(-1),c.decrement(u))};l.promise.then(g,h=>g(null,h||"unknown"))}),Ji(()=>{for(const l of o.values())l.reject(yt)}),new Promise(l=>{function c(u){function g(){u===r?l(s):c(r)}u.then(g,g)}c(r)})}function pe(t){const e=wi(t);return tr(e),e}function Bt(t){const e=wi(t);return e.equals=Wn,e}function jn(t){var e=t.effects;if(e!==null){t.effects=null;for(var i=0;i<e.length;i+=1)re(e[i])}}function Ms(t){for(var e=t.parent;e!==null;){if((e.f&j)===0)return(e.f&Ke)===0?e:null;e=e.parent}return null}function Vi(t){var e,i=$;Ee(Ms(t));try{t.f&=~at,jn(t),e=sr(t)}finally{Ee(i)}return e}function Jn(t){var e=Vi(t);if(t.equals(e)||(G?.is_fork||(t.v=e),t.wv=nr()),!Mt)if(he!==null)(Gt()||G?.is_fork)&&he.set(t,e);else{var i=(t.f&ve)===0?xe:V;q(t,i)}}let Hi=new Set;const Fe=new Map;let Qn=!1;function lt(t,e){var i={f:0,v:t,reactions:null,equals:Bn,rv:0,wv:0};return i}function B(t,e){const i=lt(t);return tr(i),i}function qi(t,e=!1,i=!0){const n=lt(t);return e||(n.equals=Wn),zt&&i&&K!==null&&K.l!==null&&(K.l.s??=[]).push(n),n}function x(t,e,i=!1){L!==null&&(!Ie||(L.f&ln)!==0)&&Ft()&&(L.f&(j|We|Fi|ln))!==0&&!Ne?.includes(t)&&rs();let n=i?Pe(e):e;return Wt(t,n)}function Wt(t,e){if(!t.equals(e)){var i=t.v;Mt?Fe.set(t,e):Fe.set(t,i),t.v=e;var n=Se.ensure();n.capture(t,i),(t.f&j)!==0&&((t.f&se)!==0&&Vi(t),q(t,(t.f&ve)!==0?V:xe)),t.wv=nr(),er(t,se),Ft()&&$!==null&&($.f&V)!==0&&($.f&(Xe|ht))===0&&(ue===null?Os([t]):ue.push(t)),!n.is_fork&&Hi.size>0&&!Qn&&ks()}return e}function ks(){Qn=!1;var t=Ue;ui(!0);const e=Array.from(Hi);try{for(const i of e)(i.f&V)!==0&&q(i,xe),kt(i)&&At(i)}finally{ui(t)}Hi.clear()}function Yt(t){x(t,t.v+1)}function er(t,e){var i=t.reactions;if(i!==null)for(var n=Ft(),r=i.length,s=0;s<r;s++){var a=i[s],o=a.f;if(!(!n&&a===$)){var l=(o&se)===0;if(l&&q(a,e),(o&j)!==0){var c=a;he?.delete(c),(o&at)===0&&(o&ve&&(a.f|=at),er(c,xe))}else l&&((o&We)!==0&&Le!==null&&Le.add(a),ot(a))}}}function ji(t){var e=L,i=$;ne(null),Ee(null);try{return t()}finally{ne(e),Ee(i)}}let Ue=!1;function ui(t){Ue=t}let Mt=!1;function dn(t){Mt=t}let L=null,Ie=!1;function ne(t){L=t}let $=null;function Ee(t){$=t}let Ne=null;function tr(t){L!==null&&(Ne===null?Ne=[t]:Ne.push(t))}let ee=null,ae=0,ue=null;function Os(t){ue=t}let ir=1,Xt=0,rt=Xt;function hn(t){rt=t}function nr(){return++ir}function kt(t){var e=t.f;if((e&se)!==0)return!0;if(e&j&&(t.f&=~at),(e&xe)!==0){var i=t.deps;if(i!==null)for(var n=i.length,r=0;r<n;r++){var s=i[r];if(kt(s)&&Jn(s),s.wv>t.wv)return!0}(e&ve)!==0&&he===null&&q(t,V)}return!1}function rr(t,e,i=!0){var n=t.reactions;if(n!==null&&!Ne?.includes(t))for(var r=0;r<n.length;r++){var s=n[r];(s.f&j)!==0?rr(s,e,!1):e===s&&(i?q(s,se):(s.f&V)!==0&&q(s,xe),ot(s))}}function sr(t){var e=ee,i=ae,n=ue,r=L,s=Ne,a=K,o=Ie,l=rt,c=t.f;ee=null,ae=0,ue=null,L=(c&(Xe|ht))===0?t:null,Ne=null,xt(t.ctx),Ie=!1,rt=++Xt,t.ac!==null&&(ji(()=>{t.ac.abort(yt)}),t.ac=null);try{t.f|=Oi;var u=t.fn,g=u(),h=t.deps;if(ee!==null){var f;if(di(t,ae),h!==null&&ae>0)for(h.length=ae+ee.length,f=0;f<ee.length;f++)h[ae+f]=ee[f];else t.deps=h=ee;if(Ue&&Gt()&&(t.f&ve)!==0)for(f=ae;f<h.length;f++)(h[f].reactions??=[]).push(t)}else h!==null&&ae<h.length&&(di(t,ae),h.length=ae);if(Ft()&&ue!==null&&!Ie&&h!==null&&(t.f&(j|xe|se))===0)for(f=0;f<ue.length;f++)rr(ue[f],t);return r!==null&&r!==t&&(Xt++,ue!==null&&(n===null?n=ue:n.push(...ue))),(t.f&ze)!==0&&(t.f^=ze),g}catch(p){return Un(p)}finally{t.f^=Oi,ee=e,ae=i,ue=n,L=r,Ne=s,xt(a),Ie=o,rt=l}}function Ls(t,e){let i=e.reactions;if(i!==null){var n=Gr.call(i,t);if(n!==-1){var r=i.length-1;r===0?i=e.reactions=null:(i[n]=i[r],i.pop())}}i===null&&(e.f&j)!==0&&(ee===null||!ee.includes(e))&&(q(e,xe),(e.f&ve)!==0&&(e.f^=ve,e.f&=~at),jn(e),di(e,0))}function di(t,e){var i=t.deps;if(i!==null)for(var n=e;n<i.length;n++)Ls(t,i[n])}function At(t){var e=t.f;if((e&Ke)===0){q(t,V);var i=$,n=Ue;$=t,Ue=!0;try{(e&(We|Ur))!==0?Ws(t):dr(t),ur(t);var r=sr(t);t.teardown=typeof r=="function"?r:null,t.wv=ir;var s;ki&&as&&(t.f&se)!==0&&t.deps}finally{Ue=n,$=i}}}function d(t){var e=t.f,i=(e&j)!==0;if(L!==null&&!Ie){var n=$!==null&&($.f&Ke)!==0;if(!n&&!Ne?.includes(t)){var r=L.deps;if((L.f&Oi)!==0)t.rv<Xt&&(t.rv=Xt,ee===null&&r!==null&&r[ae]===t?ae++:ee===null?ee=[t]:ee.includes(t)||ee.push(t));else{(L.deps??=[]).push(t);var s=t.reactions;s===null?t.reactions=[L]:s.includes(L)||s.push(L)}}}if(Mt){if(Fe.has(t))return Fe.get(t);if(i){var a=t,o=a.v;return((a.f&V)===0&&a.reactions!==null||or(a))&&(o=Vi(a)),Fe.set(a,o),o}}else i&&(!he?.has(t)||G?.is_fork&&!Gt())&&(a=t,kt(a)&&Jn(a),Ue&&Gt()&&(a.f&ve)===0&&ar(a));if(he?.has(t))return he.get(t);if((t.f&ze)!==0)throw t.v;return t.v}function ar(t){if(t.deps!==null){t.f^=ve;for(const e of t.deps)(e.reactions??=[]).push(t),(e.f&j)!==0&&(e.f&ve)===0&&ar(e)}}function or(t){if(t.v===J)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(Fe.has(e)||(e.f&j)!==0&&or(e))return!0;return!1}function ft(t){var e=Ie;try{return Ie=!0,t()}finally{Ie=e}}const Ps=-7169;function q(t,e){t.f=t.f&Ps|e}function Rs(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(bt in t)Ni(t);else if(!Array.isArray(t))for(let e in t){const i=t[e];typeof i=="object"&&i&&bt in i&&Ni(i)}}}function Ni(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let n in t)try{Ni(t[n],e)}catch{}const i=Gi(t);if(i!==Object.prototype&&i!==Array.prototype&&i!==Map.prototype&&i!==Set.prototype&&i!==Date.prototype){const n=Hn(i);for(let r in n){const s=n[r].get;if(s)try{s.call(t)}catch{}}}}}function lr(t){$===null&&(L===null&&es(),Qr()),Mt&&Jr()}function Hs(t,e){var i=e.last;i===null?e.last=e.first=t:(i.next=t,t.prev=i,e.last=t)}function De(t,e,i){var n=$;n!==null&&(n.f&oe)!==0&&(t|=oe);var r={ctx:K,deps:null,nodes_start:null,nodes_end:null,f:t|se|ve,first:null,fn:e,last:null,next:null,parent:n,b:n&&n.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(i)try{At(r),r.f|=zi}catch(o){throw re(r),o}else e!==null&&ot(r);var s=r;if(i&&s.deps===null&&s.teardown===null&&s.nodes_start===null&&s.first===s.last&&(s.f&Tt)===0&&(s=s.first,(t&We)!==0&&(t&st)!==0&&s!==null&&(s.f|=st)),s!==null&&(s.parent=n,n!==null&&Hs(s,n),L!==null&&(L.f&j)!==0&&(t&ht)===0)){var a=L;(a.effects??=[]).push(s)}return r}function Gt(){return L!==null&&!Ie}function Ji(t){const e=De(_i,null,!1);return q(e,V),e.teardown=t,e}function Ct(t){lr();var e=$.f,i=!L&&(e&Xe)!==0&&(e&zi)===0;if(i){var n=K;(n.e??=[]).push(t)}else return cr(t)}function cr(t){return De(Ki|Zn,t,!1)}function Ns(t){return lr(),De(_i|Zn,t,!0)}function $s(t){Se.ensure();const e=De(ht|Tt,t,!0);return(i={})=>new Promise(n=>{i.outro?St(e,()=>{re(e),n(void 0)}):(re(e),n(void 0))})}function Zs(t){return De(Ki,t,!1)}function fn(t,e){var i=K,n={effect:null,ran:!1,deps:t};i.l.$.push(n),n.effect=bi(()=>{t(),!n.ran&&(n.ran=!0,ft(e))})}function Bs(){var t=K;bi(()=>{for(var e of t.l.$){e.deps();var i=e.effect;(i.f&V)!==0&&q(i,xe),kt(i)&&At(i),e.ran=!1}})}function Ys(t){return De(Fi|Tt,t,!0)}function bi(t,e=0){return De(_i|e,t,!0)}function le(t,e=[],i=[],n=[]){As(n,e,i,r=>{De(_i,()=>t(...r.map(d)),!0)})}function Si(t,e=0){var i=De(We|e,t,!0);return i}function de(t){return De(Xe|Tt,t,!0)}function ur(t){var e=t.teardown;if(e!==null){const i=Mt,n=L;dn(!0),ne(null);try{e.call(null)}finally{dn(i),ne(n)}}}function dr(t,e=!1){var i=t.first;for(t.first=t.last=null;i!==null;){const r=i.ac;r!==null&&ji(()=>{r.abort(yt)});var n=i.next;(i.f&ht)!==0?i.parent=null:re(i,e),i=n}}function Ws(t){for(var e=t.first;e!==null;){var i=e.next;(e.f&Xe)===0&&re(e),e=i}}function re(t,e=!0){var i=!1;(e||(t.f&$n)!==0)&&t.nodes_start!==null&&t.nodes_end!==null&&(Xs(t.nodes_start,t.nodes_end),i=!0),dr(t,e&&!i),di(t,0),q(t,Ke);var n=t.transitions;if(n!==null)for(const s of n)s.stop();ur(t);var r=t.parent;r!==null&&r.first!==null&&hr(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes_start=t.nodes_end=t.ac=null}function Xs(t,e){for(;t!==null;){var i=t===e?null:Vt(t);t.remove(),t=i}}function hr(t){var e=t.parent,i=t.prev,n=t.next;i!==null&&(i.next=n),n!==null&&(n.prev=i),e!==null&&(e.first===t&&(e.first=n),e.last===t&&(e.last=i))}function St(t,e,i=!0){var n=[];Qi(t,n,!0),fr(n,()=>{i&&re(t),e&&e()})}function fr(t,e){var i=t.length;if(i>0){var n=()=>--i||e();for(var r of t)r.out(n)}else e()}function Qi(t,e,i){if((t.f&oe)===0){if(t.f^=oe,t.transitions!==null)for(const a of t.transitions)(a.is_global||i)&&e.push(a);for(var n=t.first;n!==null;){var r=n.next,s=(n.f&st)!==0||(n.f&Xe)!==0&&(t.f&We)!==0;Qi(n,e,s?i:!1),n=r}}}function en(t){gr(t,!0)}function gr(t,e){if((t.f&oe)!==0){t.f^=oe,(t.f&V)===0&&(q(t,se),ot(t));for(var i=t.first;i!==null;){var n=i.next,r=(i.f&st)!==0||(i.f&Xe)!==0;gr(i,r?e:!1),i=n}if(t.transitions!==null)for(const s of t.transitions)(s.is_global||e)&&s.in()}}function pr(t,e){for(var i=t.nodes_start,n=t.nodes_end;i!==null;){var r=i===n?null:Vt(i);e.append(i),i=r}}const Gs=["touchstart","touchmove"];function Ks(t){return Gs.includes(t)}const vr=new Set,$i=new Set;function zs(t,e,i,n={}){function r(s){if(n.capture||Ht.call(e,s),!s.cancelBubble)return ji(()=>i?.call(this,s))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?Ut(()=>{e.addEventListener(t,r,n)}):e.addEventListener(t,r,n),r}function It(t,e,i,n,r){var s={capture:n,passive:r},a=zs(t,e,i,s);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&Ji(()=>{e.removeEventListener(t,a,s)})}function Ot(t){for(var e=0;e<t.length;e++)vr.add(t[e]);for(var i of $i)i(t)}let gn=null;function Ht(t){var e=this,i=e.ownerDocument,n=t.type,r=t.composedPath?.()||[],s=r[0]||t.target;gn=t;var a=0,o=gn===t&&t.__root;if(o){var l=r.indexOf(o);if(l!==-1&&(e===document||e===window)){t.__root=e;return}var c=r.indexOf(e);if(c===-1)return;l<=c&&(a=l)}if(s=r[a]||t.target,s!==e){Rn(t,"currentTarget",{configurable:!0,get(){return s||i}});var u=L,g=$;ne(null),Ee(null);try{for(var h,f=[];s!==null;){var p=s.assignedSlot||s.parentNode||s.host||null;try{var b=s["__"+n];b!=null&&(!s.disabled||t.target===s)&&b.call(s,t)}catch(D){h?f.push(D):h=D}if(t.cancelBubble||p===e||p===null)break;s=p}if(h){for(let D of f)queueMicrotask(()=>{throw D});throw h}}finally{t.__root=e,delete t.currentTarget,ne(u),Ee(g)}}}function Fs(t){var e=document.createElement("template");return e.innerHTML=t.replaceAll("<!>","<!---->"),e.content}function hi(t,e){var i=$;i.nodes_start===null&&(i.nodes_start=t,i.nodes_end=e)}function Y(t,e){var i=(e&ds)!==0,n=(e&hs)!==0,r,s=!t.startsWith("<!>");return()=>{r===void 0&&(r=Fs(s?t:"<!>"+t),i||(r=li(r)));var a=n||Gn?document.importNode(r,!0):r.cloneNode(!0);if(i){var o=li(a),l=a.lastChild;hi(o,l)}else hi(a,a);return a}}function we(t=""){{var e=Ze(t+"");return hi(e,e),e}}function Ii(){var t=document.createDocumentFragment(),e=document.createComment(""),i=Ze();return t.append(e,i),hi(e,i),t}function A(t,e){t!==null&&t.before(e)}function Be(t,e){var i=e==null?"":typeof e=="object"?e+"":e;i!==(t.__t??=t.nodeValue)&&(t.__t=i,t.nodeValue=i+"")}function Us(t,e){return Vs(t,e)}const mt=new Map;function Vs(t,{target:e,anchor:i,props:n={},events:r,context:s,intro:a=!0}){vs();var o=new Set,l=g=>{for(var h=0;h<g.length;h++){var f=g[h];if(!o.has(f)){o.add(f);var p=Ks(f);e.addEventListener(f,Ht,{passive:p});var b=mt.get(f);b===void 0?(document.addEventListener(f,Ht,{passive:p}),mt.set(f,1)):mt.set(f,b+1)}}};l(Xi(vr)),$i.add(l);var c=void 0,u=$s(()=>{var g=i??e.appendChild(Ze());return Ss(g,{pending:()=>{}},h=>{if(s){qe({});var f=K;f.c=s}r&&(n.$$events=r),c=t(h,n)||{},s&&je()}),()=>{for(var h of o){e.removeEventListener(h,Ht);var f=mt.get(h);--f===0?(document.removeEventListener(h,Ht),mt.delete(h)):mt.set(h,f)}$i.delete(l),g!==i&&g.parentNode?.removeChild(g)}});return qs.set(c,u),c}let qs=new WeakMap;class mr{anchor;#e=new Map;#t=new Map;#n=new Map;#i=new Set;#l=!0;constructor(e,i=!0){this.anchor=e,this.#l=i}#s=()=>{var e=G;if(this.#e.has(e)){var i=this.#e.get(e),n=this.#t.get(i);if(n)en(n),this.#i.delete(i);else{var r=this.#n.get(i);r&&(this.#t.set(i,r.effect),this.#n.delete(i),r.fragment.lastChild.remove(),this.anchor.before(r.fragment),n=r.effect)}for(const[s,a]of this.#e){if(this.#e.delete(s),s===e)break;const o=this.#n.get(a);o&&(re(o.effect),this.#n.delete(a))}for(const[s,a]of this.#t){if(s===i||this.#i.has(s))continue;const o=()=>{if(Array.from(this.#e.values()).includes(s)){var c=document.createDocumentFragment();pr(a,c),c.append(Ze()),this.#n.set(s,{effect:a,fragment:c})}else re(a);this.#i.delete(s),this.#t.delete(s)};this.#l||!n?(this.#i.add(s),St(a,o,!1)):o()}}};#r=e=>{this.#e.delete(e);const i=Array.from(this.#e.values());for(const[n,r]of this.#n)i.includes(n)||(re(r.effect),this.#n.delete(n))};ensure(e,i){var n=G,r=Fn();if(i&&!this.#t.has(e)&&!this.#n.has(e))if(r){var s=document.createDocumentFragment(),a=Ze();s.append(a),this.#n.set(e,{effect:de(()=>i(a)),fragment:s})}else this.#t.set(e,de(()=>i(this.anchor)));if(this.#e.set(n,e),r){for(const[o,l]of this.#t)o===e?n.skipped_effects.delete(l):n.skipped_effects.add(l);for(const[o,l]of this.#n)o===e?n.skipped_effects.delete(l.effect):n.skipped_effects.add(l.effect);n.oncommit(this.#s),n.ondiscard(this.#r)}else this.#s()}}function F(t,e,i=!1){var n=new mr(t),r=i?st:0;function s(a,o){n.ensure(a,o)}Si(()=>{var a=!1;e((o,l=!0)=>{a=!0,s(l,o)}),a||s(!1,null)},r)}function Zi(t,e,...i){var n=new mr(t);Si(()=>{const r=e()??null;n.ensure(r,r&&(s=>r(s,...i)))},st)}const pn=[...` 	
\r\f \v\uFEFF`];function js(t,e,i){var n=t==null?"":""+t;if(e&&(n=n?n+" "+e:e),i){for(var r in i)if(i[r])n=n?n+" "+r:r;else if(n.length)for(var s=r.length,a=0;(a=n.indexOf(r,a))>=0;){var o=a+s;(a===0||pn.includes(n[a-1]))&&(o===n.length||pn.includes(n[o]))?n=(a===0?"":n.substring(0,a))+n.substring(o+1):a=o}}return n===""?null:n}function Js(t,e){return t==null?null:String(t)}function ct(t,e,i,n,r,s){var a=t.__className;if(a!==i||a===void 0){var o=js(i,n,s);o==null?t.removeAttribute("class"):t.className=o,t.__className=i}else if(s&&r!==s)for(var l in s){var c=!!s[l];(r==null||c!==!!r[l])&&t.classList.toggle(l,c)}return s}function Ve(t,e,i,n){var r=t.__style;if(r!==e){var s=Js(e);s==null?t.removeAttribute("style"):t.style.cssText=s,t.__style=e}return n}const Qs=Symbol("is custom element"),ea=Symbol("is html");function vn(t,e){var i=_r(t);i.value===(i.value=e??void 0)||t.value===e&&(e!==0||t.nodeName!=="PROGRESS")||(t.value=e??"")}function Et(t,e,i,n){var r=_r(t);r[e]!==(r[e]=i)&&(e==="loading"&&(t[Vr]=i),i==null?t.removeAttribute(e):typeof i!="string"&&ta(t).includes(e)?t[e]=i:t.setAttribute(e,i))}function _r(t){return t.__attributes??={[Qs]:t.nodeName.includes("-"),[ea]:t.namespaceURI===fs}}var mn=new Map;function ta(t){var e=t.getAttribute("is")||t.nodeName,i=mn.get(e);if(i)return i;mn.set(e,i=[]);for(var n,r=t,s=Element.prototype;s!==r;){n=Hn(r);for(var a in n)n[a].set&&i.push(a);r=Gi(r)}return i}function _n(t,e){return t===e||t?.[bt]===e}function tn(t={},e,i,n){return Zs(()=>{var r,s;return bi(()=>{r=s,s=[],ft(()=>{t!==i(...s)&&(e(t,...s),r&&_n(i(...r),t)&&e(null,...r))})}),()=>{Ut(()=>{s&&_n(i(...s),t)&&e(null,...s)})}}),t}function nn(t=!1){const e=K,i=e.l.u;if(!i)return;let n=()=>Rs(e.s);if(t){let r=0,s={};const a=wi(()=>{let o=!1;const l=e.s;for(const c in l)l[c]!==s[c]&&(s[c]=l[c],o=!0);return o&&r++,r});n=()=>d(a)}i.b.length&&Ns(()=>{yn(e,n),oi(i.b)}),Ct(()=>{const r=ft(()=>i.m.map(Fr));return()=>{for(const s of r)typeof s=="function"&&s()}}),i.a.length&&Ct(()=>{yn(e,n),oi(i.a)})}function yn(t,e){if(t.l.s)for(const i of t.l.s)d(i);e()}let Bi=Symbol();function Q(t,e,i){const n=i[e]??={store:null,source:qi(void 0),unsubscribe:Re};if(n.store!==t&&!(Bi in i))if(n.unsubscribe(),n.store=t??null,t==null)n.source.v=void 0,n.unsubscribe=Re;else{var r=!0;n.unsubscribe=rn(t,s=>{r?n.source.v=s:x(n.source,s)}),r=!1}return t&&Bi in i?yr(t):d(n.source)}function Lt(){const t={};function e(){Ji(()=>{for(var i in t)t[i].unsubscribe();Rn(t,Bi,{enumerable:!1,value:!0})})}return[t,e]}function ie(t,e,i,n){var r=n,s=!0,a=()=>(s&&(s=!1,r=n),r),o;o=t[e],o===void 0&&n!==void 0&&(o=a());var l;return l=()=>{var c=t[e];return c===void 0?a():(s=!0,c)},l}function ia(t){K===null&&qr(),zt&&K.l!==null?na(K).m.push(t):Ct(()=>{const e=ft(t);if(typeof e=="function")return e})}function na(t){var e=t.l;return e.u??={a:[],b:[],m:[]}}function rn(t,e,i){if(t==null)return e(void 0),i&&i(void 0),Re;const n=ft(()=>t.subscribe(e,i));return n.unsubscribe?()=>n.unsubscribe():n}const _t=[];function ra(t,e){return{subscribe:ge(t,e).subscribe}}function ge(t,e=Re){let i=null;const n=new Set;function r(o){if(Yn(t,o)&&(t=o,i)){const l=!_t.length;for(const c of n)c[1](),_t.push(c,t);if(l){for(let c=0;c<_t.length;c+=2)_t[c][0](_t[c+1]);_t.length=0}}}function s(o){r(o(t))}function a(o,l=Re){const c=[o,l];return n.add(c),n.size===1&&(i=e(r,s)||Re),o(t),()=>{n.delete(c),n.size===0&&i&&(i(),i=null)}}return{set:r,update:s,subscribe:a}}function Je(t,e,i){const n=!Array.isArray(t),r=n?[t]:t;if(!r.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const s=e.length<2;return ra(i,(a,o)=>{let l=!1;const c=[];let u=0,g=Re;const h=()=>{if(u)return;g();const p=e(n?c[0]:c,a,o);s?a(p):g=typeof p=="function"?p:Re},f=r.map((p,b)=>rn(p,D=>{c[b]=D,u&=~(1<<b),l&&h()},()=>{u|=1<<b}));return l=!0,h(),function(){oi(f),g(),l=!1}})}function yr(t){let e;return rn(t,i=>e=i)(),e}function sa(){return`zone_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const Yi=["#e74c3c","#e67e22","#f1c40f","#2ecc71","#1abc9c","#3498db","#9b59b6","#e91e8f"];function aa(){return Yi[Math.floor(Math.random()*Yi.length)]}function oa(t,e=200){return{id:sa(),x:t,width:e,color:aa(),texts:[{language:"cs",title:"",content:""}]}}function la(t,e){const i=t.texts.find(n=>n.language===e);return i||t.texts[0]||null}const fi=ge("cs"),ca=ge("orange"),ua=ge("Forest"),Wi=ge(!1),Nt=ge(!1),wr=ge(!1),br=ge(!1),Sr=ge(null),da=Je([Sr,fi],([t,e])=>t?la(t,e):null);function wn(t){Sr.set(t)}const Ye={BACKGROUND_BASE:-100,BACKGROUND_LAYER_START:-99,GROUND_REFERENCE:-1,ITEMS_BEHIND:5,PLAYER:10,ITEMS_FRONT:15,SELECTION_GRAPHICS:999,GRID_OVERLAY:1e3};function Ir(t){return t==="behind"?Ye.ITEMS_BEHIND:Ye.ITEMS_FRONT}const Oe=["orange","white"];class ha{currentSkin=Oe[0];currentIndex=0;setSkin(e){Oe.includes(e)&&(this.currentSkin=e,this.currentIndex=Oe.indexOf(e),localStorage.setItem("catSkin",e))}getSkin(){const e=localStorage.getItem("catSkin");return e&&Oe.includes(e)&&(this.currentSkin=e,this.currentIndex=Oe.indexOf(e)),this.currentSkin}toggleSkin(){return this.currentIndex=(this.currentIndex+1)%Oe.length,this.currentSkin=Oe[this.currentIndex],this.setSkin(this.currentSkin),this.currentSkin}getAllSkins(){return Oe}}const Er=new ha,fa={FAST_VELOCITY_THRESHOLD:100,ROTATION_FULL:15,ROTATION_SLIGHT:8};class ga{scene;currentSkin;constructor(e,i="white"){this.scene=e,this.currentSkin=i}createAll(){Er.getAllSkins().forEach(i=>{this.createAnimationsForSkin(i)})}createAnimationsForSkin(e){const i=this.scene;i.anims.exists(`cat-idle-${e}`)||i.anims.create({key:`cat-idle-${e}`,frames:i.anims.generateFrameNumbers(`cat-idle-${e}`,{start:0,end:3}),frameRate:6,repeat:-1}),i.anims.exists(`cat-walk-${e}`)||i.anims.create({key:`cat-walk-${e}`,frames:i.anims.generateFrameNumbers(`cat-walk-${e}`,{start:0,end:5}),frameRate:12,repeat:-1}),[{key:`cat-jump-up-${e}`,frame:2},{key:`cat-jump-peak-up-${e}`,frame:3},{key:`cat-jump-peak-down-${e}`,frame:3},{key:`cat-jump-down-${e}`,frame:4}].forEach(({key:r,frame:s})=>{i.anims.exists(r)||i.anims.create({key:r,frames:[{key:`cat-walk-${e}`,frame:s}],frameRate:1,repeat:0})})}getSkin(){return this.currentSkin}setSkin(e){this.currentSkin=e}getAnimationKey(e){return`cat-${e}-${this.currentSkin}`}play(e,i){const n=this.getAnimationKey(i);e.anims.currentAnim?.key!==n&&e.play(n)}getJumpAnimationState(e){const{FAST_VELOCITY_THRESHOLD:i,ROTATION_FULL:n,ROTATION_SLIGHT:r}=fa;return e<-i?{animation:this.getAnimationKey("jump-up"),rotation:n,flipMultiplier:1}:e<-20?{animation:this.getAnimationKey("jump-peak-up"),rotation:r,flipMultiplier:1}:e<=i?{animation:this.getAnimationKey("jump-peak-down"),rotation:r,flipMultiplier:-1}:{animation:this.getAnimationKey("jump-down"),rotation:n,flipMultiplier:-1}}handleSkinChange(e,i){const n=this.currentSkin;this.currentSkin=i;const r=e.anims.currentAnim?.key;if(r){const a=`cat-${r.replace("cat-","").replace(`-${n}`,"")}-${i}`;this.scene.anims.exists(a)&&e.play(a)}}}const tt={THRESHOLD_X:20,LANGUAGE_BUTTON:{width:120,height:60},SKIN_BUTTON:{width:120,height:60,yOffset:60}},bn={SPEED:350,JUMP_STRENGTH:-500};class pa{scene;getPlayerPosition;keyUp;keyLeft;keyRight;keyA;keyD;keyW;keySpace;touchLeft=!1;touchRight=!1;touchJump=!1;touchHandlers;constructor(e){this.scene=e.scene,this.getPlayerPosition=e.getPlayerPosition,this.setupKeyboardControls(),this.setupTouchControls()}setupKeyboardControls(){this.scene.input.keyboard&&(this.keyUp=this.scene.input.keyboard.addKey(M.Input.Keyboard.KeyCodes.UP,!1),this.keyLeft=this.scene.input.keyboard.addKey(M.Input.Keyboard.KeyCodes.LEFT,!1),this.keyRight=this.scene.input.keyboard.addKey(M.Input.Keyboard.KeyCodes.RIGHT,!1),this.keyA=this.scene.input.keyboard.addKey(M.Input.Keyboard.KeyCodes.A,!1),this.keyD=this.scene.input.keyboard.addKey(M.Input.Keyboard.KeyCodes.D,!1),this.keyW=this.scene.input.keyboard.addKey(M.Input.Keyboard.KeyCodes.W,!1),this.keySpace=this.scene.input.keyboard.addKey(M.Input.Keyboard.KeyCodes.SPACE,!1))}setupTouchControls(){const e=this.scene,i=a=>{const o=a.x,l=a.y,c=e.scale.width;if(o>c-tt.LANGUAGE_BUTTON.width&&l<tt.LANGUAGE_BUTTON.height||o>c-tt.SKIN_BUTTON.width&&l>=tt.SKIN_BUTTON.yOffset&&l<tt.SKIN_BUTTON.yOffset+tt.SKIN_BUTTON.height)return;const u=e.cameras.main,g=this.getPlayerPosition(),h=g.x-u.scrollX,f=g.y-u.scrollY,p=o-h,b=l-f;p<-20?(this.touchLeft=!0,this.touchRight=!1):p>tt.THRESHOLD_X?(this.touchRight=!0,this.touchLeft=!1):(this.touchLeft=!1,this.touchRight=!1),this.touchJump=b<-80},n=a=>{i(a)},r=a=>{a.isDown&&i(a)},s=()=>{this.touchLeft=!1,this.touchRight=!1,this.touchJump=!1};e.input.on("pointerdown",n),e.input.on("pointermove",r),e.input.on("pointerup",s),this.touchHandlers={pointerdown:n,pointermove:r,pointerup:s}}getInputState(){const e=this.keyA?.isDown||this.keyLeft?.isDown||this.touchLeft||!1,i=this.keyD?.isDown||this.keyRight?.isDown||this.touchRight||!1,n=this.keySpace?.isDown||this.keyW?.isDown||this.keyUp?.isDown||this.touchJump||!1;return{left:e,right:i,jump:n}}hasAnyInput(){const e=this.getInputState();return e.left||e.right||e.jump}destroy(){this.touchHandlers&&(this.scene.input.off("pointerdown",this.touchHandlers.pointerdown),this.scene.input.off("pointermove",this.touchHandlers.pointermove),this.scene.input.off("pointerup",this.touchHandlers.pointerup),this.touchHandlers=void 0)}}class va extends M.Physics.Arcade.Sprite{animations;inputController;animState="idle";hasNotifiedMovement=!1;hasReceivedInput=!1;constructor(e,i,n){const r="white";super(e,i,n,`cat-idle-${r}`),e.add.existing(this),e.physics.add.existing(this),this.animations=new ga(e,r),this.animations.createAll(),this.inputController=new pa({scene:e,getPlayerPosition:()=>({x:this.x,y:this.y})}),this.setCollideWorldBounds(!0),this.setBounce(0),this.setSize(40,40),this.setOffset(4,8),this.setScale(5),this.setDepth(Ye.PLAYER),this.animations.play(this,"idle")}changeSkin(e){this.animations.handleSkinChange(this,e)}updateJumpAnimation(e){const{animation:i,rotation:n,flipMultiplier:r}=this.animations.getJumpAnimationState(e);this.anims.currentAnim?.key!==i&&this.play(i);const s=this.flipX?n*r:-n*r;this.setAngle(s)}update(){const e=this.inputController.getInputState(),i=this.body,n=i&&(i.blocked.down||i.touching.down);switch(this.inputController.hasAnyInput()&&!this.hasReceivedInput&&(this.hasReceivedInput=!0),this.hasReceivedInput&&this.inputController.hasAnyInput()&&!this.hasNotifiedMovement&&(this.hasNotifiedMovement=!0,br.set(!0)),e.left?(this.setVelocityX(-350),this.setFlipX(!0),n&&(this.animState="running")):e.right?(this.setVelocityX(bn.SPEED),this.setFlipX(!1),n&&(this.animState="running")):(this.setVelocityX(0),n&&(this.animState="idle")),e.jump&&n&&(this.setVelocityY(bn.JUMP_STRENGTH),this.animState="jumping"),!n&&i&&i.velocity.y!==0&&(this.animState="jumping"),this.animState){case"idle":this.animations.play(this,"idle"),this.setAngle(0);break;case"running":this.animations.play(this,"walk"),this.setAngle(0);break;case"jumping":this.updateJumpAnimation(i.velocity.y);break}}destroy(e){this.inputController.destroy(),super.destroy(e)}}const it=[{name:"FOREST",folder:"forest",scrollFactors:[1,.8,.85,.9,.95,1]},{name:"FOREST BLUE",folder:"forest_blue",scrollFactors:[1,.8,.85,.9,.95,1]}];class ma{currentIndex=0;constructor(){const e=localStorage.getItem("background");if(e){const i=it.findIndex(n=>n.folder===e);i!==-1&&(this.currentIndex=i)}}getBackground(){return it[this.currentIndex].folder}getCurrentConfig(){return it[this.currentIndex]}setBackground(e){const i=it.findIndex(n=>n.folder===e);i!==-1&&(this.currentIndex=i,localStorage.setItem("background",e))}toggleBackground(){this.currentIndex=(this.currentIndex+1)%it.length;const e=it[this.currentIndex];return localStorage.setItem("background",e.folder),e}getAllBackgrounds(){return it}}const gi=new ma;function xr(t,e){return new Promise(i=>{t.load.image(`bg0-${e.folder}`,`assets/backgrounds/${e.folder}/0.png`);for(let n=0;n<e.scrollFactors.length;n++){const r=n+1;t.load.image(`bg${r}-${e.folder}`,`assets/backgrounds/${e.folder}/${r}.png`)}t.load.once("complete",()=>{i(!0)}),t.load.once("loaderror",n=>{console.error(`Failed to load background asset: ${n.key}`),i(!1)}),t.load.start()})}function Dr(t,e,i,n){const r=Math.max(i,t.scale.height),s=t.add.tileSprite(0,0,e,r,`bg0-${n.folder}`);s.setOrigin(0,0),s.setScrollFactor(1),s.setDepth(Ye.BACKGROUND_BASE),s.tilePositionX=0,s.tilePositionY=0;const a=[];for(let o=0;o<n.scrollFactors.length;o++){const c=`bg${o+1}-${n.folder}`;if(t.textures.exists(c)){const u=t.add.image(0,0,c);u.setOrigin(0,0),u.setScrollFactor(n.scrollFactors[o]),u.setDepth(Ye.BACKGROUND_LAYER_START+o),u.setDisplaySize(e,i),a.push(u)}}return{baseLayer:s,bgLayers:a}}function Ar(t,e){t&&(t.tilePositionX=e.scrollX)}function _a(t){t.bgLayers.forEach(e=>e.destroy()),t.baseLayer.destroy()}const ya={isActive:!1,config:null,selectedItemId:null,itemDepthLayer:"behind",editMode:"items",selectedDialogZoneId:null},z=ge(ya),wa=Je(z,t=>t.isActive),ba=Je(z,t=>t.config),Cr=Je(z,t=>t.selectedItemId),Tr=Je(z,t=>t.itemDepthLayer),qt=Je(z,t=>t.editMode),Mr=Je(z,t=>t.selectedDialogZoneId),kr=Je(z,t=>t.config?.dialogZones||[]);function Sn(t,e){z.update(i=>i.config?{...i,config:{...i.config,playerStartX:t,playerStartY:e}}:i)}function Sa(t){z.update(e=>{if(!e.config)return e;const i=e.config.placedItems||[];return{...e,config:{...e.config,placedItems:[...i,t]}}})}function Or(t,e){z.update(i=>!i.config||!i.config.placedItems?i:{...i,config:{...i.config,placedItems:i.config.placedItems.map(n=>n.id===t?{...n,...e}:n)}})}function Lr(t){z.update(e=>!e.config||!e.config.placedItems?e:{...e,config:{...e.config,placedItems:e.config.placedItems.filter(i=>i.id!==t)},selectedItemId:e.selectedItemId===t?null:e.selectedItemId})}function pi(t){z.update(e=>({...e,selectedItemId:t}))}function sn(){z.update(t=>({...t,selectedItemId:null}))}function Ia(){z.update(t=>({...t,itemDepthLayer:t.itemDepthLayer==="behind"?"front":"behind"}))}function Ea(t,e){Or(t,{depth:e})}function xa(t){z.set({isActive:!0,config:{...t,placedItems:t.placedItems||[],dialogZones:t.dialogZones||[]},selectedItemId:null,itemDepthLayer:"behind",editMode:"items",selectedDialogZoneId:null}),jt.set(!1)}function Da(){z.update(t=>({...t,isActive:!1,selectedItemId:null})),jt.set(!1)}function Aa(){return yr(z).config}const jt=ge(!1);function In(t){jt.set(t)}const Pr=ge({scrollX:0,scrollY:0,viewWidth:0,viewHeight:0,worldWidth:0,worldHeight:0,zoom:1,playerX:0,playerY:0});function Ca(t){Pr.update(e=>({...e,...t}))}function Ta(){z.update(t=>({...t,editMode:t.editMode==="items"?"dialogs":"items",selectedItemId:null,selectedDialogZoneId:null}))}function Ma(t){z.update(e=>{if(!e.config)return e;const i=e.config.dialogZones||[];return{...e,config:{...e.config,dialogZones:[...i,t]}}})}function $t(t,e){z.update(i=>!i.config||!i.config.dialogZones?i:{...i,config:{...i.config,dialogZones:i.config.dialogZones.map(n=>n.id===t?{...n,...e}:n)}})}function ka(t){z.update(e=>!e.config||!e.config.dialogZones?e:{...e,config:{...e.config,dialogZones:e.config.dialogZones.filter(i=>i.id!==t)},selectedDialogZoneId:e.selectedDialogZoneId===t?null:e.selectedDialogZoneId})}function ri(t){z.update(e=>({...e,selectedDialogZoneId:t}))}function En(t,e,i){z.update(n=>!n.config||!n.config.dialogZones?n:{...n,config:{...n.config,dialogZones:n.config.dialogZones.map(r=>{if(r.id!==t)return r;const s=r.texts.findIndex(o=>o.language===e);let a;return s>=0?a=r.texts.map((o,l)=>l===s?{...o,...i}:o):a=[...r.texts,{language:e,title:"",content:"",...i}],{...r,texts:a}})}})}const an=[{key:"tent",name:"Tent",path:"assets/ui/tent.png",scale:6,category:"structures"},{key:"lamp",name:"Lamp",path:"assets/ui/lamp.png",scale:8,category:"props"},{key:"sign_left",name:"Sign ←",path:"assets/ui/sign_left.png",scale:7,category:"signs"},{key:"sign_right",name:"Sign →",path:"assets/ui/sign_right.png",scale:7,category:"signs"},{key:"stone_0",name:"Stone 0",path:"assets/ui/stone_0.png",scale:4,category:"nature"},{key:"stone_1",name:"Stone 1",path:"assets/ui/stone_1.png",scale:5,category:"nature"},{key:"stone_2",name:"Stone 2",path:"assets/ui/stone_2.png",scale:4,category:"nature"}];function Oa(t){return an.find(e=>e.key===t)}function La(t){return Oa(t)?.scale||1}class xn{scene;groundY;constructor(e,i){this.scene=e,this.groundY=i}static preloadAssets(e){an.forEach(i=>{e.load.image(i.key,i.path)})}createSprite(e){const{id:i,assetKey:n,x:r,scale:s=1,depth:a=5,yOffset:o=0}=e,l=this.groundY+o,c=this.scene.add.sprite(r,l,n);return c.setScale(s),c.setDepth(a),c.setData("itemId",i),c}updatePosition(e,i,n){e.x=i,e.y=this.groundY+n}updateScale(e,i){e.setScale(i)}updateDepth(e,i){e.setDepth(i)}applyUpdates(e,i){i.x!==void 0&&(e.x=i.x),i.yOffset!==void 0&&(e.y=this.groundY+i.yOffset),i.scale!==void 0&&e.setScale(i.scale),i.depth!==void 0&&e.setDepth(i.depth)}worldYToOffset(e){return e-this.groundY}getGroundY(){return this.groundY}}class Pa{scene;groundY;isDragging=!1;callbacks;constructor(e,i,n={}){this.scene=e,this.groundY=i,this.callbacks=n}getIsDragging(){return this.isDragging}makeInteractive(e,i){e.setInteractive({cursor:"pointer"}),this.scene.input.setDraggable(e),e.on("pointerdown",()=>{this.isDragging||pi(i)}),e.on("dragstart",()=>{this.isDragging=!1,e.setTint(4886754),this.scene.data?.set("isDraggingItem",!0),this.callbacks.onDragStart?.(i)}),e.on("drag",(n,r,s)=>{this.isDragging=!0,e.setPosition(r,s),this.callbacks.onDrag?.(i,r,s)}),e.on("dragend",()=>{e.clearTint(),this.scene.data?.set("isDraggingItem",!1);const n=Math.round(e.x),s=Math.round(e.y)-this.groundY;Or(i,{x:n,yOffset:s}),this.callbacks.onDragEnd?.(i,n,s),this.scene.time.delayedCall(50,()=>{this.isDragging=!1})})}removeInteractivity(e){!e||!e.scene||(e.removeInteractive(),e.off("pointerdown"),e.off("dragstart"),e.off("drag"),e.off("dragend"))}}const Ra={lineWidth:3,lineColor:4886754,lineAlpha:1,handleSize:8,handleColor:4886754,padding:5};class Ha{scene;graphics;style;selectedId=null;constructor(e,i={}){this.scene=e,this.style={...Ra,...i},this.graphics=e.add.graphics(),this.graphics.setDepth(Ye.SELECTION_GRAPHICS)}setSelectedId(e){this.selectedId=e}getSelectedId(){return this.selectedId}updateVisuals(e){if(this.graphics.clear(),!e||!this.selectedId)return;const i=e.getBounds(),{lineWidth:n,lineColor:r,lineAlpha:s,handleSize:a,handleColor:o,padding:l}=this.style;this.graphics.lineStyle(n,r,s),this.graphics.strokeRect(i.x-l,i.y-l,i.width+l*2,i.height+l*2),this.graphics.fillStyle(o,1),this.graphics.fillCircle(i.x,i.y,a),this.graphics.fillCircle(i.x+i.width,i.y,a),this.graphics.fillCircle(i.x,i.y+i.height,a),this.graphics.fillCircle(i.x+i.width,i.y+i.height,a)}clearVisuals(){this.graphics.clear(),this.selectedId=null}setupBackgroundDeselect(e){this.scene.input.on("pointerdown",i=>{if(e())return;this.scene.input.hitTestPointer(i).find(r=>r.type==="Sprite"&&r.getData("itemId"))||(sn(),this.clearVisuals())})}destroy(){this.graphics?.destroy()}}class vi{scene;items=new Map;isBuilderMode=!1;renderer;dragController;selectionManager;constructor(e,i,n=!1){this.scene=e,this.isBuilderMode=n,this.renderer=new xn(e,i),this.isBuilderMode&&(this.dragController=new Pa(e,i,{onDrag:()=>this.updateSelectionVisuals()}),this.selectionManager=new Ha(e))}static preloadAssets(e){xn.preloadAssets(e)}createItems(e){e.forEach(i=>{this.createItem(i)})}createItem(e){const i=this.renderer.createSprite(e);this.items.set(e.id,{sprite:i,data:e}),this.isBuilderMode&&this.dragController&&(this.dragController.makeInteractive(i,e.id),i.on("pointerdown",()=>{this.dragController?.getIsDragging()||(pi(e.id),this.updateSelectionVisuals())}))}updateSelectionVisuals(){if(!this.selectionManager)return;const e=this.scene.data.get("selectedItemId");if(this.selectionManager.setSelectedId(e),!e){this.selectionManager.clearVisuals();return}const i=this.items.get(e);this.selectionManager.updateVisuals(i?.sprite??null)}updateItem(e,i){const n=this.items.get(e);n&&(this.renderer.applyUpdates(n.sprite,i),n.data={...n.data,...i})}removeItem(e){const i=this.items.get(e);i&&(this.dragController&&this.dragController.removeInteractivity(i.sprite),i.sprite.destroy(),this.items.delete(e))}removeAllItems(){this.items.forEach(e=>{!e.sprite||!e.sprite.scene||(this.dragController&&this.dragController.removeInteractivity(e.sprite),e.sprite.destroy())}),this.items.clear()}getItem(e){return this.items.get(e)?.data}getAllItems(){return Array.from(this.items.values()).map(e=>e.data)}setInteractiveEnabled(e){!this.isBuilderMode||!this.dragController||(this.items.forEach(({sprite:i,data:n})=>{e?(this.dragController.makeInteractive(i,n.id),i.setAlpha(1),i.on("pointerdown",()=>{this.dragController?.getIsDragging()||(pi(n.id),this.updateSelectionVisuals())})):(i.disableInteractive(),i.off("pointerdown"),i.setAlpha(.6))}),!e&&this.selectionManager&&this.selectionManager.clearVisuals())}destroy(){this.removeAllItems(),this.selectionManager?.destroy()}setupBackgroundDeselect(){!this.isBuilderMode||!this.selectionManager||this.selectionManager.setupBackgroundDeselect(()=>this.dragController?.getIsDragging()??!1)}}async function Dn(){const t=await fetch("./config/map.json");if(!t.ok)throw new Error(`Failed to load map config: ${t.status}`);const e=await t.json();if(!e.worldWidth||!e.worldHeight)throw new Error("Invalid map config structure");return e}const si={generateId(){return`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`},create(t){const{assetKey:e,x:i,yOffset:n=0,depthLayer:r="behind",scale:s}=t;return{id:si.generateId(),assetKey:e,x:Math.round(i),y:0,scale:s??La(e),depth:Ir(r),yOffset:Math.round(n)}},createAtWorldPosition(t,e,i,n,r="behind"){return si.create({assetKey:t,x:e,yOffset:i-n,depthLayer:r})},clone(t,e=50){return{...t,id:si.generateId(),x:t.x+e}}},nt={HEIGHT:40,VISUAL:{COLOR:9139029,ALPHA:.3},PHYSICS:{COLOR:0,ALPHA:0}},Kt={getGroundY(t,e=nt.HEIGHT){return t-e},createVisualGround(t,e){const i=e.height??nt.HEIGHT,n=Kt.getGroundY(e.worldHeight,i),r=t.add.rectangle(0,n,e.worldWidth,i,e.color??nt.VISUAL.COLOR,e.alpha??nt.VISUAL.ALPHA);return r.setOrigin(0,0),r.setDepth(e.depth??Ye.GROUND_REFERENCE),{ground:r,groundY:n}},createPhysicsGround(t,e){const i=e.height??nt.HEIGHT,n=Kt.getGroundY(e.worldHeight,i),r=t.add.rectangle(0,n,e.worldWidth,i,e.color??nt.PHYSICS.COLOR,e.alpha??nt.PHYSICS.ALPHA);return r.setOrigin(0,0),t.physics.add.existing(r,!0),{ground:r,groundY:n}},addPlayerCollision(t,e,i){return t.physics.add.collider(e,i)}},$e={GAME:"GameScene",BUILDER:"BuilderScene"};class Na extends M.Scene{player;mapConfig;parallaxLayers=null;loadedBackgrounds=new Set;itemManager;dialogZones=[];currentDialogZone=null;unsubscribers=[];initData;constructor(){super({key:$e.GAME})}init(e){this.initData=e}preload(){Oe.forEach(e=>{this.load.spritesheet(`cat-idle-${e}`,`assets/sprites/${e}/Idle.png`,{frameWidth:48,frameHeight:48}),this.load.spritesheet(`cat-walk-${e}`,`assets/sprites/${e}/Walk.png`,{frameWidth:48,frameHeight:48})}),vi.preloadAssets(this)}create(){this.initializeScene()}async initializeScene(){Wi.set(!0);try{await this.loadMapConfiguration();const e=gi.getCurrentConfig();await this.loadBackgroundIfNeeded(e),this.createParallaxBackground();const{ground:i,groundY:n}=Kt.createPhysicsGround(this,{worldWidth:this.mapConfig.worldWidth,worldHeight:this.mapConfig.worldHeight});this.player=new va(this,this.mapConfig.playerStartX,this.mapConfig.playerStartY),Kt.addPlayerCollision(this,this.player,i),this.itemManager=new vi(this,n,!1),this.mapConfig.placedItems&&this.mapConfig.placedItems.length>0&&this.itemManager.createItems(this.mapConfig.placedItems),this.dialogZones=this.mapConfig.dialogZones||[],this.cameras.main.startFollow(this.player,!0,.1,.1),this.cameras.main.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.physics.world.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.scale.on("resize",this.handleResize,this)}catch(e){console.error("[GameScene] Failed to initialize scene:",e)}finally{Wi.set(!1)}}async loadMapConfiguration(){try{if(this.initData?.useBuilderConfig){const e=Aa();this.mapConfig=e||await Dn()}else this.mapConfig=await Dn()}catch(e){console.error("[GameScene] Failed to load map configuration:",e),this.mapConfig={worldWidth:3200,worldHeight:600,playerStartX:400,playerStartY:300,placedItems:[]}}}createParallaxBackground(){const e=gi.getCurrentConfig();this.parallaxLayers=Dr(this,this.mapConfig.worldWidth,this.mapConfig.worldHeight,e)}async loadBackgroundIfNeeded(e){if(this.loadedBackgrounds.has(e.folder))return!0;const i=await xr(this,e);return i&&this.loadedBackgrounds.add(e.folder),i}handleResize(e){if(!(!this.cameras?.main||!this.mapConfig)&&(this.cameras.main.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.parallaxLayers?.baseLayer)){const i=Math.max(this.mapConfig.worldHeight,e.height);this.parallaxLayers.baseLayer.setSize(this.mapConfig.worldWidth,i)}}shutdown(){this.scale.off("resize",this.handleResize,this),wn(null),this.currentDialogZone=null,this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.itemManager&&this.itemManager.destroy()}update(){this.player&&(this.player.update(),this.checkDialogZones(),this.parallaxLayers&&Ar(this.parallaxLayers.baseLayer,this.cameras.main))}checkDialogZones(){const e=this.player.x;let i=null;for(const n of this.dialogZones)if(e>=n.x&&e<=n.x+n.width){i=n;break}i?.id!==this.currentDialogZone?.id&&(this.currentDialogZone=i,wn(i))}}function ai(){const t=document.activeElement;if(!t)return!1;const e=t.tagName.toUpperCase();return e==="INPUT"||e==="TEXTAREA"||t.getAttribute("contenteditable")==="true"}const $a=.3,Za=1,ii=400;class Ba{scene;camera;worldWidth;worldHeight;isPanning=!1;panStartX=0;cameraDragStartX=0;isDraggingToScroll=!1;dragScrollStartX=0;dragScrollStartY=0;dragScrollCameraStartX=0;dragScrollCameraStartY=0;isZoomedOut=!1;isAnimating=!1;savedScrollX=0;savedScrollY=0;constructor(e,i,n){this.scene=e,this.camera=e.cameras.main,this.worldWidth=i,this.worldHeight=n}setup(){this.setupCamera(),this.setupMouseControls(),this.setupKeyboardControls()}setupCamera(){this.camera.setBounds(0,0,this.worldWidth,this.worldHeight),this.camera.setZoom(1)}centerOn(e,i){this.camera.centerOn(e,i)}setupMouseControls(){this.scene.input.on("wheel",(e,i,n,r)=>{if(this.isZoomedOut)return;const s=n!==0?n:r,a=this.camera.scrollX+s;this.camera.setScroll(M.Math.Clamp(a,0,this.worldWidth-this.camera.width),this.camera.scrollY)}),this.scene.input.on("pointerdown",e=>{this.isZoomedOut||(e.rightButtonDown()||e.middleButtonDown()?(this.isPanning=!0,this.panStartX=e.x,this.cameraDragStartX=this.camera.scrollX):e.leftButtonDown()&&!this.isDraggingObject()&&(this.scene.data.get("isDraggingItem")===!0||(this.dragScrollStartX=e.x,this.dragScrollStartY=e.y,this.dragScrollCameraStartX=this.camera.scrollX,this.dragScrollCameraStartY=this.camera.scrollY)))}),this.scene.input.on("pointermove",e=>{if(!this.isZoomedOut){if(this.isPanning){const i=e.x-this.panStartX,n=this.cameraDragStartX-i;this.camera.setScroll(M.Math.Clamp(n,0,this.worldWidth-this.camera.width),this.camera.scrollY)}else if(e.leftButtonDown()&&!this.isDraggingToScroll&&!this.isDraggingObject()&&!(this.scene.data.get("isDraggingItem")===!0)){const n=Math.abs(e.x-this.dragScrollStartX),r=Math.abs(e.y-this.dragScrollStartY);Math.sqrt(n*n+r*r)>10&&(this.isDraggingToScroll=!0,this.scene.input.setDefaultCursor("grabbing"))}if(this.isDraggingToScroll){const i=e.x-this.dragScrollStartX,n=e.y-this.dragScrollStartY,r=this.dragScrollCameraStartX-i,s=this.dragScrollCameraStartY-n;this.camera.setScroll(M.Math.Clamp(r,0,this.worldWidth-this.camera.width),M.Math.Clamp(s,0,this.worldHeight-this.camera.height))}}}),this.scene.input.on("pointerup",e=>{!e.rightButtonDown()&&!e.middleButtonDown()&&(this.isPanning=!1),this.isDraggingToScroll&&(this.isDraggingToScroll=!1,this.scene.input.setDefaultCursor("default"))})}setupKeyboardControls(){const e={up:this.scene.input.keyboard.addKey(M.Input.Keyboard.KeyCodes.UP,!1),down:this.scene.input.keyboard.addKey(M.Input.Keyboard.KeyCodes.DOWN,!1),left:this.scene.input.keyboard.addKey(M.Input.Keyboard.KeyCodes.LEFT,!1),right:this.scene.input.keyboard.addKey(M.Input.Keyboard.KeyCodes.RIGHT,!1)},i={w:this.scene.input.keyboard.addKey(M.Input.Keyboard.KeyCodes.W,!1),a:this.scene.input.keyboard.addKey(M.Input.Keyboard.KeyCodes.A,!1),s:this.scene.input.keyboard.addKey(M.Input.Keyboard.KeyCodes.S,!1),d:this.scene.input.keyboard.addKey(M.Input.Keyboard.KeyCodes.D,!1)};this.scene.input.keyboard.addKey(M.Input.Keyboard.KeyCodes.SPACE,!1).on("down",()=>{ai()||this.isZoomedOut||this.centerOnPlayer()}),this.scene.input.keyboard.addKey(M.Input.Keyboard.KeyCodes.F,!1).on("down",()=>{ai()||this.toggleZoomToFit()}),this.scene.events.on("update",()=>{if(this.isZoomedOut||ai())return;const s=10;e.left.isDown||i.a.isDown?this.camera.scrollX=Math.max(0,this.camera.scrollX-s):(e.right.isDown||i.d.isDown)&&(this.camera.scrollX=Math.min(this.worldWidth-this.camera.width,this.camera.scrollX+s)),e.up.isDown||i.w.isDown?this.camera.scrollY=Math.max(0,this.camera.scrollY-s):(e.down.isDown||i.s.isDown)&&(this.camera.scrollY=Math.min(this.worldHeight-this.camera.height,this.camera.scrollY+s))})}centerOnPlayer(){const e=this.scene.data.get("playerSprite");e&&this.camera.centerOn(e.x,e.y)}isDraggingObject(){return this.scene.data.get("isDraggingObject")===!0}getIsZoomedOut(){return this.isZoomedOut}toggleZoomToFit(){this.isZoomedOut?this.resetZoom():this.zoomToFit()}zoomToFit(){if(this.isZoomedOut||this.isAnimating)return;this.savedScrollX=this.camera.scrollX,this.savedScrollY=this.camera.scrollY,this.isZoomedOut=!0,this.isAnimating=!0,In(!0);const e=this.camera.width/this.worldWidth,i=this.camera.height/this.worldHeight;let n=Math.min(e,i);n=Math.max(n,$a);const r=this.worldWidth/2,s=this.worldHeight/2;this.camera.removeBounds(),this.camera.pan(r,s,ii,"Sine.easeInOut"),this.camera.zoomTo(n,ii,"Sine.easeInOut",!1,(a,o)=>{o===1&&(this.isAnimating=!1)})}resetZoom(){if(!this.isZoomedOut||this.isAnimating)return;this.isZoomedOut=!1,this.isAnimating=!0,In(!1);const e=this.savedScrollX+this.camera.width/2,i=this.savedScrollY+this.camera.height/2;this.camera.pan(e,i,ii,"Sine.easeInOut"),this.camera.zoomTo(Za,ii,"Sine.easeInOut",!1,(n,r)=>{r===1&&(this.camera.setBounds(0,0,this.worldWidth,this.worldHeight),this.isAnimating=!1)})}destroy(){}}const mi=40,Ya=48,An=5,Wa=Ye.PLAYER,Cn=100,Xa=4871528,Ga=.4,Ka=1,Rr=Ye.GRID_OVERLAY,Ti=16711680,za=2,Fa=.6,Ua=.1,Va=1,qa=.2,Tn=50,ja=50,Ja=10,Qa=4886754;class eo{scene;player;worldWidth;worldHeight;groundY;unsubscribers=[];constructor(e,i,n){this.scene=e,this.worldWidth=i,this.worldHeight=n,this.groundY=n-mi}create(e,i){this.player=this.scene.add.sprite(e,i,"cat-idle-white",0),this.player.setScale(An),this.player.setDepth(Wa);const n=new M.Geom.Rectangle(8,4,32,40);return this.player.setInteractive({hitArea:n,hitAreaCallback:M.Geom.Rectangle.Contains,draggable:!0,cursor:"grab"}),this.scene.data.set("playerSprite",this.player),this.setupDragHandlers(),this.setupEditModeSubscription(),this.player}setupEditModeSubscription(){const e=qt.subscribe(i=>{if(i==="dialogs")this.player.disableInteractive(),this.player.setAlpha(.6);else{const n=new M.Geom.Rectangle(8,4,32,40);this.player.setInteractive({hitArea:n,hitAreaCallback:M.Geom.Rectangle.Contains,draggable:!0,cursor:"grab"}),this.player.setAlpha(1)}});this.unsubscribers.push(e)}setupDragHandlers(){this.player.on("dragstart",()=>{this.player.setTint(Qa),this.scene.data.set("isDraggingObject",!0)}),this.player.on("drag",(e,i,n)=>{const r=M.Math.Clamp(i,Tn,this.worldWidth-Tn),s=M.Math.Clamp(n,ja,this.worldHeight-Ja);this.player.setPosition(r,s),Sn(Math.round(r),Math.round(s))}),this.player.on("dragend",()=>{this.player.clearTint(),this.scene.data.set("isDraggingObject",!1);let e=this.player.y;const i=Ya*An;this.player.y+i/2>this.groundY&&(e=this.groundY-i/2,this.player.setY(e)),Sn(Math.round(this.player.x),Math.round(e))})}getSprite(){return this.player}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.player&&this.player.destroy()}}class to{scene;graphics;worldWidth;worldHeight;constructor(e,i,n){this.scene=e,this.worldWidth=i,this.worldHeight=n}create(){return this.graphics=this.scene.add.graphics(),this.graphics.setDepth(Rr),this.draw(),this.graphics}draw(){this.graphics.clear(),this.graphics.lineStyle(Ka,Xa,Ga);const e=Math.max(this.worldHeight,this.scene.scale.height);for(let n=0;n<=this.worldWidth;n+=Cn)this.graphics.beginPath(),this.graphics.moveTo(n,0),this.graphics.lineTo(n,e),this.graphics.strokePath();for(let n=0;n<=e;n+=Cn)this.graphics.beginPath(),this.graphics.moveTo(0,n),this.graphics.lineTo(this.worldWidth,n),this.graphics.strokePath();const i=this.worldHeight-mi;this.graphics.lineStyle(za,Ti,Fa),this.graphics.beginPath(),this.graphics.moveTo(0,i),this.graphics.lineTo(this.worldWidth,i),this.graphics.strokePath(),this.graphics.lineStyle(Va,Ti,qa),this.graphics.fillStyle(Ti,Ua),this.graphics.fillRect(0,i,this.worldWidth,e-i)}getGraphics(){return this.graphics}redraw(){this.draw()}destroy(){this.graphics&&this.graphics.destroy()}}class io{listeners=new Map;on(e,i){this.listeners.has(e)||this.listeners.set(e,new Set);const n=this.listeners.get(e);return n.add(i),{unsubscribe:()=>{n.delete(i),n.size===0&&this.listeners.delete(e)}}}once(e,i){const n=this.on(e,r=>{n.unsubscribe(),i(r)});return n}emit(e,i){const n=this.listeners.get(e);n&&n.forEach(r=>{try{r(i)}catch(s){console.error(`[EventBus] Error in listener for "${e}":`,s)}})}off(e){this.listeners.delete(e)}clear(){this.listeners.clear()}listenerCount(e){return this.listeners.get(e)?.size??0}}const ut=new io,dt={ASSET_DROPPED:"asset:dropped",MINIMAP_NAVIGATE:"minimap:navigate",DIALOG_ZONE_CREATE:"dialogZone:create"};class no{scene;groundY;itemManager;unsubscribers=[];constructor(e,i){this.scene=e,this.groundY=i}create(e){return this.itemManager=new vi(this.scene,this.groundY,!0),e&&e.length>0&&this.itemManager.createItems(e),this.setupBackgroundDeselect(),this.setupStoreSubscriptions(),this.setupAssetDropListener(),this.setupDeleteKeys(),this.itemManager}setupBackgroundDeselect(){this.itemManager.setupBackgroundDeselect()}setupStoreSubscriptions(){const e=Cr.subscribe(s=>{this.scene.data.set("selectedItemId",s),this.itemManager.updateSelectionVisuals()});this.unsubscribers.push(e);const i=qt.subscribe(s=>{s==="dialogs"?(sn(),this.itemManager.setInteractiveEnabled(!1)):this.itemManager.setInteractiveEnabled(!0)});this.unsubscribers.push(i);let n=[];const r=ba.subscribe(s=>{if(!s?.placedItems)return;const a=s.placedItems;n.forEach(o=>{a.find(c=>c.id===o.id)||this.itemManager.removeItem(o.id)}),a.forEach(o=>{const l=n.find(c=>c.id===o.id);l&&JSON.stringify(l)!==JSON.stringify(o)&&this.itemManager.updateItem(o.id,o)}),n=a.map(o=>({...o}))});this.unsubscribers.push(r)}setupAssetDropListener(){const e=ut.on(dt.ASSET_DROPPED,i=>{const{assetKey:n,canvasX:r,canvasY:s}=i,o=this.scene.cameras.main.getWorldPoint(r,s),l=o.x,c=o.y;let u="behind";Tr.subscribe(f=>{u=f})();const h=si.createAtWorldPosition(n,l,c,this.groundY,u);Sa(h),this.itemManager.createItem(h),pi(h.id)});this.unsubscribers.push(()=>e.unsubscribe())}setupDeleteKeys(){const e=this.scene.input.keyboard.addKey(M.Input.Keyboard.KeyCodes.DELETE,!1),i=this.scene.input.keyboard.addKey(M.Input.Keyboard.KeyCodes.BACKSPACE,!1),n=()=>{if(ai())return;const r=this.scene.data.get("selectedItemId");r&&Lr(r)};e.on("down",n),i.on("down",n)}getManager(){return this.itemManager}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.itemManager&&this.itemManager.destroy()}}const ni=Rr-1,Ge=50,Mn=150,ro=.3,so=.5,Mi=16,kn=16777215,On=.6,Ln=0;class ao{scene;worldWidth;worldHeight;graphics=null;zoneAreas=new Map;leftHandles=new Map;rightHandles=new Map;dragging=null;unsubscribers=[];createZoneSubscription;currentEditMode="items";currentZones=[];currentSelectedId=null;constructor(e,i,n){this.scene=e,this.worldWidth=i,this.worldHeight=n}create(){this.graphics=this.scene.add.graphics(),this.graphics.setDepth(ni);const e=qt.subscribe(r=>{this.currentEditMode=r,this.render()});this.unsubscribers.push(e);const i=kr.subscribe(r=>{this.currentZones=r,this.render()});this.unsubscribers.push(i);const n=Mr.subscribe(r=>{this.currentSelectedId=r,this.render()});this.unsubscribers.push(n),this.scene.input.on("pointermove",this.handlePointerMove,this),this.scene.input.on("pointerup",this.handlePointerUp,this),this.scene.input.on("pointerdown",this.handlePointerDown,this),this.createZoneSubscription=ut.on(dt.DIALOG_ZONE_CREATE,()=>{this.createNewZone()}),this.render()}clearVisuals(){this.graphics&&this.graphics.clear(),this.zoneAreas.forEach(e=>e.destroy()),this.zoneAreas.clear(),this.leftHandles.forEach(e=>e.destroy()),this.leftHandles.clear(),this.rightHandles.forEach(e=>e.destroy()),this.rightHandles.clear()}render(){if(this.clearVisuals(),this.currentEditMode==="dialogs")for(const e of this.currentZones)this.renderZone(e,e.id===this.currentSelectedId)}renderZone(e,i){if(!this.graphics)return;const n=M.Display.Color.HexStringToColor(e.color).color,r=i?so:ro;this.graphics.fillStyle(n,r),this.graphics.fillRect(e.x,0,e.width,this.worldHeight),this.graphics.lineStyle(2,n,.8),this.graphics.strokeRect(e.x,0,e.width,this.worldHeight);const s=this.scene.add.rectangle(e.x+e.width/2,this.worldHeight/2,e.width-Mi*2,this.worldHeight);s.setOrigin(.5,.5),s.setInteractive({cursor:i?"grab":"pointer"}),s.setDepth(ni+.1),s.setAlpha(.001),s.setData("zoneId",e.id),s.on("pointerdown",a=>{this.scene.data.set("isDraggingItem",!0),this.currentSelectedId===e.id?this.startDrag(e.id,"move",a.worldX):(ri(e.id),this.scene.data.set("isDraggingItem",!1))}),this.zoneAreas.set(e.id,s),i&&this.createHandles(e)}createHandles(e){const i=this.scene.add.rectangle(e.x,this.worldHeight/2,Mi,this.worldHeight);i.setOrigin(.5,.5),i.setInteractive({cursor:"ew-resize"}),i.setDepth(ni+.2),i.setFillStyle(kn,On),i.setData("zoneId",e.id),i.setData("type","left"),i.on("pointerdown",r=>{this.startDrag(e.id,"left",r.worldX)}),this.leftHandles.set(e.id,i);const n=this.scene.add.rectangle(e.x+e.width,this.worldHeight/2,Mi,this.worldHeight);n.setOrigin(.5,.5),n.setInteractive({cursor:"ew-resize"}),n.setDepth(ni+.2),n.setFillStyle(kn,On),n.setData("zoneId",e.id),n.setData("type","right"),n.on("pointerdown",r=>{this.startDrag(e.id,"right",r.worldX)}),this.rightHandles.set(e.id,n)}startDrag(e,i,n){const r=this.currentZones.find(s=>s.id===e);r&&(this.scene.data.set("isDraggingItem",!0),this.dragging={zoneId:e,type:i,startX:n,originalX:r.x,originalWidth:r.width})}getZoneBounds(e){let i=0,n=this.worldWidth;for(const r of this.currentZones){if(r.id===e)continue;const s=r.x+r.width,a=this.currentZones.find(o=>o.id===e);a&&(s<=a.x+a.width/2&&(i=Math.max(i,s+Ln)),r.x>=a.x+a.width/2&&(n=Math.min(n,r.x-Ln)))}return{minX:i,maxX:n-Ge,maxRight:n}}wouldOverlap(e,i,n){const r=i+n;for(const s of this.currentZones){if(s.id===e)continue;const a=s.x,o=s.x+s.width;if(i<o&&r>a)return!0}return!1}handlePointerMove(e){if(!this.dragging)return;e.event?.stopPropagation?.();const i=e.worldX-this.dragging.startX,n=this.currentZones.find(s=>s.id===this.dragging?.zoneId);if(!n)return;const r=this.getZoneBounds(n.id);if(this.dragging.type==="left"){let s=this.dragging.originalX+i,a=this.dragging.originalWidth-i;if(s<0&&(a+=s,s=0),a<Ge&&(s=this.dragging.originalX+this.dragging.originalWidth-Ge,a=Ge),s<r.minX){const o=r.minX-s;s=r.minX,a-=o}a>=Ge&&!this.wouldOverlap(n.id,s,a)&&$t(n.id,{x:s,width:a})}else if(this.dragging.type==="right"){let s=this.dragging.originalWidth+i;s<Ge&&(s=Ge),n.x+s>this.worldWidth&&(s=this.worldWidth-n.x),n.x+s>r.maxRight&&(s=r.maxRight-n.x),s>=Ge&&!this.wouldOverlap(n.id,n.x,s)&&$t(n.id,{width:s})}else if(this.dragging.type==="move"){let s=this.dragging.originalX+i;const a=n.width;if(s<0&&(s=0),s+a>this.worldWidth&&(s=this.worldWidth-a),!this.wouldOverlap(n.id,s,a))$t(n.id,{x:s});else{const o=this.findNonOverlappingPosition(n.id,s,a);o!==null&&$t(n.id,{x:o})}}}findNonOverlappingPosition(e,i,n){const r=this.currentZones.filter(u=>u.id!==e).sort((u,g)=>u.x-g.x);if(r.length===0)return Math.max(0,Math.min(i,this.worldWidth-n));let s=i,a=1/0;const o=r[0];if(o.x>=n){const u=o.x-n,g=Math.max(0,Math.min(i,u)),h=Math.abs(g-i);h<a&&(a=h,s=g)}for(let u=0;u<r.length-1;u++){const g=r[u],h=r[u+1],f=g.x+g.width,p=h.x;if(p-f>=n){const D=f,k=p-n,T=Math.max(D,Math.min(i,k)),R=Math.abs(T-i);R<a&&(a=R,s=T)}}const l=r[r.length-1],c=l.x+l.width;if(this.worldWidth-c>=n){const u=c,g=this.worldWidth-n,h=Math.max(u,Math.min(i,g)),f=Math.abs(h-i);f<a&&(a=f,s=h)}return a<1/0&&!this.wouldOverlap(e,s,n)?s:null}handlePointerUp(){this.dragging&&this.scene.data.set("isDraggingItem",!1),this.dragging=null}handlePointerDown(e){if(this.currentEditMode!=="dialogs"||this.dragging)return;const i=e.downElement;if(i&&i.tagName?.toUpperCase()!=="CANVAS")return;const n=e.worldX;for(const r of this.currentZones)if(n>=r.x&&n<=r.x+r.width)return;this.currentSelectedId&&ri(null)}createNewZone(){const e=this.scene.cameras.main;let n=e.scrollX+e.width/2-Mn/2;const r=Mn;if(n=Math.max(0,Math.min(this.worldWidth-r,n)),this.wouldOverlap("",n,r)){const a=this.findNonOverlappingPosition("",n,r);if(a===null){console.warn("No room for a new dialog zone");return}n=a}const s=oa(n,r);s.x=n,Ma(s),ri(s.id)}destroy(){for(const e of this.unsubscribers)e();this.unsubscribers=[],this.createZoneSubscription&&this.createZoneSubscription.unsubscribe(),this.scene.input.off("pointerdown",this.handlePointerDown,this),this.scene.input.off("pointermove",this.handlePointerMove,this),this.scene.input.off("pointerup",this.handlePointerUp,this),this.clearVisuals(),this.graphics&&(this.graphics.destroy(),this.graphics=null),this.dragging=null}}class oo extends M.Scene{parallaxLayers=null;cameraController;playerController;gridOverlay;itemsController;dialogZoneRenderer;config;minimapSubscription;isShuttingDown=!1;get itemManager(){return this.itemsController?.getManager()}toggleZoom(){this.cameraController?.toggleZoomToFit()}constructor(){super({key:$e.BUILDER})}init(e){this.config=e.config}preload(){this.load.spritesheet("cat-idle-white","assets/sprites/white/Idle.png",{frameWidth:48,frameHeight:48}),vi.preloadAssets(this)}create(){this.isShuttingDown=!1,this.physics.world.setBounds(0,0,this.config.worldWidth,this.config.worldHeight);const e=this.config.worldHeight-mi;this.cameraController=new Ba(this,this.config.worldWidth,this.config.worldHeight),this.playerController=new eo(this,this.config.worldWidth,this.config.worldHeight),this.gridOverlay=new to(this,this.config.worldWidth,this.config.worldHeight),this.itemsController=new no(this,e),this.dialogZoneRenderer=new ao(this,this.config.worldWidth,this.config.worldHeight),this.createBackground(),this.gridOverlay.create(),this.createGroundReference(),this.playerController.create(this.config.playerStartX,this.config.playerStartY),this.itemsController.create(this.config.placedItems||[]),this.dialogZoneRenderer.create(),this.cameraController.setup(),this.cameraController.centerOn(this.config.playerStartX,this.config.playerStartY),this.minimapSubscription=ut.on(dt.MINIMAP_NAVIGATE,i=>{this.navigateToPosition(i.worldX,i.worldY)}),this.scale.on("resize",this.handleResize,this),this.events.on("shutdown",this.shutdown,this)}async createBackground(){const e=gi.getCurrentConfig();try{await xr(this,e)}catch(i){console.error("Failed to load background:",i);return}this.parallaxLayers&&(_a(this.parallaxLayers),this.parallaxLayers=null),this.parallaxLayers=Dr(this,this.config.worldWidth,this.config.worldHeight,e)}createGroundReference(){Kt.createVisualGround(this,{worldWidth:this.config.worldWidth,worldHeight:this.config.worldHeight,height:mi})}update(){this.parallaxLayers&&Ar(this.parallaxLayers.baseLayer,this.cameras.main);const e=this.cameras.main,i=this.data.get("playerSprite");Ca({scrollX:e.scrollX,scrollY:e.scrollY,viewWidth:e.width,viewHeight:e.height,worldWidth:this.config.worldWidth,worldHeight:this.config.worldHeight,zoom:e.zoom,playerX:i?.x??this.config.playerStartX,playerY:i?.y??this.config.playerStartY})}navigateToPosition(e,i){this.cameraController.getIsZoomedOut()||this.cameraController.centerOn(e,i)}handleResize(e){if(!(!this.cameras?.main||!this.config)){if(this.cameraController?.getIsZoomedOut()||this.cameras.main.setBounds(0,0,this.config.worldWidth,this.config.worldHeight),this.parallaxLayers?.baseLayer){const i=Math.max(this.config.worldHeight,e.height);this.parallaxLayers.baseLayer.setSize(this.config.worldWidth,i)}this.gridOverlay&&this.gridOverlay.redraw()}}shutdown(){this.isShuttingDown||(this.isShuttingDown=!0,this.scale.off("resize",this.handleResize,this),this.minimapSubscription&&this.minimapSubscription.unsubscribe(),this.cameraController&&this.cameraController.destroy(),this.playerController&&this.playerController.destroy(),this.gridOverlay&&this.gridOverlay.destroy(),this.itemsController&&this.itemsController.destroy(),this.dialogZoneRenderer&&this.dialogZoneRenderer.destroy())}}const lo="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(lo);os();class co{currentLanguage="cs";setLanguage(e){this.currentLanguage=e,localStorage.setItem("language",e)}getLanguage(){const e=localStorage.getItem("language");return(e==="cs"||e==="en")&&(this.currentLanguage=e),this.currentLanguage}toggleLanguage(){return this.currentLanguage=this.currentLanguage==="cs"?"en":"cs",this.setLanguage(this.currentLanguage),this.currentLanguage}}const Hr=new co;let fe=null;function uo(t){fe=t}function ho(){if(!fe)return console.error("Scene manager not initialized"),null;try{return fe.scene.getScene($e.GAME)?.mapConfig||null}catch(t){return console.error("Failed to get map config:",t),null}}function fo(t){if(!fe)return console.error("Scene manager not initialized"),!1;try{return fe.scene.getScene($e.GAME)?(fe.scene.stop($e.GAME),xa(t),fe.scene.start($e.BUILDER,{config:t}),!0):(console.error("GameScene not found"),!1)}catch(e){return console.error("Failed to switch to builder:",e),!1}}function go(){if(!fe)return console.error("Scene manager not initialized"),!1;try{return fe.scene.stop($e.BUILDER),Da(),fe.scene.start($e.GAME,{useBuilderConfig:!0}),!0}catch(t){return console.error("Failed to switch to game:",t),!1}}function po(){if(fe)try{fe.scene.getScene($e.BUILDER)?.toggleZoom()}catch(t){console.error("Failed to toggle zoom:",t)}}var vo=Y("<button><!></button>");function be(t,e){let i=ie(e,"position",3,"inline"),n=ie(e,"variant",3,"default"),r=ie(e,"disabled",3,!1),s=ie(e,"title",3,"");const a={default:{base:"#4a90e2",hover:"#357abd",active:"#2a5f8f"},green:{base:"#27ae60",hover:"#229954",active:"#1e8449"},blue:{base:"#3498db",hover:"#2980b9",active:"#21618c"},orange:{base:"#ffa500",hover:"#ff8c00",active:"#e67e00"},red:{base:"#e74c3c",hover:"#c0392b",active:"#a02e22"}},o=pe(()=>a[n()]),l=pe(()=>e.width?`--btn-width: ${e.width};`:"");var c=vo();let u;c.__click=function(...h){e.onclick?.apply(this,h)};var g=N(c);Zi(g,()=>e.children??Re),le(()=>{u=ct(c,1,`pixel-btn pixel-btn--${i()??""}`,"svelte-lwc0vq",u,{disabled:r()}),Ve(c,`${d(l)??""} --color-base: ${d(o).base??""}; --color-hover: ${d(o).hover??""}; --color-active: ${d(o).active??""}`),c.disabled=r(),Et(c,"title",s())}),A(t,c)}Ot(["click"]);var mo=Y('<button class="close-btn svelte-yrmttr" title="Close">×</button>'),_o=Y('<div class="resize-handle resize-handle-sw svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M1 1L9 9M1 5L5 9M1 9L1 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></div> <div class="resize-handle resize-handle-se svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M9 1L1 9M9 5L5 9M9 9L9 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></div>',1),yo=Y("<div><!></div> <!>",1),wo=Y('<div><div class="panel-header svelte-yrmttr"><span class="panel-title svelte-yrmttr"> </span> <!> <div class="header-buttons svelte-yrmttr"><button class="minimize-btn svelte-yrmttr"> </button> <!></div></div> <!></div>');function Nr(t,e){qe(e,!0);let i=ie(e,"initialRight",3,10),n=ie(e,"initialTop",3,60),r=ie(e,"width",3,280),s=ie(e,"minWidth",3,200),a=ie(e,"minHeight",3,100),o=ie(e,"maxWidth",3,600),l=ie(e,"maxHeight",3,800),c=ie(e,"resizable",3,!1),u=ie(e,"startMinimized",3,!1),g=ie(e,"showClose",3,!1),h=B(Pe(u())),f=B(Pe({x:0,y:0})),p=B(Pe({width:r(),height:e.height??0})),b=B(!1),D=B(!1),k=B("se"),T=B(Pe({x:0,y:0})),R=B(null),X=B(!1);Ct(()=>{if(typeof window>"u")return;const I=localStorage.getItem(`panel-state-${e.panelId}`);if(I)try{const H=JSON.parse(I);x(f,{x:H.x,y:H.y},!0),c()&&H.width&&H.height&&x(p,{width:H.width,height:H.height},!0)}catch{x(f,{x:window.innerWidth-r()-i(),y:n()},!0)}else x(f,{x:window.innerWidth-r()-i(),y:n()},!0);x(X,!0)}),Ct(()=>{if(!d(X))return;const I=c()?{...d(f),width:d(p).width,height:d(p).height}:d(f);localStorage.setItem(`panel-state-${e.panelId}`,JSON.stringify(I))});function U(){x(h,!d(h))}function C(){e.onclose?.()}function m(I){I.target.closest("button")||(x(b,!0),x(T,{x:I.clientX-d(f).x,y:I.clientY-d(f).y},!0),I.currentTarget.setPointerCapture(I.pointerId),I.preventDefault())}function P(I){if(!d(b))return;const H=I.clientX-d(T).x,ce=I.clientY-d(T).y,vt=window.innerWidth-(d(R)?.offsetWidth??r()),ke=window.innerHeight-40;x(f,{x:Math.max(0,Math.min(H,vt)),y:Math.max(0,Math.min(ce,ke))},!0)}function y(I){d(b)&&(x(b,!1),I.currentTarget.releasePointerCapture(I.pointerId))}function v(I){return H=>{c()&&(x(D,!0),x(k,I,!0),H.currentTarget.setPointerCapture(H.pointerId),H.preventDefault(),H.stopPropagation())}}function w(I){if(!d(D)||!d(R))return;const H=d(R).getBoundingClientRect();let ce,vt=I.clientY-H.top,ke=d(f).x;d(k)==="se"?ce=I.clientX-H.left:(ce=H.right-I.clientX,ke=I.clientX);const Jt=Math.max(s(),Math.min(o(),ce)),xi=Math.max(a(),Math.min(l(),vt));d(k)==="sw"&&(ke=H.right-Jt,ke<0&&(ke=0));const Rt=d(k)==="se"?window.innerWidth-d(f).x-10:H.right-10,Qt=window.innerHeight-d(f).y-10,et=Math.min(Jt,Rt),Di=Math.min(xi,Qt);x(p,{width:et,height:Di},!0),d(k)==="sw"&&ce>=s()&&x(f,{...d(f),x:Math.max(0,ke)},!0)}function S(I){d(D)&&(x(D,!1),I.currentTarget.releasePointerCapture(I.pointerId))}function _(I){I.stopPropagation()}var E=wo();let Z;E.__pointerdown=_,E.__click=_;var W=N(E);W.__pointerdown=m,W.__pointermove=P,W.__pointerup=y;var te=N(W),Pt=N(te),gt=O(te,2);{var Qe=I=>{var H=Ii(),ce=He(H);Zi(ce,()=>e.headerExtra),A(I,H)};F(gt,I=>{e.headerExtra&&I(Qe)})}var Ei=O(gt,2),pt=N(Ei);pt.__click=U;var Ae=N(pt),Ce=O(pt,2);{var me=I=>{var H=mo();H.__click=C,A(I,H)};F(Ce,I=>{g()&&I(me)})}var Te=O(W,2);{var Me=I=>{var H=yo(),ce=He(H);let vt;var ke=N(ce);Zi(ke,()=>e.children);var Jt=O(ce,2);{var xi=Rt=>{var Qt=_o(),et=He(Qt),Di=pe(()=>v("sw"));et.__pointerdown=function(...Ai){d(Di)?.apply(this,Ai)},et.__pointermove=w,et.__pointerup=S;var ei=O(et,2),Br=pe(()=>v("se"));ei.__pointerdown=function(...Ai){d(Br)?.apply(this,Ai)},ei.__pointermove=w,ei.__pointerup=S,It("pointercancel",et,S),It("pointercancel",ei,S),A(Rt,Qt)};F(Jt,Rt=>{c()&&Rt(xi)})}le(()=>vt=ct(ce,1,"panel-body svelte-yrmttr",null,vt,{"has-fixed-height":c()&&d(p).height>0})),A(I,H)};F(Te,I=>{d(h)||I(Me)})}tn(E,I=>x(R,I),()=>d(R)),le(()=>{Z=ct(E,1,"draggable-panel svelte-yrmttr",null,Z,{minimized:d(h),dragging:d(b),resizing:d(D),resizable:c()}),Ve(E,`left: ${d(f).x??""}px; top: ${d(f).y??""}px; width: ${d(h)?"auto":`${c()?d(p).width:r()}px`}; ${c()&&d(p).height>0&&!d(h)?`height: ${d(p).height}px;`:""}`),Be(Pt,e.title),Et(pt,"title",d(h)?"Expand":"Minimize"),Be(Ae,d(h)?"▲":"▼")}),It("pointercancel",W,y),A(t,E),je()}Ot(["pointerdown","click","pointermove","pointerup"]);var bo=Y('<span class="palette-hint svelte-1ahretz">Drag to place</span>'),So=Y('<div draggable="true" role="button" tabindex="0"><img class="asset-preview svelte-1ahretz"/> <span class="asset-name svelte-1ahretz"> </span></div>'),Io=Y('<div class="palette-content svelte-1ahretz" role="toolbar" tabindex="-1"><div class="palette-grid svelte-1ahretz"></div></div>'),Eo=Y("<!> <!>",1);function xo(t,e){qe(e,!0);const i=()=>Q(qt,"$builderEditMode",n),[n,r]=Lt(),s=an;let a=B(!0),o=B(null),l=B(null);function c(){x(a,!d(a))}function u(m,P){if(!m.dataTransfer)return;x(o,P,!0),m.dataTransfer.effectAllowed="copy",m.dataTransfer.setData("assetKey",P);const v=m.target.querySelector("img")?.cloneNode(!0);v&&(v.style.position="absolute",v.style.top="-1000px",document.body.appendChild(v),m.dataTransfer.setDragImage(v,24,24),setTimeout(()=>v.remove(),0))}function g(){x(o,null)}function h(m,P){if(m.touches.length!==1)return;const y=m.touches[0];x(o,P,!0);const w=m.currentTarget.querySelector("img");if(w){const S=document.createElement("div");S.className="touch-drag-preview",S.innerHTML=`<img src="${w.src}" alt="" />`,S.style.cssText=`
        position: fixed;
        top: ${y.clientY-24}px;
        left: ${y.clientX-24}px;
        width: 48px;
        height: 48px;
        pointer-events: none;
        z-index: 10000;
        opacity: 0.9;
        image-rendering: pixelated;
        filter: drop-shadow(3px 3px 0 rgba(0, 0, 0, 0.5));
        border: 2px solid #4a90e2;
        background: rgba(26, 26, 46, 0.9);
      `,S.querySelector("img").style.cssText=`
        width: 100%;
        height: 100%;
        object-fit: contain;
        image-rendering: pixelated;
      `,document.body.appendChild(S),x(l,S,!0)}}function f(m){if(!d(o)||!d(l))return;const P=m.touches[0];d(l).style.top=`${P.clientY-24}px`,d(l).style.left=`${P.clientX-24}px`,m.preventDefault()}function p(m){if(!d(o))return;const P=m.changedTouches[0],y=document.querySelector("canvas");if(d(l)&&(d(l).remove(),x(l,null)),y){const v=y.getBoundingClientRect(),w=P.clientX,S=P.clientY;if(w>=v.left&&w<=v.right&&S>=v.top&&S<=v.bottom){const _=w-v.left,E=S-v.top;ut.emit(dt.ASSET_DROPPED,{assetKey:d(o),canvasX:_,canvasY:E})}}x(o,null)}function b(m){m.stopPropagation()}function D(m){m.preventDefault(),m.dataTransfer&&(m.dataTransfer.dropEffect="copy")}function k(m){m.preventDefault();const P=m.dataTransfer?.getData("assetKey");if(!P)return;const v=m.target.getBoundingClientRect(),w=m.clientX-v.left,S=m.clientY-v.top;ut.emit(dt.ASSET_DROPPED,{assetKey:P,canvasX:w,canvasY:S})}ia(()=>{const m=document.querySelector("canvas");if(m)return m.addEventListener("dragover",D),m.addEventListener("drop",k),()=>{m.removeEventListener("dragover",D),m.removeEventListener("drop",k)}}),Ct(()=>(document.addEventListener("touchmove",f,{passive:!1}),document.addEventListener("touchend",p),document.addEventListener("touchcancel",p),()=>{document.removeEventListener("touchmove",f),document.removeEventListener("touchend",p),document.removeEventListener("touchcancel",p)}));var T=Eo(),R=He(T);{var X=m=>{{let P=pe(()=>d(a)?"orange":"blue");be(m,{onclick:c,position:"top-right",get variant(){return d(P)},width:"120px",title:"Toggle Asset Palette",children:(y,v)=>{var w=we("ASSETS");A(y,w)},$$slots:{default:!0}})}};F(R,m=>{i()==="items"&&m(X)})}var U=O(R,2);{var C=m=>{Nr(m,{panelId:"asset-palette",title:"Assets",initialRight:10,initialTop:60,width:280,height:400,minWidth:200,minHeight:160,maxWidth:500,maxHeight:600,resizable:!0,headerExtra:y=>{var v=bo();A(y,v)},children:(y,v)=>{var w=Io();w.__pointerdown=b;var S=N(w);Ri(S,21,()=>s,Pi,(_,E)=>{var Z=So();let W;Z.__touchstart=Qe=>h(Qe,d(E).key);var te=N(Z),Pt=O(te,2),gt=N(Pt);le(()=>{W=ct(Z,1,"asset-item svelte-1ahretz",null,W,{dragging:d(o)===d(E).key}),Et(Z,"title",d(E).name),Et(te,"src",d(E).path),Et(te,"alt",d(E).name),Be(gt,d(E).name)}),It("dragstart",Z,Qe=>u(Qe,d(E).key)),It("dragend",Z,g),A(_,Z)}),A(y,w)},$$slots:{headerExtra:!0,default:!0}})};F(U,m=>{d(a)&&i()==="items"&&m(C)})}A(t,T),je(),r()}Ot(["pointerdown","touchstart"]);var Do=Y('<div><div class="minimap-bg svelte-1ycb7lo"></div> <div class="viewport-indicator svelte-1ycb7lo"></div> <div class="player-marker svelte-1ycb7lo"></div> <div class="minimap-frame svelte-1ycb7lo"></div></div>');function Ao(t,e){qe(e,!0);const i=()=>Q(Pr,"$builderCameraInfo",r),n=()=>Q(jt,"$isBuilderZoomedOut",r),[r,s]=Lt(),a=120,o=60,l=200,c=100;let u=B(!1),g=B(null),h=pe(()=>d(u)?l:a),f=pe(()=>d(u)?c:o),p=pe(()=>{const v=i();if(!v||v.worldWidth===0)return"display: none;";const w=d(h)/v.worldWidth,S=d(f)/v.worldHeight,_=v.viewWidth/v.zoom*w,E=v.viewHeight/v.zoom*S,Z=v.scrollX*w,W=v.scrollY*S;return`
      left: ${Math.max(0,Z)}px;
      top: ${Math.max(0,W)}px;
      width: ${Math.min(_,d(h)-Z)}px;
      height: ${Math.min(E,d(f)-W)}px;
    `}),b=pe(()=>{const v=i();if(!v||v.worldWidth===0)return"display: none;";const w=d(h)/v.worldWidth,S=d(f)/v.worldHeight,_=v.playerX*w,E=v.playerY*S;return`
      left: ${_}px;
      top: ${E}px;
    `});function D(v,w){const S=i();if(!S||S.worldWidth===0||!d(g))return;const _=d(g).getBoundingClientRect(),E=v-_.left,Z=w-_.top,W=E/d(h)*S.worldWidth,te=Z/d(f)*S.worldHeight;ut.emit(dt.MINIMAP_NAVIGATE,{worldX:W,worldY:te})}function k(v){v.stopPropagation(),v.preventDefault(),x(u,!0),D(v.clientX,v.clientY),window.addEventListener("mousemove",T),window.addEventListener("mouseup",R)}function T(v){d(u)&&(v.preventDefault(),D(v.clientX,v.clientY))}function R(){x(u,!1),window.removeEventListener("mousemove",T),window.removeEventListener("mouseup",R)}function X(v){v.stopPropagation(),v.preventDefault(),x(u,!0);const w=v.touches[0];D(w.clientX,w.clientY),window.addEventListener("touchmove",U,{passive:!1}),window.addEventListener("touchend",C)}function U(v){if(!d(u))return;v.preventDefault();const w=v.touches[0];D(w.clientX,w.clientY)}function C(){x(u,!1),window.removeEventListener("touchmove",U),window.removeEventListener("touchend",C)}var m=Ii(),P=He(m);{var y=v=>{var w=Do();let S;w.__mousedown=k,w.__touchstart=X;var _=O(N(w),2),E=O(_,2);tn(w,Z=>x(g,Z),()=>d(g)),le(()=>{S=ct(w,1,"minimap-container svelte-1ycb7lo",null,S,{enlarged:d(u)}),Ve(w,`width: ${d(h)??""}px; height: ${d(f)??""}px;`),Ve(_,d(p)),Ve(E,d(b))}),A(v,w)};F(P,v=>{n()||v(y)})}A(t,m),je(),s()}Ot(["mousedown","touchstart"]);var Co=Y('<div class="landscape-hint svelte-ugg786"><div class="hint-content svelte-ugg786"><div class="rotate-icon svelte-ugg786">📱↻</div> <p class="hint-text svelte-ugg786">Rotate your phone for a better experience</p> <button class="dismiss-btn svelte-ugg786">OK</button></div></div>');function To(t){let e=B(!1);function i(){x(e,!0)}var n=Ii(),r=He(n);{var s=a=>{var o=Co(),l=N(o),c=O(N(l),4);c.__click=i,A(a,o)};F(r,a=>{d(e)||a(s)})}A(t,n)}Ot(["click"]);var Mo=Y("<button> </button>"),ko=Y("<button></button>"),Oo=Y('<div class="color-picker svelte-zzlycq"></div>'),Lo=Y('<div class="panel-content svelte-zzlycq"><div class="language-tabs svelte-zzlycq"></div> <div class="form-section svelte-zzlycq"><div class="form-group svelte-zzlycq"><label for="dialog-title" class="svelte-zzlycq">Title</label> <input id="dialog-title" type="text" placeholder="Enter title..." class="svelte-zzlycq"/></div> <div class="form-group svelte-zzlycq"><label for="dialog-content" class="svelte-zzlycq">Content</label> <textarea id="dialog-content" placeholder="Enter dialog text..." rows="6" class="svelte-zzlycq"></textarea></div> <div class="color-section svelte-zzlycq"><span class="color-label-title svelte-zzlycq">Color</span> <button class="color-button svelte-zzlycq" title="Change zone color"><span class="zone-color svelte-zzlycq"></span> <span class="color-label svelte-zzlycq">Change</span></button> <!></div></div> <div class="panel-footer svelte-zzlycq"><!></div></div>'),Po=Y("<!> <!>",1);function Ro(t,e){qe(e,!0);const i=()=>Q(kr,"$dialogZones",r),n=()=>Q(Mr,"$selectedDialogZoneId",r),[r,s]=Lt(),a=[{code:"cs",label:"CZ"},{code:"en",label:"EN"}];let o=B("cs"),l=B(!1),c=pe(()=>i().find(C=>C.id===n())??null),u=pe(()=>d(c)?.texts.find(C=>C.language===d(o))??null);function g(C){const m=C.target;n()&&En(n(),d(o),{title:m.value})}function h(C){const m=C.target;n()&&En(n(),d(o),{content:m.value})}function f(){n()&&ka(n())}function p(){ri(null)}function b(){ut.emit(dt.DIALOG_ZONE_CREATE)}function D(C){n()&&($t(n(),{color:C}),x(l,!1))}function k(){x(l,!d(l))}var T=Po(),R=He(T);be(R,{position:"top-right",variant:"green",width:"120px",onclick:b,title:"Create new dialog zone at center of view",children:(C,m)=>{var P=we("+ ZONE");A(C,P)},$$slots:{default:!0}});var X=O(R,2);{var U=C=>{Nr(C,{panelId:"dialog-zone-panel",title:"Dialog Zone",initialRight:10,initialTop:160,width:280,height:450,minWidth:250,minHeight:370,maxWidth:500,maxHeight:700,resizable:!0,showClose:!0,onclose:p,children:(m,P)=>{var y=Lo(),v=N(y);Ri(v,21,()=>a,Pi,(Ae,Ce)=>{var me=Mo();let Te;me.__click=()=>x(o,d(Ce).code,!0);var Me=N(me);le(()=>{Te=ct(me,1,"lang-tab svelte-zzlycq",null,Te,{active:d(o)===d(Ce).code}),Be(Me,d(Ce).label)}),A(Ae,me)});var w=O(v,2),S=N(w),_=O(N(S),2);_.__input=g;var E=O(S,2),Z=O(N(E),2);Z.__input=h;var W=O(E,2),te=O(N(W),2);te.__click=k;var Pt=N(te),gt=O(te,2);{var Qe=Ae=>{var Ce=Oo();Ri(Ce,21,()=>Yi,Pi,(me,Te)=>{var Me=ko();let I;Me.__click=()=>D(d(Te)),le(()=>{I=ct(Me,1,"color-swatch svelte-zzlycq",null,I,{selected:d(c).color===d(Te)}),Ve(Me,`background: ${d(Te)??""}`),Et(Me,"title",d(Te))}),A(me,Me)}),A(Ae,Ce)};F(gt,Ae=>{d(l)&&Ae(Qe)})}var Ei=O(w,2),pt=N(Ei);be(pt,{variant:"red",onclick:f,children:(Ae,Ce)=>{var me=we("DELETE ZONE");A(Ae,me)},$$slots:{default:!0}}),le(()=>{vn(_,d(u)?.title??""),vn(Z,d(u)?.content??""),Ve(Pt,`background: ${d(c).color??""}`)}),A(m,y)},$$slots:{default:!0}})};F(X,C=>{d(c)&&C(U)})}A(t,T),je(),s()}Ot(["click","input"]);var Ho=Y('<div class="item-controls svelte-1vm8op7"><!> <!></div>'),No=Y('<!> <!> <!> <div class="top-left-buttons svelte-1vm8op7"><!> <!></div> <!> <!>',1);function $o(t,e){qe(e,!1);const i=()=>Q(Cr,"$selectedItemId",a),n=()=>Q(Tr,"$itemDepthLayer",a),r=()=>Q(qt,"$builderEditMode",a),s=()=>Q(jt,"$isBuilderZoomedOut",a),[a,o]=Lt();function l(){go()}function c(){po()}function u(){if(!i())return;const y=n()==="behind"?"front":"behind",v=Ir(y);Ia(),Ea(i(),v)}function g(){i()&&(Lr(i()),sn())}function h(){Ta()}nn();var f=No(),p=He(f);{var b=y=>{xo(y,{})},D=y=>{Ro(y,{})};F(p,y=>{r()==="items"?y(b):y(D,!1)})}var k=O(p,2);Ao(k,{});var T=O(k,2);To(T);var R=O(T,2),X=N(R);be(X,{variant:"green",width:"100px",onclick:l,children:(y,v)=>{var w=we("SAVE");A(y,w)},$$slots:{default:!0}});var U=O(X,2);{let y=Bt(()=>s()?"orange":"blue");be(U,{get variant(){return d(y)},width:"80px",onclick:c,title:"Toggle zoom (F)",children:(v,w)=>{var S=we();le(()=>Be(S,s()?"1:1":"FIT")),A(v,S)},$$slots:{default:!0}})}var C=O(R,2);{let y=Bt(()=>r()==="dialogs"?"orange":"blue");be(C,{position:"stack-2",get variant(){return d(y)},onclick:h,title:"Toggle edit mode: items or dialog zones",children:(v,w)=>{var S=we("DIALOGS");A(v,S)},$$slots:{default:!0}})}var m=O(C,2);{var P=y=>{var v=Ho(),w=N(v);{let _=Bt(()=>n()==="behind"?"blue":"orange");be(w,{get variant(){return d(_)},title:"Toggle item depth: behind or in front of player",onclick:u,children:(E,Z)=>{var W=we();le(()=>Be(W,n()==="behind"?"Behind":"Front")),A(E,W)},$$slots:{default:!0}})}var S=O(w,2);be(S,{variant:"red",title:"Delete selected item",onclick:g,children:(_,E)=>{var Z=we("DELETE");A(_,Z)},$$slots:{default:!0}}),A(y,v)};F(m,y=>{r()==="items"&&i()&&y(P)})}A(t,f),je(),o()}var Zo=Y('<div class="dialog-title svelte-1jd14ss"> </div>'),Bo=Y('<div class="dialog-content svelte-1jd14ss"> </div>'),Yo=Y('<div class="dialog-bubble svelte-1jd14ss"><!> <!></div>');function Wo(t,e){qe(e,!1);const i=()=>Q(da,"$activeDialogText",n),[n,r]=Lt();nn();var s=Ii(),a=He(s);{var o=l=>{var c=Yo();Ve(c,"max-width: 300px; max-height: 200px;");var u=N(c);{var g=p=>{var b=Zo(),D=N(b);le(()=>Be(D,i().title)),A(p,b)};F(u,p=>{i().title&&p(g)})}var h=O(u,2);{var f=p=>{var b=Bo(),D=N(b);le(()=>Be(D,i().content)),A(p,b)};F(h,p=>{i().content&&p(f)})}A(l,c)};F(a,l=>{i()&&l(o)})}A(t,s),je(),r()}var Xo=Y('<div class="touch-controls"><p class="touch-text">Tap and hold<br/>where you want<br/>to move</p></div>'),Go=Y('<div class="desktop-controls"><div class="key-row"><div class="pixel-key">A</div> <div class="pixel-key">W</div> <div class="pixel-key">D</div></div> <p class="or-text">or</p> <div class="key-row"><div class="pixel-key">←</div> <div class="pixel-key">↑</div> <div class="pixel-key">→</div></div></div>'),Ko=Y('<div class="loader-overlay"><div class="pixel-loader"></div></div>'),zo=Y('<div class="game-ui-wrapper svelte-13dvmla"><!> <!> <!> <dialog class="pixel-dialog"><h1>CONTROLS</h1> <div class="controls-content"><!></div></dialog> <!></div>');function Fo(t,e){qe(e,!1);const i=()=>Q(Nt,"$showControlsDialog",l),n=()=>Q(br,"$hasPlayerMoved",l),r=()=>Q(wa,"$isBuilderMode",l),s=()=>Q(fi,"$currentLanguage",l),a=()=>Q(wr,"$isTouchDevice",l),o=()=>Q(Wi,"$isLoading",l),[l,c]=Lt();let u=qi();function g(){const _=Hr.toggleLanguage();fi.set(_)}function h(_){!d(u)?.open||_.target.closest(".pixel-button")||Nt.set(!1)}function f(){const _=ho();if(!_){console.error("Cannot enter builder mode: map config not found");return}fo(_)}fn(()=>(d(u),i()),()=>{d(u)&&(i()?d(u).showModal():d(u).close())}),fn(()=>(n(),d(u),Nt),()=>{n()&&d(u)?.open&&Nt.set(!1)}),Bs(),nn();var p=zo();It("pointerdown",Xn,h);var b=N(p);{var D=_=>{$o(_,{})},k=_=>{Wo(_,{})};F(b,_=>{r()?_(D):_(k,!1)})}var T=O(b,2);{var R=_=>{be(_,{position:"top-left",variant:"green",width:"120px",onclick:f,title:"Toggle Builder Mode",children:(E,Z)=>{var W=we("BUILD");A(E,W)},$$slots:{default:!0}})};F(T,_=>{r()||_(R)})}var X=O(T,2);{var U=_=>{be(_,{position:"top-right",variant:"default",width:"100px",onclick:g,title:"Toggle Language (L)",children:(E,Z)=>{var W=we();le(te=>Be(W,te),[()=>(s(),ft(()=>s().toUpperCase()))]),A(E,W)},$$slots:{default:!0}})};F(X,_=>{r()||_(U)})}var C=O(X,2),m=O(N(C),2),P=N(m);{var y=_=>{var E=Xo();A(_,E)},v=_=>{var E=Go();A(_,E)};F(P,_=>{a()?_(y):_(v,!1)})}tn(C,_=>x(u,_),()=>d(u));var w=O(C,2);{var S=_=>{var E=Ko();A(_,E)};F(w,_=>{o()&&_(S)})}A(t,p),je(),c()}const $r=document.getElementById("game-ui");if(!$r)throw new Error("game-ui element not found!");Us(Fo,{target:$r});fi.set(Hr.getLanguage());ca.set(Er.getSkin());ua.set(gi.getCurrentConfig().name);const Uo={type:M.AUTO,width:800,height:600,parent:"game-container",backgroundColor:"#000000",pixelArt:!0,roundPixels:!0,scale:{mode:M.Scale.RESIZE,autoCenter:M.Scale.CENTER_BOTH},physics:{default:"arcade",arcade:{gravity:{y:800,x:0},debug:!1}},audio:{noAudio:!0},scene:[Na,oo]},Zr=new M.Game(Uo);uo(Zr);const Vo=Zr.device.input.touch;wr.set(Vo);const qo=performance.getEntriesByType("navigation")[0]&&performance.getEntriesByType("navigation")[0].type==="reload",jo=sessionStorage.getItem("hasSeenControlsHint");(!jo||qo)&&(sessionStorage.setItem("hasSeenControlsHint","true"),Nt.set(!0));
//# sourceMappingURL=index-EaoaB87X.js.map
