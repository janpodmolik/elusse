import{r as So,g as xo}from"./phaser-DFK5Ua9d.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();var Eo=So();const Y=xo(Eo),Ft=[{id:"cat_blue",name:"BLUE CAT",folder:"cat_blue",character:"cat",format:"spritesheet"},{id:"cat_orange",name:"ORANGE CAT",folder:"cat_orange",character:"cat",format:"spritesheet"},{id:"cat_white",name:"WHITE CAT",folder:"cat_white",character:"cat",format:"spritesheet"},{id:"dog_blue",name:"BLUE DOG",folder:"dog_blue",character:"dog",format:"spritesheet"},{id:"dog_yellow",name:"YELLOW DOG",folder:"dog_yellow",character:"dog",format:"spritesheet"},{id:"cowboy_girl",name:"COWBOY GIRL",folder:"cowboy_girl",character:"human",format:"gif",frameRates:{idle:8,run:12}},{id:"student_med",name:"MED STUDENT",folder:"student_med",character:"human",format:"gif",frameRates:{idle:8,run:12}}],Br="cat_orange";class Io{currentSkinId=Br;constructor(){this.loadFromStorage()}loadFromStorage(){const e=localStorage.getItem("playerSkin");e&&this.isValidSkinId(e)&&(this.currentSkinId=e)}isValidSkinId(e){return Ft.some(t=>t.id===e)}setSkin(e){this.isValidSkinId(e)&&(this.currentSkinId=e,localStorage.setItem("playerSkin",e))}getSkinId(){return this.currentSkinId}getSkinConfig(){return Ft.find(e=>e.id===this.currentSkinId)||Ft[0]}getSkinById(e){return Ft.find(t=>t.id===e)}getAllSkins(){return Ft}getAnimationPrefix(){const e=this.getSkinConfig();return`${e.character}-${e.id}`}}const ei=new Io,us=!1;var xs=Array.isArray,Co=Array.prototype.indexOf,Es=Array.from,Nr=Object.defineProperty,Un=Object.getOwnPropertyDescriptor,Zr=Object.getOwnPropertyDescriptors,To=Object.prototype,ko=Array.prototype,Is=Object.getPrototypeOf,Vs=Object.isExtensible;const mt=()=>{};function Do(n){return n()}function Ti(n){for(var e=0;e<n.length;e++)n[e]()}function Yr(){var n,e,t=new Promise((i,s)=>{n=i,e=s});return{promise:t,resolve:n,reject:e}}function Wr(n,e){if(Array.isArray(n))return n;if(!(Symbol.iterator in n))return Array.from(n);const t=[];for(const i of n)if(t.push(i),t.length===e)break;return t}const Ge=2,Cs=4,Xi=8,Po=1<<24,Nt=16,Zt=32,pn=64,Bi=128,_t=512,We=1024,st=2048,At=4096,lt=8192,Gt=16384,Ts=32768,dn=65536,js=1<<17,zr=1<<18,Rn=1<<19,Gr=1<<20,un=32768,hs=1<<21,ks=1<<22,Kt=1<<23,Ut=Symbol("$state"),Ao=Symbol(""),xn=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Kr(n){return n===this.v}function Ur(n,e){return n!=n?e==e:n!==e||n!==null&&typeof n=="object"||typeof n=="function"}function Vr(n){return!Ur(n,this.v)}function jr(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Mo(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function $o(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Lo(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Oo(n){throw new Error("https://svelte.dev/e/effect_orphan")}function Ro(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Fo(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Ho(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Xo(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function Bo(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}let fi=!1,No=!1;function Zo(){fi=!0}const Yo=1,Wo=2,zo=16,Go=1,Ko=2,Ke=Symbol(),Uo="http://www.w3.org/1999/xhtml";let ve=null;function Pn(n){ve=n}function we(n,e=!1,t){ve={p:ve,i:!1,c:null,e:null,s:n,x:null,l:fi&&!e?{s:null,u:null,$:[]}:null}}function Se(n){var e=ve,t=e.e;if(t!==null){e.e=null;for(var i of t)_a(i)}return e.i=!0,ve=e.p,{}}function gi(){return!fi||ve!==null&&ve.l===null}let En=[];function Vo(){var n=En;En=[],Ti(n)}function pi(n){if(En.length===0){var e=En;queueMicrotask(()=>{e===En&&Vo()})}En.push(n)}function jo(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function qo(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function et(n){if(typeof n!="object"||n===null||Ut in n)return n;const e=Is(n);if(e!==To&&e!==ko)return n;var t=new Map,i=xs(n),s=K(0),r=ln,a=o=>{if(ln===r)return o();var l=ee,d=ln;nt(null),tr(r);var u=o();return nt(l),tr(d),u};return i&&t.set("length",K(n.length)),new Proxy(n,{defineProperty(o,l,d){(!("value"in d)||d.configurable===!1||d.enumerable===!1||d.writable===!1)&&Fo();var u=t.get(l);return u===void 0?u=a(()=>{var h=K(d.value);return t.set(l,h),h}):$(u,d.value,!0),!0},deleteProperty(o,l){var d=t.get(l);if(d===void 0){if(l in o){const u=a(()=>K(Ke));t.set(l,u),Vn(s)}}else $(d,Ke),Vn(s);return!0},get(o,l,d){if(l===Ut)return n;var u=t.get(l),h=l in o;if(u===void 0&&(!h||Un(o,l)?.writable)&&(u=a(()=>{var p=et(h?o[l]:Ke),g=K(p);return g}),t.set(l,u)),u!==void 0){var f=c(u);return f===Ke?void 0:f}return Reflect.get(o,l,d)},getOwnPropertyDescriptor(o,l){var d=Reflect.getOwnPropertyDescriptor(o,l);if(d&&"value"in d){var u=t.get(l);u&&(d.value=c(u))}else if(d===void 0){var h=t.get(l),f=h?.v;if(h!==void 0&&f!==Ke)return{enumerable:!0,configurable:!0,value:f,writable:!0}}return d},has(o,l){if(l===Ut)return!0;var d=t.get(l),u=d!==void 0&&d.v!==Ke||Reflect.has(o,l);if(d!==void 0||ie!==null&&(!u||Un(o,l)?.writable)){d===void 0&&(d=a(()=>{var f=u?et(o[l]):Ke,p=K(f);return p}),t.set(l,d));var h=c(d);if(h===Ke)return!1}return u},set(o,l,d,u){var h=t.get(l),f=l in o;if(i&&l==="length")for(var p=d;p<h.v;p+=1){var g=t.get(p+"");g!==void 0?$(g,Ke):p in o&&(g=a(()=>K(Ke)),t.set(p+"",g))}if(h===void 0)(!f||Un(o,l)?.writable)&&(h=a(()=>K(void 0)),$(h,et(d)),t.set(l,h));else{f=h.v!==Ke;var v=a(()=>et(d));$(h,v)}var w=Reflect.getOwnPropertyDescriptor(o,l);if(w?.set&&w.set.call(u,d),!f){if(i&&typeof l=="string"){var m=t.get("length"),_=Number(l);Number.isInteger(_)&&_>=m.v&&$(m,_+1)}Vn(s)}return!0},ownKeys(o){c(s);var l=Reflect.ownKeys(o).filter(h=>{var f=t.get(h);return f===void 0||f.v!==Ke});for(var[d,u]of t)u.v!==Ke&&!(d in o)&&l.push(d);return l},setPrototypeOf(){Ho()}})}function qs(n){try{if(n!==null&&typeof n=="object"&&Ut in n)return n[Ut]}catch{}return n}function Jo(n,e){return Object.is(qs(n),qs(e))}var Js,qr,Jr,Qr,ea;function Qo(){if(Js===void 0){Js=window,qr=document,Jr=/Firefox/.test(navigator.userAgent);var n=Element.prototype,e=Node.prototype,t=Text.prototype;Qr=Un(e,"firstChild").get,ea=Un(e,"nextSibling").get,Vs(n)&&(n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__style=void 0,n.__e=void 0),Vs(t)&&(t.__t=void 0)}}function Bt(n=""){return document.createTextNode(n)}function ki(n){return Qr.call(n)}function mi(n){return ea.call(n)}function A(n,e){return ki(n)}function de(n,e=!1){{var t=ki(n);return t instanceof Comment&&t.data===""?mi(t):t}}function P(n,e=1,t=!1){let i=n;for(;e--;)i=mi(i);return i}function el(n){n.textContent=""}function ta(){return!1}function na(n){var e=ie;if(e===null)return ee.f|=Kt,n;if((e.f&Ts)===0){if((e.f&Bi)===0)throw n;e.b.error(n)}else An(n,e)}function An(n,e){for(;e!==null;){if((e.f&Bi)!==0)try{e.b.error(n);return}catch(t){n=t}e=e.parent}throw n}const _i=new Set;let _e=null,ht=null,It=[],Ds=null,fs=!1;class Tt{committed=!1;current=new Map;previous=new Map;#e=new Set;#t=new Set;#i=0;#n=0;#l=null;#r=[];#s=[];skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#n>0}process(e){It=[],this.apply();var t={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const i of e)this.#a(i,t);this.is_fork||this.#d(),this.is_deferred()?(this.#o(t.effects),this.#o(t.render_effects),this.#o(t.block_effects)):(_e=null,Qs(t.render_effects),Qs(t.effects),this.#l?.resolve()),ht=null}#a(e,t){e.f^=We;for(var i=e.first;i!==null;){var s=i.f,r=(s&(Zt|pn))!==0,a=r&&(s&We)!==0,o=a||(s&lt)!==0||this.skipped_effects.has(i);if((i.f&Bi)!==0&&i.b?.is_pending()&&(t={parent:t,effect:i,effects:[],render_effects:[],block_effects:[]}),!o&&i.fn!==null){r?i.f^=We:(s&Cs)!==0?t.effects.push(i):Hn(i)&&((i.f&Nt)!==0&&t.block_effects.push(i),Mn(i));var l=i.first;if(l!==null){i=l;continue}}var d=i.parent;for(i=i.next;i===null&&d!==null;)d===t.effect&&(this.#o(t.effects),this.#o(t.render_effects),this.#o(t.block_effects),t=t.parent),i=d.next,d=d.parent}}#o(e){for(const t of e)((t.f&st)!==0?this.#r:this.#s).push(t),this.#c(t.deps),ze(t,We)}#c(e){if(e!==null)for(const t of e)(t.f&Ge)===0||(t.f&un)===0||(t.f^=un,this.#c(t.deps))}capture(e,t){this.previous.has(e)||this.previous.set(e,t),(e.f&Kt)===0&&(this.current.set(e,e.v),ht?.set(e,e.v))}activate(){_e=this,this.apply()}deactivate(){_e===this&&(_e=null,ht=null)}flush(){if(this.activate(),It.length>0){if(tl(),_e!==null&&_e!==this)return}else this.#i===0&&this.process([]);this.deactivate()}discard(){for(const e of this.#t)e(this);this.#t.clear()}#d(){if(this.#n===0){for(const e of this.#e)e();this.#e.clear()}this.#i===0&&this.#u()}#u(){if(_i.size>1){this.previous.clear();var e=ht,t=!0,i={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const r of _i){if(r===this){t=!1;continue}const a=[];for(const[l,d]of this.current){if(r.current.has(l))if(t&&d!==r.current.get(l))r.current.set(l,d);else continue;a.push(l)}if(a.length===0)continue;const o=[...r.current.keys()].filter(l=>!this.current.has(l));if(o.length>0){var s=It;It=[];const l=new Set,d=new Map;for(const u of a)ia(u,o,l,d);if(It.length>0){_e=r,r.apply();for(const u of It)r.#a(u,i);r.deactivate()}It=s}}_e=null,ht=e}this.committed=!0,_i.delete(this)}increment(e){this.#i+=1,e&&(this.#n+=1)}decrement(e){this.#i-=1,e&&(this.#n-=1),this.revive()}revive(){for(const e of this.#r)ze(e,st),hn(e);for(const e of this.#s)ze(e,At),hn(e);this.#r=[],this.#s=[],this.flush()}oncommit(e){this.#e.add(e)}ondiscard(e){this.#t.add(e)}settled(){return(this.#l??=Yr()).promise}static ensure(){if(_e===null){const e=_e=new Tt;_i.add(_e),Tt.enqueue(()=>{_e===e&&e.flush()})}return _e}static enqueue(e){pi(e)}apply(){}}function tl(){var n=jt;fs=!0;var e=null;try{var t=0;for(Pi(!0);It.length>0;){var i=Tt.ensure();if(t++>1e3){var s,r;nl()}i.process(It),Vt.clear()}}finally{fs=!1,Pi(n),Ds=null}}function nl(){try{Ro()}catch(n){An(n,Ds)}}let Ot=null;function Qs(n){var e=n.length;if(e!==0){for(var t=0;t<e;){var i=n[t++];if((i.f&(Gt|lt))===0&&Hn(i)&&(Ot=new Set,Mn(i),i.deps===null&&i.first===null&&i.nodes_start===null&&(i.teardown===null&&i.ac===null?Sa(i):i.fn=null),Ot?.size>0)){Vt.clear();for(const s of Ot){if((s.f&(Gt|lt))!==0)continue;const r=[s];let a=s.parent;for(;a!==null;)Ot.has(a)&&(Ot.delete(a),r.push(a)),a=a.parent;for(let o=r.length-1;o>=0;o--){const l=r[o];(l.f&(Gt|lt))===0&&Mn(l)}}Ot.clear()}}Ot=null}}function ia(n,e,t,i){if(!t.has(n)&&(t.add(n),n.reactions!==null))for(const s of n.reactions){const r=s.f;(r&Ge)!==0?ia(s,e,t,i):(r&(ks|Nt))!==0&&(r&st)===0&&sa(s,e,i)&&(ze(s,st),hn(s))}}function sa(n,e,t){const i=t.get(n);if(i!==void 0)return i;if(n.deps!==null)for(const s of n.deps){if(e.includes(s))return!0;if((s.f&Ge)!==0&&sa(s,e,t))return t.set(s,!0),!0}return t.set(n,!1),!1}function hn(n){for(var e=Ds=n;e.parent!==null;){e=e.parent;var t=e.f;if(fs&&e===ie&&(t&Nt)!==0&&(t&zr)===0)return;if((t&(pn|Zt))!==0){if((t&We)===0)return;e.f^=We}}It.push(e)}function il(n){let e=0,t=fn(0),i;return()=>{ii()&&(c(t),Yi(()=>(e===0&&(i=Pt(()=>n(()=>Vn(t)))),e+=1,()=>{pi(()=>{e-=1,e===0&&(i?.(),i=void 0,Vn(t))})})))}}var sl=dn|Rn|Bi;function rl(n,e,t){new al(n,e,t)}class al{parent;#e=!1;#t;#i=null;#n;#l;#r;#s=null;#a=null;#o=null;#c=null;#d=null;#u=0;#h=0;#g=!1;#f=null;#y=il(()=>(this.#f=fn(this.#u),()=>{this.#f=null}));constructor(e,t,i){this.#t=e,this.#n=t,this.#l=i,this.parent=ie.b,this.#e=!!this.#n.pending,this.#r=Wi(()=>{ie.b=this;{var s=this.#v();try{this.#s=ut(()=>i(s))}catch(r){this.error(r)}this.#h>0?this.#m():this.#e=!1}return()=>{this.#d?.remove()}},sl)}#b(){try{this.#s=ut(()=>this.#l(this.#t))}catch(e){this.error(e)}this.#e=!1}#w(){const e=this.#n.pending;e&&(this.#a=ut(()=>e(this.#t)),Tt.enqueue(()=>{var t=this.#v();this.#s=this.#p(()=>(Tt.ensure(),ut(()=>this.#l(t)))),this.#h>0?this.#m():(Cn(this.#a,()=>{this.#a=null}),this.#e=!1)}))}#v(){var e=this.#t;return this.#e&&(this.#d=Bt(),this.#t.before(this.#d),e=this.#d),e}is_pending(){return this.#e||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!this.#n.pending}#p(e){var t=ie,i=ee,s=ve;Dt(this.#r),nt(this.#r),Pn(this.#r.ctx);try{return e()}catch(r){return na(r),null}finally{Dt(t),nt(i),Pn(s)}}#m(){const e=this.#n.pending;this.#s!==null&&(this.#c=document.createDocumentFragment(),this.#c.append(this.#d),Ia(this.#s,this.#c)),this.#a===null&&(this.#a=ut(()=>e(this.#t)))}#_(e){if(!this.has_pending_snippet()){this.parent&&this.parent.#_(e);return}this.#h+=e,this.#h===0&&(this.#e=!1,this.#a&&Cn(this.#a,()=>{this.#a=null}),this.#c&&(this.#t.before(this.#c),this.#c=null))}update_pending_count(e){this.#_(e),this.#u+=e,this.#f&&ti(this.#f,this.#u)}get_effect_pending(){return this.#y(),c(this.#f)}error(e){var t=this.#n.onerror;let i=this.#n.failed;if(this.#g||!t&&!i)throw e;this.#s&&(it(this.#s),this.#s=null),this.#a&&(it(this.#a),this.#a=null),this.#o&&(it(this.#o),this.#o=null);var s=!1,r=!1;const a=()=>{if(s){qo();return}s=!0,r&&Bo(),Tt.ensure(),this.#u=0,this.#o!==null&&Cn(this.#o,()=>{this.#o=null}),this.#e=this.has_pending_snippet(),this.#s=this.#p(()=>(this.#g=!1,ut(()=>this.#l(this.#t)))),this.#h>0?this.#m():this.#e=!1};var o=ee;try{nt(null),r=!0,t?.(e,a),r=!1}catch(l){An(l,this.#r&&this.#r.parent)}finally{nt(o)}i&&pi(()=>{this.#o=this.#p(()=>{Tt.ensure(),this.#g=!0;try{return ut(()=>{i(this.#t,()=>e,()=>a)})}catch(l){return An(l,this.#r.parent),null}finally{this.#g=!1}})})}}function ot(n,e){return e}function ol(n,e,t){for(var i=[],s=e.length,r=0;r<s;r++)Ms(e[r].e,i,!0);xa(i,()=>{var a=i.length===0&&t!==null;if(a){var o=t,l=o.parentNode;el(l),l.append(o),n.items.clear(),Et(n,e[0].prev,e[s-1].next)}for(var d=0;d<s;d++){var u=e[d];a||(n.items.delete(u.k),Et(n,u.prev,u.next)),it(u.e,!a)}n.first===e[0]&&(n.first=e[0].prev)})}function tt(n,e,t,i,s,r=null){var a=n,o=new Map,l=null;{var d=n;a=d.appendChild(Bt())}var u=null,h=ra(()=>{var m=t();return xs(m)?m:m==null?[]:Es(m)}),f,p=!0;function g(){ll(w,f,a,e,i),u!==null&&(f.length===0?(u.fragment?(a.before(u.fragment),u.fragment=null):$s(u.effect),v.first=u.effect):Cn(u.effect,()=>{u=null}))}var v=Wi(()=>{f=c(h);for(var m=f.length,_=new Set,S=_e,b=null,y=ta(),E=0;E<m;E+=1){var x=f[E],I=i(x,E),k=p?null:o.get(I);k?(ti(k.v,x),k.i=E,y&&S.skipped_effects.delete(k.e)):(k=cl(p?a:null,b,x,I,E,s,e,t),p&&(k.o=!0,b===null?l=k:b.next=k,b=k),o.set(I,k)),_.add(I)}if(m===0&&r&&!u)if(p)u={fragment:null,effect:ut(()=>r(a))};else{var T=document.createDocumentFragment(),D=Bt();T.append(D),u={fragment:T,effect:ut(()=>r(D))}}if(!p)if(y){for(const[M,O]of o)_.has(M)||S.skipped_effects.add(O.e);S.oncommit(g),S.ondiscard(()=>{})}else g();c(h)}),w={effect:v,items:o,first:l};p=!1}function ll(n,e,t,i,s){var r=e.length,a=n.items,o=n.first,l,d=null,u=[],h=[],f,p,g,v;for(v=0;v<r;v+=1){if(f=e[v],p=s(f,v),g=a.get(p),n.first??=g,!g.o){g.o=!0;var w=d?d.next:o;Et(n,d,g),Et(n,g,w),qi(g,w,t),d=g,u=[],h=[],o=d.next;continue}if((g.e.f&lt)!==0&&$s(g.e),g!==o){if(l!==void 0&&l.has(g)){if(u.length<h.length){var m=h[0],_;d=m.prev;var S=u[0],b=u[u.length-1];for(_=0;_<u.length;_+=1)qi(u[_],m,t);for(_=0;_<h.length;_+=1)l.delete(h[_]);Et(n,S.prev,b.next),Et(n,d,S),Et(n,b,m),o=m,d=b,v-=1,u=[],h=[]}else l.delete(g),qi(g,o,t),Et(n,g.prev,g.next),Et(n,g,d===null?n.first:d.next),Et(n,d,g),d=g;continue}for(u=[],h=[];o!==null&&o.k!==p;)(o.e.f&lt)===0&&(l??=new Set).add(o),h.push(o),o=o.next;if(o===null)continue;g=o}u.push(g),d=g,o=g.next}if(o!==null||l!==void 0){for(var y=l===void 0?[]:Es(l);o!==null;)(o.e.f&lt)===0&&y.push(o),o=o.next;var E=y.length;if(E>0){var x=r===0?t:null;ol(n,y,x)}}}function cl(n,e,t,i,s,r,a,o){var l=(a&Yo)!==0,d=(a&zo)===0,u=l?d?Ct(t,!1,!1):fn(t):t,h=(a&Wo)===0?s:fn(s),f={i:h,v:u,k:i,a:null,e:null,o:!1,prev:e,next:null};try{if(n===null){var p=document.createDocumentFragment();p.append(n=Bt())}return f.e=ut(()=>r(n,u,h,o)),e!==null&&(e.next=f),f}finally{}}function qi(n,e,t){for(var i=n.next?n.next.e.nodes_start:t,s=e?e.e.nodes_start:t,r=n.e.nodes_start;r!==null&&r!==i;){var a=mi(r);s.before(r),r=a}}function Et(n,e,t){e===null?(n.first=t,n.effect.first=t&&t.e):(e.e.next&&(e.e.next.prev=null),e.next=t,e.e.next=t&&t.e),t===null?n.effect.last=e&&e.e:(t.e.prev&&(t.e.prev.next=null),t.prev=e,t.e.prev=e&&e.e)}function dl(n,e,t,i){const s=gi()?Ni:ra;if(t.length===0&&n.length===0){i(e.map(s));return}var r=_e,a=ie,o=ul();function l(){Promise.all(t.map(d=>hl(d))).then(d=>{o();try{i([...e.map(s),...d])}catch(u){(a.f&Gt)===0&&An(u,a)}r?.deactivate(),Di()}).catch(d=>{An(d,a)})}n.length>0?Promise.all(n).then(()=>{o();try{return l()}finally{r?.deactivate(),Di()}}):l()}function ul(){var n=ie,e=ee,t=ve,i=_e;return function(r=!0){Dt(n),nt(e),Pn(t),r&&i?.activate()}}function Di(){Dt(null),nt(null),Pn(null)}function Ni(n){var e=Ge|st,t=ee!==null&&(ee.f&Ge)!==0?ee:null;return ie!==null&&(ie.f|=Rn),{ctx:ve,deps:null,effects:null,equals:Kr,f:e,fn:n,reactions:null,rv:0,v:Ke,wv:0,parent:t??ie,ac:null}}function hl(n,e){let t=ie;t===null&&Mo();var i=t.b,s=void 0,r=fn(Ke),a=!ee,o=new Map;return xl(()=>{var l=Yr();s=l.promise;try{Promise.resolve(n()).then(l.resolve,l.reject).then(()=>{d===_e&&d.committed&&d.deactivate(),Di()})}catch(f){l.reject(f),Di()}var d=_e;if(a){var u=!i.is_pending();i.update_pending_count(1),d.increment(u),o.get(d)?.reject(xn),o.delete(d),o.set(d,l)}const h=(f,p=void 0)=>{if(d.activate(),p)p!==xn&&(r.f|=Kt,ti(r,p));else{(r.f&Kt)!==0&&(r.f^=Kt),ti(r,f);for(const[g,v]of o){if(o.delete(g),g===d)break;v.reject(xn)}}a&&(i.update_pending_count(-1),d.decrement(u))};l.promise.then(h,f=>h(null,f||"unknown"))}),Zi(()=>{for(const l of o.values())l.reject(xn)}),new Promise(l=>{function d(u){function h(){u===s?l(r):d(s)}u.then(h,h)}d(s)})}function B(n){const e=Ni(n);return da(e),e}function ra(n){const e=Ni(n);return e.equals=Vr,e}function aa(n){var e=n.effects;if(e!==null){n.effects=null;for(var t=0;t<e.length;t+=1)it(e[t])}}function fl(n){for(var e=n.parent;e!==null;){if((e.f&Ge)===0)return(e.f&Gt)===0?e:null;e=e.parent}return null}function Ps(n){var e,t=ie;Dt(fl(n));try{n.f&=~un,aa(n),e=ga(n)}finally{Dt(t)}return e}function oa(n){var e=Ps(n);if(n.equals(e)||(_e?.is_fork||(n.v=e),n.wv=ha()),!Fn)if(ht!==null)(ii()||_e?.is_fork)&&ht.set(n,e);else{var t=(n.f&_t)===0?At:We;ze(n,t)}}let gs=new Set;const Vt=new Map;let la=!1;function fn(n,e){var t={f:0,v:n,reactions:null,equals:Kr,rv:0,wv:0};return t}function K(n,e){const t=fn(n);return da(t),t}function Ct(n,e=!1,t=!0){const i=fn(n);return e||(i.equals=Vr),fi&&t&&ve!==null&&ve.l!==null&&(ve.l.s??=[]).push(i),i}function $(n,e,t=!1){ee!==null&&(!kt||(ee.f&js)!==0)&&gi()&&(ee.f&(Ge|Nt|ks|js))!==0&&!Ht?.includes(n)&&Xo();let i=t?et(e):e;return ti(n,i)}function ti(n,e){if(!n.equals(e)){var t=n.v;Fn?Vt.set(n,e):Vt.set(n,t),n.v=e;var i=Tt.ensure();i.capture(n,t),(n.f&Ge)!==0&&((n.f&st)!==0&&Ps(n),ze(n,(n.f&_t)!==0?We:At)),n.wv=ha(),ca(n,st),gi()&&ie!==null&&(ie.f&We)!==0&&(ie.f&(Zt|pn))===0&&(dt===null?pl([n]):dt.push(n)),!i.is_fork&&gs.size>0&&!la&&gl()}return e}function gl(){la=!1;var n=jt;Pi(!0);const e=Array.from(gs);try{for(const t of e)(t.f&We)!==0&&ze(t,At),Hn(t)&&Mn(t)}finally{Pi(n)}gs.clear()}function Vn(n){$(n,n.v+1)}function ca(n,e){var t=n.reactions;if(t!==null)for(var i=gi(),s=t.length,r=0;r<s;r++){var a=t[r],o=a.f;if(!(!i&&a===ie)){var l=(o&st)===0;if(l&&ze(a,e),(o&Ge)!==0){var d=a;ht?.delete(d),(o&un)===0&&(o&_t&&(a.f|=un),ca(d,At))}else l&&((o&Nt)!==0&&Ot!==null&&Ot.add(a),hn(a))}}}function As(n){var e=ee,t=ie;nt(null),Dt(null);try{return n()}finally{nt(e),Dt(t)}}let jt=!1;function Pi(n){jt=n}let Fn=!1;function er(n){Fn=n}let ee=null,kt=!1;function nt(n){ee=n}let ie=null;function Dt(n){ie=n}let Ht=null;function da(n){ee!==null&&(Ht===null?Ht=[n]:Ht.push(n))}let Je=null,at=0,dt=null;function pl(n){dt=n}let ua=1,ni=0,ln=ni;function tr(n){ln=n}function ha(){return++ua}function Hn(n){var e=n.f;if((e&st)!==0)return!0;if(e&Ge&&(n.f&=~un),(e&At)!==0){var t=n.deps;if(t!==null)for(var i=t.length,s=0;s<i;s++){var r=t[s];if(Hn(r)&&oa(r),r.wv>n.wv)return!0}(e&_t)!==0&&ht===null&&ze(n,We)}return!1}function fa(n,e,t=!0){var i=n.reactions;if(i!==null&&!Ht?.includes(n))for(var s=0;s<i.length;s++){var r=i[s];(r.f&Ge)!==0?fa(r,e,!1):e===r&&(t?ze(r,st):(r.f&We)!==0&&ze(r,At),hn(r))}}function ga(n){var e=Je,t=at,i=dt,s=ee,r=Ht,a=ve,o=kt,l=ln,d=n.f;Je=null,at=0,dt=null,ee=(d&(Zt|pn))===0?n:null,Ht=null,Pn(n.ctx),kt=!1,ln=++ni,n.ac!==null&&(As(()=>{n.ac.abort(xn)}),n.ac=null);try{n.f|=hs;var u=n.fn,h=u(),f=n.deps;if(Je!==null){var p;if(Ai(n,at),f!==null&&at>0)for(f.length=at+Je.length,p=0;p<Je.length;p++)f[at+p]=Je[p];else n.deps=f=Je;if(jt&&ii()&&(n.f&_t)!==0)for(p=at;p<f.length;p++)(f[p].reactions??=[]).push(n)}else f!==null&&at<f.length&&(Ai(n,at),f.length=at);if(gi()&&dt!==null&&!kt&&f!==null&&(n.f&(Ge|At|st))===0)for(p=0;p<dt.length;p++)fa(dt[p],n);return s!==null&&s!==n&&(ni++,dt!==null&&(i===null?i=dt:i.push(...dt))),(n.f&Kt)!==0&&(n.f^=Kt),h}catch(g){return na(g)}finally{n.f^=hs,Je=e,at=t,dt=i,ee=s,Ht=r,Pn(a),kt=o,ln=l}}function ml(n,e){let t=e.reactions;if(t!==null){var i=Co.call(t,n);if(i!==-1){var s=t.length-1;s===0?t=e.reactions=null:(t[i]=t[s],t.pop())}}t===null&&(e.f&Ge)!==0&&(Je===null||!Je.includes(e))&&(ze(e,At),(e.f&_t)!==0&&(e.f^=_t,e.f&=~un),aa(e),Ai(e,0))}function Ai(n,e){var t=n.deps;if(t!==null)for(var i=e;i<t.length;i++)ml(n,t[i])}function Mn(n){var e=n.f;if((e&Gt)===0){ze(n,We);var t=ie,i=jt;ie=n,jt=!0;try{(e&(Nt|Po))!==0?El(n):wa(n),ba(n);var s=ga(n);n.teardown=typeof s=="function"?s:null,n.wv=ua;var r;us&&No&&(n.f&st)!==0&&n.deps}finally{jt=i,ie=t}}}function c(n){var e=n.f,t=(e&Ge)!==0;if(ee!==null&&!kt){var i=ie!==null&&(ie.f&Gt)!==0;if(!i&&!Ht?.includes(n)){var s=ee.deps;if((ee.f&hs)!==0)n.rv<ni&&(n.rv=ni,Je===null&&s!==null&&s[at]===n?at++:Je===null?Je=[n]:Je.includes(n)||Je.push(n));else{(ee.deps??=[]).push(n);var r=n.reactions;r===null?n.reactions=[ee]:r.includes(ee)||r.push(ee)}}}if(Fn){if(Vt.has(n))return Vt.get(n);if(t){var a=n,o=a.v;return((a.f&We)===0&&a.reactions!==null||ma(a))&&(o=Ps(a)),Vt.set(a,o),o}}else t&&(!ht?.has(n)||_e?.is_fork&&!ii())&&(a=n,Hn(a)&&oa(a),jt&&ii()&&(a.f&_t)===0&&pa(a));if(ht?.has(n))return ht.get(n);if((n.f&Kt)!==0)throw n.v;return n.v}function pa(n){if(n.deps!==null){n.f^=_t;for(const e of n.deps)(e.reactions??=[]).push(n),(e.f&Ge)!==0&&(e.f&_t)===0&&pa(e)}}function ma(n){if(n.v===Ke)return!0;if(n.deps===null)return!1;for(const e of n.deps)if(Vt.has(e)||(e.f&Ge)!==0&&ma(e))return!0;return!1}function Pt(n){var e=kt;try{return kt=!0,n()}finally{kt=e}}const vl=-7169;function ze(n,e){n.f=n.f&vl|e}function _l(n){if(!(typeof n!="object"||!n||n instanceof EventTarget)){if(Ut in n)ps(n);else if(!Array.isArray(n))for(let e in n){const t=n[e];typeof t=="object"&&t&&Ut in t&&ps(t)}}}function ps(n,e=new Set){if(typeof n=="object"&&n!==null&&!(n instanceof EventTarget)&&!e.has(n)){e.add(n),n instanceof Date&&n.getTime();for(let i in n)try{ps(n[i],e)}catch{}const t=Is(n);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const i=Zr(t);for(let s in i){const r=i[s].get;if(r)try{r.call(n)}catch{}}}}}function va(n){ie===null&&(ee===null&&Oo(),Lo()),Fn&&$o()}function yl(n,e){var t=e.last;t===null?e.last=e.first=n:(t.next=n,n.prev=t,e.last=n)}function Mt(n,e,t){var i=ie;i!==null&&(i.f&lt)!==0&&(n|=lt);var s={ctx:ve,deps:null,nodes_start:null,nodes_end:null,f:n|st|_t,first:null,fn:e,last:null,next:null,parent:i,b:i&&i.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(t)try{Mn(s),s.f|=Ts}catch(o){throw it(s),o}else e!==null&&hn(s);var r=s;if(t&&r.deps===null&&r.teardown===null&&r.nodes_start===null&&r.first===r.last&&(r.f&Rn)===0&&(r=r.first,(n&Nt)!==0&&(n&dn)!==0&&r!==null&&(r.f|=dn)),r!==null&&(r.parent=i,i!==null&&yl(r,i),ee!==null&&(ee.f&Ge)!==0&&(n&pn)===0)){var a=ee;(a.effects??=[]).push(r)}return s}function ii(){return ee!==null&&!kt}function Zi(n){const e=Mt(Xi,null,!1);return ze(e,We),e.teardown=n,e}function Fe(n){va();var e=ie.f,t=!ee&&(e&Zt)!==0&&(e&Ts)===0;if(t){var i=ve;(i.e??=[]).push(n)}else return _a(n)}function _a(n){return Mt(Cs|Gr,n,!1)}function bl(n){return va(),Mt(Xi|Gr,n,!0)}function wl(n){Tt.ensure();const e=Mt(pn|Rn,n,!0);return(t={})=>new Promise(i=>{t.outro?Cn(e,()=>{it(e),i(void 0)}):(it(e),i(void 0))})}function Sl(n){return Mt(Cs,n,!1)}function Rt(n,e){var t=ve,i={effect:null,ran:!1,deps:n};t.l.$.push(i),i.effect=Yi(()=>{n(),!i.ran&&(i.ran=!0,Pt(e))})}function ya(){var n=ve;Yi(()=>{for(var e of n.l.$){e.deps();var t=e.effect;(t.f&We)!==0&&ze(t,At),Hn(t)&&Mn(t),e.ran=!1}})}function xl(n){return Mt(ks|Rn,n,!0)}function Yi(n,e=0){return Mt(Xi|e,n,!0)}function W(n,e=[],t=[],i=[]){dl(i,e,t,s=>{Mt(Xi,()=>n(...s.map(c)),!0)})}function Wi(n,e=0){var t=Mt(Nt|e,n,!0);return t}function ut(n){return Mt(Zt|Rn,n,!0)}function ba(n){var e=n.teardown;if(e!==null){const t=Fn,i=ee;er(!0),nt(null);try{e.call(null)}finally{er(t),nt(i)}}}function wa(n,e=!1){var t=n.first;for(n.first=n.last=null;t!==null;){const s=t.ac;s!==null&&As(()=>{s.abort(xn)});var i=t.next;(t.f&pn)!==0?t.parent=null:it(t,e),t=i}}function El(n){for(var e=n.first;e!==null;){var t=e.next;(e.f&Zt)===0&&it(e),e=t}}function it(n,e=!0){var t=!1;(e||(n.f&zr)!==0)&&n.nodes_start!==null&&n.nodes_end!==null&&(Il(n.nodes_start,n.nodes_end),t=!0),wa(n,e&&!t),Ai(n,0),ze(n,Gt);var i=n.transitions;if(i!==null)for(const r of i)r.stop();ba(n);var s=n.parent;s!==null&&s.first!==null&&Sa(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes_start=n.nodes_end=n.ac=null}function Il(n,e){for(;n!==null;){var t=n===e?null:mi(n);n.remove(),n=t}}function Sa(n){var e=n.parent,t=n.prev,i=n.next;t!==null&&(t.next=i),i!==null&&(i.prev=t),e!==null&&(e.first===n&&(e.first=i),e.last===n&&(e.last=t))}function Cn(n,e,t=!0){var i=[];Ms(n,i,!0),xa(i,()=>{t&&it(n),e&&e()})}function xa(n,e){var t=n.length;if(t>0){var i=()=>--t||e();for(var s of n)s.out(i)}else e()}function Ms(n,e,t){if((n.f&lt)===0){if(n.f^=lt,n.transitions!==null)for(const a of n.transitions)(a.is_global||t)&&e.push(a);for(var i=n.first;i!==null;){var s=i.next,r=(i.f&dn)!==0||(i.f&Zt)!==0&&(n.f&Nt)!==0;Ms(i,e,r?t:!1),i=s}}}function $s(n){Ea(n,!0)}function Ea(n,e){if((n.f&lt)!==0){n.f^=lt,(n.f&We)===0&&(ze(n,st),hn(n));for(var t=n.first;t!==null;){var i=t.next,s=(t.f&dn)!==0||(t.f&Zt)!==0;Ea(t,s?e:!1),t=i}if(n.transitions!==null)for(const r of n.transitions)(r.is_global||e)&&r.in()}}function Ia(n,e){for(var t=n.nodes_start,i=n.nodes_end;t!==null;){var s=t===i?null:mi(t);e.append(t),t=s}}const Cl=["touchstart","touchmove"];function Tl(n){return Cl.includes(n)}const Ca=new Set,ms=new Set;function kl(n,e,t,i={}){function s(r){if(i.capture||zn.call(e,r),!r.cancelBubble)return As(()=>t?.call(this,r))}return n.startsWith("pointer")||n.startsWith("touch")||n==="wheel"?pi(()=>{e.addEventListener(n,s,i)}):e.addEventListener(n,s,i),s}function ft(n,e,t,i,s){var r={capture:i,passive:s},a=kl(n,e,t,r);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&Zi(()=>{e.removeEventListener(n,a,r)})}function yt(n){for(var e=0;e<n.length;e++)Ca.add(n[e]);for(var t of ms)t(n)}let nr=null;function zn(n){var e=this,t=e.ownerDocument,i=n.type,s=n.composedPath?.()||[],r=s[0]||n.target;nr=n;var a=0,o=nr===n&&n.__root;if(o){var l=s.indexOf(o);if(l!==-1&&(e===document||e===window)){n.__root=e;return}var d=s.indexOf(e);if(d===-1)return;l<=d&&(a=l)}if(r=s[a]||n.target,r!==e){Nr(n,"currentTarget",{configurable:!0,get(){return r||t}});var u=ee,h=ie;nt(null),Dt(null);try{for(var f,p=[];r!==null;){var g=r.assignedSlot||r.parentNode||r.host||null;try{var v=r["__"+i];v!=null&&(!r.disabled||n.target===r)&&v.call(r,n)}catch(w){f?p.push(w):f=w}if(n.cancelBubble||g===e||g===null)break;r=g}if(f){for(let w of p)queueMicrotask(()=>{throw w});throw f}}finally{n.__root=e,delete n.currentTarget,nt(u),Dt(h)}}}function Dl(n){var e=document.createElement("template");return e.innerHTML=n.replaceAll("<!>","<!---->"),e.content}function Mi(n,e){var t=ie;t.nodes_start===null&&(t.nodes_start=n,t.nodes_end=e)}function F(n,e){var t=(e&Go)!==0,i=(e&Ko)!==0,s,r=!n.startsWith("<!>");return()=>{s===void 0&&(s=Dl(r?n:"<!>"+n),t||(s=ki(s)));var a=i||Jr?document.importNode(s,!0):s.cloneNode(!0);if(t){var o=ki(a),l=a.lastChild;Mi(o,l)}else Mi(a,a);return a}}function ae(n=""){{var e=Bt(n+"");return Mi(e,e),e}}function He(){var n=document.createDocumentFragment(),e=document.createComment(""),t=Bt();return n.append(e,t),Mi(e,t),n}function C(n,e){n!==null&&n.before(e)}function Te(n,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(n.__t??=n.nodeValue)&&(n.__t=t,n.nodeValue=t+"")}function Pl(n,e){return Al(n,e)}const vn=new Map;function Al(n,{target:e,anchor:t,props:i={},events:s,context:r,intro:a=!0}){Qo();var o=new Set,l=h=>{for(var f=0;f<h.length;f++){var p=h[f];if(!o.has(p)){o.add(p);var g=Tl(p);e.addEventListener(p,zn,{passive:g});var v=vn.get(p);v===void 0?(document.addEventListener(p,zn,{passive:g}),vn.set(p,1)):vn.set(p,v+1)}}};l(Es(Ca)),ms.add(l);var d=void 0,u=wl(()=>{var h=t??e.appendChild(Bt());return rl(h,{pending:()=>{}},f=>{if(r){we({});var p=ve;p.c=r}s&&(i.$$events=s),d=n(f,i)||{},r&&Se()}),()=>{for(var f of o){e.removeEventListener(f,zn);var p=vn.get(f);--p===0?(document.removeEventListener(f,zn),vn.delete(f)):vn.set(f,p)}ms.delete(l),h!==t&&h.parentNode?.removeChild(h)}});return Ml.set(d,u),d}let Ml=new WeakMap;class Ta{anchor;#e=new Map;#t=new Map;#i=new Map;#n=new Set;#l=!0;constructor(e,t=!0){this.anchor=e,this.#l=t}#r=()=>{var e=_e;if(this.#e.has(e)){var t=this.#e.get(e),i=this.#t.get(t);if(i)$s(i),this.#n.delete(t);else{var s=this.#i.get(t);s&&(this.#t.set(t,s.effect),this.#i.delete(t),s.fragment.lastChild.remove(),this.anchor.before(s.fragment),i=s.effect)}for(const[r,a]of this.#e){if(this.#e.delete(r),r===e)break;const o=this.#i.get(a);o&&(it(o.effect),this.#i.delete(a))}for(const[r,a]of this.#t){if(r===t||this.#n.has(r))continue;const o=()=>{if(Array.from(this.#e.values()).includes(r)){var d=document.createDocumentFragment();Ia(a,d),d.append(Bt()),this.#i.set(r,{effect:a,fragment:d})}else it(a);this.#n.delete(r),this.#t.delete(r)};this.#l||!i?(this.#n.add(r),Cn(a,o,!1)):o()}}};#s=e=>{this.#e.delete(e);const t=Array.from(this.#e.values());for(const[i,s]of this.#i)t.includes(i)||(it(s.effect),this.#i.delete(i))};ensure(e,t){var i=_e,s=ta();if(t&&!this.#t.has(e)&&!this.#i.has(e))if(s){var r=document.createDocumentFragment(),a=Bt();r.append(a),this.#i.set(e,{effect:ut(()=>t(a)),fragment:r})}else this.#t.set(e,ut(()=>t(this.anchor)));if(this.#e.set(i,e),s){for(const[o,l]of this.#t)o===e?i.skipped_effects.delete(l):i.skipped_effects.add(l);for(const[o,l]of this.#i)o===e?i.skipped_effects.delete(l.effect):i.skipped_effects.add(l.effect);i.oncommit(this.#r),i.ondiscard(this.#s)}else this.#r()}}function U(n,e,t=!1){var i=new Ta(n),s=t?dn:0;function r(a,o){i.ensure(a,o)}Wi(()=>{var a=!1;e((o,l=!0)=>{a=!0,r(l,o)}),a||r(!1,null)},s)}function $n(n,e,...t){var i=new Ta(n);Wi(()=>{const s=e()??null;i.ensure(s,s&&(r=>s(r,...t)))},dn)}const ir=[...` 	
\r\fÂ \v\uFEFF`];function $l(n,e,t){var i=n==null?"":""+n;if(e&&(i=i?i+" "+e:e),t){for(var s in t)if(t[s])i=i?i+" "+s:s;else if(i.length)for(var r=s.length,a=0;(a=i.indexOf(s,a))>=0;){var o=a+r;(a===0||ir.includes(i[a-1]))&&(o===i.length||ir.includes(i[o]))?i=(a===0?"":i.substring(0,a))+i.substring(o+1):a=o}}return i===""?null:i}function sr(n,e=!1){var t=e?" !important;":";",i="";for(var s in n){var r=n[s];r!=null&&r!==""&&(i+=" "+s+": "+r+t)}return i}function Ji(n){return n[0]!=="-"||n[1]!=="-"?n.toLowerCase():n}function Ll(n,e){if(e){var t="",i,s;if(Array.isArray(e)?(i=e[0],s=e[1]):i=e,n){n=String(n).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var r=!1,a=0,o=!1,l=[];i&&l.push(...Object.keys(i).map(Ji)),s&&l.push(...Object.keys(s).map(Ji));var d=0,u=-1;const v=n.length;for(var h=0;h<v;h++){var f=n[h];if(o?f==="/"&&n[h-1]==="*"&&(o=!1):r?r===f&&(r=!1):f==="/"&&n[h+1]==="*"?o=!0:f==='"'||f==="'"?r=f:f==="("?a++:f===")"&&a--,!o&&r===!1&&a===0){if(f===":"&&u===-1)u=h;else if(f===";"||h===v-1){if(u!==-1){var p=Ji(n.substring(d,u).trim());if(!l.includes(p)){f!==";"&&h++;var g=n.substring(d,h).trim();t+=" "+g+";"}}d=h+1,u=-1}}}}return i&&(t+=sr(i)),s&&(t+=sr(s,!0)),t=t.trim(),t===""?null:t}return n==null?null:String(n)}function De(n,e,t,i,s,r){var a=n.__className;if(a!==t||a===void 0){var o=$l(t,i,r);o==null?n.removeAttribute("class"):n.className=o,n.__className=t}else if(r&&s!==r)for(var l in r){var d=!!r[l];(s==null||d!==!!s[l])&&n.classList.toggle(l,d)}return r}function Qi(n,e={},t,i){for(var s in t){var r=t[s];e[s]!==r&&(t[s]==null?n.style.removeProperty(s):n.style.setProperty(s,r,i))}}function ue(n,e,t,i){var s=n.__style;if(s!==e){var r=Ll(e,i);r==null?n.removeAttribute("style"):n.style.cssText=r,n.__style=e}else i&&(Array.isArray(i)?(Qi(n,t?.[0],i[0]),Qi(n,t?.[1],i[1],"important")):Qi(n,t,i));return i}function ka(n,e,t=!1){if(n.multiple){if(e==null)return;if(!xs(e))return jo();for(var i of n.options)i.selected=e.includes(rr(i));return}for(i of n.options){var s=rr(i);if(Jo(s,e)){i.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function Ol(n){var e=new MutationObserver(()=>{ka(n,n.__value)});e.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Zi(()=>{e.disconnect()})}function rr(n){return"__value"in n?n.__value:n.value}const Rl=Symbol("is custom element"),Fl=Symbol("is html");function si(n,e){var t=Da(n);t.value===(t.value=e??void 0)||n.value===e&&(e!==0||n.nodeName!=="PROGRESS")||(n.value=e??"")}function V(n,e,t,i){var s=Da(n);s[e]!==(s[e]=t)&&(e==="loading"&&(n[Ao]=t),t==null?n.removeAttribute(e):typeof t!="string"&&Hl(n).includes(e)?n[e]=t:n.setAttribute(e,t))}function Da(n){return n.__attributes??={[Rl]:n.nodeName.includes("-"),[Fl]:n.namespaceURI===Uo}}var ar=new Map;function Hl(n){var e=n.getAttribute("is")||n.nodeName,t=ar.get(e);if(t)return t;ar.set(e,t=[]);for(var i,s=n,r=Element.prototype;r!==s;){i=Zr(s);for(var a in i)i[a].set&&t.push(a);s=Is(s)}return t}function or(n,e){return n===e||n?.[Ut]===e}function qt(n={},e,t,i){return Sl(()=>{var s,r;return Yi(()=>{s=r,r=i?.()||[],Pt(()=>{n!==t(...r)&&(e(n,...r),s&&or(t(...s),n)&&e(null,...s))})}),()=>{pi(()=>{r&&or(t(...r),n)&&e(null,...r)})}}),n}function Xl(n=!1){const e=ve,t=e.l.u;if(!t)return;let i=()=>_l(e.s);if(n){let s=0,r={};const a=Ni(()=>{let o=!1;const l=e.s;for(const d in l)l[d]!==r[d]&&(r[d]=l[d],o=!0);return o&&s++,s});i=()=>c(a)}t.b.length&&bl(()=>{lr(e,i),Ti(t.b)}),Fe(()=>{const s=Pt(()=>t.m.map(Do));return()=>{for(const r of s)typeof r=="function"&&r()}}),t.a.length&&Fe(()=>{lr(e,i),Ti(t.a)})}function lr(n,e){if(n.l.s)for(const t of n.l.s)c(t);e()}let vs=Symbol();function L(n,e,t){const i=t[e]??={store:null,source:Ct(void 0),unsubscribe:mt};if(i.store!==n&&!(vs in t))if(i.unsubscribe(),i.store=n??null,n==null)i.source.v=void 0,i.unsubscribe=mt;else{var s=!0;i.unsubscribe=Ls(n,r=>{s?i.source.v=r:$(i.source,r)}),s=!1}return n&&vs in t?gt(n):c(i.source)}function Xe(){const n={};function e(){Zi(()=>{for(var t in n)n[t].unsubscribe();Nr(n,vs,{enumerable:!1,value:!0})})}return[n,e]}function he(n,e,t,i){var s=i,r=!0,a=()=>(r&&(r=!1,s=i),s),o;o=n[e],o===void 0&&i!==void 0&&(o=a());var l;return l=()=>{var d=n[e];return d===void 0?a():(r=!0,d)},l}function vi(n){ve===null&&jr(),fi&&ve.l!==null?Nl(ve).m.push(n):Fe(()=>{const e=Pt(n);if(typeof e=="function")return e})}function Bl(n){ve===null&&jr(),vi(()=>()=>Pt(n))}function Nl(n){var e=n.l;return e.u??={a:[],b:[],m:[]}}function Ls(n,e,t){if(n==null)return e(void 0),t&&t(void 0),mt;const i=Pt(()=>n.subscribe(e,t));return i.unsubscribe?()=>i.unsubscribe():i}const _n=[];function Zl(n,e){return{subscribe:q(n,e).subscribe}}function q(n,e=mt){let t=null;const i=new Set;function s(o){if(Ur(n,o)&&(n=o,t)){const l=!_n.length;for(const d of i)d[1](),_n.push(d,n);if(l){for(let d=0;d<_n.length;d+=2)_n[d][0](_n[d+1]);_n.length=0}}}function r(o){s(o(n))}function a(o,l=mt){const d=[o,l];return i.add(d),i.size===1&&(t=e(s,r)||mt),o(n),()=>{i.delete(d),i.size===0&&t&&(t(),t=null)}}return{set:s,update:r,subscribe:a}}function Be(n,e,t){const i=!Array.isArray(n),s=i?[n]:n;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const r=e.length<2;return Zl(t,(a,o)=>{let l=!1;const d=[];let u=0,h=mt;const f=()=>{if(u)return;h();const g=e(i?d[0]:d,a,o);r?a(g):h=typeof g=="function"?g:mt},p=s.map((g,v)=>Ls(g,w=>{d[v]=w,u&=~(1<<v),l&&f()},()=>{u|=1<<v}));return l=!0,f(),function(){Ti(p),h(),l=!1}})}function gt(n){let e;return Ls(n,t=>e=t)(),e}function Yl(){return`zone_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const _s=["#e74c3c","#e67e22","#f1c40f","#2ecc71","#1abc9c","#3498db","#9b59b6","#e91e8f"];function Wl(){return _s[Math.floor(Math.random()*_s.length)]}function zl(n,e=300){return{id:Yl(),x:n,width:e,color:Wl(),texts:[{language:"cs",title:"",content:""}]}}function Gl(n,e){const t=n.texts.find(i=>i.language===e);return t||n.texts[0]||null}const ri=q("cs"),Pa=q("cat_orange"),Aa=q("Forest"),Ma=q(!1),ys=q(!1),Gn=q(!1),$a=q(!1),La=q(!1),Kl=q("#2a1a0a"),Ul=q(!0),Oa=q(null),Vl=Be([Oa,ri],([n,e])=>n?Gl(n,e):null);function es(n){Oa.set(n)}const Ra=q({x:0,y:0});function jl(n,e){Ra.set({x:n,y:e})}const Fa=q({scrollX:0,scrollY:0,zoom:1});function ql(n,e,t=1){Fa.set({scrollX:n,scrollY:e,zoom:t})}const Ha=q({worldWidth:640,worldHeight:640,offsetX:0,offsetY:0});function Jl(n,e,t,i,s=1){const r=n*s,a=e*s,o=Math.max(0,(t-r)/2),l=Math.max(0,(i-a)/2);Ha.set({worldWidth:r,worldHeight:a,offsetX:o,offsetY:l})}const bs=q(!1);function Xa(){bs.set(!0),setTimeout(()=>bs.set(!1),150)}const Ve={BACKGROUND_LAYER_START:-99,GROUND_REFERENCE:-1,ITEMS_BEHIND:5,PLAYER:10,ITEMS_FRONT:15,FOREGROUND_LAYER_START:50,SELECTION_GRAPHICS:999,GRID_OVERLAY:1e3};function Os(n){return n==="behind"?Ve.ITEMS_BEHIND:Ve.ITEMS_FRONT}const Ln={FRAME_HEIGHT:48,SCALE:5,DEPTH:Ve.PLAYER},Ql={HALF_HEIGHT:Ln.FRAME_HEIGHT*Ln.SCALE/2},On=40;function ec(n){return n-On}function ai(n){return ec(n)-Ql.HALF_HEIGHT}function tc(n,e){const t=ai(e);return Math.min(n,t)}function nc(n,e){const t=ai(e);return n>t}class ic{scene;currentSkinId;constructor(e,t=Br){this.scene=e,this.currentSkinId=t}createAll(){console.log("PlayerAnimations.createAll() is deprecated - animations created by skinLoader")}getSkinId(){return this.currentSkinId}setSkinId(e){this.currentSkinId=e}getAnimationKey(e){return`${this.currentSkinId}-${e}`}play(e,t){const i=this.getAnimationKey(t);if(e.anims.currentAnim?.key!==i){if(!this.scene.anims.exists(i)){console.warn(`[PlayerAnimations] Animation not found: ${i}`);return}e.play(i)}}handleSkinChange(e,t){const i=this.currentSkinId;this.currentSkinId=t;const s=e.anims.currentAnim?.key;if(s){const r=s.replace(`${i}-`,""),a=`${t}-${r}`;if(this.scene.anims.exists(a))e.play(a);else{const o=`${t}-idle`;this.scene.anims.exists(o)&&e.play(o)}}}}let Ba=!1,bn=!1;function yi(n){Ba=n}function cr(){return Ba}function gn(){return bn}function ts(n){if(!n||n.tagName==="CANVAS")return!1;if(n.closest("[data-ui]"))return!0;const e=document.getElementById("game-ui");return!!(e&&e.contains(n)||n.closest("button"))}function sc(){document.addEventListener("pointerdown",n=>{bn=ts(n.target)},{capture:!0}),document.addEventListener("pointermove",n=>{n.buttons>0||(bn=ts(n.target))},{capture:!0}),document.addEventListener("pointerup",()=>{setTimeout(()=>{bn=!1},10)},{capture:!0}),document.addEventListener("touchstart",n=>{bn=ts(n.target)},{capture:!0,passive:!0}),document.addEventListener("touchend",()=>{setTimeout(()=>{bn=!1},10)},{capture:!0,passive:!0})}function Tn(){const n=document.activeElement;if(!n)return!1;const e=n.tagName.toUpperCase();return e==="INPUT"||e==="TEXTAREA"||n.getAttribute("contenteditable")==="true"}function sn(n,e,t){const i=(n-t.worldView.x)*t.zoom,s=(e-t.worldView.y)*t.zoom;return{screenX:i,screenY:s}}function rc(n,e,t){const i=n/t.zoom+t.worldView.x,s=e/t.zoom+t.worldView.y;return{worldX:i,worldY:s}}const tn={THRESHOLD_X:20,LANGUAGE_BUTTON:{width:120,height:60},SKIN_BUTTON:{width:120,height:60,yOffset:60}},ac={SPEED:350};class oc{scene;getPlayerPosition;keyLeft;keyRight;keyA;keyD;touchLeft=!1;touchRight=!1;touchHandlers;constructor(e){this.scene=e.scene,this.getPlayerPosition=e.getPlayerPosition,this.setupKeyboardControls(),this.setupTouchControls()}setupKeyboardControls(){this.scene.input.keyboard&&(this.keyLeft=this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.LEFT,!1),this.keyRight=this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.RIGHT,!1),this.keyA=this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.A,!1),this.keyD=this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.D,!1))}setupTouchControls(){const e=this.scene,t=a=>{if(gt(bs)){this.touchLeft=!1,this.touchRight=!1;return}const o=a.x,l=a.y,d=e.scale.width;if(o>d-tn.LANGUAGE_BUTTON.width&&l<tn.LANGUAGE_BUTTON.height||o>d-tn.SKIN_BUTTON.width&&l>=tn.SKIN_BUTTON.yOffset&&l<tn.SKIN_BUTTON.yOffset+tn.SKIN_BUTTON.height)return;const u=e.cameras.main,f=this.getPlayerPosition().x-u.scrollX,p=o-f;p<-20?(this.touchLeft=!0,this.touchRight=!1):p>tn.THRESHOLD_X?(this.touchRight=!0,this.touchLeft=!1):(this.touchLeft=!1,this.touchRight=!1)},i=a=>{gn()||t(a)},s=a=>{gn()||a.isDown&&t(a)},r=()=>{this.touchLeft=!1,this.touchRight=!1};e.input.on("pointerdown",i),e.input.on("pointermove",s),e.input.on("pointerup",r),this.touchHandlers={pointerdown:i,pointermove:s,pointerup:r}}getInputState(){const e=this.keyA?.isDown||this.keyLeft?.isDown||this.touchLeft||!1,t=this.keyD?.isDown||this.keyRight?.isDown||this.touchRight||!1;return{left:e,right:t}}hasAnyInput(){const e=this.getInputState();return e.left||e.right}destroy(){this.touchHandlers&&(this.scene.input.off("pointerdown",this.touchHandlers.pointerdown),this.scene.input.off("pointermove",this.touchHandlers.pointermove),this.scene.input.off("pointerup",this.touchHandlers.pointerup),this.touchHandlers=void 0)}}class lc extends Y.Physics.Arcade.Sprite{animations;inputController;animState="idle";hasNotifiedMovement=!1;hasReceivedInput=!1;constructor(e,t,i){const s=ei.getSkinId();super(e,t,i,`${s}-idle`),e.add.existing(this),e.physics.add.existing(this),this.animations=new ic(e,s),this.inputController=new oc({scene:e,getPlayerPosition:()=>({x:this.x,y:this.y})}),this.setCollideWorldBounds(!0),this.setBounce(0),this.setSize(16,12),this.setOffset(16,36),this.setScale(Ln.SCALE),this.setDepth(Ln.DEPTH),this.animations.play(this,"idle")}changeSkin(e){this.animations.handleSkinChange(this,e)}update(){const e=this.inputController.getInputState();switch(this.inputController.hasAnyInput()&&!this.hasReceivedInput&&(this.hasReceivedInput=!0),this.hasReceivedInput&&this.inputController.hasAnyInput()&&!this.hasNotifiedMovement&&(this.hasNotifiedMovement=!0,La.set(!0)),e.left?(this.setVelocityX(-350),this.setFlipX(!0),this.animState="running"):e.right?(this.setVelocityX(ac.SPEED),this.setFlipX(!1),this.animState="running"):(this.setVelocityX(0),this.animState="idle"),this.animState){case"idle":this.animations.play(this,"idle");break;case"running":this.animations.play(this,"run");break}}destroy(e){this.inputController.destroy(),super.destroy(e)}}var $t={},ns={},Lt={},dr;function Na(){if(dr)return Lt;dr=1,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.loop=Lt.conditional=Lt.parse=void 0;var n=function i(s,r){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:a;if(Array.isArray(r))r.forEach(function(d){return i(s,d,a,o)});else if(typeof r=="function")r(s,a,o,i);else{var l=Object.keys(r)[0];Array.isArray(r[l])?(o[l]={},i(s,r[l],a,o[l])):o[l]=r[l](s,a,o,i)}return a};Lt.parse=n;var e=function(s,r){return function(a,o,l,d){r(a,o,l)&&d(a,s,o,l)}};Lt.conditional=e;var t=function(s,r){return function(a,o,l,d){for(var u=[],h=a.pos;r(a,o,l);){var f={};if(d(a,s,o,f),a.pos===h)break;h=a.pos,u.push(f)}return u}};return Lt.loop=t,Lt}var Ce={},ur;function Za(){if(ur)return Ce;ur=1,Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.readBits=Ce.readArray=Ce.readUnsigned=Ce.readString=Ce.peekBytes=Ce.readBytes=Ce.peekByte=Ce.readByte=Ce.buildStream=void 0;var n=function(h){return{data:h,pos:0}};Ce.buildStream=n;var e=function(){return function(h){return h.data[h.pos++]}};Ce.readByte=e;var t=function(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return function(f){return f.data[f.pos+h]}};Ce.peekByte=t;var i=function(h){return function(f){return f.data.subarray(f.pos,f.pos+=h)}};Ce.readBytes=i;var s=function(h){return function(f){return f.data.subarray(f.pos,f.pos+h)}};Ce.peekBytes=s;var r=function(h){return function(f){return Array.from(i(h)(f)).map(function(p){return String.fromCharCode(p)}).join("")}};Ce.readString=r;var a=function(h){return function(f){var p=i(2)(f);return h?(p[1]<<8)+p[0]:(p[0]<<8)+p[1]}};Ce.readUnsigned=a;var o=function(h,f){return function(p,g,v){for(var w=typeof f=="function"?f(p,g,v):f,m=i(h),_=new Array(w),S=0;S<w;S++)_[S]=m(p);return _}};Ce.readArray=o;var l=function(h,f,p){for(var g=0,v=0;v<p;v++)g+=h[f+v]&&Math.pow(2,p-v-1);return g},d=function(h){return function(f){for(var p=e()(f),g=new Array(8),v=0;v<8;v++)g[7-v]=!!(p&1<<v);return Object.keys(h).reduce(function(w,m){var _=h[m];return _.length?w[m]=l(g,_.index,_.length):w[m]=g[_.index],w},{})}};return Ce.readBits=d,Ce}var hr;function cc(){return hr||(hr=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=Na(),t=Za(),i={blocks:function(f){for(var p=0,g=[],v=f.data.length,w=0,m=(0,t.readByte)()(f);m!==p&&m;m=(0,t.readByte)()(f)){if(f.pos+m>=v){var _=v-f.pos;g.push((0,t.readBytes)(_)(f)),w+=_;break}g.push((0,t.readBytes)(m)(f)),w+=m}for(var S=new Uint8Array(w),b=0,y=0;y<g.length;y++)S.set(g[y],b),b+=g[y].length;return S}},s=(0,e.conditional)({gce:[{codes:(0,t.readBytes)(2)},{byteSize:(0,t.readByte)()},{extras:(0,t.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,t.readUnsigned)(!0)},{transparentColorIndex:(0,t.readByte)()},{terminator:(0,t.readByte)()}]},function(h){var f=(0,t.peekBytes)(2)(h);return f[0]===33&&f[1]===249}),r=(0,e.conditional)({image:[{code:(0,t.readByte)()},{descriptor:[{left:(0,t.readUnsigned)(!0)},{top:(0,t.readUnsigned)(!0)},{width:(0,t.readUnsigned)(!0)},{height:(0,t.readUnsigned)(!0)},{lct:(0,t.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,e.conditional)({lct:(0,t.readArray)(3,function(h,f,p){return Math.pow(2,p.descriptor.lct.size+1)})},function(h,f,p){return p.descriptor.lct.exists}),{data:[{minCodeSize:(0,t.readByte)()},i]}]},function(h){return(0,t.peekByte)()(h)===44}),a=(0,e.conditional)({text:[{codes:(0,t.readBytes)(2)},{blockSize:(0,t.readByte)()},{preData:function(f,p,g){return(0,t.readBytes)(g.text.blockSize)(f)}},i]},function(h){var f=(0,t.peekBytes)(2)(h);return f[0]===33&&f[1]===1}),o=(0,e.conditional)({application:[{codes:(0,t.readBytes)(2)},{blockSize:(0,t.readByte)()},{id:function(f,p,g){return(0,t.readString)(g.blockSize)(f)}},i]},function(h){var f=(0,t.peekBytes)(2)(h);return f[0]===33&&f[1]===255}),l=(0,e.conditional)({comment:[{codes:(0,t.readBytes)(2)},i]},function(h){var f=(0,t.peekBytes)(2)(h);return f[0]===33&&f[1]===254}),d=[{header:[{signature:(0,t.readString)(3)},{version:(0,t.readString)(3)}]},{lsd:[{width:(0,t.readUnsigned)(!0)},{height:(0,t.readUnsigned)(!0)},{gct:(0,t.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,t.readByte)()},{pixelAspectRatio:(0,t.readByte)()}]},(0,e.conditional)({gct:(0,t.readArray)(3,function(h,f){return Math.pow(2,f.lsd.gct.size+1)})},function(h,f){return f.lsd.gct.exists}),{frames:(0,e.loop)([s,o,l,r,a],function(h){var f=(0,t.peekByte)()(h);return f===33||f===44})}],u=d;n.default=u})(ns)),ns}var Zn={},fr;function dc(){if(fr)return Zn;fr=1,Object.defineProperty(Zn,"__esModule",{value:!0}),Zn.deinterlace=void 0;var n=function(t,i){for(var s=new Array(t.length),r=t.length/i,a=function(p,g){var v=t.slice(g*i,(g+1)*i);s.splice.apply(s,[p*i,i].concat(v))},o=[0,4,2,1],l=[8,8,4,2],d=0,u=0;u<4;u++)for(var h=o[u];h<r;h+=l[u])a(h,d),d++;return s};return Zn.deinterlace=n,Zn}var Yn={},gr;function uc(){if(gr)return Yn;gr=1,Object.defineProperty(Yn,"__esModule",{value:!0}),Yn.lzw=void 0;var n=function(t,i,s){var r=4096,a=-1,o=s,l,d,u,h,f,p,g,x,v,w,E,m,I,k,D,T,_=new Array(s),S=new Array(r),b=new Array(r),y=new Array(r+1);for(m=t,d=1<<m,f=d+1,l=d+2,g=a,h=m+1,u=(1<<h)-1,v=0;v<d;v++)S[v]=0,b[v]=v;var E,x,I,k,T,D;for(E=x=I=k=T=D=0,w=0;w<o;){if(k===0){if(x<h){E+=i[D]<<x,x+=8,D++;continue}if(v=E&u,E>>=h,x-=h,v>l||v==f)break;if(v==d){h=m+1,u=(1<<h)-1,l=d+2,g=a;continue}if(g==a){y[k++]=b[v],g=v,I=v;continue}for(p=v,v==l&&(y[k++]=I,v=g);v>d;)y[k++]=b[v],v=S[v];I=b[v]&255,y[k++]=I,l<r&&(S[l]=g,b[l]=I,l++,(l&u)===0&&l<r&&(h++,u+=l)),g=p}k--,_[T++]=y[k],w++}for(w=T;w<o;w++)_[w]=0;return _};return Yn.lzw=n,Yn}var pr;function hc(){if(pr)return $t;pr=1,Object.defineProperty($t,"__esModule",{value:!0}),$t.decompressFrames=$t.decompressFrame=$t.parseGIF=void 0;var n=r(cc()),e=Na(),t=Za(),i=dc(),s=uc();function r(u){return u&&u.__esModule?u:{default:u}}var a=function(h){var f=new Uint8Array(h);return(0,e.parse)((0,t.buildStream)(f),n.default)};$t.parseGIF=a;var o=function(h){for(var f=h.pixels.length,p=new Uint8ClampedArray(f*4),g=0;g<f;g++){var v=g*4,w=h.pixels[g],m=h.colorTable[w]||[0,0,0];p[v]=m[0],p[v+1]=m[1],p[v+2]=m[2],p[v+3]=w!==h.transparentIndex?255:0}return p},l=function(h,f,p){if(!h.image){console.warn("gif frame does not have associated image.");return}var g=h.image,v=g.descriptor.width*g.descriptor.height,w=(0,s.lzw)(g.data.minCodeSize,g.data.blocks,v);g.descriptor.lct.interlaced&&(w=(0,i.deinterlace)(w,g.descriptor.width));var m={pixels:w,dims:{top:h.image.descriptor.top,left:h.image.descriptor.left,width:h.image.descriptor.width,height:h.image.descriptor.height}};return g.descriptor.lct&&g.descriptor.lct.exists?m.colorTable=g.lct:m.colorTable=f,h.gce&&(m.delay=(h.gce.delay||10)*10,m.disposalType=h.gce.extras.disposal,h.gce.extras.transparentColorGiven&&(m.transparentIndex=h.gce.transparentColorIndex)),p&&(m.patch=o(m)),m};$t.decompressFrame=l;var d=function(h,f){return h.frames.filter(function(p){return p.image}).map(function(p){return l(p,h.gct,f)})};return $t.decompressFrames=d,$t}var $i=hc();async function mr(n,e,t,i=48,s=48){const a=await(await fetch(t)).arrayBuffer(),o=$i.parseGIF(a),l=$i.decompressFrames(o,!0);if(l.length===0)throw new Error(`No frames found in GIF: ${t}`);const d=document.createElement("canvas");d.width=i*l.length,d.height=s;const u=d.getContext("2d"),h=document.createElement("canvas");h.width=o.lsd.width,h.height=o.lsd.height;const f=h.getContext("2d"),p=[];l.forEach((v,w)=>{const m=f.createImageData(v.dims.width,v.dims.height);m.data.set(v.patch),v.disposalType===2&&f.clearRect(0,0,h.width,h.height);const _=document.createElement("canvas");_.width=v.dims.width,_.height=v.dims.height,_.getContext("2d").putImageData(m,0,0),f.drawImage(_,v.dims.left,v.dims.top);const b=Math.floor((i-o.lsd.width)/2),y=Math.floor((s-o.lsd.height)/2);u.drawImage(h,w*i+b,y);const E=(v.delay||10)*10;p.push(E)}),n.textures.exists(e)&&n.textures.remove(e);const g=n.textures.addCanvas(e,d);if(g)for(let v=0;v<l.length;v++)g.add(v,0,v*i,0,i,s);return{frameCount:l.length,frameWidth:i,frameHeight:s,delays:p}}function Li(n){if(n.length===0)return 10;const e=n.reduce((i,s)=>i+s,0)/n.length,t=Math.round(1e3/e);return Math.max(1,Math.min(60,t))}const Ya=new Map;function Wa(n){Ft.filter(t=>t.format==="spritesheet").forEach(t=>{n.load.spritesheet(`${t.id}-idle`,`assets/skins/${t.folder}/idle.png`,{frameWidth:48,frameHeight:48}),n.load.spritesheet(`${t.id}-run`,`assets/skins/${t.folder}/run.png`,{frameWidth:48,frameHeight:48})})}async function za(n){const e=Ft.filter(t=>t.format==="gif");await Promise.all(e.map(async t=>{try{const i=`./assets/skins/${t.folder}`,[s,r]=await Promise.all([mr(n,`${t.id}-idle`,`${i}/idle.gif`,48,48),mr(n,`${t.id}-run`,`${i}/run.gif`,48,48)]);Ya.set(t.id,{idle:s,run:r});const a=Li(s.delays),o=Li(r.delays);console.log(`Loaded GIF skin: ${t.id} (idle: ${s.frameCount}f@${a}fps, run: ${r.frameCount}f@${o}fps)`)}catch(i){console.error(`Failed to load GIF skin ${t.id}:`,i)}}))}function fc(n,e){e.format==="gif"?pc(n,e):gc(n,e)}function gc(n,e){const t=e.id;n.anims.exists(`${t}-idle`)&&n.anims.remove(`${t}-idle`),n.anims.exists(`${t}-run`)&&n.anims.remove(`${t}-run`),n.anims.create({key:`${t}-idle`,frames:n.anims.generateFrameNumbers(`${t}-idle`,{start:0,end:3}),frameRate:6,repeat:-1}),n.anims.create({key:`${t}-run`,frames:n.anims.generateFrameNumbers(`${t}-run`,{start:0,end:5}),frameRate:12,repeat:-1})}function pc(n,e){const t=e.id,i=Ya.get(t);if(!i){console.warn(`No GIF frame data found for skin: ${t}`);return}const s=e.frameRates;n.anims.exists(`${t}-idle`)&&n.anims.remove(`${t}-idle`),n.anims.exists(`${t}-run`)&&n.anims.remove(`${t}-run`);const r=s?.idle??Li(i.idle.delays);n.anims.create({key:`${t}-idle`,frames:n.anims.generateFrameNumbers(`${t}-idle`,{start:0,end:i.idle.frameCount-1}),frameRate:r,repeat:-1});const a=s?.run??Li(i.run.delays);n.anims.create({key:`${t}-run`,frames:n.anims.generateFrameNumbers(`${t}-run`,{start:0,end:i.run.frameCount-1}),frameRate:a,repeat:-1})}function Ga(n){Ft.forEach(e=>{fc(n,e)})}const St=[{name:"FOREST GREEN",folder:"forest_green",scrollFactors:[.75,.8,.85,.9,1,1],foregroundLayers:1},{name:"FOREST BLUE",folder:"forest_blue",scrollFactors:[.75,.8,.85,.9,.95,1]},{name:"FOREST BIRCH",folder:"forest_birch",scrollFactors:[.75,.8,.85,.95,1],foregroundLayers:1},{name:"FOREST FANTASY",folder:"forest_fantasy",scrollFactors:[.75,.8,.85,.9,1,1,1],foregroundLayers:2},{name:"FOREST GOLD",folder:"forest_gold",scrollFactors:[.75,.8,.85,1,1,1],foregroundLayers:2},{name:"FOREST JUNGLE",folder:"forest_jungle",scrollFactors:[.75,.8,.85,1]},{name:"FOREST SUMMER",folder:"forest_summer",scrollFactors:[.75,.8,.85,1,1],foregroundLayers:1}];class mc{currentIndex=0;constructor(){const e=localStorage.getItem("background");if(e){const t=St.findIndex(i=>i.folder===e);t!==-1&&(this.currentIndex=t)}}getBackground(){return St[this.currentIndex].folder}getCurrentConfig(){return St[this.currentIndex]}setBackground(e){const t=St.findIndex(i=>i.folder===e);t!==-1&&(this.currentIndex=t,localStorage.setItem("background",e))}toggleBackground(){this.currentIndex=(this.currentIndex+1)%St.length;const e=St[this.currentIndex];return localStorage.setItem("background",e.folder),e}getAllBackgrounds(){return St}setBackgroundByIndex(e){e>=0&&e<St.length&&(this.currentIndex=e,localStorage.setItem("background",St[e].folder))}getCurrentIndex(){return this.currentIndex}}const oi=new mc;function Ka(n,e){return new Promise(t=>{for(let i=0;i<e.scrollFactors.length;i++){const s=i+1;n.load.image(`bg${s}-${e.folder}`,`assets/backgrounds/${e.folder}/${s}.png`)}n.load.once("complete",()=>{t(!0)}),n.load.once("loaderror",i=>{console.error(`Failed to load background asset: ${i.key}`),t(!1)}),n.load.start()})}function Ua(n,e,t,i){const s=[],r=[],a=i.foregroundLayers??0,l=i.scrollFactors.length-a;for(let d=0;d<i.scrollFactors.length;d++){const h=`bg${d+1}-${i.folder}`,f=i.scrollFactors[d];if(n.textures.exists(h)){const p=n.textures.getFrame(h),g=p.width,v=p.height,w=t/v,m=g*w,_=e*3,S=Math.ceil(_/m)*g+g,b=n.add.tileSprite(0,0,S,v,h);b.setOrigin(0,0),b.setScale(w),b.setScrollFactor(1),b.setData("scrollFactor",f),b.setData("scale",w),d>=l?(b.setDepth(Ve.FOREGROUND_LAYER_START+(d-l)),r.push(b)):(b.setDepth(Ve.BACKGROUND_LAYER_START+d),s.push(b))}}return{bgLayers:s,fgLayers:r}}function Va(n,e){if(!n)return;const t=e.width/e.zoom,i=e.getBounds().width,s=Math.max(0,i-t),r=Math.max(0,Math.min(e.scrollX,s)),a=[...n.bgLayers,...n.fgLayers];for(const o of a){const l=o.getData("scrollFactor"),d=o.getData("scale");o.tilePositionX=r*(1-l)/d}}function vc(n){n.bgLayers.forEach(e=>e.destroy()),n.fgLayers.forEach(e=>e.destroy())}const _c=[{code:"cs",label:"CZ"},{code:"en",label:"EN"}],ja="cs",yc={isActive:!1,config:null,selectedItemId:null,itemDepthLayer:"behind",editMode:"items",selectedDialogZoneId:null,selectedFrameId:null,selectedSocialId:null,isPlayerSelected:!1},z=q(yc),qa=Be(z,n=>n.isActive),bc=Be(z,n=>n.config),Oi=q(!0);function wc(){Oi.update(n=>!n)}const Jt=q(!1);function kn(n){Jt.set(n)}const ws=q(!1);function is(n){ws.set(n)}const cn=q(!1),rn=q(!1),zi=q(!1),an=q(!1),Gi=q(!1);function Sc(){cn.update(n=>!n)}function xc(){rn.update(n=>!n)}function Ja(){zi.set(!0)}function Ec(){zi.set(!1)}function Ic(){an.update(n=>!n)}function Qa(){Gi.set(!0)}function Cc(){Gi.set(!1)}const Rs=q(ja);function Tc(n){Rs.set(n)}const Ki=Be(z,n=>n.selectedItemId),eo=Be(z,n=>n.itemDepthLayer),je=Be(z,n=>n.editMode),Ui=Be(z,n=>n.selectedDialogZoneId),Fs=Be(z,n=>n.config?.dialogZones||[]),li=Be(z,n=>n.selectedFrameId),ss=Be(z,n=>n.isPlayerSelected),to=Be(z,n=>n.config?.placedFrames||[]),ci=Be(z,n=>n.selectedSocialId),kc=Be(z,n=>n.config?.placedSocials||[]),Dc=Be(z,n=>!n.selectedSocialId||!n.config?.placedSocials?null:n.config.placedSocials.find(e=>e.id===n.selectedSocialId)??null),no=q(null);function rs(n){no.set(n)}const Hs=q(new Map);function Pc(n,e,t){Hs.update(i=>{const s=new Map(i);return s.set(n,{x:e,y:t}),s})}function Ac(n){Hs.update(e=>{const t=new Map(e);return t.delete(n),t})}const io=q(null);function as(n){io.set(n)}const Mc=Be(z,n=>!n.selectedFrameId||!n.config?.placedFrames?null:n.config.placedFrames.find(e=>e.id===n.selectedFrameId)??null),so=q(null);function os(n){so.set(n)}const ro=q(null);function bi(n){ro.set(n)}const Xs=q(!1);function ao(){Xs.set(!0)}function vr(){Xs.set(!1)}const Bs=Be(z,n=>!n.selectedItemId||!n.config?.placedItems?null:n.config.placedItems.find(e=>e.id===n.selectedItemId)??null),$c=Be(Bs,n=>n?.physicsEnabled??!1),Lc=Be(Bs,n=>n?.flipX??!1);function _r(n,e){z.update(t=>t.config?{...t,config:{...t.config,playerStartX:n,playerStartY:e}}:t)}function Oc(n){z.update(e=>{if(!e.config)return e;const t=e.config.placedItems||[];return{...e,config:{...e.config,placedItems:[...t,n]}}})}function di(n,e){z.update(t=>!t.config||!t.config.placedItems?t:{...t,config:{...t.config,placedItems:t.config.placedItems.map(i=>i.id===n?{...i,...e}:i)}})}function oo(n){z.update(e=>!e.config||!e.config.placedItems?e:{...e,config:{...e.config,placedItems:e.config.placedItems.filter(t=>t.id!==n)},selectedItemId:e.selectedItemId===n?null:e.selectedItemId})}function lo(n){z.update(e=>({...e,selectedItemId:n,isPlayerSelected:n?!1:e.isPlayerSelected}))}function Rc(n){z.update(e=>({...e,isPlayerSelected:n,selectedItemId:null}))}function Ns(){z.update(n=>({...n,selectedItemId:null,selectedFrameId:null,selectedDialogZoneId:null,selectedSocialId:null,isPlayerSelected:!1}))}function Fc(){z.update(n=>({...n,itemDepthLayer:n.itemDepthLayer==="behind"?"front":"behind"}))}function Hc(n,e){di(n,{depth:e})}function Xc(n,e){e?(di(n,{physicsEnabled:e,depth:Os("behind")}),z.update(t=>({...t,itemDepthLayer:"behind"}))):di(n,{physicsEnabled:e})}function Bc(n,e){di(n,{flipX:e})}function Nc(n){z.set({isActive:!0,config:{...n,placedItems:n.placedItems||[],dialogZones:n.dialogZones||[],placedFrames:n.placedFrames||[],placedSocials:n.placedSocials||[]},selectedItemId:null,itemDepthLayer:"behind",editMode:"items",selectedDialogZoneId:null,selectedFrameId:null,selectedSocialId:null,isPlayerSelected:!1}),Zs.set(1)}function Zc(){z.update(n=>{const e=n.config?{...n.config,dialogZones:(n.config.dialogZones||[]).filter(t=>t.texts.some(i=>i.title.trim()!==""||i.content.trim()!==""))}:n.config;return{...n,isActive:!1,selectedItemId:null,config:e}}),Zs.set(1)}function Yc(){return gt(z).config}const Zs=q(1);function wi(n){Zs.set(n)}const Ys=q({scrollX:0,scrollY:0,viewWidth:0,viewHeight:0,worldWidth:0,worldHeight:0,zoom:1,playerX:0,playerY:0});function Wc(n){Ys.update(e=>({...e,...n}))}function Wn(n){z.update(e=>({...e,editMode:n,selectedItemId:null,selectedDialogZoneId:null}))}function zc(n){z.update(e=>{if(!e.config)return e;const t=e.config.dialogZones||[];return{...e,config:{...e.config,dialogZones:[...t,n]}}})}function wn(n,e){z.update(t=>!t.config||!t.config.dialogZones?t:{...t,config:{...t.config,dialogZones:t.config.dialogZones.map(i=>i.id===n?{...i,...e}:i)}})}function co(n){z.update(e=>!e.config||!e.config.dialogZones?e:{...e,config:{...e.config,dialogZones:e.config.dialogZones.filter(t=>t.id!==n)},selectedDialogZoneId:e.selectedDialogZoneId===n?null:e.selectedDialogZoneId})}function jn(n){z.update(e=>({...e,selectedDialogZoneId:n}))}function yr(n,e,t){z.update(i=>!i.config||!i.config.dialogZones?i:{...i,config:{...i.config,dialogZones:i.config.dialogZones.map(s=>{if(s.id!==n)return s;const r=s.texts.findIndex(o=>o.language===e);let a;return r>=0?a=s.texts.map((o,l)=>l===r?{...o,...t}:o):a=[...s.texts,{language:e,title:"",content:"",...t}],{...s,texts:a}})}})}function Gc(n){z.update(e=>{if(!e.config)return e;const t=e.config.placedFrames||[];return{...e,config:{...e.config,placedFrames:[...t,n]}}})}function xt(n,e){z.update(t=>!t.config||!t.config.placedFrames?t:{...t,config:{...t.config,placedFrames:t.config.placedFrames.map(i=>i.id===n?{...i,...e}:i)}})}function Ws(n){z.update(e=>!e.config||!e.config.placedFrames?e:{...e,config:{...e.config,placedFrames:e.config.placedFrames.filter(t=>t.id!==n)},selectedFrameId:e.selectedFrameId===n?null:e.selectedFrameId})}function qn(n){zi.set(!1),z.update(e=>({...e,selectedFrameId:n,isPlayerSelected:n?!1:e.isPlayerSelected,selectedItemId:n?null:e.selectedItemId}))}function Kc(n){z.update(e=>{if(!e.config)return e;const t=e.config.placedSocials||[];return{...e,config:{...e.config,placedSocials:[...t,n]}}})}function xi(n,e){z.update(t=>!t.config||!t.config.placedSocials?t:{...t,config:{...t.config,placedSocials:t.config.placedSocials.map(i=>i.id===n?{...i,...e}:i)}})}function zs(n){z.update(e=>!e.config||!e.config.placedSocials?e:{...e,config:{...e.config,placedSocials:e.config.placedSocials.filter(t=>t.id!==n)},selectedSocialId:e.selectedSocialId===n?null:e.selectedSocialId})}function Jn(n){Gi.set(!1),z.update(e=>({...e,selectedSocialId:n,isPlayerSelected:n?!1:e.isPlayerSelected,selectedItemId:n?null:e.selectedItemId,selectedFrameId:n?null:e.selectedFrameId}))}const Gs=[{key:"tent",name:"Tent",path:"assets/ui/tent.png",scale:6,category:"structures"},{key:"lamp",name:"Lamp",path:"assets/ui/lamp.png",scale:8,category:"props"},{key:"sign_left",name:"Sign â",path:"assets/ui/sign_left.png",scale:7,category:"signs"},{key:"sign_right",name:"Sign â",path:"assets/ui/sign_right.png",scale:7,category:"signs"},{key:"stone_0",name:"Stone 0",path:"assets/ui/stone_0.png",scale:4,category:"nature",supportsPhysics:!0},{key:"stone_1",name:"Stone 1",path:"assets/ui/stone_1.png",scale:5,category:"nature",supportsPhysics:!0},{key:"stone_2",name:"Stone 2",path:"assets/ui/stone_2.png",scale:4,category:"nature",supportsPhysics:!0}];function uo(n){return Gs.find(e=>e.key===n)}function Uc(n){return uo(n)?.scale||1}function Vc(n){return uo(n)?.supportsPhysics??!1}class br{scene;groundY;constructor(e,t){this.scene=e,this.groundY=t}static preloadAssets(e){Gs.forEach(t=>{e.load.image(t.key,t.path)})}createSprite(e){const{id:t,assetKey:i,x:s,scale:r=1,depth:a=5,yOffset:o=0,flipX:l=!1}=e,d=this.groundY+o,u=this.scene.add.sprite(s,d,i);return u.setScale(r),u.setDepth(a),u.setFlipX(l),u.setData("itemId",t),u}updatePosition(e,t,i){e.x=t,e.y=this.groundY+i}updateScale(e,t){e.setScale(t)}updateDepth(e,t){e.setDepth(t)}applyUpdates(e,t){t.x!==void 0&&(e.x=t.x),t.yOffset!==void 0&&(e.y=this.groundY+t.yOffset),t.scale!==void 0&&e.setScale(t.scale),t.depth!==void 0&&e.setDepth(t.depth),t.flipX!==void 0&&e.setFlipX(t.flipX)}worldYToOffset(e){return e-this.groundY}getGroundY(){return this.groundY}}function Sn(n){return parseInt(n.replace("#",""),16)}const nn={BLUE:"#4a90e2",GREEN:"#27ae60",PURPLE:"#9b59b6",TEAL:"#1abc9c",PINK:"#e91e8f"},Xn={ITEM:{hex:Sn(nn.BLUE)},FRAME:{hex:Sn(nn.PURPLE)},SOCIAL:{css:nn.PINK,hex:Sn(nn.PINK)},DIALOG_ZONE:{hex:Sn(nn.TEAL)},PLAYER:{hex:Sn(nn.GREEN)}},ho=Sn(nn.BLUE),In=50,jc=4871528,qc=.4,Jc=1,fo=Ve.GRID_OVERLAY,ls=16711680,Qc=2,ed=.6,td=.1,nd=1,id=.2,wr=50,sd=50,Ks=ho;class go{lastClickTime=0;lastClickId=null;threshold;constructor(e=300){this.threshold=e}check(e){const t=Date.now(),i=this.lastClickId===e&&t-this.lastClickTime<this.threshold;return this.lastClickTime=t,this.lastClickId=e,i}reset(){this.lastClickTime=0,this.lastClickId=null}}function Si(n,e){return Math.round(n/e)*e}function Vi(n){const{sprite:e,scene:t,callbacks:i={},constraints:s,useGridSnapping:r=!0,cursor:a="grab",hitArea:o}=n;let l=!1,d=0,u=0,h=0;o?e.setInteractive({hitArea:o,hitAreaCallback:Y.Geom.Rectangle.Contains,useHandCursor:!0,cursor:a}):e.setInteractive({useHandCursor:!0,cursor:a});const f=(S,b)=>{const y=e.getBounds(),E=5;return S>=y.x-E&&S<=y.x+y.width+E&&b>=y.y-E&&b<=y.y+y.height+E},p=()=>{const S=t.data.get("lastTapTime");if(!S||S===h||Date.now()-S>100)return;h=S;const b=t.data.get("lastTapWorldX"),y=t.data.get("lastTapWorldY");f(b,y)&&i.onSelect?.()},g=S=>{if(S.wasTouch||gt(ws)||gn()||l||i.onDoubleClick?.())return;const b=i.isSelected?.()??!1;i.onSelect?.(),b&&(l=!0,t.data.set("isDraggingItem",!0),kn(!0),d=e.x-S.worldX,u=e.y-S.worldY,i.onDragStart?.())},v=S=>{if(S.wasTouch){const E=t.data.get("touchDragStarted");if(!l&&E&&i.isSelected?.()){const I=t.data.get("touchStartWorldX"),k=t.data.get("touchStartWorldY"),T=e.getBounds(),D=10;I>=T.x-D&&I<=T.x+T.width+D&&k>=T.y-D&&k<=T.y+T.height+D&&(l=!0,t.data.set("isDraggingItem",!0),t.data.set("touchDragStarted",!1),kn(!0),d=e.x-I,u=e.y-k,i.onDragStart?.())}if(l){let x=S.worldX+d,I=S.worldY+u;r&&gt(Oi)&&(x=Si(x,In),I=Si(I,In)),s&&(s.minX!==void 0&&(x=Math.max(x,s.minX)),s.maxX!==void 0&&(x=Math.min(x,s.maxX)),s.minY!==void 0&&(I=Math.max(I,s.minY)),s.maxY!==void 0&&(I=Math.min(I,s.maxY))),e.setPosition(x,I),i.onDrag?.(x,I)}return}if(!l)return;if(gt(ws)){m();return}if(!S.isDown){m();return}let b=S.worldX+d,y=S.worldY+u;r&&gt(Oi)&&(b=Si(b,In),y=Si(y,In)),s&&(s.minX!==void 0&&(b=Math.max(b,s.minX)),s.maxX!==void 0&&(b=Math.min(b,s.maxX)),s.minY!==void 0&&(y=Math.max(y,s.minY)),s.maxY!==void 0&&(y=Math.min(y,s.maxY))),e.setPosition(b,y),i.onDrag?.(b,y)},w=()=>{l&&m()},m=()=>{l=!1,t.data.set("isDraggingItem",!1),kn(!1),i.onDragEnd?.(e.x,e.y)};e.on("pointerdown",g),t.input.on("pointermove",v),t.input.on("pointerup",w);const _=()=>{p()};return t.events.on("update",_),()=>{e.off("pointerdown",g),t.input.off("pointermove",v),t.input.off("pointerup",w),t.events.off("update",_)}}class rd{scene;groundY;worldWidth;worldHeight;isDragging=!1;callbacks;cleanupFunctions=new Map;constructor(e,t,i,s,r={}){this.scene=e,this.groundY=t,this.worldWidth=i,this.worldHeight=s,this.callbacks=r}getIsDragging(){return this.isDragging}makeInteractive(e,t){const i=Vi({sprite:e,scene:this.scene,cursor:"pointer",constraints:{minX:0,maxX:this.worldWidth,minY:0,maxY:this.worldHeight},callbacks:{onSelect:()=>{lo(t),this.callbacks.onSelect?.(t)},isSelected:()=>gt(Ki)===t,onDragStart:()=>{this.isDragging=!0,e.setTint(ho),this.callbacks.onDragStart?.(t)},onDrag:(s,r)=>{this.callbacks.onDrag?.(t,s,r)},onDragEnd:(s,r)=>{e.clearTint(),this.isDragging=!1;const a=Math.round(s),l=Math.round(r)-this.groundY;di(t,{x:a,yOffset:l}),this.callbacks.onDragEnd?.(t,a,l)}}});this.cleanupFunctions.set(t,i)}removeInteractivity(e){if(!e||!e.scene)return;const t=e.getData("itemId");t&&this.cleanupFunctions.has(t)&&(this.cleanupFunctions.get(t)(),this.cleanupFunctions.delete(t)),e.removeInteractive()}destroy(){this.cleanupFunctions.forEach(e=>e()),this.cleanupFunctions.clear()}}const on={ITEM:"itemId",FRAME:"frameId",SOCIAL:"socialId",PLAYER:"isPlayer",ZONE:"zoneId"},ad={[on.ITEM]:"selectedItemId",[on.FRAME]:"selectedFrameId",[on.SOCIAL]:"selectedSocialId",[on.PLAYER]:"isPlayerSelected"};function od(n,e){if(!(n instanceof Y.GameObjects.Sprite))return!1;for(const[t,i]of Object.entries(ad)){const s=n.getData(t);if(s)if(t===on.PLAYER){const r=e.data.get(i),a=e.data.get("playerSprite");if(r&&n===a)return!0}else{const r=e.data.get(i);if(s===r)return!0}}return!1}function ld(n,e){const t=n.input.hitTestPointer(e);for(const i of t)if(od(i,n))return!0;return!1}const cd={lineWidth:3,lineColor:Xn.ITEM.hex,lineAlpha:1,padding:5};class dd{scene;graphics;style;selectedId=null;constructor(e,t={}){this.scene=e,this.style={...cd,...t},this.graphics=e.add.graphics(),this.graphics.setDepth(Ve.SELECTION_GRAPHICS)}setSelectedId(e){this.selectedId=e}getSelectedId(){return this.selectedId}updateVisuals(e){if(this.graphics.clear(),!e||!this.selectedId)return;const t=e.getBounds(),{lineWidth:i,lineColor:s,lineAlpha:r,padding:a}=this.style;this.graphics.lineStyle(i,s,r),this.graphics.strokeRect(t.x-a,t.y-a,t.width+a*2,t.height+a*2)}clearVisuals(){this.graphics.clear(),this.selectedId=null}setupBackgroundDeselect(e){this.scene.input.on("pointerdown",t=>{if(gn()||e())return;this.scene.input.hitTestPointer(t).find(r=>r.type==="Sprite"?Object.values(on).some(a=>r.getData(a)):r.type==="Rectangle"?r.getData(on.ZONE):!1)||(Ns(),this.clearVisuals())})}destroy(){this.graphics?.destroy()}}class Ri{scene;items=new Map;isBuilderMode=!1;physicsGroup=null;renderer;dragController;selectionManager;constructor(e,t,i,s,r=!1){this.scene=e,this.isBuilderMode=r,this.renderer=new br(e,t),r||(this.physicsGroup=e.physics.add.staticGroup()),this.isBuilderMode&&(this.dragController=new rd(e,t,i,s,{onSelect:()=>this.updateSelectionVisuals(),onDrag:()=>this.updateSelectionVisuals()}),this.selectionManager=new dd(e))}static preloadAssets(e){br.preloadAssets(e)}createItems(e){e.forEach(t=>{this.createItem(t)})}createItem(e){const t=this.renderer.createSprite(e),i={sprite:t,data:e};if(!this.isBuilderMode&&e.physicsEnabled&&this.physicsGroup){const s=this.createPhysicsBody(t,e);i.physicsBody=s}this.items.set(e.id,i),this.isBuilderMode&&this.dragController&&this.dragController.makeInteractive(t,e.id)}createPhysicsBody(e,t){const i=e.getBounds(),s=i.width*.5,r=i.height*.8,a=e.x,o=e.y,l=this.scene.add.rectangle(a,o,s,r);return l.setVisible(!1),this.physicsGroup.add(l),l.setData("itemId",t.id),l}updateSelectionVisuals(){if(!this.selectionManager)return;const e=this.scene.data.get("selectedItemId");if(this.selectionManager.setSelectedId(e),!e){this.selectionManager.clearVisuals(),as(null);return}const t=this.items.get(e);if(this.selectionManager.updateVisuals(t?.sprite??null),t?.sprite){const i=this.scene.cameras.main,s=t.sprite.getBounds(),{screenX:r,screenY:a}=sn(s.centerX,s.centerY,i),o=s.height*i.zoom;as({screenX:r,screenY:a,itemHeight:o})}else as(null)}updateItem(e,t){const i=this.items.get(e);i&&(this.renderer.applyUpdates(i.sprite,t),i.data={...i.data,...t})}removeItem(e){const t=this.items.get(e);t&&(this.dragController&&this.dragController.removeInteractivity(t.sprite),t.physicsBody&&t.physicsBody.destroy(),t.sprite.destroy(),this.items.delete(e))}removeAllItems(){this.items.forEach(e=>{!e.sprite||!e.sprite.scene||(this.dragController&&this.dragController.removeInteractivity(e.sprite),e.physicsBody&&e.physicsBody.destroy(),e.sprite.destroy())}),this.items.clear()}getItem(e){return this.items.get(e)?.data}getAllItems(){return Array.from(this.items.values()).map(e=>e.data)}getPhysicsGroup(){return this.physicsGroup}setInteractiveEnabled(e){!this.isBuilderMode||!this.dragController||(this.items.forEach(({sprite:t,data:i})=>{e?(this.dragController.makeInteractive(t,i.id),t.setAlpha(1)):(t.disableInteractive(),t.setAlpha(.6))}),!e&&this.selectionManager&&this.selectionManager.clearVisuals())}destroy(){this.removeAllItems(),this.selectionManager?.destroy()}setupBackgroundDeselect(){!this.isBuilderMode||!this.selectionManager||this.selectionManager.setupBackgroundDeselect(()=>this.dragController?.getIsDragging()??!1)}}function ud(){return`frame_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const hd=["#ffffff","#f8f8f8","#fffacd","#ffefd5","#ffe4e1","#e6e6fa","#f0fff0","#f5fffa","#fff0f5","#f0f8ff","#2d2d2d","#1a1a2e","#16213e","#1a1a1a","#2d132c","#1e3a3a","#3d1a1a","#1a2f1a","#3d3d1a","#2a1a3d"],fd=["#333333","#000000","#ffffff","#1a1a1a","#666666","#8b4513","#2c3e50","#c0392b","#27ae60","#2980b9","#8e44ad","#f39c12"],gd=[12,14,16,18,20,24,28,32],pd=[{value:"top",label:"Top",icon:"â"},{value:"center",label:"Center",icon:"â¬"},{value:"bottom",label:"Bottom",icon:"â"}],po={S:{label:"Small",scale:3},M:{label:"Medium",scale:4},L:{label:"Large",scale:5}};function md(n){return po[n].scale}function vd(n){return n<=3?"S":n>=5?"L":"M"}const Xt=4,Kn="#ffffff",mo="#333333",Ei=16,vo="center",_d=64,yd=96,bd=.06,Sr=32,Fi=[{key:"base_1",name:"Frame 1",path:"assets/frames/base 1.png",scale:4},{key:"base_2",name:"Frame 2",path:"assets/frames/base 2.png",scale:4},{key:"base_3",name:"Frame 3",path:"assets/frames/base 3.png",scale:4},{key:"base_4",name:"Frame 4",path:"assets/frames/base 4.png",scale:4},{key:"base_5",name:"Frame 5",path:"assets/frames/base 5.png",scale:4},{key:"base_6",name:"Frame 6",path:"assets/frames/base 6.png",scale:4},{key:"base_7",name:"Frame 7",path:"assets/frames/base 7.png",scale:4},{key:"base_8",name:"Frame 8",path:"assets/frames/base 8.png",scale:4},{key:"base_9",name:"Frame 9",path:"assets/frames/base 9.png",scale:4},{key:"base_10",name:"Frame 10",path:"assets/frames/base 10.png",scale:4},{key:"base_11",name:"Frame 11",path:"assets/frames/base 11.png",scale:4},{key:"base_12",name:"Frame 12",path:"assets/frames/base 12.png",scale:4},{key:"base_13",name:"Frame 13",path:"assets/frames/base 13.png",scale:4},{key:"base_14",name:"Frame 14",path:"assets/frames/base 14.png",scale:4},{key:"base_15",name:"Frame 15",path:"assets/frames/base 15.png",scale:4},{key:"base_16",name:"Frame 16",path:"assets/frames/base 16.png",scale:4},{key:"base_17",name:"Frame 17",path:"assets/frames/base 17.png",scale:4},{key:"base_18",name:"Frame 18",path:"assets/frames/base 18.png",scale:4},{key:"base_19",name:"Frame 19",path:"assets/frames/base 19.png",scale:4},{key:"base_20",name:"Frame 20",path:"assets/frames/base 20.png",scale:4},{key:"base_21",name:"Frame 21",path:"assets/frames/base 21.png",scale:4},{key:"base_22",name:"Frame 22",path:"assets/frames/base 22.png",scale:4},{key:"base_23",name:"Frame 23",path:"assets/frames/base 23.png",scale:4},{key:"base_24",name:"Frame 24",path:"assets/frames/base 24.png",scale:4},{key:"base_25",name:"Frame 25",path:"assets/frames/base 25.png",scale:4}];function wd(n){return Fi.find(e=>e.key===n)}function Sd(n){return wd(n)?.scale??Xt}function Qn(n=Xt,e=!1){const t=_d*n,i=yd*n,s=e?i:t,r=e?t:i,a=Math.min(t,i)*bd,o=s-a*2,l=r-a*2,d=o-Sr*2,u=l-Sr*2;return{frameWidth:s,frameHeight:r,innerWidth:o,innerHeight:l,textWidth:d,textHeight:u}}function Ii(n,e,t,i,s,r,a=4){n.clear();const o=parseInt(r.replace("#",""),16);n.fillStyle(o,1),n.fillRoundedRect(e-i/2,t-s/2,i,s,a)}class xr{scene;frames=new Map;constructor(e){this.scene=e}static preloadAssets(e){for(let t=1;t<=25;t++)e.load.image(`frame_base_${t}`,`assets/frames/base ${t}.png`)}createFrames(e){e.forEach(t=>{this.createFrame(t)})}createFrame(e){const t=`frame_${e.frameKey}`;if(!this.scene.textures.exists(t)){console.warn(`[GameFrameManager] Frame texture not found: ${t}`);return}const i=e.scale??Xt,s=e.depth??Ve.ITEMS_FRONT,r=(e.rotation??0)*(Math.PI/180),a=e.rotation===90,{innerWidth:o,innerHeight:l}=Qn(i,a),d=this.scene.add.graphics();d.setDepth(s-.1),Ii(d,e.x,e.y,o,l,e.backgroundColor||Kn);const u=this.scene.add.sprite(e.x,e.y,t);u.setScale(i),u.setDepth(s),u.setOrigin(.5,.5),u.setRotation(r);const h={sprite:u,background:d,data:e};this.frames.set(e.id,h),e.url&&this.makeClickable(h)}makeClickable(e){const{sprite:t,data:i}=e;t.setInteractive({useHandCursor:!0}),t.on("pointerover",()=>{t.setScale((i.scale??Xt)*1.05)}),t.on("pointerout",()=>{t.setScale(i.scale??Xt)}),t.on("pointerdown",()=>{i.url&&(Xa(),window.open(i.url,"_blank","noopener,noreferrer"))})}destroy(){this.frames.forEach(({sprite:e,background:t})=>{e.destroy(),t.destroy()}),this.frames.clear()}}function xd(){return`social_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const ui={S:{label:"Small",scale:1.5},M:{label:"Medium",scale:2},L:{label:"Large",scale:2.5}},Dn=ui.M.scale;function Ed(n){return ui[n].scale}function Id(n){return n<=ui.S.scale?"S":n>=ui.L.scale?"L":"M"}const Hi=[{key:"discord",name:"Discord",path:"assets/socials/Discord.png",scale:1},{key:"facebook",name:"Facebook",path:"assets/socials/Facebook.png",scale:1},{key:"instagram",name:"Instagram",path:"assets/socials/Instagram.png",scale:1},{key:"kofi",name:"Ko-Fi",path:"assets/socials/Ko Fi.png",scale:1},{key:"linkedin",name:"LinkedIn",path:"assets/socials/LinkedIn.png",scale:1},{key:"patreon",name:"Patreon",path:"assets/socials/Patreon.png",scale:1},{key:"tiktok",name:"TikTok",path:"assets/socials/TikTok.png",scale:1},{key:"twitch",name:"Twitch",path:"assets/socials/Twitch.png",scale:1},{key:"twitter",name:"Twitter",path:"assets/socials/Twitter.png",scale:1},{key:"whatsapp",name:"WhatsApp",path:"assets/socials/Whatsapp.png",scale:1},{key:"youtube",name:"YouTube",path:"assets/socials/Youtube.png",scale:1}];class Er{scene;socials=new Map;constructor(e){this.scene=e}static preloadAssets(e){Hi.forEach(t=>{e.load.image(`social_${t.key}`,t.path)})}createSocials(e){e.forEach(t=>{this.createSocial(t)})}createSocial(e){const t=`social_${e.socialKey}`;if(!this.scene.textures.exists(t)){console.warn(`[GameSocialManager] Social texture not found: ${t}`);return}const i=e.scale??Dn,s=e.depth??Ve.ITEMS_FRONT,r=this.scene.add.sprite(e.x,e.y,t);r.setScale(i),r.setDepth(s),r.setOrigin(.5,.5),this.socials.set(e.id,r),e.url&&this.makeClickable(r,e)}makeClickable(e,t){const i=t.scale??Dn;e.setInteractive({useHandCursor:!0}),e.on("pointerover",()=>{e.setScale(i*1.1)}),e.on("pointerout",()=>{e.setScale(i)}),e.on("pointerdown",()=>{t.url&&(Xa(),window.open(t.url,"_blank","noopener,noreferrer"))})}destroy(){this.socials.forEach(e=>{e.destroy()}),this.socials.clear()}}async function Ir(){const n=await fetch("./config/map.json");if(!n.ok)throw new Error(`Failed to load map config: ${n.status}`);const e=await n.json();if(!e.worldWidth||!e.worldHeight)throw new Error("Invalid map config structure");return e}const Ci={generateId(){return`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`},create(n){const{assetKey:e,x:t,yOffset:i=0,depthLayer:s="behind",scale:r}=n;return{id:Ci.generateId(),assetKey:e,x:Math.round(t),y:0,scale:r??Uc(e),depth:Os(s),yOffset:Math.round(i)}},createAtWorldPosition(n,e,t,i,s="behind"){return Ci.create({assetKey:n,x:e,yOffset:t-i,depthLayer:s})},clone(n,e=50){return{...n,id:Ci.generateId(),x:n.x+e}}},yn={HEIGHT:On,VISUAL:{COLOR:9139029,ALPHA:.3},PHYSICS:{COLOR:0,ALPHA:0}},hi={getGroundY(n,e=On){return n-e},createVisualGround(n,e){const t=e.height??yn.HEIGHT,i=hi.getGroundY(e.worldHeight,t),s=n.add.rectangle(0,i,e.worldWidth,t,e.color??yn.VISUAL.COLOR,e.alpha??yn.VISUAL.ALPHA);return s.setOrigin(0,0),s.setDepth(e.depth??Ve.GROUND_REFERENCE),{ground:s,groundY:i}},createPhysicsGround(n,e){const t=e.height??yn.HEIGHT,i=hi.getGroundY(e.worldHeight,t),s=n.add.rectangle(0,i,e.worldWidth,t,e.color??yn.PHYSICS.COLOR,e.alpha??yn.PHYSICS.ALPHA);return s.setOrigin(0,0),n.physics.add.existing(s,!0),{ground:s,groundY:i}},addPlayerCollision(n,e,t){return n.physics.add.collider(e,t)}},vt={GAME:"GameScene",BUILDER:"BuilderScene"};class Cd extends Y.Scene{player;mapConfig;parallaxLayers=null;loadedBackgrounds=new Set;itemManager;frameManager;socialManager;dialogZones=[];currentDialogZone=null;unsubscribers=[];initData;isInitialized=!1;constructor(){super({key:vt.GAME})}init(e){this.initData=e,this.isInitialized=!1}preload(){Wa(this),Ri.preloadAssets(this),xr.preloadAssets(this),Er.preloadAssets(this)}create(){this.events.on("shutdown",this.shutdown,this),this.initializeScene()}async initializeScene(){ys.set(!0);try{await za(this),Ga(this),await this.loadMapConfiguration();const e=oi.getCurrentConfig();await this.loadBackgroundIfNeeded(e),this.createParallaxBackground();const{ground:t,groundY:i}=hi.createPhysicsGround(this,{worldWidth:this.mapConfig.worldWidth,worldHeight:this.mapConfig.worldHeight}),s=tc(this.mapConfig.playerStartY,this.mapConfig.worldHeight);this.player=new lc(this,this.mapConfig.playerStartX,s),hi.addPlayerCollision(this,this.player,t),this.itemManager=new Ri(this,i,this.mapConfig.worldWidth,this.mapConfig.worldHeight,!1),this.mapConfig.placedItems&&this.mapConfig.placedItems.length>0&&this.itemManager.createItems(this.mapConfig.placedItems);const r=this.itemManager.getPhysicsGroup();r&&this.physics.add.collider(this.player,r),this.frameManager=new xr(this),this.mapConfig.placedFrames&&this.mapConfig.placedFrames.length>0&&this.frameManager.createFrames(this.mapConfig.placedFrames),this.socialManager=new Er(this),this.mapConfig.placedSocials&&this.mapConfig.placedSocials.length>0&&this.socialManager.createSocials(this.mapConfig.placedSocials),this.dialogZones=this.mapConfig.dialogZones||[];const a=Fs.subscribe(o=>{this.dialogZones=o,this.recheckCurrentZone()});this.unsubscribers.push(a),this.cameras.main.startFollow(this.player,!0,.1,.1),this.setupCameraBounds(),this.physics.world.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.scale.on("resize",this.handleResize,this),this.isInitialized=!0}catch(e){console.error("[GameScene] Failed to initialize scene:",e)}finally{ys.set(!1)}}async loadMapConfiguration(){try{if(this.initData?.useBuilderConfig){const e=Yc();this.mapConfig=e||await Ir()}else this.mapConfig=await Ir()}catch(e){console.error("[GameScene] Failed to load map configuration:",e);const t=600;this.mapConfig={worldWidth:3200,worldHeight:t,playerStartX:400,playerStartY:ai(t),placedItems:[]}}}createParallaxBackground(){const e=oi.getCurrentConfig();this.parallaxLayers=Ua(this,this.mapConfig.worldWidth,this.mapConfig.worldHeight,e)}async loadBackgroundIfNeeded(e){if(this.loadedBackgrounds.has(e.folder))return!0;const t=await Ka(this,e);return t&&this.loadedBackgrounds.add(e.folder),t}setupCameraBounds(){const e=this.cameras.main,t=e.height,i=e.width,s=t/this.mapConfig.worldHeight,r=Math.min(1,s);e.setZoom(r);const a=t/r,o=i/r;let l=0,d=this.mapConfig.worldHeight;a>this.mapConfig.worldHeight&&(l=(this.mapConfig.worldHeight-a)/2,d=a);let u=0,h=this.mapConfig.worldWidth;o>this.mapConfig.worldWidth&&(u=(this.mapConfig.worldWidth-o)/2,h=o),e.setBounds(u,l,h,d),Jl(this.mapConfig.worldWidth,this.mapConfig.worldHeight,i,t,r)}handleResize(e){!this.cameras?.main||!this.mapConfig||this.setupCameraBounds()}shutdown(){this.isInitialized=!1,this.scale.off("resize",this.handleResize,this),es(null),this.currentDialogZone=null,this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.itemManager&&this.itemManager.destroy(),this.frameManager&&this.frameManager.destroy(),this.socialManager&&this.socialManager.destroy()}update(){if(!this.isInitialized||!this.player)return;this.player.update();const e=this.cameras.main,t=this.player.x-e.scrollX,i=this.player.y-e.scrollY;jl(t,i),ql(e.scrollX,e.scrollY,e.zoom),this.checkDialogZones(),this.parallaxLayers&&Va(this.parallaxLayers,this.cameras.main)}checkDialogZones(){const e=this.player.x;let t=null;for(const i of this.dialogZones)if(e>=i.x&&e<=i.x+i.width){t=i;break}t?.id!==this.currentDialogZone?.id&&(this.currentDialogZone=t,es(t))}recheckCurrentZone(){if(!this.currentDialogZone)return;const e=this.dialogZones.find(t=>t.id===this.currentDialogZone?.id);e&&(this.currentDialogZone=e,es(e))}}const cs=1,Cr=.001,Td=.15,Tr=400;class kd{scene;camera;worldWidth;worldHeight;isPanning=!1;panStartX=0;panStartY=0;cameraDragStartX=0;cameraDragStartY=0;isDraggingToScroll=!1;dragScrollStartX=0;dragScrollStartY=0;dragScrollCameraStartX=0;dragScrollCameraStartY=0;currentZoom=1;targetZoom=1;minZoom=.1;isAnimatingReset=!1;zoomTargetWorldPoint=null;pinchStartDistance=0;pinchStartZoom=1;activeTouches=new Map;pinchEndTime=0;isPinching=!1;PINCH_COOLDOWN=150;touchStartTime=0;touchStartPos=null;touchOnSelectedSprite=!1;TAP_MAX_DURATION=200;TAP_MAX_DISTANCE=10;constructor(e,t,i){this.scene=e,this.camera=e.cameras.main,this.worldWidth=t,this.worldHeight=i}setup(){this.calculateMinZoom(),this.setupCamera(),this.setupMouseControls(),this.setupKeyboardControls(),this.setupUpdateLoop()}calculateMinZoom(){const e=this.camera.width/this.worldWidth,t=this.camera.height/this.worldHeight;this.minZoom=Math.min(e,t)}setupCamera(){this.currentZoom=this.minZoom,this.targetZoom=this.minZoom,this.camera.setZoom(this.minZoom);const e=this.camera.width/this.minZoom,t=this.camera.height/this.minZoom,i=Math.min(0,(this.worldWidth-e)/2),s=Math.min(0,(this.worldHeight-t)/2),r=Math.max(this.worldWidth,e),a=Math.max(this.worldHeight,t);this.camera.setBounds(i,s,r,a),this.camera.centerOn(this.worldWidth/2,this.worldHeight/2),wi(this.minZoom)}centerOn(e,t){this.camera.centerOn(e,t),this.clampScroll()}handleResize(){this.calculateMinZoom(),this.currentZoom<this.minZoom&&(this.currentZoom=this.minZoom,this.targetZoom=this.minZoom,this.camera.setZoom(this.minZoom)),this.targetZoom<this.minZoom&&(this.targetZoom=this.minZoom),this.updateCameraBounds(),this.clampScroll(),wi(this.currentZoom)}updateCameraBounds(){const e=this.camera.width/this.currentZoom,t=this.camera.height/this.currentZoom,i=Math.min(0,(this.worldWidth-e)/2),s=Math.min(0,(this.worldHeight-t)/2),r=Math.max(this.worldWidth,e),a=Math.max(this.worldHeight,t);this.camera.setBounds(i,s,r,a)}getScrollBounds(e=!0){const t=this.camera.width/this.currentZoom,i=this.camera.height/this.currentZoom;let s,r,a,o;return t>this.worldWidth?e?s=r=(this.worldWidth-t)/2:(s=this.worldWidth-t,r=0):(s=0,r=this.worldWidth-t),i>this.worldHeight?e?a=o=(this.worldHeight-i)/2:(a=this.worldHeight-i,o=0):(a=0,o=this.worldHeight-i),{minX:s,maxX:r,minY:a,maxY:o}}clampScroll(){const e=this.getScrollBounds(!0);this.camera.scrollX=Y.Math.Clamp(this.camera.scrollX,e.minX,e.maxX),this.camera.scrollY=Y.Math.Clamp(this.camera.scrollY,e.minY,e.maxY)}softClampScroll(){const e=this.getScrollBounds(!1);this.camera.scrollX=Y.Math.Clamp(this.camera.scrollX,e.minX,e.maxX),this.camera.scrollY=Y.Math.Clamp(this.camera.scrollY,e.minY,e.maxY)}applyPanDelta(e,t,i,s,r,a){const o=this.getScrollBounds(),l=(e-i)/this.currentZoom,d=(t-s)/this.currentZoom;this.camera.scrollX=Y.Math.Clamp(r-l,o.minX,o.maxX),this.camera.scrollY=Y.Math.Clamp(a-d,o.minY,o.maxY)}zoomToPoint(e,t,i){const s=this.camera.getWorldPoint(e,t);this.zoomToWorldPoint(s.x,s.y,i)}zoomToWorldPoint(e,t,i){const s=this.camera.scrollX,r=this.camera.scrollY,a=this.currentZoom;this.currentZoom=i,this.camera.setZoom(i),this.updateCameraBounds(),this.camera.scrollX=e-(e-s)*a/i,this.camera.scrollY=t-(t-r)*a/i,this.softClampScroll(),wi(this.currentZoom)}setupMouseControls(){this.scene.input.on("wheel",(e,t,i,s,r)=>{if(this.isAnimatingReset)return;if((e.event.ctrlKey||Math.abs(i)<5&&Math.abs(s)>0)&&!e.event.ctrlKey){const o=-s*Cr*3;this.targetZoom=Y.Math.Clamp(this.targetZoom+o,this.minZoom,cs);const l=this.camera.getWorldPoint(e.x,e.y);this.zoomTargetWorldPoint={x:l.x,y:l.y}}else if(e.event.ctrlKey){const o=-s*Cr,l=Y.Math.Clamp(this.currentZoom+o,this.minZoom,cs);this.targetZoom=l,this.zoomToPoint(e.x,e.y,l)}else{const o=this.getScrollBounds();this.camera.scrollX=Y.Math.Clamp(this.camera.scrollX+i/this.currentZoom,o.minX,o.maxX),this.camera.scrollY=Y.Math.Clamp(this.camera.scrollY+s/this.currentZoom,o.minY,o.maxY)}}),this.scene.input.on("pointerdown",e=>{if(e.wasTouch){if(this.activeTouches.set(e.id,{x:e.x,y:e.y}),this.activeTouches.size===2){this.isPinching=!0,this.startPinch(),this.touchStartPos=null,this.touchOnSelectedSprite=!1,this.scene.data.set("touchDraggingSprite",!1);return}this.activeTouches.size===1&&!this.isPinching&&(this.touchStartTime=Date.now(),this.touchStartPos={x:e.x,y:e.y},this.dragScrollStartX=e.x,this.dragScrollStartY=e.y,this.dragScrollCameraStartX=this.camera.scrollX,this.dragScrollCameraStartY=this.camera.scrollY,this.touchOnSelectedSprite=ld(this.scene,e),this.scene.data.set("touchDraggingSprite",!1),this.scene.data.set("touchStartOnSelectedSprite",this.touchOnSelectedSprite),this.scene.data.set("touchStartWorldX",e.worldX),this.scene.data.set("touchStartWorldY",e.worldY));return}gn()||cr()||this.isAnimatingReset||(e.rightButtonDown()||e.middleButtonDown()?(this.isPanning=!0,this.panStartX=e.x,this.panStartY=e.y,this.cameraDragStartX=this.camera.scrollX,this.cameraDragStartY=this.camera.scrollY):e.leftButtonDown()&&!this.isDraggingObject()&&(this.scene.data.get("isDraggingItem")===!0||(this.dragScrollStartX=e.x,this.dragScrollStartY=e.y,this.dragScrollCameraStartX=this.camera.scrollX,this.dragScrollCameraStartY=this.camera.scrollY)))}),this.scene.input.on("pointermove",e=>{if(e.wasTouch){if(this.activeTouches.has(e.id)&&this.activeTouches.set(e.id,{x:e.x,y:e.y}),this.activeTouches.size>=2&&this.isPinching){this.handlePinch();return}if(this.isPinching||Date.now()-this.pinchEndTime<this.PINCH_COOLDOWN||this.scene.data.get("touchDraggingSprite"))return;if(this.touchStartPos&&!this.isDraggingToScroll){const t=Math.abs(e.x-this.touchStartPos.x),i=Math.abs(e.y-this.touchStartPos.y);if(Math.sqrt(t*t+i*i)>this.TAP_MAX_DISTANCE){if(this.touchOnSelectedSprite){this.scene.data.set("touchDragStarted",!0),this.scene.data.set("touchDraggingSprite",!0),this.touchStartPos=null;return}!gn()&&!this.isDraggingObject()&&!this.scene.data.get("isDraggingItem")&&(this.isDraggingToScroll=!0,this.touchStartPos=null)}}this.isDraggingToScroll&&this.applyPanDelta(e.x,e.y,this.dragScrollStartX,this.dragScrollStartY,this.dragScrollCameraStartX,this.dragScrollCameraStartY);return}if(!(cr()||this.isAnimatingReset)){if(this.isPanning)this.applyPanDelta(e.x,e.y,this.panStartX,this.panStartY,this.cameraDragStartX,this.cameraDragStartY);else if(e.leftButtonDown()&&!this.isDraggingToScroll&&!this.isDraggingObject()&&!(this.scene.data.get("isDraggingItem")===!0)){const i=Math.abs(e.x-this.dragScrollStartX),s=Math.abs(e.y-this.dragScrollStartY);Math.sqrt(i*i+s*s)>10&&(this.isDraggingToScroll=!0,this.scene.input.setDefaultCursor("grabbing"))}this.isDraggingToScroll&&this.applyPanDelta(e.x,e.y,this.dragScrollStartX,this.dragScrollStartY,this.dragScrollCameraStartX,this.dragScrollCameraStartY)}}),this.scene.input.on("pointerup",e=>{if(e.wasTouch){if(this.isPinching&&(this.pinchEndTime=Date.now(),this.isPinching=!1,is(!1)),this.touchStartPos&&!this.isDraggingToScroll){const t=Date.now()-this.touchStartTime,i=Math.abs(e.x-this.touchStartPos.x),s=Math.abs(e.y-this.touchStartPos.y),r=Math.sqrt(i*i+s*s);t<this.TAP_MAX_DURATION&&r<this.TAP_MAX_DISTANCE&&(this.scene.data.set("lastTapTime",Date.now()),this.scene.data.set("lastTapWorldX",e.worldX),this.scene.data.set("lastTapWorldY",e.worldY))}this.touchStartPos=null,this.touchOnSelectedSprite=!1,this.activeTouches.delete(e.id),this.scene.data.set("touchDraggingSprite",!1),this.scene.data.set("touchDragStarted",!1),this.scene.data.set("touchStartOnSelectedSprite",!1),this.isDraggingToScroll&&(this.isDraggingToScroll=!1);return}!e.rightButtonDown()&&!e.middleButtonDown()&&(this.isPanning=!1),this.isDraggingToScroll&&(this.isDraggingToScroll=!1,this.scene.input.setDefaultCursor("default"))}),this.scene.input.on("pointerout",e=>{e.wasTouch&&(this.activeTouches.delete(e.id),this.touchStartPos=null,this.touchOnSelectedSprite=!1,this.isPinching&&this.activeTouches.size<2&&(this.isPinching=!1,this.pinchEndTime=Date.now(),is(!1)))})}startPinch(){const e=Array.from(this.activeTouches.values());if(e.length!==2)return;const[t,i]=e;this.pinchStartDistance=Math.hypot(i.x-t.x,i.y-t.y),this.pinchStartZoom=this.currentZoom,is(!0)}handlePinch(){const e=Array.from(this.activeTouches.values());if(e.length!==2)return;const[t,i]=e,s=Math.hypot(i.x-t.x,i.y-t.y),r=(t.x+i.x)/2,a=(t.y+i.y)/2,o=s/this.pinchStartDistance,l=Y.Math.Clamp(this.pinchStartZoom*o,this.minZoom,cs);this.targetZoom=l,this.zoomToPoint(r,a,l)}setupKeyboardControls(){const e={up:this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.UP,!1),down:this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.DOWN,!1),left:this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.LEFT,!1),right:this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.RIGHT,!1)},t={w:this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.W,!1),a:this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.A,!1),s:this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.S,!1),d:this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.D,!1)};this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.SPACE,!1).on("down",()=>{Tn()||this.centerOnPlayer()}),this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.F,!1).on("down",()=>{Tn()||this.resetToFit()}),this.scene.data.set("cameraArrowKeys",e),this.scene.data.set("cameraWasdKeys",t)}setupUpdateLoop(){const e=this.scene.data.get("cameraArrowKeys"),t=this.scene.data.get("cameraWasdKeys");this.scene.events.on("update",()=>{if(!this.isAnimatingReset&&Math.abs(this.currentZoom-this.targetZoom)>1e-4){const r=Y.Math.Linear(this.currentZoom,this.targetZoom,Td);this.zoomTargetWorldPoint?this.zoomToWorldPoint(this.zoomTargetWorldPoint.x,this.zoomTargetWorldPoint.y,r):this.zoomToPoint(this.camera.width/2,this.camera.height/2,r),Math.abs(this.currentZoom-this.targetZoom)<.001&&(this.zoomTargetWorldPoint=null)}if(Tn()||this.isAnimatingReset)return;const i=10/this.currentZoom,s=this.getScrollBounds();e?.left?.isDown||t?.a?.isDown?this.camera.scrollX=Y.Math.Clamp(this.camera.scrollX-i,s.minX,s.maxX):(e?.right?.isDown||t?.d?.isDown)&&(this.camera.scrollX=Y.Math.Clamp(this.camera.scrollX+i,s.minX,s.maxX)),e?.up?.isDown||t?.w?.isDown?this.camera.scrollY=Y.Math.Clamp(this.camera.scrollY-i,s.minY,s.maxY):(e?.down?.isDown||t?.s?.isDown)&&(this.camera.scrollY=Y.Math.Clamp(this.camera.scrollY+i,s.minY,s.maxY))})}centerOnPlayer(){const e=this.scene.data.get("playerSprite");e&&(this.camera.centerOn(e.x,e.y),this.clampScroll())}isDraggingObject(){return this.scene.data.get("isDraggingObject")===!0||this.scene.data.get("isDraggingItem")===!0}resetToFit(){if(this.isAnimatingReset)return;this.isAnimatingReset=!0,this.targetZoom=this.minZoom;const e=this.camera.width/this.minZoom,t=this.camera.height/this.minZoom,i=(this.worldWidth-e)/2,s=(this.worldHeight-t)/2,r=i+e/2,a=s+t/2;this.camera.pan(r,a,Tr,"Sine.easeInOut"),this.camera.zoomTo(this.minZoom,Tr,"Sine.easeInOut",!1,(o,l)=>{l===1&&(this.currentZoom=this.minZoom,this.camera.scrollX=i,this.camera.scrollY=s,this.isAnimatingReset=!1,wi(this.minZoom))})}destroy(){this.activeTouches.clear()}}const Dd=Xn.PLAYER.hex;class Pd{scene;player;worldWidth;worldHeight;unsubscribers=[];interactionCleanup=null;constructor(e,t,i){this.scene=e,this.worldWidth=t,this.worldHeight=i}create(e,t){const i=Math.min(t,ai(this.worldHeight)),s=ei.getSkinId();return this.player=this.scene.add.sprite(e,i,`${s}-idle`,0),this.player.setScale(Ln.SCALE),this.player.setDepth(Ln.DEPTH),this.player.setData("isPlayer",!0),this.scene.data.set("playerSprite",this.player),this.setupInteraction(),this.setupEditModeSubscription(),this.setupSelectionSubscription(),this.player}setupInteraction(){const e=new Y.Geom.Rectangle(8,4,32,40);this.interactionCleanup=Vi({sprite:this.player,scene:this.scene,useGridSnapping:!1,cursor:"grab",hitArea:e,constraints:{minX:wr,maxX:this.worldWidth-wr,minY:sd},callbacks:{onSelect:()=>{Rc(!0)},isSelected:()=>gt(ss),onDragStart:()=>{this.player.setTint(Ks),this.scene.data.set("isDraggingObject",!0)},onDrag:(t,i)=>{_r(Math.round(t),Math.round(i))},onDragEnd:(t,i)=>{this.updateSelectionVisual(gt(ss)),this.scene.data.set("isDraggingObject",!1);let s=this.player.y;nc(this.player.y,this.worldHeight)&&(s=ai(this.worldHeight),this.player.setY(s)),_r(Math.round(this.player.x),Math.round(s))}}})}setupSelectionSubscription(){const e=ss.subscribe(t=>{this.updateSelectionVisual(t),this.scene.data.set("isPlayerSelected",t)});this.unsubscribers.push(e)}updateSelectionVisual(e){this.player&&(e?this.player.setTint(Dd):this.player.clearTint())}setupEditModeSubscription(){const e=je.subscribe(t=>{t==="dialogs"?(this.interactionCleanup&&(this.interactionCleanup(),this.interactionCleanup=null),this.player.disableInteractive(),this.player.setAlpha(.6)):(this.player.setAlpha(1),this.interactionCleanup||this.setupInteraction())});this.unsubscribers.push(e)}getSprite(){return this.player}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.interactionCleanup&&(this.interactionCleanup(),this.interactionCleanup=null),this.player&&this.player.destroy()}}class Ad{scene;graphics;worldWidth;worldHeight;constructor(e,t,i){this.scene=e,this.worldWidth=t,this.worldHeight=i}create(){return this.graphics=this.scene.add.graphics(),this.graphics.setDepth(fo),this.draw(),this.graphics}draw(){this.graphics.clear(),this.graphics.lineStyle(Jc,jc,qc);const e=Math.max(this.worldHeight,this.scene.scale.height);for(let i=0;i<=this.worldWidth;i+=In)this.graphics.beginPath(),this.graphics.moveTo(i,0),this.graphics.lineTo(i,e),this.graphics.strokePath();for(let i=0;i<=e;i+=In)this.graphics.beginPath(),this.graphics.moveTo(0,i),this.graphics.lineTo(this.worldWidth,i),this.graphics.strokePath();const t=this.worldHeight-On;this.graphics.lineStyle(Qc,ls,ed),this.graphics.beginPath(),this.graphics.moveTo(0,t),this.graphics.lineTo(this.worldWidth,t),this.graphics.strokePath(),this.graphics.lineStyle(nd,ls,id),this.graphics.fillStyle(ls,td),this.graphics.fillRect(0,t,this.worldWidth,e-t)}getGraphics(){return this.graphics}redraw(){this.draw()}destroy(){this.graphics&&this.graphics.destroy()}}class Md{listeners=new Map;on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set);const i=this.listeners.get(e);return i.add(t),{unsubscribe:()=>{i.delete(t),i.size===0&&this.listeners.delete(e)}}}once(e,t){const i=this.on(e,s=>{i.unsubscribe(),t(s)});return i}emit(e,t){const i=this.listeners.get(e);i&&i.forEach(s=>{try{s(t)}catch(r){console.error(`[EventBus] Error in listener for "${e}":`,r)}})}off(e){this.listeners.delete(e)}clear(){this.listeners.clear()}listenerCount(e){return this.listeners.get(e)?.size??0}}const Ue=new Md,Re={ASSET_DROPPED:"asset:dropped",FRAME_DROPPED:"frame:dropped",SOCIAL_DROPPED:"social:dropped",MINIMAP_NAVIGATE:"minimap:navigate",DIALOG_ZONE_CREATE:"dialogZone:create",DIALOG_ZONE_CREATE_AT:"dialogZone:createAt",TEMP_ZONE_BUTTON_SHOW:"tempZoneButton:show",TEMP_ZONE_BUTTON_HIDE:"tempZoneButton:hide"};class $d{scene;groundY;worldWidth;worldHeight;itemManager;unsubscribers=[];constructor(e,t,i,s){this.scene=e,this.groundY=t,this.worldWidth=i,this.worldHeight=s}create(e){return this.itemManager=new Ri(this.scene,this.groundY,this.worldWidth,this.worldHeight,!0),e&&e.length>0&&this.itemManager.createItems(e),this.setupBackgroundDeselect(),this.setupStoreSubscriptions(),this.setupAssetDropListener(),this.setupDeleteKeys(),this.itemManager}setupBackgroundDeselect(){this.itemManager.setupBackgroundDeselect()}setupStoreSubscriptions(){const e=Ki.subscribe(r=>{this.scene.data.set("selectedItemId",r),this.itemManager.updateSelectionVisuals()});this.unsubscribers.push(e);const t=je.subscribe(r=>{r==="dialogs"?(Ns(),this.itemManager.setInteractiveEnabled(!1)):this.itemManager.setInteractiveEnabled(!0)});this.unsubscribers.push(t);let i=[];const s=bc.subscribe(r=>{if(!r?.placedItems)return;const a=r.placedItems;i.forEach(o=>{a.find(d=>d.id===o.id)||this.itemManager.removeItem(o.id)}),a.forEach(o=>{const l=i.find(d=>d.id===o.id);l&&JSON.stringify(l)!==JSON.stringify(o)&&this.itemManager.updateItem(o.id,o)}),i=a.map(o=>({...o}))});this.unsubscribers.push(s)}setupAssetDropListener(){const e=Ue.on(Re.ASSET_DROPPED,t=>{const{assetKey:i,canvasX:s,canvasY:r}=t,o=this.scene.cameras.main.getWorldPoint(s,r),l=Math.max(0,Math.min(this.worldWidth,o.x)),d=Math.max(0,Math.min(this.worldHeight,o.y));let u="behind";eo.subscribe(p=>{u=p})();const f=Ci.createAtWorldPosition(i,l,d,this.groundY,u);Oc(f),this.itemManager.createItem(f),lo(f.id),cn.set(!1)});this.unsubscribers.push(()=>e.unsubscribe())}setupDeleteKeys(){const e=this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.DELETE,!1),t=this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.BACKSPACE,!1),i=()=>{if(Tn())return;const s=this.scene.data.get("selectedItemId");s&&oo(s)};e.on("down",i),t.on("down",i)}getManager(){return this.itemManager}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.itemManager&&this.itemManager.destroy()}}class kr{scene;worldWidth;worldHeight;frames=new Map;unsubscribers=[];selectionGraphics=null;cleanupFunctions=new Map;doubleClickDetector=new go;constructor(e,t,i){this.scene=e,this.worldWidth=t,this.worldHeight=i}static preloadAssets(e){for(let t=1;t<=25;t++)e.load.image(`frame_base_${t}`,`assets/frames/base ${t}.png`)}create(e){this.selectionGraphics=this.scene.add.graphics(),this.selectionGraphics.setDepth(Ve.SELECTION_GRAPHICS),e&&e.length>0&&e.forEach(t=>this.createFrame(t)),this.setupStoreSubscriptions(),this.setupFrameDropListener(),this.setupDeleteKeys()}createFrame(e){const t=`frame_${e.frameKey}`;if(!this.scene.textures.exists(t)){console.warn(`Frame texture not found: ${t}`);return}const i=e.scale??Xt,s=e.depth??Ve.ITEMS_FRONT,r=(e.rotation??0)*(Math.PI/180),a=e.rotation===90,{innerWidth:o,innerHeight:l}=Qn(i,a),d=this.scene.add.graphics();d.setDepth(s-.1),Ii(d,e.x,e.y,o,l,e.backgroundColor||Kn);const u=this.scene.add.sprite(e.x,e.y,t);u.setScale(i),u.setDepth(s),u.setOrigin(.5,.5),u.setRotation(r),u.setData("frameId",e.id);const h={sprite:u,background:d,data:e};this.frames.set(e.id,h),this.makeInteractive(h,e.id)}updateFrameVisuals(e){const{sprite:t,background:i,data:s}=e,r=`frame_${s.frameKey}`;t.texture.key!==r&&this.scene.textures.exists(r)&&t.setTexture(r);const a=s.scale??Xt;t.setScale(a);const o=(s.rotation??0)*(Math.PI/180);t.setRotation(o);const l=s.rotation===90,{innerWidth:d,innerHeight:u}=Qn(a,l);Ii(i,t.x,t.y,d,u,s.backgroundColor||Kn)}moveContainer(e,t,i){const{sprite:s,background:r,data:a}=e;s.setPosition(t,i);const o=a.scale??Xt,l=a.rotation===90,{innerWidth:d,innerHeight:u}=Qn(o,l);Ii(r,t,i,d,u,a.backgroundColor||Kn)}makeInteractive(e,t){const{sprite:i}=e,s=Vi({sprite:i,scene:this.scene,cursor:"grab",useGridSnapping:!0,constraints:{minX:0,maxX:this.worldWidth,minY:0,maxY:this.worldHeight},callbacks:{onSelect:()=>{qn(t),this.updateSelectionVisuals()},isSelected:()=>gt(li)===t,onDoubleClick:()=>this.doubleClickDetector.check(t)?(Ja(),!0):!1,onDragStart:()=>{i.setTint(Ks)},onDrag:(r,a)=>{this.moveContainer(e,r,a),this.updateSelectionVisuals(),Pc(t,r,a)},onDragEnd:(r,a)=>{i.clearTint(),Ac(t),e.data.x=Math.round(r),e.data.y=Math.round(a),xt(t,{x:e.data.x,y:e.data.y})}}});this.cleanupFunctions.set(t,s)}setupStoreSubscriptions(){const e=li.subscribe(r=>{this.scene.data.set("selectedFrameId",r),this.updateSelectionVisuals()});this.unsubscribers.push(e);const t=je.subscribe(r=>{r==="dialogs"?(qn(null),this.setInteractiveEnabled(!1)):this.setInteractiveEnabled(!0)});this.unsubscribers.push(t);let i=[];const s=to.subscribe(r=>{i.forEach(a=>{r.find(l=>l.id===a.id)||this.removeFrame(a.id)}),r.forEach(a=>{const o=i.find(d=>d.id===a.id),l=this.frames.get(a.id);if(l&&o){const d=o.backgroundColor!==a.backgroundColor,u=o.textColor!==a.textColor,h=o.textSize!==a.textSize,f=JSON.stringify(o.texts)!==JSON.stringify(a.texts),p=o.rotation!==a.rotation,g=o.scale!==a.scale,v=o.frameKey!==a.frameKey;l.data=a,(d||u||h||f||p||g||v)&&(this.updateFrameVisuals(l),this.scene.data.get("selectedFrameId")===a.id&&this.updateSelectionVisuals())}}),i=r.map(a=>({...a}))});this.unsubscribers.push(s)}setupFrameDropListener(){const e=Ue.on(Re.FRAME_DROPPED,t=>{const{frameKey:i,canvasX:s,canvasY:r}=t,o=this.scene.cameras.main.getWorldPoint(s,r),l=Math.max(0,Math.min(this.worldWidth,o.x)),d=Math.max(0,Math.min(this.worldHeight,o.y)),u={id:ud(),frameKey:i,x:Math.round(l),y:Math.round(d),scale:Sd(i),depth:Ve.ITEMS_FRONT,rotation:90,backgroundColor:Kn,textColor:"#333333",textSize:16,texts:[{language:"cs",text:""},{language:"en",text:""}]};Gc(u),this.createFrame(u),qn(u.id)});this.unsubscribers.push(()=>e.unsubscribe())}setupDeleteKeys(){const e=this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.DELETE,!1),t=this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.BACKSPACE,!1),i=()=>{if(Tn())return;let s="items";if(je.subscribe(o=>s=o)(),s!=="frames")return;const a=this.scene.data.get("selectedFrameId");a&&Ws(a)};e.on("down",i),t.on("down",i)}updateSelectionVisuals(){if(!this.selectionGraphics)return;this.selectionGraphics.clear();const e=this.scene.data.get("selectedFrameId");if(!e){os(null);return}const t=this.frames.get(e);if(!t){os(null);return}const i=t.sprite,s=i.getBounds(),r=this.scene.cameras.main,{screenX:a,screenY:o}=sn(i.x,i.y,r);os({screenX:a,screenY:o,frameHeight:s.height*r.zoom}),this.selectionGraphics.lineStyle(3,Xn.FRAME.hex,1),this.selectionGraphics.strokeRect(s.x-4,s.y-4,s.width+8,s.height+8)}removeFrame(e){const t=this.frames.get(e);t&&(t.sprite.destroy(),t.background.destroy(),this.frames.delete(e)),this.updateSelectionVisuals()}setInteractiveEnabled(e){this.frames.forEach(({sprite:t,background:i})=>{e?(t.setInteractive(),t.setAlpha(1),i.setAlpha(1)):(t.disableInteractive(),t.setAlpha(.6),i.setAlpha(.6))}),!e&&this.selectionGraphics&&this.selectionGraphics.clear()}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.frames.forEach(({sprite:e,background:t})=>{e.destroy(),t.destroy()}),this.frames.clear(),this.selectionGraphics&&(this.selectionGraphics.destroy(),this.selectionGraphics=null)}}class Dr{scene;worldWidth;worldHeight;socials=new Map;unsubscribers=[];selectionGraphics=null;cleanupFunctions=new Map;doubleClickDetector=new go;constructor(e,t,i){this.scene=e,this.worldWidth=t,this.worldHeight=i}static preloadAssets(e){e.load.image("social_discord","assets/socials/Discord.png"),e.load.image("social_facebook","assets/socials/Facebook.png"),e.load.image("social_instagram","assets/socials/Instagram.png"),e.load.image("social_kofi","assets/socials/Ko Fi.png"),e.load.image("social_linkedin","assets/socials/LinkedIn.png"),e.load.image("social_patreon","assets/socials/Patreon.png"),e.load.image("social_tiktok","assets/socials/TikTok.png"),e.load.image("social_twitch","assets/socials/Twitch.png"),e.load.image("social_twitter","assets/socials/Twitter.png"),e.load.image("social_whatsapp","assets/socials/Whatsapp.png"),e.load.image("social_youtube","assets/socials/Youtube.png")}create(e){this.selectionGraphics=this.scene.add.graphics(),this.selectionGraphics.setDepth(Ve.SELECTION_GRAPHICS),e&&e.length>0&&e.forEach(t=>this.createSocial(t)),this.setupStoreSubscriptions(),this.setupSocialDropListener(),this.setupDeleteKeys()}createSocial(e){const t=`social_${e.socialKey}`;if(!this.scene.textures.exists(t)){console.warn(`Social texture not found: ${t}`);return}const i=e.scale??Dn,s=e.depth??Ve.ITEMS_FRONT,r=this.scene.add.sprite(e.x,e.y,t);r.setScale(i),r.setDepth(s),r.setOrigin(.5,.5),r.setData("socialId",e.id),this.socials.set(e.id,{sprite:r,data:e}),this.makeInteractive(e.id)}updateSocialVisuals(e){const t=this.socials.get(e);if(!t)return;const{sprite:i,data:s}=t,r=`social_${s.socialKey}`;i.texture.key!==r&&this.scene.textures.exists(r)&&i.setTexture(r);const a=s.scale??Dn;i.setScale(a)}makeInteractive(e){const t=this.socials.get(e);if(!t)return;const{sprite:i}=t,s=Vi({sprite:i,scene:this.scene,cursor:"grab",useGridSnapping:!0,constraints:{minX:0,maxX:this.worldWidth,minY:0,maxY:this.worldHeight},callbacks:{onSelect:()=>{Jn(e),this.updateSelectionVisuals()},isSelected:()=>gt(ci)===e,onDoubleClick:()=>this.doubleClickDetector.check(e)?(Qa(),!0):!1,onDragStart:()=>{i.setTint(Ks)},onDrag:()=>{this.updateSelectionVisuals()},onDragEnd:(r,a)=>{i.clearTint();const o=this.socials.get(e);o&&(o.data.x=Math.round(r),o.data.y=Math.round(a),xi(e,{x:o.data.x,y:o.data.y}))}}});this.cleanupFunctions.set(e,s)}setupStoreSubscriptions(){const e=ci.subscribe(r=>{this.scene.data.set("selectedSocialId",r),this.updateSelectionVisuals()});this.unsubscribers.push(e);const t=je.subscribe(r=>{r==="dialogs"?(Jn(null),this.setInteractiveEnabled(!1)):this.setInteractiveEnabled(!0)});this.unsubscribers.push(t);let i=[];const s=kc.subscribe(r=>{i.forEach(a=>{r.find(l=>l.id===a.id)||this.removeSocial(a.id)}),r.forEach(a=>{const o=i.find(d=>d.id===a.id),l=this.socials.get(a.id);if(l&&o){const d=o.scale!==a.scale,u=o.socialKey!==a.socialKey;l.data=a,(d||u)&&(this.updateSocialVisuals(a.id),this.scene.data.get("selectedSocialId")===a.id&&this.updateSelectionVisuals())}}),i=r.map(a=>({...a}))});this.unsubscribers.push(s)}setupSocialDropListener(){const e=Ue.on(Re.SOCIAL_DROPPED,t=>{const{socialKey:i,canvasX:s,canvasY:r}=t,o=this.scene.cameras.main.getWorldPoint(s,r),l=Math.max(0,Math.min(this.worldWidth,o.x)),d=Math.max(0,Math.min(this.worldHeight,o.y)),u={id:xd(),socialKey:i,x:Math.round(l),y:Math.round(d),scale:Dn,depth:Ve.ITEMS_FRONT};Kc(u),this.createSocial(u),Jn(u.id)});this.unsubscribers.push(()=>e.unsubscribe())}setupDeleteKeys(){const e=this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.DELETE,!1),t=this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.BACKSPACE,!1),i=()=>{if(Tn())return;let s="items";if(je.subscribe(o=>s=o)(),s!=="socials")return;const a=this.scene.data.get("selectedSocialId");a&&zs(a)};e.on("down",i),t.on("down",i)}updateSelectionVisuals(){if(!this.selectionGraphics)return;this.selectionGraphics.clear();const e=this.scene.data.get("selectedSocialId");if(!e){rs(null);return}const t=this.socials.get(e);if(!t){rs(null);return}const i=t.sprite,s=i.getBounds(),r=this.scene.cameras.main,{screenX:a,screenY:o}=sn(i.x,i.y,r);rs({screenX:a,screenY:o,socialHeight:s.height*r.zoom}),this.selectionGraphics.lineStyle(3,Xn.SOCIAL.hex,1),this.selectionGraphics.strokeRect(s.x-4,s.y-4,s.width+8,s.height+8)}removeSocial(e){const t=this.socials.get(e);t&&(t.sprite.destroy(),this.socials.delete(e));const i=this.cleanupFunctions.get(e);i&&(i(),this.cleanupFunctions.delete(e)),this.updateSelectionVisuals()}setInteractiveEnabled(e){this.socials.forEach(({sprite:t})=>{e?(t.setInteractive(),t.setAlpha(1)):(t.disableInteractive(),t.setAlpha(.6))}),!e&&this.selectionGraphics&&this.selectionGraphics.clear()}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.cleanupFunctions.forEach(e=>e()),this.cleanupFunctions.clear(),this.socials.forEach(({sprite:e})=>{e.destroy()}),this.socials.clear(),this.selectionGraphics&&(this.selectionGraphics.destroy(),this.selectionGraphics=null)}}const Wt=fo-1,zt=300,Pr=150,Ld=.3,Od=.5,ds=40,Ar=60,Mr=16777215,$r=.6,Lr=0,wt=60,Or=8;class Rd{scene;worldWidth;worldHeight;graphics=null;zoneAreas=new Map;leftHandles=new Map;leftHandleVisuals=new Map;rightHandles=new Map;rightHandleVisuals=new Map;arrowGraphics=new Map;dragging=null;unsubscribers=[];createZoneSubscription;currentEditMode="items";currentZones=[];currentSelectedId=null;lastClickTime=0;lastClickX=0;DOUBLE_CLICK_THRESHOLD=300;DOUBLE_CLICK_DISTANCE=20;pendingTap=null;TAP_MAX_DURATION=300;TAP_MAX_DISTANCE=15;pendingZoneSelection=null;createZoneAtSubscription;boundWindowPointerUp=()=>{};boundWindowPointerMove=()=>{};currentScreenX=0;autoScrollTimer=null;constructor(e,t,i){this.scene=e,this.worldWidth=t,this.worldHeight=i}create(){this.graphics=this.scene.add.graphics(),this.graphics.setDepth(Wt);const e=je.subscribe(s=>{this.currentEditMode=s,this.render()});this.unsubscribers.push(e);const t=Fs.subscribe(s=>{this.currentZones=s,this.render()});this.unsubscribers.push(t);const i=Ui.subscribe(s=>{this.currentSelectedId=s,this.render()});this.unsubscribers.push(i),this.scene.input.on("pointermove",this.handlePointerMove,this),this.scene.input.on("pointerup",this.handlePointerUp,this),this.boundWindowPointerUp=this.handlePointerUp.bind(this),this.boundWindowPointerMove=this.handleWindowPointerMove.bind(this),window.addEventListener("pointerup",this.boundWindowPointerUp),window.addEventListener("pointermove",this.boundWindowPointerMove),this.scene.input.on("pointerdown",this.handlePointerDown,this),this.createZoneSubscription=Ue.on(Re.DIALOG_ZONE_CREATE,()=>{this.createNewZone()}),this.createZoneAtSubscription=Ue.on(Re.DIALOG_ZONE_CREATE_AT,s=>{this.createZoneAtPosition(s.worldX)}),this.render()}clearVisuals(){this.graphics&&this.graphics.clear(),this.zoneAreas.forEach(e=>e.destroy()),this.zoneAreas.clear(),this.leftHandles.forEach(e=>e.destroy()),this.leftHandles.clear(),this.rightHandles.forEach(e=>e.destroy()),this.rightHandles.clear(),this.leftHandleVisuals.forEach(e=>e.destroy()),this.leftHandleVisuals.clear(),this.rightHandleVisuals.forEach(e=>e.destroy()),this.rightHandleVisuals.clear(),this.arrowGraphics.forEach(e=>e.destroy()),this.arrowGraphics.clear()}render(){if(this.clearVisuals(),this.currentEditMode==="dialogs")for(const e of this.currentZones)this.renderZone(e,e.id===this.currentSelectedId)}renderZone(e,t){if(!this.graphics)return;const i=Y.Display.Color.HexStringToColor(e.color).color,s=t?Od:Ld;this.graphics.fillStyle(i,s),this.graphics.fillRect(e.x,0,e.width,this.worldHeight),this.graphics.lineStyle(2,i,.8),this.graphics.strokeRect(e.x,0,e.width,this.worldHeight);const r=this.scene.add.rectangle(e.x+e.width/2,this.worldHeight/2,e.width-ds*2,this.worldHeight);r.setOrigin(.5,.5),r.setInteractive({cursor:t?"grab":"pointer"}),r.setDepth(Wt+.1),r.setAlpha(.001),r.setData("zoneId",e.id),r.on("pointerdown",a=>{if(this.isClickOnUIElement(a))return;const o=Date.now(),l=o-this.lastClickTime<this.DOUBLE_CLICK_THRESHOLD&&Math.abs(a.worldX-this.lastClickX)<this.DOUBLE_CLICK_DISTANCE;this.lastClickTime=o,this.lastClickX=a.worldX;const d=this.currentSelectedId===e.id;if(l&&d){ao();return}d?(this.scene.data.set("isDraggingItem",!0),kn(!0),this.startDrag(e.id,"move",a.worldX)):this.pendingZoneSelection={zoneId:e.id,worldX:a.worldX,startTime:o}}),this.zoneAreas.set(e.id,r),t&&this.createHandles(e)}createHandles(e){const t=this.scene.cameras.main.scrollY,i=this.scene.cameras.main.height,s=t+i/2,r=this.scene.add.rectangle(e.x,this.worldHeight/2,ds,this.worldHeight);r.setOrigin(.5,.5),r.setDepth(Wt+.2),r.setFillStyle(Mr,$r);const a=this.scene.add.rectangle(e.x,this.worldHeight/2,Ar,this.worldHeight);a.setOrigin(.5,.5),a.setInteractive({cursor:"ew-resize"}),a.setDepth(Wt+.25),a.setAlpha(.001),a.setData("zoneId",e.id),a.setData("type","left"),a.on("pointerdown",f=>{this.isClickOnUIElement(f)||this.startDrag(e.id,"left",f.worldX)}),this.leftHandles.set(e.id,a),this.leftHandleVisuals.set(e.id,r);const o=8,l=this.scene.add.graphics();l.setDepth(Wt+.3),this.drawArrow(l,e.x-o,s,"left"),this.arrowGraphics.set(`${e.id}_left`,l);const d=this.scene.add.rectangle(e.x+e.width,this.worldHeight/2,ds,this.worldHeight);d.setOrigin(.5,.5),d.setDepth(Wt+.2),d.setFillStyle(Mr,$r);const u=this.scene.add.rectangle(e.x+e.width,this.worldHeight/2,Ar,this.worldHeight);u.setOrigin(.5,.5),u.setInteractive({cursor:"ew-resize"}),u.setDepth(Wt+.25),u.setAlpha(.001),u.setData("zoneId",e.id),u.setData("type","right"),u.on("pointerdown",f=>{this.isClickOnUIElement(f)||this.startDrag(e.id,"right",f.worldX)}),this.rightHandles.set(e.id,u),this.rightHandleVisuals.set(e.id,d);const h=this.scene.add.graphics();h.setDepth(Wt+.3),this.drawArrow(h,e.x+e.width+o,s,"right"),this.arrowGraphics.set(`${e.id}_right`,h)}drawArrow(e,t,i,s){const a=s==="left"?-1:1;e.fillStyle(3355443,.8),e.beginPath(),e.moveTo(t+a*10+1,i),e.lineTo(t-a*10+1,i-10+1),e.lineTo(t-a*10+1,i+10-1),e.closePath(),e.fillPath(),e.fillStyle(16777215,.9),e.beginPath(),e.moveTo(t+a*10,i),e.lineTo(t-a*10,i-10),e.lineTo(t-a*10,i+10),e.closePath(),e.fillPath()}startDrag(e,t,i){const s=this.currentZones.find(r=>r.id===e);s&&(this.scene.data.set("isDraggingItem",!0),kn(!0),this.dragging={zoneId:e,type:t,startX:i,originalX:s.x,originalWidth:s.width})}getZoneBounds(e){let t=0,i=this.worldWidth;for(const s of this.currentZones){if(s.id===e)continue;const r=s.x+s.width,a=this.currentZones.find(o=>o.id===e);a&&(r<=a.x+a.width/2&&(t=Math.max(t,r+Lr)),s.x>=a.x+a.width/2&&(i=Math.min(i,s.x-Lr)))}return{minX:t,maxX:i-zt,maxRight:i}}wouldOverlap(e,t,i){const s=t+i;for(const r of this.currentZones){if(r.id===e)continue;const a=r.x,o=r.x+r.width;if(t<o&&s>a)return!0}return!1}isClickOnUIElement(e){const t=e.downElement;return t?t.tagName?.toUpperCase()!=="CANVAS":!1}cancelPendingIfMoved(e){this.pendingTap&&Math.abs(e-this.pendingTap.worldX)>this.TAP_MAX_DISTANCE&&(this.pendingTap=null),this.pendingZoneSelection&&Math.abs(e-this.pendingZoneSelection.worldX)>this.TAP_MAX_DISTANCE&&(this.pendingZoneSelection=null)}screenToWorld(e,t){const i=this.scene.cameras.main,r=this.scene.game.canvas.getBoundingClientRect(),a=e-r.left,o=t-r.top;return rc(a,o,i)}handleWindowPointerMove(e){const t=this.screenToWorld(e.clientX,e.clientY);if(this.cancelPendingIfMoved(t.worldX),!this.dragging)return;const s=this.scene.game.canvas.getBoundingClientRect();e.clientX>=s.left&&e.clientX<=s.right&&e.clientY>=s.top&&e.clientY<=s.bottom||(this.currentScreenX=e.clientX-s.left,this.updateDrag(t.worldX),this.checkAutoScroll())}handlePointerMove(e){this.cancelPendingIfMoved(e.worldX),this.dragging&&(this.currentScreenX=e.x,e.event?.stopPropagation?.(),this.updateDrag(e.worldX),this.checkAutoScroll())}checkAutoScroll(){if(!this.dragging||this.dragging.type!=="move"){this.stopAutoScroll();return}const e=this.scene.cameras.main,t=e.width,i=this.currentZones.find(_=>_.id===this.dragging?.zoneId);if(!i)return;const s=Math.max(0,this.worldWidth-e.width/e.zoom);if(s<=0){this.stopAutoScroll();return}const{screenX:r}=sn(i.x,0,e),{screenX:a}=sn(i.x+i.width,0,e),o=r<=wt,l=a>=t-wt,d=e.scrollX>0,u=e.scrollX<s,h=i.x>0,f=i.x+i.width<this.worldWidth,p=this.currentScreenX<wt,g=this.currentScreenX>t-wt,m=o&&p&&d&&h||l&&g&&u&&f;m&&!this.autoScrollTimer?this.autoScrollTimer=this.scene.time.addEvent({delay:16,callback:this.performAutoScroll,callbackScope:this,loop:!0}):!m&&this.autoScrollTimer&&this.stopAutoScroll()}performAutoScroll(){if(!this.dragging||this.dragging.type!=="move"){this.stopAutoScroll();return}const e=this.scene.cameras.main,t=e.width,i=this.currentZones.find(w=>w.id===this.dragging?.zoneId);if(!i)return;let s=0;if(this.currentScreenX<wt){if(i.x<=0){this.stopAutoScroll();return}const m=(wt-this.currentScreenX)/wt;s=-Or*m}else if(this.currentScreenX>t-wt){if(i.x+i.width>=this.worldWidth){this.stopAutoScroll();return}const m=(this.currentScreenX-(t-wt))/wt;s=Or*m}if(s===0)return;const r=e.scrollX+s,a=0,o=Math.max(0,this.worldWidth-e.width/e.zoom),d=Math.max(a,Math.min(o,r))-e.scrollX;if(o<=0){this.stopAutoScroll();return}if(d===0){this.stopAutoScroll();return}const u=i.x+d,h=Math.max(0,Math.min(this.worldWidth-i.width,u)),f=h-i.x;if(f===0){this.stopAutoScroll();return}const p=e.scrollX+f,g=Math.max(0,Math.min(o,p));if(Math.abs(g-e.scrollX)>Math.abs(f)*2){this.stopAutoScroll();return}e.scrollX=g,this.wouldOverlap(i.id,h,i.width)||(wn(i.id,{x:h}),this.dragging.originalX+=f,this.dragging.startX+=f)}stopAutoScroll(){this.autoScrollTimer&&(this.autoScrollTimer.destroy(),this.autoScrollTimer=null)}updateDrag(e){if(!this.dragging)return;const t=e-this.dragging.startX,i=this.currentZones.find(r=>r.id===this.dragging?.zoneId);if(!i)return;const s=this.getZoneBounds(i.id);if(this.dragging.type==="left"){let r=this.dragging.originalX+t,a=this.dragging.originalWidth-t;if(r<0&&(a+=r,r=0),a<zt&&(r=this.dragging.originalX+this.dragging.originalWidth-zt,a=zt),r<s.minX){const o=s.minX-r;r=s.minX,a-=o}a>=zt&&!this.wouldOverlap(i.id,r,a)&&wn(i.id,{x:r,width:a})}else if(this.dragging.type==="right"){let r=this.dragging.originalWidth+t;r<zt&&(r=zt),i.x+r>this.worldWidth&&(r=this.worldWidth-i.x),i.x+r>s.maxRight&&(r=s.maxRight-i.x),r>=zt&&!this.wouldOverlap(i.id,i.x,r)&&wn(i.id,{width:r})}else if(this.dragging.type==="move"){let r=this.dragging.originalX+t;const a=i.width;if(r<0&&(r=0),r+a>this.worldWidth&&(r=this.worldWidth-a),!this.wouldOverlap(i.id,r,a))wn(i.id,{x:r});else{const o=this.findNonOverlappingPosition(i.id,r,a);o!==null&&wn(i.id,{x:o})}}}findNonOverlappingPosition(e,t,i){const s=this.currentZones.filter(u=>u.id!==e).sort((u,h)=>u.x-h.x);if(s.length===0)return Math.max(0,Math.min(t,this.worldWidth-i));let r=t,a=1/0;const o=s[0];if(o.x>=i){const u=o.x-i,h=Math.max(0,Math.min(t,u)),f=Math.abs(h-t);f<a&&(a=f,r=h)}for(let u=0;u<s.length-1;u++){const h=s[u],f=s[u+1],p=h.x+h.width,g=f.x;if(g-p>=i){const w=p,m=g-i,_=Math.max(w,Math.min(t,m)),S=Math.abs(_-t);S<a&&(a=S,r=_)}}const l=s[s.length-1],d=l.x+l.width;if(this.worldWidth-d>=i){const u=d,h=this.worldWidth-i,f=Math.max(u,Math.min(t,h)),p=Math.abs(f-t);p<a&&(a=p,r=f)}return a<1/0&&!this.wouldOverlap(e,r,i)?r:null}handlePointerUp(e){if(this.dragging&&(this.stopAutoScroll(),this.scene.data.set("isDraggingItem",!1),kn(!1),this.dragging=null),this.pendingZoneSelection){let s=Date.now()-this.pendingZoneSelection.startTime<this.TAP_MAX_DURATION;s&&e&&e.worldX!==void 0&&(s=Math.abs(e.worldX-this.pendingZoneSelection.worldX)<this.TAP_MAX_DISTANCE),s&&jn(this.pendingZoneSelection.zoneId),this.pendingZoneSelection=null}if(this.pendingTap&&this.currentEditMode==="dialogs"){if(Date.now()-this.pendingTap.startTime<this.TAP_MAX_DURATION){let s=!0;e&&e.worldX!==void 0&&(s=Math.abs(e.worldX-this.pendingTap.worldX)<this.TAP_MAX_DISTANCE),s&&this.showTempAddButton(this.pendingTap.worldX,this.pendingTap.worldY)}this.pendingTap=null}}handlePointerDown(e){if(gn()||this.currentEditMode!=="dialogs"||this.dragging)return;const t=e.downElement;if(t&&t.tagName?.toUpperCase()!=="CANVAS")return;const i=e.worldX;for(const o of this.currentZones)if(i>=o.x&&i<=o.x+o.width)return;const s=Date.now(),r=s-this.lastClickTime,a=Math.abs(i-this.lastClickX);if(r<this.DOUBLE_CLICK_THRESHOLD&&a<this.DOUBLE_CLICK_DISTANCE){this.createZoneAtPosition(i),this.lastClickTime=0,this.hideTempAddButton();return}this.lastClickTime=s,this.lastClickX=i,this.pendingTap={worldX:i,worldY:e.worldY,startTime:s},this.currentSelectedId&&jn(null)}showTempAddButton(e,t){const i=this.scene.cameras.main,{screenX:s,screenY:r}=sn(e,t,i);Ue.emit(Re.TEMP_ZONE_BUTTON_SHOW,{screenX:s,screenY:r,worldX:e})}hideTempAddButton(){Ue.emit(Re.TEMP_ZONE_BUTTON_HIDE,{})}createZoneAtPosition(e){this.createZoneAt(e)}createNewZone(){const e=this.scene.cameras.main,t=e.worldView.x+e.worldView.width/2;this.createZoneAt(t)}createZoneAt(e){let t=e-Pr/2;const i=Pr;if(t=Math.max(0,Math.min(this.worldWidth-i,t)),this.wouldOverlap("",t,i)){const r=this.findNonOverlappingPosition("",t,i);if(r===null){console.warn("No room for a new dialog zone");return}t=r}const s=zl(t,i);s.x=t,zc(s),jn(s.id)}updateSelectionVisuals(){if(this.currentEditMode!=="dialogs"){bi(null);return}if(!this.currentSelectedId){bi(null);return}const e=this.currentZones.find(a=>a.id===this.currentSelectedId);if(!e){bi(null);return}const t=this.scene.cameras.main,i=e.x+e.width/2,{screenX:s}=sn(i,0,t),r=t.height*.65;bi({screenX:s,screenY:r})}destroy(){this.hideTempAddButton();for(const e of this.unsubscribers)e();this.unsubscribers=[],this.createZoneSubscription&&this.createZoneSubscription.unsubscribe(),this.createZoneAtSubscription&&this.createZoneAtSubscription.unsubscribe(),this.stopAutoScroll(),this.scene.input.off("pointerdown",this.handlePointerDown,this),this.scene.input.off("pointermove",this.handlePointerMove,this),this.scene.input.off("pointerup",this.handlePointerUp,this),window.removeEventListener("pointerup",this.boundWindowPointerUp),window.removeEventListener("pointermove",this.boundWindowPointerMove),this.clearVisuals(),this.graphics&&(this.graphics.destroy(),this.graphics=null),this.dragging=null}}class Fd extends Y.Scene{parallaxLayers=null;cameraController;playerController;gridOverlay;itemsController;framesController;socialsController;dialogZoneRenderer;config;minimapSubscription;isShuttingDown=!1;get itemManager(){return this.itemsController?.getManager()}resetZoom(){this.cameraController?.resetToFit()}constructor(){super({key:vt.BUILDER})}init(e){this.config=e.config}preload(){Wa(this),Ri.preloadAssets(this),kr.preloadAssets(this),Dr.preloadAssets(this)}create(){this.isShuttingDown=!1,this.initializeScene()}async initializeScene(){await za(this),Ga(this),this.physics.world.setBounds(0,0,this.config.worldWidth,this.config.worldHeight);const e=this.config.worldHeight-On;this.cameraController=new kd(this,this.config.worldWidth,this.config.worldHeight),this.playerController=new Pd(this,this.config.worldWidth,this.config.worldHeight),this.gridOverlay=new Ad(this,this.config.worldWidth,this.config.worldHeight),this.itemsController=new $d(this,e,this.config.worldWidth,this.config.worldHeight),this.framesController=new kr(this,this.config.worldWidth,this.config.worldHeight),this.socialsController=new Dr(this,this.config.worldWidth,this.config.worldHeight),this.dialogZoneRenderer=new Rd(this,this.config.worldWidth,this.config.worldHeight),this.createBackground(),this.gridOverlay.create(),this.createGroundReference(),this.playerController.create(this.config.playerStartX,this.config.playerStartY),this.itemsController.create(this.config.placedItems||[]),this.framesController.create(this.config.placedFrames||[]),this.socialsController.create(this.config.placedSocials||[]),this.dialogZoneRenderer.create(),this.cameraController.setup(),this.cameraController.centerOn(this.config.playerStartX,this.config.playerStartY),this.minimapSubscription=Ue.on(Re.MINIMAP_NAVIGATE,t=>{this.navigateToPosition(t.worldX,t.worldY)}),this.scale.on("resize",this.handleResize,this),this.events.on("shutdown",this.shutdown,this)}async createBackground(){const e=oi.getCurrentConfig();try{await Ka(this,e)}catch(t){console.error("Failed to load background:",t);return}this.parallaxLayers&&(vc(this.parallaxLayers),this.parallaxLayers=null),this.parallaxLayers=Ua(this,this.config.worldWidth,this.config.worldHeight,e)}createGroundReference(){hi.createVisualGround(this,{worldWidth:this.config.worldWidth,worldHeight:this.config.worldHeight,height:On})}update(){this.parallaxLayers&&Va(this.parallaxLayers,this.cameras.main),this.itemManager?.updateSelectionVisuals(),this.framesController?.updateSelectionVisuals(),this.socialsController?.updateSelectionVisuals(),this.dialogZoneRenderer?.updateSelectionVisuals();const e=this.cameras.main,t=this.data.get("playerSprite");Wc({scrollX:e.worldView.x,scrollY:e.worldView.y,viewWidth:e.width,viewHeight:e.height,worldWidth:this.config.worldWidth,worldHeight:this.config.worldHeight,zoom:e.zoom,playerX:t?.x??this.config.playerStartX,playerY:t?.y??this.config.playerStartY})}navigateToPosition(e,t){this.cameraController.centerOn(e,t)}handleResize(e){!this.cameras?.main||!this.config||(this.cameraController?.handleResize(),this.gridOverlay&&this.gridOverlay.redraw())}shutdown(){this.isShuttingDown||(this.isShuttingDown=!0,this.scale.off("resize",this.handleResize,this),this.minimapSubscription&&this.minimapSubscription.unsubscribe(),this.cameraController&&this.cameraController.destroy(),this.playerController&&this.playerController.destroy(),this.gridOverlay&&this.gridOverlay.destroy(),this.itemsController&&this.itemsController.destroy(),this.framesController&&this.framesController.destroy(),this.socialsController&&this.socialsController.destroy(),this.dialogZoneRenderer&&this.dialogZoneRenderer.destroy())}}const Hd="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Hd);Zo();class Xd{currentLanguage="cs";setLanguage(e){this.currentLanguage=e,localStorage.setItem("language",e)}getLanguage(){const e=localStorage.getItem("language");return(e==="cs"||e==="en")&&(this.currentLanguage=e),this.currentLanguage}toggleLanguage(){return this.currentLanguage=this.currentLanguage==="cs"?"en":"cs",this.setLanguage(this.currentLanguage),this.currentLanguage}}const _o=new Xd;let pt=null;function Bd(n){pt=n}function Nd(){if(!pt)return console.error("Scene manager not initialized"),null;try{return pt.scene.getScene(vt.GAME)?.mapConfig||null}catch(n){return console.error("Failed to get map config:",n),null}}function Zd(n){if(!pt)return console.error("Scene manager not initialized"),!1;try{return pt.scene.getScene(vt.GAME)?(pt.scene.stop(vt.GAME),Nc(n),pt.scene.start(vt.BUILDER,{config:n}),!0):(console.error("GameScene not found"),!1)}catch(e){return console.error("Failed to switch to builder:",e),!1}}function Yd(){if(console.log("[SceneManager] switchToGame called"),!pt)return console.error("Scene manager not initialized"),!1;try{return console.log("[SceneManager] Stopping builder scene..."),pt.scene.stop(vt.BUILDER),console.log("[SceneManager] Exiting builder mode..."),Zc(),console.log("[SceneManager] Starting game scene..."),pt.scene.start(vt.GAME,{useBuilderConfig:!0}),console.log("[SceneManager] switchToGame completed successfully"),!0}catch(n){return console.error("Failed to switch to game:",n),!1}}function Wd(){if(!pt){console.error("Scene manager not initialized");return}try{pt.scene.start(vt.GAME)}catch(n){console.error("Failed to start game scene:",n)}}var zd=F('<button class="close-btn svelte-yrmttr" title="Close">Ã</button>'),Gd=F('<div class="resize-handle resize-handle-nw svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M9 9L1 1M5 1L1 1L1 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" fill="none"></path></svg></div>  <div class="resize-handle resize-handle-ne svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M1 9L9 1M5 1L9 1L9 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" fill="none"></path></svg></div>  <div class="resize-handle resize-handle-sw svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M9 1L1 9M1 5L1 9L5 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" fill="none"></path></svg></div>  <div class="resize-handle resize-handle-se svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M1 1L9 9M9 5L9 9L5 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" fill="none"></path></svg></div>',1),Kd=F("<div><!></div> <!>",1),Ud=F('<div data-ui=""><div class="panel-header svelte-yrmttr"><span class="panel-title svelte-yrmttr"> </span> <!> <div class="header-buttons svelte-yrmttr"><button class="minimize-btn svelte-yrmttr"> </button> <!></div></div> <!></div>');function Bn(n,e){we(e,!0);const t=()=>L(Jt,"$isDraggingInBuilder",i),[i,s]=Xe();let r=1e3,a=he(e,"initialRight",3,10),o=he(e,"initialTop",3,60),l=he(e,"width",3,280),d=he(e,"minWidth",3,200),u=he(e,"minHeight",3,100),h=he(e,"maxWidth",3,600),f=he(e,"maxHeight",3,800),p=he(e,"resizable",3,!1),g=he(e,"startMinimized",3,!1),v=he(e,"showClose",3,!1),w=K(et(g())),m=K(!1),_=K(et({x:0,y:0})),S=K(et({width:l(),height:e.height??0})),b=K(!1),y=K(!1),E=K("se"),x=K(et({x:0,y:0})),I=K(null),k=K(!1),T=K(et(r)),D=K(null),M=K("");function O(){r++,$(T,r,!0)}function G(R,N,se){let Le=R;const Qe=window.innerWidth-se-10;Le>Qe&&(Le=Math.max(10,Qe)),Le<10&&(Le=10);let Ze=N;const bt=window.innerHeight-40;return Ze>bt&&(Ze=Math.max(10,bt)),Ze<10&&(Ze=10),{x:Le,y:Ze}}Fe(()=>{if(typeof window>"u"||c(k))return;const R=localStorage.getItem(`panel-state-${e.panelId}`);if(R)try{const N=JSON.parse(R),se=p()&&N.width?N.width:l(),pe=G(N.x,N.y,se);$(_,pe,!0),p()&&N.width&&N.height&&$(S,{width:N.width,height:N.height},!0);const be=p()?{x:pe.x,y:pe.y,width:c(S).width,height:c(S).height}:{x:pe.x,y:pe.y};$(M,JSON.stringify(be),!0)}catch{$(_,{x:window.innerWidth-l()-a(),y:o()},!0)}else $(_,{x:window.innerWidth-l()-a(),y:o()},!0);$(k,!0)}),Fe(()=>{if(!c(k))return;const R=p()?{x:c(_).x,y:c(_).y,width:c(S).width,height:c(S).height}:{x:c(_).x,y:c(_).y},N=JSON.stringify(R);N!==c(M)&&($(M,N,!0),localStorage.setItem(`panel-state-${e.panelId}`,N))}),Fe(()=>{if(!c(k))return;function R(){if(!c(I))return;const N=p()?c(S).width:l();let se=c(_).x,pe=c(_).y,be=!1;const Le=window.innerWidth-N;c(_).x>Le&&(se=Math.max(10,Le),be=!0);const Qe=window.innerHeight-40;c(_).y>Qe&&(pe=Math.max(10,Qe),be=!0),c(_).x<0&&(se=10,be=!0),c(_).y<0&&(pe=10,be=!0),be&&$(_,{x:se,y:pe},!0)}return window.addEventListener("resize",R),()=>{window.removeEventListener("resize",R)}});function Z(){$(w,!c(w))}function H(){e.onclose?.()}function J(){if(p())if(c(m))c(D)&&($(_,{x:c(D).x,y:c(D).y},!0),$(S,{width:c(D).width,height:c(D).height},!0),$(D,null)),$(m,!1);else{$(D,{x:c(_).x,y:c(_).y,width:c(S).width,height:c(S).height},!0);const R=20,N=Math.min(h(),window.innerWidth-R*2),se=Math.min(f(),window.innerHeight-R*2),pe=Math.max(R,(window.innerWidth-N)/2),be=Math.max(R,(window.innerHeight-se)/2);$(_,{x:pe,y:be},!0),$(S,{width:N,height:se},!0),$(m,!0)}}function te(R){R.target.closest("button")||J()}function Pe(R){R.target.closest("button")||($(b,!0),$(x,{x:R.clientX-c(_).x,y:R.clientY-c(_).y},!0),R.currentTarget.setPointerCapture(R.pointerId),R.preventDefault())}function xe(R){if(!c(b))return;const N=R.clientX-c(x).x,se=R.clientY-c(x).y,pe=window.innerWidth-(c(I)?.offsetWidth??l()),be=window.innerHeight-40;$(_,{x:Math.max(0,Math.min(N,pe)),y:Math.max(0,Math.min(se,be))},!0)}function Ae(R){c(b)&&($(b,!1),R.currentTarget.releasePointerCapture(R.pointerId))}function Me(R){return N=>{p()&&($(y,!0),$(E,R,!0),N.currentTarget.setPointerCapture(N.pointerId),N.preventDefault(),N.stopPropagation())}}function X(R){if(!c(y)||!c(I))return;const N=c(I).getBoundingClientRect();let se,pe,be=c(_).x,Le=c(_).y;const Qe=c(E)==="se"||c(E)==="ne",Ze=c(E)==="se"||c(E)==="sw";Qe?se=R.clientX-N.left:(se=N.right-R.clientX,be=R.clientX),Ze?pe=R.clientY-N.top:(pe=N.bottom-R.clientY,Le=R.clientY);const bt=Math.max(d(),Math.min(h(),se)),j=Math.max(u(),Math.min(f(),pe));Qe||(be=N.right-bt,be<0&&(be=0)),Ze||(Le=N.bottom-j,Le<0&&(Le=0));const Ie=Qe?window.innerWidth-c(_).x-10:N.right-10,ce=Ze?window.innerHeight-c(_).y-10:N.bottom-10,Oe=Math.min(bt,Ie),me=Math.min(j,ce);$(S,{width:Oe,height:me},!0);let Ye=!1,qe=c(_).x,mn=c(_).y;!Qe&&se>=d()&&(qe=Math.max(0,be),Ye=!0),!Ze&&pe>=u()&&(mn=Math.max(0,Le),Ye=!0),Ye&&$(_,{x:qe,y:mn},!0)}function Q(R){c(y)&&($(y,!1),R.currentTarget.releasePointerCapture(R.pointerId))}function ke(R){R.stopPropagation()}var re=Ud();let $e;re.__pointerdown=R=>{O(),ke(R)},re.__click=ke;var ye=A(re);ye.__pointerdown=Pe,ye.__pointermove=xe,ye.__pointerup=Ae,ye.__dblclick=te;var le=A(ye),fe=A(le),ne=P(le,2);{var ge=R=>{var N=He(),se=de(N);$n(se,()=>e.headerExtra),C(R,N)};U(ne,R=>{e.headerExtra&&R(ge)})}var Ee=P(ne,2),Ne=A(Ee);Ne.__click=Z;var ct=A(Ne),rt=P(Ne,2);{var Qt=R=>{var N=zd();N.__click=H,C(R,N)};U(rt,R=>{v()&&R(Qt)})}var Nn=P(ye,2);{var Yt=R=>{var N=Kd(),se=de(N);let pe;var be=A(se);$n(be,()=>e.children);var Le=P(se,2);{var Qe=Ze=>{var bt=Gd(),j=de(bt),Ie=B(()=>Me("nw"));j.__pointerdown=function(...en){c(Ie)?.apply(this,en)},j.__pointermove=X,j.__pointerup=Q;var ce=P(j,2),Oe=B(()=>Me("ne"));ce.__pointerdown=function(...en){c(Oe)?.apply(this,en)},ce.__pointermove=X,ce.__pointerup=Q;var me=P(ce,2),Ye=B(()=>Me("sw"));me.__pointerdown=function(...en){c(Ye)?.apply(this,en)},me.__pointermove=X,me.__pointerup=Q;var qe=P(me,2),mn=B(()=>Me("se"));qe.__pointerdown=function(...en){c(mn)?.apply(this,en)},qe.__pointermove=X,qe.__pointerup=Q,ft("pointercancel",j,Q),ft("pointercancel",ce,Q),ft("pointercancel",me,Q),ft("pointercancel",qe,Q),C(Ze,bt)};U(Le,Ze=>{p()&&Ze(Qe)})}W(()=>pe=De(se,1,"panel-body svelte-yrmttr",null,pe,{"has-fixed-height":p()&&c(S).height>0})),C(R,N)};U(Nn,R=>{c(w)||R(Yt)})}qt(re,R=>$(I,R),()=>c(I)),W(()=>{$e=De(re,1,"draggable-panel svelte-yrmttr",null,$e,{minimized:c(w),maximized:c(m),dragging:c(b),resizing:c(y),resizable:p()}),ue(re,`left: ${c(_).x??""}px; top: ${c(_).y??""}px; width: ${c(w)?"auto":`${p()?c(S).width:l()}px`}; ${p()&&c(S).height>0&&!c(w)?`height: ${c(S).height}px;`:""}${t()?" pointer-events: none;":""} z-index: ${c(T)??""};`),Te(fe,e.title),V(Ne,"title",c(w)?"Expand":"Minimize"),Te(ct,c(w)?"â²":"â¼")}),ft("pointercancel",ye,Ae),C(n,re),Se(),s()}yt(["pointerdown","click","pointermove","pointerup","dblclick"]);const Rr=10,Vd=150,jd=`
  position: fixed;
  pointer-events: none;
  z-index: 10000;
  opacity: 0.9;
  image-rendering: pixelated;
  filter: drop-shadow(3px 3px 0 rgba(0, 0, 0, 0.5));
  background: rgba(26, 26, 46, 0.9);
`,qd=`
  width: 100%;
  height: 100%;
  object-fit: contain;
  image-rendering: pixelated;
`;function Us(n,e,t){const{previewSize:i,borderColor:s,dataKey:r,eventName:a,onDrop:o}=n,l=i/2,d={startX:0,startY:0,hasMoved:!1,isActivated:!1,pendingKey:null,pendingTarget:null,longPressTimer:null};function u(T,D,M){Ue.emit(a,{[r]:T,canvasX:D,canvasY:M}),o?.()}function h(T,D){const M=document.querySelector("canvas");if(!M)return null;const O=M.getBoundingClientRect();return T>=O.left&&T<=O.right&&D>=O.top&&D<=O.bottom?{canvasX:T-O.left,canvasY:D-O.top}:null}function f(T,D,M){const O=document.createElement("div");return O.className="touch-drag-preview",O.innerHTML=`<img src="${T}" alt="" />`,O.style.cssText=`
      ${jd}
      top: ${M-l}px;
      left: ${D-l}px;
      width: ${i}px;
      height: ${i}px;
      border: 2px solid ${s};
    `,O.querySelector("img").style.cssText=qd,document.body.appendChild(O),O}function p(T,D,M){T.style.top=`${M-l}px`,T.style.left=`${D-l}px`}function g(){d.longPressTimer&&(clearTimeout(d.longPressTimer),d.longPressTimer=null),d.pendingKey=null,d.pendingTarget=null,d.isActivated=!1,d.hasMoved=!1}function v(){g();const T=e();T.touchDragElement&&(T.touchDragElement.remove(),t({touchDragElement:null})),t({draggedKey:null}),yi(!1)}function w(T,D){if(!T.dataTransfer)return;t({draggedKey:D}),yi(!0),T.dataTransfer.effectAllowed="copy",T.dataTransfer.setData(r,D);const O=T.target.querySelector("img")?.cloneNode(!0);O&&(O.style.cssText="position: absolute; top: -1000px;",document.body.appendChild(O),T.dataTransfer.setDragImage(O,l,l),requestAnimationFrame(()=>O.remove()))}function m(){t({draggedKey:null}),yi(!1)}function _(T){T.preventDefault(),T.dataTransfer&&(T.dataTransfer.dropEffect="copy")}function S(T){T.preventDefault();const D=T.dataTransfer?.getData(r);if(!D)return;const M=h(T.clientX,T.clientY);M&&u(D,M.canvasX,M.canvasY)}function b(T,D){if(!d.pendingKey||!d.pendingTarget||d.isActivated)return;d.isActivated=!0,t({draggedKey:d.pendingKey}),yi(!0);const M=d.pendingTarget.querySelector("img");if(M){const O=f(M.src,T,D);t({touchDragElement:O})}}function y(T,D){if(T.touches.length!==1)return;const M=T.touches[0];d.startX=M.clientX,d.startY=M.clientY,d.hasMoved=!1,d.isActivated=!1,d.pendingKey=D,d.pendingTarget=T.currentTarget,d.longPressTimer=setTimeout(()=>{d.pendingKey&&!d.hasMoved&&b(M.clientX,M.clientY)},Vd)}function E(T){const D=T.touches[0],M=D.clientX-d.startX,O=D.clientY-d.startY;if(!d.hasMoved&&(Math.abs(M)>Rr||Math.abs(O)>Rr)&&(d.hasMoved=!0,!d.isActivated)){if(Math.abs(O)>Math.abs(M)){g();return}b(D.clientX,D.clientY)}const G=e();d.isActivated&&G.touchDragElement&&(p(G.touchDragElement,D.clientX,D.clientY),T.preventDefault())}function x(T){const D=e(),M=d.isActivated,O=D.draggedKey;if(M&&O&&d.hasMoved){const G=T.changedTouches[0],Z=h(G.clientX,G.clientY);Z&&u(O,Z.canvasX,Z.canvasY)}v()}function I(){const T=document.querySelector("canvas");return T?(T.addEventListener("dragover",_),T.addEventListener("drop",S),()=>{T.removeEventListener("dragover",_),T.removeEventListener("drop",S)}):()=>{}}function k(){return document.addEventListener("touchmove",E,{passive:!1}),document.addEventListener("touchend",x),document.addEventListener("touchcancel",x),()=>{document.removeEventListener("touchmove",E),document.removeEventListener("touchend",x),document.removeEventListener("touchcancel",x)}}return{onDragStart:w,onDragEnd:m,onTouchStart:y,setupCanvasListeners:I,setupTouchListeners:k}}var Jd=F('<span class="palette-hint svelte-ntcafk">Drag to place</span>'),Qd=F('<div data-ui="" draggable="true" role="button" tabindex="0"><img class="item-preview svelte-ntcafk"/></div>'),eu=F('<div class="palette-content svelte-ntcafk" role="toolbar" tabindex="-1"><div class="palette-grid svelte-ntcafk"></div></div>');function tu(n,e){we(e,!0);const t=()=>L(cn,"$isItemPaletteOpen",s),i=()=>L(je,"$builderEditMode",s),[s,r]=Xe(),a="#4a90e2",o=600,l=Gs;function d(){return window.innerWidth<o}function u(){d()&&cn.set(!1)}let h=K(null),f=K(null);const p=Us({previewSize:48,borderColor:a,dataKey:"assetKey",eventName:Re.ASSET_DROPPED,onDrop:u},()=>({draggedKey:c(h),touchDragElement:c(f)}),b=>{"draggedKey"in b&&$(h,b.draggedKey??null,!0),"touchDragElement"in b&&$(f,b.touchDragElement??null,!0)});function g(b){b.stopPropagation()}function v(){cn.set(!1)}function w(b){const y=document.querySelector("canvas");if(!y)return;const E=y.getBoundingClientRect(),x=E.width/2,I=E.height/2;Ue.emit(Re.ASSET_DROPPED,{assetKey:b,canvasX:x,canvasY:I}),u()}vi(()=>p.setupCanvasListeners()),Fe(()=>p.setupTouchListeners());var m=He(),_=de(m);{var S=b=>{Bn(b,{panelId:"item-palette",title:"Items",initialRight:10,initialTop:60,width:280,height:400,minWidth:200,minHeight:160,maxWidth:500,maxHeight:600,resizable:!0,showClose:!0,onclose:v,headerExtra:E=>{var x=Jd();C(E,x)},children:(E,x)=>{var I=eu();I.__pointerdown=g;var k=A(I);tt(k,21,()=>l,ot,(T,D)=>{var M=Qd();let O;M.__touchstart=Z=>p.onTouchStart(Z,c(D).key),M.__dblclick=()=>w(c(D).key),ue(M,"",{},{"--accent-color":a});var G=A(M);W(()=>{O=De(M,1,"palette-item svelte-ntcafk",null,O,{dragging:c(h)===c(D).key}),V(M,"title",`${c(D).name??""} (double-click to place)`),V(G,"src",c(D).path),V(G,"alt",c(D).name)}),ft("dragstart",M,Z=>p.onDragStart(Z,c(D).key)),ft("dragend",M,function(...Z){p.onDragEnd?.apply(this,Z)}),C(T,M)}),C(E,I)},$$slots:{headerExtra:!0,default:!0}})};U(_,b=>{t()&&i()==="items"&&b(S)})}C(n,m),Se(),r()}yt(["pointerdown","touchstart","dblclick"]);var nu=F('<span class="palette-hint svelte-jnw59q">Drag to place</span>'),iu=F('<div data-ui="" draggable="true" role="button" tabindex="0"><img class="item-preview svelte-jnw59q"/></div>'),su=F('<div class="palette-content svelte-jnw59q" role="toolbar" tabindex="-1"><div class="palette-grid svelte-jnw59q"></div></div>');function ru(n,e){we(e,!0);const t=()=>L(rn,"$isFramePaletteOpen",s),i=()=>L(je,"$builderEditMode",s),[s,r]=Xe(),a="#9b59b6",o=Fi;let l=K(null),d=K(null);const u=Us({previewSize:64,borderColor:a,dataKey:"frameKey",eventName:Re.FRAME_DROPPED,onDrop:()=>{rn.set(!1)}},()=>({draggedKey:c(l),touchDragElement:c(d)}),m=>{"draggedKey"in m&&$(l,m.draggedKey??null,!0),"touchDragElement"in m&&$(d,m.touchDragElement??null,!0)});function h(m){m.stopPropagation()}function f(){rn.set(!1)}function p(m){const _=document.querySelector("canvas");if(!_)return;const S=_.getBoundingClientRect(),b=S.width/2,y=S.height/2;Ue.emit(Re.FRAME_DROPPED,{frameKey:m,canvasX:b,canvasY:y}),rn.set(!1)}vi(()=>u.setupCanvasListeners()),Fe(()=>u.setupTouchListeners());var g=He(),v=de(g);{var w=m=>{Bn(m,{panelId:"frame-palette",title:"Frames",initialRight:10,initialTop:60,width:320,height:400,minWidth:220,minHeight:200,maxWidth:600,maxHeight:600,resizable:!0,showClose:!0,onclose:f,headerExtra:S=>{var b=nu();C(S,b)},children:(S,b)=>{var y=su();y.__pointerdown=h;var E=A(y);tt(E,21,()=>o,ot,(x,I)=>{var k=iu();let T;k.__touchstart=M=>u.onTouchStart(M,c(I).key),k.__dblclick=()=>p(c(I).key),ue(k,"",{},{"--accent-color":a});var D=A(k);W(()=>{T=De(k,1,"palette-item svelte-jnw59q",null,T,{dragging:c(l)===c(I).key}),V(k,"title",`${c(I).name??""} (double-click to place)`),V(D,"src",c(I).path),V(D,"alt",c(I).name)}),ft("dragstart",k,M=>u.onDragStart(M,c(I).key)),ft("dragend",k,function(...M){u.onDragEnd?.apply(this,M)}),C(x,k)}),C(S,y)},$$slots:{headerExtra:!0,default:!0}})};U(v,m=>{t()&&i()==="frames"&&m(w)})}C(n,g),Se(),r()}yt(["pointerdown","touchstart","dblclick"]);var au=F('<span class="palette-hint svelte-whpd9j">Drag to place</span>'),ou=F('<div data-ui="" draggable="true" role="button" tabindex="0"><img class="item-preview svelte-whpd9j"/> <span class="item-name svelte-whpd9j"> </span></div>'),lu=F('<div class="palette-content svelte-whpd9j" role="toolbar" tabindex="-1"><div class="palette-grid svelte-whpd9j"></div></div>');function cu(n,e){we(e,!0);const t=()=>L(an,"$isSocialPaletteOpen",s),i=()=>L(je,"$builderEditMode",s),[s,r]=Xe(),a=Xn.SOCIAL.css,o=Hi;let l=K(null),d=K(null);const u=Us({previewSize:64,borderColor:a,dataKey:"socialKey",eventName:Re.SOCIAL_DROPPED,onDrop:()=>{an.set(!1)}},()=>({draggedKey:c(l),touchDragElement:c(d)}),m=>{"draggedKey"in m&&$(l,m.draggedKey??null,!0),"touchDragElement"in m&&$(d,m.touchDragElement??null,!0)});function h(m){m.stopPropagation()}function f(){an.set(!1)}function p(m){const _=document.querySelector("canvas");if(!_)return;const S=_.getBoundingClientRect(),b=S.width/2,y=S.height/2;Ue.emit(Re.SOCIAL_DROPPED,{socialKey:m,canvasX:b,canvasY:y}),an.set(!1)}vi(()=>u.setupCanvasListeners()),Fe(()=>u.setupTouchListeners());var g=He(),v=de(g);{var w=m=>{Bn(m,{panelId:"social-palette",title:"Socials",initialRight:10,initialTop:60,width:280,height:350,minWidth:200,minHeight:200,maxWidth:500,maxHeight:500,resizable:!0,showClose:!0,onclose:f,headerExtra:S=>{var b=au();C(S,b)},children:(S,b)=>{var y=lu();y.__pointerdown=h;var E=A(y);tt(E,21,()=>o,ot,(x,I)=>{var k=ou();let T;k.__touchstart=Z=>u.onTouchStart(Z,c(I).key),k.__dblclick=()=>p(c(I).key);let D;var M=A(k),O=P(M,2),G=A(O);W(()=>{T=De(k,1,"palette-item svelte-whpd9j",null,T,{dragging:c(l)===c(I).key}),V(k,"title",`${c(I).name??""} (double-click to place)`),D=ue(k,"",D,{"--accent-color":a}),V(M,"src",c(I).path),V(M,"alt",c(I).name),Te(G,c(I).name)}),ft("dragstart",k,Z=>u.onDragStart(Z,c(I).key)),ft("dragend",k,function(...Z){u.onDragEnd?.apply(this,Z)}),C(x,k)}),C(S,y)},$$slots:{headerExtra:!0,default:!0}})};U(v,m=>{t()&&i()==="socials"&&m(w)})}C(n,g),Se(),r()}yt(["pointerdown","touchstart","dblclick"]);var du=F("<button><!></button>");function oe(n,e){let t=he(e,"variant",3,"default"),i=he(e,"disabled",3,!1),s=he(e,"title",3,"");const r={default:{base:"#4a90e2",hover:"#357abd",active:"#2a5f8f"},green:{base:"#27ae60",hover:"#229954",active:"#1e8449"},blue:{base:"#3498db",hover:"#2980b9",active:"#21618c"},orange:{base:"#ffa500",hover:"#ff8c00",active:"#e67e00"},red:{base:"#e74c3c",hover:"#c0392b",active:"#a02e22"},purple:{base:"#9b59b6",hover:"#8e44ad",active:"#7d3c98"},cyan:{base:"#17a2b8",hover:"#138496",active:"#0f6674"},pink:{base:"#e91e8f",hover:"#c9177a",active:"#a31265"}},a=B(()=>r[t()]),o=B(()=>e.width?`--btn-width: ${e.width};`:"");var l=du();let d;l.__click=function(...h){e.onclick?.apply(this,h)};var u=A(l);$n(u,()=>e.children??mt),W(()=>{d=De(l,1,"pixel-btn svelte-lwc0vq",null,d,{disabled:i()}),ue(l,`${c(o)??""} --color-base: ${c(a).base??""}; --color-hover: ${c(a).hover??""}; --color-active: ${c(a).active??""}`),l.disabled=i(),V(l,"title",s())}),C(n,l)}yt(["click"]);var uu=F("<button> </button>"),hu=F('<div class="language-tabs svelte-ng6pis"></div>');function yo(n,e){we(e,!0);let t=he(e,"accentColor",3,"#88ddff");var i=hu();tt(i,21,()=>_c,ot,(s,r)=>{var a=uu();let o;a.__click=()=>e.onselect(c(r).code);let l;var d=A(a);W(()=>{o=De(a,1,"lang-tab svelte-ng6pis",null,o,{active:e.selectedLanguage===c(r).code}),l=ue(a,"",l,{"--accent-color":t()}),Te(d,c(r).label)}),C(s,a)}),C(n,i),Se()}yt(["click"]);var fu=F("<button></button>"),gu=F('<div class="color-picker svelte-1jc3e0j"></div>'),pu=F('<div class="color-section svelte-1jc3e0j"><span class="color-label-title svelte-1jc3e0j"> </span> <button class="color-button svelte-1jc3e0j" title="Change color"><span class="color-preview svelte-1jc3e0j"></span> <span class="color-label svelte-1jc3e0j">Change</span></button> <!></div>');function Ss(n,e){we(e,!0);let t=he(e,"label",3,"Color"),i=he(e,"accentColor",3,"#88ddff"),s=K(!1),r=K(null);Fe(()=>{c(s)&&c(r)&&requestAnimationFrame(()=>{c(r)?.scrollIntoView({behavior:"smooth",block:"nearest"})})});function a(m){e.onselect(m)}function o(){$(s,!c(s))}var l=pu(),d=A(l),u=A(d),h=P(d,2);h.__click=o;let f;var p=A(h);let g;var v=P(h,2);{var w=m=>{var _=gu();tt(_,21,()=>e.colors,ot,(S,b)=>{var y=fu();let E;y.__click=()=>a(c(b));let x;W(()=>{E=De(y,1,"color-swatch svelte-1jc3e0j",null,E,{selected:e.selectedColor===c(b)}),V(y,"title",c(b)),x=ue(y,"",x,{background:c(b),"--accent-color":i()})}),C(S,y)}),qt(_,S=>$(r,S),()=>c(r)),C(m,_)};U(v,m=>{c(s)&&m(w)})}W(()=>{Te(u,t()),f=ue(h,"",f,{"--accent-color":i()}),g=ue(p,"",g,{background:e.selectedColor})}),C(n,l),Se()}yt(["click"]);const Fr=50,Hr=400,mu=400,vu=70;var _u=F('<div class="form-section svelte-jhtkop"><div class="form-group svelte-jhtkop"><label class="svelte-jhtkop"> </label> <input type="text" class="svelte-jhtkop"/></div> <div class="form-group svelte-jhtkop"><label class="svelte-jhtkop"> </label> <textarea rows="6" class="svelte-jhtkop"></textarea></div></div>');function yu(n,e){we(e,!0);let t=he(e,"titlePlaceholder",3,"Enter title..."),i=he(e,"contentPlaceholder",3,"Enter text..."),s=he(e,"idPrefix",3,"text-form"),r=he(e,"accentColor",3,"#88ddff");function a(_){const S=_.target;e.ontitlechange(S.value)}function o(_){const S=_.target;e.oncontentchange(S.value)}var l=_u();let d;var u=A(l),h=A(u),f=A(h),p=P(h,2);p.__input=a;var g=P(u,2),v=A(g),w=A(v),m=P(v,2);m.__input=o,W(()=>{d=ue(l,"",d,{"--accent-color":r()}),V(h,"for",`${s()??""}-title`),Te(f,`Title (max ${Fr} chars)`),V(p,"id",`${s()??""}-title`),si(p,e.title),V(p,"placeholder",t()),V(p,"maxlength",Fr),V(v,"for",`${s()??""}-content`),Te(w,`Content (max ${Hr} chars)`),V(m,"id",`${s()??""}-content`),si(m,e.content),V(m,"placeholder",i()),V(m,"maxlength",Hr)}),C(n,l),Se()}yt(["input"]);var bu=F('<div class="panel-content svelte-zzlycq"><!> <!> <div class="panel-extras svelte-zzlycq"><!></div> <div class="panel-footer svelte-zzlycq"><!> <!></div></div>');function wu(n,e){we(e,!0);const t=()=>L(Fs,"$dialogZones",r),i=()=>L(Ui,"$selectedDialogZoneId",r),s=()=>L(Xs,"$isDialogZonePanelOpen",r),[r,a]=Xe(),o="#88ddff";let l=K(et(ja)),d=B(()=>t().find(b=>b.id===i())??null),u=B(()=>c(d)?.texts.find(b=>b.language===c(l))??null);function h(b){i()&&yr(i(),c(l),{title:b})}function f(b){i()&&yr(i(),c(l),{content:b})}function p(){i()&&(co(i()),vr())}function g(){vr()}function v(b){i()&&wn(i(),{color:b})}function w(b){$(l,b,!0)}var m=He(),_=de(m);{var S=b=>{Bn(b,{panelId:"dialog-zone-panel",title:"Dialog Zone",initialRight:10,initialTop:160,width:280,height:450,minWidth:250,minHeight:370,maxWidth:500,maxHeight:700,resizable:!0,showClose:!0,onclose:g,children:(y,E)=>{var x=bu(),I=A(x);yo(I,{get selectedLanguage(){return c(l)},onselect:w,accentColor:o});var k=P(I,2);{let Z=B(()=>c(u)?.title??""),H=B(()=>c(u)?.content??"");yu(k,{get title(){return c(Z)},get content(){return c(H)},ontitlechange:h,oncontentchange:f,titlePlaceholder:"Enter title...",contentPlaceholder:"Enter dialog text...",idPrefix:"dialog",accentColor:o})}var T=P(k,2),D=A(T);Ss(D,{get colors(){return _s},get selectedColor(){return c(d).color},onselect:v,label:"Zone Color",accentColor:o});var M=P(T,2),O=A(M);oe(O,{variant:"cyan",onclick:g,children:(Z,H)=>{var J=ae("CONFIRM");C(Z,J)},$$slots:{default:!0}});var G=P(O,2);oe(G,{variant:"red",onclick:p,children:(Z,H)=>{var J=ae("DELETE");C(Z,J)},$$slots:{default:!0}}),C(y,x)},$$slots:{default:!0}})};U(_,b=>{c(d)&&s()&&b(S)})}C(n,m),Se(),a()}var Su=F("<button> </button>"),xu=F("<option> </option>"),Eu=F("<button> </button>"),Iu=F('<a target="_blank" rel="noopener noreferrer" class="url-preview svelte-ds1z4d">Test link â</a>'),Cu=F('<button><img class="svelte-ds1z4d"/></button>'),Tu=F('<div class="style-picker svelte-ds1z4d"></div>'),ku=F('<div class="panel-content svelte-ds1z4d"><!> <div class="frame-size-row svelte-ds1z4d"><div class="frame-size-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Frame Size</span> <div class="size-buttons svelte-ds1z4d"></div></div> <div class="rotate-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Rotate</span> <button class="rotate-btn svelte-ds1z4d"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-ds1z4d"><path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg></button></div></div> <div class="panel-extras svelte-ds1z4d"><div class="text-section svelte-ds1z4d"><label for="frame-text" class="svelte-ds1z4d">Text</label> <textarea id="frame-text" placeholder="Enter text..." rows="3" class="svelte-ds1z4d"></textarea></div> <div class="size-rotation-row svelte-ds1z4d"><div class="size-section svelte-ds1z4d"><label for="text-size" class="svelte-ds1z4d">Text Size</label> <select id="text-size" class="svelte-ds1z4d"></select></div></div> <div class="text-align-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Text Alignment</span> <div class="align-buttons svelte-ds1z4d"></div></div> <div class="url-section svelte-ds1z4d"><label for="frame-url" class="svelte-ds1z4d">Link URL (opens on click)</label> <input id="frame-url" type="url" placeholder="https://example.com" class="svelte-ds1z4d"/> <!></div> <!> <!> <div class="style-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Frame Style</span> <button class="style-button svelte-ds1z4d" title="Change frame style"><img alt="Current frame" class="style-preview svelte-ds1z4d"/> <span class="style-label svelte-ds1z4d">Change Style</span></button> <!></div></div> <div class="panel-footer svelte-ds1z4d"><!> <!></div></div>');function Du(n,e){we(e,!0);const t=()=>L(Rs,"$builderPreviewLanguage",a),i=()=>L(Mc,"$selectedFrame",a),s=()=>L(li,"$selectedFrameId",a),r=()=>L(zi,"$isFramePanelOpen",a),[a,o]=Xe(),l="#9b59b6";let d=B(t),u=B(i),h=B(()=>c(u)?.texts.find(H=>H.language===c(d))??null),f=B(()=>c(u)?vd(c(u).scale??4):"M");function p(H){const J=H.target;if(!s()||!c(u))return;const te=c(u).texts.map(Pe=>Pe.language===c(d)?{...Pe,text:J.value}:Pe);te.some(Pe=>Pe.language===c(d))||te.push({language:c(d),text:J.value}),xt(s(),{texts:te})}function g(H){const J=H.target;s()&&xt(s(),{url:J.value||void 0})}function v(H){s()&&xt(s(),{backgroundColor:H})}function w(H){s()&&xt(s(),{textColor:H})}function m(H){const J=H.target;s()&&xt(s(),{textSize:parseInt(J.value,10)})}function _(H){s()&&xt(s(),{scale:md(H)})}function S(H){s()&&xt(s(),{textAlign:H})}function b(){if(!s()||!c(u))return;const J=(c(u).rotation??0)===0?90:0;xt(s(),{rotation:J})}function y(){s()&&Ws(s())}function E(){Ec(),qn(null)}function x(H){Tc(H)}let I=K(!1),k=K(null),T=K(null);function D(H){s()&&xt(s(),{frameKey:H})}function M(){$(I,!c(I))}Fe(()=>{c(I)&&c(k)&&requestAnimationFrame(()=>{c(k)?.scrollIntoView({behavior:"smooth",block:"nearest"})})}),Fe(()=>{if(!c(I))return;function H(J){const te=J.target;c(k)&&!c(k).contains(te)&&c(T)&&!c(T).contains(te)&&$(I,!1)}return document.addEventListener("click",H),()=>document.removeEventListener("click",H)});var O=He(),G=de(O);{var Z=H=>{Bn(H,{panelId:"frame-panel",title:"Edit Frame",initialRight:10,initialTop:160,width:280,height:520,minWidth:250,minHeight:450,maxWidth:500,maxHeight:700,resizable:!0,showClose:!0,onclose:E,children:(J,te)=>{var Pe=ku(),xe=A(Pe);yo(xe,{get selectedLanguage(){return c(d)},onselect:x,accentColor:l});var Ae=P(xe,2),Me=A(Ae),X=P(A(Me),2);tt(X,21,()=>Object.entries(po),ot,(j,Ie)=>{var ce=B(()=>Wr(c(Ie),2));let Oe=()=>c(ce)[0],me=()=>c(ce)[1].label;var Ye=Su();let qe;Ye.__click=()=>_(Oe());var mn=A(Ye);W(()=>{qe=De(Ye,1,"size-btn svelte-ds1z4d",null,qe,{active:c(f)===Oe()}),V(Ye,"title",me()),Te(mn,Oe())}),C(j,Ye)});var Q=P(Me,2),ke=P(A(Q),2);ke.__click=b;var re=P(Ae,2),$e=A(re),ye=P(A($e),2);ye.__input=p;var le=P($e,2),fe=A(le),ne=P(A(fe),2);ne.__change=m,tt(ne,21,()=>gd,ot,(j,Ie)=>{var ce=xu(),Oe=A(ce),me={};W(()=>{Te(Oe,`${c(Ie)??""}px`),me!==(me=c(Ie))&&(ce.value=(ce.__value=c(Ie))??"")}),C(j,ce)});var ge;Ol(ne);var Ee=P(le,2),Ne=P(A(Ee),2);tt(Ne,21,()=>pd,ot,(j,Ie)=>{let ce=()=>c(Ie).value,Oe=()=>c(Ie).label;var me=Eu();let Ye;me.__click=()=>S(ce());var qe=A(me);W(()=>{Ye=De(me,1,"align-btn svelte-ds1z4d",null,Ye,{active:(c(u).textAlign??vo)===ce()}),V(me,"title",Oe()),Te(qe,Oe())}),C(j,me)});var ct=P(Ee,2),rt=P(A(ct),2);rt.__input=g;var Qt=P(rt,2);{var Nn=j=>{var Ie=Iu();W(()=>V(Ie,"href",c(u).url)),C(j,Ie)};U(Qt,j=>{c(u).url&&j(Nn)})}var Yt=P(ct,2);{let j=B(()=>c(u).textColor??mo);Ss(Yt,{get colors(){return fd},get selectedColor(){return c(j)},onselect:w,label:"Text Color",accentColor:l})}var R=P(Yt,2);Ss(R,{get colors(){return hd},get selectedColor(){return c(u).backgroundColor},onselect:v,label:"Background Color",accentColor:l});var N=P(R,2),se=P(A(N),2);se.__click=M;var pe=A(se);qt(se,j=>$(T,j),()=>c(T));var be=P(se,2);{var Le=j=>{var Ie=Tu();tt(Ie,21,()=>Fi,ot,(ce,Oe)=>{var me=Cu();let Ye;me.__click=()=>D(c(Oe).key);var qe=A(me);W(()=>{Ye=De(me,1,"style-item svelte-ds1z4d",null,Ye,{selected:c(u).frameKey===c(Oe).key}),V(me,"title",c(Oe).name),V(qe,"src",c(Oe).path),V(qe,"alt",c(Oe).name)}),C(ce,me)}),qt(Ie,ce=>$(k,ce),()=>c(k)),C(j,Ie)};U(be,j=>{c(I)&&j(Le)})}var Qe=P(re,2),Ze=A(Qe);oe(Ze,{variant:"purple",onclick:E,children:(j,Ie)=>{var ce=ae("CONFIRM");C(j,ce)},$$slots:{default:!0}});var bt=P(Ze,2);oe(bt,{variant:"red",onclick:y,children:(j,Ie)=>{var ce=ae("DELETE");C(j,ce)},$$slots:{default:!0}}),W(j=>{V(ke,"title",c(u).rotation===90?"Portrait (click to rotate)":"Landscape (click to rotate)"),si(ye,c(h)?.text??""),ge!==(ge=c(u).textSize??Ei)&&(ne.value=(ne.__value=c(u).textSize??Ei)??"",ka(ne,c(u).textSize??Ei)),si(rt,c(u).url??""),V(pe,"src",j)},[()=>Fi.find(j=>j.key===c(u).frameKey)?.path??""]),C(J,Pe)},$$slots:{default:!0}})};U(G,H=>{r()&&c(u)&&H(Z)})}C(n,O),Se(),o()}yt(["click","input","change"]);var Pu=F("<button> </button>"),Au=F('<a target="_blank" rel="noopener noreferrer" class="url-preview svelte-1v3ae2c">Test link â</a>'),Mu=F('<button><img class="svelte-1v3ae2c"/></button>'),$u=F('<div class="style-picker svelte-1v3ae2c"></div>'),Lu=F('<div class="panel-content svelte-1v3ae2c"><div class="social-size-row svelte-1v3ae2c"><div class="social-size-section svelte-1v3ae2c"><span class="section-label svelte-1v3ae2c">Size</span> <div class="size-buttons svelte-1v3ae2c"></div></div></div> <div class="panel-extras svelte-1v3ae2c"><div class="url-section svelte-1v3ae2c"><label for="social-url" class="svelte-1v3ae2c">Link URL (opens on click)</label> <input id="social-url" type="url" placeholder="https://example.com" class="svelte-1v3ae2c"/> <!></div> <div class="style-section svelte-1v3ae2c"><span class="section-label svelte-1v3ae2c">Social Icon</span> <button class="style-button svelte-1v3ae2c" title="Change social icon"><img alt="Current social" class="style-preview svelte-1v3ae2c"/> <span class="style-label svelte-1v3ae2c"> </span></button> <!></div></div> <div class="panel-footer svelte-1v3ae2c"><!> <!></div></div>');function Ou(n,e){we(e,!0);const t=()=>L(Dc,"$selectedSocial",r),i=()=>L(ci,"$selectedSocialId",r),s=()=>L(Gi,"$isSocialPanelOpen",r),[r,a]=Xe(),o=Xn.SOCIAL.css;let l=B(t),d=B(()=>c(l)?Id(c(l).scale??Dn):"M"),u=B(()=>c(l)?Hi.find(x=>x.key===c(l).socialKey):null);function h(x){const I=x.target;i()&&xi(i(),{url:I.value||void 0})}function f(x){i()&&xi(i(),{scale:Ed(x)})}function p(){i()&&zs(i())}function g(){Cc(),Jn(null)}let v=K(!1),w=K(null),m=K(null);function _(x){i()&&xi(i(),{socialKey:x})}function S(){$(v,!c(v))}Fe(()=>{c(v)&&c(w)&&requestAnimationFrame(()=>{c(w)?.scrollIntoView({behavior:"smooth",block:"nearest"})})}),Fe(()=>{if(!c(v))return;function x(I){const k=I.target;c(w)&&!c(w).contains(k)&&c(m)&&!c(m).contains(k)&&$(v,!1)}return document.addEventListener("click",x),()=>document.removeEventListener("click",x)});var b=He(),y=de(b);{var E=x=>{Bn(x,{panelId:"social-panel",title:"Edit Social",initialRight:10,initialTop:160,width:280,height:350,minWidth:250,minHeight:300,maxWidth:400,maxHeight:500,resizable:!0,showClose:!0,onclose:g,children:(I,k)=>{var T=Lu(),D=A(T),M=A(D),O=P(A(M),2);tt(O,21,()=>Object.entries(ui),ot,(le,fe)=>{var ne=B(()=>Wr(c(fe),2));let ge=()=>c(ne)[0],Ee=()=>c(ne)[1].label;var Ne=Pu();let ct;Ne.__click=()=>f(ge());var rt=A(Ne);W(()=>{ct=De(Ne,1,"size-btn svelte-1v3ae2c",null,ct,{active:c(d)===ge()}),V(Ne,"title",Ee()),Te(rt,ge())}),C(le,Ne)});var G=P(D,2),Z=A(G),H=P(A(Z),2);H.__input=h;var J=P(H,2);{var te=le=>{var fe=Au();W(()=>V(fe,"href",c(l).url)),C(le,fe)};U(J,le=>{c(l).url&&le(te)})}var Pe=P(Z,2),xe=P(A(Pe),2);xe.__click=S;var Ae=A(xe),Me=P(Ae,2),X=A(Me);qt(xe,le=>$(m,le),()=>c(m));var Q=P(xe,2);{var ke=le=>{var fe=$u();tt(fe,21,()=>Hi,ot,(ne,ge)=>{var Ee=Mu();let Ne;Ee.__click=()=>_(c(ge).key);var ct=A(Ee);W(()=>{Ne=De(Ee,1,"style-item svelte-1v3ae2c",null,Ne,{selected:c(l).socialKey===c(ge).key}),V(Ee,"title",c(ge).name),V(ct,"src",c(ge).path),V(ct,"alt",c(ge).name)}),C(ne,Ee)}),qt(fe,ne=>$(w,ne),()=>c(w)),C(le,fe)};U(Q,le=>{c(v)&&le(ke)})}var re=P(G,2),$e=A(re);oe($e,{variant:"pink",onclick:g,children:(le,fe)=>{var ne=ae("CONFIRM");C(le,ne)},$$slots:{default:!0}});var ye=P($e,2);oe(ye,{variant:"red",onclick:p,children:(le,fe)=>{var ne=ae("DELETE");C(le,ne)},$$slots:{default:!0}}),W(()=>{ue(T,`--accent-color: ${o}`),si(H,c(l).url??""),V(Ae,"src",c(u)?.path??""),Te(X,c(u)?.name??"Select")}),C(I,T)},$$slots:{default:!0}})};U(y,x=>{s()&&c(l)&&x(E)})}C(n,b),Se(),a()}yt(["click","input"]);var Ru=F("<div> </div>"),Fu=F('<div class="frame-content-layer svelte-1vp2oo0"></div>');function bo(n,e){we(e,!0);const t=()=>L(to,"$placedFrames",d),i=()=>L(qa,"$isBuilderMode",d),s=()=>L(Ys,"$builderCameraInfo",d),r=()=>L(Fa,"$gameCameraInfo",d),a=()=>L(Rs,"$builderPreviewLanguage",d),o=()=>L(ri,"$currentLanguage",d),l=()=>L(Hs,"$draggingFramePositions",d),[d,u]=Xe();let h=B(t),f=B(()=>i()?s().scrollX:r().scrollX),p=B(()=>i()?s().scrollY:r().scrollY),g=B(()=>i()?s().zoom:r().zoom),v=B(()=>i()?a():o()),w=B(l);function m(y){const E=c(w).get(y.id);return E||{x:y.x,y:y.y}}function _(y){const E=y.scale??Xt,x=y.rotation===90,{textWidth:I,textHeight:k}=Qn(E,x),T=m(y),D=(T.x-c(f))*c(g),M=(T.y-c(p))*c(g);return{x:D,y:M,width:I*c(g),height:k*c(g)}}function S(y){return(y.texts.find(x=>x.language===c(v))||y.texts[0]||{text:""}).text||""}var b=Fu();tt(b,21,()=>c(h),y=>y.id,(y,E)=>{const x=B(()=>_(c(E))),I=B(()=>S(c(E))),k=B(()=>(c(E).textSize??Ei)*c(g)),T=B(()=>c(E).textColor??mo),D=B(()=>c(E).textAlign??vo);var M=He(),O=de(M);{var G=Z=>{var H=Ru();let J;var te=A(H);W(()=>{J=De(H,1,"frame-text svelte-1vp2oo0",null,J,{"align-top":c(D)==="top","align-center":c(D)==="center","align-bottom":c(D)==="bottom"}),ue(H,`
          left: ${c(x).x??""}px;
          top: ${c(x).y??""}px;
          width: ${c(x).width??""}px;
          height: ${c(x).height??""}px;
          font-size: ${c(k)??""}px;
          color: ${c(T)??""};
        `),Te(te,c(I))}),C(Z,H)};U(O,Z=>{c(I)&&Z(G)})}C(y,M)}),C(n,b),Se(),u()}var Hu=F('<div class="temp-zone-button svelte-130i47e"><!></div>');function Xu(n,e){we(e,!0);const t=()=>L(Ys,"$builderCameraInfo",r),i=()=>L(je,"$builderEditMode",r),s=()=>L(Jt,"$isDraggingInBuilder",r),[r,a]=Xe();let o=K(null),l=null,d=null,u=K(null);function h(m){l&&clearTimeout(l),$(o,m,!0),$(u,t()?.scrollX??null,!0),l=setTimeout(()=>{$(o,null),$(u,null)},2e3)}function f(){c(o)&&(Ue.emit(Re.DIALOG_ZONE_CREATE_AT,{worldX:c(o).worldX}),$(o,null),$(u,null),l&&(clearTimeout(l),l=null))}function p(){$(o,null),$(u,null),l&&(clearTimeout(l),l=null)}vi(()=>{d=Ue.on(Re.TEMP_ZONE_BUTTON_SHOW,h);const m=Ue.on(Re.TEMP_ZONE_BUTTON_HIDE,p);return()=>{d?.unsubscribe(),m.unsubscribe()}}),Bl(()=>{l&&clearTimeout(l)}),Fe(()=>{i()!=="dialogs"&&($(o,null),$(u,null))}),Fe(()=>{const m=t()?.scrollX;c(o)&&c(u)!==null&&m!==void 0&&Math.abs(m-c(u))>10&&($(o,null),$(u,null),l&&(clearTimeout(l),l=null))});var g=He(),v=de(g);{var w=m=>{var _=Hu(),S=A(_);oe(S,{variant:"cyan",width:"90px",onclick:f,children:(b,y)=>{var E=ae("+ ZONE");C(b,E)},$$slots:{default:!0}}),W(()=>ue(_,`left: ${c(o).screenX??""}px; top: ${c(o).screenY-50}px;${s()?" pointer-events: none;":""}`)),C(m,_)};U(v,m=>{c(o)&&i()==="dialogs"&&m(w)})}C(n,g),Se(),a()}var Bu=F('<div class="item-controls svelte-1is3rex"><div class="controls-row svelte-1is3rex"><!> <!> <!> <!></div></div>');function Nu(n,e){we(e,!0);const t=()=>L(Bs,"$selectedItem",u),i=()=>L(io,"$selectedItemScreenPosition",u),s=()=>L(Ki,"$selectedItemId",u),r=()=>L(eo,"$itemDepthLayer",u),a=()=>L($c,"$selectedItemPhysicsEnabled",u),o=()=>L(Lc,"$selectedItemFlipX",u),l=()=>L(je,"$builderEditMode",u),d=()=>L(Jt,"$isDraggingInBuilder",u),[u,h]=Xe();let f=B(()=>t()?Vc(t().assetKey):!1),p=B(()=>{const y=i();if(!y)return null;const E=10,x=40,I=c(f)?380:290;let k=y.screenY-y.itemHeight/2-45;const T=E+x;k<T&&(k=y.screenY+y.itemHeight/2+10);const D=window.innerHeight-x-E;k>D&&(k=D);let M=y.screenX;const O=I/2,G=O+E,Z=window.innerWidth-O-E;return M<G&&(M=G),M>Z&&(M=Z),{x:M,y:k}});function g(){if(!s())return;const y=r()==="behind"?"front":"behind",E=Os(y);Fc(),Hc(s(),E)}function v(){s()&&Xc(s(),!a())}function w(){s()&&Bc(s(),!o())}function m(){s()&&(oo(s()),Ns())}var _=He(),S=de(_);{var b=y=>{var E=Bu(),x=A(E),I=A(x);{let O=B(()=>r()==="behind"?"blue":"orange"),G=B(()=>a()?"Solid items must be behind player":"Toggle item depth: behind or in front of player");oe(I,{get variant(){return c(O)},get title(){return c(G)},onclick:g,get disabled(){return a()},children:(Z,H)=>{var J=ae();W(()=>Te(J,r()==="behind"?"Front":"Back")),C(Z,J)},$$slots:{default:!0}})}var k=P(I,2);{let O=B(()=>o()?"orange":"blue");oe(k,{get variant(){return c(O)},title:"Flip item horizontally",onclick:w,children:(G,Z)=>{var H=ae("Flip");C(G,H)},$$slots:{default:!0}})}var T=P(k,2);{var D=O=>{{let G=B(()=>a()?"orange":"blue");oe(O,{get variant(){return c(G)},title:"Toggle physics: item will block player movement",onclick:v,children:(Z,H)=>{var J=ae();W(()=>Te(J,a()?"Ghost":"Solid")),C(Z,J)},$$slots:{default:!0}})}};U(T,O=>{c(f)&&O(D)})}var M=P(T,2);oe(M,{variant:"red",title:"Delete selected item",onclick:m,children:(O,G)=>{var Z=ae("DEL");C(O,Z)},$$slots:{default:!0}}),W(()=>ue(E,`left: ${c(p).x??""}px; top: ${c(p).y??""}px;${d()?" pointer-events: none;":""}`)),C(y,E)};U(S,y=>{l()!=="dialogs"&&s()&&c(p)&&y(b)})}C(n,_),Se(),h()}var Zu=F('<div class="frame-controls svelte-eqt3a9"><div class="controls-row svelte-eqt3a9"><!> <!></div></div>');function Yu(n,e){we(e,!0);const t=()=>L(so,"$selectedFrameScreenPosition",a),i=()=>L(li,"$selectedFrameId",a),s=()=>L(je,"$builderEditMode",a),r=()=>L(Jt,"$isDraggingInBuilder",a),[a,o]=Xe();let l=B(()=>{const g=t();if(!g)return null;const v=10,w=40,m=190;let _=g.screenY-g.frameHeight/2-45;const S=v+w;_<S&&(_=g.screenY+g.frameHeight/2+10);const b=window.innerHeight-w-v;_>b&&(_=b);let y=g.screenX;const E=m/2,x=E+v,I=window.innerWidth-E-v;return y<x&&(y=x),y>I&&(y=I),{x:y,y:_}});function d(){Ja()}function u(){i()&&(Ws(i()),qn(null))}var h=He(),f=de(h);{var p=g=>{var v=Zu(),w=A(v),m=A(w);oe(m,{variant:"purple",title:"Edit frame content (or double-click)",onclick:d,children:(S,b)=>{var y=ae("EDIT");C(S,y)},$$slots:{default:!0}});var _=P(m,2);oe(_,{variant:"red",title:"Delete selected frame",onclick:u,children:(S,b)=>{var y=ae("DEL");C(S,y)},$$slots:{default:!0}}),W(()=>ue(v,`left: ${c(l).x??""}px; top: ${c(l).y??""}px;${r()?" pointer-events: none;":""}`)),C(g,v)};U(f,g=>{s()!=="dialogs"&&i()&&c(l)&&g(p)})}C(n,h),Se(),o()}var Wu=F('<div class="zone-controls svelte-sm01rq"><div class="controls-row svelte-sm01rq"><!> <!> <!></div></div>');function zu(n,e){we(e,!0);const t=()=>L(ro,"$selectedDialogZoneScreenPosition",a),i=()=>L(Ui,"$selectedDialogZoneId",a),s=()=>L(je,"$builderEditMode",a),r=()=>L(Jt,"$isDraggingInBuilder",a),[a,o]=Xe();let l=B(()=>{const v=t();if(!v)return null;const w=10,m=120,_=85;let S=v.screenY;const b=w+m/2,y=window.innerHeight-m/2-w;S<b&&(S=b),S>y&&(S=y);let E=v.screenX;const x=_/2,I=x+w,k=window.innerWidth-x-w;return E<I&&(E=I),E>k&&(E=k),{x:E,y:S}});function d(){ao()}function u(){i()&&(co(i()),jn(null))}function h(){jn(null)}var f=He(),p=de(f);{var g=v=>{var w=Wu(),m=A(w),_=A(m);oe(_,{variant:"cyan",title:"Edit zone content (or double-click)",onclick:d,children:(y,E)=>{var x=ae("EDIT");C(y,x)},$$slots:{default:!0}});var S=P(_,2);oe(S,{variant:"red",title:"Delete selected zone",onclick:u,children:(y,E)=>{var x=ae("DEL");C(y,x)},$$slots:{default:!0}});var b=P(S,2);oe(b,{variant:"default",title:"Deselect zone",onclick:h,children:(y,E)=>{var x=ae("DONE");C(y,x)},$$slots:{default:!0}}),W(()=>ue(w,`left: ${c(l).x??""}px; top: ${c(l).y??""}px;${r()?" pointer-events: none;":""}`)),C(v,w)};U(p,v=>{s()==="dialogs"&&i()&&c(l)&&v(g)})}C(n,f),Se(),o()}var Gu=F('<div class="social-controls svelte-1v4dckp"><div class="controls-row svelte-1v4dckp"><!> <!></div></div>');function Ku(n,e){we(e,!0);const t=()=>L(no,"$selectedSocialScreenPosition",a),i=()=>L(ci,"$selectedSocialId",a),s=()=>L(je,"$builderEditMode",a),r=()=>L(Jt,"$isDraggingInBuilder",a),[a,o]=Xe();let l=B(()=>{const g=t();if(!g)return null;const v=10,w=40,m=190;let _=g.screenY-g.socialHeight/2-45;const S=v+w;_<S&&(_=g.screenY+g.socialHeight/2+10);const b=window.innerHeight-w-v;_>b&&(_=b);let y=g.screenX;const E=m/2,x=E+v,I=window.innerWidth-E-v;return y<x&&(y=x),y>I&&(y=I),{x:y,y:_}});function d(){Qa()}function u(){i()&&(zs(i()),Jn(null))}var h=He(),f=de(h);{var p=g=>{var v=Gu(),w=A(v),m=A(w);oe(m,{variant:"pink",title:"Edit social settings (or double-click)",onclick:d,children:(S,b)=>{var y=ae("EDIT");C(S,y)},$$slots:{default:!0}});var _=P(m,2);oe(_,{variant:"red",title:"Delete selected social",onclick:u,children:(S,b)=>{var y=ae("DEL");C(S,y)},$$slots:{default:!0}}),W(()=>ue(v,`left: ${c(l).x??""}px; top: ${c(l).y??""}px;${r()?" pointer-events: none;":""}`)),C(g,v)};U(f,g=>{s()!=="dialogs"&&i()&&c(l)&&g(p)})}C(n,h),Se(),o()}var Uu=F('<div class="hstack svelte-8vtf35"><!></div>');function Vu(n,e){let t=he(e,"gap",3,"10px"),i=he(e,"align",3,"center");var s=Uu(),r=A(s);$n(r,()=>e.children??mt),W(()=>ue(s,`gap: ${t()??""}; align-items: ${(i()==="start"?"flex-start":i()==="end"?"flex-end":i())??""};`)),C(n,s)}var ju=F('<div class="vstack svelte-1y4dqnf"><!></div>');function qu(n,e){let t=he(e,"gap",3,"10px"),i=he(e,"align",3,"stretch");var s=ju(),r=A(s);$n(r,()=>e.children??mt),W(()=>ue(s,`gap: ${t()??""}; align-items: ${(i()==="start"?"flex-start":i()==="end"?"flex-end":i())??""};`)),C(n,s)}var Ju=F("<div><!></div>");function Xr(n,e){const t=()=>L(Jt,"$isDraggingInBuilder",i),[i,s]=Xe();let r=he(e,"padding",3,"10px");var a=Ju();let o;var l=A(a);$n(l,()=>e.children??mt),W(()=>{o=De(a,1,`fixed fixed--${e.position??""}`,"svelte-vwlo0e",o,{"dragging-in-builder":t()}),ue(a,`--padding: ${r()??""};`)}),C(n,a),s()}var Qu=F("<div><!> <!></div>"),eh=F("<!> <!>",1),th=F("<!> <!> <!> <!>",1),nh=F("<div><!></div>"),ih=F("<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!>",1);function sh(n,e){we(e,!0);const t=()=>L(Ki,"$selectedItemId",h),i=()=>L(li,"$selectedFrameId",h),s=()=>L(Ui,"$selectedDialogZoneId",h),r=()=>L(ci,"$selectedSocialId",h),a=()=>L(je,"$builderEditMode",h),o=()=>L(Oi,"$gridSnappingEnabled",h),l=()=>L(cn,"$isItemPaletteOpen",h),d=()=>L(rn,"$isFramePaletteOpen",h),u=()=>L(an,"$isSocialPaletteOpen",h),[h,f]=Xe(),p=600;let g=K(et(typeof window<"u"?window.innerWidth<p:!1)),v=B(()=>c(g)&&(t()!==null||i()!==null||s()!==null||r()!==null));Fe(()=>{function te(){$(g,window.innerWidth<p)}return window.addEventListener("resize",te),()=>window.removeEventListener("resize",te)});function w(){console.log("[BuilderUI] handleSave called, switching to game...");const te=Yd();console.log("[BuilderUI] switchToGame result:",te)}function m(){wc()}function _(){Ue.emit(Re.DIALOG_ZONE_CREATE)}var S=ih(),b=de(S);Nu(b,{});var y=P(b,2);Yu(y,{});var E=P(y,2);zu(E,{});var x=P(E,2);Ku(x,{});var I=P(x,2);{var k=te=>{tu(te,{})},T=te=>{var Pe=He(),xe=de(Pe);{var Ae=X=>{wu(X,{})},Me=X=>{var Q=He(),ke=de(Q);{var re=ye=>{ru(ye,{})},$e=ye=>{var le=He(),fe=de(le);{var ne=ge=>{cu(ge,{})};U(fe,ge=>{a()==="socials"&&ge(ne)},!0)}C(ye,le)};U(ke,ye=>{a()==="frames"?ye(re):ye($e,!1)},!0)}C(X,Q)};U(xe,X=>{a()==="dialogs"?X(Ae):X(Me,!1)},!0)}C(te,Pe)};U(I,te=>{a()==="items"?te(k):te(T,!1)})}var D=P(I,2);Du(D,{});var M=P(D,2);Ou(M,{});var O=P(M,2);bo(O,{});var G=P(O,2);Xu(G,{});var Z=P(G,2),H=P(Z,2);Xr(H,{position:"top-left",children:(te,Pe)=>{var xe=Qu();let Ae;var Me=A(xe);oe(Me,{variant:"green",width:"100px",onclick:w,children:(Q,ke)=>{var re=ae("SAVE");C(Q,re)},$$slots:{default:!0}});var X=P(Me,2);{let Q=B(()=>o()?"blue":"orange");oe(X,{get variant(){return c(Q)},width:"80px",onclick:m,title:"Toggle grid snapping",children:(ke,re)=>{var $e=ae();W(()=>Te($e,o()?"FREE":"SNAP")),C(ke,$e)},$$slots:{default:!0}})}W(()=>Ae=De(xe,1,"left-buttons svelte-1vm8op7",null,Ae,{"hide-left":c(v)})),C(te,xe)},$$slots:{default:!0}});var J=P(H,2);Xr(J,{position:"top-right",children:(te,Pe)=>{var xe=nh();let Ae;var Me=A(xe);qu(Me,{align:"end",children:(X,Q)=>{var ke=th(),re=de(ke);{let fe=B(()=>a()==="items"&&l()?"orange":"blue");oe(re,{get variant(){return c(fe)},onclick:()=>{a()==="items"?Sc():(Wn("items"),cn.set(!0))},title:"Edit items",children:(ne,ge)=>{var Ee=ae("ITEMS");C(ne,Ee)},$$slots:{default:!0}})}var $e=P(re,2);{let fe=B(()=>a()==="frames"&&d()?"orange":"purple");oe($e,{get variant(){return c(fe)},onclick:()=>{a()==="frames"?xc():(Wn("frames"),rn.set(!0))},title:"Edit text frames",children:(ne,ge)=>{var Ee=ae("FRAMES");C(ne,Ee)},$$slots:{default:!0}})}var ye=P($e,2);{let fe=B(()=>a()==="socials"&&u()?"orange":"pink");oe(ye,{get variant(){return c(fe)},onclick:()=>{a()==="socials"?Ic():(Wn("socials"),an.set(!0))},title:"Edit social icons",children:(ne,ge)=>{var Ee=ae("SOCIALS");C(ne,Ee)},$$slots:{default:!0}})}var le=P(ye,2);Vu(le,{children:(fe,ne)=>{var ge=eh(),Ee=de(ge);{var Ne=rt=>{oe(rt,{variant:"cyan",width:"100px",onclick:_,title:"Create new dialog zone at center of view",children:(Qt,Nn)=>{var Yt=ae("+ ZONE");C(Qt,Yt)},$$slots:{default:!0}})};U(Ee,rt=>{a()==="dialogs"&&rt(Ne)})}var ct=P(Ee,2);{let rt=B(()=>a()==="dialogs"?"orange":"cyan");oe(ct,{get variant(){return c(rt)},onclick:()=>{a()==="dialogs"?Wn("items"):Wn("dialogs")},title:"Edit dialog zones",children:(Qt,Nn)=>{var Yt=ae("DIALOGS");C(Qt,Yt)},$$slots:{default:!0}})}C(fe,ge)},$$slots:{default:!0}}),C(X,ke)},$$slots:{default:!0}}),W(()=>Ae=De(xe,1,"right-buttons svelte-1vm8op7",null,Ae,{"hide-right":c(v)})),C(te,xe)},$$slots:{default:!0}}),C(n,S),Se(),f()}var rh=F('<button type="button"><div class="skin-preview-container svelte-crre06"><canvas width="96" height="96" class="skin-preview svelte-crre06"></canvas></div> <span class="skin-name svelte-crre06"> </span></button>'),ah=F('<button class="background-card svelte-crre06" type="button"><div class="preview-container svelte-crre06"><img class="preview-image svelte-crre06"/></div> <span class="background-name svelte-crre06"> </span></button>'),oh=F('<div class="background-select-screen svelte-crre06"><div class="content svelte-crre06"><h1 class="title svelte-crre06">SELECT CHARACTER</h1> <div class="skins-grid svelte-crre06"></div> <h1 class="title svelte-crre06">SELECT BACKGROUND</h1> <div class="backgrounds-grid svelte-crre06"></div></div></div>');function lh(n,e){we(e,!0);const t=St,i=Ft;let s=K(et(ei.getSkinId())),r=et({});Fe(()=>{i.every(m=>r[m.id])&&i.forEach(m=>{a(m)})});async function a(w){const m=r[w.id];if(!m)return;const _=m.getContext("2d");_&&(w.format==="gif"?await o(w,m,_):l(w,m,_))}async function o(w,m,_){try{const b=await(await fetch(`./assets/skins/${w.folder}/idle.gif`)).arrayBuffer(),y=$i.parseGIF(b),E=$i.decompressFrames(y,!0);if(E.length===0)return;const x=E[0],I=_.createImageData(x.dims.width,x.dims.height);I.data.set(x.patch);const k=document.createElement("canvas");k.width=y.lsd.width,k.height=y.lsd.height;const T=k.getContext("2d"),D=document.createElement("canvas");D.width=x.dims.width,D.height=x.dims.height,D.getContext("2d").putImageData(I,0,0),T.drawImage(D,x.dims.left,x.dims.top),_.clearRect(0,0,m.width,m.height),_.imageSmoothingEnabled=!1;const O=Math.floor((m.width-y.lsd.width*2)/2),G=Math.floor((m.height-y.lsd.height*2)/2);_.drawImage(k,O,G,y.lsd.width*2,y.lsd.height*2)}catch(S){console.error(`Failed to load GIF thumbnail for ${w.id}:`,S)}}function l(w,m,_){const S=new Image;S.src=`./assets/skins/${w.folder}/idle.png`,S.onload=()=>{_.clearRect(0,0,m.width,m.height),_.imageSmoothingEnabled=!1,_.drawImage(S,0,0,48,48,0,0,m.width,m.height)}}function d(w){return`./assets/backgrounds/${w}/preview.png`}function u(w){$(s,w,!0),ei.setSkin(w),Pa.set(w)}function h(w){oi.setBackgroundByIndex(w),Aa.set(t[w].name),Ma.set(!0),Wd()}var f=oh(),p=A(f),g=P(A(p),2);tt(g,21,()=>i,ot,(w,m)=>{var _=rh();let S;_.__click=()=>u(c(m).id);var b=A(_),y=A(b);qt(y,(I,k)=>r[k.id]=I,I=>r?.[I.id],()=>[c(m)]);var E=P(b,2),x=A(E);W(()=>{S=De(_,1,"skin-card svelte-crre06",null,S,{selected:c(s)===c(m).id}),Te(x,c(m).name)}),C(w,_)});var v=P(g,4);tt(v,21,()=>t,ot,(w,m,_)=>{var S=ah();S.__click=()=>h(_);var b=A(S),y=A(b),E=P(b,2),x=A(E);W(I=>{V(y,"src",I),V(y,"alt",c(m).name),Te(x,c(m).name)},[()=>d(c(m).folder)]),C(w,S)}),C(n,f),Se()}yt(["click"]);var ch=F("<div> </div>"),dh=F('<div class="dialog-content svelte-1jd14ss"> </div>'),uh=F("<div><!> <!></div>");function hh(n,e){we(e,!0);const t=()=>L(Vl,"$activeDialogText",s),i=()=>L(Ra,"$playerScreenPosition",s),[s,r]=Xe();let a=B(()=>t()?.title&&t()?.content),o=B(()=>Math.max(10,window.innerHeight-i().y+vu)),l=B(()=>window.innerWidth<=mu),d=B(()=>c(l)?50:i().x),u=B(()=>c(l)?"percent":"px");var h=He(),f=de(h);{var p=g=>{var v=uh();let w;var m=A(v);{var _=y=>{var E=ch();let x;var I=A(E);W(()=>{x=De(E,1,"dialog-title svelte-1jd14ss",null,x,{"has-divider":c(a)}),Te(I,t().title)}),C(y,E)};U(m,y=>{t().title&&y(_)})}var S=P(m,2);{var b=y=>{var E=dh(),x=A(E);W(()=>Te(x,t().content)),C(y,E)};U(S,y=>{t().content&&y(b)})}W(()=>{w=De(v,1,"dialog-bubble svelte-1jd14ss",null,w,{narrow:c(l)}),ue(v,`bottom: ${c(o)??""}px; left: ${c(d)??""}${c(u)??""};`)}),C(g,v)};U(f,g=>{t()&&g(p)})}C(n,h),Se(),r()}var fh=F('<div class="game-mask mask-top svelte-ptsgmd"></div> <div class="game-mask mask-bottom svelte-ptsgmd"></div> <div class="game-mask mask-left svelte-ptsgmd"></div> <div class="game-mask mask-right svelte-ptsgmd"></div> <div class="game-frame svelte-ptsgmd"><div class="frame-border frame-top svelte-ptsgmd"></div> <div class="frame-border frame-bottom svelte-ptsgmd"></div> <div class="frame-border frame-left svelte-ptsgmd"></div> <div class="frame-border frame-right svelte-ptsgmd"></div> <div class="frame-corner corner-top-left svelte-ptsgmd"></div> <div class="frame-corner corner-top-right svelte-ptsgmd"></div> <div class="frame-corner corner-bottom-left svelte-ptsgmd"></div> <div class="frame-corner corner-bottom-right svelte-ptsgmd"></div></div>',1);function gh(n,e){we(e,!1);const t=()=>L(Kl,"$gameFrameColor",s),i=()=>L(Ha,"$gameWorldDimensions",s),[s,r]=Xe(),a=Ct(),o=Ct(),l=Ct(),d=Ct(),u=Ct(),h=Ct(),f=Ct();Rt(()=>t(),()=>{$(a,t())}),Rt(()=>i(),()=>{$(o,i())}),Rt(()=>c(o),()=>{$(l,`
    top: ${c(o).offsetY}px;
    left: ${c(o).offsetX}px;
    width: ${c(o).worldWidth}px;
    height: ${c(o).worldHeight}px;
  `)}),Rt(()=>c(o),()=>{$(d,c(o).offsetY)}),Rt(()=>c(o),()=>{$(u,c(o).offsetX)}),Rt(()=>c(o),()=>{$(h,c(o).offsetX+c(o).worldWidth)}),Rt(()=>c(o),()=>{$(f,c(o).offsetY+c(o).worldHeight)}),ya();var p=fh(),g=de(p),v=P(g,2),w=P(v,2),m=P(w,2),_=P(m,2);W(()=>{ue(g,`height: ${c(d)??""}px; background: ${c(a)??""};`),ue(v,`top: ${c(f)??""}px; background: ${c(a)??""};`),ue(w,`top: ${c(d)??""}px; height: ${c(o),Pt(()=>c(o).worldHeight)??""}px; width: ${c(u)??""}px; background: ${c(a)??""};`),ue(m,`top: ${c(d)??""}px; height: ${c(o),Pt(()=>c(o).worldHeight)??""}px; left: ${c(h)??""}px; background: ${c(a)??""};`),ue(_,`--frame-thickness: 16px; --frame-color: ${c(a)??""}; ${c(l)??""}`)}),C(n,p),Se(),r()}var ph=F("<!> <!>",1),mh=F('<div class="touch-controls"><p class="touch-text">Tap and hold<br/>where you want<br/>to move</p></div>'),vh=F('<div class="desktop-controls"><div class="key-row"><div class="pixel-key">A</div> <div class="pixel-key">W</div> <div class="pixel-key">D</div></div> <p class="or-text">or</p> <div class="key-row"><div class="pixel-key">â</div> <div class="pixel-key">â</div> <div class="pixel-key">â</div></div></div>'),_h=F('<div class="loader-overlay"><div class="pixel-loader"></div></div>'),yh=F('<!> <div class="game-ui-wrapper svelte-13dvmla"><!> <!> <!> <dialog class="pixel-dialog"><h1>CONTROLS</h1> <div class="controls-content"><!></div></dialog> <!></div>',1);function bh(n,e){we(e,!1);const t=()=>L(Gn,"$showControlsDialog",u),i=()=>L(La,"$hasPlayerMoved",u),s=()=>L(Ma,"$hasSelectedBackground",u),r=()=>L(Ul,"$gameFrameVisible",u),a=()=>L(qa,"$isBuilderMode",u),o=()=>L(ri,"$currentLanguage",u),l=()=>L($a,"$isTouchDevice",u),d=()=>L(ys,"$isLoading",u),[u,h]=Xe();let f=Ct();function p(){const b=_o.toggleLanguage();ri.set(b)}function g(b){!c(f)?.open||b.target.closest(".pixel-button")||Gn.set(!1)}function v(){const b=Nd();if(!b){console.error("Cannot enter builder mode: map config not found");return}Zd(b)}Rt(()=>(c(f),t()),()=>{c(f)&&(t()?c(f).showModal():c(f).close())}),Rt(()=>(i(),c(f),Gn),()=>{i()&&c(f)?.open&&Gn.set(!1)}),ya(),Xl();var w=He();ft("pointerdown",qr,g);var m=de(w);{var _=b=>{lh(b,{})},S=b=>{var y=yh(),E=de(y);{var x=X=>{gh(X,{})};U(E,X=>{r()&&!a()&&X(x)})}var I=P(E,2),k=A(I);{var T=X=>{sh(X,{})},D=X=>{var Q=ph(),ke=de(Q);hh(ke,{});var re=P(ke,2);bo(re,{}),C(X,Q)};U(k,X=>{a()?X(T):X(D,!1)})}var M=P(k,2);{var O=X=>{oe(X,{position:"top-left",variant:"green",width:"120px",onclick:v,title:"Toggle Builder Mode",children:(Q,ke)=>{var re=ae("BUILD");C(Q,re)},$$slots:{default:!0}})};U(M,X=>{a()||X(O)})}var G=P(M,2);{var Z=X=>{oe(X,{position:"top-right",variant:"default",width:"100px",onclick:p,title:"Toggle Language (L)",children:(Q,ke)=>{var re=ae();W($e=>Te(re,$e),[()=>(o(),Pt(()=>o().toUpperCase()))]),C(Q,re)},$$slots:{default:!0}})};U(G,X=>{a()||X(Z)})}var H=P(G,2),J=P(A(H),2),te=A(J);{var Pe=X=>{var Q=mh();C(X,Q)},xe=X=>{var Q=vh();C(X,Q)};U(te,X=>{l()?X(Pe):X(xe,!1)})}qt(H,X=>$(f,X),()=>c(f));var Ae=P(H,2);{var Me=X=>{var Q=_h();C(X,Q)};U(Ae,X=>{d()&&X(Me)})}C(b,y)};U(m,b=>{s()?b(S,!1):b(_)})}C(n,w),Se(),h()}sc();const wo=document.getElementById("game-ui");if(!wo)throw new Error("game-ui element not found!");Pl(bh,{target:wo});ri.set(_o.getLanguage());Pa.set(ei.getSkinId());Aa.set(oi.getCurrentConfig().name);const wh={type:Y.AUTO,width:800,height:600,parent:"game-container",backgroundColor:"#000000",pixelArt:!0,roundPixels:!0,scale:{mode:Y.Scale.RESIZE,autoCenter:Y.Scale.CENTER_BOTH},input:{activePointers:3},physics:{default:"arcade",arcade:{gravity:{y:1e3,x:0},debug:!1}},audio:{noAudio:!0},scene:[]},ji=new Y.Game(wh);ji.scene.add(vt.GAME,Cd);ji.scene.add(vt.BUILDER,Fd);Bd(ji);const Sh=ji.device.input.touch;$a.set(Sh);const xh=performance.getEntriesByType("navigation")[0]&&performance.getEntriesByType("navigation")[0].type==="reload",Eh=sessionStorage.getItem("hasSeenControlsHint");(!Eh||xh)&&(sessionStorage.setItem("hasSeenControlsHint","true"),Gn.set(!0));
//# sourceMappingURL=index-BJAWgXru.js.map
