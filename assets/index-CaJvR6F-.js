import{r as fo,g as go}from"./phaser-DFK5Ua9d.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();var po=fo();const B=go(po),Di=!1;var Hi=Array.isArray,vo=Array.prototype.indexOf,Ni=Array.from,Ks=Object.defineProperty,Cn=Object.getOwnPropertyDescriptor,Us=Object.getOwnPropertyDescriptors,mo=Object.prototype,_o=Array.prototype,Xi=Object.getPrototypeOf,ls=Object.isExtensible;const Ve=()=>{};function yo(t){return t()}function Vn(t){for(var e=0;e<t.length;e++)t[e]()}function js(){var t,e,n=new Promise((i,s)=>{t=i,e=s});return{promise:n,resolve:t,reject:e}}function bo(t,e){if(Array.isArray(t))return t;if(!(Symbol.iterator in t))return Array.from(t);const n=[];for(const i of t)if(n.push(i),n.length===e)break;return n}const me=2,Bi=4,ci=8,wo=1<<24,St=16,Et=32,jt=64,di=128,Qe=512,pe=1024,Fe=2048,dt=4096,Ze=8192,Tt=16384,Zi=32768,zt=65536,cs=1<<17,Vs=1<<18,vn=1<<19,qs=1<<20,Gt=32768,Ti=1<<21,Yi=1<<22,kt=1<<23,At=Symbol("$state"),So=Symbol(""),rn=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Js(t){return t===this.v}function Qs(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function er(t){return!Qs(t,this.v)}function tr(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Eo(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function xo(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Io(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Co(t){throw new Error("https://svelte.dev/e/effect_orphan")}function Do(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function To(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function ko(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Ao(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function $o(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}let Rn=!1,Po=!1;function Mo(){Rn=!0}const Oo=1,Lo=2,Ro=16,Fo=1,Ho=2,be=Symbol(),No="http://www.w3.org/1999/xhtml";let ne=null;function dn(t){ne=t}function ue(t,e=!1,n){ne={p:ne,i:!1,c:null,e:null,s:t,x:null,l:Rn&&!e?{s:null,u:null,$:[]}:null}}function he(t){var e=ne,n=e.e;if(n!==null){e.e=null;for(var i of n)Er(i)}return e.i=!0,ne=e.p,{}}function Fn(){return!Rn||ne!==null&&ne.l===null}let on=[];function Xo(){var t=on;on=[],Vn(t)}function Hn(t){if(on.length===0){var e=on;queueMicrotask(()=>{e===on&&Xo()})}on.push(t)}function Bo(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Zo(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function Ke(t){if(typeof t!="object"||t===null||At in t)return t;const e=Xi(t);if(e!==mo&&e!==_o)return t;var n=new Map,i=Hi(t),s=W(0),r=Wt,o=l=>{if(Wt===r)return l();var a=G,d=Wt;Oe(null),gs(r);var u=l();return Oe(a),gs(d),u};return i&&n.set("length",W(t.length)),new Proxy(t,{defineProperty(l,a,d){(!("value"in d)||d.configurable===!1||d.enumerable===!1||d.writable===!1)&&To();var u=n.get(a);return u===void 0?u=o(()=>{var h=W(d.value);return n.set(a,h),h}):A(u,d.value,!0),!0},deleteProperty(l,a){var d=n.get(a);if(d===void 0){if(a in l){const u=o(()=>W(be));n.set(a,u),Dn(s)}}else A(d,be),Dn(s);return!0},get(l,a,d){if(a===At)return t;var u=n.get(a),h=a in l;if(u===void 0&&(!h||Cn(l,a)?.writable)&&(u=o(()=>{var g=Ke(h?l[a]:be),p=W(g);return p}),n.set(a,u)),u!==void 0){var f=c(u);return f===be?void 0:f}return Reflect.get(l,a,d)},getOwnPropertyDescriptor(l,a){var d=Reflect.getOwnPropertyDescriptor(l,a);if(d&&"value"in d){var u=n.get(a);u&&(d.value=c(u))}else if(d===void 0){var h=n.get(a),f=h?.v;if(h!==void 0&&f!==be)return{enumerable:!0,configurable:!0,value:f,writable:!0}}return d},has(l,a){if(a===At)return!0;var d=n.get(a),u=d!==void 0&&d.v!==be||Reflect.has(l,a);if(d!==void 0||q!==null&&(!u||Cn(l,a)?.writable)){d===void 0&&(d=o(()=>{var f=u?Ke(l[a]):be,g=W(f);return g}),n.set(a,d));var h=c(d);if(h===be)return!1}return u},set(l,a,d,u){var h=n.get(a),f=a in l;if(i&&a==="length")for(var g=d;g<h.v;g+=1){var p=n.get(g+"");p!==void 0?A(p,be):g in l&&(p=o(()=>W(be)),n.set(g+"",p))}if(h===void 0)(!f||Cn(l,a)?.writable)&&(h=o(()=>W(void 0)),A(h,Ke(d)),n.set(a,h));else{f=h.v!==be;var b=o(()=>Ke(d));A(h,b)}var k=Reflect.getOwnPropertyDescriptor(l,a);if(k?.set&&k.set.call(u,d),!f){if(i&&typeof a=="string"){var _=n.get("length"),m=Number(a);Number.isInteger(m)&&m>=_.v&&A(_,m+1)}Dn(s)}return!0},ownKeys(l){c(s);var a=Reflect.ownKeys(l).filter(h=>{var f=n.get(h);return f===void 0||f.v!==be});for(var[d,u]of n)u.v!==be&&!(d in l)&&a.push(d);return a},setPrototypeOf(){ko()}})}function ds(t){try{if(t!==null&&typeof t=="object"&&At in t)return t[At]}catch{}return t}function Yo(t,e){return Object.is(ds(t),ds(e))}var us,nr,ir,sr,rr;function Wo(){if(us===void 0){us=window,nr=document,ir=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,n=Text.prototype;sr=Cn(e,"firstChild").get,rr=Cn(e,"nextSibling").get,ls(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),ls(n)&&(n.__t=void 0)}}function wt(t=""){return document.createTextNode(t)}function qn(t){return sr.call(t)}function Nn(t){return rr.call(t)}function $(t,e){return qn(t)}function ae(t,e=!1){{var n=qn(t);return n instanceof Comment&&n.data===""?Nn(n):n}}function T(t,e=1,n=!1){let i=t;for(;e--;)i=Nn(i);return i}function zo(t){t.textContent=""}function or(){return!1}function ar(t){var e=q;if(e===null)return G.f|=kt,t;if((e.f&Zi)===0){if((e.f&di)===0)throw t;e.b.error(t)}else un(t,e)}function un(t,e){for(;e!==null;){if((e.f&di)!==0)try{e.b.error(t);return}catch(n){t=n}e=e.parent}throw t}const Bn=new Set;let se=null,Ue=null,ot=[],Wi=null,ki=!1;class at{committed=!1;current=new Map;previous=new Map;#e=new Set;#t=new Set;#i=0;#n=0;#l=null;#r=[];#s=[];skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#n>0}process(e){ot=[],this.apply();var n={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const i of e)this.#o(i,n);this.is_fork||this.#d(),this.is_deferred()?(this.#a(n.effects),this.#a(n.render_effects),this.#a(n.block_effects)):(se=null,hs(n.render_effects),hs(n.effects),this.#l?.resolve()),Ue=null}#o(e,n){e.f^=pe;for(var i=e.first;i!==null;){var s=i.f,r=(s&(Et|jt))!==0,o=r&&(s&pe)!==0,l=o||(s&Ze)!==0||this.skipped_effects.has(i);if((i.f&di)!==0&&i.b?.is_pending()&&(n={parent:n,effect:i,effects:[],render_effects:[],block_effects:[]}),!l&&i.fn!==null){r?i.f^=pe:(s&Bi)!==0?n.effects.push(i):_n(i)&&((i.f&St)!==0&&n.block_effects.push(i),hn(i));var a=i.first;if(a!==null){i=a;continue}}var d=i.parent;for(i=i.next;i===null&&d!==null;)d===n.effect&&(this.#a(n.effects),this.#a(n.render_effects),this.#a(n.block_effects),n=n.parent),i=d.next,d=d.parent}}#a(e){for(const n of e)((n.f&Fe)!==0?this.#r:this.#s).push(n),this.#c(n.deps),ve(n,pe)}#c(e){if(e!==null)for(const n of e)(n.f&me)===0||(n.f&Gt)===0||(n.f^=Gt,this.#c(n.deps))}capture(e,n){this.previous.has(e)||this.previous.set(e,n),(e.f&kt)===0&&(this.current.set(e,e.v),Ue?.set(e,e.v))}activate(){se=this,this.apply()}deactivate(){se===this&&(se=null,Ue=null)}flush(){if(this.activate(),ot.length>0){if(Go(),se!==null&&se!==this)return}else this.#i===0&&this.process([]);this.deactivate()}discard(){for(const e of this.#t)e(this);this.#t.clear()}#d(){if(this.#n===0){for(const e of this.#e)e();this.#e.clear()}this.#i===0&&this.#u()}#u(){if(Bn.size>1){this.previous.clear();var e=Ue,n=!0,i={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const r of Bn){if(r===this){n=!1;continue}const o=[];for(const[a,d]of this.current){if(r.current.has(a))if(n&&d!==r.current.get(a))r.current.set(a,d);else continue;o.push(a)}if(o.length===0)continue;const l=[...r.current.keys()].filter(a=>!this.current.has(a));if(l.length>0){var s=ot;ot=[];const a=new Set,d=new Map;for(const u of o)lr(u,l,a,d);if(ot.length>0){se=r,r.apply();for(const u of ot)r.#o(u,i);r.deactivate()}ot=s}}se=null,Ue=e}this.committed=!0,Bn.delete(this)}increment(e){this.#i+=1,e&&(this.#n+=1)}decrement(e){this.#i-=1,e&&(this.#n-=1),this.revive()}revive(){for(const e of this.#r)ve(e,Fe),Kt(e);for(const e of this.#s)ve(e,dt),Kt(e);this.#r=[],this.#s=[],this.flush()}oncommit(e){this.#e.add(e)}ondiscard(e){this.#t.add(e)}settled(){return(this.#l??=js()).promise}static ensure(){if(se===null){const e=se=new at;Bn.add(se),at.enqueue(()=>{se===e&&e.flush()})}return se}static enqueue(e){Hn(e)}apply(){}}function Go(){var t=Mt;ki=!0;var e=null;try{var n=0;for(Qn(!0);ot.length>0;){var i=at.ensure();if(n++>1e3){var s,r;Ko()}i.process(ot),Pt.clear()}}finally{ki=!1,Qn(t),Wi=null}}function Ko(){try{Do()}catch(t){un(t,Wi)}}let mt=null;function hs(t){var e=t.length;if(e!==0){for(var n=0;n<e;){var i=t[n++];if((i.f&(Tt|Ze))===0&&_n(i)&&(mt=new Set,hn(i),i.deps===null&&i.first===null&&i.nodes_start===null&&(i.teardown===null&&i.ac===null?Cr(i):i.fn=null),mt?.size>0)){Pt.clear();for(const s of mt){if((s.f&(Tt|Ze))!==0)continue;const r=[s];let o=s.parent;for(;o!==null;)mt.has(o)&&(mt.delete(o),r.push(o)),o=o.parent;for(let l=r.length-1;l>=0;l--){const a=r[l];(a.f&(Tt|Ze))===0&&hn(a)}}mt.clear()}}mt=null}}function lr(t,e,n,i){if(!n.has(t)&&(n.add(t),t.reactions!==null))for(const s of t.reactions){const r=s.f;(r&me)!==0?lr(s,e,n,i):(r&(Yi|St))!==0&&(r&Fe)===0&&cr(s,e,i)&&(ve(s,Fe),Kt(s))}}function cr(t,e,n){const i=n.get(t);if(i!==void 0)return i;if(t.deps!==null)for(const s of t.deps){if(e.includes(s))return!0;if((s.f&me)!==0&&cr(s,e,n))return n.set(s,!0),!0}return n.set(t,!1),!1}function Kt(t){for(var e=Wi=t;e.parent!==null;){e=e.parent;var n=e.f;if(ki&&e===q&&(n&St)!==0&&(n&Vs)===0)return;if((n&(jt|Et))!==0){if((n&pe)===0)return;e.f^=pe}}ot.push(e)}function Uo(t){let e=0,n=Ut(0),i;return()=>{Pn()&&(c(n),fi(()=>(e===0&&(i=Lt(()=>t(()=>Dn(n)))),e+=1,()=>{Hn(()=>{e-=1,e===0&&(i?.(),i=void 0,Dn(n))})})))}}var jo=zt|vn|di;function Vo(t,e,n){new qo(t,e,n)}class qo{parent;#e=!1;#t;#i=null;#n;#l;#r;#s=null;#o=null;#a=null;#c=null;#d=null;#u=0;#h=0;#g=!1;#f=null;#y=Uo(()=>(this.#f=Ut(this.#u),()=>{this.#f=null}));constructor(e,n,i){this.#t=e,this.#n=n,this.#l=i,this.parent=q.b,this.#e=!!this.#n.pending,this.#r=gi(()=>{q.b=this;{var s=this.#m();try{this.#s=Ge(()=>i(s))}catch(r){this.error(r)}this.#h>0?this.#v():this.#e=!1}return()=>{this.#d?.remove()}},jo)}#b(){try{this.#s=Ge(()=>this.#l(this.#t))}catch(e){this.error(e)}this.#e=!1}#w(){const e=this.#n.pending;e&&(this.#o=Ge(()=>e(this.#t)),at.enqueue(()=>{var n=this.#m();this.#s=this.#p(()=>(at.ensure(),Ge(()=>this.#l(n)))),this.#h>0?this.#v():(ln(this.#o,()=>{this.#o=null}),this.#e=!1)}))}#m(){var e=this.#t;return this.#e&&(this.#d=wt(),this.#t.before(this.#d),e=this.#d),e}is_pending(){return this.#e||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!this.#n.pending}#p(e){var n=q,i=G,s=ne;ct(this.#r),Oe(this.#r),dn(this.#r.ctx);try{return e()}catch(r){return ar(r),null}finally{ct(n),Oe(i),dn(s)}}#v(){const e=this.#n.pending;this.#s!==null&&(this.#c=document.createDocumentFragment(),this.#c.append(this.#d),kr(this.#s,this.#c)),this.#o===null&&(this.#o=Ge(()=>e(this.#t)))}#_(e){if(!this.has_pending_snippet()){this.parent&&this.parent.#_(e);return}this.#h+=e,this.#h===0&&(this.#e=!1,this.#o&&ln(this.#o,()=>{this.#o=null}),this.#c&&(this.#t.before(this.#c),this.#c=null))}update_pending_count(e){this.#_(e),this.#u+=e,this.#f&&An(this.#f,this.#u)}get_effect_pending(){return this.#y(),c(this.#f)}error(e){var n=this.#n.onerror;let i=this.#n.failed;if(this.#g||!n&&!i)throw e;this.#s&&(Le(this.#s),this.#s=null),this.#o&&(Le(this.#o),this.#o=null),this.#a&&(Le(this.#a),this.#a=null);var s=!1,r=!1;const o=()=>{if(s){Zo();return}s=!0,r&&$o(),at.ensure(),this.#u=0,this.#a!==null&&ln(this.#a,()=>{this.#a=null}),this.#e=this.has_pending_snippet(),this.#s=this.#p(()=>(this.#g=!1,Ge(()=>this.#l(this.#t)))),this.#h>0?this.#v():this.#e=!1};var l=G;try{Oe(null),r=!0,n?.(e,o),r=!1}catch(a){un(a,this.#r&&this.#r.parent)}finally{Oe(l)}i&&Hn(()=>{this.#a=this.#p(()=>{at.ensure(),this.#g=!0;try{return Ge(()=>{i(this.#t,()=>e,()=>o)})}catch(a){return un(a,this.#r.parent),null}finally{this.#g=!1}})})}}function Yt(t,e){return e}function Jo(t,e,n){for(var i=[],s=e.length,r=0;r<s;r++)Ui(e[r].e,i,!0);Dr(i,()=>{var o=i.length===0&&n!==null;if(o){var l=n,a=l.parentNode;zo(a),a.append(l),t.items.clear(),rt(t,e[0].prev,e[s-1].next)}for(var d=0;d<s;d++){var u=e[d];o||(t.items.delete(u.k),rt(t,u.prev,u.next)),Le(u.e,!o)}t.first===e[0]&&(t.first=e[0].prev)})}function $t(t,e,n,i,s,r=null){var o=t,l=new Map,a=null;{var d=t;o=d.appendChild(wt())}var u=null,h=dr(()=>{var _=n();return Hi(_)?_:_==null?[]:Ni(_)}),f,g=!0;function p(){Qo(k,f,o,e,i),u!==null&&(f.length===0?(u.fragment?(o.before(u.fragment),u.fragment=null):ji(u.effect),b.first=u.effect):ln(u.effect,()=>{u=null}))}var b=gi(()=>{f=c(h);for(var _=f.length,m=new Set,w=se,y=null,v=or(),S=0;S<_;S+=1){var C=f[S],O=i(C,S),X=g?null:l.get(O);X?(An(X.v,C),X.i=S,v&&w.skipped_effects.delete(X.e)):(X=ea(g?o:null,y,C,O,S,s,e,n),g&&(X.o=!0,y===null?a=X:y.next=X,y=X),l.set(O,X)),m.add(O)}if(_===0&&r&&!u)if(g)u={fragment:null,effect:Ge(()=>r(o))};else{var Z=document.createDocumentFragment(),x=wt();Z.append(x),u={fragment:Z,effect:Ge(()=>r(x))}}if(!g)if(v){for(const[M,I]of l)m.has(M)||w.skipped_effects.add(I.e);w.oncommit(p),w.ondiscard(()=>{})}else p();c(h)}),k={effect:b,items:l,first:a};g=!1}function Qo(t,e,n,i,s){var r=e.length,o=t.items,l=t.first,a,d=null,u=[],h=[],f,g,p,b;for(b=0;b<r;b+=1){if(f=e[b],g=s(f,b),p=o.get(g),t.first??=p,!p.o){p.o=!0;var k=d?d.next:l;rt(t,d,p),rt(t,p,k),yi(p,k,n),d=p,u=[],h=[],l=d.next;continue}if((p.e.f&Ze)!==0&&ji(p.e),p!==l){if(a!==void 0&&a.has(p)){if(u.length<h.length){var _=h[0],m;d=_.prev;var w=u[0],y=u[u.length-1];for(m=0;m<u.length;m+=1)yi(u[m],_,n);for(m=0;m<h.length;m+=1)a.delete(h[m]);rt(t,w.prev,y.next),rt(t,d,w),rt(t,y,_),l=_,d=y,b-=1,u=[],h=[]}else a.delete(p),yi(p,l,n),rt(t,p.prev,p.next),rt(t,p,d===null?t.first:d.next),rt(t,d,p),d=p;continue}for(u=[],h=[];l!==null&&l.k!==g;)(l.e.f&Ze)===0&&(a??=new Set).add(l),h.push(l),l=l.next;if(l===null)continue;p=l}u.push(p),d=p,l=p.next}if(l!==null||a!==void 0){for(var v=a===void 0?[]:Ni(a);l!==null;)(l.e.f&Ze)===0&&v.push(l),l=l.next;var S=v.length;if(S>0){var C=r===0?n:null;Jo(t,v,C)}}}function ea(t,e,n,i,s,r,o,l){var a=(o&Oo)!==0,d=(o&Ro)===0,u=a?d?Gi(n,!1,!1):Ut(n):n,h=(o&Lo)===0?s:Ut(s),f={i:h,v:u,k:i,a:null,e:null,o:!1,prev:e,next:null};try{if(t===null){var g=document.createDocumentFragment();g.append(t=wt())}return f.e=Ge(()=>r(t,u,h,l)),e!==null&&(e.next=f),f}finally{}}function yi(t,e,n){for(var i=t.next?t.next.e.nodes_start:n,s=e?e.e.nodes_start:n,r=t.e.nodes_start;r!==null&&r!==i;){var o=Nn(r);s.before(r),r=o}}function rt(t,e,n){e===null?(t.first=n,t.effect.first=n&&n.e):(e.e.next&&(e.e.next.prev=null),e.next=n,e.e.next=n&&n.e),n===null?t.effect.last=e&&e.e:(n.e.prev&&(n.e.prev.next=null),n.prev=e,n.e.prev=e&&e.e)}function ta(t,e,n,i){const s=Fn()?ui:dr;if(n.length===0&&t.length===0){i(e.map(s));return}var r=se,o=q,l=na();function a(){Promise.all(n.map(d=>ia(d))).then(d=>{l();try{i([...e.map(s),...d])}catch(u){(o.f&Tt)===0&&un(u,o)}r?.deactivate(),Jn()}).catch(d=>{un(d,o)})}t.length>0?Promise.all(t).then(()=>{l();try{return a()}finally{r?.deactivate(),Jn()}}):a()}function na(){var t=q,e=G,n=ne,i=se;return function(r=!0){ct(t),Oe(e),dn(n),r&&i?.activate()}}function Jn(){ct(null),Oe(null),dn(null)}function ui(t){var e=me|Fe,n=G!==null&&(G.f&me)!==0?G:null;return q!==null&&(q.f|=vn),{ctx:ne,deps:null,effects:null,equals:Js,f:e,fn:t,reactions:null,rv:0,v:be,wv:0,parent:n??q,ac:null}}function ia(t,e){let n=q;n===null&&Eo();var i=n.b,s=void 0,r=Ut(be),o=!G,l=new Map;return pa(()=>{var a=js();s=a.promise;try{Promise.resolve(t()).then(a.resolve,a.reject).then(()=>{d===se&&d.committed&&d.deactivate(),Jn()})}catch(f){a.reject(f),Jn()}var d=se;if(o){var u=!i.is_pending();i.update_pending_count(1),d.increment(u),l.get(d)?.reject(rn),l.delete(d),l.set(d,a)}const h=(f,g=void 0)=>{if(d.activate(),g)g!==rn&&(r.f|=kt,An(r,g));else{(r.f&kt)!==0&&(r.f^=kt),An(r,f);for(const[p,b]of l){if(l.delete(p),p===d)break;b.reject(rn)}}o&&(i.update_pending_count(-1),d.decrement(u))};a.promise.then(h,f=>h(null,f||"unknown"))}),hi(()=>{for(const a of l.values())a.reject(rn)}),new Promise(a=>{function d(u){function h(){u===s?a(r):d(s)}u.then(h,h)}d(s)})}function N(t){const e=ui(t);return pr(e),e}function dr(t){const e=ui(t);return e.equals=er,e}function ur(t){var e=t.effects;if(e!==null){t.effects=null;for(var n=0;n<e.length;n+=1)Le(e[n])}}function sa(t){for(var e=t.parent;e!==null;){if((e.f&me)===0)return(e.f&Tt)===0?e:null;e=e.parent}return null}function zi(t){var e,n=q;ct(sa(t));try{t.f&=~Gt,ur(t),e=yr(t)}finally{ct(n)}return e}function hr(t){var e=zi(t);if(t.equals(e)||(se?.is_fork||(t.v=e),t.wv=mr()),!mn)if(Ue!==null)(Pn()||se?.is_fork)&&Ue.set(t,e);else{var n=(t.f&Qe)===0?dt:pe;ve(t,n)}}let Ai=new Set;const Pt=new Map;let fr=!1;function Ut(t,e){var n={f:0,v:t,reactions:null,equals:Js,rv:0,wv:0};return n}function W(t,e){const n=Ut(t);return pr(n),n}function Gi(t,e=!1,n=!0){const i=Ut(t);return e||(i.equals=er),Rn&&n&&ne!==null&&ne.l!==null&&(ne.l.s??=[]).push(i),i}function A(t,e,n=!1){G!==null&&(!lt||(G.f&cs)!==0)&&Fn()&&(G.f&(me|St|Yi|cs))!==0&&!_t?.includes(t)&&Ao();let i=n?Ke(e):e;return An(t,i)}function An(t,e){if(!t.equals(e)){var n=t.v;mn?Pt.set(t,e):Pt.set(t,n),t.v=e;var i=at.ensure();i.capture(t,n),(t.f&me)!==0&&((t.f&Fe)!==0&&zi(t),ve(t,(t.f&Qe)!==0?pe:dt)),t.wv=mr(),gr(t,Fe),Fn()&&q!==null&&(q.f&pe)!==0&&(q.f&(Et|jt))===0&&(ze===null?oa([t]):ze.push(t)),!i.is_fork&&Ai.size>0&&!fr&&ra()}return e}function ra(){fr=!1;var t=Mt;Qn(!0);const e=Array.from(Ai);try{for(const n of e)(n.f&pe)!==0&&ve(n,dt),_n(n)&&hn(n)}finally{Qn(t)}Ai.clear()}function Dn(t){A(t,t.v+1)}function gr(t,e){var n=t.reactions;if(n!==null)for(var i=Fn(),s=n.length,r=0;r<s;r++){var o=n[r],l=o.f;if(!(!i&&o===q)){var a=(l&Fe)===0;if(a&&ve(o,e),(l&me)!==0){var d=o;Ue?.delete(d),(l&Gt)===0&&(l&Qe&&(o.f|=Gt),gr(d,dt))}else a&&((l&St)!==0&&mt!==null&&mt.add(o),Kt(o))}}}function Ki(t){var e=G,n=q;Oe(null),ct(null);try{return t()}finally{Oe(e),ct(n)}}let Mt=!1;function Qn(t){Mt=t}let mn=!1;function fs(t){mn=t}let G=null,lt=!1;function Oe(t){G=t}let q=null;function ct(t){q=t}let _t=null;function pr(t){G!==null&&(_t===null?_t=[t]:_t.push(t))}let $e=null,Be=0,ze=null;function oa(t){ze=t}let vr=1,$n=0,Wt=$n;function gs(t){Wt=t}function mr(){return++vr}function _n(t){var e=t.f;if((e&Fe)!==0)return!0;if(e&me&&(t.f&=~Gt),(e&dt)!==0){var n=t.deps;if(n!==null)for(var i=n.length,s=0;s<i;s++){var r=n[s];if(_n(r)&&hr(r),r.wv>t.wv)return!0}(e&Qe)!==0&&Ue===null&&ve(t,pe)}return!1}function _r(t,e,n=!0){var i=t.reactions;if(i!==null&&!_t?.includes(t))for(var s=0;s<i.length;s++){var r=i[s];(r.f&me)!==0?_r(r,e,!1):e===r&&(n?ve(r,Fe):(r.f&pe)!==0&&ve(r,dt),Kt(r))}}function yr(t){var e=$e,n=Be,i=ze,s=G,r=_t,o=ne,l=lt,a=Wt,d=t.f;$e=null,Be=0,ze=null,G=(d&(Et|jt))===0?t:null,_t=null,dn(t.ctx),lt=!1,Wt=++$n,t.ac!==null&&(Ki(()=>{t.ac.abort(rn)}),t.ac=null);try{t.f|=Ti;var u=t.fn,h=u(),f=t.deps;if($e!==null){var g;if(ei(t,Be),f!==null&&Be>0)for(f.length=Be+$e.length,g=0;g<$e.length;g++)f[Be+g]=$e[g];else t.deps=f=$e;if(Mt&&Pn()&&(t.f&Qe)!==0)for(g=Be;g<f.length;g++)(f[g].reactions??=[]).push(t)}else f!==null&&Be<f.length&&(ei(t,Be),f.length=Be);if(Fn()&&ze!==null&&!lt&&f!==null&&(t.f&(me|dt|Fe))===0)for(g=0;g<ze.length;g++)_r(ze[g],t);return s!==null&&s!==t&&($n++,ze!==null&&(i===null?i=ze:i.push(...ze))),(t.f&kt)!==0&&(t.f^=kt),h}catch(p){return ar(p)}finally{t.f^=Ti,$e=e,Be=n,ze=i,G=s,_t=r,dn(o),lt=l,Wt=a}}function aa(t,e){let n=e.reactions;if(n!==null){var i=vo.call(n,t);if(i!==-1){var s=n.length-1;s===0?n=e.reactions=null:(n[i]=n[s],n.pop())}}n===null&&(e.f&me)!==0&&($e===null||!$e.includes(e))&&(ve(e,dt),(e.f&Qe)!==0&&(e.f^=Qe,e.f&=~Gt),ur(e),ei(e,0))}function ei(t,e){var n=t.deps;if(n!==null)for(var i=e;i<n.length;i++)aa(t,n[i])}function hn(t){var e=t.f;if((e&Tt)===0){ve(t,pe);var n=q,i=Mt;q=t,Mt=!0;try{(e&(St|wo))!==0?va(t):Ir(t),xr(t);var s=yr(t);t.teardown=typeof s=="function"?s:null,t.wv=vr;var r;Di&&Po&&(t.f&Fe)!==0&&t.deps}finally{Mt=i,q=n}}}function c(t){var e=t.f,n=(e&me)!==0;if(G!==null&&!lt){var i=q!==null&&(q.f&Tt)!==0;if(!i&&!_t?.includes(t)){var s=G.deps;if((G.f&Ti)!==0)t.rv<$n&&(t.rv=$n,$e===null&&s!==null&&s[Be]===t?Be++:$e===null?$e=[t]:$e.includes(t)||$e.push(t));else{(G.deps??=[]).push(t);var r=t.reactions;r===null?t.reactions=[G]:r.includes(G)||r.push(G)}}}if(mn){if(Pt.has(t))return Pt.get(t);if(n){var o=t,l=o.v;return((o.f&pe)===0&&o.reactions!==null||wr(o))&&(l=zi(o)),Pt.set(o,l),l}}else n&&(!Ue?.has(t)||se?.is_fork&&!Pn())&&(o=t,_n(o)&&hr(o),Mt&&Pn()&&(o.f&Qe)===0&&br(o));if(Ue?.has(t))return Ue.get(t);if((t.f&kt)!==0)throw t.v;return t.v}function br(t){if(t.deps!==null){t.f^=Qe;for(const e of t.deps)(e.reactions??=[]).push(t),(e.f&me)!==0&&(e.f&Qe)===0&&br(e)}}function wr(t){if(t.v===be)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(Pt.has(e)||(e.f&me)!==0&&wr(e))return!0;return!1}function Lt(t){var e=lt;try{return lt=!0,t()}finally{lt=e}}const la=-7169;function ve(t,e){t.f=t.f&la|e}function ca(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(At in t)$i(t);else if(!Array.isArray(t))for(let e in t){const n=t[e];typeof n=="object"&&n&&At in n&&$i(n)}}}function $i(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let i in t)try{$i(t[i],e)}catch{}const n=Xi(t);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const i=Us(n);for(let s in i){const r=i[s].get;if(r)try{r.call(t)}catch{}}}}}function Sr(t){q===null&&(G===null&&Co(),Io()),mn&&xo()}function da(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function ut(t,e,n){var i=q;i!==null&&(i.f&Ze)!==0&&(t|=Ze);var s={ctx:ne,deps:null,nodes_start:null,nodes_end:null,f:t|Fe|Qe,first:null,fn:e,last:null,next:null,parent:i,b:i&&i.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(n)try{hn(s),s.f|=Zi}catch(l){throw Le(s),l}else e!==null&&Kt(s);var r=s;if(n&&r.deps===null&&r.teardown===null&&r.nodes_start===null&&r.first===r.last&&(r.f&vn)===0&&(r=r.first,(t&St)!==0&&(t&zt)!==0&&r!==null&&(r.f|=zt)),r!==null&&(r.parent=i,i!==null&&da(r,i),G!==null&&(G.f&me)!==0&&(t&jt)===0)){var o=G;(o.effects??=[]).push(r)}return s}function Pn(){return G!==null&&!lt}function hi(t){const e=ut(ci,null,!1);return ve(e,pe),e.teardown=t,e}function Ee(t){Sr();var e=q.f,n=!G&&(e&Et)!==0&&(e&Zi)===0;if(n){var i=ne;(i.e??=[]).push(t)}else return Er(t)}function Er(t){return ut(Bi|qs,t,!1)}function ua(t){return Sr(),ut(ci|qs,t,!0)}function ha(t){at.ensure();const e=ut(jt|vn,t,!0);return(n={})=>new Promise(i=>{n.outro?ln(e,()=>{Le(e),i(void 0)}):(Le(e),i(void 0))})}function fa(t){return ut(Bi,t,!1)}function ps(t,e){var n=ne,i={effect:null,ran:!1,deps:t};n.l.$.push(i),i.effect=fi(()=>{t(),!i.ran&&(i.ran=!0,Lt(e))})}function ga(){var t=ne;fi(()=>{for(var e of t.l.$){e.deps();var n=e.effect;(n.f&pe)!==0&&ve(n,dt),_n(n)&&hn(n),e.ran=!1}})}function pa(t){return ut(Yi|vn,t,!0)}function fi(t,e=0){return ut(ci|e,t,!0)}function K(t,e=[],n=[],i=[]){ta(i,e,n,s=>{ut(ci,()=>t(...s.map(c)),!0)})}function gi(t,e=0){var n=ut(St|e,t,!0);return n}function Ge(t){return ut(Et|vn,t,!0)}function xr(t){var e=t.teardown;if(e!==null){const n=mn,i=G;fs(!0),Oe(null);try{e.call(null)}finally{fs(n),Oe(i)}}}function Ir(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){const s=n.ac;s!==null&&Ki(()=>{s.abort(rn)});var i=n.next;(n.f&jt)!==0?n.parent=null:Le(n,e),n=i}}function va(t){for(var e=t.first;e!==null;){var n=e.next;(e.f&Et)===0&&Le(e),e=n}}function Le(t,e=!0){var n=!1;(e||(t.f&Vs)!==0)&&t.nodes_start!==null&&t.nodes_end!==null&&(ma(t.nodes_start,t.nodes_end),n=!0),Ir(t,e&&!n),ei(t,0),ve(t,Tt);var i=t.transitions;if(i!==null)for(const r of i)r.stop();xr(t);var s=t.parent;s!==null&&s.first!==null&&Cr(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes_start=t.nodes_end=t.ac=null}function ma(t,e){for(;t!==null;){var n=t===e?null:Nn(t);t.remove(),t=n}}function Cr(t){var e=t.parent,n=t.prev,i=t.next;n!==null&&(n.next=i),i!==null&&(i.prev=n),e!==null&&(e.first===t&&(e.first=i),e.last===t&&(e.last=n))}function ln(t,e,n=!0){var i=[];Ui(t,i,!0),Dr(i,()=>{n&&Le(t),e&&e()})}function Dr(t,e){var n=t.length;if(n>0){var i=()=>--n||e();for(var s of t)s.out(i)}else e()}function Ui(t,e,n){if((t.f&Ze)===0){if(t.f^=Ze,t.transitions!==null)for(const o of t.transitions)(o.is_global||n)&&e.push(o);for(var i=t.first;i!==null;){var s=i.next,r=(i.f&zt)!==0||(i.f&Et)!==0&&(t.f&St)!==0;Ui(i,e,r?n:!1),i=s}}}function ji(t){Tr(t,!0)}function Tr(t,e){if((t.f&Ze)!==0){t.f^=Ze,(t.f&pe)===0&&(ve(t,Fe),Kt(t));for(var n=t.first;n!==null;){var i=n.next,s=(n.f&zt)!==0||(n.f&Et)!==0;Tr(n,s?e:!1),n=i}if(t.transitions!==null)for(const r of t.transitions)(r.is_global||e)&&r.in()}}function kr(t,e){for(var n=t.nodes_start,i=t.nodes_end;n!==null;){var s=n===i?null:Nn(n);e.append(n),n=s}}const _a=["touchstart","touchmove"];function ya(t){return _a.includes(t)}const Ar=new Set,Pi=new Set;function ba(t,e,n,i={}){function s(r){if(i.capture||Sn.call(e,r),!r.cancelBubble)return Ki(()=>n?.call(this,r))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?Hn(()=>{e.addEventListener(t,s,i)}):e.addEventListener(t,s,i),s}function Ot(t,e,n,i,s){var r={capture:i,passive:s},o=ba(t,e,n,r);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&hi(()=>{e.removeEventListener(t,o,r)})}function et(t){for(var e=0;e<t.length;e++)Ar.add(t[e]);for(var n of Pi)n(t)}let vs=null;function Sn(t){var e=this,n=e.ownerDocument,i=t.type,s=t.composedPath?.()||[],r=s[0]||t.target;vs=t;var o=0,l=vs===t&&t.__root;if(l){var a=s.indexOf(l);if(a!==-1&&(e===document||e===window)){t.__root=e;return}var d=s.indexOf(e);if(d===-1)return;a<=d&&(o=a)}if(r=s[o]||t.target,r!==e){Ks(t,"currentTarget",{configurable:!0,get(){return r||n}});var u=G,h=q;Oe(null),ct(null);try{for(var f,g=[];r!==null;){var p=r.assignedSlot||r.parentNode||r.host||null;try{var b=r["__"+i];b!=null&&(!r.disabled||t.target===r)&&b.call(r,t)}catch(k){f?g.push(k):f=k}if(t.cancelBubble||p===e||p===null)break;r=p}if(f){for(let k of g)queueMicrotask(()=>{throw k});throw f}}finally{t.__root=e,delete t.currentTarget,Oe(u),ct(h)}}}function wa(t){var e=document.createElement("template");return e.innerHTML=t.replaceAll("<!>","<!---->"),e.content}function ti(t,e){var n=q;n.nodes_start===null&&(n.nodes_start=t,n.nodes_end=e)}function H(t,e){var n=(e&Fo)!==0,i=(e&Ho)!==0,s,r=!t.startsWith("<!>");return()=>{s===void 0&&(s=wa(r?t:"<!>"+t),n||(s=qn(s)));var o=i||ir?document.importNode(s,!0):s.cloneNode(!0);if(n){var l=qn(o),a=o.lastChild;ti(l,a)}else ti(o,o);return o}}function re(t=""){{var e=wt(t+"");return ti(e,e),e}}function xe(){var t=document.createDocumentFragment(),e=document.createComment(""),n=wt();return t.append(e,n),ti(e,n),t}function E(t,e){t!==null&&t.before(e)}function ge(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??=t.nodeValue)&&(t.__t=n,t.nodeValue=n+"")}function Sa(t,e){return Ea(t,e)}const en=new Map;function Ea(t,{target:e,anchor:n,props:i={},events:s,context:r,intro:o=!0}){Wo();var l=new Set,a=h=>{for(var f=0;f<h.length;f++){var g=h[f];if(!l.has(g)){l.add(g);var p=ya(g);e.addEventListener(g,Sn,{passive:p});var b=en.get(g);b===void 0?(document.addEventListener(g,Sn,{passive:p}),en.set(g,1)):en.set(g,b+1)}}};a(Ni(Ar)),Pi.add(a);var d=void 0,u=ha(()=>{var h=n??e.appendChild(wt());return Vo(h,{pending:()=>{}},f=>{if(r){ue({});var g=ne;g.c=r}s&&(i.$$events=s),d=t(f,i)||{},r&&he()}),()=>{for(var f of l){e.removeEventListener(f,Sn);var g=en.get(f);--g===0?(document.removeEventListener(f,Sn),en.delete(f)):en.set(f,g)}Pi.delete(a),h!==n&&h.parentNode?.removeChild(h)}});return xa.set(d,u),d}let xa=new WeakMap;class $r{anchor;#e=new Map;#t=new Map;#i=new Map;#n=new Set;#l=!0;constructor(e,n=!0){this.anchor=e,this.#l=n}#r=()=>{var e=se;if(this.#e.has(e)){var n=this.#e.get(e),i=this.#t.get(n);if(i)ji(i),this.#n.delete(n);else{var s=this.#i.get(n);s&&(this.#t.set(n,s.effect),this.#i.delete(n),s.fragment.lastChild.remove(),this.anchor.before(s.fragment),i=s.effect)}for(const[r,o]of this.#e){if(this.#e.delete(r),r===e)break;const l=this.#i.get(o);l&&(Le(l.effect),this.#i.delete(o))}for(const[r,o]of this.#t){if(r===n||this.#n.has(r))continue;const l=()=>{if(Array.from(this.#e.values()).includes(r)){var d=document.createDocumentFragment();kr(o,d),d.append(wt()),this.#i.set(r,{effect:o,fragment:d})}else Le(o);this.#n.delete(r),this.#t.delete(r)};this.#l||!i?(this.#n.add(r),ln(o,l,!1)):l()}}};#s=e=>{this.#e.delete(e);const n=Array.from(this.#e.values());for(const[i,s]of this.#i)n.includes(i)||(Le(s.effect),this.#i.delete(i))};ensure(e,n){var i=se,s=or();if(n&&!this.#t.has(e)&&!this.#i.has(e))if(s){var r=document.createDocumentFragment(),o=wt();r.append(o),this.#i.set(e,{effect:Ge(()=>n(o)),fragment:r})}else this.#t.set(e,Ge(()=>n(this.anchor)));if(this.#e.set(i,e),s){for(const[l,a]of this.#t)l===e?i.skipped_effects.delete(a):i.skipped_effects.add(a);for(const[l,a]of this.#i)l===e?i.skipped_effects.delete(a.effect):i.skipped_effects.add(a.effect);i.oncommit(this.#r),i.ondiscard(this.#s)}else this.#r()}}function U(t,e,n=!1){var i=new $r(t),s=n?zt:0;function r(o,l){i.ensure(o,l)}gi(()=>{var o=!1;e((l,a=!0)=>{o=!0,r(a,l)}),o||r(!1,null)},s)}function fn(t,e,...n){var i=new $r(t);gi(()=>{const s=e()??null;i.ensure(s,s&&(r=>s(r,...n)))},zt)}const ms=[...` 	
\r\f \v\uFEFF`];function Ia(t,e,n){var i=t==null?"":""+t;if(e&&(i=i?i+" "+e:e),n){for(var s in n)if(n[s])i=i?i+" "+s:s;else if(i.length)for(var r=s.length,o=0;(o=i.indexOf(s,o))>=0;){var l=o+r;(o===0||ms.includes(i[o-1]))&&(l===i.length||ms.includes(i[l]))?i=(o===0?"":i.substring(0,o))+i.substring(l+1):o=l}}return i===""?null:i}function _s(t,e=!1){var n=e?" !important;":";",i="";for(var s in t){var r=t[s];r!=null&&r!==""&&(i+=" "+s+": "+r+n)}return i}function bi(t){return t[0]!=="-"||t[1]!=="-"?t.toLowerCase():t}function Ca(t,e){if(e){var n="",i,s;if(Array.isArray(e)?(i=e[0],s=e[1]):i=e,t){t=String(t).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var r=!1,o=0,l=!1,a=[];i&&a.push(...Object.keys(i).map(bi)),s&&a.push(...Object.keys(s).map(bi));var d=0,u=-1;const b=t.length;for(var h=0;h<b;h++){var f=t[h];if(l?f==="/"&&t[h-1]==="*"&&(l=!1):r?r===f&&(r=!1):f==="/"&&t[h+1]==="*"?l=!0:f==='"'||f==="'"?r=f:f==="("?o++:f===")"&&o--,!l&&r===!1&&o===0){if(f===":"&&u===-1)u=h;else if(f===";"||h===b-1){if(u!==-1){var g=bi(t.substring(d,u).trim());if(!a.includes(g)){f!==";"&&h++;var p=t.substring(d,h).trim();n+=" "+p+";"}}d=h+1,u=-1}}}}return i&&(n+=_s(i)),s&&(n+=_s(s,!0)),n=n.trim(),n===""?null:n}return t==null?null:String(t)}function Pe(t,e,n,i,s,r){var o=t.__className;if(o!==n||o===void 0){var l=Ia(n,i,r);l==null?t.removeAttribute("class"):t.className=l,t.__className=n}else if(r&&s!==r)for(var a in r){var d=!!r[a];(s==null||d!==!!s[a])&&t.classList.toggle(a,d)}return r}function wi(t,e={},n,i){for(var s in n){var r=n[s];e[s]!==r&&(n[s]==null?t.style.removeProperty(s):t.style.setProperty(s,r,i))}}function ce(t,e,n,i){var s=t.__style;if(s!==e){var r=Ca(e,i);r==null?t.removeAttribute("style"):t.style.cssText=r,t.__style=e}else i&&(Array.isArray(i)?(wi(t,n?.[0],i[0]),wi(t,n?.[1],i[1],"important")):wi(t,n,i));return i}function Pr(t,e,n=!1){if(t.multiple){if(e==null)return;if(!Hi(e))return Bo();for(var i of t.options)i.selected=e.includes(ys(i));return}for(i of t.options){var s=ys(i);if(Yo(s,e)){i.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function Da(t){var e=new MutationObserver(()=>{Pr(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),hi(()=>{e.disconnect()})}function ys(t){return"__value"in t?t.__value:t.value}const Ta=Symbol("is custom element"),ka=Symbol("is html");function ni(t,e){var n=Mr(t);n.value===(n.value=e??void 0)||t.value===e&&(e!==0||t.nodeName!=="PROGRESS")||(t.value=e??"")}function te(t,e,n,i){var s=Mr(t);s[e]!==(s[e]=n)&&(e==="loading"&&(t[So]=n),n==null?t.removeAttribute(e):typeof n!="string"&&Aa(t).includes(e)?t[e]=n:t.setAttribute(e,n))}function Mr(t){return t.__attributes??={[Ta]:t.nodeName.includes("-"),[ka]:t.namespaceURI===No}}var bs=new Map;function Aa(t){var e=t.getAttribute("is")||t.nodeName,n=bs.get(e);if(n)return n;bs.set(e,n=[]);for(var i,s=t,r=Element.prototype;r!==s;){i=Us(s);for(var o in i)i[o].set&&n.push(o);s=Xi(s)}return n}function ws(t,e){return t===e||t?.[At]===e}function gn(t={},e,n,i){return fa(()=>{var s,r;return fi(()=>{s=r,r=[],Lt(()=>{t!==n(...r)&&(e(t,...r),s&&ws(n(...s),t)&&e(null,...s))})}),()=>{Hn(()=>{r&&ws(n(...r),t)&&e(null,...r)})}}),t}function $a(t=!1){const e=ne,n=e.l.u;if(!n)return;let i=()=>ca(e.s);if(t){let s=0,r={};const o=ui(()=>{let l=!1;const a=e.s;for(const d in a)a[d]!==r[d]&&(r[d]=a[d],l=!0);return l&&s++,s});i=()=>c(o)}n.b.length&&ua(()=>{Ss(e,i),Vn(n.b)}),Ee(()=>{const s=Lt(()=>n.m.map(yo));return()=>{for(const r of s)typeof r=="function"&&r()}}),n.a.length&&Ee(()=>{Ss(e,i),Vn(n.a)})}function Ss(t,e){if(t.l.s)for(const n of t.l.s)c(n);e()}let Mi=Symbol();function P(t,e,n){const i=n[e]??={store:null,source:Gi(void 0),unsubscribe:Ve};if(i.store!==t&&!(Mi in n))if(i.unsubscribe(),i.store=t??null,t==null)i.source.v=void 0,i.unsubscribe=Ve;else{var s=!0;i.unsubscribe=Vi(t,r=>{s?i.source.v=r:A(i.source,r)}),s=!1}return t&&Mi in n?Vt(t):c(i.source)}function Ie(){const t={};function e(){hi(()=>{for(var n in t)t[n].unsubscribe();Ks(t,Mi,{enumerable:!1,value:!0})})}return[t,e]}function ee(t,e,n,i){var s=i,r=!0,o=()=>(r&&(r=!1,s=i),s),l;l=t[e],l===void 0&&i!==void 0&&(l=o());var a;return a=()=>{var d=t[e];return d===void 0?o():(r=!0,d)},a}function Xn(t){ne===null&&tr(),Rn&&ne.l!==null?Ma(ne).m.push(t):Ee(()=>{const e=Lt(t);if(typeof e=="function")return e})}function Pa(t){ne===null&&tr(),Xn(()=>()=>Lt(t))}function Ma(t){var e=t.l;return e.u??={a:[],b:[],m:[]}}function Vi(t,e,n){if(t==null)return e(void 0),n&&n(void 0),Ve;const i=Lt(()=>t.subscribe(e,n));return i.unsubscribe?()=>i.unsubscribe():i}const tn=[];function Oa(t,e){return{subscribe:J(t,e).subscribe}}function J(t,e=Ve){let n=null;const i=new Set;function s(l){if(Qs(t,l)&&(t=l,n)){const a=!tn.length;for(const d of i)d[1](),tn.push(d,t);if(a){for(let d=0;d<tn.length;d+=2)tn[d][0](tn[d+1]);tn.length=0}}}function r(l){s(l(t))}function o(l,a=Ve){const d=[l,a];return i.add(d),i.size===1&&(n=e(s,r)||Ve),l(t),()=>{i.delete(d),i.size===0&&n&&(n(),n=null)}}return{set:s,update:r,subscribe:o}}function He(t,e,n){const i=!Array.isArray(t),s=i?[t]:t;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const r=e.length<2;return Oa(n,(o,l)=>{let a=!1;const d=[];let u=0,h=Ve;const f=()=>{if(u)return;h();const p=e(i?d[0]:d,o,l);r?o(p):h=typeof p=="function"?p:Ve},g=s.map((p,b)=>Vi(p,k=>{d[b]=k,u&=~(1<<b),a&&f()},()=>{u|=1<<b}));return a=!0,f(),function(){Vn(g),h(),a=!1}})}function Vt(t){let e;return Vi(t,n=>e=n)(),e}function La(){return`zone_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const Oi=["#e74c3c","#e67e22","#f1c40f","#2ecc71","#1abc9c","#3498db","#9b59b6","#e91e8f"];function Ra(){return Oi[Math.floor(Math.random()*Oi.length)]}function Es(t,e=200){return{id:La(),x:t,width:e,color:Ra(),texts:[{language:"cs",title:"",content:""}]}}function Fa(t,e){const n=t.texts.find(i=>i.language===e);return n||t.texts[0]||null}const Mn=J("cs"),Ha=J("orange"),Na=J("Forest"),Li=J(!1),En=J(!1),Or=J(!1),Lr=J(!1),Rr=J(null),Xa=He([Rr,Mn],([t,e])=>t?Fa(t,e):null);function Si(t){Rr.set(t)}const Fr=J({x:0,y:0});function Ba(t,e){Fr.set({x:t,y:e})}const Hr=J({scrollX:0,scrollY:0,zoom:1});function Za(t,e,n=1){Hr.set({scrollX:t,scrollY:e,zoom:n})}const Ri=J(!1);function Ya(){Ri.set(!0),setTimeout(()=>Ri.set(!1),150)}const Ye={BACKGROUND_BASE:-100,BACKGROUND_LAYER_START:-99,GROUND_REFERENCE:-1,ITEMS_BEHIND:5,PLAYER:10,ITEMS_FRONT:15,SELECTION_GRAPHICS:999,GRID_OVERLAY:1e3};function qi(t){return t==="behind"?Ye.ITEMS_BEHIND:Ye.ITEMS_FRONT}const pt=["orange","white"];class Wa{currentSkin=pt[0];currentIndex=0;setSkin(e){pt.includes(e)&&(this.currentSkin=e,this.currentIndex=pt.indexOf(e),localStorage.setItem("catSkin",e))}getSkin(){const e=localStorage.getItem("catSkin");return e&&pt.includes(e)&&(this.currentSkin=e,this.currentIndex=pt.indexOf(e)),this.currentSkin}toggleSkin(){return this.currentIndex=(this.currentIndex+1)%pt.length,this.currentSkin=pt[this.currentIndex],this.setSkin(this.currentSkin),this.currentSkin}getAllSkins(){return pt}}const Nr=new Wa,za={FAST_VELOCITY_THRESHOLD:100,ROTATION_FULL:15,ROTATION_SLIGHT:8};class Ga{scene;currentSkin;constructor(e,n="white"){this.scene=e,this.currentSkin=n}createAll(){Nr.getAllSkins().forEach(n=>{this.createAnimationsForSkin(n)})}createAnimationsForSkin(e){const n=this.scene;n.anims.exists(`cat-idle-${e}`)||n.anims.create({key:`cat-idle-${e}`,frames:n.anims.generateFrameNumbers(`cat-idle-${e}`,{start:0,end:3}),frameRate:6,repeat:-1}),n.anims.exists(`cat-walk-${e}`)||n.anims.create({key:`cat-walk-${e}`,frames:n.anims.generateFrameNumbers(`cat-walk-${e}`,{start:0,end:5}),frameRate:12,repeat:-1}),[{key:`cat-jump-up-${e}`,frame:2},{key:`cat-jump-peak-up-${e}`,frame:3},{key:`cat-jump-peak-down-${e}`,frame:3},{key:`cat-jump-down-${e}`,frame:4}].forEach(({key:s,frame:r})=>{n.anims.exists(s)||n.anims.create({key:s,frames:[{key:`cat-walk-${e}`,frame:r}],frameRate:1,repeat:0})})}getSkin(){return this.currentSkin}setSkin(e){this.currentSkin=e}getAnimationKey(e){return`cat-${e}-${this.currentSkin}`}play(e,n){const i=this.getAnimationKey(n);e.anims.currentAnim?.key!==i&&e.play(i)}getJumpAnimationState(e){const{FAST_VELOCITY_THRESHOLD:n,ROTATION_FULL:i,ROTATION_SLIGHT:s}=za;return e<-n?{animation:this.getAnimationKey("jump-up"),rotation:i,flipMultiplier:1}:e<-20?{animation:this.getAnimationKey("jump-peak-up"),rotation:s,flipMultiplier:1}:e<=n?{animation:this.getAnimationKey("jump-peak-down"),rotation:s,flipMultiplier:-1}:{animation:this.getAnimationKey("jump-down"),rotation:i,flipMultiplier:-1}}handleSkinChange(e,n){const i=this.currentSkin;this.currentSkin=n;const s=e.anims.currentAnim?.key;if(s){const o=`cat-${s.replace("cat-","").replace(`-${i}`,"")}-${n}`;this.scene.anims.exists(o)&&e.play(o)}}}const Nt={THRESHOLD_X:20,LANGUAGE_BUTTON:{width:120,height:60},SKIN_BUTTON:{width:120,height:60,yOffset:60}},xs={SPEED:350,JUMP_STRENGTH:-500};class Ka{scene;getPlayerPosition;keyUp;keyLeft;keyRight;keyA;keyD;keyW;keySpace;touchLeft=!1;touchRight=!1;touchJump=!1;touchHandlers;constructor(e){this.scene=e.scene,this.getPlayerPosition=e.getPlayerPosition,this.setupKeyboardControls(),this.setupTouchControls()}setupKeyboardControls(){this.scene.input.keyboard&&(this.keyUp=this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.UP,!1),this.keyLeft=this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.LEFT,!1),this.keyRight=this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.RIGHT,!1),this.keyA=this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.A,!1),this.keyD=this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.D,!1),this.keyW=this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.W,!1),this.keySpace=this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.SPACE,!1))}setupTouchControls(){const e=this.scene,n=o=>{if(Vt(Ri)){this.touchLeft=!1,this.touchRight=!1,this.touchJump=!1;return}const l=o.x,a=o.y,d=e.scale.width;if(l>d-Nt.LANGUAGE_BUTTON.width&&a<Nt.LANGUAGE_BUTTON.height||l>d-Nt.SKIN_BUTTON.width&&a>=Nt.SKIN_BUTTON.yOffset&&a<Nt.SKIN_BUTTON.yOffset+Nt.SKIN_BUTTON.height)return;const u=e.cameras.main,h=this.getPlayerPosition(),f=h.x-u.scrollX,g=h.y-u.scrollY,p=l-f,b=a-g;p<-20?(this.touchLeft=!0,this.touchRight=!1):p>Nt.THRESHOLD_X?(this.touchRight=!0,this.touchLeft=!1):(this.touchLeft=!1,this.touchRight=!1),this.touchJump=b<-80},i=o=>{n(o)},s=o=>{o.isDown&&n(o)},r=()=>{this.touchLeft=!1,this.touchRight=!1,this.touchJump=!1};e.input.on("pointerdown",i),e.input.on("pointermove",s),e.input.on("pointerup",r),this.touchHandlers={pointerdown:i,pointermove:s,pointerup:r}}getInputState(){const e=this.keyA?.isDown||this.keyLeft?.isDown||this.touchLeft||!1,n=this.keyD?.isDown||this.keyRight?.isDown||this.touchRight||!1,i=this.keySpace?.isDown||this.keyW?.isDown||this.keyUp?.isDown||this.touchJump||!1;return{left:e,right:n,jump:i}}hasAnyInput(){const e=this.getInputState();return e.left||e.right||e.jump}destroy(){this.touchHandlers&&(this.scene.input.off("pointerdown",this.touchHandlers.pointerdown),this.scene.input.off("pointermove",this.touchHandlers.pointermove),this.scene.input.off("pointerup",this.touchHandlers.pointerup),this.touchHandlers=void 0)}}class Ua extends B.Physics.Arcade.Sprite{animations;inputController;animState="idle";hasNotifiedMovement=!1;hasReceivedInput=!1;constructor(e,n,i){const s="white";super(e,n,i,`cat-idle-${s}`),e.add.existing(this),e.physics.add.existing(this),this.animations=new Ga(e,s),this.animations.createAll(),this.inputController=new Ka({scene:e,getPlayerPosition:()=>({x:this.x,y:this.y})}),this.setCollideWorldBounds(!0),this.setBounce(0),this.setSize(16,12),this.setOffset(16,36),this.setScale(5),this.setDepth(Ye.PLAYER),this.animations.play(this,"idle")}changeSkin(e){this.animations.handleSkinChange(this,e)}updateJumpAnimation(e){const{animation:n,rotation:i,flipMultiplier:s}=this.animations.getJumpAnimationState(e);this.anims.currentAnim?.key!==n&&this.play(n);const r=this.flipX?i*s:-i*s;this.setAngle(r)}update(){const e=this.inputController.getInputState(),n=this.body,i=n&&(n.blocked.down||n.touching.down);switch(this.inputController.hasAnyInput()&&!this.hasReceivedInput&&(this.hasReceivedInput=!0),this.hasReceivedInput&&this.inputController.hasAnyInput()&&!this.hasNotifiedMovement&&(this.hasNotifiedMovement=!0,Lr.set(!0)),e.left?(this.setVelocityX(-350),this.setFlipX(!0),i&&(this.animState="running")):e.right?(this.setVelocityX(xs.SPEED),this.setFlipX(!1),i&&(this.animState="running")):(this.setVelocityX(0),i&&(this.animState="idle")),e.jump&&i&&(this.setVelocityY(xs.JUMP_STRENGTH),this.animState="jumping"),!i&&n&&n.velocity.y!==0&&(this.animState="jumping"),this.animState){case"idle":this.animations.play(this,"idle"),this.setAngle(0);break;case"running":this.animations.play(this,"walk"),this.setAngle(0);break;case"jumping":this.updateJumpAnimation(n.velocity.y);break}}destroy(e){this.inputController.destroy(),super.destroy(e)}}const Xt=[{name:"FOREST",folder:"forest",scrollFactors:[1,.8,.85,.9,.95,1]},{name:"FOREST BLUE",folder:"forest_blue",scrollFactors:[1,.8,.85,.9,.95,1]}];class ja{currentIndex=0;constructor(){const e=localStorage.getItem("background");if(e){const n=Xt.findIndex(i=>i.folder===e);n!==-1&&(this.currentIndex=n)}}getBackground(){return Xt[this.currentIndex].folder}getCurrentConfig(){return Xt[this.currentIndex]}setBackground(e){const n=Xt.findIndex(i=>i.folder===e);n!==-1&&(this.currentIndex=n,localStorage.setItem("background",e))}toggleBackground(){this.currentIndex=(this.currentIndex+1)%Xt.length;const e=Xt[this.currentIndex];return localStorage.setItem("background",e.folder),e}getAllBackgrounds(){return Xt}}const ii=new ja;function Xr(t,e){return new Promise(n=>{t.load.image(`bg0-${e.folder}`,`assets/backgrounds/${e.folder}/0.png`);for(let i=0;i<e.scrollFactors.length;i++){const s=i+1;t.load.image(`bg${s}-${e.folder}`,`assets/backgrounds/${e.folder}/${s}.png`)}t.load.once("complete",()=>{n(!0)}),t.load.once("loaderror",i=>{console.error(`Failed to load background asset: ${i.key}`),n(!1)}),t.load.start()})}function Br(t,e,n,i){const s=Math.max(n,t.scale.height),r=t.add.tileSprite(0,0,e,s,`bg0-${i.folder}`);r.setOrigin(0,0),r.setScrollFactor(1),r.setDepth(Ye.BACKGROUND_BASE),r.tilePositionX=0,r.tilePositionY=0;const o=[];for(let l=0;l<i.scrollFactors.length;l++){const d=`bg${l+1}-${i.folder}`;if(t.textures.exists(d)){const u=t.add.image(0,0,d);u.setOrigin(0,0),u.setScrollFactor(i.scrollFactors[l]),u.setDepth(Ye.BACKGROUND_LAYER_START+l),u.setDisplaySize(e,n),o.push(u)}}return{baseLayer:r,bgLayers:o}}function Zr(t,e){t&&(t.tilePositionX=e.scrollX)}function Va(t){t.bgLayers.forEach(e=>e.destroy()),t.baseLayer.destroy()}const qa=[{code:"cs",label:"CZ"},{code:"en",label:"EN"}],Yr="cs",Ja={isActive:!1,config:null,selectedItemId:null,itemDepthLayer:"behind",editMode:"items",selectedDialogZoneId:null,selectedFrameId:null},j=J(Ja),Wr=He(j,t=>t.isActive),Qa=He(j,t=>t.config),pi=J(!0);function el(){pi.update(t=>!t)}const Rt=J(!1);function Dt(t){Rt.set(t)}const cn=J(!1),Zt=J(!1),Ji=J(!1);function tl(){cn.update(t=>!t)}function nl(){Zt.update(t=>!t)}function si(){Ji.set(!0)}function il(){Ji.set(!1)}const Qi=J(Yr);function sl(t){Qi.set(t)}const es=He(j,t=>t.selectedItemId),zr=He(j,t=>t.itemDepthLayer),Re=He(j,t=>t.editMode),vi=He(j,t=>t.selectedDialogZoneId),ts=He(j,t=>t.config?.dialogZones||[]),mi=He(j,t=>t.selectedFrameId),Gr=He(j,t=>t.config?.placedFrames||[]),ns=J(new Map);function rl(t,e,n){ns.update(i=>{const s=new Map(i);return s.set(t,{x:e,y:n}),s})}function ol(t){ns.update(e=>{const n=new Map(e);return n.delete(t),n})}const Kr=J(null);function Ei(t){Kr.set(t)}const al=He(j,t=>!t.selectedFrameId||!t.config?.placedFrames?null:t.config.placedFrames.find(e=>e.id===t.selectedFrameId)??null),Ur=J(null);function xi(t){Ur.set(t)}const jr=J(null);function Zn(t){jr.set(t)}const is=J(!1);function Vr(){is.set(!0)}function Is(){is.set(!1)}const ss=He(j,t=>!t.selectedItemId||!t.config?.placedItems?null:t.config.placedItems.find(e=>e.id===t.selectedItemId)??null),ll=He(ss,t=>t?.physicsEnabled??!1),cl=He(ss,t=>t?.flipX??!1);function Cs(t,e){j.update(n=>n.config?{...n,config:{...n.config,playerStartX:t,playerStartY:e}}:n)}function dl(t){j.update(e=>{if(!e.config)return e;const n=e.config.placedItems||[];return{...e,config:{...e.config,placedItems:[...n,t]}}})}function On(t,e){j.update(n=>!n.config||!n.config.placedItems?n:{...n,config:{...n.config,placedItems:n.config.placedItems.map(i=>i.id===t?{...i,...e}:i)}})}function qr(t){j.update(e=>!e.config||!e.config.placedItems?e:{...e,config:{...e.config,placedItems:e.config.placedItems.filter(n=>n.id!==t)},selectedItemId:e.selectedItemId===t?null:e.selectedItemId})}function ri(t){j.update(e=>({...e,selectedItemId:t}))}function rs(){j.update(t=>({...t,selectedItemId:null}))}function ul(){j.update(t=>({...t,itemDepthLayer:t.itemDepthLayer==="behind"?"front":"behind"}))}function hl(t,e){On(t,{depth:e})}function fl(t,e){e?(On(t,{physicsEnabled:e,depth:qi("behind")}),j.update(n=>({...n,itemDepthLayer:"behind"}))):On(t,{physicsEnabled:e})}function gl(t,e){On(t,{flipX:e})}function pl(t){j.set({isActive:!0,config:{...t,placedItems:t.placedItems||[],dialogZones:t.dialogZones||[],placedFrames:t.placedFrames||[]},selectedItemId:null,itemDepthLayer:"behind",editMode:"items",selectedDialogZoneId:null,selectedFrameId:null}),yn.set(!1)}function vl(){j.update(t=>{const e=t.config?{...t.config,dialogZones:(t.config.dialogZones||[]).filter(n=>n.texts.some(i=>i.title.trim()!==""||i.content.trim()!==""))}:t.config;return{...t,isActive:!1,selectedItemId:null,config:e}}),yn.set(!1)}function ml(){return Vt(j).config}const yn=J(!1);function Ds(t){yn.set(t)}const bn=J({scrollX:0,scrollY:0,viewWidth:0,viewHeight:0,worldWidth:0,worldHeight:0,zoom:1,playerX:0,playerY:0});function _l(t){bn.update(e=>({...e,...t}))}function Yn(t){j.update(e=>({...e,editMode:t,selectedItemId:null,selectedDialogZoneId:null}))}function Ts(t){j.update(e=>{if(!e.config)return e;const n=e.config.dialogZones||[];return{...e,config:{...e.config,dialogZones:[...n,t]}}})}function sn(t,e){j.update(n=>!n.config||!n.config.dialogZones?n:{...n,config:{...n.config,dialogZones:n.config.dialogZones.map(i=>i.id===t?{...i,...e}:i)}})}function Jr(t){j.update(e=>!e.config||!e.config.dialogZones?e:{...e,config:{...e.config,dialogZones:e.config.dialogZones.filter(n=>n.id!==t)},selectedDialogZoneId:e.selectedDialogZoneId===t?null:e.selectedDialogZoneId})}function xn(t){j.update(e=>({...e,selectedDialogZoneId:t}))}function ks(t,e,n){j.update(i=>!i.config||!i.config.dialogZones?i:{...i,config:{...i.config,dialogZones:i.config.dialogZones.map(s=>{if(s.id!==t)return s;const r=s.texts.findIndex(l=>l.language===e);let o;return r>=0?o=s.texts.map((l,a)=>a===r?{...l,...n}:l):o=[...s.texts,{language:e,title:"",content:"",...n}],{...s,texts:o}})}})}function yl(t){j.update(e=>{if(!e.config)return e;const n=e.config.placedFrames||[];return{...e,config:{...e.config,placedFrames:[...n,t]}}})}function vt(t,e){j.update(n=>!n.config||!n.config.placedFrames?n:{...n,config:{...n.config,placedFrames:n.config.placedFrames.map(i=>i.id===t?{...i,...e}:i)}})}function os(t){j.update(e=>!e.config||!e.config.placedFrames?e:{...e,config:{...e.config,placedFrames:e.config.placedFrames.filter(n=>n.id!==t)},selectedFrameId:e.selectedFrameId===t?null:e.selectedFrameId})}function an(t){j.update(e=>({...e,selectedFrameId:t}))}const as=[{key:"tent",name:"Tent",path:"assets/ui/tent.png",scale:6,category:"structures"},{key:"lamp",name:"Lamp",path:"assets/ui/lamp.png",scale:8,category:"props"},{key:"sign_left",name:"Sign ←",path:"assets/ui/sign_left.png",scale:7,category:"signs"},{key:"sign_right",name:"Sign →",path:"assets/ui/sign_right.png",scale:7,category:"signs"},{key:"stone_0",name:"Stone 0",path:"assets/ui/stone_0.png",scale:4,category:"nature",supportsPhysics:!0},{key:"stone_1",name:"Stone 1",path:"assets/ui/stone_1.png",scale:5,category:"nature",supportsPhysics:!0},{key:"stone_2",name:"Stone 2",path:"assets/ui/stone_2.png",scale:4,category:"nature",supportsPhysics:!0}];function Qr(t){return as.find(e=>e.key===t)}function bl(t){return Qr(t)?.scale||1}function wl(t){return Qr(t)?.supportsPhysics??!1}class As{scene;groundY;constructor(e,n){this.scene=e,this.groundY=n}static preloadAssets(e){as.forEach(n=>{e.load.image(n.key,n.path)})}createSprite(e){const{id:n,assetKey:i,x:s,scale:r=1,depth:o=5,yOffset:l=0,flipX:a=!1}=e,d=this.groundY+l,u=this.scene.add.sprite(s,d,i);return u.setScale(r),u.setDepth(o),u.setFlipX(a),u.setData("itemId",n),u}updatePosition(e,n,i){e.x=n,e.y=this.groundY+i}updateScale(e,n){e.setScale(n)}updateDepth(e,n){e.setDepth(n)}applyUpdates(e,n){n.x!==void 0&&(e.x=n.x),n.yOffset!==void 0&&(e.y=this.groundY+n.yOffset),n.scale!==void 0&&e.setScale(n.scale),n.depth!==void 0&&e.setDepth(n.depth),n.flipX!==void 0&&e.setFlipX(n.flipX)}worldYToOffset(e){return e-this.groundY}getGroundY(){return this.groundY}}const oi=40,Sl=48,$s=5,El=Ye.PLAYER,pn=50,xl=4871528,Il=.4,Cl=1,eo=Ye.GRID_OVERLAY,Ii=16711680,Dl=2,Tl=.6,kl=.1,Al=1,$l=.2,Ps=50,Pl=50,Ml=10,Ol=4886754;function Ms(t,e){return Math.round(t/e)*e}class Ll{scene;groundY;isDragging=!1;callbacks;constructor(e,n,i={}){this.scene=e,this.groundY=n,this.callbacks=i}getIsDragging(){return this.isDragging}makeInteractive(e,n){e.setInteractive({cursor:"pointer"}),this.scene.input.setDraggable(e),e.on("pointerdown",()=>{this.isDragging||ri(n)}),e.on("dragstart",()=>{this.isDragging=!1,e.setTint(4886754),this.scene.data?.set("isDraggingItem",!0),Dt(!0),this.callbacks.onDragStart?.(n)}),e.on("drag",(i,s,r)=>{this.isDragging=!0;const o=Vt(pi),l=o?Ms(s,pn):s,a=o?Ms(r,pn):r;e.setPosition(l,a),this.callbacks.onDrag?.(n,l,a)}),e.on("dragend",()=>{e.clearTint(),this.scene.data?.set("isDraggingItem",!1),Dt(!1);const i=Math.round(e.x),r=Math.round(e.y)-this.groundY;On(n,{x:i,yOffset:r}),this.callbacks.onDragEnd?.(n,i,r),this.scene.time.delayedCall(50,()=>{this.isDragging=!1})})}removeInteractivity(e){!e||!e.scene||(e.removeInteractive(),e.off("pointerdown"),e.off("dragstart"),e.off("drag"),e.off("dragend"))}}const Rl={lineWidth:3,lineColor:4886754,lineAlpha:1,handleSize:8,handleColor:4886754,padding:5};class Fl{scene;graphics;style;selectedId=null;constructor(e,n={}){this.scene=e,this.style={...Rl,...n},this.graphics=e.add.graphics(),this.graphics.setDepth(Ye.SELECTION_GRAPHICS)}setSelectedId(e){this.selectedId=e}getSelectedId(){return this.selectedId}updateVisuals(e){if(this.graphics.clear(),!e||!this.selectedId)return;const n=e.getBounds(),{lineWidth:i,lineColor:s,lineAlpha:r,handleSize:o,handleColor:l,padding:a}=this.style;this.graphics.lineStyle(i,s,r),this.graphics.strokeRect(n.x-a,n.y-a,n.width+a*2,n.height+a*2),this.graphics.fillStyle(l,1),this.graphics.fillCircle(n.x,n.y,o),this.graphics.fillCircle(n.x+n.width,n.y,o),this.graphics.fillCircle(n.x,n.y+n.height,o),this.graphics.fillCircle(n.x+n.width,n.y+n.height,o)}clearVisuals(){this.graphics.clear(),this.selectedId=null}setupBackgroundDeselect(e){this.scene.input.on("pointerdown",n=>{if(e())return;this.scene.input.hitTestPointer(n).find(s=>s.type==="Sprite"&&s.getData("itemId"))||(rs(),this.clearVisuals())})}destroy(){this.graphics?.destroy()}}class ai{scene;items=new Map;isBuilderMode=!1;physicsGroup=null;renderer;dragController;selectionManager;constructor(e,n,i=!1){this.scene=e,this.isBuilderMode=i,this.renderer=new As(e,n),i||(this.physicsGroup=e.physics.add.staticGroup()),this.isBuilderMode&&(this.dragController=new Ll(e,n,{onDrag:()=>this.updateSelectionVisuals()}),this.selectionManager=new Fl(e))}static preloadAssets(e){As.preloadAssets(e)}createItems(e){e.forEach(n=>{this.createItem(n)})}createItem(e){const n=this.renderer.createSprite(e),i={sprite:n,data:e};if(!this.isBuilderMode&&e.physicsEnabled&&this.physicsGroup){const s=this.createPhysicsBody(n,e);i.physicsBody=s}this.items.set(e.id,i),this.isBuilderMode&&this.dragController&&(this.dragController.makeInteractive(n,e.id),n.on("pointerdown",()=>{this.dragController?.getIsDragging()||(ri(e.id),this.updateSelectionVisuals())}))}createPhysicsBody(e,n){const i=e.getBounds(),s=i.width*.5,r=i.height*.8,o=e.x,l=e.y,a=this.scene.add.rectangle(o,l,s,r);return a.setVisible(!1),this.physicsGroup.add(a),a.setData("itemId",n.id),a}updateSelectionVisuals(){if(!this.selectionManager)return;const e=this.scene.data.get("selectedItemId");if(this.selectionManager.setSelectedId(e),!e){this.selectionManager.clearVisuals(),Ei(null);return}const n=this.items.get(e);if(this.selectionManager.updateVisuals(n?.sprite??null),n?.sprite){const i=this.scene.cameras.main,s=n.sprite.getBounds(),r=(s.centerX-i.scrollX)*i.zoom,o=(s.centerY-i.scrollY)*i.zoom,l=s.height*i.zoom;Ei({screenX:r,screenY:o,itemHeight:l})}else Ei(null)}updateItem(e,n){const i=this.items.get(e);i&&(this.renderer.applyUpdates(i.sprite,n),i.data={...i.data,...n})}removeItem(e){const n=this.items.get(e);n&&(this.dragController&&this.dragController.removeInteractivity(n.sprite),n.physicsBody&&n.physicsBody.destroy(),n.sprite.destroy(),this.items.delete(e))}removeAllItems(){this.items.forEach(e=>{!e.sprite||!e.sprite.scene||(this.dragController&&this.dragController.removeInteractivity(e.sprite),e.physicsBody&&e.physicsBody.destroy(),e.sprite.destroy())}),this.items.clear()}getItem(e){return this.items.get(e)?.data}getAllItems(){return Array.from(this.items.values()).map(e=>e.data)}getPhysicsGroup(){return this.physicsGroup}setInteractiveEnabled(e){!this.isBuilderMode||!this.dragController||(this.items.forEach(({sprite:n,data:i})=>{e?(this.dragController.makeInteractive(n,i.id),n.setAlpha(1),n.on("pointerdown",()=>{this.dragController?.getIsDragging()||(ri(i.id),this.updateSelectionVisuals())})):(n.disableInteractive(),n.off("pointerdown"),n.setAlpha(.6))}),!e&&this.selectionManager&&this.selectionManager.clearVisuals())}destroy(){this.removeAllItems(),this.selectionManager?.destroy()}setupBackgroundDeselect(){!this.isBuilderMode||!this.selectionManager||this.selectionManager.setupBackgroundDeselect(()=>this.dragController?.getIsDragging()??!1)}}function Hl(){return`frame_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const Nl=["#ffffff","#f8f8f8","#fffacd","#ffefd5","#ffe4e1","#e6e6fa","#f0fff0","#f5fffa","#fff0f5","#f0f8ff","#2d2d2d","#1a1a2e","#16213e","#1a1a1a","#2d132c","#1e3a3a","#3d1a1a","#1a2f1a","#3d3d1a","#2a1a3d"],Xl=["#333333","#000000","#ffffff","#1a1a1a","#666666","#8b4513","#2c3e50","#c0392b","#27ae60","#2980b9","#8e44ad","#f39c12"],Bl=[12,14,16,18,20,24,28,32],to={S:{label:"Small",scale:3},M:{label:"Medium",scale:4},L:{label:"Large",scale:5}};function Zl(t){return to[t].scale}function Yl(t){return t<=3?"S":t>=5?"L":"M"}const yt=4,In="#ffffff",no="#333333",Kn=16,Wl=64,zl=96,Gl=.06,Os=32,li=[{key:"base_1",name:"Frame 1",path:"assets/frames/base 1.png",scale:4},{key:"base_2",name:"Frame 2",path:"assets/frames/base 2.png",scale:4},{key:"base_3",name:"Frame 3",path:"assets/frames/base 3.png",scale:4},{key:"base_4",name:"Frame 4",path:"assets/frames/base 4.png",scale:4},{key:"base_5",name:"Frame 5",path:"assets/frames/base 5.png",scale:4},{key:"base_6",name:"Frame 6",path:"assets/frames/base 6.png",scale:4},{key:"base_7",name:"Frame 7",path:"assets/frames/base 7.png",scale:4},{key:"base_8",name:"Frame 8",path:"assets/frames/base 8.png",scale:4},{key:"base_9",name:"Frame 9",path:"assets/frames/base 9.png",scale:4},{key:"base_10",name:"Frame 10",path:"assets/frames/base 10.png",scale:4},{key:"base_11",name:"Frame 11",path:"assets/frames/base 11.png",scale:4},{key:"base_12",name:"Frame 12",path:"assets/frames/base 12.png",scale:4},{key:"base_13",name:"Frame 13",path:"assets/frames/base 13.png",scale:4},{key:"base_14",name:"Frame 14",path:"assets/frames/base 14.png",scale:4},{key:"base_15",name:"Frame 15",path:"assets/frames/base 15.png",scale:4},{key:"base_16",name:"Frame 16",path:"assets/frames/base 16.png",scale:4},{key:"base_17",name:"Frame 17",path:"assets/frames/base 17.png",scale:4},{key:"base_18",name:"Frame 18",path:"assets/frames/base 18.png",scale:4},{key:"base_19",name:"Frame 19",path:"assets/frames/base 19.png",scale:4},{key:"base_20",name:"Frame 20",path:"assets/frames/base 20.png",scale:4},{key:"base_21",name:"Frame 21",path:"assets/frames/base 21.png",scale:4},{key:"base_22",name:"Frame 22",path:"assets/frames/base 22.png",scale:4},{key:"base_23",name:"Frame 23",path:"assets/frames/base 23.png",scale:4},{key:"base_24",name:"Frame 24",path:"assets/frames/base 24.png",scale:4},{key:"base_25",name:"Frame 25",path:"assets/frames/base 25.png",scale:4}];function Kl(t){return li.find(e=>e.key===t)}function Ul(t){return Kl(t)?.scale??yt}function Tn(t=yt,e=!1){const n=Wl*t,i=zl*t,s=e?i:n,r=e?n:i,o=Math.min(n,i)*Gl,l=s-o*2,a=r-o*2,d=l-Os*2,u=a-Os*2;return{frameWidth:s,frameHeight:r,innerWidth:l,innerHeight:a,textWidth:d,textHeight:u}}function Un(t,e,n,i,s,r,o=4){t.clear();const l=parseInt(r.replace("#",""),16);t.fillStyle(l,1),t.fillRoundedRect(e-i/2,n-s/2,i,s,o)}class jl{lastClickTime=0;lastClickedId=null;threshold;constructor(e=300){this.threshold=e}check(e){const n=Date.now();return this.lastClickedId===e&&n-this.lastClickTime<this.threshold?(this.reset(),!0):(this.lastClickTime=n,this.lastClickedId=e,!1)}reset(){this.lastClickTime=0,this.lastClickedId=null}}class Ls{scene;frames=new Map;constructor(e){this.scene=e}static preloadAssets(e){for(let n=1;n<=25;n++)e.load.image(`frame_base_${n}`,`assets/frames/base ${n}.png`)}createFrames(e){e.forEach(n=>{this.createFrame(n)})}createFrame(e){const n=`frame_${e.frameKey}`;if(!this.scene.textures.exists(n)){console.warn(`[GameFrameManager] Frame texture not found: ${n}`);return}const i=e.scale??yt,s=e.depth??Ye.ITEMS_FRONT,r=(e.rotation??0)*(Math.PI/180),o=e.rotation===90,{innerWidth:l,innerHeight:a}=Tn(i,o),d=this.scene.add.graphics();d.setDepth(s-.1),Un(d,e.x,e.y,l,a,e.backgroundColor||In);const u=this.scene.add.sprite(e.x,e.y,n);u.setScale(i),u.setDepth(s),u.setOrigin(.5,.5),u.setRotation(r);const h={sprite:u,background:d,data:e};this.frames.set(e.id,h),e.url&&this.makeClickable(h)}makeClickable(e){const{sprite:n,data:i}=e;n.setInteractive({useHandCursor:!0}),n.on("pointerover",()=>{n.setScale((i.scale??yt)*1.05)}),n.on("pointerout",()=>{n.setScale(i.scale??yt)}),n.on("pointerdown",()=>{i.url&&(Ya(),window.open(i.url,"_blank","noopener,noreferrer"))})}destroy(){this.frames.forEach(({sprite:e,background:n})=>{e.destroy(),n.destroy()}),this.frames.clear()}}async function Rs(){const t=await fetch("./config/map.json");if(!t.ok)throw new Error(`Failed to load map config: ${t.status}`);const e=await t.json();if(!e.worldWidth||!e.worldHeight)throw new Error("Invalid map config structure");return e}const jn={generateId(){return`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`},create(t){const{assetKey:e,x:n,yOffset:i=0,depthLayer:s="behind",scale:r}=t;return{id:jn.generateId(),assetKey:e,x:Math.round(n),y:0,scale:r??bl(e),depth:qi(s),yOffset:Math.round(i)}},createAtWorldPosition(t,e,n,i,s="behind"){return jn.create({assetKey:t,x:e,yOffset:n-i,depthLayer:s})},clone(t,e=50){return{...t,id:jn.generateId(),x:t.x+e}}},Bt={HEIGHT:40,VISUAL:{COLOR:9139029,ALPHA:.3},PHYSICS:{COLOR:0,ALPHA:0}},Ln={getGroundY(t,e=Bt.HEIGHT){return t-e},createVisualGround(t,e){const n=e.height??Bt.HEIGHT,i=Ln.getGroundY(e.worldHeight,n),s=t.add.rectangle(0,i,e.worldWidth,n,e.color??Bt.VISUAL.COLOR,e.alpha??Bt.VISUAL.ALPHA);return s.setOrigin(0,0),s.setDepth(e.depth??Ye.GROUND_REFERENCE),{ground:s,groundY:i}},createPhysicsGround(t,e){const n=e.height??Bt.HEIGHT,i=Ln.getGroundY(e.worldHeight,n),s=t.add.rectangle(0,i,e.worldWidth,n,e.color??Bt.PHYSICS.COLOR,e.alpha??Bt.PHYSICS.ALPHA);return s.setOrigin(0,0),t.physics.add.existing(s,!0),{ground:s,groundY:i}},addPlayerCollision(t,e,n){return t.physics.add.collider(e,n)}},bt={GAME:"GameScene",BUILDER:"BuilderScene"};class Vl extends B.Scene{player;mapConfig;parallaxLayers=null;loadedBackgrounds=new Set;itemManager;frameManager;dialogZones=[];currentDialogZone=null;unsubscribers=[];initData;constructor(){super({key:bt.GAME})}init(e){this.initData=e}preload(){pt.forEach(e=>{this.load.spritesheet(`cat-idle-${e}`,`assets/sprites/${e}/Idle.png`,{frameWidth:48,frameHeight:48}),this.load.spritesheet(`cat-walk-${e}`,`assets/sprites/${e}/Walk.png`,{frameWidth:48,frameHeight:48})}),ai.preloadAssets(this),Ls.preloadAssets(this)}create(){this.initializeScene()}async initializeScene(){Li.set(!0);try{await this.loadMapConfiguration();const e=ii.getCurrentConfig();await this.loadBackgroundIfNeeded(e),this.createParallaxBackground();const{ground:n,groundY:i}=Ln.createPhysicsGround(this,{worldWidth:this.mapConfig.worldWidth,worldHeight:this.mapConfig.worldHeight});this.player=new Ua(this,this.mapConfig.playerStartX,this.mapConfig.playerStartY),Ln.addPlayerCollision(this,this.player,n),this.itemManager=new ai(this,i,!1),this.mapConfig.placedItems&&this.mapConfig.placedItems.length>0&&this.itemManager.createItems(this.mapConfig.placedItems);const s=this.itemManager.getPhysicsGroup();s&&this.physics.add.collider(this.player,s),this.frameManager=new Ls(this),this.mapConfig.placedFrames&&this.mapConfig.placedFrames.length>0&&this.frameManager.createFrames(this.mapConfig.placedFrames),this.dialogZones=this.mapConfig.dialogZones||[];const r=ts.subscribe(o=>{this.dialogZones=o,this.recheckCurrentZone()});this.unsubscribers.push(r),this.cameras.main.startFollow(this.player,!0,.1,.1),this.cameras.main.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.physics.world.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.scale.on("resize",this.handleResize,this)}catch(e){console.error("[GameScene] Failed to initialize scene:",e)}finally{Li.set(!1)}}async loadMapConfiguration(){try{if(this.initData?.useBuilderConfig){const e=ml();this.mapConfig=e||await Rs()}else this.mapConfig=await Rs()}catch(e){console.error("[GameScene] Failed to load map configuration:",e),this.mapConfig={worldWidth:3200,worldHeight:600,playerStartX:400,playerStartY:300,placedItems:[]}}}createParallaxBackground(){const e=ii.getCurrentConfig();this.parallaxLayers=Br(this,this.mapConfig.worldWidth,this.mapConfig.worldHeight,e)}async loadBackgroundIfNeeded(e){if(this.loadedBackgrounds.has(e.folder))return!0;const n=await Xr(this,e);return n&&this.loadedBackgrounds.add(e.folder),n}handleResize(e){if(!(!this.cameras?.main||!this.mapConfig)&&(this.cameras.main.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.parallaxLayers?.baseLayer)){const n=Math.max(this.mapConfig.worldHeight,e.height);this.parallaxLayers.baseLayer.setSize(this.mapConfig.worldWidth,n)}}shutdown(){this.scale.off("resize",this.handleResize,this),Si(null),this.currentDialogZone=null,this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.itemManager&&this.itemManager.destroy()}update(){if(!this.player)return;this.player.update();const e=this.cameras.main,n=this.player.x-e.scrollX,i=this.player.y-e.scrollY;Ba(n,i),Za(e.scrollX,e.scrollY,e.zoom),this.checkDialogZones(),this.parallaxLayers&&Zr(this.parallaxLayers.baseLayer,this.cameras.main)}checkDialogZones(){const e=this.player.x;let n=null;for(const i of this.dialogZones)if(e>=i.x&&e<=i.x+i.width){n=i;break}n?.id!==this.currentDialogZone?.id&&(this.currentDialogZone=n,Si(n))}recheckCurrentZone(){if(!this.currentDialogZone)return;const e=this.dialogZones.find(n=>n.id===this.currentDialogZone?.id);e&&(this.currentDialogZone=e,Si(e))}}let io=!1;function Wn(t){io=t}function Fs(){return io}function kn(){const t=document.activeElement;if(!t)return!1;const e=t.tagName.toUpperCase();return e==="INPUT"||e==="TEXTAREA"||t.getAttribute("contenteditable")==="true"}const ql=.05,Jl=1,zn=400;class Ql{scene;camera;worldWidth;worldHeight;isPanning=!1;panStartX=0;panStartY=0;cameraDragStartX=0;cameraDragStartY=0;isDraggingToScroll=!1;dragScrollStartX=0;dragScrollStartY=0;dragScrollCameraStartX=0;dragScrollCameraStartY=0;isZoomedOut=!1;isAnimating=!1;savedScrollX=0;savedScrollY=0;constructor(e,n,i){this.scene=e,this.camera=e.cameras.main,this.worldWidth=n,this.worldHeight=i}setup(){this.setupCamera(),this.setupMouseControls(),this.setupKeyboardControls()}setupCamera(){this.camera.setBounds(0,0,this.worldWidth,this.worldHeight),this.camera.setZoom(1)}centerOn(e,n){this.camera.centerOn(e,n)}setupMouseControls(){this.scene.input.on("wheel",(e,n,i,s)=>{if(this.isZoomedOut)return;const r=this.camera.scrollX+i,o=this.camera.scrollY+s;this.camera.setScroll(B.Math.Clamp(r,0,this.worldWidth-this.camera.width),B.Math.Clamp(o,0,this.worldHeight-this.camera.height))}),this.scene.input.on("pointerdown",e=>{this.isZoomedOut||Fs()||(e.rightButtonDown()||e.middleButtonDown()?(this.isPanning=!0,this.panStartX=e.x,this.panStartY=e.y,this.cameraDragStartX=this.camera.scrollX,this.cameraDragStartY=this.camera.scrollY):e.leftButtonDown()&&!this.isDraggingObject()&&(this.scene.data.get("isDraggingItem")===!0||(this.dragScrollStartX=e.x,this.dragScrollStartY=e.y,this.dragScrollCameraStartX=this.camera.scrollX,this.dragScrollCameraStartY=this.camera.scrollY)))}),this.scene.input.on("pointermove",e=>{if(!(this.isZoomedOut||Fs())){if(this.isPanning){const n=e.x-this.panStartX,i=e.y-this.panStartY,s=this.cameraDragStartX-n,r=this.cameraDragStartY-i;this.camera.setScroll(B.Math.Clamp(s,0,this.worldWidth-this.camera.width),B.Math.Clamp(r,0,this.worldHeight-this.camera.height))}else if(e.leftButtonDown()&&!this.isDraggingToScroll&&!this.isDraggingObject()&&!(this.scene.data.get("isDraggingItem")===!0)){const i=Math.abs(e.x-this.dragScrollStartX),s=Math.abs(e.y-this.dragScrollStartY);Math.sqrt(i*i+s*s)>10&&(this.isDraggingToScroll=!0,this.scene.input.setDefaultCursor("grabbing"))}if(this.isDraggingToScroll){const n=e.x-this.dragScrollStartX,i=e.y-this.dragScrollStartY,s=this.dragScrollCameraStartX-n,r=this.dragScrollCameraStartY-i;this.camera.setScroll(B.Math.Clamp(s,0,this.worldWidth-this.camera.width),B.Math.Clamp(r,0,this.worldHeight-this.camera.height))}}}),this.scene.input.on("pointerup",e=>{!e.rightButtonDown()&&!e.middleButtonDown()&&(this.isPanning=!1),this.isDraggingToScroll&&(this.isDraggingToScroll=!1,this.scene.input.setDefaultCursor("default"))})}setupKeyboardControls(){const e={up:this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.UP,!1),down:this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.DOWN,!1),left:this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.LEFT,!1),right:this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.RIGHT,!1)},n={w:this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.W,!1),a:this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.A,!1),s:this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.S,!1),d:this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.D,!1)};this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.SPACE,!1).on("down",()=>{kn()||this.isZoomedOut||this.centerOnPlayer()}),this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.F,!1).on("down",()=>{kn()||this.toggleZoomToFit()}),this.scene.events.on("update",()=>{if(this.isZoomedOut||kn())return;const r=10;e.left.isDown||n.a.isDown?this.camera.scrollX=Math.max(0,this.camera.scrollX-r):(e.right.isDown||n.d.isDown)&&(this.camera.scrollX=Math.min(this.worldWidth-this.camera.width,this.camera.scrollX+r)),e.up.isDown||n.w.isDown?this.camera.scrollY=Math.max(0,this.camera.scrollY-r):(e.down.isDown||n.s.isDown)&&(this.camera.scrollY=Math.min(this.worldHeight-this.camera.height,this.camera.scrollY+r))})}centerOnPlayer(){const e=this.scene.data.get("playerSprite");e&&this.camera.centerOn(e.x,e.y)}isDraggingObject(){return this.scene.data.get("isDraggingObject")===!0}getIsZoomedOut(){return this.isZoomedOut}toggleZoomToFit(){this.isZoomedOut?this.resetZoom():this.zoomToFit()}zoomToFit(){if(this.isZoomedOut||this.isAnimating)return;this.savedScrollX=this.camera.scrollX,this.savedScrollY=this.camera.scrollY,this.isZoomedOut=!0,this.isAnimating=!0,Ds(!0);const e=this.camera.width/this.worldWidth,n=this.camera.height/this.worldHeight;let i=Math.min(e,n);i=Math.max(i,ql);const s=this.worldWidth/2,r=this.worldHeight/2;this.camera.removeBounds(),this.camera.pan(s,r,zn,"Sine.easeInOut"),this.camera.zoomTo(i,zn,"Sine.easeInOut",!1,(o,l)=>{l===1&&(this.isAnimating=!1)})}resetZoom(){if(!this.isZoomedOut||this.isAnimating)return;this.isZoomedOut=!1,this.isAnimating=!0,Ds(!1);const e=this.savedScrollX+this.camera.width/2,n=this.savedScrollY+this.camera.height/2;this.camera.pan(e,n,zn,"Sine.easeInOut"),this.camera.zoomTo(Jl,zn,"Sine.easeInOut",!1,(i,s)=>{s===1&&(this.camera.setBounds(0,0,this.worldWidth,this.worldHeight),this.isAnimating=!1)})}destroy(){}}class ec{scene;player;worldWidth;worldHeight;groundY;unsubscribers=[];constructor(e,n,i){this.scene=e,this.worldWidth=n,this.worldHeight=i,this.groundY=i-oi}create(e,n){this.player=this.scene.add.sprite(e,n,"cat-idle-white",0),this.player.setScale($s),this.player.setDepth(El);const i=new B.Geom.Rectangle(8,4,32,40);return this.player.setInteractive({hitArea:i,hitAreaCallback:B.Geom.Rectangle.Contains,draggable:!0,cursor:"grab"}),this.scene.data.set("playerSprite",this.player),this.setupDragHandlers(),this.setupEditModeSubscription(),this.player}setupEditModeSubscription(){const e=Re.subscribe(n=>{if(n==="dialogs")this.player.disableInteractive(),this.player.setAlpha(.6);else{const i=new B.Geom.Rectangle(8,4,32,40);this.player.setInteractive({hitArea:i,hitAreaCallback:B.Geom.Rectangle.Contains,draggable:!0,cursor:"grab"}),this.player.setAlpha(1)}});this.unsubscribers.push(e)}setupDragHandlers(){this.player.on("dragstart",()=>{this.player.setTint(Ol),this.scene.data.set("isDraggingObject",!0)}),this.player.on("drag",(e,n,i)=>{const s=B.Math.Clamp(n,Ps,this.worldWidth-Ps),r=B.Math.Clamp(i,Pl,this.worldHeight-Ml);this.player.setPosition(s,r),Cs(Math.round(s),Math.round(r))}),this.player.on("dragend",()=>{this.player.clearTint(),this.scene.data.set("isDraggingObject",!1);let e=this.player.y;const n=Sl*$s;this.player.y+n/2>this.groundY&&(e=this.groundY-n/2,this.player.setY(e)),Cs(Math.round(this.player.x),Math.round(e))})}getSprite(){return this.player}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.player&&this.player.destroy()}}class tc{scene;graphics;worldWidth;worldHeight;constructor(e,n,i){this.scene=e,this.worldWidth=n,this.worldHeight=i}create(){return this.graphics=this.scene.add.graphics(),this.graphics.setDepth(eo),this.draw(),this.graphics}draw(){this.graphics.clear(),this.graphics.lineStyle(Cl,xl,Il);const e=Math.max(this.worldHeight,this.scene.scale.height);for(let i=0;i<=this.worldWidth;i+=pn)this.graphics.beginPath(),this.graphics.moveTo(i,0),this.graphics.lineTo(i,e),this.graphics.strokePath();for(let i=0;i<=e;i+=pn)this.graphics.beginPath(),this.graphics.moveTo(0,i),this.graphics.lineTo(this.worldWidth,i),this.graphics.strokePath();const n=this.worldHeight-oi;this.graphics.lineStyle(Dl,Ii,Tl),this.graphics.beginPath(),this.graphics.moveTo(0,n),this.graphics.lineTo(this.worldWidth,n),this.graphics.strokePath(),this.graphics.lineStyle(Al,Ii,$l),this.graphics.fillStyle(Ii,kl),this.graphics.fillRect(0,n,this.worldWidth,e-n)}getGraphics(){return this.graphics}redraw(){this.draw()}destroy(){this.graphics&&this.graphics.destroy()}}class nc{listeners=new Map;on(e,n){this.listeners.has(e)||this.listeners.set(e,new Set);const i=this.listeners.get(e);return i.add(n),{unsubscribe:()=>{i.delete(n),i.size===0&&this.listeners.delete(e)}}}once(e,n){const i=this.on(e,s=>{i.unsubscribe(),n(s)});return i}emit(e,n){const i=this.listeners.get(e);i&&i.forEach(s=>{try{s(n)}catch(r){console.error(`[EventBus] Error in listener for "${e}":`,r)}})}off(e){this.listeners.delete(e)}clear(){this.listeners.clear()}listenerCount(e){return this.listeners.get(e)?.size??0}}const we=new nc,Se={ASSET_DROPPED:"asset:dropped",FRAME_DROPPED:"frame:dropped",MINIMAP_NAVIGATE:"minimap:navigate",DIALOG_ZONE_CREATE:"dialogZone:create",DIALOG_ZONE_CREATE_AT:"dialogZone:createAt",TEMP_ZONE_BUTTON_SHOW:"tempZoneButton:show",TEMP_ZONE_BUTTON_HIDE:"tempZoneButton:hide"};class ic{scene;groundY;itemManager;unsubscribers=[];constructor(e,n){this.scene=e,this.groundY=n}create(e){return this.itemManager=new ai(this.scene,this.groundY,!0),e&&e.length>0&&this.itemManager.createItems(e),this.setupBackgroundDeselect(),this.setupStoreSubscriptions(),this.setupAssetDropListener(),this.setupDeleteKeys(),this.itemManager}setupBackgroundDeselect(){this.itemManager.setupBackgroundDeselect()}setupStoreSubscriptions(){const e=es.subscribe(r=>{this.scene.data.set("selectedItemId",r),this.itemManager.updateSelectionVisuals()});this.unsubscribers.push(e);const n=Re.subscribe(r=>{r==="dialogs"?(rs(),this.itemManager.setInteractiveEnabled(!1)):this.itemManager.setInteractiveEnabled(!0)});this.unsubscribers.push(n);let i=[];const s=Qa.subscribe(r=>{if(!r?.placedItems)return;const o=r.placedItems;i.forEach(l=>{o.find(d=>d.id===l.id)||this.itemManager.removeItem(l.id)}),o.forEach(l=>{const a=i.find(d=>d.id===l.id);a&&JSON.stringify(a)!==JSON.stringify(l)&&this.itemManager.updateItem(l.id,l)}),i=o.map(l=>({...l}))});this.unsubscribers.push(s)}setupAssetDropListener(){const e=we.on(Se.ASSET_DROPPED,n=>{const{assetKey:i,canvasX:s,canvasY:r}=n,l=this.scene.cameras.main.getWorldPoint(s,r),a=l.x,d=l.y;let u="behind";zr.subscribe(g=>{u=g})();const f=jn.createAtWorldPosition(i,a,d,this.groundY,u);dl(f),this.itemManager.createItem(f),ri(f.id)});this.unsubscribers.push(()=>e.unsubscribe())}setupDeleteKeys(){const e=this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.DELETE,!1),n=this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.BACKSPACE,!1),i=()=>{if(kn())return;const s=this.scene.data.get("selectedItemId");s&&qr(s)};e.on("down",i),n.on("down",i)}getManager(){return this.itemManager}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.itemManager&&this.itemManager.destroy()}}function Hs(t,e){return Math.round(t/e)*e}class Ns{scene;frames=new Map;unsubscribers=[];selectionGraphics=null;isDragging=!1;dragStartX=0;dragStartY=0;doubleClickDetector=new jl;constructor(e){this.scene=e}static preloadAssets(e){for(let n=1;n<=25;n++)e.load.image(`frame_base_${n}`,`assets/frames/base ${n}.png`)}create(e){this.selectionGraphics=this.scene.add.graphics(),this.selectionGraphics.setDepth(Ye.SELECTION_GRAPHICS),e&&e.length>0&&e.forEach(n=>this.createFrame(n)),this.setupBackgroundDeselect(),this.setupStoreSubscriptions(),this.setupFrameDropListener(),this.setupDeleteKeys()}createFrame(e){const n=`frame_${e.frameKey}`;if(!this.scene.textures.exists(n)){console.warn(`Frame texture not found: ${n}`);return}const i=e.scale??yt,s=e.depth??Ye.ITEMS_FRONT,r=(e.rotation??0)*(Math.PI/180),o=e.rotation===90,{innerWidth:l,innerHeight:a}=Tn(i,o),d=this.scene.add.graphics();d.setDepth(s-.1),Un(d,e.x,e.y,l,a,e.backgroundColor||In);const u=this.scene.add.sprite(e.x,e.y,n);u.setScale(i),u.setDepth(s),u.setOrigin(.5,.5),u.setRotation(r);const h={sprite:u,background:d,data:e};this.frames.set(e.id,h),this.makeInteractive(h,e.id)}updateFrameVisuals(e){const{sprite:n,background:i,data:s}=e,r=`frame_${s.frameKey}`;n.texture.key!==r&&this.scene.textures.exists(r)&&n.setTexture(r);const o=s.scale??yt;n.setScale(o);const l=(s.rotation??0)*(Math.PI/180);n.setRotation(l);const a=s.rotation===90,{innerWidth:d,innerHeight:u}=Tn(o,a);Un(i,n.x,n.y,d,u,s.backgroundColor||In)}moveContainer(e,n,i){const{sprite:s,background:r,data:o}=e;s.setPosition(n,i);const l=o.scale??yt,a=o.rotation===90,{innerWidth:d,innerHeight:u}=Tn(l,a);Un(r,n,i,d,u,o.backgroundColor||In)}makeInteractive(e,n){const{sprite:i}=e;i.setInteractive({draggable:!0,useHandCursor:!0}),i.on("pointerdown",s=>{if(!this.isDragging){if(an(n),this.updateSelectionVisuals(),this.doubleClickDetector.check(n)){si();return}this.isDragging=!0,this.scene.data.set("isDraggingItem",!0),Dt(!0),this.dragStartX=i.x-s.worldX,this.dragStartY=i.y-s.worldY}}),i.on("pointermove",s=>{if(!this.isDragging)return;if(!s.isDown){this.isDragging=!1;return}let r=s.worldX+this.dragStartX,o=s.worldY+this.dragStartY;Vt(pi)&&(r=Hs(r,pn),o=Hs(o,pn)),this.moveContainer(e,r,o),this.updateSelectionVisuals(),rl(n,r,o)}),i.on("pointerup",()=>{this.isDragging&&(this.isDragging=!1,this.scene.data.set("isDraggingItem",!1),Dt(!1),ol(n),e.data.x=Math.round(i.x),e.data.y=Math.round(i.y),vt(n,{x:e.data.x,y:e.data.y}))})}setupBackgroundDeselect(){this.scene.input.on("pointerdown",e=>{let n="items";if(Re.subscribe(o=>n=o)(),n!=="frames"&&n!=="items")return;!this.scene.input.hitTestPointer(e).some(o=>{for(const[l,a]of this.frames)if(a.sprite===o)return!0;return!1})&&!this.isDragging&&(an(null),this.updateSelectionVisuals())})}setupStoreSubscriptions(){const e=mi.subscribe(r=>{this.scene.data.set("selectedFrameId",r),this.updateSelectionVisuals()});this.unsubscribers.push(e);const n=Re.subscribe(r=>{r==="dialogs"?(an(null),this.setInteractiveEnabled(!1)):this.setInteractiveEnabled(!0)});this.unsubscribers.push(n);let i=[];const s=Gr.subscribe(r=>{i.forEach(o=>{r.find(a=>a.id===o.id)||this.removeFrame(o.id)}),r.forEach(o=>{const l=i.find(d=>d.id===o.id),a=this.frames.get(o.id);if(a&&l){const d=l.backgroundColor!==o.backgroundColor,u=l.textColor!==o.textColor,h=l.textSize!==o.textSize,f=JSON.stringify(l.texts)!==JSON.stringify(o.texts),g=l.rotation!==o.rotation,p=l.scale!==o.scale,b=l.frameKey!==o.frameKey;a.data=o,(d||u||h||f||g||p||b)&&(this.updateFrameVisuals(a),this.scene.data.get("selectedFrameId")===o.id&&this.updateSelectionVisuals())}}),i=r.map(o=>({...o}))});this.unsubscribers.push(s)}setupFrameDropListener(){const e=we.on(Se.FRAME_DROPPED,n=>{const{frameKey:i,canvasX:s,canvasY:r}=n,l=this.scene.cameras.main.getWorldPoint(s,r),a={id:Hl(),frameKey:i,x:Math.round(l.x),y:Math.round(l.y),scale:Ul(i),depth:Ye.ITEMS_FRONT,rotation:90,backgroundColor:In,textColor:"#333333",textSize:16,texts:[{language:"cs",text:""},{language:"en",text:""}]};yl(a),this.createFrame(a),an(a.id),si()});this.unsubscribers.push(()=>e.unsubscribe())}setupDeleteKeys(){const e=this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.DELETE,!1),n=this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.BACKSPACE,!1),i=()=>{if(kn())return;let s="items";if(Re.subscribe(l=>s=l)(),s!=="frames")return;const o=this.scene.data.get("selectedFrameId");o&&os(o)};e.on("down",i),n.on("down",i)}updateSelectionVisuals(){if(!this.selectionGraphics)return;this.selectionGraphics.clear();const e=this.scene.data.get("selectedFrameId");if(!e){xi(null);return}const n=this.frames.get(e);if(!n){xi(null);return}const i=n.sprite,s=i.getBounds(),r=this.scene.cameras.main,o=(i.x-r.scrollX)*r.zoom,l=(i.y-r.scrollY)*r.zoom;xi({screenX:o,screenY:l,frameHeight:s.height*r.zoom}),this.selectionGraphics.lineStyle(3,10181046,1),this.selectionGraphics.strokeRect(s.x-4,s.y-4,s.width+8,s.height+8);const a=8;this.selectionGraphics.fillStyle(10181046,1),this.selectionGraphics.fillRect(s.x-4-a/2,s.y-4-a/2,a,a),this.selectionGraphics.fillRect(s.right+4-a/2,s.y-4-a/2,a,a),this.selectionGraphics.fillRect(s.x-4-a/2,s.bottom+4-a/2,a,a),this.selectionGraphics.fillRect(s.right+4-a/2,s.bottom+4-a/2,a,a)}removeFrame(e){const n=this.frames.get(e);n&&(n.sprite.destroy(),n.background.destroy(),this.frames.delete(e)),this.updateSelectionVisuals()}setInteractiveEnabled(e){this.frames.forEach(({sprite:n,background:i})=>{e?(n.setInteractive({draggable:!0,useHandCursor:!0}),n.setAlpha(1),i.setAlpha(1)):(n.disableInteractive(),n.setAlpha(.6),i.setAlpha(.6))}),!e&&this.selectionGraphics&&this.selectionGraphics.clear()}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.frames.forEach(({sprite:e,background:n})=>{e.destroy(),n.destroy()}),this.frames.clear(),this.selectionGraphics&&(this.selectionGraphics.destroy(),this.selectionGraphics=null)}}const nn=eo-1,Ct=50,Gn=150,sc=.3,rc=.5,Ci=16,Xs=16777215,Bs=.6,Zs=0,st=60,Ys=8;class oc{scene;worldWidth;worldHeight;graphics=null;zoneAreas=new Map;leftHandles=new Map;rightHandles=new Map;arrowGraphics=new Map;dragging=null;unsubscribers=[];createZoneSubscription;currentEditMode="items";currentZones=[];currentSelectedId=null;lastClickTime=0;lastClickX=0;DOUBLE_CLICK_THRESHOLD=300;DOUBLE_CLICK_DISTANCE=20;pendingTap=null;TAP_MAX_DURATION=300;TAP_MAX_DISTANCE=15;createZoneAtSubscription;boundWindowPointerUp=()=>{};boundWindowPointerMove=()=>{};currentScreenX=0;autoScrollTimer=null;constructor(e,n,i){this.scene=e,this.worldWidth=n,this.worldHeight=i}create(){this.graphics=this.scene.add.graphics(),this.graphics.setDepth(nn);const e=Re.subscribe(s=>{this.currentEditMode=s,this.render()});this.unsubscribers.push(e);const n=ts.subscribe(s=>{this.currentZones=s,this.render()});this.unsubscribers.push(n);const i=vi.subscribe(s=>{this.currentSelectedId=s,this.render()});this.unsubscribers.push(i),this.scene.input.on("pointermove",this.handlePointerMove,this),this.scene.input.on("pointerup",this.handlePointerUp,this),this.boundWindowPointerUp=this.handlePointerUp.bind(this),this.boundWindowPointerMove=this.handleWindowPointerMove.bind(this),window.addEventListener("pointerup",this.boundWindowPointerUp),window.addEventListener("pointermove",this.boundWindowPointerMove),this.scene.input.on("pointerdown",this.handlePointerDown,this),this.createZoneSubscription=we.on(Se.DIALOG_ZONE_CREATE,()=>{this.createNewZone()}),this.createZoneAtSubscription=we.on(Se.DIALOG_ZONE_CREATE_AT,s=>{this.createZoneAtPosition(s.worldX)}),this.render()}clearVisuals(){this.graphics&&this.graphics.clear(),this.zoneAreas.forEach(e=>e.destroy()),this.zoneAreas.clear(),this.leftHandles.forEach(e=>e.destroy()),this.leftHandles.clear(),this.rightHandles.forEach(e=>e.destroy()),this.rightHandles.clear(),this.arrowGraphics.forEach(e=>e.destroy()),this.arrowGraphics.clear()}render(){if(this.clearVisuals(),this.currentEditMode==="dialogs")for(const e of this.currentZones)this.renderZone(e,e.id===this.currentSelectedId)}renderZone(e,n){if(!this.graphics)return;const i=B.Display.Color.HexStringToColor(e.color).color,s=n?rc:sc;this.graphics.fillStyle(i,s),this.graphics.fillRect(e.x,0,e.width,this.worldHeight),this.graphics.lineStyle(2,i,.8),this.graphics.strokeRect(e.x,0,e.width,this.worldHeight);const r=this.scene.add.rectangle(e.x+e.width/2,this.worldHeight/2,e.width-Ci*2,this.worldHeight);r.setOrigin(.5,.5),r.setInteractive({cursor:n?"grab":"pointer"}),r.setDepth(nn+.1),r.setAlpha(.001),r.setData("zoneId",e.id),r.on("pointerdown",o=>{const l=Date.now(),a=l-this.lastClickTime<this.DOUBLE_CLICK_THRESHOLD&&Math.abs(o.worldX-this.lastClickX)<this.DOUBLE_CLICK_DISTANCE;if(this.lastClickTime=l,this.lastClickX=o.worldX,this.scene.data.set("isDraggingItem",!0),Dt(!0),this.currentSelectedId!==e.id&&xn(e.id),a){Vr(),this.scene.data.set("isDraggingItem",!1),Dt(!1);return}this.startDrag(e.id,"move",o.worldX)}),this.zoneAreas.set(e.id,r),n&&this.createHandles(e)}createHandles(e){const n=this.scene.cameras.main.scrollY,i=this.scene.cameras.main.height,s=n+i/2,r=this.scene.add.rectangle(e.x,this.worldHeight/2,Ci,this.worldHeight);r.setOrigin(.5,.5),r.setInteractive({cursor:"ew-resize"}),r.setDepth(nn+.2),r.setFillStyle(Xs,Bs),r.setData("zoneId",e.id),r.setData("type","left"),r.on("pointerdown",u=>{this.startDrag(e.id,"left",u.worldX)}),this.leftHandles.set(e.id,r);const o=8,l=this.scene.add.graphics();l.setDepth(nn+.3),this.drawArrow(l,e.x-o,s,"left"),this.arrowGraphics.set(`${e.id}_left`,l);const a=this.scene.add.rectangle(e.x+e.width,this.worldHeight/2,Ci,this.worldHeight);a.setOrigin(.5,.5),a.setInteractive({cursor:"ew-resize"}),a.setDepth(nn+.2),a.setFillStyle(Xs,Bs),a.setData("zoneId",e.id),a.setData("type","right"),a.on("pointerdown",u=>{this.startDrag(e.id,"right",u.worldX)}),this.rightHandles.set(e.id,a);const d=this.scene.add.graphics();d.setDepth(nn+.3),this.drawArrow(d,e.x+e.width+o,s,"right"),this.arrowGraphics.set(`${e.id}_right`,d)}drawArrow(e,n,i,s){const o=s==="left"?-1:1;e.fillStyle(3355443,.8),e.beginPath(),e.moveTo(n+o*10+1,i),e.lineTo(n-o*10+1,i-10+1),e.lineTo(n-o*10+1,i+10-1),e.closePath(),e.fillPath(),e.fillStyle(16777215,.9),e.beginPath(),e.moveTo(n+o*10,i),e.lineTo(n-o*10,i-10),e.lineTo(n-o*10,i+10),e.closePath(),e.fillPath()}startDrag(e,n,i){const s=this.currentZones.find(r=>r.id===e);s&&(this.scene.data.set("isDraggingItem",!0),Dt(!0),this.dragging={zoneId:e,type:n,startX:i,originalX:s.x,originalWidth:s.width})}getZoneBounds(e){let n=0,i=this.worldWidth;for(const s of this.currentZones){if(s.id===e)continue;const r=s.x+s.width,o=this.currentZones.find(l=>l.id===e);o&&(r<=o.x+o.width/2&&(n=Math.max(n,r+Zs)),s.x>=o.x+o.width/2&&(i=Math.min(i,s.x-Zs)))}return{minX:n,maxX:i-Ct,maxRight:i}}wouldOverlap(e,n,i){const s=n+i;for(const r of this.currentZones){if(r.id===e)continue;const o=r.x,l=r.x+r.width;if(n<l&&s>o)return!0}return!1}screenToWorld(e,n){const i=this.scene.cameras.main,s=e/i.zoom+i.scrollX,r=n/i.zoom+i.scrollY;return{worldX:s,worldY:r}}handleWindowPointerMove(e){if(this.pendingTap){const{worldX:i}=this.screenToWorld(e.clientX,e.clientY);Math.abs(i-this.pendingTap.worldX)>this.TAP_MAX_DISTANCE&&(this.pendingTap=null)}if(!this.dragging)return;this.currentScreenX=e.clientX;const{worldX:n}=this.screenToWorld(e.clientX,e.clientY);this.updateDrag(n),this.checkAutoScroll()}handlePointerMove(e){this.pendingTap&&Math.abs(e.worldX-this.pendingTap.worldX)>this.TAP_MAX_DISTANCE&&(this.pendingTap=null),this.dragging&&(this.currentScreenX=e.x,e.event?.stopPropagation?.(),this.updateDrag(e.worldX),this.checkAutoScroll())}checkAutoScroll(){if(!this.dragging||this.dragging.type!=="move"){this.stopAutoScroll();return}const e=this.scene.cameras.main,n=e.width,i=this.currentZones.find(b=>b.id===this.dragging?.zoneId);if(!i)return;const s=(i.x-e.scrollX)*e.zoom,r=(i.x+i.width-e.scrollX)*e.zoom,o=s<=st,l=r>=n-st,a=e.scrollX>0,d=e.scrollX<this.worldWidth-e.width/e.zoom,u=this.currentScreenX<st,h=this.currentScreenX>n-st,p=o&&u&&a||l&&h&&d;p&&!this.autoScrollTimer?this.autoScrollTimer=this.scene.time.addEvent({delay:16,callback:this.performAutoScroll,callbackScope:this,loop:!0}):!p&&this.autoScrollTimer&&this.stopAutoScroll()}performAutoScroll(){if(!this.dragging||this.dragging.type!=="move"){this.stopAutoScroll();return}const e=this.scene.cameras.main,n=e.width,i=this.currentZones.find(f=>f.id===this.dragging?.zoneId);if(!i)return;let s=0;if(this.currentScreenX<st){const g=(st-this.currentScreenX)/st;s=-Ys*g}else if(this.currentScreenX>n-st){const g=(this.currentScreenX-(n-st))/st;s=Ys*g}if(s===0)return;const r=e.scrollX+s,o=0,l=this.worldWidth-e.width/e.zoom,a=Math.max(o,Math.min(l,r)),d=a-e.scrollX;if(d===0){this.stopAutoScroll();return}e.scrollX=a;const u=i.x+d,h=Math.max(0,Math.min(this.worldWidth-i.width,u));this.wouldOverlap(i.id,h,i.width)||(sn(i.id,{x:h}),this.dragging.originalX+=d,this.dragging.startX+=d)}stopAutoScroll(){this.autoScrollTimer&&(this.autoScrollTimer.destroy(),this.autoScrollTimer=null)}updateDrag(e){if(!this.dragging)return;const n=e-this.dragging.startX,i=this.currentZones.find(r=>r.id===this.dragging?.zoneId);if(!i)return;const s=this.getZoneBounds(i.id);if(this.dragging.type==="left"){let r=this.dragging.originalX+n,o=this.dragging.originalWidth-n;if(r<0&&(o+=r,r=0),o<Ct&&(r=this.dragging.originalX+this.dragging.originalWidth-Ct,o=Ct),r<s.minX){const l=s.minX-r;r=s.minX,o-=l}o>=Ct&&!this.wouldOverlap(i.id,r,o)&&sn(i.id,{x:r,width:o})}else if(this.dragging.type==="right"){let r=this.dragging.originalWidth+n;r<Ct&&(r=Ct),i.x+r>this.worldWidth&&(r=this.worldWidth-i.x),i.x+r>s.maxRight&&(r=s.maxRight-i.x),r>=Ct&&!this.wouldOverlap(i.id,i.x,r)&&sn(i.id,{width:r})}else if(this.dragging.type==="move"){let r=this.dragging.originalX+n;const o=i.width;if(r<0&&(r=0),r+o>this.worldWidth&&(r=this.worldWidth-o),!this.wouldOverlap(i.id,r,o))sn(i.id,{x:r});else{const l=this.findNonOverlappingPosition(i.id,r,o);l!==null&&sn(i.id,{x:l})}}}findNonOverlappingPosition(e,n,i){const s=this.currentZones.filter(u=>u.id!==e).sort((u,h)=>u.x-h.x);if(s.length===0)return Math.max(0,Math.min(n,this.worldWidth-i));let r=n,o=1/0;const l=s[0];if(l.x>=i){const u=l.x-i,h=Math.max(0,Math.min(n,u)),f=Math.abs(h-n);f<o&&(o=f,r=h)}for(let u=0;u<s.length-1;u++){const h=s[u],f=s[u+1],g=h.x+h.width,p=f.x;if(p-g>=i){const k=g,_=p-i,m=Math.max(k,Math.min(n,_)),w=Math.abs(m-n);w<o&&(o=w,r=m)}}const a=s[s.length-1],d=a.x+a.width;if(this.worldWidth-d>=i){const u=d,h=this.worldWidth-i,f=Math.max(u,Math.min(n,h)),g=Math.abs(f-n);g<o&&(o=g,r=f)}return o<1/0&&!this.wouldOverlap(e,r,i)?r:null}handlePointerUp(e){if(this.dragging&&(this.stopAutoScroll(),this.scene.data.set("isDraggingItem",!1),Dt(!1),this.dragging=null),this.pendingTap&&this.currentEditMode==="dialogs"){if(Date.now()-this.pendingTap.startTime<this.TAP_MAX_DURATION){let s=!0;e&&e.worldX!==void 0&&(s=Math.abs(e.worldX-this.pendingTap.worldX)<this.TAP_MAX_DISTANCE),s&&this.showTempAddButton(this.pendingTap.worldX,this.pendingTap.worldY)}this.pendingTap=null}}handlePointerDown(e){if(this.currentEditMode!=="dialogs"||this.dragging)return;const n=e.downElement;if(n&&n.tagName?.toUpperCase()!=="CANVAS")return;const i=e.worldX;for(const l of this.currentZones)if(i>=l.x&&i<=l.x+l.width)return;const s=Date.now(),r=s-this.lastClickTime,o=Math.abs(i-this.lastClickX);if(r<this.DOUBLE_CLICK_THRESHOLD&&o<this.DOUBLE_CLICK_DISTANCE){this.createZoneAtPosition(i),this.lastClickTime=0,this.hideTempAddButton();return}this.lastClickTime=s,this.lastClickX=i,this.pendingTap={worldX:i,worldY:e.worldY,startTime:s},this.currentSelectedId&&xn(null)}showTempAddButton(e,n){const i=this.scene.cameras.main,s=(e-i.scrollX)*i.zoom,r=(n-i.scrollY)*i.zoom;we.emit(Se.TEMP_ZONE_BUTTON_SHOW,{screenX:s,screenY:r,worldX:e})}hideTempAddButton(){we.emit(Se.TEMP_ZONE_BUTTON_HIDE,{})}createZoneAtPosition(e){let n=e-Gn/2;const i=Gn;if(n=Math.max(0,Math.min(this.worldWidth-i,n)),this.wouldOverlap("",n,i)){const r=this.findNonOverlappingPosition("",n,i);if(r===null){console.warn("No room for a new dialog zone");return}n=r}const s=Es(n,i);s.x=n,Ts(s),xn(s.id)}createNewZone(){const e=this.scene.cameras.main;let i=e.scrollX+e.width/2-Gn/2;const s=Gn;if(i=Math.max(0,Math.min(this.worldWidth-s,i)),this.wouldOverlap("",i,s)){const o=this.findNonOverlappingPosition("",i,s);if(o===null){console.warn("No room for a new dialog zone");return}i=o}const r=Es(i,s);r.x=i,Ts(r),xn(r.id)}updateSelectionVisuals(){if(this.currentEditMode!=="dialogs"){Zn(null);return}if(!this.currentSelectedId){Zn(null);return}const e=this.currentZones.find(o=>o.id===this.currentSelectedId);if(!e){Zn(null);return}const n=this.scene.cameras.main,s=(e.x+e.width/2-n.scrollX)*n.zoom,r=n.height/2;Zn({screenX:s,screenY:r})}destroy(){this.hideTempAddButton();for(const e of this.unsubscribers)e();this.unsubscribers=[],this.createZoneSubscription&&this.createZoneSubscription.unsubscribe(),this.createZoneAtSubscription&&this.createZoneAtSubscription.unsubscribe(),this.stopAutoScroll(),this.scene.input.off("pointerdown",this.handlePointerDown,this),this.scene.input.off("pointermove",this.handlePointerMove,this),this.scene.input.off("pointerup",this.handlePointerUp,this),window.removeEventListener("pointerup",this.boundWindowPointerUp),window.removeEventListener("pointermove",this.boundWindowPointerMove),this.clearVisuals(),this.graphics&&(this.graphics.destroy(),this.graphics=null),this.dragging=null}}class ac extends B.Scene{parallaxLayers=null;cameraController;playerController;gridOverlay;itemsController;framesController;dialogZoneRenderer;config;minimapSubscription;isShuttingDown=!1;get itemManager(){return this.itemsController?.getManager()}toggleZoom(){this.cameraController?.toggleZoomToFit()}constructor(){super({key:bt.BUILDER})}init(e){this.config=e.config}preload(){this.load.spritesheet("cat-idle-white","assets/sprites/white/Idle.png",{frameWidth:48,frameHeight:48}),ai.preloadAssets(this),Ns.preloadAssets(this)}create(){this.isShuttingDown=!1,this.physics.world.setBounds(0,0,this.config.worldWidth,this.config.worldHeight);const e=this.config.worldHeight-oi;this.cameraController=new Ql(this,this.config.worldWidth,this.config.worldHeight),this.playerController=new ec(this,this.config.worldWidth,this.config.worldHeight),this.gridOverlay=new tc(this,this.config.worldWidth,this.config.worldHeight),this.itemsController=new ic(this,e),this.framesController=new Ns(this),this.dialogZoneRenderer=new oc(this,this.config.worldWidth,this.config.worldHeight),this.createBackground(),this.gridOverlay.create(),this.createGroundReference(),this.playerController.create(this.config.playerStartX,this.config.playerStartY),this.itemsController.create(this.config.placedItems||[]),this.framesController.create(this.config.placedFrames||[]),this.dialogZoneRenderer.create(),this.cameraController.setup(),this.cameraController.centerOn(this.config.playerStartX,this.config.playerStartY),this.minimapSubscription=we.on(Se.MINIMAP_NAVIGATE,n=>{this.navigateToPosition(n.worldX,n.worldY)}),this.scale.on("resize",this.handleResize,this),this.events.on("shutdown",this.shutdown,this)}async createBackground(){const e=ii.getCurrentConfig();try{await Xr(this,e)}catch(n){console.error("Failed to load background:",n);return}this.parallaxLayers&&(Va(this.parallaxLayers),this.parallaxLayers=null),this.parallaxLayers=Br(this,this.config.worldWidth,this.config.worldHeight,e)}createGroundReference(){Ln.createVisualGround(this,{worldWidth:this.config.worldWidth,worldHeight:this.config.worldHeight,height:oi})}update(){this.parallaxLayers&&Zr(this.parallaxLayers.baseLayer,this.cameras.main),this.itemManager?.updateSelectionVisuals(),this.framesController?.updateSelectionVisuals(),this.dialogZoneRenderer?.updateSelectionVisuals();const e=this.cameras.main,n=this.data.get("playerSprite");_l({scrollX:e.worldView.x,scrollY:e.worldView.y,viewWidth:e.width,viewHeight:e.height,worldWidth:this.config.worldWidth,worldHeight:this.config.worldHeight,zoom:e.zoom,playerX:n?.x??this.config.playerStartX,playerY:n?.y??this.config.playerStartY})}navigateToPosition(e,n){this.cameraController.getIsZoomedOut()||this.cameraController.centerOn(e,n)}handleResize(e){if(!(!this.cameras?.main||!this.config)){if(this.cameraController?.getIsZoomedOut()||this.cameras.main.setBounds(0,0,this.config.worldWidth,this.config.worldHeight),this.parallaxLayers?.baseLayer){const n=Math.max(this.config.worldHeight,e.height);this.parallaxLayers.baseLayer.setSize(this.config.worldWidth,n)}this.gridOverlay&&this.gridOverlay.redraw()}}shutdown(){this.isShuttingDown||(this.isShuttingDown=!0,this.scale.off("resize",this.handleResize,this),this.minimapSubscription&&this.minimapSubscription.unsubscribe(),this.cameraController&&this.cameraController.destroy(),this.playerController&&this.playerController.destroy(),this.gridOverlay&&this.gridOverlay.destroy(),this.itemsController&&this.itemsController.destroy(),this.framesController&&this.framesController.destroy(),this.dialogZoneRenderer&&this.dialogZoneRenderer.destroy())}}const lc="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(lc);Mo();class cc{currentLanguage="cs";setLanguage(e){this.currentLanguage=e,localStorage.setItem("language",e)}getLanguage(){const e=localStorage.getItem("language");return(e==="cs"||e==="en")&&(this.currentLanguage=e),this.currentLanguage}toggleLanguage(){return this.currentLanguage=this.currentLanguage==="cs"?"en":"cs",this.setLanguage(this.currentLanguage),this.currentLanguage}}const so=new cc;let je=null;function dc(t){je=t}function uc(){if(!je)return console.error("Scene manager not initialized"),null;try{return je.scene.getScene(bt.GAME)?.mapConfig||null}catch(t){return console.error("Failed to get map config:",t),null}}function hc(t){if(!je)return console.error("Scene manager not initialized"),!1;try{return je.scene.getScene(bt.GAME)?(je.scene.stop(bt.GAME),pl(t),je.scene.start(bt.BUILDER,{config:t}),!0):(console.error("GameScene not found"),!1)}catch(e){return console.error("Failed to switch to builder:",e),!1}}function fc(){if(!je)return console.error("Scene manager not initialized"),!1;try{return je.scene.stop(bt.BUILDER),vl(),je.scene.start(bt.GAME,{useBuilderConfig:!0}),!0}catch(t){return console.error("Failed to switch to game:",t),!1}}function ro(){if(je)try{je.scene.getScene(bt.BUILDER)?.toggleZoom()}catch(t){console.error("Failed to toggle zoom:",t)}}var gc=H('<button class="close-btn svelte-yrmttr" title="Close">×</button>'),pc=H('<div class="resize-handle resize-handle-sw svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M1 1L9 9M1 5L5 9M1 9L1 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></div> <div class="resize-handle resize-handle-se svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M9 1L1 9M9 5L5 9M9 9L9 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></div>',1),vc=H("<div><!></div> <!>",1),mc=H('<div><div class="panel-header svelte-yrmttr"><span class="panel-title svelte-yrmttr"> </span> <!> <div class="header-buttons svelte-yrmttr"><button class="minimize-btn svelte-yrmttr"> </button> <!></div></div> <!></div>');function _i(t,e){ue(e,!0);const n=()=>P(Rt,"$isDraggingInBuilder",i),[i,s]=Ie();let r=1e3,o=ee(e,"initialRight",3,10),l=ee(e,"initialTop",3,60),a=ee(e,"width",3,280),d=ee(e,"minWidth",3,200),u=ee(e,"minHeight",3,100),h=ee(e,"maxWidth",3,600),f=ee(e,"maxHeight",3,800),g=ee(e,"resizable",3,!1),p=ee(e,"startMinimized",3,!1),b=ee(e,"showClose",3,!1),k=W(Ke(p())),_=W(Ke({x:0,y:0})),m=W(Ke({width:a(),height:e.height??0})),w=W(!1),y=W(!1),v=W("se"),S=W(Ke({x:0,y:0})),C=W(null),O=W(!1),X=W(Ke(r));function Z(){r++,A(X,r,!0)}Ee(()=>{if(typeof window>"u")return;const L=localStorage.getItem(`panel-state-${e.panelId}`);if(L)try{const Y=JSON.parse(L);A(_,{x:Y.x,y:Y.y},!0),g()&&Y.width&&Y.height&&A(m,{width:Y.width,height:Y.height},!0)}catch{A(_,{x:window.innerWidth-a()-o(),y:l()},!0)}else A(_,{x:window.innerWidth-a()-o(),y:l()},!0);A(O,!0)}),Ee(()=>{if(!c(O))return;const L=g()?{...c(_),width:c(m).width,height:c(m).height}:c(_);localStorage.setItem(`panel-state-${e.panelId}`,JSON.stringify(L))}),Ee(()=>{if(!c(O))return;function L(){if(!c(C))return;const Y=g()?c(m).width:a();let ie=c(_).x,ke=c(_).y,le=!1;const We=window.innerWidth-Y;c(_).x>We&&(ie=Math.max(10,We),le=!0);const xt=window.innerHeight-40;c(_).y>xt&&(ke=Math.max(10,xt),le=!0),c(_).x<0&&(ie=10,le=!0),c(_).y<0&&(ke=10,le=!0),le&&A(_,{x:ie,y:ke},!0)}return window.addEventListener("resize",L),L(),()=>{window.removeEventListener("resize",L)}});function x(){A(k,!c(k))}function M(){e.onclose?.()}function I(L){L.target.closest("button")||(A(w,!0),A(S,{x:L.clientX-c(_).x,y:L.clientY-c(_).y},!0),L.currentTarget.setPointerCapture(L.pointerId),L.preventDefault())}function R(L){if(!c(w))return;const Y=L.clientX-c(S).x,ie=L.clientY-c(S).y,ke=window.innerWidth-(c(C)?.offsetWidth??a()),le=window.innerHeight-40;A(_,{x:Math.max(0,Math.min(Y,ke)),y:Math.max(0,Math.min(ie,le))},!0)}function D(L){c(w)&&(A(w,!1),L.currentTarget.releasePointerCapture(L.pointerId))}function F(L){return Y=>{g()&&(A(y,!0),A(v,L,!0),Y.currentTarget.setPointerCapture(Y.pointerId),Y.preventDefault(),Y.stopPropagation())}}function z(L){if(!c(y)||!c(C))return;const Y=c(C).getBoundingClientRect();let ie,ke=L.clientY-Y.top,le=c(_).x;c(v)==="se"?ie=L.clientX-Y.left:(ie=Y.right-L.clientX,le=L.clientX);const We=Math.max(d(),Math.min(h(),ie)),xt=Math.max(u(),Math.min(f(),ke));c(v)==="sw"&&(le=Y.right-We,le<0&&(le=0));const Ht=c(v)==="se"?window.innerWidth-c(_).x-10:Y.right-10,qt=window.innerHeight-c(_).y-10,gt=Math.min(We,Ht),Jt=Math.min(xt,qt);A(m,{width:gt,height:Jt},!0),c(v)==="sw"&&ie>=d()&&A(_,{...c(_),x:Math.max(0,le)},!0)}function V(L){c(y)&&(A(y,!1),L.currentTarget.releasePointerCapture(L.pointerId))}function tt(L){L.stopPropagation()}var de=mc();let Ne;de.__pointerdown=L=>{Z(),tt(L)},de.__click=tt;var Ce=$(de);Ce.__pointerdown=I,Ce.__pointermove=R,Ce.__pointerup=D;var _e=$(Ce),nt=$(_e),ye=T(_e,2);{var Me=L=>{var Y=xe(),ie=ae(Y);fn(ie,()=>e.headerExtra),E(L,Y)};U(ye,L=>{e.headerExtra&&L(Me)})}var De=T(ye,2),Te=$(De);Te.__click=x;var ht=$(Te),Xe=T(Te,2);{var ft=L=>{var Y=gc();Y.__click=M,E(L,Y)};U(Xe,L=>{b()&&L(ft)})}var qe=T(Ce,2);{var Ft=L=>{var Y=vc(),ie=ae(Y);let ke;var le=$(ie);fn(le,()=>e.children);var We=T(ie,2);{var xt=Ht=>{var qt=pc(),gt=ae(qt),Jt=N(()=>F("sw"));gt.__pointerdown=function(...fe){c(Jt)?.apply(this,fe)},gt.__pointermove=z,gt.__pointerup=V;var Qt=T(gt,2),Q=N(()=>F("se"));Qt.__pointerdown=function(...fe){c(Q)?.apply(this,fe)},Qt.__pointermove=z,Qt.__pointerup=V,Ot("pointercancel",gt,V),Ot("pointercancel",Qt,V),E(Ht,qt)};U(We,Ht=>{g()&&Ht(xt)})}K(()=>ke=Pe(ie,1,"panel-body svelte-yrmttr",null,ke,{"has-fixed-height":g()&&c(m).height>0})),E(L,Y)};U(qe,L=>{c(k)||L(Ft)})}gn(de,L=>A(C,L),()=>c(C)),K(()=>{Ne=Pe(de,1,"draggable-panel svelte-yrmttr",null,Ne,{minimized:c(k),dragging:c(w),resizing:c(y),resizable:g()}),ce(de,`left: ${c(_).x??""}px; top: ${c(_).y??""}px; width: ${c(k)?"auto":`${g()?c(m).width:a()}px`}; ${g()&&c(m).height>0&&!c(k)?`height: ${c(m).height}px;`:""}${n()?" pointer-events: none;":""} z-index: ${c(X)??""};`),ge(nt,e.title),te(Te,"title",c(k)?"Expand":"Minimize"),ge(ht,c(k)?"▲":"▼")}),Ot("pointercancel",Ce,D),E(t,de),he(),s()}et(["pointerdown","click","pointermove","pointerup"]);function oo(t,e,n){const{previewSize:i,borderColor:s,dataKey:r,eventName:o,onDrop:l}=t,a=i/2;function d(m,w){if(!m.dataTransfer)return;n({draggedKey:w}),Wn(!0),m.dataTransfer.effectAllowed="copy",m.dataTransfer.setData(r,w);const v=m.target.querySelector("img")?.cloneNode(!0);v&&(v.style.position="absolute",v.style.top="-1000px",document.body.appendChild(v),m.dataTransfer.setDragImage(v,a,a),setTimeout(()=>v.remove(),0))}function u(){n({draggedKey:null}),Wn(!1)}function h(m,w){if(m.touches.length!==1)return;const y=m.touches[0];n({draggedKey:w}),Wn(!0);const S=m.currentTarget.querySelector("img");if(S){const C=document.createElement("div");C.className="touch-drag-preview",C.innerHTML=`<img src="${S.src}" alt="" />`,C.style.cssText=`
        position: fixed;
        top: ${y.clientY-a}px;
        left: ${y.clientX-a}px;
        width: ${i}px;
        height: ${i}px;
        pointer-events: none;
        z-index: 10000;
        opacity: 0.9;
        image-rendering: pixelated;
        filter: drop-shadow(3px 3px 0 rgba(0, 0, 0, 0.5));
        border: 2px solid ${s};
        background: rgba(26, 26, 46, 0.9);
      `,C.querySelector("img").style.cssText=`
        width: 100%;
        height: 100%;
        object-fit: contain;
        image-rendering: pixelated;
      `,document.body.appendChild(C),n({touchDragElement:C})}}function f(m){const w=e();if(!w.draggedKey||!w.touchDragElement)return;const y=m.touches[0];w.touchDragElement.style.top=`${y.clientY-a}px`,w.touchDragElement.style.left=`${y.clientX-a}px`,m.preventDefault()}function g(m){const w=e();if(!w.draggedKey)return;const y=m.changedTouches[0],v=document.querySelector("canvas");if(w.touchDragElement&&(w.touchDragElement.remove(),n({touchDragElement:null})),v){const S=v.getBoundingClientRect(),C=y.clientX,O=y.clientY;if(C>=S.left&&C<=S.right&&O>=S.top&&O<=S.bottom){const X=C-S.left,Z=O-S.top;we.emit(o,{[r]:w.draggedKey,canvasX:X,canvasY:Z}),l?.()}}n({draggedKey:null}),Wn(!1)}function p(m){m.preventDefault(),m.dataTransfer&&(m.dataTransfer.dropEffect="copy")}function b(m){m.preventDefault();const w=m.dataTransfer?.getData(r);if(!w)return;const v=m.target.getBoundingClientRect(),S=m.clientX-v.left,C=m.clientY-v.top;we.emit(o,{[r]:w,canvasX:S,canvasY:C}),l?.()}function k(){const m=document.querySelector("canvas");return m?(m.addEventListener("dragover",p),m.addEventListener("drop",b),()=>{m.removeEventListener("dragover",p),m.removeEventListener("drop",b)}):()=>{}}function _(){return document.addEventListener("touchmove",f,{passive:!1}),document.addEventListener("touchend",g),document.addEventListener("touchcancel",g),()=>{document.removeEventListener("touchmove",f),document.removeEventListener("touchend",g),document.removeEventListener("touchcancel",g)}}return{onDragStart:d,onDragEnd:u,onTouchStart:h,onTouchMove:f,onTouchEnd:g,setupCanvasListeners:k,setupTouchListeners:_}}var _c=H('<span class="palette-hint svelte-1ahretz">Drag to place</span>'),yc=H('<div draggable="true" role="button" tabindex="0"><img class="item-preview svelte-1ahretz"/> <span class="item-name svelte-1ahretz"> </span></div>'),bc=H('<div class="palette-content svelte-1ahretz" role="toolbar" tabindex="-1"><div class="palette-grid svelte-1ahretz"></div></div>');function wc(t,e){ue(e,!0);const n=()=>P(cn,"$isAssetPaletteOpen",s),i=()=>P(Re,"$builderEditMode",s),[s,r]=Ie(),o="#4a90e2",l=600,a=as;function d(){return window.innerWidth<l}function u(){d()&&cn.set(!1)}let h=W(null),f=W(null);const g=oo({previewSize:48,borderColor:o,dataKey:"assetKey",eventName:Se.ASSET_DROPPED,onDrop:u},()=>({draggedKey:c(h),touchDragElement:c(f)}),y=>{"draggedKey"in y&&A(h,y.draggedKey??null,!0),"touchDragElement"in y&&A(f,y.touchDragElement??null,!0)});function p(y){y.stopPropagation()}function b(){cn.set(!1)}function k(y){const v=Vt(bn),S=v.scrollX+v.viewWidth/2,C=v.scrollY+v.viewHeight/2;we.emit(Se.ASSET_DROPPED,{assetKey:y,canvasX:S,canvasY:C}),u()}Xn(()=>g.setupCanvasListeners()),Ee(()=>g.setupTouchListeners());var _=xe(),m=ae(_);{var w=y=>{_i(y,{panelId:"asset-palette",title:"Assets",initialRight:10,initialTop:60,width:280,height:400,minWidth:200,minHeight:160,maxWidth:500,maxHeight:600,resizable:!0,showClose:!0,onclose:b,headerExtra:S=>{var C=_c();E(S,C)},children:(S,C)=>{var O=bc();O.__pointerdown=p;var X=$(O);$t(X,21,()=>a,Yt,(Z,x)=>{var M=yc();let I;M.__touchstart=z=>g.onTouchStart(z,c(x).key),M.__dblclick=()=>k(c(x).key),ce(M,"",{},{"--accent-color":o});var R=$(M),D=T(R,2),F=$(D);K(()=>{I=Pe(M,1,"palette-item svelte-1ahretz",null,I,{dragging:c(h)===c(x).key}),te(M,"title",`${c(x).name??""} (double-click to place)`),te(R,"src",c(x).path),te(R,"alt",c(x).name),ge(F,c(x).name)}),Ot("dragstart",M,z=>g.onDragStart(z,c(x).key)),Ot("dragend",M,function(...z){g.onDragEnd?.apply(this,z)}),E(Z,M)}),E(S,O)},$$slots:{headerExtra:!0,default:!0}})};U(m,y=>{n()&&i()==="items"&&y(w)})}E(t,_),he(),r()}et(["pointerdown","touchstart","dblclick"]);var Sc=H('<span class="palette-hint svelte-jnw59q">Drag to place</span>'),Ec=H('<div draggable="true" role="button" tabindex="0"><img class="item-preview item-preview--landscape svelte-jnw59q"/> <span class="item-name svelte-jnw59q"> </span></div>'),xc=H('<div class="palette-content svelte-jnw59q" role="toolbar" tabindex="-1"><div class="palette-grid svelte-jnw59q"></div></div>');function Ic(t,e){ue(e,!0);const n=()=>P(Zt,"$isFramePaletteOpen",s),i=()=>P(Re,"$builderEditMode",s),[s,r]=Ie(),o="#9b59b6",l=600,a=li;function d(){return window.innerWidth<l}let u=W(null),h=W(null);const f=oo({previewSize:64,borderColor:o,dataKey:"frameKey",eventName:Se.FRAME_DROPPED,onDrop:()=>{d()&&Zt.set(!1)}},()=>({draggedKey:c(u),touchDragElement:c(h)}),w=>{"draggedKey"in w&&A(u,w.draggedKey??null,!0),"touchDragElement"in w&&A(h,w.touchDragElement??null,!0)});function g(w){w.stopPropagation()}function p(){Zt.set(!1)}function b(w){const y=Vt(bn),v=y.scrollX+y.viewWidth/2,S=y.scrollY+y.viewHeight/2;we.emit(Se.FRAME_DROPPED,{frameKey:w,canvasX:v,canvasY:S}),Zt.set(!1),si()}Xn(()=>f.setupCanvasListeners()),Ee(()=>f.setupTouchListeners());var k=xe(),_=ae(k);{var m=w=>{_i(w,{panelId:"frame-palette",title:"Frames",initialRight:10,initialTop:60,width:320,height:400,minWidth:220,minHeight:200,maxWidth:600,maxHeight:600,resizable:!0,showClose:!0,onclose:p,headerExtra:v=>{var S=Sc();E(v,S)},children:(v,S)=>{var C=xc();C.__pointerdown=g;var O=$(C);$t(O,21,()=>a,Yt,(X,Z)=>{var x=Ec();let M;x.__touchstart=F=>f.onTouchStart(F,c(Z).key),x.__dblclick=()=>b(c(Z).key),ce(x,"",{},{"--accent-color":o});var I=$(x),R=T(I,2),D=$(R);K(()=>{M=Pe(x,1,"palette-item svelte-jnw59q",null,M,{dragging:c(u)===c(Z).key}),te(x,"title",`${c(Z).name??""} (double-click to place)`),te(I,"src",c(Z).path),te(I,"alt",c(Z).name),ge(D,c(Z).name)}),Ot("dragstart",x,F=>f.onDragStart(F,c(Z).key)),Ot("dragend",x,function(...F){f.onDragEnd?.apply(this,F)}),E(X,x)}),E(v,C)},$$slots:{headerExtra:!0,default:!0}})};U(_,w=>{n()&&i()==="frames"&&w(m)})}E(t,k),he(),r()}et(["pointerdown","touchstart","dblclick"]);var Cc=H("<button><!></button>");function oe(t,e){let n=ee(e,"variant",3,"default"),i=ee(e,"disabled",3,!1),s=ee(e,"title",3,"");const r={default:{base:"#4a90e2",hover:"#357abd",active:"#2a5f8f"},green:{base:"#27ae60",hover:"#229954",active:"#1e8449"},blue:{base:"#3498db",hover:"#2980b9",active:"#21618c"},orange:{base:"#ffa500",hover:"#ff8c00",active:"#e67e00"},red:{base:"#e74c3c",hover:"#c0392b",active:"#a02e22"},purple:{base:"#9b59b6",hover:"#8e44ad",active:"#7d3c98"},cyan:{base:"#17a2b8",hover:"#138496",active:"#0f6674"}},o=N(()=>r[n()]),l=N(()=>e.width?`--btn-width: ${e.width};`:"");var a=Cc();let d;a.__click=function(...h){e.onclick?.apply(this,h)};var u=$(a);fn(u,()=>e.children??Ve),K(()=>{d=Pe(a,1,"pixel-btn svelte-lwc0vq",null,d,{disabled:i()}),ce(a,`${c(l)??""} --color-base: ${c(o).base??""}; --color-hover: ${c(o).hover??""}; --color-active: ${c(o).active??""}`),a.disabled=i(),te(a,"title",s())}),E(t,a)}et(["click"]);var Dc=H('<div><div class="minimap-bg svelte-1ycb7lo"></div> <div class="viewport-indicator svelte-1ycb7lo"></div> <div class="player-marker svelte-1ycb7lo"></div> <div class="minimap-frame svelte-1ycb7lo"></div></div>');function Tc(t,e){ue(e,!0);const n=()=>P(bn,"$builderCameraInfo",r),i=()=>P(yn,"$isBuilderZoomedOut",r),s=()=>P(Rt,"$isDraggingInBuilder",r),[r,o]=Ie(),l=120,a=60,d=200,u=100;let h=W(!1),f=W(null),g=N(()=>c(h)?d:l),p=N(()=>c(h)?u:a),b=N(()=>{const x=n();if(!x||x.worldWidth===0)return"display: none;";const M=c(g)/x.worldWidth,I=c(p)/x.worldHeight,R=x.viewWidth/x.zoom*M,D=x.viewHeight/x.zoom*I,F=x.scrollX*M,z=x.scrollY*I;return`
      left: ${Math.max(0,F)}px;
      top: ${Math.max(0,z)}px;
      width: ${Math.min(R,c(g)-F)}px;
      height: ${Math.min(D,c(p)-z)}px;
    `}),k=N(()=>{const x=n();if(!x||x.worldWidth===0)return"display: none;";const M=c(g)/x.worldWidth,I=c(p)/x.worldHeight,R=x.playerX*M,D=x.playerY*I;return`
      left: ${R}px;
      top: ${D}px;
    `});function _(x,M){const I=n();if(!I||I.worldWidth===0||!c(f))return;const R=c(f).getBoundingClientRect(),D=x-R.left,F=M-R.top,z=D/c(g)*I.worldWidth,V=F/c(p)*I.worldHeight;we.emit(Se.MINIMAP_NAVIGATE,{worldX:z,worldY:V})}function m(x){x.stopPropagation(),x.preventDefault(),A(h,!0),_(x.clientX,x.clientY),window.addEventListener("mousemove",w),window.addEventListener("mouseup",y)}function w(x){c(h)&&(x.preventDefault(),_(x.clientX,x.clientY))}function y(){A(h,!1),window.removeEventListener("mousemove",w),window.removeEventListener("mouseup",y)}function v(x){x.stopPropagation(),x.preventDefault(),A(h,!0);const M=x.touches[0];_(M.clientX,M.clientY),window.addEventListener("touchmove",S,{passive:!1}),window.addEventListener("touchend",C)}function S(x){if(!c(h))return;x.preventDefault();const M=x.touches[0];_(M.clientX,M.clientY)}function C(){A(h,!1),window.removeEventListener("touchmove",S),window.removeEventListener("touchend",C)}var O=xe(),X=ae(O);{var Z=x=>{var M=Dc();let I;M.__mousedown=m,M.__touchstart=v;var R=T($(M),2),D=T(R,2);gn(M,F=>A(f,F),()=>c(f)),K(()=>{I=Pe(M,1,"minimap-container svelte-1ycb7lo",null,I,{enlarged:c(h)}),ce(M,`width: ${c(g)??""}px; height: ${c(p)??""}px;${s()?" pointer-events: none;":""}`),ce(R,c(b)),ce(D,c(k))}),E(x,M)};U(X,x=>{i()||x(Z)})}E(t,O),he(),o()}et(["mousedown","touchstart"]);var kc=H('<div class="landscape-hint svelte-ugg786"><div class="hint-content svelte-ugg786"><div class="rotate-icon svelte-ugg786">📱↻</div> <p class="hint-text svelte-ugg786">Rotate your phone for a better experience</p> <button class="dismiss-btn svelte-ugg786">OK</button></div></div>');function Ac(t,e){ue(e,!0);let n=W(!0),i=W(!1);const s="landscapeHintDismissed";Xn(()=>{sessionStorage.getItem(s)||(A(i,/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||"ontouchstart"in window&&window.innerWidth<=768,!0),c(i)&&A(n,!1))});function r(){A(n,!0),sessionStorage.setItem(s,"true")}var o=xe(),l=ae(o);{var a=d=>{var u=kc(),h=$(u),f=T($(h),4);f.__click=r,E(d,u)};U(l,d=>{!c(n)&&c(i)&&d(a)})}E(t,o),he()}et(["click"]);var $c=H("<button> </button>"),Pc=H('<div class="language-tabs svelte-ng6pis"></div>');function ao(t,e){ue(e,!0);let n=ee(e,"accentColor",3,"#88ddff");var i=Pc();$t(i,21,()=>qa,Yt,(s,r)=>{var o=$c();let l;o.__click=()=>e.onselect(c(r).code);let a;var d=$(o);K(()=>{l=Pe(o,1,"lang-tab svelte-ng6pis",null,l,{active:e.selectedLanguage===c(r).code}),a=ce(o,"",a,{"--accent-color":n()}),ge(d,c(r).label)}),E(s,o)}),E(t,i),he()}et(["click"]);var Mc=H("<button></button>"),Oc=H('<div class="color-picker svelte-1jc3e0j"></div>'),Lc=H('<div class="color-section svelte-1jc3e0j"><span class="color-label-title svelte-1jc3e0j"> </span> <button class="color-button svelte-1jc3e0j" title="Change color"><span class="color-preview svelte-1jc3e0j"></span> <span class="color-label svelte-1jc3e0j">Change</span></button> <!></div>');function Fi(t,e){ue(e,!0);let n=ee(e,"label",3,"Color"),i=ee(e,"accentColor",3,"#88ddff"),s=W(!1),r=W(null);Ee(()=>{c(s)&&c(r)&&requestAnimationFrame(()=>{c(r)?.scrollIntoView({behavior:"smooth",block:"nearest"})})});function o(_){e.onselect(_)}function l(){A(s,!c(s))}var a=Lc(),d=$(a),u=$(d),h=T(d,2);h.__click=l;let f;var g=$(h);let p;var b=T(h,2);{var k=_=>{var m=Oc();$t(m,21,()=>e.colors,Yt,(w,y)=>{var v=Mc();let S;v.__click=()=>o(c(y));let C;K(()=>{S=Pe(v,1,"color-swatch svelte-1jc3e0j",null,S,{selected:e.selectedColor===c(y)}),te(v,"title",c(y)),C=ce(v,"",C,{background:c(y),"--accent-color":i()})}),E(w,v)}),gn(m,w=>A(r,w),()=>c(r)),E(_,m)};U(b,_=>{c(s)&&_(k)})}K(()=>{ge(u,n()),f=ce(h,"",f,{"--accent-color":i()}),p=ce(g,"",p,{background:e.selectedColor})}),E(t,a),he()}et(["click"]);const Ws=50,zs=400,Rc=400,Fc=70;var Hc=H('<div class="form-section svelte-jhtkop"><div class="form-group svelte-jhtkop"><label class="svelte-jhtkop"> </label> <input type="text" class="svelte-jhtkop"/></div> <div class="form-group svelte-jhtkop"><label class="svelte-jhtkop"> </label> <textarea rows="6" class="svelte-jhtkop"></textarea></div></div>');function Nc(t,e){ue(e,!0);let n=ee(e,"titlePlaceholder",3,"Enter title..."),i=ee(e,"contentPlaceholder",3,"Enter text..."),s=ee(e,"idPrefix",3,"text-form"),r=ee(e,"accentColor",3,"#88ddff");function o(m){const w=m.target;e.ontitlechange(w.value)}function l(m){const w=m.target;e.oncontentchange(w.value)}var a=Hc();let d;var u=$(a),h=$(u),f=$(h),g=T(h,2);g.__input=o;var p=T(u,2),b=$(p),k=$(b),_=T(b,2);_.__input=l,K(()=>{d=ce(a,"",d,{"--accent-color":r()}),te(h,"for",`${s()??""}-title`),ge(f,`Title (max ${Ws} chars)`),te(g,"id",`${s()??""}-title`),ni(g,e.title),te(g,"placeholder",n()),te(g,"maxlength",Ws),te(b,"for",`${s()??""}-content`),ge(k,`Content (max ${zs} chars)`),te(_,"id",`${s()??""}-content`),ni(_,e.content),te(_,"placeholder",i()),te(_,"maxlength",zs)}),E(t,a),he()}et(["input"]);var Xc=H('<div class="panel-content svelte-zzlycq"><!> <!> <div class="panel-extras svelte-zzlycq"><!></div> <div class="panel-footer svelte-zzlycq"><!> <!></div></div>');function Bc(t,e){ue(e,!0);const n=()=>P(ts,"$dialogZones",r),i=()=>P(vi,"$selectedDialogZoneId",r),s=()=>P(is,"$isDialogZonePanelOpen",r),[r,o]=Ie(),l="#88ddff";let a=W(Ke(Yr)),d=N(()=>n().find(y=>y.id===i())??null),u=N(()=>c(d)?.texts.find(y=>y.language===c(a))??null);function h(y){i()&&ks(i(),c(a),{title:y})}function f(y){i()&&ks(i(),c(a),{content:y})}function g(){i()&&(Jr(i()),Is())}function p(){Is()}function b(y){i()&&sn(i(),{color:y})}function k(y){A(a,y,!0)}var _=xe(),m=ae(_);{var w=y=>{_i(y,{panelId:"dialog-zone-panel",title:"Dialog Zone",initialRight:10,initialTop:160,width:280,height:450,minWidth:250,minHeight:370,maxWidth:500,maxHeight:700,resizable:!0,showClose:!0,onclose:p,children:(v,S)=>{var C=Xc(),O=$(C);ao(O,{get selectedLanguage(){return c(a)},onselect:k,accentColor:l});var X=T(O,2);{let D=N(()=>c(u)?.title??""),F=N(()=>c(u)?.content??"");Nc(X,{get title(){return c(D)},get content(){return c(F)},ontitlechange:h,oncontentchange:f,titlePlaceholder:"Enter title...",contentPlaceholder:"Enter dialog text...",idPrefix:"dialog",accentColor:l})}var Z=T(X,2),x=$(Z);Fi(x,{get colors(){return Oi},get selectedColor(){return c(d).color},onselect:b,label:"Zone Color",accentColor:l});var M=T(Z,2),I=$(M);oe(I,{variant:"cyan",onclick:p,children:(D,F)=>{var z=re("CONFIRM");E(D,z)},$$slots:{default:!0}});var R=T(I,2);oe(R,{variant:"red",onclick:g,children:(D,F)=>{var z=re("DELETE");E(D,z)},$$slots:{default:!0}}),E(v,C)},$$slots:{default:!0}})};U(m,y=>{c(d)&&s()&&y(w)})}E(t,_),he(),o()}var Zc=H("<button> </button>"),Yc=H("<option> </option>"),Wc=H('<a target="_blank" rel="noopener noreferrer" class="url-preview svelte-ds1z4d">Test link ↗</a>'),zc=H('<button><img class="svelte-ds1z4d"/></button>'),Gc=H('<div class="style-picker svelte-ds1z4d"></div>'),Kc=H('<div class="panel-content svelte-ds1z4d"><!> <div class="frame-size-row svelte-ds1z4d"><div class="frame-size-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Frame Size</span> <div class="size-buttons svelte-ds1z4d"></div></div> <div class="rotate-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Rotate</span> <button class="rotate-btn svelte-ds1z4d"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-ds1z4d"><path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg></button></div></div> <div class="panel-extras svelte-ds1z4d"><div class="text-section svelte-ds1z4d"><label for="frame-text" class="svelte-ds1z4d">Text</label> <textarea id="frame-text" placeholder="Enter text..." rows="3" class="svelte-ds1z4d"></textarea></div> <div class="size-rotation-row svelte-ds1z4d"><div class="size-section svelte-ds1z4d"><label for="text-size" class="svelte-ds1z4d">Text Size</label> <select id="text-size" class="svelte-ds1z4d"></select></div></div> <div class="url-section svelte-ds1z4d"><label for="frame-url" class="svelte-ds1z4d">Link URL (opens on click)</label> <input id="frame-url" type="url" placeholder="https://example.com" class="svelte-ds1z4d"/> <!></div> <!> <!> <div class="style-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Frame Style</span> <button class="style-button svelte-ds1z4d" title="Change frame style"><img alt="Current frame" class="style-preview svelte-ds1z4d"/> <span class="style-label svelte-ds1z4d">Change Style</span></button> <!></div></div> <div class="panel-footer svelte-ds1z4d"><!> <!></div></div>');function Uc(t,e){ue(e,!0);const n=()=>P(Qi,"$builderPreviewLanguage",o),i=()=>P(al,"$selectedFrame",o),s=()=>P(mi,"$selectedFrameId",o),r=()=>P(Ji,"$isFramePanelOpen",o),[o,l]=Ie(),a="#9b59b6";let d=N(n),u=N(i),h=N(()=>c(u)?.texts.find(D=>D.language===c(d))??null),f=N(()=>c(u)?Yl(c(u).scale??4):"M");function g(D){const F=D.target;if(!s()||!c(u))return;const z=c(u).texts.map(V=>V.language===c(d)?{...V,text:F.value}:V);z.some(V=>V.language===c(d))||z.push({language:c(d),text:F.value}),vt(s(),{texts:z})}function p(D){const F=D.target;s()&&vt(s(),{url:F.value||void 0})}function b(D){s()&&vt(s(),{backgroundColor:D})}function k(D){s()&&vt(s(),{textColor:D})}function _(D){const F=D.target;s()&&vt(s(),{textSize:parseInt(F.value,10)})}function m(D){s()&&vt(s(),{scale:Zl(D)})}function w(){if(!s()||!c(u))return;const F=(c(u).rotation??0)===0?90:0;vt(s(),{rotation:F})}function y(){s()&&os(s())}function v(){il(),an(null)}function S(D){sl(D)}let C=W(!1),O=W(null),X=W(null);function Z(D){s()&&vt(s(),{frameKey:D})}function x(){A(C,!c(C))}Ee(()=>{c(C)&&c(O)&&requestAnimationFrame(()=>{c(O)?.scrollIntoView({behavior:"smooth",block:"nearest"})})}),Ee(()=>{if(!c(C))return;function D(F){const z=F.target;c(O)&&!c(O).contains(z)&&c(X)&&!c(X).contains(z)&&A(C,!1)}return document.addEventListener("click",D),()=>document.removeEventListener("click",D)});var M=xe(),I=ae(M);{var R=D=>{_i(D,{panelId:"frame-panel",title:"Edit Frame",initialRight:10,initialTop:160,width:280,height:520,minWidth:250,minHeight:450,maxWidth:500,maxHeight:700,resizable:!0,showClose:!0,onclose:v,children:(F,z)=>{var V=Kc(),tt=$(V);ao(tt,{get selectedLanguage(){return c(d)},onselect:S,accentColor:a});var de=T(tt,2),Ne=$(de),Ce=T($(Ne),2);$t(Ce,21,()=>Object.entries(to),Yt,(Q,fe)=>{var Ae=N(()=>bo(c(fe),2));let Je=()=>c(Ae)[0],it=()=>c(Ae)[1].label;var It=Zc();let wn;It.__click=()=>m(Je());var ho=$(It);K(()=>{wn=Pe(It,1,"size-btn svelte-ds1z4d",null,wn,{active:c(f)===Je()}),te(It,"title",it()),ge(ho,Je())}),E(Q,It)});var _e=T(Ne,2),nt=T($(_e),2);nt.__click=w;var ye=T(de,2),Me=$(ye),De=T($(Me),2);De.__input=g;var Te=T(Me,2),ht=$(Te),Xe=T($(ht),2);Xe.__change=_,$t(Xe,21,()=>Bl,Yt,(Q,fe)=>{var Ae=Yc(),Je=$(Ae),it={};K(()=>{ge(Je,`${c(fe)??""}px`),it!==(it=c(fe))&&(Ae.value=(Ae.__value=c(fe))??"")}),E(Q,Ae)});var ft;Da(Xe);var qe=T(Te,2),Ft=T($(qe),2);Ft.__input=p;var L=T(Ft,2);{var Y=Q=>{var fe=Wc();K(()=>te(fe,"href",c(u).url)),E(Q,fe)};U(L,Q=>{c(u).url&&Q(Y)})}var ie=T(qe,2);{let Q=N(()=>c(u).textColor??no);Fi(ie,{get colors(){return Xl},get selectedColor(){return c(Q)},onselect:k,label:"Text Color",accentColor:a})}var ke=T(ie,2);Fi(ke,{get colors(){return Nl},get selectedColor(){return c(u).backgroundColor},onselect:b,label:"Background Color",accentColor:a});var le=T(ke,2),We=T($(le),2);We.__click=x;var xt=$(We);gn(We,Q=>A(X,Q),()=>c(X));var Ht=T(We,2);{var qt=Q=>{var fe=Gc();$t(fe,21,()=>li,Yt,(Ae,Je)=>{var it=zc();let It;it.__click=()=>Z(c(Je).key);var wn=$(it);K(()=>{It=Pe(it,1,"style-item svelte-ds1z4d",null,It,{selected:c(u).frameKey===c(Je).key}),te(it,"title",c(Je).name),te(wn,"src",c(Je).path),te(wn,"alt",c(Je).name)}),E(Ae,it)}),gn(fe,Ae=>A(O,Ae),()=>c(O)),E(Q,fe)};U(Ht,Q=>{c(C)&&Q(qt)})}var gt=T(ye,2),Jt=$(gt);oe(Jt,{variant:"purple",onclick:v,children:(Q,fe)=>{var Ae=re("CONFIRM");E(Q,Ae)},$$slots:{default:!0}});var Qt=T(Jt,2);oe(Qt,{variant:"red",onclick:y,children:(Q,fe)=>{var Ae=re("DELETE");E(Q,Ae)},$$slots:{default:!0}}),K(Q=>{te(nt,"title",c(u).rotation===90?"Portrait (click to rotate)":"Landscape (click to rotate)"),ni(De,c(h)?.text??""),ft!==(ft=c(u).textSize??Kn)&&(Xe.value=(Xe.__value=c(u).textSize??Kn)??"",Pr(Xe,c(u).textSize??Kn)),ni(Ft,c(u).url??""),te(xt,"src",Q)},[()=>li.find(Q=>Q.key===c(u).frameKey)?.path??""]),E(F,V)},$$slots:{default:!0}})};U(I,D=>{r()&&c(u)&&D(R)})}E(t,M),he(),l()}et(["click","input","change"]);var jc=H('<div class="frame-text svelte-1vp2oo0"> </div>'),Vc=H('<div class="frame-content-layer svelte-1vp2oo0"></div>');function lo(t,e){ue(e,!0);const n=()=>P(Gr,"$placedFrames",d),i=()=>P(Wr,"$isBuilderMode",d),s=()=>P(bn,"$builderCameraInfo",d),r=()=>P(Hr,"$gameCameraInfo",d),o=()=>P(Qi,"$builderPreviewLanguage",d),l=()=>P(Mn,"$currentLanguage",d),a=()=>P(ns,"$draggingFramePositions",d),[d,u]=Ie();let h=N(n),f=N(()=>i()?s().scrollX:r().scrollX),g=N(()=>i()?s().scrollY:r().scrollY),p=N(()=>i()?s().zoom:r().zoom),b=N(()=>i()?o():l()),k=N(a);function _(v){const S=c(k).get(v.id);return S||{x:v.x,y:v.y}}function m(v){const S=v.scale??yt,C=v.rotation===90,{textWidth:O,textHeight:X}=Tn(S,C),Z=_(v),x=(Z.x-c(f))*c(p),M=(Z.y-c(g))*c(p);return{x,y:M,width:O*c(p),height:X*c(p)}}function w(v){return(v.texts.find(C=>C.language===c(b))||v.texts[0]||{text:""}).text||""}var y=Vc();$t(y,21,()=>c(h),v=>v.id,(v,S)=>{const C=N(()=>m(c(S))),O=N(()=>w(c(S))),X=N(()=>(c(S).textSize??Kn)*c(p)),Z=N(()=>c(S).textColor??no);var x=xe(),M=ae(x);{var I=R=>{var D=jc(),F=$(D);K(()=>{ce(D,`
          left: ${c(C).x??""}px;
          top: ${c(C).y??""}px;
          width: ${c(C).width??""}px;
          height: ${c(C).height??""}px;
          font-size: ${c(X)??""}px;
          color: ${c(Z)??""};
        `),ge(F,c(O))}),E(R,D)};U(M,R=>{c(O)&&R(I)})}E(v,x)}),E(t,y),he(),u()}var qc=H('<div class="temp-zone-button svelte-130i47e"><!></div>');function Jc(t,e){ue(e,!0);const n=()=>P(bn,"$builderCameraInfo",r),i=()=>P(Re,"$builderEditMode",r),s=()=>P(Rt,"$isDraggingInBuilder",r),[r,o]=Ie();let l=W(null),a=null,d=null,u=W(null);function h(_){a&&clearTimeout(a),A(l,_,!0),A(u,n()?.scrollX??null,!0),a=setTimeout(()=>{A(l,null),A(u,null)},2e3)}function f(){c(l)&&(we.emit(Se.DIALOG_ZONE_CREATE_AT,{worldX:c(l).worldX}),A(l,null),A(u,null),a&&(clearTimeout(a),a=null))}function g(){A(l,null),A(u,null),a&&(clearTimeout(a),a=null)}Xn(()=>{d=we.on(Se.TEMP_ZONE_BUTTON_SHOW,h);const _=we.on(Se.TEMP_ZONE_BUTTON_HIDE,g);return()=>{d?.unsubscribe(),_.unsubscribe()}}),Pa(()=>{a&&clearTimeout(a)}),Ee(()=>{i()!=="dialogs"&&(A(l,null),A(u,null))}),Ee(()=>{const _=n()?.scrollX;c(l)&&c(u)!==null&&_!==void 0&&Math.abs(_-c(u))>10&&(A(l,null),A(u,null),a&&(clearTimeout(a),a=null))});var p=xe(),b=ae(p);{var k=_=>{var m=qc(),w=$(m);oe(w,{variant:"cyan",width:"90px",onclick:f,children:(y,v)=>{var S=re("+ ZONE");E(y,S)},$$slots:{default:!0}}),K(()=>ce(m,`left: ${c(l).screenX??""}px; top: ${c(l).screenY-50}px;${s()?" pointer-events: none;":""}`)),E(_,m)};U(b,_=>{c(l)&&i()==="dialogs"&&_(k)})}E(t,p),he(),o()}var Qc=H('<div class="dialog-hint svelte-1titkrs"><div class="hint-content svelte-1titkrs"><span class="hint-icon svelte-1titkrs">💡</span> <span class="hint-text svelte-1titkrs">Tip: Use <strong class="svelte-1titkrs">FIT</strong> view for dialog zones</span> <button class="hint-action svelte-1titkrs">FIT NOW</button> <button class="hint-close svelte-1titkrs">✕</button></div></div>');function ed(t,e){ue(e,!0);const n=()=>P(Re,"$builderEditMode",s),i=()=>P(yn,"$isBuilderZoomedOut",s),[s,r]=Ie();let o=W(!1),l=W(!1),a=null;Ee(()=>{n()==="dialogs"&&!c(o)&&!i()&&(A(o,!0),A(l,!0),a=setTimeout(()=>{A(l,!1)},5e3))}),Ee(()=>{i()&&c(l)&&(A(l,!1),a&&(clearTimeout(a),a=null))});function d(){A(l,!1),a&&(clearTimeout(a),a=null)}function u(){ro(),d()}var h=xe(),f=ae(h);{var g=p=>{var b=Qc(),k=$(b),_=T($(k),4);_.__click=u;var m=T(_,2);m.__click=d,E(p,b)};U(f,p=>{c(l)&&p(g)})}E(t,h),he(),r()}et(["click"]);var td=H('<div class="item-controls svelte-1is3rex"><div class="controls-row svelte-1is3rex"><!> <!> <!> <!></div></div>');function nd(t,e){ue(e,!0);const n=()=>P(ss,"$selectedItem",u),i=()=>P(Kr,"$selectedItemScreenPosition",u),s=()=>P(es,"$selectedItemId",u),r=()=>P(zr,"$itemDepthLayer",u),o=()=>P(ll,"$selectedItemPhysicsEnabled",u),l=()=>P(cl,"$selectedItemFlipX",u),a=()=>P(Re,"$builderEditMode",u),d=()=>P(Rt,"$isDraggingInBuilder",u),[u,h]=Ie();let f=N(()=>n()?wl(n().assetKey):!1),g=N(()=>{const v=i();if(!v)return null;const S=10,C=40,O=c(f)?380:290;let X=v.screenY-v.itemHeight/2-45;const Z=S+C;X<Z&&(X=v.screenY+v.itemHeight/2+10);const x=window.innerHeight-C-S;X>x&&(X=x);let M=v.screenX;const I=O/2,R=I+S,D=window.innerWidth-I-S;return M<R&&(M=R),M>D&&(M=D),{x:M,y:X}});function p(){if(!s())return;const v=r()==="behind"?"front":"behind",S=qi(v);ul(),hl(s(),S)}function b(){s()&&fl(s(),!o())}function k(){s()&&gl(s(),!l())}function _(){s()&&(qr(s()),rs())}var m=xe(),w=ae(m);{var y=v=>{var S=td(),C=$(S),O=$(C);{let I=N(()=>r()==="behind"?"blue":"orange"),R=N(()=>o()?"Solid items must be behind player":"Toggle item depth: behind or in front of player");oe(O,{get variant(){return c(I)},get title(){return c(R)},onclick:p,get disabled(){return o()},children:(D,F)=>{var z=re();K(()=>ge(z,r()==="behind"?"Front":"Back")),E(D,z)},$$slots:{default:!0}})}var X=T(O,2);{let I=N(()=>l()?"orange":"blue");oe(X,{get variant(){return c(I)},title:"Flip item horizontally",onclick:k,children:(R,D)=>{var F=re("Flip");E(R,F)},$$slots:{default:!0}})}var Z=T(X,2);{var x=I=>{{let R=N(()=>o()?"orange":"blue");oe(I,{get variant(){return c(R)},title:"Toggle physics: item will block player movement",onclick:b,children:(D,F)=>{var z=re();K(()=>ge(z,o()?"Ghost":"Solid")),E(D,z)},$$slots:{default:!0}})}};U(Z,I=>{c(f)&&I(x)})}var M=T(Z,2);oe(M,{variant:"red",title:"Delete selected item",onclick:_,children:(I,R)=>{var D=re("DEL");E(I,D)},$$slots:{default:!0}}),K(()=>ce(S,`left: ${c(g).x??""}px; top: ${c(g).y??""}px;${d()?" pointer-events: none;":""}`)),E(v,S)};U(w,v=>{a()==="items"&&s()&&c(g)&&v(y)})}E(t,m),he(),h()}var id=H('<div class="frame-controls svelte-eqt3a9"><div class="controls-row svelte-eqt3a9"><!> <!></div></div>');function sd(t,e){ue(e,!0);const n=()=>P(Ur,"$selectedFrameScreenPosition",o),i=()=>P(mi,"$selectedFrameId",o),s=()=>P(Re,"$builderEditMode",o),r=()=>P(Rt,"$isDraggingInBuilder",o),[o,l]=Ie();let a=N(()=>{const p=n();if(!p)return null;const b=10,k=40,_=190;let m=p.screenY-p.frameHeight/2-45;const w=b+k;m<w&&(m=p.screenY+p.frameHeight/2+10);const y=window.innerHeight-k-b;m>y&&(m=y);let v=p.screenX;const S=_/2,C=S+b,O=window.innerWidth-S-b;return v<C&&(v=C),v>O&&(v=O),{x:v,y:m}});function d(){si()}function u(){i()&&(os(i()),an(null))}var h=xe(),f=ae(h);{var g=p=>{var b=id(),k=$(b),_=$(k);oe(_,{variant:"purple",title:"Edit frame content (or double-click)",onclick:d,children:(w,y)=>{var v=re("EDIT");E(w,v)},$$slots:{default:!0}});var m=T(_,2);oe(m,{variant:"red",title:"Delete selected frame",onclick:u,children:(w,y)=>{var v=re("DEL");E(w,v)},$$slots:{default:!0}}),K(()=>ce(b,`left: ${c(a).x??""}px; top: ${c(a).y??""}px;${r()?" pointer-events: none;":""}`)),E(p,b)};U(f,p=>{(s()==="frames"||s()==="items")&&i()&&c(a)&&p(g)})}E(t,h),he(),l()}var rd=H('<div class="zone-controls svelte-sm01rq"><div class="controls-row svelte-sm01rq"><!> <!></div></div>');function od(t,e){ue(e,!0);const n=()=>P(jr,"$selectedDialogZoneScreenPosition",o),i=()=>P(vi,"$selectedDialogZoneId",o),s=()=>P(Re,"$builderEditMode",o),r=()=>P(Rt,"$isDraggingInBuilder",o),[o,l]=Ie();let a=N(()=>{const p=n();if(!p)return null;const b=10,k=40,_=190;let m=p.screenY;const w=b+k,y=window.innerHeight-k-b;m<w&&(m=w),m>y&&(m=y);let v=p.screenX;const S=_/2,C=S+b,O=window.innerWidth-S-b;return v<C&&(v=C),v>O&&(v=O),{x:v,y:m}});function d(){Vr()}function u(){i()&&(Jr(i()),xn(null))}var h=xe(),f=ae(h);{var g=p=>{var b=rd(),k=$(b),_=$(k);oe(_,{variant:"cyan",title:"Edit zone content (or double-click)",onclick:d,children:(w,y)=>{var v=re("EDIT");E(w,v)},$$slots:{default:!0}});var m=T(_,2);oe(m,{variant:"red",title:"Delete selected zone",onclick:u,children:(w,y)=>{var v=re("DEL");E(w,v)},$$slots:{default:!0}}),K(()=>ce(b,`left: ${c(a).x??""}px; top: ${c(a).y??""}px;${r()?" pointer-events: none;":""}`)),E(p,b)};U(f,p=>{s()==="dialogs"&&i()&&c(a)&&p(g)})}E(t,h),he(),l()}var ad=H('<div class="hstack svelte-8vtf35"><!></div>');function ld(t,e){let n=ee(e,"gap",3,"10px"),i=ee(e,"align",3,"center");var s=ad(),r=$(s);fn(r,()=>e.children??Ve),K(()=>ce(s,`gap: ${n()??""}; align-items: ${(i()==="start"?"flex-start":i()==="end"?"flex-end":i())??""};`)),E(t,s)}var cd=H('<div class="vstack svelte-1y4dqnf"><!></div>');function dd(t,e){let n=ee(e,"gap",3,"10px"),i=ee(e,"align",3,"stretch");var s=cd(),r=$(s);fn(r,()=>e.children??Ve),K(()=>ce(s,`gap: ${n()??""}; align-items: ${(i()==="start"?"flex-start":i()==="end"?"flex-end":i())??""};`)),E(t,s)}var ud=H("<div><!></div>");function Gs(t,e){const n=()=>P(Rt,"$isDraggingInBuilder",i),[i,s]=Ie();let r=ee(e,"padding",3,"10px");var o=ud();let l;var a=$(o);fn(a,()=>e.children??Ve),K(()=>{l=Pe(o,1,`fixed fixed--${e.position??""}`,"svelte-vwlo0e",l,{"dragging-in-builder":n()}),ce(o,`--padding: ${r()??""};`)}),E(t,o),s()}var hd=H("<div><!> <!> <!></div>"),fd=H("<!> <!>",1),gd=H("<!> <!> <!>",1),pd=H("<div><!></div>"),vd=H("<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!>",1);function md(t,e){ue(e,!0);const n=()=>P(es,"$selectedItemId",u),i=()=>P(mi,"$selectedFrameId",u),s=()=>P(vi,"$selectedDialogZoneId",u),r=()=>P(Re,"$builderEditMode",u),o=()=>P(yn,"$isBuilderZoomedOut",u),l=()=>P(pi,"$gridSnappingEnabled",u),a=()=>P(cn,"$isAssetPaletteOpen",u),d=()=>P(Zt,"$isFramePaletteOpen",u),[u,h]=Ie(),f=600;let g=W(Ke(typeof window<"u"?window.innerWidth<f:!1)),p=N(()=>c(g)&&(n()!==null||i()!==null||s()!==null));Ee(()=>{function V(){A(g,window.innerWidth<f)}return window.addEventListener("resize",V),()=>window.removeEventListener("resize",V)});function b(){fc()}function k(){ro()}function _(){el()}function m(){we.emit(Se.DIALOG_ZONE_CREATE)}var w=vd(),y=ae(w);nd(y,{});var v=T(y,2);sd(v,{});var S=T(v,2);od(S,{});var C=T(S,2);{var O=V=>{wc(V,{})},X=V=>{var tt=xe(),de=ae(tt);{var Ne=_e=>{Bc(_e,{})},Ce=_e=>{var nt=xe(),ye=ae(nt);{var Me=De=>{Ic(De,{})};U(ye,De=>{r()==="frames"&&De(Me)},!0)}E(_e,nt)};U(de,_e=>{r()==="dialogs"?_e(Ne):_e(Ce,!1)},!0)}E(V,tt)};U(C,V=>{r()==="items"?V(O):V(X,!1)})}var Z=T(C,2);Uc(Z,{});var x=T(Z,2);lo(x,{});var M=T(x,2);Tc(M,{});var I=T(M,2);Ac(I,{});var R=T(I,2);Jc(R,{});var D=T(R,2);ed(D,{});var F=T(D,2);Gs(F,{position:"top-left",children:(V,tt)=>{var de=hd();let Ne;var Ce=$(de);oe(Ce,{variant:"green",width:"100px",onclick:b,children:(ye,Me)=>{var De=re("SAVE");E(ye,De)},$$slots:{default:!0}});var _e=T(Ce,2);{let ye=N(()=>o()?"orange":"blue");oe(_e,{get variant(){return c(ye)},width:"80px",onclick:k,title:"Toggle zoom (F)",children:(Me,De)=>{var Te=re();K(()=>ge(Te,o()?"1:1":"FIT")),E(Me,Te)},$$slots:{default:!0}})}var nt=T(_e,2);{let ye=N(()=>l()?"blue":"orange");oe(nt,{get variant(){return c(ye)},width:"80px",onclick:_,title:"Toggle grid snapping",children:(Me,De)=>{var Te=re();K(()=>ge(Te,l()?"FREE":"SNAP")),E(Me,Te)},$$slots:{default:!0}})}K(()=>Ne=Pe(de,1,"left-buttons svelte-1vm8op7",null,Ne,{"hide-left":c(p)})),E(V,de)},$$slots:{default:!0}});var z=T(F,2);Gs(z,{position:"top-right",children:(V,tt)=>{var de=pd();let Ne;var Ce=$(de);dd(Ce,{align:"end",children:(_e,nt)=>{var ye=gd(),Me=ae(ye);{let ht=N(()=>r()==="items"&&a()?"orange":"blue");oe(Me,{get variant(){return c(ht)},onclick:()=>{r()==="items"?tl():(Yn("items"),cn.set(!0))},title:"Edit assets/items",children:(Xe,ft)=>{var qe=re("ASSETS");E(Xe,qe)},$$slots:{default:!0}})}var De=T(Me,2);{let ht=N(()=>r()==="frames"&&d()?"orange":"purple");oe(De,{get variant(){return c(ht)},onclick:()=>{r()==="frames"?nl():(Yn("frames"),Zt.set(!0))},title:"Edit text frames",children:(Xe,ft)=>{var qe=re("FRAMES");E(Xe,qe)},$$slots:{default:!0}})}var Te=T(De,2);ld(Te,{children:(ht,Xe)=>{var ft=fd(),qe=ae(ft);{var Ft=Y=>{oe(Y,{variant:"cyan",width:"100px",onclick:m,title:"Create new dialog zone at center of view",children:(ie,ke)=>{var le=re("+ ZONE");E(ie,le)},$$slots:{default:!0}})};U(qe,Y=>{r()==="dialogs"&&Y(Ft)})}var L=T(qe,2);{let Y=N(()=>r()==="dialogs"?"orange":"cyan");oe(L,{get variant(){return c(Y)},onclick:()=>{r()==="dialogs"?Yn("items"):Yn("dialogs")},title:"Edit dialog zones",children:(ie,ke)=>{var le=re("DIALOGS");E(ie,le)},$$slots:{default:!0}})}E(ht,ft)},$$slots:{default:!0}}),E(_e,ye)},$$slots:{default:!0}}),K(()=>Ne=Pe(de,1,"right-buttons svelte-1vm8op7",null,Ne,{"hide-right":c(p)})),E(V,de)},$$slots:{default:!0}}),E(t,w),he(),h()}var _d=H("<div> </div>"),yd=H('<div class="dialog-content svelte-1jd14ss"> </div>'),bd=H("<div><!> <!></div>");function wd(t,e){ue(e,!0);const n=()=>P(Xa,"$activeDialogText",s),i=()=>P(Fr,"$playerScreenPosition",s),[s,r]=Ie();let o=N(()=>n()?.title&&n()?.content),l=N(()=>Math.max(10,window.innerHeight-i().y+Fc)),a=N(()=>window.innerWidth<=Rc),d=N(()=>c(a)?50:i().x),u=N(()=>c(a)?"percent":"px");var h=xe(),f=ae(h);{var g=p=>{var b=bd();let k;var _=$(b);{var m=v=>{var S=_d();let C;var O=$(S);K(()=>{C=Pe(S,1,"dialog-title svelte-1jd14ss",null,C,{"has-divider":c(o)}),ge(O,n().title)}),E(v,S)};U(_,v=>{n().title&&v(m)})}var w=T(_,2);{var y=v=>{var S=yd(),C=$(S);K(()=>ge(C,n().content)),E(v,S)};U(w,v=>{n().content&&v(y)})}K(()=>{k=Pe(b,1,"dialog-bubble svelte-1jd14ss",null,k,{narrow:c(a)}),ce(b,`bottom: ${c(l)??""}px; left: ${c(d)??""}${c(u)??""};`)}),E(p,b)};U(f,p=>{n()&&p(g)})}E(t,h),he(),r()}var Sd=H("<!> <!>",1),Ed=H('<div class="touch-controls"><p class="touch-text">Tap and hold<br/>where you want<br/>to move</p></div>'),xd=H('<div class="desktop-controls"><div class="key-row"><div class="pixel-key">A</div> <div class="pixel-key">W</div> <div class="pixel-key">D</div></div> <p class="or-text">or</p> <div class="key-row"><div class="pixel-key">←</div> <div class="pixel-key">↑</div> <div class="pixel-key">→</div></div></div>'),Id=H('<div class="loader-overlay"><div class="pixel-loader"></div></div>'),Cd=H('<div class="game-ui-wrapper svelte-13dvmla"><!> <!> <!> <dialog class="pixel-dialog"><h1>CONTROLS</h1> <div class="controls-content"><!></div></dialog> <!></div>');function Dd(t,e){ue(e,!1);const n=()=>P(En,"$showControlsDialog",a),i=()=>P(Lr,"$hasPlayerMoved",a),s=()=>P(Wr,"$isBuilderMode",a),r=()=>P(Mn,"$currentLanguage",a),o=()=>P(Or,"$isTouchDevice",a),l=()=>P(Li,"$isLoading",a),[a,d]=Ie();let u=Gi();function h(){const I=so.toggleLanguage();Mn.set(I)}function f(I){!c(u)?.open||I.target.closest(".pixel-button")||En.set(!1)}function g(){const I=uc();if(!I){console.error("Cannot enter builder mode: map config not found");return}hc(I)}ps(()=>(c(u),n()),()=>{c(u)&&(n()?c(u).showModal():c(u).close())}),ps(()=>(i(),c(u),En),()=>{i()&&c(u)?.open&&En.set(!1)}),ga(),$a();var p=Cd();Ot("pointerdown",nr,f);var b=$(p);{var k=I=>{md(I,{})},_=I=>{var R=Sd(),D=ae(R);wd(D,{});var F=T(D,2);lo(F,{}),E(I,R)};U(b,I=>{s()?I(k):I(_,!1)})}var m=T(b,2);{var w=I=>{oe(I,{position:"top-left",variant:"green",width:"120px",onclick:g,title:"Toggle Builder Mode",children:(R,D)=>{var F=re("BUILD");E(R,F)},$$slots:{default:!0}})};U(m,I=>{s()||I(w)})}var y=T(m,2);{var v=I=>{oe(I,{position:"top-right",variant:"default",width:"100px",onclick:h,title:"Toggle Language (L)",children:(R,D)=>{var F=re();K(z=>ge(F,z),[()=>(r(),Lt(()=>r().toUpperCase()))]),E(R,F)},$$slots:{default:!0}})};U(y,I=>{s()||I(v)})}var S=T(y,2),C=T($(S),2),O=$(C);{var X=I=>{var R=Ed();E(I,R)},Z=I=>{var R=xd();E(I,R)};U(O,I=>{o()?I(X):I(Z,!1)})}gn(S,I=>A(u,I),()=>c(u));var x=T(S,2);{var M=I=>{var R=Id();E(I,R)};U(x,I=>{l()&&I(M)})}E(t,p),he(),d()}const co=document.getElementById("game-ui");if(!co)throw new Error("game-ui element not found!");Sa(Dd,{target:co});Mn.set(so.getLanguage());Ha.set(Nr.getSkin());Na.set(ii.getCurrentConfig().name);const Td={type:B.AUTO,width:800,height:600,parent:"game-container",backgroundColor:"#000000",pixelArt:!0,roundPixels:!0,scale:{mode:B.Scale.RESIZE,autoCenter:B.Scale.CENTER_BOTH},physics:{default:"arcade",arcade:{gravity:{y:1e3,x:0},debug:!1}},audio:{noAudio:!0},scene:[Vl,ac]},uo=new B.Game(Td);dc(uo);const kd=uo.device.input.touch;Or.set(kd);const Ad=performance.getEntriesByType("navigation")[0]&&performance.getEntriesByType("navigation")[0].type==="reload",$d=sessionStorage.getItem("hasSeenControlsHint");(!$d||Ad)&&(sessionStorage.setItem("hasSeenControlsHint","true"),En.set(!0));
//# sourceMappingURL=index-CaJvR6F-.js.map
