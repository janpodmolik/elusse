import{r as ra,g as aa}from"./phaser-DFK5Ua9d.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();var oa=ra();const B=aa(oa),xi=!1;var Li=Array.isArray,la=Array.prototype.indexOf,Ri=Array.from,Xs=Object.defineProperty,wn=Object.getOwnPropertyDescriptor,Ys=Object.getOwnPropertyDescriptors,ca=Object.prototype,da=Array.prototype,Fi=Object.getPrototypeOf,ss=Object.isExtensible;const Ze=()=>{};function ua(t){return t()}function Un(t){for(var e=0;e<t.length;e++)t[e]()}function Zs(){var t,e,n=new Promise((i,s)=>{t=i,e=s});return{promise:n,resolve:t,reject:e}}function ha(t,e){if(Array.isArray(t))return t;if(!(Symbol.iterator in t))return Array.from(t);const n=[];for(const i of t)if(n.push(i),n.length===e)break;return n}const _e=2,Hi=4,oi=8,fa=1<<24,ft=16,gt=32,Bt=64,li=128,Ue=512,ve=1024,Ae=2048,it=4096,Oe=8192,wt=16384,Ni=32768,Rt=65536,rs=1<<17,Ws=1<<18,cn=1<<19,zs=1<<20,Ft=32768,Ii=1<<21,Bi=1<<22,St=1<<23,Et=Symbol("$state"),ga=Symbol(""),Jt=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Gs(t){return t===this.v}function Ks(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function Us(t){return!Ks(t,this.v)}function js(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function pa(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function va(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function ma(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function _a(t){throw new Error("https://svelte.dev/e/effect_orphan")}function ya(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function ba(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function wa(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Sa(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function Ea(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}let $n=!1,xa=!1;function Ia(){$n=!0}const Ca=1,Ta=2,Da=16,ka=1,Aa=2,ye=Symbol(),Ma="http://www.w3.org/1999/xhtml";let ne=null;function nn(t){ne=t}function de(t,e=!1,n){ne={p:ne,i:!1,c:null,e:null,s:t,x:null,l:$n&&!e?{s:null,u:null,$:[]}:null}}function ue(t){var e=ne,n=e.e;if(n!==null){e.e=null;for(var i of n)vr(i)}return e.i=!0,ne=e.p,{}}function On(){return!$n||ne!==null&&ne.l===null}let Qt=[];function Pa(){var t=Qt;Qt=[],Un(t)}function Ln(t){if(Qt.length===0){var e=Qt;queueMicrotask(()=>{e===Qt&&Pa()})}Qt.push(t)}function $a(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Oa(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function Ke(t){if(typeof t!="object"||t===null||Et in t)return t;const e=Fi(t);if(e!==ca&&e!==da)return t;var n=new Map,i=Li(t),s=Y(0),r=Lt,a=o=>{if(Lt===r)return o();var l=z,d=Lt;De(null),ds(r);var u=o();return De(l),ds(d),u};return i&&n.set("length",Y(t.length)),new Proxy(t,{defineProperty(o,l,d){(!("value"in d)||d.configurable===!1||d.enumerable===!1||d.writable===!1)&&ba();var u=n.get(l);return u===void 0?u=a(()=>{var f=Y(d.value);return n.set(l,f),f}):P(u,d.value,!0),!0},deleteProperty(o,l){var d=n.get(l);if(d===void 0){if(l in o){const u=a(()=>Y(ye));n.set(l,u),Sn(s)}}else P(d,ye),Sn(s);return!0},get(o,l,d){if(l===Et)return t;var u=n.get(l),f=l in o;if(u===void 0&&(!f||wn(o,l)?.writable)&&(u=a(()=>{var p=Ke(f?o[l]:ye),v=Y(p);return v}),n.set(l,u)),u!==void 0){var g=c(u);return g===ye?void 0:g}return Reflect.get(o,l,d)},getOwnPropertyDescriptor(o,l){var d=Reflect.getOwnPropertyDescriptor(o,l);if(d&&"value"in d){var u=n.get(l);u&&(d.value=c(u))}else if(d===void 0){var f=n.get(l),g=f?.v;if(f!==void 0&&g!==ye)return{enumerable:!0,configurable:!0,value:g,writable:!0}}return d},has(o,l){if(l===Et)return!0;var d=n.get(l),u=d!==void 0&&d.v!==ye||Reflect.has(o,l);if(d!==void 0||V!==null&&(!u||wn(o,l)?.writable)){d===void 0&&(d=a(()=>{var g=u?Ke(o[l]):ye,p=Y(g);return p}),n.set(l,d));var f=c(d);if(f===ye)return!1}return u},set(o,l,d,u){var f=n.get(l),g=l in o;if(i&&l==="length")for(var p=d;p<f.v;p+=1){var v=n.get(p+"");v!==void 0?P(v,ye):p in o&&(v=a(()=>Y(ye)),n.set(p+"",v))}if(f===void 0)(!g||wn(o,l)?.writable)&&(f=a(()=>Y(void 0)),P(f,Ke(d)),n.set(l,f));else{g=f.v!==ye;var E=a(()=>Ke(d));P(f,E)}var k=Reflect.getOwnPropertyDescriptor(o,l);if(k?.set&&k.set.call(u,d),!g){if(i&&typeof l=="string"){var h=n.get("length"),m=Number(l);Number.isInteger(m)&&m>=h.v&&P(h,m+1)}Sn(s)}return!0},ownKeys(o){c(s);var l=Reflect.ownKeys(o).filter(f=>{var g=n.get(f);return g===void 0||g.v!==ye});for(var[d,u]of n)u.v!==ye&&!(d in o)&&l.push(d);return l},setPrototypeOf(){wa()}})}function as(t){try{if(t!==null&&typeof t=="object"&&Et in t)return t[Et]}catch{}return t}function La(t,e){return Object.is(as(t),as(e))}var os,Vs,qs,Js,Qs;function Ra(){if(os===void 0){os=window,Vs=document,qs=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,n=Text.prototype;Js=wn(e,"firstChild").get,Qs=wn(e,"nextSibling").get,ss(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),ss(n)&&(n.__t=void 0)}}function ht(t=""){return document.createTextNode(t)}function jn(t){return Js.call(t)}function Rn(t){return Qs.call(t)}function O(t,e){return jn(t)}function re(t,e=!1){{var n=jn(t);return n instanceof Comment&&n.data===""?Rn(n):n}}function T(t,e=1,n=!1){let i=t;for(;e--;)i=Rn(i);return i}function Fa(t){t.textContent=""}function er(){return!1}function tr(t){var e=V;if(e===null)return z.f|=St,t;if((e.f&Ni)===0){if((e.f&li)===0)throw t;e.b.error(t)}else sn(t,e)}function sn(t,e){for(;e!==null;){if((e.f&li)!==0)try{e.b.error(t);return}catch(n){t=n}e=e.parent}throw t}const Bn=new Set;let se=null,Xe=null,Qe=[],Xi=null,Ci=!1;class et{committed=!1;current=new Map;previous=new Map;#e=new Set;#t=new Set;#i=0;#n=0;#l=null;#r=[];#s=[];skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#n>0}process(e){Qe=[],this.apply();var n={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const i of e)this.#a(i,n);this.is_fork||this.#d(),this.is_deferred()?(this.#o(n.effects),this.#o(n.render_effects),this.#o(n.block_effects)):(se=null,ls(n.render_effects),ls(n.effects),this.#l?.resolve()),Xe=null}#a(e,n){e.f^=ve;for(var i=e.first;i!==null;){var s=i.f,r=(s&(gt|Bt))!==0,a=r&&(s&ve)!==0,o=a||(s&Oe)!==0||this.skipped_effects.has(i);if((i.f&li)!==0&&i.b?.is_pending()&&(n={parent:n,effect:i,effects:[],render_effects:[],block_effects:[]}),!o&&i.fn!==null){r?i.f^=ve:(s&Hi)!==0?n.effects.push(i):un(i)&&((i.f&ft)!==0&&n.block_effects.push(i),rn(i));var l=i.first;if(l!==null){i=l;continue}}var d=i.parent;for(i=i.next;i===null&&d!==null;)d===n.effect&&(this.#o(n.effects),this.#o(n.render_effects),this.#o(n.block_effects),n=n.parent),i=d.next,d=d.parent}}#o(e){for(const n of e)((n.f&Ae)!==0?this.#r:this.#s).push(n),this.#c(n.deps),me(n,ve)}#c(e){if(e!==null)for(const n of e)(n.f&_e)===0||(n.f&Ft)===0||(n.f^=Ft,this.#c(n.deps))}capture(e,n){this.previous.has(e)||this.previous.set(e,n),(e.f&St)===0&&(this.current.set(e,e.v),Xe?.set(e,e.v))}activate(){se=this,this.apply()}deactivate(){se===this&&(se=null,Xe=null)}flush(){if(this.activate(),Qe.length>0){if(Ha(),se!==null&&se!==this)return}else this.#i===0&&this.process([]);this.deactivate()}discard(){for(const e of this.#t)e(this);this.#t.clear()}#d(){if(this.#n===0){for(const e of this.#e)e();this.#e.clear()}this.#i===0&&this.#u()}#u(){if(Bn.size>1){this.previous.clear();var e=Xe,n=!0,i={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const r of Bn){if(r===this){n=!1;continue}const a=[];for(const[l,d]of this.current){if(r.current.has(l))if(n&&d!==r.current.get(l))r.current.set(l,d);else continue;a.push(l)}if(a.length===0)continue;const o=[...r.current.keys()].filter(l=>!this.current.has(l));if(o.length>0){var s=Qe;Qe=[];const l=new Set,d=new Map;for(const u of a)nr(u,o,l,d);if(Qe.length>0){se=r,r.apply();for(const u of Qe)r.#a(u,i);r.deactivate()}Qe=s}}se=null,Xe=e}this.committed=!0,Bn.delete(this)}increment(e){this.#i+=1,e&&(this.#n+=1)}decrement(e){this.#i-=1,e&&(this.#n-=1),this.revive()}revive(){for(const e of this.#r)me(e,Ae),Ht(e);for(const e of this.#s)me(e,it),Ht(e);this.#r=[],this.#s=[],this.flush()}oncommit(e){this.#e.add(e)}ondiscard(e){this.#t.add(e)}settled(){return(this.#l??=Zs()).promise}static ensure(){if(se===null){const e=se=new et;Bn.add(se),et.enqueue(()=>{se===e&&e.flush()})}return se}static enqueue(e){Ln(e)}apply(){}}function Ha(){var t=Ct;Ci=!0;var e=null;try{var n=0;for(qn(!0);Qe.length>0;){var i=et.ensure();if(n++>1e3){var s,r;Na()}i.process(Qe),It.clear()}}finally{Ci=!1,qn(t),Xi=null}}function Na(){try{ya()}catch(t){sn(t,Xi)}}let lt=null;function ls(t){var e=t.length;if(e!==0){for(var n=0;n<e;){var i=t[n++];if((i.f&(wt|Oe))===0&&un(i)&&(lt=new Set,rn(i),i.deps===null&&i.first===null&&i.nodes_start===null&&(i.teardown===null&&i.ac===null?yr(i):i.fn=null),lt?.size>0)){It.clear();for(const s of lt){if((s.f&(wt|Oe))!==0)continue;const r=[s];let a=s.parent;for(;a!==null;)lt.has(a)&&(lt.delete(a),r.push(a)),a=a.parent;for(let o=r.length-1;o>=0;o--){const l=r[o];(l.f&(wt|Oe))===0&&rn(l)}}lt.clear()}}lt=null}}function nr(t,e,n,i){if(!n.has(t)&&(n.add(t),t.reactions!==null))for(const s of t.reactions){const r=s.f;(r&_e)!==0?nr(s,e,n,i):(r&(Bi|ft))!==0&&(r&Ae)===0&&ir(s,e,i)&&(me(s,Ae),Ht(s))}}function ir(t,e,n){const i=n.get(t);if(i!==void 0)return i;if(t.deps!==null)for(const s of t.deps){if(e.includes(s))return!0;if((s.f&_e)!==0&&ir(s,e,n))return n.set(s,!0),!0}return n.set(t,!1),!1}function Ht(t){for(var e=Xi=t;e.parent!==null;){e=e.parent;var n=e.f;if(Ci&&e===V&&(n&ft)!==0&&(n&Ws)===0)return;if((n&(Bt|gt))!==0){if((n&ve)===0)return;e.f^=ve}}Qe.push(e)}function Ba(t){let e=0,n=Nt(0),i;return()=>{Tn()&&(c(n),ui(()=>(e===0&&(i=Dt(()=>t(()=>Sn(n)))),e+=1,()=>{Ln(()=>{e-=1,e===0&&(i?.(),i=void 0,Sn(n))})})))}}var Xa=Rt|cn|li;function Ya(t,e,n){new Za(t,e,n)}class Za{parent;#e=!1;#t;#i=null;#n;#l;#r;#s=null;#a=null;#o=null;#c=null;#d=null;#u=0;#h=0;#g=!1;#f=null;#y=Ba(()=>(this.#f=Nt(this.#u),()=>{this.#f=null}));constructor(e,n,i){this.#t=e,this.#n=n,this.#l=i,this.parent=V.b,this.#e=!!this.#n.pending,this.#r=hi(()=>{V.b=this;{var s=this.#m();try{this.#s=Be(()=>i(s))}catch(r){this.error(r)}this.#h>0?this.#v():this.#e=!1}return()=>{this.#d?.remove()}},Xa)}#b(){try{this.#s=Be(()=>this.#l(this.#t))}catch(e){this.error(e)}this.#e=!1}#w(){const e=this.#n.pending;e&&(this.#a=Be(()=>e(this.#t)),et.enqueue(()=>{var n=this.#m();this.#s=this.#p(()=>(et.ensure(),Be(()=>this.#l(n)))),this.#h>0?this.#v():(tn(this.#a,()=>{this.#a=null}),this.#e=!1)}))}#m(){var e=this.#t;return this.#e&&(this.#d=ht(),this.#t.before(this.#d),e=this.#d),e}is_pending(){return this.#e||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!this.#n.pending}#p(e){var n=V,i=z,s=ne;nt(this.#r),De(this.#r),nn(this.#r.ctx);try{return e()}catch(r){return tr(r),null}finally{nt(n),De(i),nn(s)}}#v(){const e=this.#n.pending;this.#s!==null&&(this.#c=document.createDocumentFragment(),this.#c.append(this.#d),Sr(this.#s,this.#c)),this.#a===null&&(this.#a=Be(()=>e(this.#t)))}#_(e){if(!this.has_pending_snippet()){this.parent&&this.parent.#_(e);return}this.#h+=e,this.#h===0&&(this.#e=!1,this.#a&&tn(this.#a,()=>{this.#a=null}),this.#c&&(this.#t.before(this.#c),this.#c=null))}update_pending_count(e){this.#_(e),this.#u+=e,this.#f&&In(this.#f,this.#u)}get_effect_pending(){return this.#y(),c(this.#f)}error(e){var n=this.#n.onerror;let i=this.#n.failed;if(this.#g||!n&&!i)throw e;this.#s&&(ke(this.#s),this.#s=null),this.#a&&(ke(this.#a),this.#a=null),this.#o&&(ke(this.#o),this.#o=null);var s=!1,r=!1;const a=()=>{if(s){Oa();return}s=!0,r&&Ea(),et.ensure(),this.#u=0,this.#o!==null&&tn(this.#o,()=>{this.#o=null}),this.#e=this.has_pending_snippet(),this.#s=this.#p(()=>(this.#g=!1,Be(()=>this.#l(this.#t)))),this.#h>0?this.#v():this.#e=!1};var o=z;try{De(null),r=!0,n?.(e,a),r=!1}catch(l){sn(l,this.#r&&this.#r.parent)}finally{De(o)}i&&Ln(()=>{this.#o=this.#p(()=>{et.ensure(),this.#g=!0;try{return Be(()=>{i(this.#t,()=>e,()=>a)})}catch(l){return sn(l,this.#r.parent),null}finally{this.#g=!1}})})}}function Ot(t,e){return e}function Wa(t,e,n){for(var i=[],s=e.length,r=0;r<s;r++)zi(e[r].e,i,!0);br(i,()=>{var a=i.length===0&&n!==null;if(a){var o=n,l=o.parentNode;Fa(l),l.append(o),t.items.clear(),Je(t,e[0].prev,e[s-1].next)}for(var d=0;d<s;d++){var u=e[d];a||(t.items.delete(u.k),Je(t,u.prev,u.next)),ke(u.e,!a)}t.first===e[0]&&(t.first=e[0].prev)})}function xt(t,e,n,i,s,r=null){var a=t,o=new Map,l=null;{var d=t;a=d.appendChild(ht())}var u=null,f=$t(()=>{var h=n();return Li(h)?h:h==null?[]:Ri(h)}),g,p=!0;function v(){za(k,g,a,e,i),u!==null&&(g.length===0?(u.fragment?(a.before(u.fragment),u.fragment=null):Gi(u.effect),E.first=u.effect):tn(u.effect,()=>{u=null}))}var E=hi(()=>{g=c(f);for(var h=g.length,m=new Set,y=se,I=null,_=er(),w=0;w<h;w+=1){var A=g[w],$=i(A,w),M=p?null:o.get($);M?(In(M.v,A),M.i=w,_&&y.skipped_effects.delete(M.e)):(M=Ga(p?a:null,I,A,$,w,s,e,n),p&&(M.o=!0,I===null?l=M:I.next=M,I=M),o.set($,M)),m.add($)}if(h===0&&r&&!u)if(p)u={fragment:null,effect:Be(()=>r(a))};else{var U=document.createDocumentFragment(),x=ht();U.append(x),u={fragment:U,effect:Be(()=>r(x))}}if(!p)if(_){for(const[L,S]of o)m.has(L)||y.skipped_effects.add(S.e);y.oncommit(v),y.ondiscard(()=>{})}else v();c(f)}),k={effect:E,items:o,first:l};p=!1}function za(t,e,n,i,s){var r=e.length,a=t.items,o=t.first,l,d=null,u=[],f=[],g,p,v,E;for(E=0;E<r;E+=1){if(g=e[E],p=s(g,E),v=a.get(p),t.first??=v,!v.o){v.o=!0;var k=d?d.next:o;Je(t,d,v),Je(t,v,k),vi(v,k,n),d=v,u=[],f=[],o=d.next;continue}if((v.e.f&Oe)!==0&&Gi(v.e),v!==o){if(l!==void 0&&l.has(v)){if(u.length<f.length){var h=f[0],m;d=h.prev;var y=u[0],I=u[u.length-1];for(m=0;m<u.length;m+=1)vi(u[m],h,n);for(m=0;m<f.length;m+=1)l.delete(f[m]);Je(t,y.prev,I.next),Je(t,d,y),Je(t,I,h),o=h,d=I,E-=1,u=[],f=[]}else l.delete(v),vi(v,o,n),Je(t,v.prev,v.next),Je(t,v,d===null?t.first:d.next),Je(t,d,v),d=v;continue}for(u=[],f=[];o!==null&&o.k!==p;)(o.e.f&Oe)===0&&(l??=new Set).add(o),f.push(o),o=o.next;if(o===null)continue;v=o}u.push(v),d=v,o=v.next}if(o!==null||l!==void 0){for(var _=l===void 0?[]:Ri(l);o!==null;)(o.e.f&Oe)===0&&_.push(o),o=o.next;var w=_.length;if(w>0){var A=r===0?n:null;Wa(t,_,A)}}}function Ga(t,e,n,i,s,r,a,o){var l=(a&Ca)!==0,d=(a&Da)===0,u=l?d?Zi(n,!1,!1):Nt(n):n,f=(a&Ta)===0?s:Nt(s),g={i:f,v:u,k:i,a:null,e:null,o:!1,prev:e,next:null};try{if(t===null){var p=document.createDocumentFragment();p.append(t=ht())}return g.e=Be(()=>r(t,u,f,o)),e!==null&&(e.next=g),g}finally{}}function vi(t,e,n){for(var i=t.next?t.next.e.nodes_start:n,s=e?e.e.nodes_start:n,r=t.e.nodes_start;r!==null&&r!==i;){var a=Rn(r);s.before(r),r=a}}function Je(t,e,n){e===null?(t.first=n,t.effect.first=n&&n.e):(e.e.next&&(e.e.next.prev=null),e.next=n,e.e.next=n&&n.e),n===null?t.effect.last=e&&e.e:(n.e.prev&&(n.e.prev.next=null),n.prev=e,n.e.prev=e&&e.e)}function Ka(t,e,n,i){const s=On()?ci:$t;if(n.length===0&&t.length===0){i(e.map(s));return}var r=se,a=V,o=Ua();function l(){Promise.all(n.map(d=>ja(d))).then(d=>{o();try{i([...e.map(s),...d])}catch(u){(a.f&wt)===0&&sn(u,a)}r?.deactivate(),Vn()}).catch(d=>{sn(d,a)})}t.length>0?Promise.all(t).then(()=>{o();try{return l()}finally{r?.deactivate(),Vn()}}):l()}function Ua(){var t=V,e=z,n=ne,i=se;return function(r=!0){nt(t),De(e),nn(n),r&&i?.activate()}}function Vn(){nt(null),De(null),nn(null)}function ci(t){var e=_e|Ae,n=z!==null&&(z.f&_e)!==0?z:null;return V!==null&&(V.f|=cn),{ctx:ne,deps:null,effects:null,equals:Gs,f:e,fn:t,reactions:null,rv:0,v:ye,wv:0,parent:n??V,ac:null}}function ja(t,e){let n=V;n===null&&pa();var i=n.b,s=void 0,r=Nt(ye),a=!z,o=new Map;return oo(()=>{var l=Zs();s=l.promise;try{Promise.resolve(t()).then(l.resolve,l.reject).then(()=>{d===se&&d.committed&&d.deactivate(),Vn()})}catch(g){l.reject(g),Vn()}var d=se;if(a){var u=!i.is_pending();i.update_pending_count(1),d.increment(u),o.get(d)?.reject(Jt),o.delete(d),o.set(d,l)}const f=(g,p=void 0)=>{if(d.activate(),p)p!==Jt&&(r.f|=St,In(r,p));else{(r.f&St)!==0&&(r.f^=St),In(r,g);for(const[v,E]of o){if(o.delete(v),v===d)break;E.reject(Jt)}}a&&(i.update_pending_count(-1),d.decrement(u))};l.promise.then(f,g=>f(null,g||"unknown"))}),di(()=>{for(const l of o.values())l.reject(Jt)}),new Promise(l=>{function d(u){function f(){u===s?l(r):d(s)}u.then(f,f)}d(s)})}function X(t){const e=ci(t);return lr(e),e}function $t(t){const e=ci(t);return e.equals=Us,e}function sr(t){var e=t.effects;if(e!==null){t.effects=null;for(var n=0;n<e.length;n+=1)ke(e[n])}}function Va(t){for(var e=t.parent;e!==null;){if((e.f&_e)===0)return(e.f&wt)===0?e:null;e=e.parent}return null}function Yi(t){var e,n=V;nt(Va(t));try{t.f&=~Ft,sr(t),e=hr(t)}finally{nt(n)}return e}function rr(t){var e=Yi(t);if(t.equals(e)||(se?.is_fork||(t.v=e),t.wv=dr()),!dn)if(Xe!==null)(Tn()||se?.is_fork)&&Xe.set(t,e);else{var n=(t.f&Ue)===0?it:ve;me(t,n)}}let Ti=new Set;const It=new Map;let ar=!1;function Nt(t,e){var n={f:0,v:t,reactions:null,equals:Gs,rv:0,wv:0};return n}function Y(t,e){const n=Nt(t);return lr(n),n}function Zi(t,e=!1,n=!0){const i=Nt(t);return e||(i.equals=Us),$n&&n&&ne!==null&&ne.l!==null&&(ne.l.s??=[]).push(i),i}function P(t,e,n=!1){z!==null&&(!tt||(z.f&rs)!==0)&&On()&&(z.f&(_e|ft|Bi|rs))!==0&&!ct?.includes(t)&&Sa();let i=n?Ke(e):e;return In(t,i)}function In(t,e){if(!t.equals(e)){var n=t.v;dn?It.set(t,e):It.set(t,n),t.v=e;var i=et.ensure();i.capture(t,n),(t.f&_e)!==0&&((t.f&Ae)!==0&&Yi(t),me(t,(t.f&Ue)!==0?ve:it)),t.wv=dr(),or(t,Ae),On()&&V!==null&&(V.f&ve)!==0&&(V.f&(gt|Bt))===0&&(Ne===null?Ja([t]):Ne.push(t)),!i.is_fork&&Ti.size>0&&!ar&&qa()}return e}function qa(){ar=!1;var t=Ct;qn(!0);const e=Array.from(Ti);try{for(const n of e)(n.f&ve)!==0&&me(n,it),un(n)&&rn(n)}finally{qn(t)}Ti.clear()}function Sn(t){P(t,t.v+1)}function or(t,e){var n=t.reactions;if(n!==null)for(var i=On(),s=n.length,r=0;r<s;r++){var a=n[r],o=a.f;if(!(!i&&a===V)){var l=(o&Ae)===0;if(l&&me(a,e),(o&_e)!==0){var d=a;Xe?.delete(d),(o&Ft)===0&&(o&Ue&&(a.f|=Ft),or(d,it))}else l&&((o&ft)!==0&&lt!==null&&lt.add(a),Ht(a))}}}function Wi(t){var e=z,n=V;De(null),nt(null);try{return t()}finally{De(e),nt(n)}}let Ct=!1;function qn(t){Ct=t}let dn=!1;function cs(t){dn=t}let z=null,tt=!1;function De(t){z=t}let V=null;function nt(t){V=t}let ct=null;function lr(t){z!==null&&(ct===null?ct=[t]:ct.push(t))}let xe=null,$e=0,Ne=null;function Ja(t){Ne=t}let cr=1,Cn=0,Lt=Cn;function ds(t){Lt=t}function dr(){return++cr}function un(t){var e=t.f;if((e&Ae)!==0)return!0;if(e&_e&&(t.f&=~Ft),(e&it)!==0){var n=t.deps;if(n!==null)for(var i=n.length,s=0;s<i;s++){var r=n[s];if(un(r)&&rr(r),r.wv>t.wv)return!0}(e&Ue)!==0&&Xe===null&&me(t,ve)}return!1}function ur(t,e,n=!0){var i=t.reactions;if(i!==null&&!ct?.includes(t))for(var s=0;s<i.length;s++){var r=i[s];(r.f&_e)!==0?ur(r,e,!1):e===r&&(n?me(r,Ae):(r.f&ve)!==0&&me(r,it),Ht(r))}}function hr(t){var e=xe,n=$e,i=Ne,s=z,r=ct,a=ne,o=tt,l=Lt,d=t.f;xe=null,$e=0,Ne=null,z=(d&(gt|Bt))===0?t:null,ct=null,nn(t.ctx),tt=!1,Lt=++Cn,t.ac!==null&&(Wi(()=>{t.ac.abort(Jt)}),t.ac=null);try{t.f|=Ii;var u=t.fn,f=u(),g=t.deps;if(xe!==null){var p;if(Jn(t,$e),g!==null&&$e>0)for(g.length=$e+xe.length,p=0;p<xe.length;p++)g[$e+p]=xe[p];else t.deps=g=xe;if(Ct&&Tn()&&(t.f&Ue)!==0)for(p=$e;p<g.length;p++)(g[p].reactions??=[]).push(t)}else g!==null&&$e<g.length&&(Jn(t,$e),g.length=$e);if(On()&&Ne!==null&&!tt&&g!==null&&(t.f&(_e|it|Ae))===0)for(p=0;p<Ne.length;p++)ur(Ne[p],t);return s!==null&&s!==t&&(Cn++,Ne!==null&&(i===null?i=Ne:i.push(...Ne))),(t.f&St)!==0&&(t.f^=St),f}catch(v){return tr(v)}finally{t.f^=Ii,xe=e,$e=n,Ne=i,z=s,ct=r,nn(a),tt=o,Lt=l}}function Qa(t,e){let n=e.reactions;if(n!==null){var i=la.call(n,t);if(i!==-1){var s=n.length-1;s===0?n=e.reactions=null:(n[i]=n[s],n.pop())}}n===null&&(e.f&_e)!==0&&(xe===null||!xe.includes(e))&&(me(e,it),(e.f&Ue)!==0&&(e.f^=Ue,e.f&=~Ft),sr(e),Jn(e,0))}function Jn(t,e){var n=t.deps;if(n!==null)for(var i=e;i<n.length;i++)Qa(t,n[i])}function rn(t){var e=t.f;if((e&wt)===0){me(t,ve);var n=V,i=Ct;V=t,Ct=!0;try{(e&(ft|fa))!==0?lo(t):_r(t),mr(t);var s=hr(t);t.teardown=typeof s=="function"?s:null,t.wv=cr;var r;xi&&xa&&(t.f&Ae)!==0&&t.deps}finally{Ct=i,V=n}}}function c(t){var e=t.f,n=(e&_e)!==0;if(z!==null&&!tt){var i=V!==null&&(V.f&wt)!==0;if(!i&&!ct?.includes(t)){var s=z.deps;if((z.f&Ii)!==0)t.rv<Cn&&(t.rv=Cn,xe===null&&s!==null&&s[$e]===t?$e++:xe===null?xe=[t]:xe.includes(t)||xe.push(t));else{(z.deps??=[]).push(t);var r=t.reactions;r===null?t.reactions=[z]:r.includes(z)||r.push(z)}}}if(dn){if(It.has(t))return It.get(t);if(n){var a=t,o=a.v;return((a.f&ve)===0&&a.reactions!==null||gr(a))&&(o=Yi(a)),It.set(a,o),o}}else n&&(!Xe?.has(t)||se?.is_fork&&!Tn())&&(a=t,un(a)&&rr(a),Ct&&Tn()&&(a.f&Ue)===0&&fr(a));if(Xe?.has(t))return Xe.get(t);if((t.f&St)!==0)throw t.v;return t.v}function fr(t){if(t.deps!==null){t.f^=Ue;for(const e of t.deps)(e.reactions??=[]).push(t),(e.f&_e)!==0&&(e.f&Ue)===0&&fr(e)}}function gr(t){if(t.v===ye)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(It.has(e)||(e.f&_e)!==0&&gr(e))return!0;return!1}function Dt(t){var e=tt;try{return tt=!0,t()}finally{tt=e}}const eo=-7169;function me(t,e){t.f=t.f&eo|e}function to(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(Et in t)Di(t);else if(!Array.isArray(t))for(let e in t){const n=t[e];typeof n=="object"&&n&&Et in n&&Di(n)}}}function Di(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let i in t)try{Di(t[i],e)}catch{}const n=Fi(t);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const i=Ys(n);for(let s in i){const r=i[s].get;if(r)try{r.call(t)}catch{}}}}}function pr(t){V===null&&(z===null&&_a(),ma()),dn&&va()}function no(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function st(t,e,n){var i=V;i!==null&&(i.f&Oe)!==0&&(t|=Oe);var s={ctx:ne,deps:null,nodes_start:null,nodes_end:null,f:t|Ae|Ue,first:null,fn:e,last:null,next:null,parent:i,b:i&&i.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(n)try{rn(s),s.f|=Ni}catch(o){throw ke(s),o}else e!==null&&Ht(s);var r=s;if(n&&r.deps===null&&r.teardown===null&&r.nodes_start===null&&r.first===r.last&&(r.f&cn)===0&&(r=r.first,(t&ft)!==0&&(t&Rt)!==0&&r!==null&&(r.f|=Rt)),r!==null&&(r.parent=i,i!==null&&no(r,i),z!==null&&(z.f&_e)!==0&&(t&Bt)===0)){var a=z;(a.effects??=[]).push(r)}return s}function Tn(){return z!==null&&!tt}function di(t){const e=st(oi,null,!1);return me(e,ve),e.teardown=t,e}function Ie(t){pr();var e=V.f,n=!z&&(e&gt)!==0&&(e&Ni)===0;if(n){var i=ne;(i.e??=[]).push(t)}else return vr(t)}function vr(t){return st(Hi|zs,t,!1)}function io(t){return pr(),st(oi|zs,t,!0)}function so(t){et.ensure();const e=st(Bt|cn,t,!0);return(n={})=>new Promise(i=>{n.outro?tn(e,()=>{ke(e),i(void 0)}):(ke(e),i(void 0))})}function ro(t){return st(Hi,t,!1)}function us(t,e){var n=ne,i={effect:null,ran:!1,deps:t};n.l.$.push(i),i.effect=ui(()=>{t(),!i.ran&&(i.ran=!0,Dt(e))})}function ao(){var t=ne;ui(()=>{for(var e of t.l.$){e.deps();var n=e.effect;(n.f&ve)!==0&&me(n,it),un(n)&&rn(n),e.ran=!1}})}function oo(t){return st(Bi|cn,t,!0)}function ui(t,e=0){return st(oi|e,t,!0)}function j(t,e=[],n=[],i=[]){Ka(i,e,n,s=>{st(oi,()=>t(...s.map(c)),!0)})}function hi(t,e=0){var n=st(ft|e,t,!0);return n}function Be(t){return st(gt|cn,t,!0)}function mr(t){var e=t.teardown;if(e!==null){const n=dn,i=z;cs(!0),De(null);try{e.call(null)}finally{cs(n),De(i)}}}function _r(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){const s=n.ac;s!==null&&Wi(()=>{s.abort(Jt)});var i=n.next;(n.f&Bt)!==0?n.parent=null:ke(n,e),n=i}}function lo(t){for(var e=t.first;e!==null;){var n=e.next;(e.f&gt)===0&&ke(e),e=n}}function ke(t,e=!0){var n=!1;(e||(t.f&Ws)!==0)&&t.nodes_start!==null&&t.nodes_end!==null&&(co(t.nodes_start,t.nodes_end),n=!0),_r(t,e&&!n),Jn(t,0),me(t,wt);var i=t.transitions;if(i!==null)for(const r of i)r.stop();mr(t);var s=t.parent;s!==null&&s.first!==null&&yr(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes_start=t.nodes_end=t.ac=null}function co(t,e){for(;t!==null;){var n=t===e?null:Rn(t);t.remove(),t=n}}function yr(t){var e=t.parent,n=t.prev,i=t.next;n!==null&&(n.next=i),i!==null&&(i.prev=n),e!==null&&(e.first===t&&(e.first=i),e.last===t&&(e.last=n))}function tn(t,e,n=!0){var i=[];zi(t,i,!0),br(i,()=>{n&&ke(t),e&&e()})}function br(t,e){var n=t.length;if(n>0){var i=()=>--n||e();for(var s of t)s.out(i)}else e()}function zi(t,e,n){if((t.f&Oe)===0){if(t.f^=Oe,t.transitions!==null)for(const a of t.transitions)(a.is_global||n)&&e.push(a);for(var i=t.first;i!==null;){var s=i.next,r=(i.f&Rt)!==0||(i.f&gt)!==0&&(t.f&ft)!==0;zi(i,e,r?n:!1),i=s}}}function Gi(t){wr(t,!0)}function wr(t,e){if((t.f&Oe)!==0){t.f^=Oe,(t.f&ve)===0&&(me(t,Ae),Ht(t));for(var n=t.first;n!==null;){var i=n.next,s=(n.f&Rt)!==0||(n.f&gt)!==0;wr(n,s?e:!1),n=i}if(t.transitions!==null)for(const r of t.transitions)(r.is_global||e)&&r.in()}}function Sr(t,e){for(var n=t.nodes_start,i=t.nodes_end;n!==null;){var s=n===i?null:Rn(n);e.append(n),n=s}}const uo=["touchstart","touchmove"];function ho(t){return uo.includes(t)}const Er=new Set,ki=new Set;function fo(t,e,n,i={}){function s(r){if(i.capture||vn.call(e,r),!r.cancelBubble)return Wi(()=>n?.call(this,r))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?Ln(()=>{e.addEventListener(t,s,i)}):e.addEventListener(t,s,i),s}function Tt(t,e,n,i,s){var r={capture:i,passive:s},a=fo(t,e,n,r);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&di(()=>{e.removeEventListener(t,a,r)})}function je(t){for(var e=0;e<t.length;e++)Er.add(t[e]);for(var n of ki)n(t)}let hs=null;function vn(t){var e=this,n=e.ownerDocument,i=t.type,s=t.composedPath?.()||[],r=s[0]||t.target;hs=t;var a=0,o=hs===t&&t.__root;if(o){var l=s.indexOf(o);if(l!==-1&&(e===document||e===window)){t.__root=e;return}var d=s.indexOf(e);if(d===-1)return;l<=d&&(a=l)}if(r=s[a]||t.target,r!==e){Xs(t,"currentTarget",{configurable:!0,get(){return r||n}});var u=z,f=V;De(null),nt(null);try{for(var g,p=[];r!==null;){var v=r.assignedSlot||r.parentNode||r.host||null;try{var E=r["__"+i];E!=null&&(!r.disabled||t.target===r)&&E.call(r,t)}catch(k){g?p.push(k):g=k}if(t.cancelBubble||v===e||v===null)break;r=v}if(g){for(let k of p)queueMicrotask(()=>{throw k});throw g}}finally{t.__root=e,delete t.currentTarget,De(u),nt(f)}}}function go(t){var e=document.createElement("template");return e.innerHTML=t.replaceAll("<!>","<!---->"),e.content}function Qn(t,e){var n=V;n.nodes_start===null&&(n.nodes_start=t,n.nodes_end=e)}function N(t,e){var n=(e&ka)!==0,i=(e&Aa)!==0,s,r=!t.startsWith("<!>");return()=>{s===void 0&&(s=go(r?t:"<!>"+t),n||(s=jn(s)));var a=i||qs?document.importNode(s,!0):s.cloneNode(!0);if(n){var o=jn(a),l=a.lastChild;Qn(o,l)}else Qn(a,a);return a}}function ae(t=""){{var e=ht(t+"");return Qn(e,e),e}}function Ce(){var t=document.createDocumentFragment(),e=document.createComment(""),n=ht();return t.append(e,n),Qn(e,n),t}function b(t,e){t!==null&&t.before(e)}function fe(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??=t.nodeValue)&&(t.__t=n,t.nodeValue=n+"")}function po(t,e){return vo(t,e)}const jt=new Map;function vo(t,{target:e,anchor:n,props:i={},events:s,context:r,intro:a=!0}){Ra();var o=new Set,l=f=>{for(var g=0;g<f.length;g++){var p=f[g];if(!o.has(p)){o.add(p);var v=ho(p);e.addEventListener(p,vn,{passive:v});var E=jt.get(p);E===void 0?(document.addEventListener(p,vn,{passive:v}),jt.set(p,1)):jt.set(p,E+1)}}};l(Ri(Er)),ki.add(l);var d=void 0,u=so(()=>{var f=n??e.appendChild(ht());return Ya(f,{pending:()=>{}},g=>{if(r){de({});var p=ne;p.c=r}s&&(i.$$events=s),d=t(g,i)||{},r&&ue()}),()=>{for(var g of o){e.removeEventListener(g,vn);var p=jt.get(g);--p===0?(document.removeEventListener(g,vn),jt.delete(g)):jt.set(g,p)}ki.delete(l),f!==n&&f.parentNode?.removeChild(f)}});return mo.set(d,u),d}let mo=new WeakMap;class xr{anchor;#e=new Map;#t=new Map;#i=new Map;#n=new Set;#l=!0;constructor(e,n=!0){this.anchor=e,this.#l=n}#r=()=>{var e=se;if(this.#e.has(e)){var n=this.#e.get(e),i=this.#t.get(n);if(i)Gi(i),this.#n.delete(n);else{var s=this.#i.get(n);s&&(this.#t.set(n,s.effect),this.#i.delete(n),s.fragment.lastChild.remove(),this.anchor.before(s.fragment),i=s.effect)}for(const[r,a]of this.#e){if(this.#e.delete(r),r===e)break;const o=this.#i.get(a);o&&(ke(o.effect),this.#i.delete(a))}for(const[r,a]of this.#t){if(r===n||this.#n.has(r))continue;const o=()=>{if(Array.from(this.#e.values()).includes(r)){var d=document.createDocumentFragment();Sr(a,d),d.append(ht()),this.#i.set(r,{effect:a,fragment:d})}else ke(a);this.#n.delete(r),this.#t.delete(r)};this.#l||!i?(this.#n.add(r),tn(a,o,!1)):o()}}};#s=e=>{this.#e.delete(e);const n=Array.from(this.#e.values());for(const[i,s]of this.#i)n.includes(i)||(ke(s.effect),this.#i.delete(i))};ensure(e,n){var i=se,s=er();if(n&&!this.#t.has(e)&&!this.#i.has(e))if(s){var r=document.createDocumentFragment(),a=ht();r.append(a),this.#i.set(e,{effect:Be(()=>n(a)),fragment:r})}else this.#t.set(e,Be(()=>n(this.anchor)));if(this.#e.set(i,e),s){for(const[o,l]of this.#t)o===e?i.skipped_effects.delete(l):i.skipped_effects.add(l);for(const[o,l]of this.#i)o===e?i.skipped_effects.delete(l.effect):i.skipped_effects.add(l.effect);i.oncommit(this.#r),i.ondiscard(this.#s)}else this.#r()}}function K(t,e,n=!1){var i=new xr(t),s=n?Rt:0;function r(a,o){i.ensure(a,o)}hi(()=>{var a=!1;e((o,l=!0)=>{a=!0,r(l,o)}),a||r(!1,null)},s)}function an(t,e,...n){var i=new xr(t);hi(()=>{const s=e()??null;i.ensure(s,s&&(r=>s(r,...n)))},Rt)}const fs=[...` 	
\r\f \v\uFEFF`];function _o(t,e,n){var i=t==null?"":""+t;if(e&&(i=i?i+" "+e:e),n){for(var s in n)if(n[s])i=i?i+" "+s:s;else if(i.length)for(var r=s.length,a=0;(a=i.indexOf(s,a))>=0;){var o=a+r;(a===0||fs.includes(i[a-1]))&&(o===i.length||fs.includes(i[o]))?i=(a===0?"":i.substring(0,a))+i.substring(o+1):a=o}}return i===""?null:i}function gs(t,e=!1){var n=e?" !important;":";",i="";for(var s in t){var r=t[s];r!=null&&r!==""&&(i+=" "+s+": "+r+n)}return i}function mi(t){return t[0]!=="-"||t[1]!=="-"?t.toLowerCase():t}function yo(t,e){if(e){var n="",i,s;if(Array.isArray(e)?(i=e[0],s=e[1]):i=e,t){t=String(t).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var r=!1,a=0,o=!1,l=[];i&&l.push(...Object.keys(i).map(mi)),s&&l.push(...Object.keys(s).map(mi));var d=0,u=-1;const E=t.length;for(var f=0;f<E;f++){var g=t[f];if(o?g==="/"&&t[f-1]==="*"&&(o=!1):r?r===g&&(r=!1):g==="/"&&t[f+1]==="*"?o=!0:g==='"'||g==="'"?r=g:g==="("?a++:g===")"&&a--,!o&&r===!1&&a===0){if(g===":"&&u===-1)u=f;else if(g===";"||f===E-1){if(u!==-1){var p=mi(t.substring(d,u).trim());if(!l.includes(p)){g!==";"&&f++;var v=t.substring(d,f).trim();n+=" "+v+";"}}d=f+1,u=-1}}}}return i&&(n+=gs(i)),s&&(n+=gs(s,!0)),n=n.trim(),n===""?null:n}return t==null?null:String(t)}function Fe(t,e,n,i,s,r){var a=t.__className;if(a!==n||a===void 0){var o=_o(n,i,r);o==null?t.removeAttribute("class"):t.className=o,t.__className=n}else if(r&&s!==r)for(var l in r){var d=!!r[l];(s==null||d!==!!s[l])&&t.classList.toggle(l,d)}return r}function _i(t,e={},n,i){for(var s in n){var r=n[s];e[s]!==r&&(n[s]==null?t.style.removeProperty(s):t.style.setProperty(s,r,i))}}function le(t,e,n,i){var s=t.__style;if(s!==e){var r=yo(e,i);r==null?t.removeAttribute("style"):t.style.cssText=r,t.__style=e}else i&&(Array.isArray(i)?(_i(t,n?.[0],i[0]),_i(t,n?.[1],i[1],"important")):_i(t,n,i));return i}function Ir(t,e,n=!1){if(t.multiple){if(e==null)return;if(!Li(e))return $a();for(var i of t.options)i.selected=e.includes(ps(i));return}for(i of t.options){var s=ps(i);if(La(s,e)){i.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function bo(t){var e=new MutationObserver(()=>{Ir(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),di(()=>{e.disconnect()})}function ps(t){return"__value"in t?t.__value:t.value}const wo=Symbol("is custom element"),So=Symbol("is html");function ei(t,e){var n=Cr(t);n.value===(n.value=e??void 0)||t.value===e&&(e!==0||t.nodeName!=="PROGRESS")||(t.value=e??"")}function te(t,e,n,i){var s=Cr(t);s[e]!==(s[e]=n)&&(e==="loading"&&(t[ga]=n),n==null?t.removeAttribute(e):typeof n!="string"&&Eo(t).includes(e)?t[e]=n:t.setAttribute(e,n))}function Cr(t){return t.__attributes??={[wo]:t.nodeName.includes("-"),[So]:t.namespaceURI===Ma}}var vs=new Map;function Eo(t){var e=t.getAttribute("is")||t.nodeName,n=vs.get(e);if(n)return n;vs.set(e,n=[]);for(var i,s=t,r=Element.prototype;r!==s;){i=Ys(s);for(var a in i)i[a].set&&n.push(a);s=Fi(s)}return n}function ms(t,e){return t===e||t?.[Et]===e}function on(t={},e,n,i){return ro(()=>{var s,r;return ui(()=>{s=r,r=[],Dt(()=>{t!==n(...r)&&(e(t,...r),s&&ms(n(...s),t)&&e(null,...s))})}),()=>{Ln(()=>{r&&ms(n(...r),t)&&e(null,...r)})}}),t}function Tr(t=!1){const e=ne,n=e.l.u;if(!n)return;let i=()=>to(e.s);if(t){let s=0,r={};const a=ci(()=>{let o=!1;const l=e.s;for(const d in l)l[d]!==r[d]&&(r[d]=l[d],o=!0);return o&&s++,s});i=()=>c(a)}n.b.length&&io(()=>{_s(e,i),Un(n.b)}),Ie(()=>{const s=Dt(()=>n.m.map(ua));return()=>{for(const r of s)typeof r=="function"&&r()}}),n.a.length&&Ie(()=>{_s(e,i),Un(n.a)})}function _s(t,e){if(t.l.s)for(const n of t.l.s)c(n);e()}let Ai=Symbol();function R(t,e,n){const i=n[e]??={store:null,source:Zi(void 0),unsubscribe:Ze};if(i.store!==t&&!(Ai in n))if(i.unsubscribe(),i.store=t??null,t==null)i.source.v=void 0,i.unsubscribe=Ze;else{var s=!0;i.unsubscribe=Ki(t,r=>{s?i.source.v=r:P(i.source,r)}),s=!1}return t&&Ai in n?Xt(t):c(i.source)}function Te(){const t={};function e(){di(()=>{for(var n in t)t[n].unsubscribe();Xs(t,Ai,{enumerable:!1,value:!0})})}return[t,e]}function Q(t,e,n,i){var s=i,r=!0,a=()=>(r&&(r=!1,s=i),s),o;o=t[e],o===void 0&&i!==void 0&&(o=a());var l;return l=()=>{var d=t[e];return d===void 0?a():(r=!0,d)},l}function Fn(t){ne===null&&js(),$n&&ne.l!==null?Io(ne).m.push(t):Ie(()=>{const e=Dt(t);if(typeof e=="function")return e})}function xo(t){ne===null&&js(),Fn(()=>()=>Dt(t))}function Io(t){var e=t.l;return e.u??={a:[],b:[],m:[]}}function Ki(t,e,n){if(t==null)return e(void 0),n&&n(void 0),Ze;const i=Dt(()=>t.subscribe(e,n));return i.unsubscribe?()=>i.unsubscribe():i}const Vt=[];function Co(t,e){return{subscribe:ie(t,e).subscribe}}function ie(t,e=Ze){let n=null;const i=new Set;function s(o){if(Ks(t,o)&&(t=o,n)){const l=!Vt.length;for(const d of i)d[1](),Vt.push(d,t);if(l){for(let d=0;d<Vt.length;d+=2)Vt[d][0](Vt[d+1]);Vt.length=0}}}function r(o){s(o(t))}function a(o,l=Ze){const d=[o,l];return i.add(d),i.size===1&&(n=e(s,r)||Ze),o(t),()=>{i.delete(d),i.size===0&&n&&(n(),n=null)}}return{set:s,update:r,subscribe:a}}function Me(t,e,n){const i=!Array.isArray(t),s=i?[t]:t;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const r=e.length<2;return Co(n,(a,o)=>{let l=!1;const d=[];let u=0,f=Ze;const g=()=>{if(u)return;f();const v=e(i?d[0]:d,a,o);r?a(v):f=typeof v=="function"?v:Ze},p=s.map((v,E)=>Ki(v,k=>{d[E]=k,u&=~(1<<E),l&&g()},()=>{u|=1<<E}));return l=!0,g(),function(){Un(p),f(),l=!1}})}function Xt(t){let e;return Ki(t,n=>e=n)(),e}function To(){return`zone_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const Mi=["#e74c3c","#e67e22","#f1c40f","#2ecc71","#1abc9c","#3498db","#9b59b6","#e91e8f"];function Do(){return Mi[Math.floor(Math.random()*Mi.length)]}function ys(t,e=200){return{id:To(),x:t,width:e,color:Do(),texts:[{language:"cs",title:"",content:""}]}}function ko(t,e){const n=t.texts.find(i=>i.language===e);return n||t.texts[0]||null}const Dn=ie("cs"),Ao=ie("orange"),Mo=ie("Forest"),Pi=ie(!1),mn=ie(!1),Dr=ie(!1),kr=ie(!1),Ar=ie(null),Po=Me([Ar,Dn],([t,e])=>t?ko(t,e):null);function yi(t){Ar.set(t)}const Mr=ie({x:0,y:0});function $o(t,e){Mr.set({x:t,y:e})}const Pr=ie({scrollX:0,scrollY:0,zoom:1});function Oo(t,e,n=1){Pr.set({scrollX:t,scrollY:e,zoom:n})}const $i=ie(!1);function Lo(){$i.set(!0),setTimeout(()=>$i.set(!1),150)}const Le={BACKGROUND_BASE:-100,BACKGROUND_LAYER_START:-99,GROUND_REFERENCE:-1,ITEMS_BEHIND:5,PLAYER:10,ITEMS_FRONT:15,SELECTION_GRAPHICS:999,GRID_OVERLAY:1e3};function Ui(t){return t==="behind"?Le.ITEMS_BEHIND:Le.ITEMS_FRONT}const at=["orange","white"];class Ro{currentSkin=at[0];currentIndex=0;setSkin(e){at.includes(e)&&(this.currentSkin=e,this.currentIndex=at.indexOf(e),localStorage.setItem("catSkin",e))}getSkin(){const e=localStorage.getItem("catSkin");return e&&at.includes(e)&&(this.currentSkin=e,this.currentIndex=at.indexOf(e)),this.currentSkin}toggleSkin(){return this.currentIndex=(this.currentIndex+1)%at.length,this.currentSkin=at[this.currentIndex],this.setSkin(this.currentSkin),this.currentSkin}getAllSkins(){return at}}const $r=new Ro,Fo={FAST_VELOCITY_THRESHOLD:100,ROTATION_FULL:15,ROTATION_SLIGHT:8};class Ho{scene;currentSkin;constructor(e,n="white"){this.scene=e,this.currentSkin=n}createAll(){$r.getAllSkins().forEach(n=>{this.createAnimationsForSkin(n)})}createAnimationsForSkin(e){const n=this.scene;n.anims.exists(`cat-idle-${e}`)||n.anims.create({key:`cat-idle-${e}`,frames:n.anims.generateFrameNumbers(`cat-idle-${e}`,{start:0,end:3}),frameRate:6,repeat:-1}),n.anims.exists(`cat-walk-${e}`)||n.anims.create({key:`cat-walk-${e}`,frames:n.anims.generateFrameNumbers(`cat-walk-${e}`,{start:0,end:5}),frameRate:12,repeat:-1}),[{key:`cat-jump-up-${e}`,frame:2},{key:`cat-jump-peak-up-${e}`,frame:3},{key:`cat-jump-peak-down-${e}`,frame:3},{key:`cat-jump-down-${e}`,frame:4}].forEach(({key:s,frame:r})=>{n.anims.exists(s)||n.anims.create({key:s,frames:[{key:`cat-walk-${e}`,frame:r}],frameRate:1,repeat:0})})}getSkin(){return this.currentSkin}setSkin(e){this.currentSkin=e}getAnimationKey(e){return`cat-${e}-${this.currentSkin}`}play(e,n){const i=this.getAnimationKey(n);e.anims.currentAnim?.key!==i&&e.play(i)}getJumpAnimationState(e){const{FAST_VELOCITY_THRESHOLD:n,ROTATION_FULL:i,ROTATION_SLIGHT:s}=Fo;return e<-n?{animation:this.getAnimationKey("jump-up"),rotation:i,flipMultiplier:1}:e<-20?{animation:this.getAnimationKey("jump-peak-up"),rotation:s,flipMultiplier:1}:e<=n?{animation:this.getAnimationKey("jump-peak-down"),rotation:s,flipMultiplier:-1}:{animation:this.getAnimationKey("jump-down"),rotation:i,flipMultiplier:-1}}handleSkinChange(e,n){const i=this.currentSkin;this.currentSkin=n;const s=e.anims.currentAnim?.key;if(s){const a=`cat-${s.replace("cat-","").replace(`-${i}`,"")}-${n}`;this.scene.anims.exists(a)&&e.play(a)}}}const At={THRESHOLD_X:20,LANGUAGE_BUTTON:{width:120,height:60},SKIN_BUTTON:{width:120,height:60,yOffset:60}},bs={SPEED:350,JUMP_STRENGTH:-500};class No{scene;getPlayerPosition;keyUp;keyLeft;keyRight;keyA;keyD;keyW;keySpace;touchLeft=!1;touchRight=!1;touchJump=!1;touchHandlers;constructor(e){this.scene=e.scene,this.getPlayerPosition=e.getPlayerPosition,this.setupKeyboardControls(),this.setupTouchControls()}setupKeyboardControls(){this.scene.input.keyboard&&(this.keyUp=this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.UP,!1),this.keyLeft=this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.LEFT,!1),this.keyRight=this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.RIGHT,!1),this.keyA=this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.A,!1),this.keyD=this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.D,!1),this.keyW=this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.W,!1),this.keySpace=this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.SPACE,!1))}setupTouchControls(){const e=this.scene,n=a=>{if(Xt($i)){this.touchLeft=!1,this.touchRight=!1,this.touchJump=!1;return}const o=a.x,l=a.y,d=e.scale.width;if(o>d-At.LANGUAGE_BUTTON.width&&l<At.LANGUAGE_BUTTON.height||o>d-At.SKIN_BUTTON.width&&l>=At.SKIN_BUTTON.yOffset&&l<At.SKIN_BUTTON.yOffset+At.SKIN_BUTTON.height)return;const u=e.cameras.main,f=this.getPlayerPosition(),g=f.x-u.scrollX,p=f.y-u.scrollY,v=o-g,E=l-p;v<-20?(this.touchLeft=!0,this.touchRight=!1):v>At.THRESHOLD_X?(this.touchRight=!0,this.touchLeft=!1):(this.touchLeft=!1,this.touchRight=!1),this.touchJump=E<-80},i=a=>{n(a)},s=a=>{a.isDown&&n(a)},r=()=>{this.touchLeft=!1,this.touchRight=!1,this.touchJump=!1};e.input.on("pointerdown",i),e.input.on("pointermove",s),e.input.on("pointerup",r),this.touchHandlers={pointerdown:i,pointermove:s,pointerup:r}}getInputState(){const e=this.keyA?.isDown||this.keyLeft?.isDown||this.touchLeft||!1,n=this.keyD?.isDown||this.keyRight?.isDown||this.touchRight||!1,i=this.keySpace?.isDown||this.keyW?.isDown||this.keyUp?.isDown||this.touchJump||!1;return{left:e,right:n,jump:i}}hasAnyInput(){const e=this.getInputState();return e.left||e.right||e.jump}destroy(){this.touchHandlers&&(this.scene.input.off("pointerdown",this.touchHandlers.pointerdown),this.scene.input.off("pointermove",this.touchHandlers.pointermove),this.scene.input.off("pointerup",this.touchHandlers.pointerup),this.touchHandlers=void 0)}}class Bo extends B.Physics.Arcade.Sprite{animations;inputController;animState="idle";hasNotifiedMovement=!1;hasReceivedInput=!1;constructor(e,n,i){const s="white";super(e,n,i,`cat-idle-${s}`),e.add.existing(this),e.physics.add.existing(this),this.animations=new Ho(e,s),this.animations.createAll(),this.inputController=new No({scene:e,getPlayerPosition:()=>({x:this.x,y:this.y})}),this.setCollideWorldBounds(!0),this.setBounce(0),this.setSize(16,12),this.setOffset(16,36),this.setScale(5),this.setDepth(Le.PLAYER),this.animations.play(this,"idle")}changeSkin(e){this.animations.handleSkinChange(this,e)}updateJumpAnimation(e){const{animation:n,rotation:i,flipMultiplier:s}=this.animations.getJumpAnimationState(e);this.anims.currentAnim?.key!==n&&this.play(n);const r=this.flipX?i*s:-i*s;this.setAngle(r)}update(){const e=this.inputController.getInputState(),n=this.body,i=n&&(n.blocked.down||n.touching.down);switch(this.inputController.hasAnyInput()&&!this.hasReceivedInput&&(this.hasReceivedInput=!0),this.hasReceivedInput&&this.inputController.hasAnyInput()&&!this.hasNotifiedMovement&&(this.hasNotifiedMovement=!0,kr.set(!0)),e.left?(this.setVelocityX(-350),this.setFlipX(!0),i&&(this.animState="running")):e.right?(this.setVelocityX(bs.SPEED),this.setFlipX(!1),i&&(this.animState="running")):(this.setVelocityX(0),i&&(this.animState="idle")),e.jump&&i&&(this.setVelocityY(bs.JUMP_STRENGTH),this.animState="jumping"),!i&&n&&n.velocity.y!==0&&(this.animState="jumping"),this.animState){case"idle":this.animations.play(this,"idle"),this.setAngle(0);break;case"running":this.animations.play(this,"walk"),this.setAngle(0);break;case"jumping":this.updateJumpAnimation(n.velocity.y);break}}destroy(e){this.inputController.destroy(),super.destroy(e)}}const Mt=[{name:"FOREST",folder:"forest",scrollFactors:[1,.8,.85,.9,.95,1]},{name:"FOREST BLUE",folder:"forest_blue",scrollFactors:[1,.8,.85,.9,.95,1]}];class Xo{currentIndex=0;constructor(){const e=localStorage.getItem("background");if(e){const n=Mt.findIndex(i=>i.folder===e);n!==-1&&(this.currentIndex=n)}}getBackground(){return Mt[this.currentIndex].folder}getCurrentConfig(){return Mt[this.currentIndex]}setBackground(e){const n=Mt.findIndex(i=>i.folder===e);n!==-1&&(this.currentIndex=n,localStorage.setItem("background",e))}toggleBackground(){this.currentIndex=(this.currentIndex+1)%Mt.length;const e=Mt[this.currentIndex];return localStorage.setItem("background",e.folder),e}getAllBackgrounds(){return Mt}}const ti=new Xo;function Or(t,e){return new Promise(n=>{t.load.image(`bg0-${e.folder}`,`assets/backgrounds/${e.folder}/0.png`);for(let i=0;i<e.scrollFactors.length;i++){const s=i+1;t.load.image(`bg${s}-${e.folder}`,`assets/backgrounds/${e.folder}/${s}.png`)}t.load.once("complete",()=>{n(!0)}),t.load.once("loaderror",i=>{console.error(`Failed to load background asset: ${i.key}`),n(!1)}),t.load.start()})}function Lr(t,e,n,i){const s=Math.max(n,t.scale.height),r=t.add.tileSprite(0,0,e,s,`bg0-${i.folder}`);r.setOrigin(0,0),r.setScrollFactor(1),r.setDepth(Le.BACKGROUND_BASE),r.tilePositionX=0,r.tilePositionY=0;const a=[];for(let o=0;o<i.scrollFactors.length;o++){const d=`bg${o+1}-${i.folder}`;if(t.textures.exists(d)){const u=t.add.image(0,0,d);u.setOrigin(0,0),u.setScrollFactor(i.scrollFactors[o]),u.setDepth(Le.BACKGROUND_LAYER_START+o),u.setDisplaySize(e,n),a.push(u)}}return{baseLayer:r,bgLayers:a}}function Rr(t,e){t&&(t.tilePositionX=e.scrollX)}function Yo(t){t.bgLayers.forEach(e=>e.destroy()),t.baseLayer.destroy()}const Zo=[{code:"cs",label:"CZ"},{code:"en",label:"EN"}],Fr="cs",Wo={isActive:!1,config:null,selectedItemId:null,itemDepthLayer:"behind",editMode:"items",selectedDialogZoneId:null,selectedFrameId:null},G=ie(Wo),Hr=Me(G,t=>t.isActive),zo=Me(G,t=>t.config),fi=ie(!0);function Go(){fi.update(t=>!t)}const Yt=ie(!1);function bt(t){Yt.set(t)}const kn=ie(!1),An=ie(!1),ji=ie(!1);function Ko(){kn.update(t=>!t)}function Uo(){An.update(t=>!t)}function ni(){ji.set(!0)}function jo(){ji.set(!1)}const Vi=ie(Fr);function Vo(t){Vi.set(t)}const Nr=Me(G,t=>t.selectedItemId),Br=Me(G,t=>t.itemDepthLayer),Re=Me(G,t=>t.editMode),Xr=Me(G,t=>t.selectedDialogZoneId),qi=Me(G,t=>t.config?.dialogZones||[]),Ji=Me(G,t=>t.selectedFrameId),Yr=Me(G,t=>t.config?.placedFrames||[]),Qi=ie(new Map);function qo(t,e,n){Qi.update(i=>{const s=new Map(i);return s.set(t,{x:e,y:n}),s})}function Jo(t){Qi.update(e=>{const n=new Map(e);return n.delete(t),n})}const Zr=ie(null);function bi(t){Zr.set(t)}const Qo=Me(G,t=>!t.selectedFrameId||!t.config?.placedFrames?null:t.config.placedFrames.find(e=>e.id===t.selectedFrameId)??null),Wr=ie(null);function wi(t){Wr.set(t)}const es=Me(G,t=>!t.selectedItemId||!t.config?.placedItems?null:t.config.placedItems.find(e=>e.id===t.selectedItemId)??null),el=Me(es,t=>t?.physicsEnabled??!1),tl=Me(es,t=>t?.flipX??!1);function ws(t,e){G.update(n=>n.config?{...n,config:{...n.config,playerStartX:t,playerStartY:e}}:n)}function nl(t){G.update(e=>{if(!e.config)return e;const n=e.config.placedItems||[];return{...e,config:{...e.config,placedItems:[...n,t]}}})}function Mn(t,e){G.update(n=>!n.config||!n.config.placedItems?n:{...n,config:{...n.config,placedItems:n.config.placedItems.map(i=>i.id===t?{...i,...e}:i)}})}function zr(t){G.update(e=>!e.config||!e.config.placedItems?e:{...e,config:{...e.config,placedItems:e.config.placedItems.filter(n=>n.id!==t)},selectedItemId:e.selectedItemId===t?null:e.selectedItemId})}function ii(t){G.update(e=>({...e,selectedItemId:t}))}function ts(){G.update(t=>({...t,selectedItemId:null}))}function il(){G.update(t=>({...t,itemDepthLayer:t.itemDepthLayer==="behind"?"front":"behind"}))}function sl(t,e){Mn(t,{depth:e})}function rl(t,e){e?(Mn(t,{physicsEnabled:e,depth:Ui("behind")}),G.update(n=>({...n,itemDepthLayer:"behind"}))):Mn(t,{physicsEnabled:e})}function al(t,e){Mn(t,{flipX:e})}function ol(t){G.set({isActive:!0,config:{...t,placedItems:t.placedItems||[],dialogZones:t.dialogZones||[],placedFrames:t.placedFrames||[]},selectedItemId:null,itemDepthLayer:"behind",editMode:"items",selectedDialogZoneId:null,selectedFrameId:null}),hn.set(!1)}function ll(){G.update(t=>{const e=t.config?{...t.config,dialogZones:(t.config.dialogZones||[]).filter(n=>n.texts.some(i=>i.title.trim()!==""||i.content.trim()!==""))}:t.config;return{...t,isActive:!1,selectedItemId:null,config:e}}),hn.set(!1)}function cl(){return Xt(G).config}const hn=ie(!1);function Ss(t){hn.set(t)}const fn=ie({scrollX:0,scrollY:0,viewWidth:0,viewHeight:0,worldWidth:0,worldHeight:0,zoom:1,playerX:0,playerY:0});function dl(t){fn.update(e=>({...e,...t}))}function Xn(t){G.update(e=>({...e,editMode:t,selectedItemId:null,selectedDialogZoneId:null}))}function Es(t){G.update(e=>{if(!e.config)return e;const n=e.config.dialogZones||[];return{...e,config:{...e.config,dialogZones:[...n,t]}}})}function _n(t,e){G.update(n=>!n.config||!n.config.dialogZones?n:{...n,config:{...n.config,dialogZones:n.config.dialogZones.map(i=>i.id===t?{...i,...e}:i)}})}function ul(t){G.update(e=>!e.config||!e.config.dialogZones?e:{...e,config:{...e.config,dialogZones:e.config.dialogZones.filter(n=>n.id!==t)},selectedDialogZoneId:e.selectedDialogZoneId===t?null:e.selectedDialogZoneId})}function yn(t){G.update(e=>({...e,selectedDialogZoneId:t}))}function xs(t,e,n){G.update(i=>!i.config||!i.config.dialogZones?i:{...i,config:{...i.config,dialogZones:i.config.dialogZones.map(s=>{if(s.id!==t)return s;const r=s.texts.findIndex(o=>o.language===e);let a;return r>=0?a=s.texts.map((o,l)=>l===r?{...o,...n}:o):a=[...s.texts,{language:e,title:"",content:"",...n}],{...s,texts:a}})}})}function hl(t){G.update(e=>{if(!e.config)return e;const n=e.config.placedFrames||[];return{...e,config:{...e.config,placedFrames:[...n,t]}}})}function ot(t,e){G.update(n=>!n.config||!n.config.placedFrames?n:{...n,config:{...n.config,placedFrames:n.config.placedFrames.map(i=>i.id===t?{...i,...e}:i)}})}function ns(t){G.update(e=>!e.config||!e.config.placedFrames?e:{...e,config:{...e.config,placedFrames:e.config.placedFrames.filter(n=>n.id!==t)},selectedFrameId:e.selectedFrameId===t?null:e.selectedFrameId})}function en(t){G.update(e=>({...e,selectedFrameId:t}))}const is=[{key:"tent",name:"Tent",path:"assets/ui/tent.png",scale:6,category:"structures"},{key:"lamp",name:"Lamp",path:"assets/ui/lamp.png",scale:8,category:"props"},{key:"sign_left",name:"Sign ←",path:"assets/ui/sign_left.png",scale:7,category:"signs"},{key:"sign_right",name:"Sign →",path:"assets/ui/sign_right.png",scale:7,category:"signs"},{key:"stone_0",name:"Stone 0",path:"assets/ui/stone_0.png",scale:4,category:"nature",supportsPhysics:!0},{key:"stone_1",name:"Stone 1",path:"assets/ui/stone_1.png",scale:5,category:"nature",supportsPhysics:!0},{key:"stone_2",name:"Stone 2",path:"assets/ui/stone_2.png",scale:4,category:"nature",supportsPhysics:!0}];function Gr(t){return is.find(e=>e.key===t)}function fl(t){return Gr(t)?.scale||1}function gl(t){return Gr(t)?.supportsPhysics??!1}class Is{scene;groundY;constructor(e,n){this.scene=e,this.groundY=n}static preloadAssets(e){is.forEach(n=>{e.load.image(n.key,n.path)})}createSprite(e){const{id:n,assetKey:i,x:s,scale:r=1,depth:a=5,yOffset:o=0,flipX:l=!1}=e,d=this.groundY+o,u=this.scene.add.sprite(s,d,i);return u.setScale(r),u.setDepth(a),u.setFlipX(l),u.setData("itemId",n),u}updatePosition(e,n,i){e.x=n,e.y=this.groundY+i}updateScale(e,n){e.setScale(n)}updateDepth(e,n){e.setDepth(n)}applyUpdates(e,n){n.x!==void 0&&(e.x=n.x),n.yOffset!==void 0&&(e.y=this.groundY+n.yOffset),n.scale!==void 0&&e.setScale(n.scale),n.depth!==void 0&&e.setDepth(n.depth),n.flipX!==void 0&&e.setFlipX(n.flipX)}worldYToOffset(e){return e-this.groundY}getGroundY(){return this.groundY}}const si=40,pl=48,Cs=5,vl=Le.PLAYER,ln=50,ml=4871528,_l=.4,yl=1,Kr=Le.GRID_OVERLAY,Si=16711680,bl=2,wl=.6,Sl=.1,El=1,xl=.2,Ts=50,Il=50,Cl=10,Tl=4886754;function Ds(t,e){return Math.round(t/e)*e}class Dl{scene;groundY;isDragging=!1;callbacks;constructor(e,n,i={}){this.scene=e,this.groundY=n,this.callbacks=i}getIsDragging(){return this.isDragging}makeInteractive(e,n){e.setInteractive({cursor:"pointer"}),this.scene.input.setDraggable(e),e.on("pointerdown",()=>{this.isDragging||ii(n)}),e.on("dragstart",()=>{this.isDragging=!1,e.setTint(4886754),this.scene.data?.set("isDraggingItem",!0),bt(!0),this.callbacks.onDragStart?.(n)}),e.on("drag",(i,s,r)=>{this.isDragging=!0;const a=Xt(fi),o=a?Ds(s,ln):s,l=a?Ds(r,ln):r;e.setPosition(o,l),this.callbacks.onDrag?.(n,o,l)}),e.on("dragend",()=>{e.clearTint(),this.scene.data?.set("isDraggingItem",!1),bt(!1);const i=Math.round(e.x),r=Math.round(e.y)-this.groundY;Mn(n,{x:i,yOffset:r}),this.callbacks.onDragEnd?.(n,i,r),this.scene.time.delayedCall(50,()=>{this.isDragging=!1})})}removeInteractivity(e){!e||!e.scene||(e.removeInteractive(),e.off("pointerdown"),e.off("dragstart"),e.off("drag"),e.off("dragend"))}}const kl={lineWidth:3,lineColor:4886754,lineAlpha:1,handleSize:8,handleColor:4886754,padding:5};class Al{scene;graphics;style;selectedId=null;constructor(e,n={}){this.scene=e,this.style={...kl,...n},this.graphics=e.add.graphics(),this.graphics.setDepth(Le.SELECTION_GRAPHICS)}setSelectedId(e){this.selectedId=e}getSelectedId(){return this.selectedId}updateVisuals(e){if(this.graphics.clear(),!e||!this.selectedId)return;const n=e.getBounds(),{lineWidth:i,lineColor:s,lineAlpha:r,handleSize:a,handleColor:o,padding:l}=this.style;this.graphics.lineStyle(i,s,r),this.graphics.strokeRect(n.x-l,n.y-l,n.width+l*2,n.height+l*2),this.graphics.fillStyle(o,1),this.graphics.fillCircle(n.x,n.y,a),this.graphics.fillCircle(n.x+n.width,n.y,a),this.graphics.fillCircle(n.x,n.y+n.height,a),this.graphics.fillCircle(n.x+n.width,n.y+n.height,a)}clearVisuals(){this.graphics.clear(),this.selectedId=null}setupBackgroundDeselect(e){this.scene.input.on("pointerdown",n=>{if(e())return;this.scene.input.hitTestPointer(n).find(s=>s.type==="Sprite"&&s.getData("itemId"))||(ts(),this.clearVisuals())})}destroy(){this.graphics?.destroy()}}class ri{scene;items=new Map;isBuilderMode=!1;physicsGroup=null;renderer;dragController;selectionManager;constructor(e,n,i=!1){this.scene=e,this.isBuilderMode=i,this.renderer=new Is(e,n),i||(this.physicsGroup=e.physics.add.staticGroup()),this.isBuilderMode&&(this.dragController=new Dl(e,n,{onDrag:()=>this.updateSelectionVisuals()}),this.selectionManager=new Al(e))}static preloadAssets(e){Is.preloadAssets(e)}createItems(e){e.forEach(n=>{this.createItem(n)})}createItem(e){const n=this.renderer.createSprite(e),i={sprite:n,data:e};if(!this.isBuilderMode&&e.physicsEnabled&&this.physicsGroup){const s=this.createPhysicsBody(n,e);i.physicsBody=s}this.items.set(e.id,i),this.isBuilderMode&&this.dragController&&(this.dragController.makeInteractive(n,e.id),n.on("pointerdown",()=>{this.dragController?.getIsDragging()||(ii(e.id),this.updateSelectionVisuals())}))}createPhysicsBody(e,n){const i=e.getBounds(),s=i.width*.5,r=i.height*.8,a=e.x,o=e.y,l=this.scene.add.rectangle(a,o,s,r);return l.setVisible(!1),this.physicsGroup.add(l),l.setData("itemId",n.id),l}updateSelectionVisuals(){if(!this.selectionManager)return;const e=this.scene.data.get("selectedItemId");if(this.selectionManager.setSelectedId(e),!e){this.selectionManager.clearVisuals(),bi(null);return}const n=this.items.get(e);if(this.selectionManager.updateVisuals(n?.sprite??null),n?.sprite){const i=this.scene.cameras.main,s=n.sprite.getBounds(),r=(s.centerX-i.scrollX)*i.zoom,a=(s.centerY-i.scrollY)*i.zoom,o=s.height*i.zoom;bi({screenX:r,screenY:a,itemHeight:o})}else bi(null)}updateItem(e,n){const i=this.items.get(e);i&&(this.renderer.applyUpdates(i.sprite,n),i.data={...i.data,...n})}removeItem(e){const n=this.items.get(e);n&&(this.dragController&&this.dragController.removeInteractivity(n.sprite),n.physicsBody&&n.physicsBody.destroy(),n.sprite.destroy(),this.items.delete(e))}removeAllItems(){this.items.forEach(e=>{!e.sprite||!e.sprite.scene||(this.dragController&&this.dragController.removeInteractivity(e.sprite),e.physicsBody&&e.physicsBody.destroy(),e.sprite.destroy())}),this.items.clear()}getItem(e){return this.items.get(e)?.data}getAllItems(){return Array.from(this.items.values()).map(e=>e.data)}getPhysicsGroup(){return this.physicsGroup}setInteractiveEnabled(e){!this.isBuilderMode||!this.dragController||(this.items.forEach(({sprite:n,data:i})=>{e?(this.dragController.makeInteractive(n,i.id),n.setAlpha(1),n.on("pointerdown",()=>{this.dragController?.getIsDragging()||(ii(i.id),this.updateSelectionVisuals())})):(n.disableInteractive(),n.off("pointerdown"),n.setAlpha(.6))}),!e&&this.selectionManager&&this.selectionManager.clearVisuals())}destroy(){this.removeAllItems(),this.selectionManager?.destroy()}setupBackgroundDeselect(){!this.isBuilderMode||!this.selectionManager||this.selectionManager.setupBackgroundDeselect(()=>this.dragController?.getIsDragging()??!1)}}function Ml(){return`frame_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const Pl=["#ffffff","#f8f8f8","#fffacd","#ffefd5","#ffe4e1","#e6e6fa","#f0fff0","#f5fffa","#fff0f5","#f0f8ff","#2d2d2d","#1a1a2e","#16213e","#1a1a1a","#2d132c","#1e3a3a","#3d1a1a","#1a2f1a","#3d3d1a","#2a1a3d"],$l=["#333333","#000000","#ffffff","#1a1a1a","#666666","#8b4513","#2c3e50","#c0392b","#27ae60","#2980b9","#8e44ad","#f39c12"],Ol=[12,14,16,18,20,24,28,32],Ur={S:{label:"Small",scale:3},M:{label:"Medium",scale:4},L:{label:"Large",scale:5}};function Ll(t){return Ur[t].scale}function Rl(t){return t<=3?"S":t>=5?"L":"M"}const dt=4,bn="#ffffff",jr="#333333",zn=16,Fl=64,Hl=96,Nl=.06,ks=32,ai=[{key:"base_1",name:"Frame 1",path:"assets/frames/base 1.png",scale:4},{key:"base_2",name:"Frame 2",path:"assets/frames/base 2.png",scale:4},{key:"base_3",name:"Frame 3",path:"assets/frames/base 3.png",scale:4},{key:"base_4",name:"Frame 4",path:"assets/frames/base 4.png",scale:4},{key:"base_5",name:"Frame 5",path:"assets/frames/base 5.png",scale:4},{key:"base_6",name:"Frame 6",path:"assets/frames/base 6.png",scale:4},{key:"base_7",name:"Frame 7",path:"assets/frames/base 7.png",scale:4},{key:"base_8",name:"Frame 8",path:"assets/frames/base 8.png",scale:4},{key:"base_9",name:"Frame 9",path:"assets/frames/base 9.png",scale:4},{key:"base_10",name:"Frame 10",path:"assets/frames/base 10.png",scale:4},{key:"base_11",name:"Frame 11",path:"assets/frames/base 11.png",scale:4},{key:"base_12",name:"Frame 12",path:"assets/frames/base 12.png",scale:4},{key:"base_13",name:"Frame 13",path:"assets/frames/base 13.png",scale:4},{key:"base_14",name:"Frame 14",path:"assets/frames/base 14.png",scale:4},{key:"base_15",name:"Frame 15",path:"assets/frames/base 15.png",scale:4},{key:"base_16",name:"Frame 16",path:"assets/frames/base 16.png",scale:4},{key:"base_17",name:"Frame 17",path:"assets/frames/base 17.png",scale:4},{key:"base_18",name:"Frame 18",path:"assets/frames/base 18.png",scale:4},{key:"base_19",name:"Frame 19",path:"assets/frames/base 19.png",scale:4},{key:"base_20",name:"Frame 20",path:"assets/frames/base 20.png",scale:4},{key:"base_21",name:"Frame 21",path:"assets/frames/base 21.png",scale:4},{key:"base_22",name:"Frame 22",path:"assets/frames/base 22.png",scale:4},{key:"base_23",name:"Frame 23",path:"assets/frames/base 23.png",scale:4},{key:"base_24",name:"Frame 24",path:"assets/frames/base 24.png",scale:4},{key:"base_25",name:"Frame 25",path:"assets/frames/base 25.png",scale:4}];function Bl(t){return ai.find(e=>e.key===t)}function Xl(t){return Bl(t)?.scale??dt}function En(t=dt,e=!1){const n=Fl*t,i=Hl*t,s=e?i:n,r=e?n:i,a=Math.min(n,i)*Nl,o=s-a*2,l=r-a*2,d=o-ks*2,u=l-ks*2;return{frameWidth:s,frameHeight:r,innerWidth:o,innerHeight:l,textWidth:d,textHeight:u}}function Gn(t,e,n,i,s,r,a=4){t.clear();const o=parseInt(r.replace("#",""),16);t.fillStyle(o,1),t.fillRoundedRect(e-i/2,n-s/2,i,s,a)}class Yl{lastClickTime=0;lastClickedId=null;threshold;constructor(e=300){this.threshold=e}check(e){const n=Date.now();return this.lastClickedId===e&&n-this.lastClickTime<this.threshold?(this.reset(),!0):(this.lastClickTime=n,this.lastClickedId=e,!1)}reset(){this.lastClickTime=0,this.lastClickedId=null}}class As{scene;frames=new Map;constructor(e){this.scene=e}static preloadAssets(e){for(let n=1;n<=25;n++)e.load.image(`frame_base_${n}`,`assets/frames/base ${n}.png`)}createFrames(e){e.forEach(n=>{this.createFrame(n)})}createFrame(e){const n=`frame_${e.frameKey}`;if(!this.scene.textures.exists(n)){console.warn(`[GameFrameManager] Frame texture not found: ${n}`);return}const i=e.scale??dt,s=e.depth??Le.ITEMS_FRONT,r=(e.rotation??0)*(Math.PI/180),a=e.rotation===90,{innerWidth:o,innerHeight:l}=En(i,a),d=this.scene.add.graphics();d.setDepth(s-.1),Gn(d,e.x,e.y,o,l,e.backgroundColor||bn);const u=this.scene.add.sprite(e.x,e.y,n);u.setScale(i),u.setDepth(s),u.setOrigin(.5,.5),u.setRotation(r);const f={sprite:u,background:d,data:e};this.frames.set(e.id,f),e.url&&this.makeClickable(f)}makeClickable(e){const{sprite:n,data:i}=e;n.setInteractive({useHandCursor:!0}),n.on("pointerover",()=>{n.setScale((i.scale??dt)*1.05)}),n.on("pointerout",()=>{n.setScale(i.scale??dt)}),n.on("pointerdown",()=>{i.url&&(Lo(),window.open(i.url,"_blank","noopener,noreferrer"))})}destroy(){this.frames.forEach(({sprite:e,background:n})=>{e.destroy(),n.destroy()}),this.frames.clear()}}async function Ms(){const t=await fetch("./config/map.json");if(!t.ok)throw new Error(`Failed to load map config: ${t.status}`);const e=await t.json();if(!e.worldWidth||!e.worldHeight)throw new Error("Invalid map config structure");return e}const Kn={generateId(){return`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`},create(t){const{assetKey:e,x:n,yOffset:i=0,depthLayer:s="behind",scale:r}=t;return{id:Kn.generateId(),assetKey:e,x:Math.round(n),y:0,scale:r??fl(e),depth:Ui(s),yOffset:Math.round(i)}},createAtWorldPosition(t,e,n,i,s="behind"){return Kn.create({assetKey:t,x:e,yOffset:n-i,depthLayer:s})},clone(t,e=50){return{...t,id:Kn.generateId(),x:t.x+e}}},Pt={HEIGHT:40,VISUAL:{COLOR:9139029,ALPHA:.3},PHYSICS:{COLOR:0,ALPHA:0}},Pn={getGroundY(t,e=Pt.HEIGHT){return t-e},createVisualGround(t,e){const n=e.height??Pt.HEIGHT,i=Pn.getGroundY(e.worldHeight,n),s=t.add.rectangle(0,i,e.worldWidth,n,e.color??Pt.VISUAL.COLOR,e.alpha??Pt.VISUAL.ALPHA);return s.setOrigin(0,0),s.setDepth(e.depth??Le.GROUND_REFERENCE),{ground:s,groundY:i}},createPhysicsGround(t,e){const n=e.height??Pt.HEIGHT,i=Pn.getGroundY(e.worldHeight,n),s=t.add.rectangle(0,i,e.worldWidth,n,e.color??Pt.PHYSICS.COLOR,e.alpha??Pt.PHYSICS.ALPHA);return s.setOrigin(0,0),t.physics.add.existing(s,!0),{ground:s,groundY:i}},addPlayerCollision(t,e,n){return t.physics.add.collider(e,n)}},ut={GAME:"GameScene",BUILDER:"BuilderScene"};class Zl extends B.Scene{player;mapConfig;parallaxLayers=null;loadedBackgrounds=new Set;itemManager;frameManager;dialogZones=[];currentDialogZone=null;unsubscribers=[];initData;constructor(){super({key:ut.GAME})}init(e){this.initData=e}preload(){at.forEach(e=>{this.load.spritesheet(`cat-idle-${e}`,`assets/sprites/${e}/Idle.png`,{frameWidth:48,frameHeight:48}),this.load.spritesheet(`cat-walk-${e}`,`assets/sprites/${e}/Walk.png`,{frameWidth:48,frameHeight:48})}),ri.preloadAssets(this),As.preloadAssets(this)}create(){this.initializeScene()}async initializeScene(){Pi.set(!0);try{await this.loadMapConfiguration();const e=ti.getCurrentConfig();await this.loadBackgroundIfNeeded(e),this.createParallaxBackground();const{ground:n,groundY:i}=Pn.createPhysicsGround(this,{worldWidth:this.mapConfig.worldWidth,worldHeight:this.mapConfig.worldHeight});this.player=new Bo(this,this.mapConfig.playerStartX,this.mapConfig.playerStartY),Pn.addPlayerCollision(this,this.player,n),this.itemManager=new ri(this,i,!1),this.mapConfig.placedItems&&this.mapConfig.placedItems.length>0&&this.itemManager.createItems(this.mapConfig.placedItems);const s=this.itemManager.getPhysicsGroup();s&&this.physics.add.collider(this.player,s),this.frameManager=new As(this),this.mapConfig.placedFrames&&this.mapConfig.placedFrames.length>0&&this.frameManager.createFrames(this.mapConfig.placedFrames),this.dialogZones=this.mapConfig.dialogZones||[];const r=qi.subscribe(a=>{this.dialogZones=a,this.recheckCurrentZone()});this.unsubscribers.push(r),this.cameras.main.startFollow(this.player,!0,.1,.1),this.cameras.main.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.physics.world.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.scale.on("resize",this.handleResize,this)}catch(e){console.error("[GameScene] Failed to initialize scene:",e)}finally{Pi.set(!1)}}async loadMapConfiguration(){try{if(this.initData?.useBuilderConfig){const e=cl();this.mapConfig=e||await Ms()}else this.mapConfig=await Ms()}catch(e){console.error("[GameScene] Failed to load map configuration:",e),this.mapConfig={worldWidth:3200,worldHeight:600,playerStartX:400,playerStartY:300,placedItems:[]}}}createParallaxBackground(){const e=ti.getCurrentConfig();this.parallaxLayers=Lr(this,this.mapConfig.worldWidth,this.mapConfig.worldHeight,e)}async loadBackgroundIfNeeded(e){if(this.loadedBackgrounds.has(e.folder))return!0;const n=await Or(this,e);return n&&this.loadedBackgrounds.add(e.folder),n}handleResize(e){if(!(!this.cameras?.main||!this.mapConfig)&&(this.cameras.main.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.parallaxLayers?.baseLayer)){const n=Math.max(this.mapConfig.worldHeight,e.height);this.parallaxLayers.baseLayer.setSize(this.mapConfig.worldWidth,n)}}shutdown(){this.scale.off("resize",this.handleResize,this),yi(null),this.currentDialogZone=null,this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.itemManager&&this.itemManager.destroy()}update(){if(!this.player)return;this.player.update();const e=this.cameras.main,n=this.player.x-e.scrollX,i=this.player.y-e.scrollY;$o(n,i),Oo(e.scrollX,e.scrollY,e.zoom),this.checkDialogZones(),this.parallaxLayers&&Rr(this.parallaxLayers.baseLayer,this.cameras.main)}checkDialogZones(){const e=this.player.x;let n=null;for(const i of this.dialogZones)if(e>=i.x&&e<=i.x+i.width){n=i;break}n?.id!==this.currentDialogZone?.id&&(this.currentDialogZone=n,yi(n))}recheckCurrentZone(){if(!this.currentDialogZone)return;const e=this.dialogZones.find(n=>n.id===this.currentDialogZone?.id);e&&(this.currentDialogZone=e,yi(e))}}let Vr=!1;function Yn(t){Vr=t}function Ps(){return Vr}function xn(){const t=document.activeElement;if(!t)return!1;const e=t.tagName.toUpperCase();return e==="INPUT"||e==="TEXTAREA"||t.getAttribute("contenteditable")==="true"}const Wl=.05,zl=1,Zn=400;class Gl{scene;camera;worldWidth;worldHeight;isPanning=!1;panStartX=0;panStartY=0;cameraDragStartX=0;cameraDragStartY=0;isDraggingToScroll=!1;dragScrollStartX=0;dragScrollStartY=0;dragScrollCameraStartX=0;dragScrollCameraStartY=0;isZoomedOut=!1;isAnimating=!1;savedScrollX=0;savedScrollY=0;constructor(e,n,i){this.scene=e,this.camera=e.cameras.main,this.worldWidth=n,this.worldHeight=i}setup(){this.setupCamera(),this.setupMouseControls(),this.setupKeyboardControls()}setupCamera(){this.camera.setBounds(0,0,this.worldWidth,this.worldHeight),this.camera.setZoom(1)}centerOn(e,n){this.camera.centerOn(e,n)}setupMouseControls(){this.scene.input.on("wheel",(e,n,i,s)=>{if(this.isZoomedOut)return;const r=this.camera.scrollX+i,a=this.camera.scrollY+s;this.camera.setScroll(B.Math.Clamp(r,0,this.worldWidth-this.camera.width),B.Math.Clamp(a,0,this.worldHeight-this.camera.height))}),this.scene.input.on("pointerdown",e=>{this.isZoomedOut||Ps()||(e.rightButtonDown()||e.middleButtonDown()?(this.isPanning=!0,this.panStartX=e.x,this.panStartY=e.y,this.cameraDragStartX=this.camera.scrollX,this.cameraDragStartY=this.camera.scrollY):e.leftButtonDown()&&!this.isDraggingObject()&&(this.scene.data.get("isDraggingItem")===!0||(this.dragScrollStartX=e.x,this.dragScrollStartY=e.y,this.dragScrollCameraStartX=this.camera.scrollX,this.dragScrollCameraStartY=this.camera.scrollY)))}),this.scene.input.on("pointermove",e=>{if(!(this.isZoomedOut||Ps())){if(this.isPanning){const n=e.x-this.panStartX,i=e.y-this.panStartY,s=this.cameraDragStartX-n,r=this.cameraDragStartY-i;this.camera.setScroll(B.Math.Clamp(s,0,this.worldWidth-this.camera.width),B.Math.Clamp(r,0,this.worldHeight-this.camera.height))}else if(e.leftButtonDown()&&!this.isDraggingToScroll&&!this.isDraggingObject()&&!(this.scene.data.get("isDraggingItem")===!0)){const i=Math.abs(e.x-this.dragScrollStartX),s=Math.abs(e.y-this.dragScrollStartY);Math.sqrt(i*i+s*s)>10&&(this.isDraggingToScroll=!0,this.scene.input.setDefaultCursor("grabbing"))}if(this.isDraggingToScroll){const n=e.x-this.dragScrollStartX,i=e.y-this.dragScrollStartY,s=this.dragScrollCameraStartX-n,r=this.dragScrollCameraStartY-i;this.camera.setScroll(B.Math.Clamp(s,0,this.worldWidth-this.camera.width),B.Math.Clamp(r,0,this.worldHeight-this.camera.height))}}}),this.scene.input.on("pointerup",e=>{!e.rightButtonDown()&&!e.middleButtonDown()&&(this.isPanning=!1),this.isDraggingToScroll&&(this.isDraggingToScroll=!1,this.scene.input.setDefaultCursor("default"))})}setupKeyboardControls(){const e={up:this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.UP,!1),down:this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.DOWN,!1),left:this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.LEFT,!1),right:this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.RIGHT,!1)},n={w:this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.W,!1),a:this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.A,!1),s:this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.S,!1),d:this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.D,!1)};this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.SPACE,!1).on("down",()=>{xn()||this.isZoomedOut||this.centerOnPlayer()}),this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.F,!1).on("down",()=>{xn()||this.toggleZoomToFit()}),this.scene.events.on("update",()=>{if(this.isZoomedOut||xn())return;const r=10;e.left.isDown||n.a.isDown?this.camera.scrollX=Math.max(0,this.camera.scrollX-r):(e.right.isDown||n.d.isDown)&&(this.camera.scrollX=Math.min(this.worldWidth-this.camera.width,this.camera.scrollX+r)),e.up.isDown||n.w.isDown?this.camera.scrollY=Math.max(0,this.camera.scrollY-r):(e.down.isDown||n.s.isDown)&&(this.camera.scrollY=Math.min(this.worldHeight-this.camera.height,this.camera.scrollY+r))})}centerOnPlayer(){const e=this.scene.data.get("playerSprite");e&&this.camera.centerOn(e.x,e.y)}isDraggingObject(){return this.scene.data.get("isDraggingObject")===!0}getIsZoomedOut(){return this.isZoomedOut}toggleZoomToFit(){this.isZoomedOut?this.resetZoom():this.zoomToFit()}zoomToFit(){if(this.isZoomedOut||this.isAnimating)return;this.savedScrollX=this.camera.scrollX,this.savedScrollY=this.camera.scrollY,this.isZoomedOut=!0,this.isAnimating=!0,Ss(!0);const e=this.camera.width/this.worldWidth,n=this.camera.height/this.worldHeight;let i=Math.min(e,n);i=Math.max(i,Wl);const s=this.worldWidth/2,r=this.worldHeight/2;this.camera.removeBounds(),this.camera.pan(s,r,Zn,"Sine.easeInOut"),this.camera.zoomTo(i,Zn,"Sine.easeInOut",!1,(a,o)=>{o===1&&(this.isAnimating=!1)})}resetZoom(){if(!this.isZoomedOut||this.isAnimating)return;this.isZoomedOut=!1,this.isAnimating=!0,Ss(!1);const e=this.savedScrollX+this.camera.width/2,n=this.savedScrollY+this.camera.height/2;this.camera.pan(e,n,Zn,"Sine.easeInOut"),this.camera.zoomTo(zl,Zn,"Sine.easeInOut",!1,(i,s)=>{s===1&&(this.camera.setBounds(0,0,this.worldWidth,this.worldHeight),this.isAnimating=!1)})}destroy(){}}class Kl{scene;player;worldWidth;worldHeight;groundY;unsubscribers=[];constructor(e,n,i){this.scene=e,this.worldWidth=n,this.worldHeight=i,this.groundY=i-si}create(e,n){this.player=this.scene.add.sprite(e,n,"cat-idle-white",0),this.player.setScale(Cs),this.player.setDepth(vl);const i=new B.Geom.Rectangle(8,4,32,40);return this.player.setInteractive({hitArea:i,hitAreaCallback:B.Geom.Rectangle.Contains,draggable:!0,cursor:"grab"}),this.scene.data.set("playerSprite",this.player),this.setupDragHandlers(),this.setupEditModeSubscription(),this.player}setupEditModeSubscription(){const e=Re.subscribe(n=>{if(n==="dialogs")this.player.disableInteractive(),this.player.setAlpha(.6);else{const i=new B.Geom.Rectangle(8,4,32,40);this.player.setInteractive({hitArea:i,hitAreaCallback:B.Geom.Rectangle.Contains,draggable:!0,cursor:"grab"}),this.player.setAlpha(1)}});this.unsubscribers.push(e)}setupDragHandlers(){this.player.on("dragstart",()=>{this.player.setTint(Tl),this.scene.data.set("isDraggingObject",!0)}),this.player.on("drag",(e,n,i)=>{const s=B.Math.Clamp(n,Ts,this.worldWidth-Ts),r=B.Math.Clamp(i,Il,this.worldHeight-Cl);this.player.setPosition(s,r),ws(Math.round(s),Math.round(r))}),this.player.on("dragend",()=>{this.player.clearTint(),this.scene.data.set("isDraggingObject",!1);let e=this.player.y;const n=pl*Cs;this.player.y+n/2>this.groundY&&(e=this.groundY-n/2,this.player.setY(e)),ws(Math.round(this.player.x),Math.round(e))})}getSprite(){return this.player}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.player&&this.player.destroy()}}class Ul{scene;graphics;worldWidth;worldHeight;constructor(e,n,i){this.scene=e,this.worldWidth=n,this.worldHeight=i}create(){return this.graphics=this.scene.add.graphics(),this.graphics.setDepth(Kr),this.draw(),this.graphics}draw(){this.graphics.clear(),this.graphics.lineStyle(yl,ml,_l);const e=Math.max(this.worldHeight,this.scene.scale.height);for(let i=0;i<=this.worldWidth;i+=ln)this.graphics.beginPath(),this.graphics.moveTo(i,0),this.graphics.lineTo(i,e),this.graphics.strokePath();for(let i=0;i<=e;i+=ln)this.graphics.beginPath(),this.graphics.moveTo(0,i),this.graphics.lineTo(this.worldWidth,i),this.graphics.strokePath();const n=this.worldHeight-si;this.graphics.lineStyle(bl,Si,wl),this.graphics.beginPath(),this.graphics.moveTo(0,n),this.graphics.lineTo(this.worldWidth,n),this.graphics.strokePath(),this.graphics.lineStyle(El,Si,xl),this.graphics.fillStyle(Si,Sl),this.graphics.fillRect(0,n,this.worldWidth,e-n)}getGraphics(){return this.graphics}redraw(){this.draw()}destroy(){this.graphics&&this.graphics.destroy()}}class jl{listeners=new Map;on(e,n){this.listeners.has(e)||this.listeners.set(e,new Set);const i=this.listeners.get(e);return i.add(n),{unsubscribe:()=>{i.delete(n),i.size===0&&this.listeners.delete(e)}}}once(e,n){const i=this.on(e,s=>{i.unsubscribe(),n(s)});return i}emit(e,n){const i=this.listeners.get(e);i&&i.forEach(s=>{try{s(n)}catch(r){console.error(`[EventBus] Error in listener for "${e}":`,r)}})}off(e){this.listeners.delete(e)}clear(){this.listeners.clear()}listenerCount(e){return this.listeners.get(e)?.size??0}}const be=new jl,we={ASSET_DROPPED:"asset:dropped",FRAME_DROPPED:"frame:dropped",MINIMAP_NAVIGATE:"minimap:navigate",DIALOG_ZONE_CREATE:"dialogZone:create",DIALOG_ZONE_CREATE_AT:"dialogZone:createAt",TEMP_ZONE_BUTTON_SHOW:"tempZoneButton:show",TEMP_ZONE_BUTTON_HIDE:"tempZoneButton:hide"};class Vl{scene;groundY;itemManager;unsubscribers=[];constructor(e,n){this.scene=e,this.groundY=n}create(e){return this.itemManager=new ri(this.scene,this.groundY,!0),e&&e.length>0&&this.itemManager.createItems(e),this.setupBackgroundDeselect(),this.setupStoreSubscriptions(),this.setupAssetDropListener(),this.setupDeleteKeys(),this.itemManager}setupBackgroundDeselect(){this.itemManager.setupBackgroundDeselect()}setupStoreSubscriptions(){const e=Nr.subscribe(r=>{this.scene.data.set("selectedItemId",r),this.itemManager.updateSelectionVisuals()});this.unsubscribers.push(e);const n=Re.subscribe(r=>{r==="dialogs"?(ts(),this.itemManager.setInteractiveEnabled(!1)):this.itemManager.setInteractiveEnabled(!0)});this.unsubscribers.push(n);let i=[];const s=zo.subscribe(r=>{if(!r?.placedItems)return;const a=r.placedItems;i.forEach(o=>{a.find(d=>d.id===o.id)||this.itemManager.removeItem(o.id)}),a.forEach(o=>{const l=i.find(d=>d.id===o.id);l&&JSON.stringify(l)!==JSON.stringify(o)&&this.itemManager.updateItem(o.id,o)}),i=a.map(o=>({...o}))});this.unsubscribers.push(s)}setupAssetDropListener(){const e=be.on(we.ASSET_DROPPED,n=>{const{assetKey:i,canvasX:s,canvasY:r}=n,o=this.scene.cameras.main.getWorldPoint(s,r),l=o.x,d=o.y;let u="behind";Br.subscribe(p=>{u=p})();const g=Kn.createAtWorldPosition(i,l,d,this.groundY,u);nl(g),this.itemManager.createItem(g),ii(g.id)});this.unsubscribers.push(()=>e.unsubscribe())}setupDeleteKeys(){const e=this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.DELETE,!1),n=this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.BACKSPACE,!1),i=()=>{if(xn())return;const s=this.scene.data.get("selectedItemId");s&&zr(s)};e.on("down",i),n.on("down",i)}getManager(){return this.itemManager}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.itemManager&&this.itemManager.destroy()}}function $s(t,e){return Math.round(t/e)*e}class Os{scene;frames=new Map;unsubscribers=[];selectionGraphics=null;isDragging=!1;dragStartX=0;dragStartY=0;doubleClickDetector=new Yl;constructor(e){this.scene=e}static preloadAssets(e){for(let n=1;n<=25;n++)e.load.image(`frame_base_${n}`,`assets/frames/base ${n}.png`)}create(e){this.selectionGraphics=this.scene.add.graphics(),this.selectionGraphics.setDepth(Le.SELECTION_GRAPHICS),e&&e.length>0&&e.forEach(n=>this.createFrame(n)),this.setupBackgroundDeselect(),this.setupStoreSubscriptions(),this.setupFrameDropListener(),this.setupDeleteKeys()}createFrame(e){const n=`frame_${e.frameKey}`;if(!this.scene.textures.exists(n)){console.warn(`Frame texture not found: ${n}`);return}const i=e.scale??dt,s=e.depth??Le.ITEMS_FRONT,r=(e.rotation??0)*(Math.PI/180),a=e.rotation===90,{innerWidth:o,innerHeight:l}=En(i,a),d=this.scene.add.graphics();d.setDepth(s-.1),Gn(d,e.x,e.y,o,l,e.backgroundColor||bn);const u=this.scene.add.sprite(e.x,e.y,n);u.setScale(i),u.setDepth(s),u.setOrigin(.5,.5),u.setRotation(r);const f={sprite:u,background:d,data:e};this.frames.set(e.id,f),this.makeInteractive(f,e.id)}updateFrameVisuals(e){const{sprite:n,background:i,data:s}=e,r=`frame_${s.frameKey}`;n.texture.key!==r&&this.scene.textures.exists(r)&&n.setTexture(r);const a=s.scale??dt;n.setScale(a);const o=(s.rotation??0)*(Math.PI/180);n.setRotation(o);const l=s.rotation===90,{innerWidth:d,innerHeight:u}=En(a,l);Gn(i,n.x,n.y,d,u,s.backgroundColor||bn)}moveContainer(e,n,i){const{sprite:s,background:r,data:a}=e;s.setPosition(n,i);const o=a.scale??dt,l=a.rotation===90,{innerWidth:d,innerHeight:u}=En(o,l);Gn(r,n,i,d,u,a.backgroundColor||bn)}makeInteractive(e,n){const{sprite:i}=e;i.setInteractive({draggable:!0,useHandCursor:!0}),i.on("pointerdown",s=>{if(!this.isDragging){if(en(n),this.updateSelectionVisuals(),this.doubleClickDetector.check(n)){ni();return}this.isDragging=!0,this.scene.data.set("isDraggingItem",!0),bt(!0),this.dragStartX=i.x-s.worldX,this.dragStartY=i.y-s.worldY}}),i.on("pointermove",s=>{if(!this.isDragging)return;if(!s.isDown){this.isDragging=!1;return}let r=s.worldX+this.dragStartX,a=s.worldY+this.dragStartY;Xt(fi)&&(r=$s(r,ln),a=$s(a,ln)),this.moveContainer(e,r,a),this.updateSelectionVisuals(),qo(n,r,a)}),i.on("pointerup",()=>{this.isDragging&&(this.isDragging=!1,this.scene.data.set("isDraggingItem",!1),bt(!1),Jo(n),e.data.x=Math.round(i.x),e.data.y=Math.round(i.y),ot(n,{x:e.data.x,y:e.data.y}))})}setupBackgroundDeselect(){this.scene.input.on("pointerdown",e=>{let n="items";if(Re.subscribe(a=>n=a)(),n!=="frames"&&n!=="items")return;!this.scene.input.hitTestPointer(e).some(a=>{for(const[o,l]of this.frames)if(l.sprite===a)return!0;return!1})&&!this.isDragging&&(en(null),this.updateSelectionVisuals())})}setupStoreSubscriptions(){const e=Ji.subscribe(r=>{this.scene.data.set("selectedFrameId",r),this.updateSelectionVisuals()});this.unsubscribers.push(e);const n=Re.subscribe(r=>{r==="dialogs"?(en(null),this.setInteractiveEnabled(!1)):this.setInteractiveEnabled(!0)});this.unsubscribers.push(n);let i=[];const s=Yr.subscribe(r=>{i.forEach(a=>{r.find(l=>l.id===a.id)||this.removeFrame(a.id)}),r.forEach(a=>{const o=i.find(d=>d.id===a.id),l=this.frames.get(a.id);if(l&&o){const d=o.backgroundColor!==a.backgroundColor,u=o.textColor!==a.textColor,f=o.textSize!==a.textSize,g=JSON.stringify(o.texts)!==JSON.stringify(a.texts),p=o.rotation!==a.rotation,v=o.scale!==a.scale,E=o.frameKey!==a.frameKey;l.data=a,(d||u||f||g||p||v||E)&&(this.updateFrameVisuals(l),this.scene.data.get("selectedFrameId")===a.id&&this.updateSelectionVisuals())}}),i=r.map(a=>({...a}))});this.unsubscribers.push(s)}setupFrameDropListener(){const e=be.on(we.FRAME_DROPPED,n=>{const{frameKey:i,canvasX:s,canvasY:r}=n,o=this.scene.cameras.main.getWorldPoint(s,r),l={id:Ml(),frameKey:i,x:Math.round(o.x),y:Math.round(o.y),scale:Xl(i),depth:Le.ITEMS_FRONT,rotation:90,backgroundColor:bn,textColor:"#333333",textSize:16,texts:[{language:"cs",text:""},{language:"en",text:""}]};hl(l),this.createFrame(l),en(l.id),ni()});this.unsubscribers.push(()=>e.unsubscribe())}setupDeleteKeys(){const e=this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.DELETE,!1),n=this.scene.input.keyboard.addKey(B.Input.Keyboard.KeyCodes.BACKSPACE,!1),i=()=>{if(xn())return;let s="items";if(Re.subscribe(o=>s=o)(),s!=="frames")return;const a=this.scene.data.get("selectedFrameId");a&&ns(a)};e.on("down",i),n.on("down",i)}updateSelectionVisuals(){if(!this.selectionGraphics)return;this.selectionGraphics.clear();const e=this.scene.data.get("selectedFrameId");if(!e){wi(null);return}const n=this.frames.get(e);if(!n){wi(null);return}const i=n.sprite,s=i.getBounds(),r=this.scene.cameras.main,a=(i.x-r.scrollX)*r.zoom,o=(i.y-r.scrollY)*r.zoom;wi({screenX:a,screenY:o,frameHeight:s.height*r.zoom}),this.selectionGraphics.lineStyle(3,10181046,1),this.selectionGraphics.strokeRect(s.x-4,s.y-4,s.width+8,s.height+8);const l=8;this.selectionGraphics.fillStyle(10181046,1),this.selectionGraphics.fillRect(s.x-4-l/2,s.y-4-l/2,l,l),this.selectionGraphics.fillRect(s.right+4-l/2,s.y-4-l/2,l,l),this.selectionGraphics.fillRect(s.x-4-l/2,s.bottom+4-l/2,l,l),this.selectionGraphics.fillRect(s.right+4-l/2,s.bottom+4-l/2,l,l)}removeFrame(e){const n=this.frames.get(e);n&&(n.sprite.destroy(),n.background.destroy(),this.frames.delete(e)),this.updateSelectionVisuals()}setInteractiveEnabled(e){this.frames.forEach(({sprite:n,background:i})=>{e?(n.setInteractive({draggable:!0,useHandCursor:!0}),n.setAlpha(1),i.setAlpha(1)):(n.disableInteractive(),n.setAlpha(.6),i.setAlpha(.6))}),!e&&this.selectionGraphics&&this.selectionGraphics.clear()}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.frames.forEach(({sprite:e,background:n})=>{e.destroy(),n.destroy()}),this.frames.clear(),this.selectionGraphics&&(this.selectionGraphics.destroy(),this.selectionGraphics=null)}}const qt=Kr-1,yt=50,Wn=150,ql=.3,Jl=.5,Ei=16,Ls=16777215,Rs=.6,Fs=0;class Ql{scene;worldWidth;worldHeight;graphics=null;zoneAreas=new Map;leftHandles=new Map;rightHandles=new Map;arrowGraphics=new Map;dragging=null;unsubscribers=[];createZoneSubscription;currentEditMode="items";currentZones=[];currentSelectedId=null;lastClickTime=0;lastClickX=0;DOUBLE_CLICK_THRESHOLD=300;DOUBLE_CLICK_DISTANCE=20;pendingTap=null;TAP_MAX_DURATION=300;TAP_MAX_DISTANCE=15;createZoneAtSubscription;boundWindowPointerUp=()=>{};boundWindowPointerMove=()=>{};constructor(e,n,i){this.scene=e,this.worldWidth=n,this.worldHeight=i}create(){this.graphics=this.scene.add.graphics(),this.graphics.setDepth(qt);const e=Re.subscribe(s=>{this.currentEditMode=s,this.render()});this.unsubscribers.push(e);const n=qi.subscribe(s=>{this.currentZones=s,this.render()});this.unsubscribers.push(n);const i=Xr.subscribe(s=>{this.currentSelectedId=s,this.render()});this.unsubscribers.push(i),this.scene.input.on("pointermove",this.handlePointerMove,this),this.scene.input.on("pointerup",this.handlePointerUp,this),this.boundWindowPointerUp=this.handlePointerUp.bind(this),this.boundWindowPointerMove=this.handleWindowPointerMove.bind(this),window.addEventListener("pointerup",this.boundWindowPointerUp),window.addEventListener("pointermove",this.boundWindowPointerMove),this.scene.input.on("pointerdown",this.handlePointerDown,this),this.createZoneSubscription=be.on(we.DIALOG_ZONE_CREATE,()=>{this.createNewZone()}),this.createZoneAtSubscription=be.on(we.DIALOG_ZONE_CREATE_AT,s=>{this.createZoneAtPosition(s.worldX)}),this.render()}clearVisuals(){this.graphics&&this.graphics.clear(),this.zoneAreas.forEach(e=>e.destroy()),this.zoneAreas.clear(),this.leftHandles.forEach(e=>e.destroy()),this.leftHandles.clear(),this.rightHandles.forEach(e=>e.destroy()),this.rightHandles.clear(),this.arrowGraphics.forEach(e=>e.destroy()),this.arrowGraphics.clear()}render(){if(this.clearVisuals(),this.currentEditMode==="dialogs")for(const e of this.currentZones)this.renderZone(e,e.id===this.currentSelectedId)}renderZone(e,n){if(!this.graphics)return;const i=B.Display.Color.HexStringToColor(e.color).color,s=n?Jl:ql;this.graphics.fillStyle(i,s),this.graphics.fillRect(e.x,0,e.width,this.worldHeight),this.graphics.lineStyle(2,i,.8),this.graphics.strokeRect(e.x,0,e.width,this.worldHeight);const r=this.scene.add.rectangle(e.x+e.width/2,this.worldHeight/2,e.width-Ei*2,this.worldHeight);r.setOrigin(.5,.5),r.setInteractive({cursor:n?"grab":"pointer"}),r.setDepth(qt+.1),r.setAlpha(.001),r.setData("zoneId",e.id),r.on("pointerdown",a=>{this.scene.data.set("isDraggingItem",!0),bt(!0),this.currentSelectedId===e.id?this.startDrag(e.id,"move",a.worldX):(yn(e.id),this.scene.data.set("isDraggingItem",!1),bt(!1))}),this.zoneAreas.set(e.id,r),n&&this.createHandles(e)}createHandles(e){const n=this.scene.cameras.main.scrollY,i=this.scene.cameras.main.height,s=n+i/2,r=this.scene.add.rectangle(e.x,this.worldHeight/2,Ei,this.worldHeight);r.setOrigin(.5,.5),r.setInteractive({cursor:"ew-resize"}),r.setDepth(qt+.2),r.setFillStyle(Ls,Rs),r.setData("zoneId",e.id),r.setData("type","left"),r.on("pointerdown",u=>{this.startDrag(e.id,"left",u.worldX)}),this.leftHandles.set(e.id,r);const a=8,o=this.scene.add.graphics();o.setDepth(qt+.3),this.drawArrow(o,e.x-a,s,"left"),this.arrowGraphics.set(`${e.id}_left`,o);const l=this.scene.add.rectangle(e.x+e.width,this.worldHeight/2,Ei,this.worldHeight);l.setOrigin(.5,.5),l.setInteractive({cursor:"ew-resize"}),l.setDepth(qt+.2),l.setFillStyle(Ls,Rs),l.setData("zoneId",e.id),l.setData("type","right"),l.on("pointerdown",u=>{this.startDrag(e.id,"right",u.worldX)}),this.rightHandles.set(e.id,l);const d=this.scene.add.graphics();d.setDepth(qt+.3),this.drawArrow(d,e.x+e.width+a,s,"right"),this.arrowGraphics.set(`${e.id}_right`,d)}drawArrow(e,n,i,s){const a=s==="left"?-1:1;e.fillStyle(3355443,.8),e.beginPath(),e.moveTo(n+a*10+1,i),e.lineTo(n-a*10+1,i-10+1),e.lineTo(n-a*10+1,i+10-1),e.closePath(),e.fillPath(),e.fillStyle(16777215,.9),e.beginPath(),e.moveTo(n+a*10,i),e.lineTo(n-a*10,i-10),e.lineTo(n-a*10,i+10),e.closePath(),e.fillPath()}startDrag(e,n,i){const s=this.currentZones.find(r=>r.id===e);s&&(this.scene.data.set("isDraggingItem",!0),bt(!0),this.dragging={zoneId:e,type:n,startX:i,originalX:s.x,originalWidth:s.width})}getZoneBounds(e){let n=0,i=this.worldWidth;for(const s of this.currentZones){if(s.id===e)continue;const r=s.x+s.width,a=this.currentZones.find(o=>o.id===e);a&&(r<=a.x+a.width/2&&(n=Math.max(n,r+Fs)),s.x>=a.x+a.width/2&&(i=Math.min(i,s.x-Fs)))}return{minX:n,maxX:i-yt,maxRight:i}}wouldOverlap(e,n,i){const s=n+i;for(const r of this.currentZones){if(r.id===e)continue;const a=r.x,o=r.x+r.width;if(n<o&&s>a)return!0}return!1}screenToWorld(e,n){const i=this.scene.cameras.main,s=e/i.zoom+i.scrollX,r=n/i.zoom+i.scrollY;return{worldX:s,worldY:r}}handleWindowPointerMove(e){if(this.pendingTap){const{worldX:i}=this.screenToWorld(e.clientX,e.clientY);Math.abs(i-this.pendingTap.worldX)>this.TAP_MAX_DISTANCE&&(this.pendingTap=null)}if(!this.dragging)return;const{worldX:n}=this.screenToWorld(e.clientX,e.clientY);this.updateDrag(n)}handlePointerMove(e){this.pendingTap&&Math.abs(e.worldX-this.pendingTap.worldX)>this.TAP_MAX_DISTANCE&&(this.pendingTap=null),this.dragging&&(e.event?.stopPropagation?.(),this.updateDrag(e.worldX))}updateDrag(e){if(!this.dragging)return;const n=e-this.dragging.startX,i=this.currentZones.find(r=>r.id===this.dragging?.zoneId);if(!i)return;const s=this.getZoneBounds(i.id);if(this.dragging.type==="left"){let r=this.dragging.originalX+n,a=this.dragging.originalWidth-n;if(r<0&&(a+=r,r=0),a<yt&&(r=this.dragging.originalX+this.dragging.originalWidth-yt,a=yt),r<s.minX){const o=s.minX-r;r=s.minX,a-=o}a>=yt&&!this.wouldOverlap(i.id,r,a)&&_n(i.id,{x:r,width:a})}else if(this.dragging.type==="right"){let r=this.dragging.originalWidth+n;r<yt&&(r=yt),i.x+r>this.worldWidth&&(r=this.worldWidth-i.x),i.x+r>s.maxRight&&(r=s.maxRight-i.x),r>=yt&&!this.wouldOverlap(i.id,i.x,r)&&_n(i.id,{width:r})}else if(this.dragging.type==="move"){let r=this.dragging.originalX+n;const a=i.width;if(r<0&&(r=0),r+a>this.worldWidth&&(r=this.worldWidth-a),!this.wouldOverlap(i.id,r,a))_n(i.id,{x:r});else{const o=this.findNonOverlappingPosition(i.id,r,a);o!==null&&_n(i.id,{x:o})}}}findNonOverlappingPosition(e,n,i){const s=this.currentZones.filter(u=>u.id!==e).sort((u,f)=>u.x-f.x);if(s.length===0)return Math.max(0,Math.min(n,this.worldWidth-i));let r=n,a=1/0;const o=s[0];if(o.x>=i){const u=o.x-i,f=Math.max(0,Math.min(n,u)),g=Math.abs(f-n);g<a&&(a=g,r=f)}for(let u=0;u<s.length-1;u++){const f=s[u],g=s[u+1],p=f.x+f.width,v=g.x;if(v-p>=i){const k=p,h=v-i,m=Math.max(k,Math.min(n,h)),y=Math.abs(m-n);y<a&&(a=y,r=m)}}const l=s[s.length-1],d=l.x+l.width;if(this.worldWidth-d>=i){const u=d,f=this.worldWidth-i,g=Math.max(u,Math.min(n,f)),p=Math.abs(g-n);p<a&&(a=p,r=g)}return a<1/0&&!this.wouldOverlap(e,r,i)?r:null}handlePointerUp(e){if(this.dragging&&(this.scene.data.set("isDraggingItem",!1),bt(!1),this.dragging=null),this.pendingTap&&this.currentEditMode==="dialogs"){if(Date.now()-this.pendingTap.startTime<this.TAP_MAX_DURATION){let s=!0;e&&e.worldX!==void 0&&(s=Math.abs(e.worldX-this.pendingTap.worldX)<this.TAP_MAX_DISTANCE),s&&this.showTempAddButton(this.pendingTap.worldX,this.pendingTap.worldY)}this.pendingTap=null}}handlePointerDown(e){if(this.currentEditMode!=="dialogs"||this.dragging)return;const n=e.downElement;if(n&&n.tagName?.toUpperCase()!=="CANVAS")return;const i=e.worldX;for(const o of this.currentZones)if(i>=o.x&&i<=o.x+o.width)return;const s=Date.now(),r=s-this.lastClickTime,a=Math.abs(i-this.lastClickX);if(r<this.DOUBLE_CLICK_THRESHOLD&&a<this.DOUBLE_CLICK_DISTANCE){this.createZoneAtPosition(i),this.lastClickTime=0,this.hideTempAddButton();return}this.lastClickTime=s,this.lastClickX=i,this.pendingTap={worldX:i,worldY:e.worldY,startTime:s},this.currentSelectedId&&yn(null)}showTempAddButton(e,n){const i=this.scene.cameras.main,s=(e-i.scrollX)*i.zoom,r=(n-i.scrollY)*i.zoom;be.emit(we.TEMP_ZONE_BUTTON_SHOW,{screenX:s,screenY:r,worldX:e})}hideTempAddButton(){be.emit(we.TEMP_ZONE_BUTTON_HIDE,{})}createZoneAtPosition(e){let n=e-Wn/2;const i=Wn;if(n=Math.max(0,Math.min(this.worldWidth-i,n)),this.wouldOverlap("",n,i)){const r=this.findNonOverlappingPosition("",n,i);if(r===null){console.warn("No room for a new dialog zone");return}n=r}const s=ys(n,i);s.x=n,Es(s),yn(s.id)}createNewZone(){const e=this.scene.cameras.main;let i=e.scrollX+e.width/2-Wn/2;const s=Wn;if(i=Math.max(0,Math.min(this.worldWidth-s,i)),this.wouldOverlap("",i,s)){const a=this.findNonOverlappingPosition("",i,s);if(a===null){console.warn("No room for a new dialog zone");return}i=a}const r=ys(i,s);r.x=i,Es(r),yn(r.id)}destroy(){this.hideTempAddButton();for(const e of this.unsubscribers)e();this.unsubscribers=[],this.createZoneSubscription&&this.createZoneSubscription.unsubscribe(),this.createZoneAtSubscription&&this.createZoneAtSubscription.unsubscribe(),this.scene.input.off("pointerdown",this.handlePointerDown,this),this.scene.input.off("pointermove",this.handlePointerMove,this),this.scene.input.off("pointerup",this.handlePointerUp,this),window.removeEventListener("pointerup",this.boundWindowPointerUp),window.removeEventListener("pointermove",this.boundWindowPointerMove),this.clearVisuals(),this.graphics&&(this.graphics.destroy(),this.graphics=null),this.dragging=null}}class ec extends B.Scene{parallaxLayers=null;cameraController;playerController;gridOverlay;itemsController;framesController;dialogZoneRenderer;config;minimapSubscription;isShuttingDown=!1;get itemManager(){return this.itemsController?.getManager()}toggleZoom(){this.cameraController?.toggleZoomToFit()}constructor(){super({key:ut.BUILDER})}init(e){this.config=e.config}preload(){this.load.spritesheet("cat-idle-white","assets/sprites/white/Idle.png",{frameWidth:48,frameHeight:48}),ri.preloadAssets(this),Os.preloadAssets(this)}create(){this.isShuttingDown=!1,this.physics.world.setBounds(0,0,this.config.worldWidth,this.config.worldHeight);const e=this.config.worldHeight-si;this.cameraController=new Gl(this,this.config.worldWidth,this.config.worldHeight),this.playerController=new Kl(this,this.config.worldWidth,this.config.worldHeight),this.gridOverlay=new Ul(this,this.config.worldWidth,this.config.worldHeight),this.itemsController=new Vl(this,e),this.framesController=new Os(this),this.dialogZoneRenderer=new Ql(this,this.config.worldWidth,this.config.worldHeight),this.createBackground(),this.gridOverlay.create(),this.createGroundReference(),this.playerController.create(this.config.playerStartX,this.config.playerStartY),this.itemsController.create(this.config.placedItems||[]),this.framesController.create(this.config.placedFrames||[]),this.dialogZoneRenderer.create(),this.cameraController.setup(),this.cameraController.centerOn(this.config.playerStartX,this.config.playerStartY),this.minimapSubscription=be.on(we.MINIMAP_NAVIGATE,n=>{this.navigateToPosition(n.worldX,n.worldY)}),this.scale.on("resize",this.handleResize,this),this.events.on("shutdown",this.shutdown,this)}async createBackground(){const e=ti.getCurrentConfig();try{await Or(this,e)}catch(n){console.error("Failed to load background:",n);return}this.parallaxLayers&&(Yo(this.parallaxLayers),this.parallaxLayers=null),this.parallaxLayers=Lr(this,this.config.worldWidth,this.config.worldHeight,e)}createGroundReference(){Pn.createVisualGround(this,{worldWidth:this.config.worldWidth,worldHeight:this.config.worldHeight,height:si})}update(){this.parallaxLayers&&Rr(this.parallaxLayers.baseLayer,this.cameras.main),this.itemManager?.updateSelectionVisuals(),this.framesController?.updateSelectionVisuals();const e=this.cameras.main,n=this.data.get("playerSprite");dl({scrollX:e.worldView.x,scrollY:e.worldView.y,viewWidth:e.width,viewHeight:e.height,worldWidth:this.config.worldWidth,worldHeight:this.config.worldHeight,zoom:e.zoom,playerX:n?.x??this.config.playerStartX,playerY:n?.y??this.config.playerStartY})}navigateToPosition(e,n){this.cameraController.getIsZoomedOut()||this.cameraController.centerOn(e,n)}handleResize(e){if(!(!this.cameras?.main||!this.config)){if(this.cameraController?.getIsZoomedOut()||this.cameras.main.setBounds(0,0,this.config.worldWidth,this.config.worldHeight),this.parallaxLayers?.baseLayer){const n=Math.max(this.config.worldHeight,e.height);this.parallaxLayers.baseLayer.setSize(this.config.worldWidth,n)}this.gridOverlay&&this.gridOverlay.redraw()}}shutdown(){this.isShuttingDown||(this.isShuttingDown=!0,this.scale.off("resize",this.handleResize,this),this.minimapSubscription&&this.minimapSubscription.unsubscribe(),this.cameraController&&this.cameraController.destroy(),this.playerController&&this.playerController.destroy(),this.gridOverlay&&this.gridOverlay.destroy(),this.itemsController&&this.itemsController.destroy(),this.framesController&&this.framesController.destroy(),this.dialogZoneRenderer&&this.dialogZoneRenderer.destroy())}}const tc="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(tc);Ia();class nc{currentLanguage="cs";setLanguage(e){this.currentLanguage=e,localStorage.setItem("language",e)}getLanguage(){const e=localStorage.getItem("language");return(e==="cs"||e==="en")&&(this.currentLanguage=e),this.currentLanguage}toggleLanguage(){return this.currentLanguage=this.currentLanguage==="cs"?"en":"cs",this.setLanguage(this.currentLanguage),this.currentLanguage}}const qr=new nc;let Ye=null;function ic(t){Ye=t}function sc(){if(!Ye)return console.error("Scene manager not initialized"),null;try{return Ye.scene.getScene(ut.GAME)?.mapConfig||null}catch(t){return console.error("Failed to get map config:",t),null}}function rc(t){if(!Ye)return console.error("Scene manager not initialized"),!1;try{return Ye.scene.getScene(ut.GAME)?(Ye.scene.stop(ut.GAME),ol(t),Ye.scene.start(ut.BUILDER,{config:t}),!0):(console.error("GameScene not found"),!1)}catch(e){return console.error("Failed to switch to builder:",e),!1}}function ac(){if(!Ye)return console.error("Scene manager not initialized"),!1;try{return Ye.scene.stop(ut.BUILDER),ll(),Ye.scene.start(ut.GAME,{useBuilderConfig:!0}),!0}catch(t){return console.error("Failed to switch to game:",t),!1}}function Jr(){if(Ye)try{Ye.scene.getScene(ut.BUILDER)?.toggleZoom()}catch(t){console.error("Failed to toggle zoom:",t)}}var oc=N('<button class="close-btn svelte-yrmttr" title="Close">×</button>'),lc=N('<div class="resize-handle resize-handle-sw svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M1 1L9 9M1 5L5 9M1 9L1 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></div> <div class="resize-handle resize-handle-se svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M9 1L1 9M9 5L5 9M9 9L9 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></div>',1),cc=N("<div><!></div> <!>",1),dc=N('<div><div class="panel-header svelte-yrmttr"><span class="panel-title svelte-yrmttr"> </span> <!> <div class="header-buttons svelte-yrmttr"><button class="minimize-btn svelte-yrmttr"> </button> <!></div></div> <!></div>');function gi(t,e){de(e,!0);const n=()=>R(Yt,"$isDraggingInBuilder",i),[i,s]=Te();let r=1e3,a=Q(e,"initialRight",3,10),o=Q(e,"initialTop",3,60),l=Q(e,"width",3,280),d=Q(e,"minWidth",3,200),u=Q(e,"minHeight",3,100),f=Q(e,"maxWidth",3,600),g=Q(e,"maxHeight",3,800),p=Q(e,"resizable",3,!1),v=Q(e,"startMinimized",3,!1),E=Q(e,"showClose",3,!1),k=Y(Ke(v())),h=Y(Ke({x:0,y:0})),m=Y(Ke({width:l(),height:e.height??0})),y=Y(!1),I=Y(!1),_=Y("se"),w=Y(Ke({x:0,y:0})),A=Y(null),$=Y(!1),M=Y(Ke(r));function U(){r++,P(M,r,!0)}Ie(()=>{if(typeof window>"u")return;const H=localStorage.getItem(`panel-state-${e.panelId}`);if(H)try{const W=JSON.parse(H);P(h,{x:W.x,y:W.y},!0),p()&&W.width&&W.height&&P(m,{width:W.width,height:W.height},!0)}catch{P(h,{x:window.innerWidth-l()-a(),y:o()},!0)}else P(h,{x:window.innerWidth-l()-a(),y:o()},!0);P($,!0)}),Ie(()=>{if(!c($))return;const H=p()?{...c(h),width:c(m).width,height:c(m).height}:c(h);localStorage.setItem(`panel-state-${e.panelId}`,JSON.stringify(H))}),Ie(()=>{if(!c($))return;function H(){if(!c(A))return;const W=p()?c(m).width:l();let ce=c(h).x,Pe=c(h).y,pe=!1;const He=window.innerWidth-W;c(h).x>He&&(ce=Math.max(10,He),pe=!0);const mt=window.innerHeight-40;c(h).y>mt&&(Pe=Math.max(10,mt),pe=!0),c(h).x<0&&(ce=10,pe=!0),c(h).y<0&&(Pe=10,pe=!0),pe&&P(h,{x:ce,y:Pe},!0)}return window.addEventListener("resize",H),H(),()=>{window.removeEventListener("resize",H)}});function x(){P(k,!c(k))}function L(){e.onclose?.()}function S(H){H.target.closest("button")||(P(y,!0),P(w,{x:H.clientX-c(h).x,y:H.clientY-c(h).y},!0),H.currentTarget.setPointerCapture(H.pointerId),H.preventDefault())}function D(H){if(!c(y))return;const W=H.clientX-c(w).x,ce=H.clientY-c(w).y,Pe=window.innerWidth-(c(A)?.offsetWidth??l()),pe=window.innerHeight-40;P(h,{x:Math.max(0,Math.min(W,Pe)),y:Math.max(0,Math.min(ce,pe))},!0)}function C(H){c(y)&&(P(y,!1),H.currentTarget.releasePointerCapture(H.pointerId))}function F(H){return W=>{p()&&(P(I,!0),P(_,H,!0),W.currentTarget.setPointerCapture(W.pointerId),W.preventDefault(),W.stopPropagation())}}function Z(H){if(!c(I)||!c(A))return;const W=c(A).getBoundingClientRect();let ce,Pe=H.clientY-W.top,pe=c(h).x;c(_)==="se"?ce=H.clientX-W.left:(ce=W.right-H.clientX,pe=H.clientX);const He=Math.max(d(),Math.min(f(),ce)),mt=Math.max(u(),Math.min(g(),Pe));c(_)==="sw"&&(pe=W.right-He,pe<0&&(pe=0));const kt=c(_)==="se"?window.innerWidth-c(h).x-10:W.right-10,Gt=window.innerHeight-c(h).y-10,rt=Math.min(He,kt),Kt=Math.min(mt,Gt);P(m,{width:rt,height:Kt},!0),c(_)==="sw"&&ce>=d()&&P(h,{...c(h),x:Math.max(0,pe)},!0)}function ee(H){c(I)&&(P(I,!1),H.currentTarget.releasePointerCapture(H.pointerId))}function ge(H){H.stopPropagation()}var q=dc();let Ve;q.__pointerdown=H=>{U(),ge(H)},q.__click=ge;var Se=O(q);Se.__pointerdown=S,Se.__pointermove=D,Se.__pointerup=C;var Zt=O(Se),Wt=O(Zt),We=T(Zt,2);{var pt=H=>{var W=Ce(),ce=re(W);an(ce,()=>e.headerExtra),b(H,W)};K(We,H=>{e.headerExtra&&H(pt)})}var zt=T(We,2),ze=O(zt);ze.__click=x;var pi=O(ze),vt=T(ze,2);{var Hn=H=>{var W=oc();W.__click=L,b(H,W)};K(vt,H=>{E()&&H(Hn)})}var Nn=T(Se,2);{var gn=H=>{var W=cc(),ce=re(W);let Pe;var pe=O(ce);an(pe,()=>e.children);var He=T(ce,2);{var mt=kt=>{var Gt=lc(),rt=re(Gt),Kt=X(()=>F("sw"));rt.__pointerdown=function(...he){c(Kt)?.apply(this,he)},rt.__pointermove=Z,rt.__pointerup=ee;var Ut=T(rt,2),J=X(()=>F("se"));Ut.__pointerdown=function(...he){c(J)?.apply(this,he)},Ut.__pointermove=Z,Ut.__pointerup=ee,Tt("pointercancel",rt,ee),Tt("pointercancel",Ut,ee),b(kt,Gt)};K(He,kt=>{p()&&kt(mt)})}j(()=>Pe=Fe(ce,1,"panel-body svelte-yrmttr",null,Pe,{"has-fixed-height":p()&&c(m).height>0})),b(H,W)};K(Nn,H=>{c(k)||H(gn)})}on(q,H=>P(A,H),()=>c(A)),j(()=>{Ve=Fe(q,1,"draggable-panel svelte-yrmttr",null,Ve,{minimized:c(k),dragging:c(y),resizing:c(I),resizable:p()}),le(q,`left: ${c(h).x??""}px; top: ${c(h).y??""}px; width: ${c(k)?"auto":`${p()?c(m).width:l()}px`}; ${p()&&c(m).height>0&&!c(k)?`height: ${c(m).height}px;`:""}${n()?" pointer-events: none;":""} z-index: ${c(M)??""};`),fe(Wt,e.title),te(ze,"title",c(k)?"Expand":"Minimize"),fe(pi,c(k)?"▲":"▼")}),Tt("pointercancel",Se,C),b(t,q),ue(),s()}je(["pointerdown","click","pointermove","pointerup"]);function Qr(t,e,n){const{previewSize:i,borderColor:s,dataKey:r,eventName:a}=t,o=i/2;function l(h,m){if(!h.dataTransfer)return;n({draggedKey:m}),Yn(!0),h.dataTransfer.effectAllowed="copy",h.dataTransfer.setData(r,m);const I=h.target.querySelector("img")?.cloneNode(!0);I&&(I.style.position="absolute",I.style.top="-1000px",document.body.appendChild(I),h.dataTransfer.setDragImage(I,o,o),setTimeout(()=>I.remove(),0))}function d(){n({draggedKey:null}),Yn(!1)}function u(h,m){if(h.touches.length!==1)return;const y=h.touches[0];n({draggedKey:m}),Yn(!0);const _=h.currentTarget.querySelector("img");if(_){const w=document.createElement("div");w.className="touch-drag-preview",w.innerHTML=`<img src="${_.src}" alt="" />`,w.style.cssText=`
        position: fixed;
        top: ${y.clientY-o}px;
        left: ${y.clientX-o}px;
        width: ${i}px;
        height: ${i}px;
        pointer-events: none;
        z-index: 10000;
        opacity: 0.9;
        image-rendering: pixelated;
        filter: drop-shadow(3px 3px 0 rgba(0, 0, 0, 0.5));
        border: 2px solid ${s};
        background: rgba(26, 26, 46, 0.9);
      `,w.querySelector("img").style.cssText=`
        width: 100%;
        height: 100%;
        object-fit: contain;
        image-rendering: pixelated;
      `,document.body.appendChild(w),n({touchDragElement:w})}}function f(h){const m=e();if(!m.draggedKey||!m.touchDragElement)return;const y=h.touches[0];m.touchDragElement.style.top=`${y.clientY-o}px`,m.touchDragElement.style.left=`${y.clientX-o}px`,h.preventDefault()}function g(h){const m=e();if(!m.draggedKey)return;const y=h.changedTouches[0],I=document.querySelector("canvas");if(m.touchDragElement&&(m.touchDragElement.remove(),n({touchDragElement:null})),I){const _=I.getBoundingClientRect(),w=y.clientX,A=y.clientY;if(w>=_.left&&w<=_.right&&A>=_.top&&A<=_.bottom){const $=w-_.left,M=A-_.top;be.emit(a,{[r]:m.draggedKey,canvasX:$,canvasY:M})}}n({draggedKey:null}),Yn(!1)}function p(h){h.preventDefault(),h.dataTransfer&&(h.dataTransfer.dropEffect="copy")}function v(h){h.preventDefault();const m=h.dataTransfer?.getData(r);if(!m)return;const I=h.target.getBoundingClientRect(),_=h.clientX-I.left,w=h.clientY-I.top;be.emit(a,{[r]:m,canvasX:_,canvasY:w})}function E(){const h=document.querySelector("canvas");return h?(h.addEventListener("dragover",p),h.addEventListener("drop",v),()=>{h.removeEventListener("dragover",p),h.removeEventListener("drop",v)}):()=>{}}function k(){return document.addEventListener("touchmove",f,{passive:!1}),document.addEventListener("touchend",g),document.addEventListener("touchcancel",g),()=>{document.removeEventListener("touchmove",f),document.removeEventListener("touchend",g),document.removeEventListener("touchcancel",g)}}return{onDragStart:l,onDragEnd:d,onTouchStart:u,onTouchMove:f,onTouchEnd:g,setupCanvasListeners:E,setupTouchListeners:k}}var uc=N('<span class="palette-hint svelte-1ahretz">Drag to place</span>'),hc=N('<div draggable="true" role="button" tabindex="0"><img class="item-preview svelte-1ahretz"/> <span class="item-name svelte-1ahretz"> </span></div>'),fc=N('<div class="palette-content svelte-1ahretz" role="toolbar" tabindex="-1"><div class="palette-grid svelte-1ahretz"></div></div>');function gc(t,e){de(e,!0);const n=()=>R(kn,"$isAssetPaletteOpen",s),i=()=>R(Re,"$builderEditMode",s),[s,r]=Te(),a="#4a90e2",o=is;let l=Y(null),d=Y(null);const u=Qr({previewSize:48,borderColor:a,dataKey:"assetKey",eventName:we.ASSET_DROPPED},()=>({draggedKey:c(l),touchDragElement:c(d)}),h=>{"draggedKey"in h&&P(l,h.draggedKey??null,!0),"touchDragElement"in h&&P(d,h.touchDragElement??null,!0)});function f(h){h.stopPropagation()}function g(){kn.set(!1)}function p(h){const m=Xt(fn),y=m.scrollX+m.viewWidth/2,I=m.scrollY+m.viewHeight/2;be.emit(we.ASSET_DROPPED,{assetKey:h,canvasX:y,canvasY:I})}Fn(()=>u.setupCanvasListeners()),Ie(()=>u.setupTouchListeners());var v=Ce(),E=re(v);{var k=h=>{gi(h,{panelId:"asset-palette",title:"Assets",initialRight:10,initialTop:60,width:280,height:400,minWidth:200,minHeight:160,maxWidth:500,maxHeight:600,resizable:!0,showClose:!0,onclose:g,headerExtra:y=>{var I=uc();b(y,I)},children:(y,I)=>{var _=fc();_.__pointerdown=f;var w=O(_);xt(w,21,()=>o,Ot,(A,$)=>{var M=hc();let U;M.__touchstart=D=>u.onTouchStart(D,c($).key),M.__dblclick=()=>p(c($).key),le(M,"",{},{"--accent-color":a});var x=O(M),L=T(x,2),S=O(L);j(()=>{U=Fe(M,1,"palette-item svelte-1ahretz",null,U,{dragging:c(l)===c($).key}),te(M,"title",`${c($).name??""} (double-click to place)`),te(x,"src",c($).path),te(x,"alt",c($).name),fe(S,c($).name)}),Tt("dragstart",M,D=>u.onDragStart(D,c($).key)),Tt("dragend",M,function(...D){u.onDragEnd?.apply(this,D)}),b(A,M)}),b(y,_)},$$slots:{headerExtra:!0,default:!0}})};K(E,h=>{n()&&i()==="items"&&h(k)})}b(t,v),ue(),r()}je(["pointerdown","touchstart","dblclick"]);var pc=N('<span class="palette-hint svelte-jnw59q">Drag to place</span>'),vc=N('<div draggable="true" role="button" tabindex="0"><img class="item-preview item-preview--landscape svelte-jnw59q"/> <span class="item-name svelte-jnw59q"> </span></div>'),mc=N('<div class="palette-content svelte-jnw59q" role="toolbar" tabindex="-1"><div class="palette-grid svelte-jnw59q"></div></div>');function _c(t,e){de(e,!0);const n=()=>R(An,"$isFramePaletteOpen",s),i=()=>R(Re,"$builderEditMode",s),[s,r]=Te(),a="#9b59b6",o=ai;let l=Y(null),d=Y(null);const u=Qr({previewSize:64,borderColor:a,dataKey:"frameKey",eventName:we.FRAME_DROPPED},()=>({draggedKey:c(l),touchDragElement:c(d)}),h=>{"draggedKey"in h&&P(l,h.draggedKey??null,!0),"touchDragElement"in h&&P(d,h.touchDragElement??null,!0)});function f(h){h.stopPropagation()}function g(){An.set(!1)}function p(h){const m=Xt(fn),y=m.scrollX+m.viewWidth/2,I=m.scrollY+m.viewHeight/2;be.emit(we.FRAME_DROPPED,{frameKey:h,canvasX:y,canvasY:I}),ni()}Fn(()=>u.setupCanvasListeners()),Ie(()=>u.setupTouchListeners());var v=Ce(),E=re(v);{var k=h=>{gi(h,{panelId:"frame-palette",title:"Frames",initialRight:10,initialTop:60,width:320,height:400,minWidth:220,minHeight:200,maxWidth:600,maxHeight:600,resizable:!0,showClose:!0,onclose:g,headerExtra:y=>{var I=pc();b(y,I)},children:(y,I)=>{var _=mc();_.__pointerdown=f;var w=O(_);xt(w,21,()=>o,Ot,(A,$)=>{var M=vc();let U;M.__touchstart=D=>u.onTouchStart(D,c($).key),M.__dblclick=()=>p(c($).key),le(M,"",{},{"--accent-color":a});var x=O(M),L=T(x,2),S=O(L);j(()=>{U=Fe(M,1,"palette-item svelte-jnw59q",null,U,{dragging:c(l)===c($).key}),te(M,"title",`${c($).name??""} (double-click to place)`),te(x,"src",c($).path),te(x,"alt",c($).name),fe(S,c($).name)}),Tt("dragstart",M,D=>u.onDragStart(D,c($).key)),Tt("dragend",M,function(...D){u.onDragEnd?.apply(this,D)}),b(A,M)}),b(y,_)},$$slots:{headerExtra:!0,default:!0}})};K(E,h=>{n()&&i()==="frames"&&h(k)})}b(t,v),ue(),r()}je(["pointerdown","touchstart","dblclick"]);var yc=N("<button><!></button>");function oe(t,e){let n=Q(e,"variant",3,"default"),i=Q(e,"disabled",3,!1),s=Q(e,"title",3,"");const r={default:{base:"#4a90e2",hover:"#357abd",active:"#2a5f8f"},green:{base:"#27ae60",hover:"#229954",active:"#1e8449"},blue:{base:"#3498db",hover:"#2980b9",active:"#21618c"},orange:{base:"#ffa500",hover:"#ff8c00",active:"#e67e00"},red:{base:"#e74c3c",hover:"#c0392b",active:"#a02e22"},purple:{base:"#9b59b6",hover:"#8e44ad",active:"#7d3c98"},cyan:{base:"#17a2b8",hover:"#138496",active:"#0f6674"}},a=X(()=>r[n()]),o=X(()=>e.width?`--btn-width: ${e.width};`:"");var l=yc();let d;l.__click=function(...f){e.onclick?.apply(this,f)};var u=O(l);an(u,()=>e.children??Ze),j(()=>{d=Fe(l,1,"pixel-btn svelte-lwc0vq",null,d,{disabled:i()}),le(l,`${c(o)??""} --color-base: ${c(a).base??""}; --color-hover: ${c(a).hover??""}; --color-active: ${c(a).active??""}`),l.disabled=i(),te(l,"title",s())}),b(t,l)}je(["click"]);var bc=N('<div><div class="minimap-bg svelte-1ycb7lo"></div> <div class="viewport-indicator svelte-1ycb7lo"></div> <div class="player-marker svelte-1ycb7lo"></div> <div class="minimap-frame svelte-1ycb7lo"></div></div>');function wc(t,e){de(e,!0);const n=()=>R(fn,"$builderCameraInfo",r),i=()=>R(hn,"$isBuilderZoomedOut",r),s=()=>R(Yt,"$isDraggingInBuilder",r),[r,a]=Te(),o=120,l=60,d=200,u=100;let f=Y(!1),g=Y(null),p=X(()=>c(f)?d:o),v=X(()=>c(f)?u:l),E=X(()=>{const x=n();if(!x||x.worldWidth===0)return"display: none;";const L=c(p)/x.worldWidth,S=c(v)/x.worldHeight,D=x.viewWidth/x.zoom*L,C=x.viewHeight/x.zoom*S,F=x.scrollX*L,Z=x.scrollY*S;return`
      left: ${Math.max(0,F)}px;
      top: ${Math.max(0,Z)}px;
      width: ${Math.min(D,c(p)-F)}px;
      height: ${Math.min(C,c(v)-Z)}px;
    `}),k=X(()=>{const x=n();if(!x||x.worldWidth===0)return"display: none;";const L=c(p)/x.worldWidth,S=c(v)/x.worldHeight,D=x.playerX*L,C=x.playerY*S;return`
      left: ${D}px;
      top: ${C}px;
    `});function h(x,L){const S=n();if(!S||S.worldWidth===0||!c(g))return;const D=c(g).getBoundingClientRect(),C=x-D.left,F=L-D.top,Z=C/c(p)*S.worldWidth,ee=F/c(v)*S.worldHeight;be.emit(we.MINIMAP_NAVIGATE,{worldX:Z,worldY:ee})}function m(x){x.stopPropagation(),x.preventDefault(),P(f,!0),h(x.clientX,x.clientY),window.addEventListener("mousemove",y),window.addEventListener("mouseup",I)}function y(x){c(f)&&(x.preventDefault(),h(x.clientX,x.clientY))}function I(){P(f,!1),window.removeEventListener("mousemove",y),window.removeEventListener("mouseup",I)}function _(x){x.stopPropagation(),x.preventDefault(),P(f,!0);const L=x.touches[0];h(L.clientX,L.clientY),window.addEventListener("touchmove",w,{passive:!1}),window.addEventListener("touchend",A)}function w(x){if(!c(f))return;x.preventDefault();const L=x.touches[0];h(L.clientX,L.clientY)}function A(){P(f,!1),window.removeEventListener("touchmove",w),window.removeEventListener("touchend",A)}var $=Ce(),M=re($);{var U=x=>{var L=bc();let S;L.__mousedown=m,L.__touchstart=_;var D=T(O(L),2),C=T(D,2);on(L,F=>P(g,F),()=>c(g)),j(()=>{S=Fe(L,1,"minimap-container svelte-1ycb7lo",null,S,{enlarged:c(f)}),le(L,`width: ${c(p)??""}px; height: ${c(v)??""}px;${s()?" pointer-events: none;":""}`),le(D,c(E)),le(C,c(k))}),b(x,L)};K(M,x=>{i()||x(U)})}b(t,$),ue(),a()}je(["mousedown","touchstart"]);var Sc=N('<div class="landscape-hint svelte-ugg786"><div class="hint-content svelte-ugg786"><div class="rotate-icon svelte-ugg786">📱↻</div> <p class="hint-text svelte-ugg786">Rotate your phone for a better experience</p> <button class="dismiss-btn svelte-ugg786">OK</button></div></div>');function Ec(t,e){de(e,!0);let n=Y(!0),i=Y(!1);const s="landscapeHintDismissed";Fn(()=>{sessionStorage.getItem(s)||(P(i,/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||"ontouchstart"in window&&window.innerWidth<=768,!0),c(i)&&P(n,!1))});function r(){P(n,!0),sessionStorage.setItem(s,"true")}var a=Ce(),o=re(a);{var l=d=>{var u=Sc(),f=O(u),g=T(O(f),4);g.__click=r,b(d,u)};K(o,d=>{!c(n)&&c(i)&&d(l)})}b(t,a),ue()}je(["click"]);var xc=N("<button> </button>"),Ic=N('<div class="language-tabs svelte-ng6pis"></div>');function ea(t,e){de(e,!0);let n=Q(e,"accentColor",3,"#88ddff");var i=Ic();xt(i,21,()=>Zo,Ot,(s,r)=>{var a=xc();let o;a.__click=()=>e.onselect(c(r).code);let l;var d=O(a);j(()=>{o=Fe(a,1,"lang-tab svelte-ng6pis",null,o,{active:e.selectedLanguage===c(r).code}),l=le(a,"",l,{"--accent-color":n()}),fe(d,c(r).label)}),b(s,a)}),b(t,i),ue()}je(["click"]);var Cc=N("<button></button>"),Tc=N('<div class="color-picker svelte-1jc3e0j"></div>'),Dc=N('<div class="color-section svelte-1jc3e0j"><span class="color-label-title svelte-1jc3e0j"> </span> <button class="color-button svelte-1jc3e0j" title="Change color"><span class="color-preview svelte-1jc3e0j"></span> <span class="color-label svelte-1jc3e0j">Change</span></button> <!></div>');function Oi(t,e){de(e,!0);let n=Q(e,"label",3,"Color"),i=Q(e,"accentColor",3,"#88ddff"),s=Y(!1),r=Y(null);Ie(()=>{c(s)&&c(r)&&requestAnimationFrame(()=>{c(r)?.scrollIntoView({behavior:"smooth",block:"nearest"})})});function a(h){e.onselect(h)}function o(){P(s,!c(s))}var l=Dc(),d=O(l),u=O(d),f=T(d,2);f.__click=o;let g;var p=O(f);let v;var E=T(f,2);{var k=h=>{var m=Tc();xt(m,21,()=>e.colors,Ot,(y,I)=>{var _=Cc();let w;_.__click=()=>a(c(I));let A;j(()=>{w=Fe(_,1,"color-swatch svelte-1jc3e0j",null,w,{selected:e.selectedColor===c(I)}),te(_,"title",c(I)),A=le(_,"",A,{background:c(I),"--accent-color":i()})}),b(y,_)}),on(m,y=>P(r,y),()=>c(r)),b(h,m)};K(E,h=>{c(s)&&h(k)})}j(()=>{fe(u,n()),g=le(f,"",g,{"--accent-color":i()}),v=le(p,"",v,{background:e.selectedColor})}),b(t,l),ue()}je(["click"]);const Hs=50,Ns=400,kc=400,Ac=70;var Mc=N('<div class="form-section svelte-jhtkop"><div class="form-group svelte-jhtkop"><label class="svelte-jhtkop"> </label> <input type="text" class="svelte-jhtkop"/></div> <div class="form-group svelte-jhtkop"><label class="svelte-jhtkop"> </label> <textarea rows="6" class="svelte-jhtkop"></textarea></div></div>');function Pc(t,e){de(e,!0);let n=Q(e,"titlePlaceholder",3,"Enter title..."),i=Q(e,"contentPlaceholder",3,"Enter text..."),s=Q(e,"idPrefix",3,"text-form"),r=Q(e,"accentColor",3,"#88ddff");function a(m){const y=m.target;e.ontitlechange(y.value)}function o(m){const y=m.target;e.oncontentchange(y.value)}var l=Mc();let d;var u=O(l),f=O(u),g=O(f),p=T(f,2);p.__input=a;var v=T(u,2),E=O(v),k=O(E),h=T(E,2);h.__input=o,j(()=>{d=le(l,"",d,{"--accent-color":r()}),te(f,"for",`${s()??""}-title`),fe(g,`Title (max ${Hs} chars)`),te(p,"id",`${s()??""}-title`),ei(p,e.title),te(p,"placeholder",n()),te(p,"maxlength",Hs),te(E,"for",`${s()??""}-content`),fe(k,`Content (max ${Ns} chars)`),te(h,"id",`${s()??""}-content`),ei(h,e.content),te(h,"placeholder",i()),te(h,"maxlength",Ns)}),b(t,l),ue()}je(["input"]);var $c=N('<div class="panel-content svelte-zzlycq"><!> <!> <div class="panel-extras svelte-zzlycq"><!></div> <div class="panel-footer svelte-zzlycq"><!> <!></div></div>');function Oc(t,e){de(e,!0);const n=()=>R(qi,"$dialogZones",s),i=()=>R(Xr,"$selectedDialogZoneId",s),[s,r]=Te(),a="#88ddff";let o=Y(Ke(Fr)),l=X(()=>n().find(y=>y.id===i())??null),d=X(()=>c(l)?.texts.find(y=>y.language===c(o))??null);function u(y){i()&&xs(i(),c(o),{title:y})}function f(y){i()&&xs(i(),c(o),{content:y})}function g(){i()&&ul(i())}function p(){yn(null)}function v(y){i()&&_n(i(),{color:y})}function E(y){P(o,y,!0)}var k=Ce(),h=re(k);{var m=y=>{gi(y,{panelId:"dialog-zone-panel",title:"Dialog Zone",initialRight:10,initialTop:160,width:280,height:450,minWidth:250,minHeight:370,maxWidth:500,maxHeight:700,resizable:!0,showClose:!0,onclose:p,children:(I,_)=>{var w=$c(),A=O(w);ea(A,{get selectedLanguage(){return c(o)},onselect:E,accentColor:a});var $=T(A,2);{let D=X(()=>c(d)?.title??""),C=X(()=>c(d)?.content??"");Pc($,{get title(){return c(D)},get content(){return c(C)},ontitlechange:u,oncontentchange:f,titlePlaceholder:"Enter title...",contentPlaceholder:"Enter dialog text...",idPrefix:"dialog",accentColor:a})}var M=T($,2),U=O(M);Oi(U,{get colors(){return Mi},get selectedColor(){return c(l).color},onselect:v,label:"Zone Color",accentColor:a});var x=T(M,2),L=O(x);oe(L,{variant:"cyan",onclick:p,children:(D,C)=>{var F=ae("CONFIRM");b(D,F)},$$slots:{default:!0}});var S=T(L,2);oe(S,{variant:"red",onclick:g,children:(D,C)=>{var F=ae("DELETE");b(D,F)},$$slots:{default:!0}}),b(I,w)},$$slots:{default:!0}})};K(h,y=>{c(l)&&y(m)})}b(t,k),ue(),r()}var Lc=N("<button> </button>"),Rc=N("<option> </option>"),Fc=N('<a target="_blank" rel="noopener noreferrer" class="url-preview svelte-ds1z4d">Test link ↗</a>'),Hc=N('<button><img class="svelte-ds1z4d"/></button>'),Nc=N('<div class="style-picker svelte-ds1z4d"></div>'),Bc=N('<div class="panel-content svelte-ds1z4d"><!> <div class="frame-size-row svelte-ds1z4d"><div class="frame-size-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Frame Size</span> <div class="size-buttons svelte-ds1z4d"></div></div> <div class="rotate-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Rotate</span> <button class="rotate-btn svelte-ds1z4d"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-ds1z4d"><path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg></button></div></div> <div class="panel-extras svelte-ds1z4d"><div class="text-section svelte-ds1z4d"><label for="frame-text" class="svelte-ds1z4d">Text</label> <textarea id="frame-text" placeholder="Enter text..." rows="3" class="svelte-ds1z4d"></textarea></div> <div class="size-rotation-row svelte-ds1z4d"><div class="size-section svelte-ds1z4d"><label for="text-size" class="svelte-ds1z4d">Text Size</label> <select id="text-size" class="svelte-ds1z4d"></select></div></div> <div class="url-section svelte-ds1z4d"><label for="frame-url" class="svelte-ds1z4d">Link URL (opens on click)</label> <input id="frame-url" type="url" placeholder="https://example.com" class="svelte-ds1z4d"/> <!></div> <!> <!> <div class="style-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Frame Style</span> <button class="style-button svelte-ds1z4d" title="Change frame style"><img alt="Current frame" class="style-preview svelte-ds1z4d"/> <span class="style-label svelte-ds1z4d">Change Style</span></button> <!></div></div> <div class="panel-footer svelte-ds1z4d"><!> <!></div></div>');function Xc(t,e){de(e,!0);const n=()=>R(Vi,"$builderPreviewLanguage",a),i=()=>R(Qo,"$selectedFrame",a),s=()=>R(Ji,"$selectedFrameId",a),r=()=>R(ji,"$isFramePanelOpen",a),[a,o]=Te(),l="#9b59b6";let d=X(n),u=X(i),f=X(()=>c(u)?.texts.find(C=>C.language===c(d))??null),g=X(()=>c(u)?Rl(c(u).scale??4):"M");function p(C){const F=C.target;if(!s()||!c(u))return;const Z=c(u).texts.map(ee=>ee.language===c(d)?{...ee,text:F.value}:ee);Z.some(ee=>ee.language===c(d))||Z.push({language:c(d),text:F.value}),ot(s(),{texts:Z})}function v(C){const F=C.target;s()&&ot(s(),{url:F.value||void 0})}function E(C){s()&&ot(s(),{backgroundColor:C})}function k(C){s()&&ot(s(),{textColor:C})}function h(C){const F=C.target;s()&&ot(s(),{textSize:parseInt(F.value,10)})}function m(C){s()&&ot(s(),{scale:Ll(C)})}function y(){if(!s()||!c(u))return;const F=(c(u).rotation??0)===0?90:0;ot(s(),{rotation:F})}function I(){s()&&ns(s())}function _(){jo(),en(null)}function w(C){Vo(C)}let A=Y(!1),$=Y(null),M=Y(null);function U(C){s()&&ot(s(),{frameKey:C})}function x(){P(A,!c(A))}Ie(()=>{c(A)&&c($)&&requestAnimationFrame(()=>{c($)?.scrollIntoView({behavior:"smooth",block:"nearest"})})}),Ie(()=>{if(!c(A))return;function C(F){const Z=F.target;c($)&&!c($).contains(Z)&&c(M)&&!c(M).contains(Z)&&P(A,!1)}return document.addEventListener("click",C),()=>document.removeEventListener("click",C)});var L=Ce(),S=re(L);{var D=C=>{gi(C,{panelId:"frame-panel",title:"Edit Frame",initialRight:10,initialTop:160,width:280,height:520,minWidth:250,minHeight:450,maxWidth:500,maxHeight:700,resizable:!0,showClose:!0,onclose:_,children:(F,Z)=>{var ee=Bc(),ge=O(ee);ea(ge,{get selectedLanguage(){return c(d)},onselect:w,accentColor:l});var q=T(ge,2),Ve=O(q),Se=T(O(Ve),2);xt(Se,21,()=>Object.entries(Ur),Ot,(J,he)=>{var Ee=X(()=>ha(c(he),2));let Ge=()=>c(Ee)[0],qe=()=>c(Ee)[1].label;var _t=Lc();let pn;_t.__click=()=>m(Ge());var sa=O(_t);j(()=>{pn=Fe(_t,1,"size-btn svelte-ds1z4d",null,pn,{active:c(g)===Ge()}),te(_t,"title",qe()),fe(sa,Ge())}),b(J,_t)});var Zt=T(Ve,2),Wt=T(O(Zt),2);Wt.__click=y;var We=T(q,2),pt=O(We),zt=T(O(pt),2);zt.__input=p;var ze=T(pt,2),pi=O(ze),vt=T(O(pi),2);vt.__change=h,xt(vt,21,()=>Ol,Ot,(J,he)=>{var Ee=Rc(),Ge=O(Ee),qe={};j(()=>{fe(Ge,`${c(he)??""}px`),qe!==(qe=c(he))&&(Ee.value=(Ee.__value=c(he))??"")}),b(J,Ee)});var Hn;bo(vt);var Nn=T(ze,2),gn=T(O(Nn),2);gn.__input=v;var H=T(gn,2);{var W=J=>{var he=Fc();j(()=>te(he,"href",c(u).url)),b(J,he)};K(H,J=>{c(u).url&&J(W)})}var ce=T(Nn,2);{let J=X(()=>c(u).textColor??jr);Oi(ce,{get colors(){return $l},get selectedColor(){return c(J)},onselect:k,label:"Text Color",accentColor:l})}var Pe=T(ce,2);Oi(Pe,{get colors(){return Pl},get selectedColor(){return c(u).backgroundColor},onselect:E,label:"Background Color",accentColor:l});var pe=T(Pe,2),He=T(O(pe),2);He.__click=x;var mt=O(He);on(He,J=>P(M,J),()=>c(M));var kt=T(He,2);{var Gt=J=>{var he=Nc();xt(he,21,()=>ai,Ot,(Ee,Ge)=>{var qe=Hc();let _t;qe.__click=()=>U(c(Ge).key);var pn=O(qe);j(()=>{_t=Fe(qe,1,"style-item svelte-ds1z4d",null,_t,{selected:c(u).frameKey===c(Ge).key}),te(qe,"title",c(Ge).name),te(pn,"src",c(Ge).path),te(pn,"alt",c(Ge).name)}),b(Ee,qe)}),on(he,Ee=>P($,Ee),()=>c($)),b(J,he)};K(kt,J=>{c(A)&&J(Gt)})}var rt=T(We,2),Kt=O(rt);oe(Kt,{variant:"purple",onclick:_,children:(J,he)=>{var Ee=ae("CONFIRM");b(J,Ee)},$$slots:{default:!0}});var Ut=T(Kt,2);oe(Ut,{variant:"red",onclick:I,children:(J,he)=>{var Ee=ae("DELETE");b(J,Ee)},$$slots:{default:!0}}),j(J=>{te(Wt,"title",c(u).rotation===90?"Portrait (click to rotate)":"Landscape (click to rotate)"),ei(zt,c(f)?.text??""),Hn!==(Hn=c(u).textSize??zn)&&(vt.value=(vt.__value=c(u).textSize??zn)??"",Ir(vt,c(u).textSize??zn)),ei(gn,c(u).url??""),te(mt,"src",J)},[()=>ai.find(J=>J.key===c(u).frameKey)?.path??""]),b(F,ee)},$$slots:{default:!0}})};K(S,C=>{r()&&c(u)&&C(D)})}b(t,L),ue(),o()}je(["click","input","change"]);var Yc=N('<div class="frame-text svelte-1vp2oo0"> </div>'),Zc=N('<div class="frame-content-layer svelte-1vp2oo0"></div>');function ta(t,e){de(e,!0);const n=()=>R(Yr,"$placedFrames",d),i=()=>R(Hr,"$isBuilderMode",d),s=()=>R(fn,"$builderCameraInfo",d),r=()=>R(Pr,"$gameCameraInfo",d),a=()=>R(Vi,"$builderPreviewLanguage",d),o=()=>R(Dn,"$currentLanguage",d),l=()=>R(Qi,"$draggingFramePositions",d),[d,u]=Te();let f=X(n),g=X(()=>i()?s().scrollX:r().scrollX),p=X(()=>i()?s().scrollY:r().scrollY),v=X(()=>i()?s().zoom:r().zoom),E=X(()=>i()?a():o()),k=X(l);function h(_){const w=c(k).get(_.id);return w||{x:_.x,y:_.y}}function m(_){const w=_.scale??dt,A=_.rotation===90,{textWidth:$,textHeight:M}=En(w,A),U=h(_),x=(U.x-c(g))*c(v),L=(U.y-c(p))*c(v);return{x,y:L,width:$*c(v),height:M*c(v)}}function y(_){return(_.texts.find(A=>A.language===c(E))||_.texts[0]||{text:""}).text||""}var I=Zc();xt(I,21,()=>c(f),_=>_.id,(_,w)=>{const A=X(()=>m(c(w))),$=X(()=>y(c(w))),M=X(()=>(c(w).textSize??zn)*c(v)),U=X(()=>c(w).textColor??jr);var x=Ce(),L=re(x);{var S=D=>{var C=Yc(),F=O(C);j(()=>{le(C,`
          left: ${c(A).x??""}px;
          top: ${c(A).y??""}px;
          width: ${c(A).width??""}px;
          height: ${c(A).height??""}px;
          font-size: ${c(M)??""}px;
          color: ${c(U)??""};
        `),fe(F,c($))}),b(D,C)};K(L,D=>{c($)&&D(S)})}b(_,x)}),b(t,I),ue(),u()}var Wc=N('<div class="temp-zone-button svelte-130i47e"><!></div>');function zc(t,e){de(e,!0);const n=()=>R(fn,"$builderCameraInfo",r),i=()=>R(Re,"$builderEditMode",r),s=()=>R(Yt,"$isDraggingInBuilder",r),[r,a]=Te();let o=Y(null),l=null,d=null,u=Y(null);function f(h){l&&clearTimeout(l),P(o,h,!0),P(u,n()?.scrollX??null,!0),l=setTimeout(()=>{P(o,null),P(u,null)},2e3)}function g(){c(o)&&(be.emit(we.DIALOG_ZONE_CREATE_AT,{worldX:c(o).worldX}),P(o,null),P(u,null),l&&(clearTimeout(l),l=null))}function p(){P(o,null),P(u,null),l&&(clearTimeout(l),l=null)}Fn(()=>{d=be.on(we.TEMP_ZONE_BUTTON_SHOW,f);const h=be.on(we.TEMP_ZONE_BUTTON_HIDE,p);return()=>{d?.unsubscribe(),h.unsubscribe()}}),xo(()=>{l&&clearTimeout(l)}),Ie(()=>{i()!=="dialogs"&&(P(o,null),P(u,null))}),Ie(()=>{const h=n()?.scrollX;c(o)&&c(u)!==null&&h!==void 0&&Math.abs(h-c(u))>10&&(P(o,null),P(u,null),l&&(clearTimeout(l),l=null))});var v=Ce(),E=re(v);{var k=h=>{var m=Wc(),y=O(m);oe(y,{variant:"cyan",width:"90px",onclick:g,children:(I,_)=>{var w=ae("+ ZONE");b(I,w)},$$slots:{default:!0}}),j(()=>le(m,`left: ${c(o).screenX??""}px; top: ${c(o).screenY-50}px;${s()?" pointer-events: none;":""}`)),b(h,m)};K(E,h=>{c(o)&&i()==="dialogs"&&h(k)})}b(t,v),ue(),a()}var Gc=N('<div class="dialog-hint svelte-1titkrs"><div class="hint-content svelte-1titkrs"><span class="hint-icon svelte-1titkrs">💡</span> <span class="hint-text svelte-1titkrs">Tip: Use <strong class="svelte-1titkrs">FIT</strong> view for dialog zones</span> <button class="hint-action svelte-1titkrs">FIT NOW</button> <button class="hint-close svelte-1titkrs">✕</button></div></div>');function Kc(t,e){de(e,!0);const n=()=>R(Re,"$builderEditMode",s),i=()=>R(hn,"$isBuilderZoomedOut",s),[s,r]=Te();let a=Y(!1),o=Y(!1),l=null;Ie(()=>{n()==="dialogs"&&!c(a)&&!i()&&(P(a,!0),P(o,!0),l=setTimeout(()=>{P(o,!1)},5e3))}),Ie(()=>{i()&&c(o)&&(P(o,!1),l&&(clearTimeout(l),l=null))});function d(){P(o,!1),l&&(clearTimeout(l),l=null)}function u(){Jr(),d()}var f=Ce(),g=re(f);{var p=v=>{var E=Gc(),k=O(E),h=T(O(k),4);h.__click=u;var m=T(h,2);m.__click=d,b(v,E)};K(g,v=>{c(o)&&v(p)})}b(t,f),ue(),r()}je(["click"]);var Uc=N('<div class="item-controls svelte-1is3rex"><div class="controls-row svelte-1is3rex"><!> <!> <!> <!></div></div>');function jc(t,e){de(e,!0);const n=()=>R(es,"$selectedItem",u),i=()=>R(Zr,"$selectedItemScreenPosition",u),s=()=>R(Nr,"$selectedItemId",u),r=()=>R(Br,"$itemDepthLayer",u),a=()=>R(el,"$selectedItemPhysicsEnabled",u),o=()=>R(tl,"$selectedItemFlipX",u),l=()=>R(Re,"$builderEditMode",u),d=()=>R(Yt,"$isDraggingInBuilder",u),[u,f]=Te();let g=X(()=>n()?gl(n().assetKey):!1),p=X(()=>{const _=i();if(!_)return null;const w=10,A=40,$=c(g)?380:290;let M=_.screenY-_.itemHeight/2-45;const U=w+A;M<U&&(M=_.screenY+_.itemHeight/2+10);const x=window.innerHeight-A-w;M>x&&(M=x);let L=_.screenX;const S=$/2,D=S+w,C=window.innerWidth-S-w;return L<D&&(L=D),L>C&&(L=C),{x:L,y:M}});function v(){if(!s())return;const _=r()==="behind"?"front":"behind",w=Ui(_);il(),sl(s(),w)}function E(){s()&&rl(s(),!a())}function k(){s()&&al(s(),!o())}function h(){s()&&(zr(s()),ts())}var m=Ce(),y=re(m);{var I=_=>{var w=Uc(),A=O(w),$=O(A);{let S=X(()=>r()==="behind"?"blue":"orange"),D=X(()=>a()?"Solid items must be behind player":"Toggle item depth: behind or in front of player");oe($,{get variant(){return c(S)},get title(){return c(D)},onclick:v,get disabled(){return a()},children:(C,F)=>{var Z=ae();j(()=>fe(Z,r()==="behind"?"Front":"Back")),b(C,Z)},$$slots:{default:!0}})}var M=T($,2);{let S=X(()=>o()?"orange":"blue");oe(M,{get variant(){return c(S)},title:"Flip item horizontally",onclick:k,children:(D,C)=>{var F=ae("Flip");b(D,F)},$$slots:{default:!0}})}var U=T(M,2);{var x=S=>{{let D=X(()=>a()?"orange":"blue");oe(S,{get variant(){return c(D)},title:"Toggle physics: item will block player movement",onclick:E,children:(C,F)=>{var Z=ae();j(()=>fe(Z,a()?"Ghost":"Solid")),b(C,Z)},$$slots:{default:!0}})}};K(U,S=>{c(g)&&S(x)})}var L=T(U,2);oe(L,{variant:"red",title:"Delete selected item",onclick:h,children:(S,D)=>{var C=ae("DEL");b(S,C)},$$slots:{default:!0}}),j(()=>le(w,`left: ${c(p).x??""}px; top: ${c(p).y??""}px;${d()?" pointer-events: none;":""}`)),b(_,w)};K(y,_=>{l()==="items"&&s()&&c(p)&&_(I)})}b(t,m),ue(),f()}var Vc=N('<div class="frame-controls svelte-eqt3a9"><div class="controls-row svelte-eqt3a9"><!> <!></div></div>');function qc(t,e){de(e,!0);const n=()=>R(Wr,"$selectedFrameScreenPosition",a),i=()=>R(Ji,"$selectedFrameId",a),s=()=>R(Re,"$builderEditMode",a),r=()=>R(Yt,"$isDraggingInBuilder",a),[a,o]=Te();let l=X(()=>{const v=n();if(!v)return null;const E=10,k=40,h=190;let m=v.screenY-v.frameHeight/2-45;const y=E+k;m<y&&(m=v.screenY+v.frameHeight/2+10);const I=window.innerHeight-k-E;m>I&&(m=I);let _=v.screenX;const w=h/2,A=w+E,$=window.innerWidth-w-E;return _<A&&(_=A),_>$&&(_=$),{x:_,y:m}});function d(){ni()}function u(){i()&&(ns(i()),en(null))}var f=Ce(),g=re(f);{var p=v=>{var E=Vc(),k=O(E),h=O(k);oe(h,{variant:"purple",title:"Edit frame content (or double-click)",onclick:d,children:(y,I)=>{var _=ae("EDIT");b(y,_)},$$slots:{default:!0}});var m=T(h,2);oe(m,{variant:"red",title:"Delete selected frame",onclick:u,children:(y,I)=>{var _=ae("DEL");b(y,_)},$$slots:{default:!0}}),j(()=>le(E,`left: ${c(l).x??""}px; top: ${c(l).y??""}px;${r()?" pointer-events: none;":""}`)),b(v,E)};K(g,v=>{(s()==="frames"||s()==="items")&&i()&&c(l)&&v(p)})}b(t,f),ue(),o()}var Jc=N('<div class="hstack svelte-8vtf35"><!></div>');function Qc(t,e){let n=Q(e,"gap",3,"10px"),i=Q(e,"align",3,"center");var s=Jc(),r=O(s);an(r,()=>e.children??Ze),j(()=>le(s,`gap: ${n()??""}; align-items: ${(i()==="start"?"flex-start":i()==="end"?"flex-end":i())??""};`)),b(t,s)}var ed=N('<div class="vstack svelte-1y4dqnf"><!></div>');function td(t,e){let n=Q(e,"gap",3,"10px"),i=Q(e,"align",3,"stretch");var s=ed(),r=O(s);an(r,()=>e.children??Ze),j(()=>le(s,`gap: ${n()??""}; align-items: ${(i()==="start"?"flex-start":i()==="end"?"flex-end":i())??""};`)),b(t,s)}var nd=N("<div><!></div>");function Bs(t,e){const n=()=>R(Yt,"$isDraggingInBuilder",i),[i,s]=Te();let r=Q(e,"padding",3,"10px");var a=nd();let o;var l=O(a);an(l,()=>e.children??Ze),j(()=>{o=Fe(a,1,`fixed fixed--${e.position??""}`,"svelte-vwlo0e",o,{"dragging-in-builder":n()}),le(a,`--padding: ${r()??""};`)}),b(t,a),s()}var id=N('<div class="left-buttons svelte-1vm8op7"><!> <!> <!></div>'),sd=N("<!> <!>",1),rd=N("<!> <!> <!>",1),ad=N("<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!>",1);function od(t,e){de(e,!1);const n=()=>R(Re,"$builderEditMode",o),i=()=>R(hn,"$isBuilderZoomedOut",o),s=()=>R(fi,"$gridSnappingEnabled",o),r=()=>R(kn,"$isAssetPaletteOpen",o),a=()=>R(An,"$isFramePaletteOpen",o),[o,l]=Te();function d(){ac()}function u(){Jr()}function f(){Go()}function g(){be.emit(we.DIALOG_ZONE_CREATE)}Tr();var p=ad(),v=re(p);jc(v,{});var E=T(v,2);qc(E,{});var k=T(E,2);{var h=x=>{gc(x,{})},m=x=>{var L=Ce(),S=re(L);{var D=F=>{Oc(F,{})},C=F=>{var Z=Ce(),ee=re(Z);{var ge=q=>{_c(q,{})};K(ee,q=>{n()==="frames"&&q(ge)},!0)}b(F,Z)};K(S,F=>{n()==="dialogs"?F(D):F(C,!1)},!0)}b(x,L)};K(k,x=>{n()==="items"?x(h):x(m,!1)})}var y=T(k,2);Xc(y,{});var I=T(y,2);ta(I,{});var _=T(I,2);wc(_,{});var w=T(_,2);Ec(w,{});var A=T(w,2);zc(A,{});var $=T(A,2);Kc($,{});var M=T($,2);Bs(M,{position:"top-left",children:(x,L)=>{var S=id(),D=O(S);oe(D,{variant:"green",width:"100px",onclick:d,children:(Z,ee)=>{var ge=ae("SAVE");b(Z,ge)},$$slots:{default:!0}});var C=T(D,2);{let Z=$t(()=>i()?"orange":"blue");oe(C,{get variant(){return c(Z)},width:"80px",onclick:u,title:"Toggle zoom (F)",children:(ee,ge)=>{var q=ae();j(()=>fe(q,i()?"1:1":"FIT")),b(ee,q)},$$slots:{default:!0}})}var F=T(C,2);{let Z=$t(()=>s()?"blue":"orange");oe(F,{get variant(){return c(Z)},width:"80px",onclick:f,title:"Toggle grid snapping",children:(ee,ge)=>{var q=ae();j(()=>fe(q,s()?"FREE":"SNAP")),b(ee,q)},$$slots:{default:!0}})}b(x,S)},$$slots:{default:!0}});var U=T(M,2);Bs(U,{position:"top-right",children:(x,L)=>{td(x,{align:"end",children:(S,D)=>{var C=rd(),F=re(C);{let ge=$t(()=>n()==="items"&&r()?"orange":"blue");oe(F,{get variant(){return c(ge)},onclick:()=>{n()==="items"?Ko():(Xn("items"),kn.set(!0))},title:"Edit assets/items",children:(q,Ve)=>{var Se=ae("ASSETS");b(q,Se)},$$slots:{default:!0}})}var Z=T(F,2);{let ge=$t(()=>n()==="frames"&&a()?"orange":"purple");oe(Z,{get variant(){return c(ge)},onclick:()=>{n()==="frames"?Uo():(Xn("frames"),An.set(!0))},title:"Edit text frames",children:(q,Ve)=>{var Se=ae("FRAMES");b(q,Se)},$$slots:{default:!0}})}var ee=T(Z,2);Qc(ee,{children:(ge,q)=>{var Ve=sd(),Se=re(Ve);{var Zt=We=>{oe(We,{variant:"cyan",width:"100px",onclick:g,title:"Create new dialog zone at center of view",children:(pt,zt)=>{var ze=ae("+ ZONE");b(pt,ze)},$$slots:{default:!0}})};K(Se,We=>{n()==="dialogs"&&We(Zt)})}var Wt=T(Se,2);{let We=$t(()=>n()==="dialogs"?"orange":"cyan");oe(Wt,{get variant(){return c(We)},onclick:()=>{n()==="dialogs"?Xn("items"):Xn("dialogs")},title:"Edit dialog zones",children:(pt,zt)=>{var ze=ae("DIALOGS");b(pt,ze)},$$slots:{default:!0}})}b(ge,Ve)},$$slots:{default:!0}}),b(S,C)},$$slots:{default:!0}})},$$slots:{default:!0}}),b(t,p),ue(),l()}var ld=N("<div> </div>"),cd=N('<div class="dialog-content svelte-1jd14ss"> </div>'),dd=N("<div><!> <!></div>");function ud(t,e){de(e,!0);const n=()=>R(Po,"$activeDialogText",s),i=()=>R(Mr,"$playerScreenPosition",s),[s,r]=Te();let a=X(()=>n()?.title&&n()?.content),o=X(()=>Math.max(10,window.innerHeight-i().y+Ac)),l=X(()=>window.innerWidth<=kc),d=X(()=>c(l)?50:i().x),u=X(()=>c(l)?"percent":"px");var f=Ce(),g=re(f);{var p=v=>{var E=dd();let k;var h=O(E);{var m=_=>{var w=ld();let A;var $=O(w);j(()=>{A=Fe(w,1,"dialog-title svelte-1jd14ss",null,A,{"has-divider":c(a)}),fe($,n().title)}),b(_,w)};K(h,_=>{n().title&&_(m)})}var y=T(h,2);{var I=_=>{var w=cd(),A=O(w);j(()=>fe(A,n().content)),b(_,w)};K(y,_=>{n().content&&_(I)})}j(()=>{k=Fe(E,1,"dialog-bubble svelte-1jd14ss",null,k,{narrow:c(l)}),le(E,`bottom: ${c(o)??""}px; left: ${c(d)??""}${c(u)??""};`)}),b(v,E)};K(g,v=>{n()&&v(p)})}b(t,f),ue(),r()}var hd=N("<!> <!>",1),fd=N('<div class="touch-controls"><p class="touch-text">Tap and hold<br/>where you want<br/>to move</p></div>'),gd=N('<div class="desktop-controls"><div class="key-row"><div class="pixel-key">A</div> <div class="pixel-key">W</div> <div class="pixel-key">D</div></div> <p class="or-text">or</p> <div class="key-row"><div class="pixel-key">←</div> <div class="pixel-key">↑</div> <div class="pixel-key">→</div></div></div>'),pd=N('<div class="loader-overlay"><div class="pixel-loader"></div></div>'),vd=N('<div class="game-ui-wrapper svelte-13dvmla"><!> <!> <!> <dialog class="pixel-dialog"><h1>CONTROLS</h1> <div class="controls-content"><!></div></dialog> <!></div>');function md(t,e){de(e,!1);const n=()=>R(mn,"$showControlsDialog",l),i=()=>R(kr,"$hasPlayerMoved",l),s=()=>R(Hr,"$isBuilderMode",l),r=()=>R(Dn,"$currentLanguage",l),a=()=>R(Dr,"$isTouchDevice",l),o=()=>R(Pi,"$isLoading",l),[l,d]=Te();let u=Zi();function f(){const S=qr.toggleLanguage();Dn.set(S)}function g(S){!c(u)?.open||S.target.closest(".pixel-button")||mn.set(!1)}function p(){const S=sc();if(!S){console.error("Cannot enter builder mode: map config not found");return}rc(S)}us(()=>(c(u),n()),()=>{c(u)&&(n()?c(u).showModal():c(u).close())}),us(()=>(i(),c(u),mn),()=>{i()&&c(u)?.open&&mn.set(!1)}),ao(),Tr();var v=vd();Tt("pointerdown",Vs,g);var E=O(v);{var k=S=>{od(S,{})},h=S=>{var D=hd(),C=re(D);ud(C,{});var F=T(C,2);ta(F,{}),b(S,D)};K(E,S=>{s()?S(k):S(h,!1)})}var m=T(E,2);{var y=S=>{oe(S,{position:"top-left",variant:"green",width:"120px",onclick:p,title:"Toggle Builder Mode",children:(D,C)=>{var F=ae("BUILD");b(D,F)},$$slots:{default:!0}})};K(m,S=>{s()||S(y)})}var I=T(m,2);{var _=S=>{oe(S,{position:"top-right",variant:"default",width:"100px",onclick:f,title:"Toggle Language (L)",children:(D,C)=>{var F=ae();j(Z=>fe(F,Z),[()=>(r(),Dt(()=>r().toUpperCase()))]),b(D,F)},$$slots:{default:!0}})};K(I,S=>{s()||S(_)})}var w=T(I,2),A=T(O(w),2),$=O(A);{var M=S=>{var D=fd();b(S,D)},U=S=>{var D=gd();b(S,D)};K($,S=>{a()?S(M):S(U,!1)})}on(w,S=>P(u,S),()=>c(u));var x=T(w,2);{var L=S=>{var D=pd();b(S,D)};K(x,S=>{o()&&S(L)})}b(t,v),ue(),d()}const na=document.getElementById("game-ui");if(!na)throw new Error("game-ui element not found!");po(md,{target:na});Dn.set(qr.getLanguage());Ao.set($r.getSkin());Mo.set(ti.getCurrentConfig().name);const _d={type:B.AUTO,width:800,height:600,parent:"game-container",backgroundColor:"#000000",pixelArt:!0,roundPixels:!0,scale:{mode:B.Scale.RESIZE,autoCenter:B.Scale.CENTER_BOTH},physics:{default:"arcade",arcade:{gravity:{y:1e3,x:0},debug:!1}},audio:{noAudio:!0},scene:[Zl,ec]},ia=new B.Game(_d);ic(ia);const yd=ia.device.input.touch;Dr.set(yd);const bd=performance.getEntriesByType("navigation")[0]&&performance.getEntriesByType("navigation")[0].type==="reload",wd=sessionStorage.getItem("hasSeenControlsHint");(!wd||bd)&&(sessionStorage.setItem("hasSeenControlsHint","true"),mn.set(!0));
//# sourceMappingURL=index-Dxrffzlx.js.map
