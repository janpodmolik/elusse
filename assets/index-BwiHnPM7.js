import{r as Nn,g as Bn}from"./phaser-DFK5Ua9d.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=r(s);fetch(s.href,i)}})();var Hn=Nn();const D=Bn(Hn),Rt=!1;var xr=Array.isArray,$n=Array.prototype.indexOf,Vt=Array.from,Lr=Object.defineProperty,tt=Object.getOwnPropertyDescriptor,Or=Object.getOwnPropertyDescriptors,Yn=Object.prototype,Gn=Array.prototype,zt=Object.getPrototypeOf,fr=Object.isExtensible;const fe=()=>{};function Kn(t){return t()}function gt(t){for(var e=0;e<t.length;e++)t[e]()}function Mr(){var t,e,r=new Promise((n,s)=>{t=n,e=s});return{promise:r,resolve:t,reject:e}}const O=2,qt=4,At=8,Fn=1<<24,pe=16,ge=32,Pe=64,Dt=128,Z=512,x=1024,K=2048,ie=4096,W=8192,ye=16384,Jt=32768,xe=65536,hr=1<<17,Pr=1<<18,je=1<<19,Rr=1<<20,Le=32768,Nt=1<<21,Zt=1<<22,we=1<<23,Ye=Symbol("$state"),Un=Symbol(""),He=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Nr(t){return t===this.v}function Br(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function Hr(t){return!Br(t,this.v)}function Wn(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Xn(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function jn(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Vn(t){throw new Error("https://svelte.dev/e/effect_orphan")}function zn(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function qn(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Jn(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Zn(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function Qn(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}let Ct=!1,es=!1;function ts(){Ct=!0}const rs=1,ns=2,ss=16,is=1,as=2,M=Symbol(),os="http://www.w3.org/1999/xhtml";let k=null;function Ue(t){k=t}function Tt(t,e=!1,r){k={p:k,i:!1,c:null,e:null,s:t,x:null,l:Ct&&!e?{s:null,u:null,$:[]}:null}}function kt(t){var e=k,r=e.e;if(r!==null){e.e=null;for(var n of r)sn(n)}return e.i=!0,k=e.p,{}}function lt(){return!Ct||k!==null&&k.l===null}let $e=[];function ls(){var t=$e;$e=[],gt(t)}function ct(t){if($e.length===0){var e=$e;queueMicrotask(()=>{e===$e&&ls()})}$e.push(t)}function cs(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function Ze(t){if(typeof t!="object"||t===null||Ye in t)return t;const e=zt(t);if(e!==Yn&&e!==Gn)return t;var r=new Map,n=xr(t),s=q(0),i=ke,a=o=>{if(ke===i)return o();var l=b,c=ke;Y(null),vr(i);var u=o();return Y(l),vr(c),u};return n&&r.set("length",q(t.length)),new Proxy(t,{defineProperty(o,l,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&qn();var u=r.get(l);return u===void 0?u=a(()=>{var f=q(c.value);return r.set(l,f),f}):P(u,c.value,!0),!0},deleteProperty(o,l){var c=r.get(l);if(c===void 0){if(l in o){const u=a(()=>q(M));r.set(l,u),rt(s)}}else P(c,M),rt(s);return!0},get(o,l,c){if(l===Ye)return t;var u=r.get(l),f=l in o;if(u===void 0&&(!f||tt(o,l)?.writable)&&(u=a(()=>{var p=Ze(f?o[l]:M),d=q(p);return d}),r.set(l,u)),u!==void 0){var h=m(u);return h===M?void 0:h}return Reflect.get(o,l,c)},getOwnPropertyDescriptor(o,l){var c=Reflect.getOwnPropertyDescriptor(o,l);if(c&&"value"in c){var u=r.get(l);u&&(c.value=m(u))}else if(c===void 0){var f=r.get(l),h=f?.v;if(f!==void 0&&h!==M)return{enumerable:!0,configurable:!0,value:h,writable:!0}}return c},has(o,l){if(l===Ye)return!0;var c=r.get(l),u=c!==void 0&&c.v!==M||Reflect.has(o,l);if(c!==void 0||I!==null&&(!u||tt(o,l)?.writable)){c===void 0&&(c=a(()=>{var h=u?Ze(o[l]):M,p=q(h);return p}),r.set(l,c));var f=m(c);if(f===M)return!1}return u},set(o,l,c,u){var f=r.get(l),h=l in o;if(n&&l==="length")for(var p=c;p<f.v;p+=1){var d=r.get(p+"");d!==void 0?P(d,M):p in o&&(d=a(()=>q(M)),r.set(p+"",d))}if(f===void 0)(!h||tt(o,l)?.writable)&&(f=a(()=>q(void 0)),P(f,Ze(c)),r.set(l,f));else{h=f.v!==M;var y=a(()=>Ze(c));P(f,y)}var C=Reflect.getOwnPropertyDescriptor(o,l);if(C?.set&&C.set.call(u,c),!h){if(n&&typeof l=="string"){var g=r.get("length"),v=Number(l);Number.isInteger(v)&&v>=g.v&&P(g,v+1)}rt(s)}return!0},ownKeys(o){m(s);var l=Reflect.ownKeys(o).filter(f=>{var h=r.get(f);return h===void 0||h.v!==M});for(var[c,u]of r)u.v!==M&&!(c in o)&&l.push(c);return l},setPrototypeOf(){Jn()}})}var dr,$r,Yr,Gr,Kr;function us(){if(dr===void 0){dr=window,$r=document,Yr=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,r=Text.prototype;Gr=tt(e,"firstChild").get,Kr=tt(e,"nextSibling").get,fr(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),fr(r)&&(r.__t=void 0)}}function Ie(t=""){return document.createTextNode(t)}function vt(t){return Gr.call(t)}function ut(t){return Kr.call(t)}function ue(t,e){return vt(t)}function fs(t,e=!1){{var r=vt(t);return r instanceof Comment&&r.data===""?ut(r):r}}function J(t,e=1,r=!1){let n=t;for(;e--;)n=ut(n);return n}function hs(t){t.textContent=""}function Fr(){return!1}function Ur(t){var e=I;if(e===null)return b.f|=we,t;if((e.f&Jt)===0){if((e.f&Dt)===0)throw t;e.b.error(t)}else We(t,e)}function We(t,e){for(;e!==null;){if((e.f&Dt)!==0)try{e.b.error(t);return}catch(r){t=r}e=e.parent}throw t}const ht=new Set;let T=null,z=null,ee=[],Qt=null,Bt=!1;class te{committed=!1;current=new Map;previous=new Map;#e=new Set;#t=new Set;#n=0;#r=0;#l=null;#i=[];#s=[];skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#r>0}process(e){ee=[],this.apply();var r={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const n of e)this.#a(n,r);this.is_fork||this.#u(),this.is_deferred()?(this.#o(r.effects),this.#o(r.render_effects),this.#o(r.block_effects)):(T=null,pr(r.render_effects),pr(r.effects),this.#l?.resolve()),z=null}#a(e,r){e.f^=x;for(var n=e.first;n!==null;){var s=n.f,i=(s&(ge|Pe))!==0,a=i&&(s&x)!==0,o=a||(s&W)!==0||this.skipped_effects.has(n);if((n.f&Dt)!==0&&n.b?.is_pending()&&(r={parent:r,effect:n,effects:[],render_effects:[],block_effects:[]}),!o&&n.fn!==null){i?n.f^=x:(s&qt)!==0?r.effects.push(n):ze(n)&&((n.f&pe)!==0&&r.block_effects.push(n),Xe(n));var l=n.first;if(l!==null){n=l;continue}}var c=n.parent;for(n=n.next;n===null&&c!==null;)c===r.effect&&(this.#o(r.effects),this.#o(r.render_effects),this.#o(r.block_effects),r=r.parent),n=c.next,c=c.parent}}#o(e){for(const r of e)((r.f&K)!==0?this.#i:this.#s).push(r),this.#c(r.deps),L(r,x)}#c(e){if(e!==null)for(const r of e)(r.f&O)===0||(r.f&Le)===0||(r.f^=Le,this.#c(r.deps))}capture(e,r){this.previous.has(e)||this.previous.set(e,r),(e.f&we)===0&&(this.current.set(e,e.v),z?.set(e,e.v))}activate(){T=this,this.apply()}deactivate(){T===this&&(T=null,z=null)}flush(){if(this.activate(),ee.length>0){if(ds(),T!==null&&T!==this)return}else this.#n===0&&this.process([]);this.deactivate()}discard(){for(const e of this.#t)e(this);this.#t.clear()}#u(){if(this.#r===0){for(const e of this.#e)e();this.#e.clear()}this.#n===0&&this.#f()}#f(){if(ht.size>1){this.previous.clear();var e=z,r=!0,n={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const i of ht){if(i===this){r=!1;continue}const a=[];for(const[l,c]of this.current){if(i.current.has(l))if(r&&c!==i.current.get(l))i.current.set(l,c);else continue;a.push(l)}if(a.length===0)continue;const o=[...i.current.keys()].filter(l=>!this.current.has(l));if(o.length>0){var s=ee;ee=[];const l=new Set,c=new Map;for(const u of a)Wr(u,o,l,c);if(ee.length>0){T=i,i.apply();for(const u of ee)i.#a(u,n);i.deactivate()}ee=s}}T=null,z=e}this.committed=!0,ht.delete(this)}increment(e){this.#n+=1,e&&(this.#r+=1)}decrement(e){this.#n-=1,e&&(this.#r-=1),this.revive()}revive(){for(const e of this.#i)L(e,K),Oe(e);for(const e of this.#s)L(e,ie),Oe(e);this.#i=[],this.#s=[],this.flush()}oncommit(e){this.#e.add(e)}ondiscard(e){this.#t.add(e)}settled(){return(this.#l??=Mr()).promise}static ensure(){if(T===null){const e=T=new te;ht.add(T),te.enqueue(()=>{T===e&&e.flush()})}return T}static enqueue(e){ct(e)}apply(){}}function ds(){var t=Se;Bt=!0;var e=null;try{var r=0;for(_t(!0);ee.length>0;){var n=te.ensure();if(r++>1e3){var s,i;ps()}n.process(ee),be.clear()}}finally{Bt=!1,_t(t),Qt=null}}function ps(){try{zn()}catch(t){We(t,Qt)}}let ce=null;function pr(t){var e=t.length;if(e!==0){for(var r=0;r<e;){var n=t[r++];if((n.f&(ye|W))===0&&ze(n)&&(ce=new Set,Xe(n),n.deps===null&&n.first===null&&n.nodes_start===null&&(n.teardown===null&&n.ac===null?ln(n):n.fn=null),ce?.size>0)){be.clear();for(const s of ce){if((s.f&(ye|W))!==0)continue;const i=[s];let a=s.parent;for(;a!==null;)ce.has(a)&&(ce.delete(a),i.push(a)),a=a.parent;for(let o=i.length-1;o>=0;o--){const l=i[o];(l.f&(ye|W))===0&&Xe(l)}}ce.clear()}}ce=null}}function Wr(t,e,r,n){if(!r.has(t)&&(r.add(t),t.reactions!==null))for(const s of t.reactions){const i=s.f;(i&O)!==0?Wr(s,e,r,n):(i&(Zt|pe))!==0&&(i&K)===0&&Xr(s,e,n)&&(L(s,K),Oe(s))}}function Xr(t,e,r){const n=r.get(t);if(n!==void 0)return n;if(t.deps!==null)for(const s of t.deps){if(e.includes(s))return!0;if((s.f&O)!==0&&Xr(s,e,r))return r.set(s,!0),!0}return r.set(t,!1),!1}function Oe(t){for(var e=Qt=t;e.parent!==null;){e=e.parent;var r=e.f;if(Bt&&e===I&&(r&pe)!==0&&(r&Pr)===0)return;if((r&(Pe|ge))!==0){if((r&x)===0)return;e.f^=x}}ee.push(e)}function gs(t){let e=0,r=Me(0),n;return()=>{it()&&(m(r),xt(()=>(e===0&&(n=qe(()=>t(()=>rt(r)))),e+=1,()=>{ct(()=>{e-=1,e===0&&(n?.(),n=void 0,rt(r))})})))}}var vs=xe|je|Dt;function ms(t,e,r){new _s(t,e,r)}class _s{parent;#e=!1;#t;#n=null;#r;#l;#i;#s=null;#a=null;#o=null;#c=null;#u=null;#f=0;#h=0;#p=!1;#d=null;#y=gs(()=>(this.#d=Me(this.#f),()=>{this.#d=null}));constructor(e,r,n){this.#t=e,this.#r=r,this.#l=n,this.parent=I.b,this.#e=!!this.#r.pending,this.#i=Lt(()=>{I.b=this;{var s=this.#m();try{this.#s=V(()=>n(s))}catch(i){this.error(i)}this.#h>0?this.#v():this.#e=!1}return()=>{this.#u?.remove()}},vs)}#w(){try{this.#s=V(()=>this.#l(this.#t))}catch(e){this.error(e)}this.#e=!1}#b(){const e=this.#r.pending;e&&(this.#a=V(()=>e(this.#t)),te.enqueue(()=>{var r=this.#m();this.#s=this.#g(()=>(te.ensure(),V(()=>this.#l(r)))),this.#h>0?this.#v():(Ge(this.#a,()=>{this.#a=null}),this.#e=!1)}))}#m(){var e=this.#t;return this.#e&&(this.#u=Ie(),this.#t.before(this.#u),e=this.#u),e}is_pending(){return this.#e||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!this.#r.pending}#g(e){var r=I,n=b,s=k;se(this.#i),Y(this.#i),Ue(this.#i.ctx);try{return e()}catch(i){return Ur(i),null}finally{se(r),Y(n),Ue(s)}}#v(){const e=this.#r.pending;this.#s!==null&&(this.#c=document.createDocumentFragment(),this.#c.append(this.#u),fn(this.#s,this.#c)),this.#a===null&&(this.#a=V(()=>e(this.#t)))}#_(e){if(!this.has_pending_snippet()){this.parent&&this.parent.#_(e);return}this.#h+=e,this.#h===0&&(this.#e=!1,this.#a&&Ge(this.#a,()=>{this.#a=null}),this.#c&&(this.#t.before(this.#c),this.#c=null))}update_pending_count(e){this.#_(e),this.#f+=e,this.#d&&nt(this.#d,this.#f)}get_effect_pending(){return this.#y(),m(this.#d)}error(e){var r=this.#r.onerror;let n=this.#r.failed;if(this.#p||!r&&!n)throw e;this.#s&&(G(this.#s),this.#s=null),this.#a&&(G(this.#a),this.#a=null),this.#o&&(G(this.#o),this.#o=null);var s=!1,i=!1;const a=()=>{if(s){cs();return}s=!0,i&&Qn(),te.ensure(),this.#f=0,this.#o!==null&&Ge(this.#o,()=>{this.#o=null}),this.#e=this.has_pending_snippet(),this.#s=this.#g(()=>(this.#p=!1,V(()=>this.#l(this.#t)))),this.#h>0?this.#v():this.#e=!1};var o=b;try{Y(null),i=!0,r?.(e,a),i=!1}catch(l){We(l,this.#i&&this.#i.parent)}finally{Y(o)}n&&ct(()=>{this.#o=this.#g(()=>{te.ensure(),this.#p=!0;try{return V(()=>{n(this.#t,()=>e,()=>a)})}catch(l){return We(l,this.#i.parent),null}finally{this.#p=!1}})})}}function ys(t,e){return e}function ws(t,e,r){for(var n=[],s=e.length,i=0;i<s;i++)ar(e[i].e,n,!0);cn(n,()=>{var a=n.length===0&&r!==null;if(a){var o=r,l=o.parentNode;hs(l),l.append(o),t.items.clear(),Q(t,e[0].prev,e[s-1].next)}for(var c=0;c<s;c++){var u=e[c];a||(t.items.delete(u.k),Q(t,u.prev,u.next)),G(u.e,!a)}t.first===e[0]&&(t.first=e[0].prev)})}function bs(t,e,r,n,s,i=null){var a=t,o=new Map,l=null;{var c=t;a=c.appendChild(Ie())}var u=null,f=tr(()=>{var g=r();return xr(g)?g:g==null?[]:Vt(g)}),h,p=!0;function d(){Ss(C,h,a,e,n),u!==null&&(h.length===0?(u.fragment?(a.before(u.fragment),u.fragment=null):or(u.effect),y.first=u.effect):Ge(u.effect,()=>{u=null}))}var y=Lt(()=>{h=m(f);for(var g=h.length,v=new Set,A=T,_=null,E=Fr(),S=0;S<g;S+=1){var B=h[S],H=n(B,S),$=p?null:o.get(H);$?(nt($.v,B),$.i=S,E&&A.skipped_effects.delete($.e)):($=Es(p?a:null,_,B,H,S,s,e,r),p&&($.o=!0,_===null?l=$:_.next=$,_=$),o.set(H,$)),v.add(H)}if(g===0&&i&&!u)if(p)u={fragment:null,effect:V(()=>i(a))};else{var Re=document.createDocumentFragment(),me=Ie();Re.append(me),u={fragment:Re,effect:V(()=>i(me))}}if(!p)if(E){for(const[w,X]of o)v.has(w)||A.skipped_effects.add(X.e);A.oncommit(d),A.ondiscard(()=>{})}else d();m(f)}),C={effect:y,items:o,first:l};p=!1}function Ss(t,e,r,n,s){var i=e.length,a=t.items,o=t.first,l,c=null,u=[],f=[],h,p,d,y;for(y=0;y<i;y+=1){if(h=e[y],p=s(h,y),d=a.get(p),t.first??=d,!d.o){d.o=!0;var C=c?c.next:o;Q(t,c,d),Q(t,d,C),Mt(d,C,r),c=d,u=[],f=[],o=c.next;continue}if((d.e.f&W)!==0&&or(d.e),d!==o){if(l!==void 0&&l.has(d)){if(u.length<f.length){var g=f[0],v;c=g.prev;var A=u[0],_=u[u.length-1];for(v=0;v<u.length;v+=1)Mt(u[v],g,r);for(v=0;v<f.length;v+=1)l.delete(f[v]);Q(t,A.prev,_.next),Q(t,c,A),Q(t,_,g),o=g,c=_,y-=1,u=[],f=[]}else l.delete(d),Mt(d,o,r),Q(t,d.prev,d.next),Q(t,d,c===null?t.first:c.next),Q(t,c,d),c=d;continue}for(u=[],f=[];o!==null&&o.k!==p;)(o.e.f&W)===0&&(l??=new Set).add(o),f.push(o),o=o.next;if(o===null)continue;d=o}u.push(d),c=d,o=d.next}if(o!==null||l!==void 0){for(var E=l===void 0?[]:Vt(l);o!==null;)(o.e.f&W)===0&&E.push(o),o=o.next;var S=E.length;if(S>0){var B=i===0?r:null;ws(t,E,B)}}}function Es(t,e,r,n,s,i,a,o){var l=(a&rs)!==0,c=(a&ss)===0,u=l?c?nr(r,!1,!1):Me(r):r,f=(a&ns)===0?s:Me(s),h={i:f,v:u,k:n,a:null,e:null,o:!1,prev:e,next:null};try{if(t===null){var p=document.createDocumentFragment();p.append(t=Ie())}return h.e=V(()=>i(t,u,f,o)),e!==null&&(e.next=h),h}finally{}}function Mt(t,e,r){for(var n=t.next?t.next.e.nodes_start:r,s=e?e.e.nodes_start:r,i=t.e.nodes_start;i!==null&&i!==n;){var a=ut(i);s.before(i),i=a}}function Q(t,e,r){e===null?(t.first=r,t.effect.first=r&&r.e):(e.e.next&&(e.e.next.prev=null),e.next=r,e.e.next=r&&r.e),r===null?t.effect.last=e&&e.e:(r.e.prev&&(r.e.prev.next=null),r.prev=e,r.e.prev=e&&e.e)}function Is(t,e,r,n){const s=lt()?er:tr;if(r.length===0&&t.length===0){n(e.map(s));return}var i=T,a=I,o=As();function l(){Promise.all(r.map(c=>Ds(c))).then(c=>{o();try{n([...e.map(s),...c])}catch(u){(a.f&ye)===0&&We(u,a)}i?.deactivate(),mt()}).catch(c=>{We(c,a)})}t.length>0?Promise.all(t).then(()=>{o();try{return l()}finally{i?.deactivate(),mt()}}):l()}function As(){var t=I,e=b,r=k,n=T;return function(i=!0){se(t),Y(e),Ue(r),i&&n?.activate()}}function mt(){se(null),Y(null),Ue(null)}function er(t){var e=O|K,r=b!==null&&(b.f&O)!==0?b:null;return I!==null&&(I.f|=je),{ctx:k,deps:null,effects:null,equals:Nr,f:e,fn:t,reactions:null,rv:0,v:M,wv:0,parent:r??I,ac:null}}function Ds(t,e){let r=I;r===null&&Wn();var n=r.b,s=void 0,i=Me(M),a=!b,o=new Map;return $s(()=>{var l=Mr();s=l.promise;try{Promise.resolve(t()).then(l.resolve,l.reject).then(()=>{c===T&&c.committed&&c.deactivate(),mt()})}catch(h){l.reject(h),mt()}var c=T;if(a){var u=!n.is_pending();n.update_pending_count(1),c.increment(u),o.get(c)?.reject(He),o.delete(c),o.set(c,l)}const f=(h,p=void 0)=>{if(c.activate(),p)p!==He&&(i.f|=we,nt(i,p));else{(i.f&we)!==0&&(i.f^=we),nt(i,h);for(const[d,y]of o){if(o.delete(d),d===c)break;y.reject(He)}}a&&(n.update_pending_count(-1),c.decrement(u))};l.promise.then(f,h=>f(null,h||"unknown"))}),ir(()=>{for(const l of o.values())l.reject(He)}),new Promise(l=>{function c(u){function f(){u===s?l(i):c(s)}u.then(f,f)}c(s)})}function tr(t){const e=er(t);return e.equals=Hr,e}function jr(t){var e=t.effects;if(e!==null){t.effects=null;for(var r=0;r<e.length;r+=1)G(e[r])}}function Cs(t){for(var e=t.parent;e!==null;){if((e.f&O)===0)return(e.f&ye)===0?e:null;e=e.parent}return null}function rr(t){var e,r=I;se(Cs(t));try{t.f&=~Le,jr(t),e=en(t)}finally{se(r)}return e}function Vr(t){var e=rr(t);if(t.equals(e)||(T?.is_fork||(t.v=e),t.wv=Zr()),!Ve)if(z!==null)(it()||T?.is_fork)&&z.set(t,e);else{var r=(t.f&Z)===0?ie:x;L(t,r)}}let Ht=new Set;const be=new Map;let zr=!1;function Me(t,e){var r={f:0,v:t,reactions:null,equals:Nr,rv:0,wv:0};return r}function q(t,e){const r=Me(t);return ks(r),r}function nr(t,e=!1,r=!0){const n=Me(t);return e||(n.equals=Hr),Ct&&r&&k!==null&&k.l!==null&&(k.l.s??=[]).push(n),n}function P(t,e,r=!1){b!==null&&(!re||(b.f&hr)!==0)&&lt()&&(b.f&(O|pe|Zt|hr))!==0&&!he?.includes(t)&&Zn();let n=r?Ze(e):e;return nt(t,n)}function nt(t,e){if(!t.equals(e)){var r=t.v;Ve?be.set(t,e):be.set(t,r),t.v=e;var n=te.ensure();n.capture(t,r),(t.f&O)!==0&&((t.f&K)!==0&&rr(t),L(t,(t.f&Z)!==0?x:ie)),t.wv=Zr(),qr(t,K),lt()&&I!==null&&(I.f&x)!==0&&(I.f&(ge|Pe))===0&&(j===null?xs([t]):j.push(t)),!n.is_fork&&Ht.size>0&&!zr&&Ts()}return e}function Ts(){zr=!1;var t=Se;_t(!0);const e=Array.from(Ht);try{for(const r of e)(r.f&x)!==0&&L(r,ie),ze(r)&&Xe(r)}finally{_t(t)}Ht.clear()}function rt(t){P(t,t.v+1)}function qr(t,e){var r=t.reactions;if(r!==null)for(var n=lt(),s=r.length,i=0;i<s;i++){var a=r[i],o=a.f;if(!(!n&&a===I)){var l=(o&K)===0;if(l&&L(a,e),(o&O)!==0){var c=a;z?.delete(c),(o&Le)===0&&(o&Z&&(a.f|=Le),qr(c,ie))}else l&&((o&pe)!==0&&ce!==null&&ce.add(a),Oe(a))}}}function sr(t){var e=b,r=I;Y(null),se(null);try{return t()}finally{Y(e),se(r)}}let Se=!1;function _t(t){Se=t}let Ve=!1;function gr(t){Ve=t}let b=null,re=!1;function Y(t){b=t}let I=null;function se(t){I=t}let he=null;function ks(t){b!==null&&(he===null?he=[t]:he.push(t))}let N=null,U=0,j=null;function xs(t){j=t}let Jr=1,st=0,ke=st;function vr(t){ke=t}function Zr(){return++Jr}function ze(t){var e=t.f;if((e&K)!==0)return!0;if(e&O&&(t.f&=~Le),(e&ie)!==0){var r=t.deps;if(r!==null)for(var n=r.length,s=0;s<n;s++){var i=r[s];if(ze(i)&&Vr(i),i.wv>t.wv)return!0}(e&Z)!==0&&z===null&&L(t,x)}return!1}function Qr(t,e,r=!0){var n=t.reactions;if(n!==null&&!he?.includes(t))for(var s=0;s<n.length;s++){var i=n[s];(i.f&O)!==0?Qr(i,e,!1):e===i&&(r?L(i,K):(i.f&x)!==0&&L(i,ie),Oe(i))}}function en(t){var e=N,r=U,n=j,s=b,i=he,a=k,o=re,l=ke,c=t.f;N=null,U=0,j=null,b=(c&(ge|Pe))===0?t:null,he=null,Ue(t.ctx),re=!1,ke=++st,t.ac!==null&&(sr(()=>{t.ac.abort(He)}),t.ac=null);try{t.f|=Nt;var u=t.fn,f=u(),h=t.deps;if(N!==null){var p;if(yt(t,U),h!==null&&U>0)for(h.length=U+N.length,p=0;p<N.length;p++)h[U+p]=N[p];else t.deps=h=N;if(Se&&it()&&(t.f&Z)!==0)for(p=U;p<h.length;p++)(h[p].reactions??=[]).push(t)}else h!==null&&U<h.length&&(yt(t,U),h.length=U);if(lt()&&j!==null&&!re&&h!==null&&(t.f&(O|ie|K))===0)for(p=0;p<j.length;p++)Qr(j[p],t);return s!==null&&s!==t&&(st++,j!==null&&(n===null?n=j:n.push(...j))),(t.f&we)!==0&&(t.f^=we),f}catch(d){return Ur(d)}finally{t.f^=Nt,N=e,U=r,j=n,b=s,he=i,Ue(a),re=o,ke=l}}function Ls(t,e){let r=e.reactions;if(r!==null){var n=$n.call(r,t);if(n!==-1){var s=r.length-1;s===0?r=e.reactions=null:(r[n]=r[s],r.pop())}}r===null&&(e.f&O)!==0&&(N===null||!N.includes(e))&&(L(e,ie),(e.f&Z)!==0&&(e.f^=Z,e.f&=~Le),jr(e),yt(e,0))}function yt(t,e){var r=t.deps;if(r!==null)for(var n=e;n<r.length;n++)Ls(t,r[n])}function Xe(t){var e=t.f;if((e&ye)===0){L(t,x);var r=I,n=Se;I=t,Se=!0;try{(e&(pe|Fn))!==0?Ys(t):on(t),an(t);var s=en(t);t.teardown=typeof s=="function"?s:null,t.wv=Jr;var i;Rt&&es&&(t.f&K)!==0&&t.deps}finally{Se=n,I=r}}}function m(t){var e=t.f,r=(e&O)!==0;if(b!==null&&!re){var n=I!==null&&(I.f&ye)!==0;if(!n&&!he?.includes(t)){var s=b.deps;if((b.f&Nt)!==0)t.rv<st&&(t.rv=st,N===null&&s!==null&&s[U]===t?U++:N===null?N=[t]:N.includes(t)||N.push(t));else{(b.deps??=[]).push(t);var i=t.reactions;i===null?t.reactions=[b]:i.includes(b)||i.push(b)}}}if(Ve){if(be.has(t))return be.get(t);if(r){var a=t,o=a.v;return((a.f&x)===0&&a.reactions!==null||rn(a))&&(o=rr(a)),be.set(a,o),o}}else r&&(!z?.has(t)||T?.is_fork&&!it())&&(a=t,ze(a)&&Vr(a),Se&&it()&&(a.f&Z)===0&&tn(a));if(z?.has(t))return z.get(t);if((t.f&we)!==0)throw t.v;return t.v}function tn(t){if(t.deps!==null){t.f^=Z;for(const e of t.deps)(e.reactions??=[]).push(t),(e.f&O)!==0&&(e.f&Z)===0&&tn(e)}}function rn(t){if(t.v===M)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(be.has(e)||(e.f&O)!==0&&rn(e))return!0;return!1}function qe(t){var e=re;try{return re=!0,t()}finally{re=e}}const Os=-7169;function L(t,e){t.f=t.f&Os|e}function Ms(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(Ye in t)$t(t);else if(!Array.isArray(t))for(let e in t){const r=t[e];typeof r=="object"&&r&&Ye in r&&$t(r)}}}function $t(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let n in t)try{$t(t[n],e)}catch{}const r=zt(t);if(r!==Object.prototype&&r!==Array.prototype&&r!==Map.prototype&&r!==Set.prototype&&r!==Date.prototype){const n=Or(r);for(let s in n){const i=n[s].get;if(i)try{i.call(t)}catch{}}}}}function nn(t){I===null&&(b===null&&Vn(),jn()),Ve&&Xn()}function Ps(t,e){var r=e.last;r===null?e.last=e.first=t:(r.next=t,t.prev=r,e.last=t)}function ae(t,e,r){var n=I;n!==null&&(n.f&W)!==0&&(t|=W);var s={ctx:k,deps:null,nodes_start:null,nodes_end:null,f:t|K|Z,first:null,fn:e,last:null,next:null,parent:n,b:n&&n.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(r)try{Xe(s),s.f|=Jt}catch(o){throw G(s),o}else e!==null&&Oe(s);var i=s;if(r&&i.deps===null&&i.teardown===null&&i.nodes_start===null&&i.first===i.last&&(i.f&je)===0&&(i=i.first,(t&pe)!==0&&(t&xe)!==0&&i!==null&&(i.f|=xe)),i!==null&&(i.parent=n,n!==null&&Ps(i,n),b!==null&&(b.f&O)!==0&&(t&Pe)===0)){var a=b;(a.effects??=[]).push(i)}return s}function it(){return b!==null&&!re}function ir(t){const e=ae(At,null,!1);return L(e,x),e.teardown=t,e}function wt(t){nn();var e=I.f,r=!b&&(e&ge)!==0&&(e&Jt)===0;if(r){var n=k;(n.e??=[]).push(t)}else return sn(t)}function sn(t){return ae(qt|Rr,t,!1)}function Rs(t){return nn(),ae(At|Rr,t,!0)}function Ns(t){te.ensure();const e=ae(Pe|je,t,!0);return(r={})=>new Promise(n=>{r.outro?Ge(e,()=>{G(e),n(void 0)}):(G(e),n(void 0))})}function Bs(t){return ae(qt,t,!1)}function mr(t,e){var r=k,n={effect:null,ran:!1,deps:t};r.l.$.push(n),n.effect=xt(()=>{t(),!n.ran&&(n.ran=!0,qe(e))})}function Hs(){var t=k;xt(()=>{for(var e of t.l.$){e.deps();var r=e.effect;(r.f&x)!==0&&L(r,ie),ze(r)&&Xe(r),e.ran=!1}})}function $s(t){return ae(Zt|je,t,!0)}function xt(t,e=0){return ae(At|e,t,!0)}function at(t,e=[],r=[],n=[]){Is(n,e,r,s=>{ae(At,()=>t(...s.map(m)),!0)})}function Lt(t,e=0){var r=ae(pe|e,t,!0);return r}function V(t){return ae(ge|je,t,!0)}function an(t){var e=t.teardown;if(e!==null){const r=Ve,n=b;gr(!0),Y(null);try{e.call(null)}finally{gr(r),Y(n)}}}function on(t,e=!1){var r=t.first;for(t.first=t.last=null;r!==null;){const s=r.ac;s!==null&&sr(()=>{s.abort(He)});var n=r.next;(r.f&Pe)!==0?r.parent=null:G(r,e),r=n}}function Ys(t){for(var e=t.first;e!==null;){var r=e.next;(e.f&ge)===0&&G(e),e=r}}function G(t,e=!0){var r=!1;(e||(t.f&Pr)!==0)&&t.nodes_start!==null&&t.nodes_end!==null&&(Gs(t.nodes_start,t.nodes_end),r=!0),on(t,e&&!r),yt(t,0),L(t,ye);var n=t.transitions;if(n!==null)for(const i of n)i.stop();an(t);var s=t.parent;s!==null&&s.first!==null&&ln(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes_start=t.nodes_end=t.ac=null}function Gs(t,e){for(;t!==null;){var r=t===e?null:ut(t);t.remove(),t=r}}function ln(t){var e=t.parent,r=t.prev,n=t.next;r!==null&&(r.next=n),n!==null&&(n.prev=r),e!==null&&(e.first===t&&(e.first=n),e.last===t&&(e.last=r))}function Ge(t,e,r=!0){var n=[];ar(t,n,!0),cn(n,()=>{r&&G(t),e&&e()})}function cn(t,e){var r=t.length;if(r>0){var n=()=>--r||e();for(var s of t)s.out(n)}else e()}function ar(t,e,r){if((t.f&W)===0){if(t.f^=W,t.transitions!==null)for(const a of t.transitions)(a.is_global||r)&&e.push(a);for(var n=t.first;n!==null;){var s=n.next,i=(n.f&xe)!==0||(n.f&ge)!==0&&(t.f&pe)!==0;ar(n,e,i?r:!1),n=s}}}function or(t){un(t,!0)}function un(t,e){if((t.f&W)!==0){t.f^=W,(t.f&x)===0&&(L(t,K),Oe(t));for(var r=t.first;r!==null;){var n=r.next,s=(r.f&xe)!==0||(r.f&ge)!==0;un(r,s?e:!1),r=n}if(t.transitions!==null)for(const i of t.transitions)(i.is_global||e)&&i.in()}}function fn(t,e){for(var r=t.nodes_start,n=t.nodes_end;r!==null;){var s=r===n?null:ut(r);e.append(r),r=s}}const Ks=["touchstart","touchmove"];function Fs(t){return Ks.includes(t)}const hn=new Set,Yt=new Set;function Us(t,e,r,n={}){function s(i){if(n.capture||Qe.call(e,i),!i.cancelBubble)return sr(()=>r?.call(this,i))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?ct(()=>{e.addEventListener(t,s,n)}):e.addEventListener(t,s,n),s}function Gt(t,e,r,n,s){var i={capture:n,passive:s},a=Us(t,e,r,i);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&ir(()=>{e.removeEventListener(t,a,i)})}function dn(t){for(var e=0;e<t.length;e++)hn.add(t[e]);for(var r of Yt)r(t)}let _r=null;function Qe(t){var e=this,r=e.ownerDocument,n=t.type,s=t.composedPath?.()||[],i=s[0]||t.target;_r=t;var a=0,o=_r===t&&t.__root;if(o){var l=s.indexOf(o);if(l!==-1&&(e===document||e===window)){t.__root=e;return}var c=s.indexOf(e);if(c===-1)return;l<=c&&(a=l)}if(i=s[a]||t.target,i!==e){Lr(t,"currentTarget",{configurable:!0,get(){return i||r}});var u=b,f=I;Y(null),se(null);try{for(var h,p=[];i!==null;){var d=i.assignedSlot||i.parentNode||i.host||null;try{var y=i["__"+n];y!=null&&(!i.disabled||t.target===i)&&y.call(i,t)}catch(C){h?p.push(C):h=C}if(t.cancelBubble||d===e||d===null)break;i=d}if(h){for(let C of p)queueMicrotask(()=>{throw C});throw h}}finally{t.__root=e,delete t.currentTarget,Y(u),se(f)}}}function Ws(t){var e=document.createElement("template");return e.innerHTML=t.replaceAll("<!>","<!---->"),e.content}function Kt(t,e){var r=I;r.nodes_start===null&&(r.nodes_start=t,r.nodes_end=e)}function oe(t,e){var r=(e&is)!==0,n=(e&as)!==0,s,i=!t.startsWith("<!>");return()=>{s===void 0&&(s=Ws(i?t:"<!>"+t),r||(s=vt(s)));var a=n||Yr?document.importNode(s,!0):s.cloneNode(!0);if(r){var o=vt(a),l=a.lastChild;Kt(o,l)}else Kt(a,a);return a}}function Ke(t=""){{var e=Ie(t+"");return Kt(e,e),e}}function R(t,e){t!==null&&t.before(e)}function bt(t,e){var r=e==null?"":typeof e=="object"?e+"":e;r!==(t.__t??=t.nodeValue)&&(t.__t=r,t.nodeValue=r+"")}function Xs(t,e){return js(t,e)}const Ne=new Map;function js(t,{target:e,anchor:r,props:n={},events:s,context:i,intro:a=!0}){us();var o=new Set,l=f=>{for(var h=0;h<f.length;h++){var p=f[h];if(!o.has(p)){o.add(p);var d=Fs(p);e.addEventListener(p,Qe,{passive:d});var y=Ne.get(p);y===void 0?(document.addEventListener(p,Qe,{passive:d}),Ne.set(p,1)):Ne.set(p,y+1)}}};l(Vt(hn)),Yt.add(l);var c=void 0,u=Ns(()=>{var f=r??e.appendChild(Ie());return ms(f,{pending:()=>{}},h=>{if(i){Tt({});var p=k;p.c=i}s&&(n.$$events=s),c=t(h,n)||{},i&&kt()}),()=>{for(var h of o){e.removeEventListener(h,Qe);var p=Ne.get(h);--p===0?(document.removeEventListener(h,Qe),Ne.delete(h)):Ne.set(h,p)}Yt.delete(l),f!==r&&f.parentNode?.removeChild(f)}});return Vs.set(c,u),c}let Vs=new WeakMap;class pn{anchor;#e=new Map;#t=new Map;#n=new Map;#r=new Set;#l=!0;constructor(e,r=!0){this.anchor=e,this.#l=r}#i=()=>{var e=T;if(this.#e.has(e)){var r=this.#e.get(e),n=this.#t.get(r);if(n)or(n),this.#r.delete(r);else{var s=this.#n.get(r);s&&(this.#t.set(r,s.effect),this.#n.delete(r),s.fragment.lastChild.remove(),this.anchor.before(s.fragment),n=s.effect)}for(const[i,a]of this.#e){if(this.#e.delete(i),i===e)break;const o=this.#n.get(a);o&&(G(o.effect),this.#n.delete(a))}for(const[i,a]of this.#t){if(i===r||this.#r.has(i))continue;const o=()=>{if(Array.from(this.#e.values()).includes(i)){var c=document.createDocumentFragment();fn(a,c),c.append(Ie()),this.#n.set(i,{effect:a,fragment:c})}else G(a);this.#r.delete(i),this.#t.delete(i)};this.#l||!n?(this.#r.add(i),Ge(a,o,!1)):o()}}};#s=e=>{this.#e.delete(e);const r=Array.from(this.#e.values());for(const[n,s]of this.#n)r.includes(n)||(G(s.effect),this.#n.delete(n))};ensure(e,r){var n=T,s=Fr();if(r&&!this.#t.has(e)&&!this.#n.has(e))if(s){var i=document.createDocumentFragment(),a=Ie();i.append(a),this.#n.set(e,{effect:V(()=>r(a)),fragment:i})}else this.#t.set(e,V(()=>r(this.anchor)));if(this.#e.set(n,e),s){for(const[o,l]of this.#t)o===e?n.skipped_effects.delete(l):n.skipped_effects.add(l);for(const[o,l]of this.#n)o===e?n.skipped_effects.delete(l.effect):n.skipped_effects.add(l.effect);n.oncommit(this.#i),n.ondiscard(this.#s)}else this.#i()}}function Te(t,e,r=!1){var n=new pn(t),s=r?xe:0;function i(a,o){n.ensure(a,o)}Lt(()=>{var a=!1;e((o,l=!0)=>{a=!0,i(l,o)}),a||i(!1,null)},s)}function zs(t,e,...r){var n=new pn(t);Lt(()=>{const s=e()??null;n.ensure(s,s&&(i=>s(i,...r)))},xe)}const yr=[...` 	
\r\f \v\uFEFF`];function qs(t,e,r){var n=t==null?"":""+t;if(e&&(n=n?n+" "+e:e),r){for(var s in r)if(r[s])n=n?n+" "+s:s;else if(n.length)for(var i=s.length,a=0;(a=n.indexOf(s,a))>=0;){var o=a+i;(a===0||yr.includes(n[a-1]))&&(o===n.length||yr.includes(n[o]))?n=(a===0?"":n.substring(0,a))+n.substring(o+1):a=o}}return n===""?null:n}function Js(t,e){return t==null?null:String(t)}function gn(t,e,r,n,s,i){var a=t.__className;if(a!==r||a===void 0){var o=qs(r,n,i);o==null?t.removeAttribute("class"):t.className=o,t.__className=r}else if(i&&s!==i)for(var l in i){var c=!!i[l];(s==null||c!==!!s[l])&&t.classList.toggle(l,c)}return i}function Zs(t,e,r,n){var s=t.__style;if(s!==e){var i=Js(e);i==null?t.removeAttribute("style"):t.style.cssText=i,t.__style=e}return n}const Qs=Symbol("is custom element"),ei=Symbol("is html");function dt(t,e,r,n){var s=ti(t);s[e]!==(s[e]=r)&&(e==="loading"&&(t[Un]=r),r==null?t.removeAttribute(e):typeof r!="string"&&ri(t).includes(e)?t[e]=r:t.setAttribute(e,r))}function ti(t){return t.__attributes??={[Qs]:t.nodeName.includes("-"),[ei]:t.namespaceURI===os}}var wr=new Map;function ri(t){var e=t.getAttribute("is")||t.nodeName,r=wr.get(e);if(r)return r;wr.set(e,r=[]);for(var n,s=t,i=Element.prototype;i!==s;){n=Or(s);for(var a in n)n[a].set&&r.push(a);s=zt(s)}return r}function br(t,e){return t===e||t?.[Ye]===e}function ni(t={},e,r,n){return Bs(()=>{var s,i;return xt(()=>{s=i,i=[],qe(()=>{t!==r(...i)&&(e(t,...i),s&&br(r(...s),t)&&e(null,...s))})}),()=>{ct(()=>{i&&br(r(...i),t)&&e(null,...i)})}}),t}function vn(t=!1){const e=k,r=e.l.u;if(!r)return;let n=()=>Ms(e.s);if(t){let s=0,i={};const a=er(()=>{let o=!1;const l=e.s;for(const c in l)l[c]!==i[c]&&(i[c]=l[c],o=!0);return o&&s++,s});n=()=>m(a)}r.b.length&&Rs(()=>{Sr(e,n),gt(r.b)}),wt(()=>{const s=qe(()=>r.m.map(Kn));return()=>{for(const i of s)typeof i=="function"&&i()}}),r.a.length&&wt(()=>{Sr(e,n),gt(r.a)})}function Sr(t,e){if(t.l.s)for(const r of t.l.s)m(r);e()}let Ft=Symbol();function _e(t,e,r){const n=r[e]??={store:null,source:nr(void 0),unsubscribe:fe};if(n.store!==t&&!(Ft in r))if(n.unsubscribe(),n.store=t??null,t==null)n.source.v=void 0,n.unsubscribe=fe;else{var s=!0;n.unsubscribe=lr(t,i=>{s?n.source.v=i:P(n.source,i)}),s=!1}return t&&Ft in r?_n(t):m(n.source)}function mn(){const t={};function e(){ir(()=>{for(var r in t)t[r].unsubscribe();Lr(t,Ft,{enumerable:!1,value:!0})})}return[t,e]}function Je(t,e,r,n){var s=n,i=!0,a=()=>(i&&(i=!1,s=n),s),o;o=t[e],o===void 0&&n!==void 0&&(o=a());var l;return l=()=>{var c=t[e];return c===void 0?a():(i=!0,c)},l}function lr(t,e,r){if(t==null)return e(void 0),r&&r(void 0),fe;const n=qe(()=>t.subscribe(e,r));return n.unsubscribe?()=>n.unsubscribe():n}const Be=[];function si(t,e){return{subscribe:ve(t,e).subscribe}}function ve(t,e=fe){let r=null;const n=new Set;function s(o){if(Br(t,o)&&(t=o,r)){const l=!Be.length;for(const c of n)c[1](),Be.push(c,t);if(l){for(let c=0;c<Be.length;c+=2)Be[c][0](Be[c+1]);Be.length=0}}}function i(o){s(o(t))}function a(o,l=fe){const c=[o,l];return n.add(c),n.size===1&&(r=e(s,i)||fe),o(t),()=>{n.delete(c),n.size===0&&r&&(r(),r=null)}}return{set:s,update:i,subscribe:a}}function Ot(t,e,r){const n=!Array.isArray(t),s=n?[t]:t;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const i=e.length<2;return si(r,(a,o)=>{let l=!1;const c=[];let u=0,f=fe;const h=()=>{if(u)return;f();const d=e(n?c[0]:c,a,o);i?a(d):f=typeof d=="function"?d:fe},p=s.map((d,y)=>lr(d,C=>{c[y]=C,u&=~(1<<y),l&&h()},()=>{u|=1<<y}));return l=!0,h(),function(){gt(p),f(),l=!1}})}function _n(t){let e;return lr(t,r=>e=r)(),e}const Ut=ve("cs"),ii=ve("orange"),ai=ve("Forest"),Wt=ve(!1),et=ve(!1),yn=ve(!1),wn=ve(!1),de={BACKGROUND_BASE:-100,BACKGROUND_LAYER_START:-99,GROUND_REFERENCE:-1,ITEMS_BEHIND:5,PLAYER:10,ITEMS_FRONT:15,SELECTION_GRAPHICS:999,GRID_OVERLAY:1e3};function bn(t){return t==="behind"?de.ITEMS_BEHIND:de.ITEMS_FRONT}const le=["orange","white"];class oi{currentSkin=le[0];currentIndex=0;setSkin(e){le.includes(e)&&(this.currentSkin=e,this.currentIndex=le.indexOf(e),localStorage.setItem("catSkin",e))}getSkin(){const e=localStorage.getItem("catSkin");return e&&le.includes(e)&&(this.currentSkin=e,this.currentIndex=le.indexOf(e)),this.currentSkin}toggleSkin(){return this.currentIndex=(this.currentIndex+1)%le.length,this.currentSkin=le[this.currentIndex],this.setSkin(this.currentSkin),this.currentSkin}getAllSkins(){return le}}const Sn=new oi,li={FAST_VELOCITY_THRESHOLD:100,ROTATION_FULL:15,ROTATION_SLIGHT:8};class ci{scene;currentSkin;constructor(e,r="white"){this.scene=e,this.currentSkin=r}createAll(){Sn.getAllSkins().forEach(r=>{this.createAnimationsForSkin(r)})}createAnimationsForSkin(e){const r=this.scene;r.anims.exists(`cat-idle-${e}`)||r.anims.create({key:`cat-idle-${e}`,frames:r.anims.generateFrameNumbers(`cat-idle-${e}`,{start:0,end:3}),frameRate:6,repeat:-1}),r.anims.exists(`cat-walk-${e}`)||r.anims.create({key:`cat-walk-${e}`,frames:r.anims.generateFrameNumbers(`cat-walk-${e}`,{start:0,end:5}),frameRate:12,repeat:-1}),[{key:`cat-jump-up-${e}`,frame:2},{key:`cat-jump-peak-up-${e}`,frame:3},{key:`cat-jump-peak-down-${e}`,frame:3},{key:`cat-jump-down-${e}`,frame:4}].forEach(({key:s,frame:i})=>{r.anims.exists(s)||r.anims.create({key:s,frames:[{key:`cat-walk-${e}`,frame:i}],frameRate:1,repeat:0})})}getSkin(){return this.currentSkin}setSkin(e){this.currentSkin=e}getAnimationKey(e){return`cat-${e}-${this.currentSkin}`}play(e,r){const n=this.getAnimationKey(r);e.anims.currentAnim?.key!==n&&e.play(n)}getJumpAnimationState(e){const{FAST_VELOCITY_THRESHOLD:r,ROTATION_FULL:n,ROTATION_SLIGHT:s}=li;return e<-r?{animation:this.getAnimationKey("jump-up"),rotation:n,flipMultiplier:1}:e<-20?{animation:this.getAnimationKey("jump-peak-up"),rotation:s,flipMultiplier:1}:e<=r?{animation:this.getAnimationKey("jump-peak-down"),rotation:s,flipMultiplier:-1}:{animation:this.getAnimationKey("jump-down"),rotation:n,flipMultiplier:-1}}handleSkinChange(e,r){const n=this.currentSkin;this.currentSkin=r;const s=e.anims.currentAnim?.key;if(s){const a=`cat-${s.replace("cat-","").replace(`-${n}`,"")}-${r}`;this.scene.anims.exists(a)&&e.play(a)}}}const Ae={THRESHOLD_X:20,LANGUAGE_BUTTON:{width:120,height:60},SKIN_BUTTON:{width:120,height:60,yOffset:60}},Er={SPEED:350,JUMP_STRENGTH:-500};class ui{scene;getPlayerPosition;cursors;keyA;keyD;keyW;keySpace;touchLeft=!1;touchRight=!1;touchJump=!1;touchHandlers;constructor(e){this.scene=e.scene,this.getPlayerPosition=e.getPlayerPosition,this.setupKeyboardControls(),this.setupTouchControls()}setupKeyboardControls(){this.scene.input.keyboard&&(this.cursors=this.scene.input.keyboard.createCursorKeys(),this.keyA=this.scene.input.keyboard.addKey(D.Input.Keyboard.KeyCodes.A),this.keyD=this.scene.input.keyboard.addKey(D.Input.Keyboard.KeyCodes.D),this.keyW=this.scene.input.keyboard.addKey(D.Input.Keyboard.KeyCodes.W),this.keySpace=this.scene.input.keyboard.addKey(D.Input.Keyboard.KeyCodes.SPACE))}setupTouchControls(){const e=this.scene,r=a=>{const o=a.x,l=a.y,c=e.scale.width;if(o>c-Ae.LANGUAGE_BUTTON.width&&l<Ae.LANGUAGE_BUTTON.height||o>c-Ae.SKIN_BUTTON.width&&l>=Ae.SKIN_BUTTON.yOffset&&l<Ae.SKIN_BUTTON.yOffset+Ae.SKIN_BUTTON.height)return;const u=e.cameras.main,f=this.getPlayerPosition(),h=f.x-u.scrollX,p=f.y-u.scrollY,d=o-h,y=l-p;d<-20?(this.touchLeft=!0,this.touchRight=!1):d>Ae.THRESHOLD_X?(this.touchRight=!0,this.touchLeft=!1):(this.touchLeft=!1,this.touchRight=!1),this.touchJump=y<-80},n=a=>{r(a)},s=a=>{a.isDown&&r(a)},i=()=>{this.touchLeft=!1,this.touchRight=!1,this.touchJump=!1};e.input.on("pointerdown",n),e.input.on("pointermove",s),e.input.on("pointerup",i),this.touchHandlers={pointerdown:n,pointermove:s,pointerup:i}}getInputState(){const e=this.keyA?.isDown||this.cursors?.left?.isDown||this.touchLeft||!1,r=this.keyD?.isDown||this.cursors?.right?.isDown||this.touchRight||!1,n=this.keySpace?.isDown||this.keyW?.isDown||this.cursors?.space?.isDown||this.cursors?.up?.isDown||this.touchJump||!1;return{left:e,right:r,jump:n}}hasAnyInput(){const e=this.getInputState();return e.left||e.right||e.jump}destroy(){this.touchHandlers&&(this.scene.input.off("pointerdown",this.touchHandlers.pointerdown),this.scene.input.off("pointermove",this.touchHandlers.pointermove),this.scene.input.off("pointerup",this.touchHandlers.pointerup),this.touchHandlers=void 0)}}class fi extends D.Physics.Arcade.Sprite{animations;inputController;animState="idle";hasNotifiedMovement=!1;hasReceivedInput=!1;constructor(e,r,n){const s="white";super(e,r,n,`cat-idle-${s}`),e.add.existing(this),e.physics.add.existing(this),this.animations=new ci(e,s),this.animations.createAll(),this.inputController=new ui({scene:e,getPlayerPosition:()=>({x:this.x,y:this.y})}),this.setCollideWorldBounds(!0),this.setBounce(0),this.setSize(40,40),this.setOffset(4,8),this.setScale(5),this.setDepth(de.PLAYER),this.animations.play(this,"idle")}changeSkin(e){this.animations.handleSkinChange(this,e)}updateJumpAnimation(e){const{animation:r,rotation:n,flipMultiplier:s}=this.animations.getJumpAnimationState(e);this.anims.currentAnim?.key!==r&&this.play(r);const i=this.flipX?n*s:-n*s;this.setAngle(i)}update(){const e=this.inputController.getInputState(),r=this.body,n=r&&(r.blocked.down||r.touching.down);switch(this.inputController.hasAnyInput()&&!this.hasReceivedInput&&(this.hasReceivedInput=!0),this.hasReceivedInput&&this.inputController.hasAnyInput()&&!this.hasNotifiedMovement&&(this.hasNotifiedMovement=!0,wn.set(!0)),e.left?(this.setVelocityX(-350),this.setFlipX(!0),n&&(this.animState="running")):e.right?(this.setVelocityX(Er.SPEED),this.setFlipX(!1),n&&(this.animState="running")):(this.setVelocityX(0),n&&(this.animState="idle")),e.jump&&n&&(this.setVelocityY(Er.JUMP_STRENGTH),this.animState="jumping"),!n&&r&&r.velocity.y!==0&&(this.animState="jumping"),this.animState){case"idle":this.animations.play(this,"idle"),this.setAngle(0);break;case"running":this.animations.play(this,"walk"),this.setAngle(0);break;case"jumping":this.updateJumpAnimation(r.velocity.y);break}}destroy(e){this.inputController.destroy(),super.destroy(e)}}const De=[{name:"FOREST",folder:"forest",scrollFactors:[1,.8,.85,.9,.95,1]},{name:"FOREST BLUE",folder:"forest_blue",scrollFactors:[1,.8,.85,.9,.95,1]}];class hi{currentIndex=0;constructor(){const e=localStorage.getItem("background");if(e){const r=De.findIndex(n=>n.folder===e);r!==-1&&(this.currentIndex=r)}}getBackground(){return De[this.currentIndex].folder}getCurrentConfig(){return De[this.currentIndex]}setBackground(e){const r=De.findIndex(n=>n.folder===e);r!==-1&&(this.currentIndex=r,localStorage.setItem("background",e))}toggleBackground(){this.currentIndex=(this.currentIndex+1)%De.length;const e=De[this.currentIndex];return localStorage.setItem("background",e.folder),e}getAllBackgrounds(){return De}}const St=new hi;function En(t,e){return new Promise(r=>{t.load.image(`bg0-${e.folder}`,`assets/backgrounds/${e.folder}/0.png`);for(let n=0;n<e.scrollFactors.length;n++){const s=n+1;t.load.image(`bg${s}-${e.folder}`,`assets/backgrounds/${e.folder}/${s}.png`)}t.load.once("complete",()=>{r(!0)}),t.load.once("loaderror",n=>{console.error(`Failed to load background asset: ${n.key}`),r(!1)}),t.load.start()})}function In(t,e,r,n){const s=Math.max(r,t.scale.height),i=t.add.tileSprite(0,0,e,s,`bg0-${n.folder}`);i.setOrigin(0,0),i.setScrollFactor(1),i.setDepth(de.BACKGROUND_BASE),i.tilePositionX=0,i.tilePositionY=0;const a=[];for(let o=0;o<n.scrollFactors.length;o++){const c=`bg${o+1}-${n.folder}`;if(t.textures.exists(c)){const u=t.add.image(0,0,c);u.setOrigin(0,0),u.setScrollFactor(n.scrollFactors[o]),u.setDepth(de.BACKGROUND_LAYER_START+o),u.setDisplaySize(e,r),a.push(u)}}return{baseLayer:i,bgLayers:a}}function An(t,e){t&&(t.tilePositionX=e.scrollX)}function di(t){t.bgLayers.forEach(e=>e.destroy()),t.baseLayer.destroy()}const pi={isActive:!1,config:null,selectedItemId:null,itemDepthLayer:"behind"},F=ve(pi),gi=Ot(F,t=>t.isActive),vi=Ot(F,t=>t.config),Dn=Ot(F,t=>t.selectedItemId),Cn=Ot(F,t=>t.itemDepthLayer);function Ir(t,e){F.update(r=>r.config?{...r,config:{...r.config,playerStartX:t,playerStartY:e}}:r)}function mi(t){F.update(e=>{if(!e.config)return e;const r=e.config.placedItems||[];return{...e,config:{...e.config,placedItems:[...r,t]}}})}function Tn(t,e){F.update(r=>!r.config||!r.config.placedItems?r:{...r,config:{...r.config,placedItems:r.config.placedItems.map(n=>n.id===t?{...n,...e}:n)}})}function kn(t){F.update(e=>!e.config||!e.config.placedItems?e:{...e,config:{...e.config,placedItems:e.config.placedItems.filter(r=>r.id!==t)},selectedItemId:e.selectedItemId===t?null:e.selectedItemId})}function cr(t){F.update(e=>({...e,selectedItemId:t}))}function xn(){F.update(t=>({...t,selectedItemId:null}))}function _i(){F.update(t=>({...t,itemDepthLayer:t.itemDepthLayer==="behind"?"front":"behind"}))}function yi(t,e){Tn(t,{depth:e})}function wi(t){F.set({isActive:!0,config:{...t,placedItems:t.placedItems||[]},selectedItemId:null,itemDepthLayer:"behind"})}function bi(){F.update(t=>({...t,isActive:!1,selectedItemId:null}))}function Si(){return _n(F).config}const ur=[{key:"tent",name:"Tent",path:"assets/ui/tent.png",scale:6,category:"structures"},{key:"lamp",name:"Lamp",path:"assets/ui/lamp.png",scale:8,category:"props"},{key:"sign_left",name:"Sign ←",path:"assets/ui/sign_left.png",scale:7,category:"signs"},{key:"sign_right",name:"Sign →",path:"assets/ui/sign_right.png",scale:7,category:"signs"},{key:"stone_0",name:"Stone 0",path:"assets/ui/stone_0.png",scale:4,category:"nature"},{key:"stone_1",name:"Stone 1",path:"assets/ui/stone_1.png",scale:5,category:"nature"},{key:"stone_2",name:"Stone 2",path:"assets/ui/stone_2.png",scale:4,category:"nature"}];function Ei(t){return ur.find(e=>e.key===t)}function Ii(t){return Ei(t)?.scale||1}class Ar{scene;groundY;constructor(e,r){this.scene=e,this.groundY=r}static preloadAssets(e){ur.forEach(r=>{e.load.image(r.key,r.path)})}createSprite(e){const{id:r,assetKey:n,x:s,scale:i=1,depth:a=5,yOffset:o=0}=e,l=this.groundY+o,c=this.scene.add.sprite(s,l,n);return c.setScale(i),c.setDepth(a),c.setData("itemId",r),c}updatePosition(e,r,n){e.x=r,e.y=this.groundY+n}updateScale(e,r){e.setScale(r)}updateDepth(e,r){e.setDepth(r)}applyUpdates(e,r){r.x!==void 0&&(e.x=r.x),r.yOffset!==void 0&&(e.y=this.groundY+r.yOffset),r.scale!==void 0&&e.setScale(r.scale),r.depth!==void 0&&e.setDepth(r.depth)}worldYToOffset(e){return e-this.groundY}getGroundY(){return this.groundY}}class Ai{scene;groundY;isDragging=!1;callbacks;constructor(e,r,n={}){this.scene=e,this.groundY=r,this.callbacks=n}getIsDragging(){return this.isDragging}makeInteractive(e,r){e.setInteractive({cursor:"pointer"}),this.scene.input.setDraggable(e),e.on("pointerdown",()=>{this.isDragging||cr(r)}),e.on("dragstart",()=>{this.isDragging=!1,e.setTint(4886754),this.scene.data?.set("isDraggingItem",!0),this.callbacks.onDragStart?.(r)}),e.on("drag",(n,s,i)=>{this.isDragging=!0,e.setPosition(s,i),this.callbacks.onDrag?.(r,s,i)}),e.on("dragend",()=>{e.clearTint(),this.scene.data?.set("isDraggingItem",!1);const n=Math.round(e.x),i=Math.round(e.y)-this.groundY;Tn(r,{x:n,yOffset:i}),this.callbacks.onDragEnd?.(r,n,i),this.scene.time.delayedCall(50,()=>{this.isDragging=!1})})}removeInteractivity(e){e.removeInteractive(),e.off("pointerdown"),e.off("dragstart"),e.off("drag"),e.off("dragend")}}const Di={lineWidth:3,lineColor:4886754,lineAlpha:1,handleSize:8,handleColor:4886754,padding:5};class Ci{scene;graphics;style;selectedId=null;constructor(e,r={}){this.scene=e,this.style={...Di,...r},this.graphics=e.add.graphics(),this.graphics.setDepth(de.SELECTION_GRAPHICS)}setSelectedId(e){this.selectedId=e}getSelectedId(){return this.selectedId}updateVisuals(e){if(this.graphics.clear(),!e||!this.selectedId)return;const r=e.getBounds(),{lineWidth:n,lineColor:s,lineAlpha:i,handleSize:a,handleColor:o,padding:l}=this.style;this.graphics.lineStyle(n,s,i),this.graphics.strokeRect(r.x-l,r.y-l,r.width+l*2,r.height+l*2),this.graphics.fillStyle(o,1),this.graphics.fillCircle(r.x,r.y,a),this.graphics.fillCircle(r.x+r.width,r.y,a),this.graphics.fillCircle(r.x,r.y+r.height,a),this.graphics.fillCircle(r.x+r.width,r.y+r.height,a)}clearVisuals(){this.graphics.clear(),this.selectedId=null}setupBackgroundDeselect(e){this.scene.input.on("pointerdown",r=>{if(e())return;this.scene.input.hitTestPointer(r).find(s=>s.type==="Sprite"&&s.getData("itemId"))||(xn(),this.clearVisuals())})}destroy(){this.graphics?.destroy()}}class Et{scene;items=new Map;isBuilderMode=!1;renderer;dragController;selectionManager;constructor(e,r,n=!1){this.scene=e,this.isBuilderMode=n,this.renderer=new Ar(e,r),this.isBuilderMode&&(this.dragController=new Ai(e,r,{onDrag:()=>this.updateSelectionVisuals()}),this.selectionManager=new Ci(e))}static preloadAssets(e){Ar.preloadAssets(e)}createItems(e){e.forEach(r=>{this.createItem(r)})}createItem(e){const r=this.renderer.createSprite(e);this.items.set(e.id,{sprite:r,data:e}),this.isBuilderMode&&this.dragController&&(this.dragController.makeInteractive(r,e.id),r.on("pointerdown",()=>{this.dragController?.getIsDragging()||(cr(e.id),this.updateSelectionVisuals())}))}updateSelectionVisuals(){if(!this.selectionManager)return;const e=this.scene.data.get("selectedItemId");if(this.selectionManager.setSelectedId(e),!e){this.selectionManager.clearVisuals();return}const r=this.items.get(e);this.selectionManager.updateVisuals(r?.sprite??null)}updateItem(e,r){const n=this.items.get(e);n&&(this.renderer.applyUpdates(n.sprite,r),n.data={...n.data,...r})}removeItem(e){const r=this.items.get(e);r&&(this.dragController&&this.dragController.removeInteractivity(r.sprite),r.sprite.destroy(),this.items.delete(e))}removeAllItems(){this.items.forEach(e=>{this.dragController&&this.dragController.removeInteractivity(e.sprite),e.sprite.destroy()}),this.items.clear()}getItem(e){return this.items.get(e)?.data}getAllItems(){return Array.from(this.items.values()).map(e=>e.data)}destroy(){this.removeAllItems(),this.selectionManager?.destroy()}setupBackgroundDeselect(){!this.isBuilderMode||!this.selectionManager||this.selectionManager.setupBackgroundDeselect(()=>this.dragController?.getIsDragging()??!1)}}async function Dr(){const t=await fetch("./config/map.json");if(!t.ok)throw new Error(`Failed to load map config: ${t.status}`);const e=await t.json();if(!e.worldWidth||!e.worldHeight)throw new Error("Invalid map config structure");return e}const pt={generateId(){return`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`},create(t){const{assetKey:e,x:r,yOffset:n=0,depthLayer:s="behind",scale:i,dialogConfig:a}=t;return{id:pt.generateId(),assetKey:e,x:Math.round(r),y:0,scale:i??Ii(e),depth:bn(s),yOffset:Math.round(n),...a&&{dialogConfig:a}}},createAtWorldPosition(t,e,r,n,s="behind"){return pt.create({assetKey:t,x:e,yOffset:r-n,depthLayer:s})},clone(t,e=50){return{...t,id:pt.generateId(),x:t.x+e}}},Ce={HEIGHT:40,VISUAL:{COLOR:9139029,ALPHA:.3},PHYSICS:{COLOR:0,ALPHA:0}},ot={getGroundY(t,e=Ce.HEIGHT){return t-e},createVisualGround(t,e){const r=e.height??Ce.HEIGHT,n=ot.getGroundY(e.worldHeight,r),s=t.add.rectangle(0,n,e.worldWidth,r,e.color??Ce.VISUAL.COLOR,e.alpha??Ce.VISUAL.ALPHA);return s.setOrigin(0,0),s.setDepth(e.depth??de.GROUND_REFERENCE),{ground:s,groundY:n}},createPhysicsGround(t,e){const r=e.height??Ce.HEIGHT,n=ot.getGroundY(e.worldHeight,r),s=t.add.rectangle(0,n,e.worldWidth,r,e.color??Ce.PHYSICS.COLOR,e.alpha??Ce.PHYSICS.ALPHA);return s.setOrigin(0,0),t.physics.add.existing(s,!0),{ground:s,groundY:n}},addPlayerCollision(t,e,r){return t.physics.add.collider(e,r)}},Ee={GAME:"GameScene",BUILDER:"BuilderScene"};class Ti extends D.Scene{player;mapConfig;parallaxLayers=null;loadedBackgrounds=new Set;itemManager;unsubscribers=[];initData;constructor(){super({key:Ee.GAME})}init(e){this.initData=e}preload(){le.forEach(e=>{this.load.spritesheet(`cat-idle-${e}`,`assets/sprites/${e}/Idle.png`,{frameWidth:48,frameHeight:48}),this.load.spritesheet(`cat-walk-${e}`,`assets/sprites/${e}/Walk.png`,{frameWidth:48,frameHeight:48})}),Et.preloadAssets(this)}create(){this.initializeScene()}async initializeScene(){Wt.set(!0);try{await this.loadMapConfiguration();const e=St.getCurrentConfig();await this.loadBackgroundIfNeeded(e),this.createParallaxBackground();const{ground:r,groundY:n}=ot.createPhysicsGround(this,{worldWidth:this.mapConfig.worldWidth,worldHeight:this.mapConfig.worldHeight});this.player=new fi(this,this.mapConfig.playerStartX,this.mapConfig.playerStartY),ot.addPlayerCollision(this,this.player,r),this.itemManager=new Et(this,n,!1),this.mapConfig.placedItems&&this.mapConfig.placedItems.length>0&&this.itemManager.createItems(this.mapConfig.placedItems),this.cameras.main.startFollow(this.player,!0,.1,.1),this.cameras.main.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.physics.world.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight)}catch(e){console.error("[GameScene] Failed to initialize scene:",e)}finally{Wt.set(!1)}}async loadMapConfiguration(){try{if(this.initData?.useBuilderConfig){const e=Si();this.mapConfig=e||await Dr()}else this.mapConfig=await Dr()}catch(e){console.error("[GameScene] Failed to load map configuration:",e),this.mapConfig={worldWidth:3200,worldHeight:600,playerStartX:400,playerStartY:300,placedItems:[]}}}createParallaxBackground(){const e=St.getCurrentConfig();this.parallaxLayers=In(this,this.mapConfig.worldWidth,this.mapConfig.worldHeight,e)}async loadBackgroundIfNeeded(e){if(this.loadedBackgrounds.has(e.folder))return!0;const r=await En(this,e);return r&&this.loadedBackgrounds.add(e.folder),r}shutdown(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.itemManager&&this.itemManager.destroy()}update(){this.player&&(this.player.update(),this.parallaxLayers&&An(this.parallaxLayers.baseLayer,this.cameras.main))}}class ki{scene;camera;worldWidth;worldHeight;isPanning=!1;panStartX=0;cameraDragStartX=0;isDraggingToScroll=!1;dragScrollStartX=0;dragScrollStartY=0;dragScrollCameraStartX=0;dragScrollCameraStartY=0;constructor(e,r,n){this.scene=e,this.camera=e.cameras.main,this.worldWidth=r,this.worldHeight=n}setup(){this.setupCamera(),this.setupMouseControls(),this.setupKeyboardControls()}setupCamera(){this.camera.setBounds(0,0,this.worldWidth,this.worldHeight),this.camera.setZoom(1)}centerOn(e,r){this.camera.centerOn(e,r)}setupMouseControls(){this.scene.input.on("wheel",(e,r,n,s)=>{const i=n!==0?n:s,a=this.camera.scrollX+i;this.camera.setScroll(D.Math.Clamp(a,0,this.worldWidth-this.camera.width),this.camera.scrollY)}),this.scene.input.on("pointerdown",e=>{e.rightButtonDown()||e.middleButtonDown()?(this.isPanning=!0,this.panStartX=e.x,this.cameraDragStartX=this.camera.scrollX):e.leftButtonDown()&&!this.isDraggingObject()&&(this.scene.data.get("isDraggingItem")===!0||(this.dragScrollStartX=e.x,this.dragScrollStartY=e.y,this.dragScrollCameraStartX=this.camera.scrollX,this.dragScrollCameraStartY=this.camera.scrollY))}),this.scene.input.on("pointermove",e=>{if(this.isPanning){const r=e.x-this.panStartX,n=this.cameraDragStartX-r;this.camera.setScroll(D.Math.Clamp(n,0,this.worldWidth-this.camera.width),this.camera.scrollY)}else if(e.leftButtonDown()&&!this.isDraggingToScroll&&!this.isDraggingObject()&&!(this.scene.data.get("isDraggingItem")===!0)){const n=Math.abs(e.x-this.dragScrollStartX),s=Math.abs(e.y-this.dragScrollStartY);Math.sqrt(n*n+s*s)>10&&(this.isDraggingToScroll=!0,this.scene.input.setDefaultCursor("grabbing"))}if(this.isDraggingToScroll){const r=e.x-this.dragScrollStartX,n=e.y-this.dragScrollStartY,s=this.dragScrollCameraStartX-r,i=this.dragScrollCameraStartY-n;this.camera.setScroll(D.Math.Clamp(s,0,this.worldWidth-this.camera.width),D.Math.Clamp(i,0,this.worldHeight-this.camera.height))}}),this.scene.input.on("pointerup",e=>{!e.rightButtonDown()&&!e.middleButtonDown()&&(this.isPanning=!1),this.isDraggingToScroll&&(this.isDraggingToScroll=!1,this.scene.input.setDefaultCursor("default"))})}setupKeyboardControls(){const e=this.scene.input.keyboard.createCursorKeys(),r={w:this.scene.input.keyboard.addKey(D.Input.Keyboard.KeyCodes.W),a:this.scene.input.keyboard.addKey(D.Input.Keyboard.KeyCodes.A),s:this.scene.input.keyboard.addKey(D.Input.Keyboard.KeyCodes.S),d:this.scene.input.keyboard.addKey(D.Input.Keyboard.KeyCodes.D)};this.scene.input.keyboard.addKey(D.Input.Keyboard.KeyCodes.SPACE).on("down",()=>{this.centerOnPlayer()}),this.scene.events.on("update",()=>{e.left.isDown||r.a.isDown?this.camera.scrollX=Math.max(0,this.camera.scrollX-10):(e.right.isDown||r.d.isDown)&&(this.camera.scrollX=Math.min(this.worldWidth-this.camera.width,this.camera.scrollX+10)),e.up.isDown||r.w.isDown?this.camera.scrollY=Math.max(0,this.camera.scrollY-10):(e.down.isDown||r.s.isDown)&&(this.camera.scrollY=Math.min(this.worldHeight-this.camera.height,this.camera.scrollY+10))})}centerOnPlayer(){const e=this.scene.data.get("playerSprite");e&&this.camera.centerOn(e.x,e.y)}isDraggingObject(){return this.scene.data.get("isDraggingObject")===!0}destroy(){}}const It=40,xi=48,Cr=5,Li=de.PLAYER,Tr=100,Oi=4871528,Mi=.4,Pi=1,Ri=de.GRID_OVERLAY,Pt=16711680,Ni=2,Bi=.6,Hi=.1,$i=1,Yi=.2,kr=50,Gi=50,Ki=10,Fi=4886754;class Ui{scene;player;worldWidth;worldHeight;groundY;constructor(e,r,n){this.scene=e,this.worldWidth=r,this.worldHeight=n,this.groundY=n-It}create(e,r){return this.player=this.scene.add.sprite(e,r,"cat-idle-white",0),this.player.setScale(Cr),this.player.setDepth(Li),this.player.setInteractive({draggable:!0,cursor:"grab"}),this.scene.data.set("playerSprite",this.player),this.setupDragHandlers(),this.player}setupDragHandlers(){this.player.on("dragstart",()=>{this.player.setTint(Fi),this.scene.data.set("isDraggingObject",!0)}),this.player.on("drag",(e,r,n)=>{const s=D.Math.Clamp(r,kr,this.worldWidth-kr),i=D.Math.Clamp(n,Gi,this.worldHeight-Ki);this.player.setPosition(s,i),Ir(Math.round(s),Math.round(i))}),this.player.on("dragend",()=>{this.player.clearTint(),this.scene.data.set("isDraggingObject",!1);let e=this.player.y;const r=xi*Cr;this.player.y+r/2>this.groundY&&(e=this.groundY-r/2,this.player.setY(e)),Ir(Math.round(this.player.x),Math.round(e))})}getSprite(){return this.player}destroy(){this.player&&this.player.destroy()}}class Wi{scene;graphics;worldWidth;worldHeight;constructor(e,r,n){this.scene=e,this.worldWidth=r,this.worldHeight=n}create(){return this.graphics=this.scene.add.graphics(),this.graphics.setDepth(Ri),this.draw(),this.graphics}draw(){this.graphics.clear(),this.graphics.lineStyle(Pi,Oi,Mi);const e=Math.max(this.worldHeight,this.scene.scale.height);for(let n=0;n<=this.worldWidth;n+=Tr)this.graphics.beginPath(),this.graphics.moveTo(n,0),this.graphics.lineTo(n,e),this.graphics.strokePath();for(let n=0;n<=e;n+=Tr)this.graphics.beginPath(),this.graphics.moveTo(0,n),this.graphics.lineTo(this.worldWidth,n),this.graphics.strokePath();const r=this.worldHeight-It;this.graphics.lineStyle(Ni,Pt,Bi),this.graphics.beginPath(),this.graphics.moveTo(0,r),this.graphics.lineTo(this.worldWidth,r),this.graphics.strokePath(),this.graphics.lineStyle($i,Pt,Yi),this.graphics.fillStyle(Pt,Hi),this.graphics.fillRect(0,r,this.worldWidth,e-r)}getGraphics(){return this.graphics}destroy(){this.graphics&&this.graphics.destroy()}}class Xi{listeners=new Map;on(e,r){this.listeners.has(e)||this.listeners.set(e,new Set);const n=this.listeners.get(e);return n.add(r),{unsubscribe:()=>{n.delete(r),n.size===0&&this.listeners.delete(e)}}}once(e,r){const n=this.on(e,s=>{n.unsubscribe(),r(s)});return n}emit(e,r){const n=this.listeners.get(e);n&&n.forEach(s=>{try{s(r)}catch(i){console.error(`[EventBus] Error in listener for "${e}":`,i)}})}off(e){this.listeners.delete(e)}clear(){this.listeners.clear()}listenerCount(e){return this.listeners.get(e)?.size??0}}const Xt=new Xi,jt={ASSET_DROPPED:"asset:dropped"};class ji{scene;groundY;itemManager;unsubscribers=[];constructor(e,r){this.scene=e,this.groundY=r}create(e){return this.itemManager=new Et(this.scene,this.groundY,!0),e&&e.length>0&&this.itemManager.createItems(e),this.setupBackgroundDeselect(),this.setupStoreSubscriptions(),this.setupAssetDropListener(),this.setupDeleteKeys(),this.itemManager}setupBackgroundDeselect(){this.itemManager.setupBackgroundDeselect()}setupStoreSubscriptions(){const e=Dn.subscribe(s=>{this.scene.data.set("selectedItemId",s),this.itemManager.updateSelectionVisuals()});this.unsubscribers.push(e);let r=[];const n=vi.subscribe(s=>{if(!s?.placedItems)return;const i=s.placedItems;r.forEach(a=>{i.find(l=>l.id===a.id)||this.itemManager.removeItem(a.id)}),i.forEach(a=>{const o=r.find(l=>l.id===a.id);o&&JSON.stringify(o)!==JSON.stringify(a)&&this.itemManager.updateItem(a.id,a)}),r=i.map(a=>({...a}))});this.unsubscribers.push(n)}setupAssetDropListener(){const e=Xt.on(jt.ASSET_DROPPED,r=>{const{assetKey:n,canvasX:s,canvasY:i}=r,a=this.scene.cameras.main,o=a.scrollX+s/a.zoom,l=a.scrollY+i/a.zoom;let c="behind";Cn.subscribe(h=>{c=h})();const f=pt.createAtWorldPosition(n,o,l,this.groundY,c);mi(f),this.itemManager.createItem(f),cr(f.id)});this.unsubscribers.push(()=>e.unsubscribe())}setupDeleteKeys(){const e=this.scene.input.keyboard.addKey(D.Input.Keyboard.KeyCodes.DELETE),r=this.scene.input.keyboard.addKey(D.Input.Keyboard.KeyCodes.BACKSPACE),n=()=>{const s=this.scene.data.get("selectedItemId");s&&kn(s)};e.on("down",n),r.on("down",n)}getManager(){return this.itemManager}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.itemManager&&this.itemManager.destroy()}}class Vi extends D.Scene{parallaxLayers=null;cameraController;playerController;gridOverlay;itemsController;config;get itemManager(){return this.itemsController?.getManager()}constructor(){super({key:Ee.BUILDER})}init(e){this.config=e.config}preload(){this.load.spritesheet("cat-idle-white","assets/sprites/white/Idle.png",{frameWidth:48,frameHeight:48}),Et.preloadAssets(this)}create(){this.physics.world.setBounds(0,0,this.config.worldWidth,this.config.worldHeight);const e=this.config.worldHeight-It;this.cameraController=new ki(this,this.config.worldWidth,this.config.worldHeight),this.playerController=new Ui(this,this.config.worldWidth,this.config.worldHeight),this.gridOverlay=new Wi(this,this.config.worldWidth,this.config.worldHeight),this.itemsController=new ji(this,e),this.createBackground(),this.gridOverlay.create(),this.createGroundReference(),this.playerController.create(this.config.playerStartX,this.config.playerStartY),this.itemsController.create(this.config.placedItems||[]),this.cameraController.setup(),this.cameraController.centerOn(this.config.playerStartX,this.config.worldHeight/2)}async createBackground(){const e=St.getCurrentConfig();try{await En(this,e)}catch(r){console.error("Failed to load background:",r);return}this.parallaxLayers&&(di(this.parallaxLayers),this.parallaxLayers=null),this.parallaxLayers=In(this,this.config.worldWidth,this.config.worldHeight,e)}createGroundReference(){ot.createVisualGround(this,{worldWidth:this.config.worldWidth,worldHeight:this.config.worldHeight,height:It})}update(){this.parallaxLayers&&An(this.parallaxLayers.baseLayer,this.cameras.main)}shutdown(){this.cameraController&&this.cameraController.destroy(),this.playerController&&this.playerController.destroy(),this.gridOverlay&&this.gridOverlay.destroy(),this.itemsController&&this.itemsController.destroy()}}const zi="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(zi);ts();class qi{currentLanguage="cs";setLanguage(e){this.currentLanguage=e,localStorage.setItem("language",e)}getLanguage(){const e=localStorage.getItem("language");return(e==="cs"||e==="en")&&(this.currentLanguage=e),this.currentLanguage}toggleLanguage(){return this.currentLanguage=this.currentLanguage==="cs"?"en":"cs",this.setLanguage(this.currentLanguage),this.currentLanguage}}const Ln=new qi;let ne=null;function Ji(t){ne=t}function Zi(){if(!ne)return console.error("Scene manager not initialized"),null;try{return ne.scene.getScene(Ee.GAME)?.mapConfig||null}catch(t){return console.error("Failed to get map config:",t),null}}function Qi(t){if(!ne)return console.error("Scene manager not initialized"),!1;try{return ne.scene.getScene(Ee.GAME)?(ne.scene.stop(Ee.GAME),wi(t),ne.scene.start(Ee.BUILDER,{config:t}),!0):(console.error("GameScene not found"),!1)}catch(e){return console.error("Failed to switch to builder:",e),!1}}function ea(){if(!ne)return console.error("Scene manager not initialized"),!1;try{return ne.scene.stop(Ee.BUILDER),bi(),ne.scene.start(Ee.GAME,{useBuilderConfig:!0}),!0}catch(t){return console.error("Failed to switch to game:",t),!1}}var ta=oe("<button><!></button>");function Fe(t,e){let r=Je(e,"position",3,"top-right"),n=Je(e,"variant",3,"default"),s=Je(e,"disabled",3,!1),i=Je(e,"title",3,""),a=Je(e,"width",3,"100px");const l={default:{base:"#4a90e2",hover:"#357abd",active:"#2a5f8f"},green:{base:"#27ae60",hover:"#229954",active:"#1e8449"},blue:{base:"#3498db",hover:"#2980b9",active:"#21618c"},orange:{base:"#ffa500",hover:"#ff8c00",active:"#e67e00"},red:{base:"#e74c3c",hover:"#c0392b",active:"#a02e22"}}[n()];var c=ta();let u;c.__click=function(...h){e.onclick?.apply(this,h)};var f=ue(c);zs(f,()=>e.children??fe),at(()=>{u=gn(c,1,`pixel-btn pixel-btn--${r()??""}`,"svelte-lwc0vq",u,{disabled:s()}),Zs(c,`--btn-width: ${a()??""}; --color-base: ${l.base??""}; --color-hover: ${l.hover??""}; --color-active: ${l.active??""}`),c.disabled=s(),dt(c,"title",i())}),R(t,c)}dn(["click"]);var ra=oe('<div draggable="true" role="button" tabindex="0"><img class="asset-preview svelte-1ahretz"/> <span class="asset-name svelte-1ahretz"> </span></div>'),na=oe('<div class="palette-dropdown svelte-1ahretz" role="toolbar" tabindex="-1"><div class="palette-header svelte-1ahretz"><span class="palette-title svelte-1ahretz">Assets</span> <span class="palette-hint svelte-1ahretz">Drag to place</span></div> <div class="palette-grid svelte-1ahretz"></div></div>'),sa=oe('<div class="palette-container svelte-1ahretz"><!> <!></div>');function ia(t,e){Tt(e,!0);const r=ur;let n=q(!1),s=q(null),i=q(null);function a(g){g.stopPropagation(),g.preventDefault(),P(n,!m(n))}function o(g,v){if(!g.dataTransfer)return;P(s,v,!0),g.dataTransfer.effectAllowed="copy",g.dataTransfer.setData("assetKey",v);const _=g.target.querySelector("img")?.cloneNode(!0);_&&(_.style.position="absolute",_.style.top="-1000px",document.body.appendChild(_),g.dataTransfer.setDragImage(_,24,24),setTimeout(()=>_.remove(),0))}function l(){P(s,null)}function c(g,v){if(g.touches.length!==1)return;const A=g.touches[0];P(s,v,!0);const E=g.currentTarget.querySelector("img");if(E){const S=document.createElement("div");S.className="touch-drag-preview",S.innerHTML=`<img src="${E.src}" alt="" />`,S.style.cssText=`
        position: fixed;
        top: ${A.clientY-24}px;
        left: ${A.clientX-24}px;
        width: 48px;
        height: 48px;
        pointer-events: none;
        z-index: 10000;
        opacity: 0.9;
        image-rendering: pixelated;
        filter: drop-shadow(3px 3px 0 rgba(0, 0, 0, 0.5));
        border: 2px solid #4a90e2;
        background: rgba(26, 26, 46, 0.9);
      `,S.querySelector("img").style.cssText=`
        width: 100%;
        height: 100%;
        object-fit: contain;
        image-rendering: pixelated;
      `,document.body.appendChild(S),P(i,S,!0)}}function u(g){if(!m(s)||!m(i))return;const v=g.touches[0];m(i).style.top=`${v.clientY-24}px`,m(i).style.left=`${v.clientX-24}px`,g.preventDefault()}function f(g){if(!m(s))return;const v=g.changedTouches[0],A=document.querySelector("canvas");if(m(i)&&(m(i).remove(),P(i,null)),A){const _=A.getBoundingClientRect(),E=v.clientX,S=v.clientY;if(E>=_.left&&E<=_.right&&S>=_.top&&S<=_.bottom){const B=E-_.left,H=S-_.top;Xt.emit(jt.ASSET_DROPPED,{assetKey:m(s),canvasX:B,canvasY:H})}}P(s,null)}function h(g){g.stopPropagation()}wt(()=>{const g=document.querySelector("canvas");if(!g)return;const v=_=>{_.preventDefault(),_.dataTransfer&&(_.dataTransfer.dropEffect="copy")},A=_=>{_.preventDefault();const E=_.dataTransfer?.getData("assetKey");if(!E)return;const S=g.getBoundingClientRect(),B=_.clientX-S.left,H=_.clientY-S.top;Xt.emit(jt.ASSET_DROPPED,{assetKey:E,canvasX:B,canvasY:H})};return g.addEventListener("dragover",v),g.addEventListener("drop",A),()=>{g.removeEventListener("dragover",v),g.removeEventListener("drop",A)}}),wt(()=>(document.addEventListener("touchmove",u,{passive:!1}),document.addEventListener("touchend",f),document.addEventListener("touchcancel",f),()=>{document.removeEventListener("touchmove",u),document.removeEventListener("touchend",f),document.removeEventListener("touchcancel",f)}));var p=sa(),d=ue(p);Fe(d,{onclick:a,position:"top-right",variant:"blue",width:"140px",title:"Asset Palette",children:(g,v)=>{var A=Ke();at(()=>bt(A,`${m(n)?"▼":"◀"} ASSETS`)),R(g,A)},$$slots:{default:!0}});var y=J(d,2);{var C=g=>{var v=na();v.__pointerdown=h;var A=J(ue(v),2);bs(A,21,()=>r,ys,(_,E)=>{var S=ra();let B;S.__touchstart=me=>c(me,m(E).key);var H=ue(S),$=J(H,2),Re=ue($);at(()=>{B=gn(S,1,"asset-item svelte-1ahretz",null,B,{dragging:m(s)===m(E).key}),dt(S,"title",m(E).name),dt(H,"src",m(E).path),dt(H,"alt",m(E).name),bt(Re,m(E).name)}),Gt("dragstart",S,me=>o(me,m(E).key)),Gt("dragend",S,l),R(_,S)}),R(g,v)};Te(y,g=>{m(n)&&g(C)})}R(t,p),kt()}dn(["pointerdown","touchstart"]);var aa=oe('<div class="item-controls svelte-1vm8op7"><!> <!></div>'),oa=oe("<!> <!> <!>",1);function la(t,e){Tt(e,!1);const r=()=>_e(Dn,"$selectedItemId",s),n=()=>_e(Cn,"$itemDepthLayer",s),[s,i]=mn();function a(){ea()}function o(){if(!r())return;const d=n()==="behind"?"front":"behind",y=bn(d);_i(),yi(r(),y)}function l(){r()&&(kn(r()),xn())}vn();var c=oa(),u=fs(c);ia(u,{});var f=J(u,2);Fe(f,{position:"top-left",variant:"green",width:"120px",onclick:a,children:(d,y)=>{var C=Ke("SAVE");R(d,C)},$$slots:{default:!0}});var h=J(f,2);{var p=d=>{var y=aa(),C=ue(y);{let v=tr(()=>n()==="behind"?"blue":"orange");Fe(C,{get variant(){return m(v)},title:"Toggle item depth: behind or in front of player",onclick:o,children:(A,_)=>{var E=Ke();at(()=>bt(E,n()==="behind"?"Behind":"Front")),R(A,E)},$$slots:{default:!0}})}var g=J(C,2);Fe(g,{variant:"red",title:"Delete selected item",onclick:l,children:(v,A)=>{var _=Ke("DELETE");R(v,_)},$$slots:{default:!0}}),R(d,y)};Te(h,d=>{r()&&d(p)})}R(t,c),kt(),i()}var ca=oe('<div class="touch-controls"><p class="touch-text">Tap and hold<br/>where you want<br/>to move</p></div>'),ua=oe('<div class="desktop-controls"><div class="key-row"><div class="pixel-key">A</div> <div class="pixel-key">W</div> <div class="pixel-key">D</div></div> <p class="or-text">or</p> <div class="key-row"><div class="pixel-key">←</div> <div class="pixel-key">↑</div> <div class="pixel-key">→</div></div></div>'),fa=oe('<div class="loader-overlay"><div class="pixel-loader"></div></div>'),ha=oe('<div class="game-ui-wrapper svelte-13dvmla"><!> <!> <!> <dialog class="pixel-dialog"><h1>CONTROLS</h1> <div class="controls-content"><!></div></dialog> <!></div>');function da(t,e){Tt(e,!1);const r=()=>_e(et,"$showControlsDialog",l),n=()=>_e(wn,"$hasPlayerMoved",l),s=()=>_e(gi,"$isBuilderMode",l),i=()=>_e(Ut,"$currentLanguage",l),a=()=>_e(yn,"$isTouchDevice",l),o=()=>_e(Wt,"$isLoading",l),[l,c]=mn();let u=nr();function f(){const w=Ln.toggleLanguage();Ut.set(w)}function h(w){!m(u)?.open||w.target.closest(".pixel-button")||et.set(!1)}function p(){const w=Zi();if(!w){console.error("Cannot enter builder mode: map config not found");return}Qi(w)}mr(()=>(m(u),r()),()=>{m(u)&&(r()?m(u).showModal():m(u).close())}),mr(()=>(n(),m(u),et),()=>{n()&&m(u)?.open&&et.set(!1)}),Hs(),vn();var d=ha();Gt("pointerdown",$r,h);var y=ue(d);{var C=w=>{la(w,{})};Te(y,w=>{s()&&w(C)})}var g=J(y,2);{var v=w=>{Fe(w,{position:"top-left",variant:"green",width:"120px",onclick:p,title:"Toggle Builder Mode",children:(X,Pn)=>{var ft=Ke("BUILD");R(X,ft)},$$slots:{default:!0}})};Te(g,w=>{s()||w(v)})}var A=J(g,2);{var _=w=>{Fe(w,{position:"top-right",variant:"default",width:"100px",onclick:f,title:"Toggle Language (L)",children:(X,Pn)=>{var ft=Ke();at(Rn=>bt(ft,Rn),[()=>(i(),qe(()=>i().toUpperCase()))]),R(X,ft)},$$slots:{default:!0}})};Te(A,w=>{s()||w(_)})}var E=J(A,2),S=J(ue(E),2),B=ue(S);{var H=w=>{var X=ca();R(w,X)},$=w=>{var X=ua();R(w,X)};Te(B,w=>{a()?w(H):w($,!1)})}ni(E,w=>P(u,w),()=>m(u));var Re=J(E,2);{var me=w=>{var X=fa();R(w,X)};Te(Re,w=>{o()&&w(me)})}R(t,d),kt(),c()}const On=document.getElementById("game-ui");if(!On)throw new Error("game-ui element not found!");Xs(da,{target:On});Ut.set(Ln.getLanguage());ii.set(Sn.getSkin());ai.set(St.getCurrentConfig().name);const pa={type:D.AUTO,width:800,height:600,parent:"game-container",backgroundColor:"#000000",pixelArt:!0,roundPixels:!0,scale:{mode:D.Scale.RESIZE,autoCenter:D.Scale.CENTER_BOTH},physics:{default:"arcade",arcade:{gravity:{y:800,x:0},debug:!1}},audio:{noAudio:!0},scene:[Ti,Vi]},Mn=new D.Game(pa);Ji(Mn);const ga=Mn.device.input.touch;yn.set(ga);const va=performance.getEntriesByType("navigation")[0]&&performance.getEntriesByType("navigation")[0].type==="reload",ma=sessionStorage.getItem("hasSeenControlsHint");(!ma||va)&&(sessionStorage.setItem("hasSeenControlsHint","true"),et.set(!0));
//# sourceMappingURL=index-BwiHnPM7.js.map
