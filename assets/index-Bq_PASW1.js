import{r as mo,g as _o}from"./phaser-DFK5Ua9d.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();var yo=mo();const W=_o(yo),Ai=!1;var Ni=Array.isArray,wo=Array.prototype.indexOf,Bi=Array.from,js=Object.defineProperty,xn=Object.getOwnPropertyDescriptor,qs=Object.getOwnPropertyDescriptors,bo=Object.prototype,So=Array.prototype,Zi=Object.getPrototypeOf,hs=Object.isExtensible;const je=()=>{};function Eo(n){return n()}function jn(n){for(var e=0;e<n.length;e++)n[e]()}function Js(){var n,e,t=new Promise((i,s)=>{n=i,e=s});return{promise:t,resolve:n,reject:e}}function xo(n,e){if(Array.isArray(n))return n;if(!(Symbol.iterator in n))return Array.from(n);const t=[];for(const i of n)if(t.push(i),t.length===e)break;return t}const ve=2,Wi=4,ci=8,Io=1<<24,St=16,Et=32,jt=64,di=128,Qe=512,ge=1024,He=2048,dt=4096,Ze=8192,Tt=16384,Yi=32768,zt=65536,fs=1<<17,Qs=1<<18,vn=1<<19,er=1<<20,Gt=32768,ki=1<<21,zi=1<<22,At=1<<23,kt=Symbol("$state"),Co=Symbol(""),rn=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function tr(n){return n===this.v}function nr(n,e){return n!=n?e==e:n!==e||n!==null&&typeof n=="object"||typeof n=="function"}function ir(n){return!nr(n,this.v)}function sr(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Do(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function To(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Ao(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function ko(n){throw new Error("https://svelte.dev/e/effect_orphan")}function Mo(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Po(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function $o(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Oo(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function Lo(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}let Rn=!1,Ro=!1;function Ho(){Rn=!0}const Fo=1,Xo=2,No=16,Bo=1,Zo=2,ye=Symbol(),Wo="http://www.w3.org/1999/xhtml";let ne=null;function un(n){ne=n}function ue(n,e=!1,t){ne={p:ne,i:!1,c:null,e:null,s:n,x:null,l:Rn&&!e?{s:null,u:null,$:[]}:null}}function he(n){var e=ne,t=e.e;if(t!==null){e.e=null;for(var i of t)Cr(i)}return e.i=!0,ne=e.p,{}}function Hn(){return!Rn||ne!==null&&ne.l===null}let on=[];function Yo(){var n=on;on=[],jn(n)}function Fn(n){if(on.length===0){var e=on;queueMicrotask(()=>{e===on&&Yo()})}on.push(n)}function zo(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Go(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function Ke(n){if(typeof n!="object"||n===null||kt in n)return n;const e=Zi(n);if(e!==bo&&e!==So)return n;var t=new Map,i=Ni(n),s=Y(0),r=Yt,o=l=>{if(Yt===r)return l();var a=z,d=Yt;Oe(null),_s(r);var u=l();return Oe(a),_s(d),u};return i&&t.set("length",Y(n.length)),new Proxy(n,{defineProperty(l,a,d){(!("value"in d)||d.configurable===!1||d.enumerable===!1||d.writable===!1)&&Po();var u=t.get(a);return u===void 0?u=o(()=>{var h=Y(d.value);return t.set(a,h),h}):P(u,d.value,!0),!0},deleteProperty(l,a){var d=t.get(a);if(d===void 0){if(a in l){const u=o(()=>Y(ye));t.set(a,u),In(s)}}else P(d,ye),In(s);return!0},get(l,a,d){if(a===kt)return n;var u=t.get(a),h=a in l;if(u===void 0&&(!h||xn(l,a)?.writable)&&(u=o(()=>{var g=Ke(h?l[a]:ye),p=Y(g);return p}),t.set(a,u)),u!==void 0){var f=c(u);return f===ye?void 0:f}return Reflect.get(l,a,d)},getOwnPropertyDescriptor(l,a){var d=Reflect.getOwnPropertyDescriptor(l,a);if(d&&"value"in d){var u=t.get(a);u&&(d.value=c(u))}else if(d===void 0){var h=t.get(a),f=h?.v;if(h!==void 0&&f!==ye)return{enumerable:!0,configurable:!0,value:f,writable:!0}}return d},has(l,a){if(a===kt)return!0;var d=t.get(a),u=d!==void 0&&d.v!==ye||Reflect.has(l,a);if(d!==void 0||q!==null&&(!u||xn(l,a)?.writable)){d===void 0&&(d=o(()=>{var f=u?Ke(l[a]):ye,g=Y(f);return g}),t.set(a,d));var h=c(d);if(h===ye)return!1}return u},set(l,a,d,u){var h=t.get(a),f=a in l;if(i&&a==="length")for(var g=d;g<h.v;g+=1){var p=t.get(g+"");p!==void 0?P(p,ye):g in l&&(p=o(()=>Y(ye)),t.set(g+"",p))}if(h===void 0)(!f||xn(l,a)?.writable)&&(h=o(()=>Y(void 0)),P(h,Ke(d)),t.set(a,h));else{f=h.v!==ye;var _=o(()=>Ke(d));P(h,_)}var w=Reflect.getOwnPropertyDescriptor(l,a);if(w?.set&&w.set.call(u,d),!f){if(i&&typeof a=="string"){var v=t.get("length"),E=Number(a);Number.isInteger(E)&&E>=v.v&&P(v,E+1)}In(s)}return!0},ownKeys(l){c(s);var a=Reflect.ownKeys(l).filter(h=>{var f=t.get(h);return f===void 0||f.v!==ye});for(var[d,u]of t)u.v!==ye&&!(d in l)&&a.push(d);return a},setPrototypeOf(){$o()}})}function gs(n){try{if(n!==null&&typeof n=="object"&&kt in n)return n[kt]}catch{}return n}function Ko(n,e){return Object.is(gs(n),gs(e))}var ps,rr,or,ar,lr;function Uo(){if(ps===void 0){ps=window,rr=document,or=/Firefox/.test(navigator.userAgent);var n=Element.prototype,e=Node.prototype,t=Text.prototype;ar=xn(e,"firstChild").get,lr=xn(e,"nextSibling").get,hs(n)&&(n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__style=void 0,n.__e=void 0),hs(t)&&(t.__t=void 0)}}function bt(n=""){return document.createTextNode(n)}function qn(n){return ar.call(n)}function Xn(n){return lr.call(n)}function O(n,e){return qn(n)}function ae(n,e=!1){{var t=qn(n);return t instanceof Comment&&t.data===""?Xn(t):t}}function M(n,e=1,t=!1){let i=n;for(;e--;)i=Xn(i);return i}function Vo(n){n.textContent=""}function cr(){return!1}function dr(n){var e=q;if(e===null)return z.f|=At,n;if((e.f&Yi)===0){if((e.f&di)===0)throw n;e.b.error(n)}else hn(n,e)}function hn(n,e){for(;e!==null;){if((e.f&di)!==0)try{e.b.error(n);return}catch(t){n=t}e=e.parent}throw n}const Bn=new Set;let se=null,Ue=null,ot=[],Gi=null,Mi=!1;class at{committed=!1;current=new Map;previous=new Map;#e=new Set;#t=new Set;#i=0;#n=0;#l=null;#r=[];#s=[];skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#n>0}process(e){ot=[],this.apply();var t={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const i of e)this.#o(i,t);this.is_fork||this.#d(),this.is_deferred()?(this.#a(t.effects),this.#a(t.render_effects),this.#a(t.block_effects)):(se=null,vs(t.render_effects),vs(t.effects),this.#l?.resolve()),Ue=null}#o(e,t){e.f^=ge;for(var i=e.first;i!==null;){var s=i.f,r=(s&(Et|jt))!==0,o=r&&(s&ge)!==0,l=o||(s&Ze)!==0||this.skipped_effects.has(i);if((i.f&di)!==0&&i.b?.is_pending()&&(t={parent:t,effect:i,effects:[],render_effects:[],block_effects:[]}),!l&&i.fn!==null){r?i.f^=ge:(s&Wi)!==0?t.effects.push(i):_n(i)&&((i.f&St)!==0&&t.block_effects.push(i),fn(i));var a=i.first;if(a!==null){i=a;continue}}var d=i.parent;for(i=i.next;i===null&&d!==null;)d===t.effect&&(this.#a(t.effects),this.#a(t.render_effects),this.#a(t.block_effects),t=t.parent),i=d.next,d=d.parent}}#a(e){for(const t of e)((t.f&He)!==0?this.#r:this.#s).push(t),this.#c(t.deps),pe(t,ge)}#c(e){if(e!==null)for(const t of e)(t.f&ve)===0||(t.f&Gt)===0||(t.f^=Gt,this.#c(t.deps))}capture(e,t){this.previous.has(e)||this.previous.set(e,t),(e.f&At)===0&&(this.current.set(e,e.v),Ue?.set(e,e.v))}activate(){se=this,this.apply()}deactivate(){se===this&&(se=null,Ue=null)}flush(){if(this.activate(),ot.length>0){if(jo(),se!==null&&se!==this)return}else this.#i===0&&this.process([]);this.deactivate()}discard(){for(const e of this.#t)e(this);this.#t.clear()}#d(){if(this.#n===0){for(const e of this.#e)e();this.#e.clear()}this.#i===0&&this.#u()}#u(){if(Bn.size>1){this.previous.clear();var e=Ue,t=!0,i={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const r of Bn){if(r===this){t=!1;continue}const o=[];for(const[a,d]of this.current){if(r.current.has(a))if(t&&d!==r.current.get(a))r.current.set(a,d);else continue;o.push(a)}if(o.length===0)continue;const l=[...r.current.keys()].filter(a=>!this.current.has(a));if(l.length>0){var s=ot;ot=[];const a=new Set,d=new Map;for(const u of o)ur(u,l,a,d);if(ot.length>0){se=r,r.apply();for(const u of ot)r.#o(u,i);r.deactivate()}ot=s}}se=null,Ue=e}this.committed=!0,Bn.delete(this)}increment(e){this.#i+=1,e&&(this.#n+=1)}decrement(e){this.#i-=1,e&&(this.#n-=1),this.revive()}revive(){for(const e of this.#r)pe(e,He),Kt(e);for(const e of this.#s)pe(e,dt),Kt(e);this.#r=[],this.#s=[],this.flush()}oncommit(e){this.#e.add(e)}ondiscard(e){this.#t.add(e)}settled(){return(this.#l??=Js()).promise}static ensure(){if(se===null){const e=se=new at;Bn.add(se),at.enqueue(()=>{se===e&&e.flush()})}return se}static enqueue(e){Fn(e)}apply(){}}function jo(){var n=$t;Mi=!0;var e=null;try{var t=0;for(Qn(!0);ot.length>0;){var i=at.ensure();if(t++>1e3){var s,r;qo()}i.process(ot),Pt.clear()}}finally{Mi=!1,Qn(n),Gi=null}}function qo(){try{Mo()}catch(n){hn(n,Gi)}}let mt=null;function vs(n){var e=n.length;if(e!==0){for(var t=0;t<e;){var i=n[t++];if((i.f&(Tt|Ze))===0&&_n(i)&&(mt=new Set,fn(i),i.deps===null&&i.first===null&&i.nodes_start===null&&(i.teardown===null&&i.ac===null?Ar(i):i.fn=null),mt?.size>0)){Pt.clear();for(const s of mt){if((s.f&(Tt|Ze))!==0)continue;const r=[s];let o=s.parent;for(;o!==null;)mt.has(o)&&(mt.delete(o),r.push(o)),o=o.parent;for(let l=r.length-1;l>=0;l--){const a=r[l];(a.f&(Tt|Ze))===0&&fn(a)}}mt.clear()}}mt=null}}function ur(n,e,t,i){if(!t.has(n)&&(t.add(n),n.reactions!==null))for(const s of n.reactions){const r=s.f;(r&ve)!==0?ur(s,e,t,i):(r&(zi|St))!==0&&(r&He)===0&&hr(s,e,i)&&(pe(s,He),Kt(s))}}function hr(n,e,t){const i=t.get(n);if(i!==void 0)return i;if(n.deps!==null)for(const s of n.deps){if(e.includes(s))return!0;if((s.f&ve)!==0&&hr(s,e,t))return t.set(s,!0),!0}return t.set(n,!1),!1}function Kt(n){for(var e=Gi=n;e.parent!==null;){e=e.parent;var t=e.f;if(Mi&&e===q&&(t&St)!==0&&(t&Qs)===0)return;if((t&(jt|Et))!==0){if((t&ge)===0)return;e.f^=ge}}ot.push(e)}function Jo(n){let e=0,t=Ut(0),i;return()=>{Pn()&&(c(t),fi(()=>(e===0&&(i=Lt(()=>n(()=>In(t)))),e+=1,()=>{Fn(()=>{e-=1,e===0&&(i?.(),i=void 0,In(t))})})))}}var Qo=zt|vn|di;function ea(n,e,t){new ta(n,e,t)}class ta{parent;#e=!1;#t;#i=null;#n;#l;#r;#s=null;#o=null;#a=null;#c=null;#d=null;#u=0;#h=0;#g=!1;#f=null;#y=Jo(()=>(this.#f=Ut(this.#u),()=>{this.#f=null}));constructor(e,t,i){this.#t=e,this.#n=t,this.#l=i,this.parent=q.b,this.#e=!!this.#n.pending,this.#r=gi(()=>{q.b=this;{var s=this.#m();try{this.#s=Ge(()=>i(s))}catch(r){this.error(r)}this.#h>0?this.#v():this.#e=!1}return()=>{this.#d?.remove()}},Qo)}#w(){try{this.#s=Ge(()=>this.#l(this.#t))}catch(e){this.error(e)}this.#e=!1}#b(){const e=this.#n.pending;e&&(this.#o=Ge(()=>e(this.#t)),at.enqueue(()=>{var t=this.#m();this.#s=this.#p(()=>(at.ensure(),Ge(()=>this.#l(t)))),this.#h>0?this.#v():(cn(this.#o,()=>{this.#o=null}),this.#e=!1)}))}#m(){var e=this.#t;return this.#e&&(this.#d=bt(),this.#t.before(this.#d),e=this.#d),e}is_pending(){return this.#e||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!this.#n.pending}#p(e){var t=q,i=z,s=ne;ct(this.#r),Oe(this.#r),un(this.#r.ctx);try{return e()}catch(r){return dr(r),null}finally{ct(t),Oe(i),un(s)}}#v(){const e=this.#n.pending;this.#s!==null&&(this.#c=document.createDocumentFragment(),this.#c.append(this.#d),Pr(this.#s,this.#c)),this.#o===null&&(this.#o=Ge(()=>e(this.#t)))}#_(e){if(!this.has_pending_snippet()){this.parent&&this.parent.#_(e);return}this.#h+=e,this.#h===0&&(this.#e=!1,this.#o&&cn(this.#o,()=>{this.#o=null}),this.#c&&(this.#t.before(this.#c),this.#c=null))}update_pending_count(e){this.#_(e),this.#u+=e,this.#f&&kn(this.#f,this.#u)}get_effect_pending(){return this.#y(),c(this.#f)}error(e){var t=this.#n.onerror;let i=this.#n.failed;if(this.#g||!t&&!i)throw e;this.#s&&(Le(this.#s),this.#s=null),this.#o&&(Le(this.#o),this.#o=null),this.#a&&(Le(this.#a),this.#a=null);var s=!1,r=!1;const o=()=>{if(s){Go();return}s=!0,r&&Lo(),at.ensure(),this.#u=0,this.#a!==null&&cn(this.#a,()=>{this.#a=null}),this.#e=this.has_pending_snippet(),this.#s=this.#p(()=>(this.#g=!1,Ge(()=>this.#l(this.#t)))),this.#h>0?this.#v():this.#e=!1};var l=z;try{Oe(null),r=!0,t?.(e,o),r=!1}catch(a){hn(a,this.#r&&this.#r.parent)}finally{Oe(l)}i&&Fn(()=>{this.#a=this.#p(()=>{at.ensure(),this.#g=!0;try{return Ge(()=>{i(this.#t,()=>e,()=>o)})}catch(a){return hn(a,this.#r.parent),null}finally{this.#g=!1}})})}}function Wt(n,e){return e}function na(n,e,t){for(var i=[],s=e.length,r=0;r<s;r++)ji(e[r].e,i,!0);kr(i,()=>{var o=i.length===0&&t!==null;if(o){var l=t,a=l.parentNode;Vo(a),a.append(l),n.items.clear(),rt(n,e[0].prev,e[s-1].next)}for(var d=0;d<s;d++){var u=e[d];o||(n.items.delete(u.k),rt(n,u.prev,u.next)),Le(u.e,!o)}n.first===e[0]&&(n.first=e[0].prev)})}function Mt(n,e,t,i,s,r=null){var o=n,l=new Map,a=null;{var d=n;o=d.appendChild(bt())}var u=null,h=fr(()=>{var v=t();return Ni(v)?v:v==null?[]:Bi(v)}),f,g=!0;function p(){ia(w,f,o,e,i),u!==null&&(f.length===0?(u.fragment?(o.before(u.fragment),u.fragment=null):qi(u.effect),_.first=u.effect):cn(u.effect,()=>{u=null}))}var _=gi(()=>{f=c(h);for(var v=f.length,E=new Set,A=se,x=null,m=cr(),y=0;y<v;y+=1){var b=f[y],D=i(b,y),T=g?null:l.get(D);T?(kn(T.v,b),T.i=y,m&&A.skipped_effects.delete(T.e)):(T=sa(g?o:null,x,b,D,y,s,e,t),g&&(T.o=!0,x===null?a=T:x.next=T,x=T),l.set(D,T)),E.add(D)}if(v===0&&r&&!u)if(g)u={fragment:null,effect:Ge(()=>r(o))};else{var N=document.createDocumentFragment(),C=bt();N.append(C),u={fragment:N,effect:Ge(()=>r(C))}}if(!g)if(m){for(const[$,I]of l)E.has($)||A.skipped_effects.add(I.e);A.oncommit(p),A.ondiscard(()=>{})}else p();c(h)}),w={effect:_,items:l,first:a};g=!1}function ia(n,e,t,i,s){var r=e.length,o=n.items,l=n.first,a,d=null,u=[],h=[],f,g,p,_;for(_=0;_<r;_+=1){if(f=e[_],g=s(f,_),p=o.get(g),n.first??=p,!p.o){p.o=!0;var w=d?d.next:l;rt(n,d,p),rt(n,p,w),wi(p,w,t),d=p,u=[],h=[],l=d.next;continue}if((p.e.f&Ze)!==0&&qi(p.e),p!==l){if(a!==void 0&&a.has(p)){if(u.length<h.length){var v=h[0],E;d=v.prev;var A=u[0],x=u[u.length-1];for(E=0;E<u.length;E+=1)wi(u[E],v,t);for(E=0;E<h.length;E+=1)a.delete(h[E]);rt(n,A.prev,x.next),rt(n,d,A),rt(n,x,v),l=v,d=x,_-=1,u=[],h=[]}else a.delete(p),wi(p,l,t),rt(n,p.prev,p.next),rt(n,p,d===null?n.first:d.next),rt(n,d,p),d=p;continue}for(u=[],h=[];l!==null&&l.k!==g;)(l.e.f&Ze)===0&&(a??=new Set).add(l),h.push(l),l=l.next;if(l===null)continue;p=l}u.push(p),d=p,l=p.next}if(l!==null||a!==void 0){for(var m=a===void 0?[]:Bi(a);l!==null;)(l.e.f&Ze)===0&&m.push(l),l=l.next;var y=m.length;if(y>0){var b=r===0?t:null;na(n,m,b)}}}function sa(n,e,t,i,s,r,o,l){var a=(o&Fo)!==0,d=(o&No)===0,u=a?d?Ui(t,!1,!1):Ut(t):t,h=(o&Xo)===0?s:Ut(s),f={i:h,v:u,k:i,a:null,e:null,o:!1,prev:e,next:null};try{if(n===null){var g=document.createDocumentFragment();g.append(n=bt())}return f.e=Ge(()=>r(n,u,h,l)),e!==null&&(e.next=f),f}finally{}}function wi(n,e,t){for(var i=n.next?n.next.e.nodes_start:t,s=e?e.e.nodes_start:t,r=n.e.nodes_start;r!==null&&r!==i;){var o=Xn(r);s.before(r),r=o}}function rt(n,e,t){e===null?(n.first=t,n.effect.first=t&&t.e):(e.e.next&&(e.e.next.prev=null),e.next=t,e.e.next=t&&t.e),t===null?n.effect.last=e&&e.e:(t.e.prev&&(t.e.prev.next=null),t.prev=e,t.e.prev=e&&e.e)}function ra(n,e,t,i){const s=Hn()?ui:fr;if(t.length===0&&n.length===0){i(e.map(s));return}var r=se,o=q,l=oa();function a(){Promise.all(t.map(d=>aa(d))).then(d=>{l();try{i([...e.map(s),...d])}catch(u){(o.f&Tt)===0&&hn(u,o)}r?.deactivate(),Jn()}).catch(d=>{hn(d,o)})}n.length>0?Promise.all(n).then(()=>{l();try{return a()}finally{r?.deactivate(),Jn()}}):a()}function oa(){var n=q,e=z,t=ne,i=se;return function(r=!0){ct(n),Oe(e),un(t),r&&i?.activate()}}function Jn(){ct(null),Oe(null),un(null)}function ui(n){var e=ve|He,t=z!==null&&(z.f&ve)!==0?z:null;return q!==null&&(q.f|=vn),{ctx:ne,deps:null,effects:null,equals:tr,f:e,fn:n,reactions:null,rv:0,v:ye,wv:0,parent:t??q,ac:null}}function aa(n,e){let t=q;t===null&&Do();var i=t.b,s=void 0,r=Ut(ye),o=!z,l=new Map;return ya(()=>{var a=Js();s=a.promise;try{Promise.resolve(n()).then(a.resolve,a.reject).then(()=>{d===se&&d.committed&&d.deactivate(),Jn()})}catch(f){a.reject(f),Jn()}var d=se;if(o){var u=!i.is_pending();i.update_pending_count(1),d.increment(u),l.get(d)?.reject(rn),l.delete(d),l.set(d,a)}const h=(f,g=void 0)=>{if(d.activate(),g)g!==rn&&(r.f|=At,kn(r,g));else{(r.f&At)!==0&&(r.f^=At),kn(r,f);for(const[p,_]of l){if(l.delete(p),p===d)break;_.reject(rn)}}o&&(i.update_pending_count(-1),d.decrement(u))};a.promise.then(h,f=>h(null,f||"unknown"))}),hi(()=>{for(const a of l.values())a.reject(rn)}),new Promise(a=>{function d(u){function h(){u===s?a(r):d(s)}u.then(h,h)}d(s)})}function X(n){const e=ui(n);return _r(e),e}function fr(n){const e=ui(n);return e.equals=ir,e}function gr(n){var e=n.effects;if(e!==null){n.effects=null;for(var t=0;t<e.length;t+=1)Le(e[t])}}function la(n){for(var e=n.parent;e!==null;){if((e.f&ve)===0)return(e.f&Tt)===0?e:null;e=e.parent}return null}function Ki(n){var e,t=q;ct(la(n));try{n.f&=~Gt,gr(n),e=Sr(n)}finally{ct(t)}return e}function pr(n){var e=Ki(n);if(n.equals(e)||(se?.is_fork||(n.v=e),n.wv=wr()),!mn)if(Ue!==null)(Pn()||se?.is_fork)&&Ue.set(n,e);else{var t=(n.f&Qe)===0?dt:ge;pe(n,t)}}let Pi=new Set;const Pt=new Map;let vr=!1;function Ut(n,e){var t={f:0,v:n,reactions:null,equals:tr,rv:0,wv:0};return t}function Y(n,e){const t=Ut(n);return _r(t),t}function Ui(n,e=!1,t=!0){const i=Ut(n);return e||(i.equals=ir),Rn&&t&&ne!==null&&ne.l!==null&&(ne.l.s??=[]).push(i),i}function P(n,e,t=!1){z!==null&&(!lt||(z.f&fs)!==0)&&Hn()&&(z.f&(ve|St|zi|fs))!==0&&!_t?.includes(n)&&Oo();let i=t?Ke(e):e;return kn(n,i)}function kn(n,e){if(!n.equals(e)){var t=n.v;mn?Pt.set(n,e):Pt.set(n,t),n.v=e;var i=at.ensure();i.capture(n,t),(n.f&ve)!==0&&((n.f&He)!==0&&Ki(n),pe(n,(n.f&Qe)!==0?ge:dt)),n.wv=wr(),mr(n,He),Hn()&&q!==null&&(q.f&ge)!==0&&(q.f&(Et|jt))===0&&(ze===null?da([n]):ze.push(n)),!i.is_fork&&Pi.size>0&&!vr&&ca()}return e}function ca(){vr=!1;var n=$t;Qn(!0);const e=Array.from(Pi);try{for(const t of e)(t.f&ge)!==0&&pe(t,dt),_n(t)&&fn(t)}finally{Qn(n)}Pi.clear()}function In(n){P(n,n.v+1)}function mr(n,e){var t=n.reactions;if(t!==null)for(var i=Hn(),s=t.length,r=0;r<s;r++){var o=t[r],l=o.f;if(!(!i&&o===q)){var a=(l&He)===0;if(a&&pe(o,e),(l&ve)!==0){var d=o;Ue?.delete(d),(l&Gt)===0&&(l&Qe&&(o.f|=Gt),mr(d,dt))}else a&&((l&St)!==0&&mt!==null&&mt.add(o),Kt(o))}}}function Vi(n){var e=z,t=q;Oe(null),ct(null);try{return n()}finally{Oe(e),ct(t)}}let $t=!1;function Qn(n){$t=n}let mn=!1;function ms(n){mn=n}let z=null,lt=!1;function Oe(n){z=n}let q=null;function ct(n){q=n}let _t=null;function _r(n){z!==null&&(_t===null?_t=[n]:_t.push(n))}let Me=null,Be=0,ze=null;function da(n){ze=n}let yr=1,Mn=0,Yt=Mn;function _s(n){Yt=n}function wr(){return++yr}function _n(n){var e=n.f;if((e&He)!==0)return!0;if(e&ve&&(n.f&=~Gt),(e&dt)!==0){var t=n.deps;if(t!==null)for(var i=t.length,s=0;s<i;s++){var r=t[s];if(_n(r)&&pr(r),r.wv>n.wv)return!0}(e&Qe)!==0&&Ue===null&&pe(n,ge)}return!1}function br(n,e,t=!0){var i=n.reactions;if(i!==null&&!_t?.includes(n))for(var s=0;s<i.length;s++){var r=i[s];(r.f&ve)!==0?br(r,e,!1):e===r&&(t?pe(r,He):(r.f&ge)!==0&&pe(r,dt),Kt(r))}}function Sr(n){var e=Me,t=Be,i=ze,s=z,r=_t,o=ne,l=lt,a=Yt,d=n.f;Me=null,Be=0,ze=null,z=(d&(Et|jt))===0?n:null,_t=null,un(n.ctx),lt=!1,Yt=++Mn,n.ac!==null&&(Vi(()=>{n.ac.abort(rn)}),n.ac=null);try{n.f|=ki;var u=n.fn,h=u(),f=n.deps;if(Me!==null){var g;if(ei(n,Be),f!==null&&Be>0)for(f.length=Be+Me.length,g=0;g<Me.length;g++)f[Be+g]=Me[g];else n.deps=f=Me;if($t&&Pn()&&(n.f&Qe)!==0)for(g=Be;g<f.length;g++)(f[g].reactions??=[]).push(n)}else f!==null&&Be<f.length&&(ei(n,Be),f.length=Be);if(Hn()&&ze!==null&&!lt&&f!==null&&(n.f&(ve|dt|He))===0)for(g=0;g<ze.length;g++)br(ze[g],n);return s!==null&&s!==n&&(Mn++,ze!==null&&(i===null?i=ze:i.push(...ze))),(n.f&At)!==0&&(n.f^=At),h}catch(p){return dr(p)}finally{n.f^=ki,Me=e,Be=t,ze=i,z=s,_t=r,un(o),lt=l,Yt=a}}function ua(n,e){let t=e.reactions;if(t!==null){var i=wo.call(t,n);if(i!==-1){var s=t.length-1;s===0?t=e.reactions=null:(t[i]=t[s],t.pop())}}t===null&&(e.f&ve)!==0&&(Me===null||!Me.includes(e))&&(pe(e,dt),(e.f&Qe)!==0&&(e.f^=Qe,e.f&=~Gt),gr(e),ei(e,0))}function ei(n,e){var t=n.deps;if(t!==null)for(var i=e;i<t.length;i++)ua(n,t[i])}function fn(n){var e=n.f;if((e&Tt)===0){pe(n,ge);var t=q,i=$t;q=n,$t=!0;try{(e&(St|Io))!==0?wa(n):Tr(n),Dr(n);var s=Sr(n);n.teardown=typeof s=="function"?s:null,n.wv=yr;var r;Ai&&Ro&&(n.f&He)!==0&&n.deps}finally{$t=i,q=t}}}function c(n){var e=n.f,t=(e&ve)!==0;if(z!==null&&!lt){var i=q!==null&&(q.f&Tt)!==0;if(!i&&!_t?.includes(n)){var s=z.deps;if((z.f&ki)!==0)n.rv<Mn&&(n.rv=Mn,Me===null&&s!==null&&s[Be]===n?Be++:Me===null?Me=[n]:Me.includes(n)||Me.push(n));else{(z.deps??=[]).push(n);var r=n.reactions;r===null?n.reactions=[z]:r.includes(z)||r.push(z)}}}if(mn){if(Pt.has(n))return Pt.get(n);if(t){var o=n,l=o.v;return((o.f&ge)===0&&o.reactions!==null||xr(o))&&(l=Ki(o)),Pt.set(o,l),l}}else t&&(!Ue?.has(n)||se?.is_fork&&!Pn())&&(o=n,_n(o)&&pr(o),$t&&Pn()&&(o.f&Qe)===0&&Er(o));if(Ue?.has(n))return Ue.get(n);if((n.f&At)!==0)throw n.v;return n.v}function Er(n){if(n.deps!==null){n.f^=Qe;for(const e of n.deps)(e.reactions??=[]).push(n),(e.f&ve)!==0&&(e.f&Qe)===0&&Er(e)}}function xr(n){if(n.v===ye)return!0;if(n.deps===null)return!1;for(const e of n.deps)if(Pt.has(e)||(e.f&ve)!==0&&xr(e))return!0;return!1}function Lt(n){var e=lt;try{return lt=!0,n()}finally{lt=e}}const ha=-7169;function pe(n,e){n.f=n.f&ha|e}function fa(n){if(!(typeof n!="object"||!n||n instanceof EventTarget)){if(kt in n)$i(n);else if(!Array.isArray(n))for(let e in n){const t=n[e];typeof t=="object"&&t&&kt in t&&$i(t)}}}function $i(n,e=new Set){if(typeof n=="object"&&n!==null&&!(n instanceof EventTarget)&&!e.has(n)){e.add(n),n instanceof Date&&n.getTime();for(let i in n)try{$i(n[i],e)}catch{}const t=Zi(n);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const i=qs(t);for(let s in i){const r=i[s].get;if(r)try{r.call(n)}catch{}}}}}function Ir(n){q===null&&(z===null&&ko(),Ao()),mn&&To()}function ga(n,e){var t=e.last;t===null?e.last=e.first=n:(t.next=n,n.prev=t,e.last=n)}function ut(n,e,t){var i=q;i!==null&&(i.f&Ze)!==0&&(n|=Ze);var s={ctx:ne,deps:null,nodes_start:null,nodes_end:null,f:n|He|Qe,first:null,fn:e,last:null,next:null,parent:i,b:i&&i.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(t)try{fn(s),s.f|=Yi}catch(l){throw Le(s),l}else e!==null&&Kt(s);var r=s;if(t&&r.deps===null&&r.teardown===null&&r.nodes_start===null&&r.first===r.last&&(r.f&vn)===0&&(r=r.first,(n&St)!==0&&(n&zt)!==0&&r!==null&&(r.f|=zt)),r!==null&&(r.parent=i,i!==null&&ga(r,i),z!==null&&(z.f&ve)!==0&&(n&jt)===0)){var o=z;(o.effects??=[]).push(r)}return s}function Pn(){return z!==null&&!lt}function hi(n){const e=ut(ci,null,!1);return pe(e,ge),e.teardown=n,e}function Se(n){Ir();var e=q.f,t=!z&&(e&Et)!==0&&(e&Yi)===0;if(t){var i=ne;(i.e??=[]).push(n)}else return Cr(n)}function Cr(n){return ut(Wi|er,n,!1)}function pa(n){return Ir(),ut(ci|er,n,!0)}function va(n){at.ensure();const e=ut(jt|vn,n,!0);return(t={})=>new Promise(i=>{t.outro?cn(e,()=>{Le(e),i(void 0)}):(Le(e),i(void 0))})}function ma(n){return ut(Wi,n,!1)}function ys(n,e){var t=ne,i={effect:null,ran:!1,deps:n};t.l.$.push(i),i.effect=fi(()=>{n(),!i.ran&&(i.ran=!0,Lt(e))})}function _a(){var n=ne;fi(()=>{for(var e of n.l.$){e.deps();var t=e.effect;(t.f&ge)!==0&&pe(t,dt),_n(t)&&fn(t),e.ran=!1}})}function ya(n){return ut(zi|vn,n,!0)}function fi(n,e=0){return ut(ci|e,n,!0)}function G(n,e=[],t=[],i=[]){ra(i,e,t,s=>{ut(ci,()=>n(...s.map(c)),!0)})}function gi(n,e=0){var t=ut(St|e,n,!0);return t}function Ge(n){return ut(Et|vn,n,!0)}function Dr(n){var e=n.teardown;if(e!==null){const t=mn,i=z;ms(!0),Oe(null);try{e.call(null)}finally{ms(t),Oe(i)}}}function Tr(n,e=!1){var t=n.first;for(n.first=n.last=null;t!==null;){const s=t.ac;s!==null&&Vi(()=>{s.abort(rn)});var i=t.next;(t.f&jt)!==0?t.parent=null:Le(t,e),t=i}}function wa(n){for(var e=n.first;e!==null;){var t=e.next;(e.f&Et)===0&&Le(e),e=t}}function Le(n,e=!0){var t=!1;(e||(n.f&Qs)!==0)&&n.nodes_start!==null&&n.nodes_end!==null&&(ba(n.nodes_start,n.nodes_end),t=!0),Tr(n,e&&!t),ei(n,0),pe(n,Tt);var i=n.transitions;if(i!==null)for(const r of i)r.stop();Dr(n);var s=n.parent;s!==null&&s.first!==null&&Ar(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes_start=n.nodes_end=n.ac=null}function ba(n,e){for(;n!==null;){var t=n===e?null:Xn(n);n.remove(),n=t}}function Ar(n){var e=n.parent,t=n.prev,i=n.next;t!==null&&(t.next=i),i!==null&&(i.prev=t),e!==null&&(e.first===n&&(e.first=i),e.last===n&&(e.last=t))}function cn(n,e,t=!0){var i=[];ji(n,i,!0),kr(i,()=>{t&&Le(n),e&&e()})}function kr(n,e){var t=n.length;if(t>0){var i=()=>--t||e();for(var s of n)s.out(i)}else e()}function ji(n,e,t){if((n.f&Ze)===0){if(n.f^=Ze,n.transitions!==null)for(const o of n.transitions)(o.is_global||t)&&e.push(o);for(var i=n.first;i!==null;){var s=i.next,r=(i.f&zt)!==0||(i.f&Et)!==0&&(n.f&St)!==0;ji(i,e,r?t:!1),i=s}}}function qi(n){Mr(n,!0)}function Mr(n,e){if((n.f&Ze)!==0){n.f^=Ze,(n.f&ge)===0&&(pe(n,He),Kt(n));for(var t=n.first;t!==null;){var i=t.next,s=(t.f&zt)!==0||(t.f&Et)!==0;Mr(t,s?e:!1),t=i}if(n.transitions!==null)for(const r of n.transitions)(r.is_global||e)&&r.in()}}function Pr(n,e){for(var t=n.nodes_start,i=n.nodes_end;t!==null;){var s=t===i?null:Xn(t);e.append(t),t=s}}const Sa=["touchstart","touchmove"];function Ea(n){return Sa.includes(n)}const $r=new Set,Oi=new Set;function xa(n,e,t,i={}){function s(r){if(i.capture||bn.call(e,r),!r.cancelBubble)return Vi(()=>t?.call(this,r))}return n.startsWith("pointer")||n.startsWith("touch")||n==="wheel"?Fn(()=>{e.addEventListener(n,s,i)}):e.addEventListener(n,s,i),s}function Ot(n,e,t,i,s){var r={capture:i,passive:s},o=xa(n,e,t,r);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&hi(()=>{e.removeEventListener(n,o,r)})}function et(n){for(var e=0;e<n.length;e++)$r.add(n[e]);for(var t of Oi)t(n)}let ws=null;function bn(n){var e=this,t=e.ownerDocument,i=n.type,s=n.composedPath?.()||[],r=s[0]||n.target;ws=n;var o=0,l=ws===n&&n.__root;if(l){var a=s.indexOf(l);if(a!==-1&&(e===document||e===window)){n.__root=e;return}var d=s.indexOf(e);if(d===-1)return;a<=d&&(o=a)}if(r=s[o]||n.target,r!==e){js(n,"currentTarget",{configurable:!0,get(){return r||t}});var u=z,h=q;Oe(null),ct(null);try{for(var f,g=[];r!==null;){var p=r.assignedSlot||r.parentNode||r.host||null;try{var _=r["__"+i];_!=null&&(!r.disabled||n.target===r)&&_.call(r,n)}catch(w){f?g.push(w):f=w}if(n.cancelBubble||p===e||p===null)break;r=p}if(f){for(let w of g)queueMicrotask(()=>{throw w});throw f}}finally{n.__root=e,delete n.currentTarget,Oe(u),ct(h)}}}function Ia(n){var e=document.createElement("template");return e.innerHTML=n.replaceAll("<!>","<!---->"),e.content}function ti(n,e){var t=q;t.nodes_start===null&&(t.nodes_start=n,t.nodes_end=e)}function F(n,e){var t=(e&Bo)!==0,i=(e&Zo)!==0,s,r=!n.startsWith("<!>");return()=>{s===void 0&&(s=Ia(r?n:"<!>"+n),t||(s=qn(s)));var o=i||or?document.importNode(s,!0):s.cloneNode(!0);if(t){var l=qn(o),a=o.lastChild;ti(l,a)}else ti(o,o);return o}}function re(n=""){{var e=bt(n+"");return ti(e,e),e}}function Ee(){var n=document.createDocumentFragment(),e=document.createComment(""),t=bt();return n.append(e,t),ti(e,t),n}function S(n,e){n!==null&&n.before(e)}function xe(n,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(n.__t??=n.nodeValue)&&(n.__t=t,n.nodeValue=t+"")}function Ca(n,e){return Da(n,e)}const en=new Map;function Da(n,{target:e,anchor:t,props:i={},events:s,context:r,intro:o=!0}){Uo();var l=new Set,a=h=>{for(var f=0;f<h.length;f++){var g=h[f];if(!l.has(g)){l.add(g);var p=Ea(g);e.addEventListener(g,bn,{passive:p});var _=en.get(g);_===void 0?(document.addEventListener(g,bn,{passive:p}),en.set(g,1)):en.set(g,_+1)}}};a(Bi($r)),Oi.add(a);var d=void 0,u=va(()=>{var h=t??e.appendChild(bt());return ea(h,{pending:()=>{}},f=>{if(r){ue({});var g=ne;g.c=r}s&&(i.$$events=s),d=n(f,i)||{},r&&he()}),()=>{for(var f of l){e.removeEventListener(f,bn);var g=en.get(f);--g===0?(document.removeEventListener(f,bn),en.delete(f)):en.set(f,g)}Oi.delete(a),h!==t&&h.parentNode?.removeChild(h)}});return Ta.set(d,u),d}let Ta=new WeakMap;class Or{anchor;#e=new Map;#t=new Map;#i=new Map;#n=new Set;#l=!0;constructor(e,t=!0){this.anchor=e,this.#l=t}#r=()=>{var e=se;if(this.#e.has(e)){var t=this.#e.get(e),i=this.#t.get(t);if(i)qi(i),this.#n.delete(t);else{var s=this.#i.get(t);s&&(this.#t.set(t,s.effect),this.#i.delete(t),s.fragment.lastChild.remove(),this.anchor.before(s.fragment),i=s.effect)}for(const[r,o]of this.#e){if(this.#e.delete(r),r===e)break;const l=this.#i.get(o);l&&(Le(l.effect),this.#i.delete(o))}for(const[r,o]of this.#t){if(r===t||this.#n.has(r))continue;const l=()=>{if(Array.from(this.#e.values()).includes(r)){var d=document.createDocumentFragment();Pr(o,d),d.append(bt()),this.#i.set(r,{effect:o,fragment:d})}else Le(o);this.#n.delete(r),this.#t.delete(r)};this.#l||!i?(this.#n.add(r),cn(o,l,!1)):l()}}};#s=e=>{this.#e.delete(e);const t=Array.from(this.#e.values());for(const[i,s]of this.#i)t.includes(i)||(Le(s.effect),this.#i.delete(i))};ensure(e,t){var i=se,s=cr();if(t&&!this.#t.has(e)&&!this.#i.has(e))if(s){var r=document.createDocumentFragment(),o=bt();r.append(o),this.#i.set(e,{effect:Ge(()=>t(o)),fragment:r})}else this.#t.set(e,Ge(()=>t(this.anchor)));if(this.#e.set(i,e),s){for(const[l,a]of this.#t)l===e?i.skipped_effects.delete(a):i.skipped_effects.add(a);for(const[l,a]of this.#i)l===e?i.skipped_effects.delete(a.effect):i.skipped_effects.add(a.effect);i.oncommit(this.#r),i.ondiscard(this.#s)}else this.#r()}}function K(n,e,t=!1){var i=new Or(n),s=t?zt:0;function r(o,l){i.ensure(o,l)}gi(()=>{var o=!1;e((l,a=!0)=>{o=!0,r(a,l)}),o||r(!1,null)},s)}function gn(n,e,...t){var i=new Or(n);gi(()=>{const s=e()??null;i.ensure(s,s&&(r=>s(r,...t)))},zt)}const bs=[...` 	
\r\fÂ \v\uFEFF`];function Aa(n,e,t){var i=n==null?"":""+n;if(e&&(i=i?i+" "+e:e),t){for(var s in t)if(t[s])i=i?i+" "+s:s;else if(i.length)for(var r=s.length,o=0;(o=i.indexOf(s,o))>=0;){var l=o+r;(o===0||bs.includes(i[o-1]))&&(l===i.length||bs.includes(i[l]))?i=(o===0?"":i.substring(0,o))+i.substring(l+1):o=l}}return i===""?null:i}function Ss(n,e=!1){var t=e?" !important;":";",i="";for(var s in n){var r=n[s];r!=null&&r!==""&&(i+=" "+s+": "+r+t)}return i}function bi(n){return n[0]!=="-"||n[1]!=="-"?n.toLowerCase():n}function ka(n,e){if(e){var t="",i,s;if(Array.isArray(e)?(i=e[0],s=e[1]):i=e,n){n=String(n).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var r=!1,o=0,l=!1,a=[];i&&a.push(...Object.keys(i).map(bi)),s&&a.push(...Object.keys(s).map(bi));var d=0,u=-1;const _=n.length;for(var h=0;h<_;h++){var f=n[h];if(l?f==="/"&&n[h-1]==="*"&&(l=!1):r?r===f&&(r=!1):f==="/"&&n[h+1]==="*"?l=!0:f==='"'||f==="'"?r=f:f==="("?o++:f===")"&&o--,!l&&r===!1&&o===0){if(f===":"&&u===-1)u=h;else if(f===";"||h===_-1){if(u!==-1){var g=bi(n.substring(d,u).trim());if(!a.includes(g)){f!==";"&&h++;var p=n.substring(d,h).trim();t+=" "+p+";"}}d=h+1,u=-1}}}}return i&&(t+=Ss(i)),s&&(t+=Ss(s,!0)),t=t.trim(),t===""?null:t}return n==null?null:String(n)}function Pe(n,e,t,i,s,r){var o=n.__className;if(o!==t||o===void 0){var l=Aa(t,i,r);l==null?n.removeAttribute("class"):n.className=l,n.__className=t}else if(r&&s!==r)for(var a in r){var d=!!r[a];(s==null||d!==!!s[a])&&n.classList.toggle(a,d)}return r}function Si(n,e={},t,i){for(var s in t){var r=t[s];e[s]!==r&&(t[s]==null?n.style.removeProperty(s):n.style.setProperty(s,r,i))}}function ce(n,e,t,i){var s=n.__style;if(s!==e){var r=ka(e,i);r==null?n.removeAttribute("style"):n.style.cssText=r,n.__style=e}else i&&(Array.isArray(i)?(Si(n,t?.[0],i[0]),Si(n,t?.[1],i[1],"important")):Si(n,t,i));return i}function Lr(n,e,t=!1){if(n.multiple){if(e==null)return;if(!Ni(e))return zo();for(var i of n.options)i.selected=e.includes(Es(i));return}for(i of n.options){var s=Es(i);if(Ko(s,e)){i.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function Ma(n){var e=new MutationObserver(()=>{Lr(n,n.__value)});e.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),hi(()=>{e.disconnect()})}function Es(n){return"__value"in n?n.__value:n.value}const Pa=Symbol("is custom element"),$a=Symbol("is html");function ni(n,e){var t=Rr(n);t.value===(t.value=e??void 0)||n.value===e&&(e!==0||n.nodeName!=="PROGRESS")||(n.value=e??"")}function te(n,e,t,i){var s=Rr(n);s[e]!==(s[e]=t)&&(e==="loading"&&(n[Co]=t),t==null?n.removeAttribute(e):typeof t!="string"&&Oa(n).includes(e)?n[e]=t:n.setAttribute(e,t))}function Rr(n){return n.__attributes??={[Pa]:n.nodeName.includes("-"),[$a]:n.namespaceURI===Wo}}var xs=new Map;function Oa(n){var e=n.getAttribute("is")||n.nodeName,t=xs.get(e);if(t)return t;xs.set(e,t=[]);for(var i,s=n,r=Element.prototype;r!==s;){i=qs(s);for(var o in i)i[o].set&&t.push(o);s=Zi(s)}return t}function Is(n,e){return n===e||n?.[kt]===e}function pn(n={},e,t,i){return ma(()=>{var s,r;return fi(()=>{s=r,r=[],Lt(()=>{n!==t(...r)&&(e(n,...r),s&&Is(t(...s),n)&&e(null,...s))})}),()=>{Fn(()=>{r&&Is(t(...r),n)&&e(null,...r)})}}),n}function La(n=!1){const e=ne,t=e.l.u;if(!t)return;let i=()=>fa(e.s);if(n){let s=0,r={};const o=ui(()=>{let l=!1;const a=e.s;for(const d in a)a[d]!==r[d]&&(r[d]=a[d],l=!0);return l&&s++,s});i=()=>c(o)}t.b.length&&pa(()=>{Cs(e,i),jn(t.b)}),Se(()=>{const s=Lt(()=>t.m.map(Eo));return()=>{for(const r of s)typeof r=="function"&&r()}}),t.a.length&&Se(()=>{Cs(e,i),jn(t.a)})}function Cs(n,e){if(n.l.s)for(const t of n.l.s)c(t);e()}let Li=Symbol();function L(n,e,t){const i=t[e]??={store:null,source:Ui(void 0),unsubscribe:je};if(i.store!==n&&!(Li in t))if(i.unsubscribe(),i.store=n??null,n==null)i.source.v=void 0,i.unsubscribe=je;else{var s=!0;i.unsubscribe=Ji(n,r=>{s?i.source.v=r:P(i.source,r)}),s=!1}return n&&Li in t?pi(n):c(i.source)}function Ie(){const n={};function e(){hi(()=>{for(var t in n)n[t].unsubscribe();js(n,Li,{enumerable:!1,value:!0})})}return[n,e]}function ee(n,e,t,i){var s=i,r=!0,o=()=>(r&&(r=!1,s=i),s),l;l=n[e],l===void 0&&i!==void 0&&(l=o());var a;return a=()=>{var d=n[e];return d===void 0?o():(r=!0,d)},a}function Nn(n){ne===null&&sr(),Rn&&ne.l!==null?Ha(ne).m.push(n):Se(()=>{const e=Lt(n);if(typeof e=="function")return e})}function Ra(n){ne===null&&sr(),Nn(()=>()=>Lt(n))}function Ha(n){var e=n.l;return e.u??={a:[],b:[],m:[]}}function Ji(n,e,t){if(n==null)return e(void 0),t&&t(void 0),je;const i=Lt(()=>n.subscribe(e,t));return i.unsubscribe?()=>i.unsubscribe():i}const tn=[];function Fa(n,e){return{subscribe:J(n,e).subscribe}}function J(n,e=je){let t=null;const i=new Set;function s(l){if(nr(n,l)&&(n=l,t)){const a=!tn.length;for(const d of i)d[1](),tn.push(d,n);if(a){for(let d=0;d<tn.length;d+=2)tn[d][0](tn[d+1]);tn.length=0}}}function r(l){s(l(n))}function o(l,a=je){const d=[l,a];return i.add(d),i.size===1&&(t=e(s,r)||je),l(n),()=>{i.delete(d),i.size===0&&t&&(t(),t=null)}}return{set:s,update:r,subscribe:o}}function Fe(n,e,t){const i=!Array.isArray(n),s=i?[n]:n;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const r=e.length<2;return Fa(t,(o,l)=>{let a=!1;const d=[];let u=0,h=je;const f=()=>{if(u)return;h();const p=e(i?d[0]:d,o,l);r?o(p):h=typeof p=="function"?p:je},g=s.map((p,_)=>Ji(p,w=>{d[_]=w,u&=~(1<<_),a&&f()},()=>{u|=1<<_}));return a=!0,f(),function(){jn(g),h(),a=!1}})}function pi(n){let e;return Ji(n,t=>e=t)(),e}function Xa(){return`zone_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const Ri=["#e74c3c","#e67e22","#f1c40f","#2ecc71","#1abc9c","#3498db","#9b59b6","#e91e8f"];function Na(){return Ri[Math.floor(Math.random()*Ri.length)]}function Ba(n,e=200){return{id:Xa(),x:n,width:e,color:Na(),texts:[{language:"cs",title:"",content:""}]}}function Za(n,e){const t=n.texts.find(i=>i.language===e);return t||n.texts[0]||null}const $n=J("cs"),Wa=J("orange"),Ya=J("Forest"),Hi=J(!1),Sn=J(!1),Hr=J(!1),Fr=J(!1),Xr=J(null),za=Fe([Xr,$n],([n,e])=>n?Za(n,e):null);function Ei(n){Xr.set(n)}const Nr=J({x:0,y:0});function Ga(n,e){Nr.set({x:n,y:e})}const Br=J({scrollX:0,scrollY:0,zoom:1});function Ka(n,e,t=1){Br.set({scrollX:n,scrollY:e,zoom:t})}const Fi=J(!1);function Ua(){Fi.set(!0),setTimeout(()=>Fi.set(!1),150)}const We={BACKGROUND_BASE:-100,BACKGROUND_LAYER_START:-99,GROUND_REFERENCE:-1,ITEMS_BEHIND:5,PLAYER:10,ITEMS_FRONT:15,SELECTION_GRAPHICS:999,GRID_OVERLAY:1e3};function Qi(n){return n==="behind"?We.ITEMS_BEHIND:We.ITEMS_FRONT}const pt=["orange","white"];class Va{currentSkin=pt[0];currentIndex=0;setSkin(e){pt.includes(e)&&(this.currentSkin=e,this.currentIndex=pt.indexOf(e),localStorage.setItem("catSkin",e))}getSkin(){const e=localStorage.getItem("catSkin");return e&&pt.includes(e)&&(this.currentSkin=e,this.currentIndex=pt.indexOf(e)),this.currentSkin}toggleSkin(){return this.currentIndex=(this.currentIndex+1)%pt.length,this.currentSkin=pt[this.currentIndex],this.setSkin(this.currentSkin),this.currentSkin}getAllSkins(){return pt}}const Zr=new Va,ja={FAST_VELOCITY_THRESHOLD:100,ROTATION_FULL:15,ROTATION_SLIGHT:8};class qa{scene;currentSkin;constructor(e,t="white"){this.scene=e,this.currentSkin=t}createAll(){Zr.getAllSkins().forEach(t=>{this.createAnimationsForSkin(t)})}createAnimationsForSkin(e){const t=this.scene;t.anims.exists(`cat-idle-${e}`)||t.anims.create({key:`cat-idle-${e}`,frames:t.anims.generateFrameNumbers(`cat-idle-${e}`,{start:0,end:3}),frameRate:6,repeat:-1}),t.anims.exists(`cat-walk-${e}`)||t.anims.create({key:`cat-walk-${e}`,frames:t.anims.generateFrameNumbers(`cat-walk-${e}`,{start:0,end:5}),frameRate:12,repeat:-1}),[{key:`cat-jump-up-${e}`,frame:2},{key:`cat-jump-peak-up-${e}`,frame:3},{key:`cat-jump-peak-down-${e}`,frame:3},{key:`cat-jump-down-${e}`,frame:4}].forEach(({key:s,frame:r})=>{t.anims.exists(s)||t.anims.create({key:s,frames:[{key:`cat-walk-${e}`,frame:r}],frameRate:1,repeat:0})})}getSkin(){return this.currentSkin}setSkin(e){this.currentSkin=e}getAnimationKey(e){return`cat-${e}-${this.currentSkin}`}play(e,t){const i=this.getAnimationKey(t);e.anims.currentAnim?.key!==i&&e.play(i)}getJumpAnimationState(e){const{FAST_VELOCITY_THRESHOLD:t,ROTATION_FULL:i,ROTATION_SLIGHT:s}=ja;return e<-t?{animation:this.getAnimationKey("jump-up"),rotation:i,flipMultiplier:1}:e<-20?{animation:this.getAnimationKey("jump-peak-up"),rotation:s,flipMultiplier:1}:e<=t?{animation:this.getAnimationKey("jump-peak-down"),rotation:s,flipMultiplier:-1}:{animation:this.getAnimationKey("jump-down"),rotation:i,flipMultiplier:-1}}handleSkinChange(e,t){const i=this.currentSkin;this.currentSkin=t;const s=e.anims.currentAnim?.key;if(s){const o=`cat-${s.replace("cat-","").replace(`-${i}`,"")}-${t}`;this.scene.anims.exists(o)&&e.play(o)}}}let Wr=!1,nn=!1;function Zn(n){Wr=n}function Ds(){return Wr}function Vt(){return nn}function xi(n){if(!n||n.tagName==="CANVAS")return!1;if(n.closest("[data-ui]"))return!0;const e=document.getElementById("game-ui");return!!(e&&e.contains(n)||n.closest("button"))}function Ja(){document.addEventListener("pointerdown",n=>{nn=xi(n.target)},{capture:!0}),document.addEventListener("pointermove",n=>{n.buttons>0||(nn=xi(n.target))},{capture:!0}),document.addEventListener("pointerup",()=>{setTimeout(()=>{nn=!1},10)},{capture:!0}),document.addEventListener("touchstart",n=>{nn=xi(n.target)},{capture:!0,passive:!0}),document.addEventListener("touchend",()=>{setTimeout(()=>{nn=!1},10)},{capture:!0,passive:!0})}function Cn(){const n=document.activeElement;if(!n)return!1;const e=n.tagName.toUpperCase();return e==="INPUT"||e==="TEXTAREA"||n.getAttribute("contenteditable")==="true"}function an(n,e,t){const i=(n-t.worldView.x)*t.zoom,s=(e-t.worldView.y)*t.zoom;return{screenX:i,screenY:s}}function Qa(n,e,t){const i=n/t.zoom+t.worldView.x,s=e/t.zoom+t.worldView.y;return{worldX:i,worldY:s}}const Xt={THRESHOLD_X:20,LANGUAGE_BUTTON:{width:120,height:60},SKIN_BUTTON:{width:120,height:60,yOffset:60}},Ts={SPEED:350,JUMP_STRENGTH:-500};class el{scene;getPlayerPosition;keyUp;keyLeft;keyRight;keyA;keyD;keyW;keySpace;touchLeft=!1;touchRight=!1;touchJump=!1;touchHandlers;constructor(e){this.scene=e.scene,this.getPlayerPosition=e.getPlayerPosition,this.setupKeyboardControls(),this.setupTouchControls()}setupKeyboardControls(){this.scene.input.keyboard&&(this.keyUp=this.scene.input.keyboard.addKey(W.Input.Keyboard.KeyCodes.UP,!1),this.keyLeft=this.scene.input.keyboard.addKey(W.Input.Keyboard.KeyCodes.LEFT,!1),this.keyRight=this.scene.input.keyboard.addKey(W.Input.Keyboard.KeyCodes.RIGHT,!1),this.keyA=this.scene.input.keyboard.addKey(W.Input.Keyboard.KeyCodes.A,!1),this.keyD=this.scene.input.keyboard.addKey(W.Input.Keyboard.KeyCodes.D,!1),this.keyW=this.scene.input.keyboard.addKey(W.Input.Keyboard.KeyCodes.W,!1),this.keySpace=this.scene.input.keyboard.addKey(W.Input.Keyboard.KeyCodes.SPACE,!1))}setupTouchControls(){const e=this.scene,t=o=>{if(pi(Fi)){this.touchLeft=!1,this.touchRight=!1,this.touchJump=!1;return}const l=o.x,a=o.y,d=e.scale.width;if(l>d-Xt.LANGUAGE_BUTTON.width&&a<Xt.LANGUAGE_BUTTON.height||l>d-Xt.SKIN_BUTTON.width&&a>=Xt.SKIN_BUTTON.yOffset&&a<Xt.SKIN_BUTTON.yOffset+Xt.SKIN_BUTTON.height)return;const u=e.cameras.main,h=this.getPlayerPosition(),f=h.x-u.scrollX,g=h.y-u.scrollY,p=l-f,_=a-g;p<-20?(this.touchLeft=!0,this.touchRight=!1):p>Xt.THRESHOLD_X?(this.touchRight=!0,this.touchLeft=!1):(this.touchLeft=!1,this.touchRight=!1),this.touchJump=_<-80},i=o=>{Vt()||t(o)},s=o=>{Vt()||o.isDown&&t(o)},r=()=>{this.touchLeft=!1,this.touchRight=!1,this.touchJump=!1};e.input.on("pointerdown",i),e.input.on("pointermove",s),e.input.on("pointerup",r),this.touchHandlers={pointerdown:i,pointermove:s,pointerup:r}}getInputState(){const e=this.keyA?.isDown||this.keyLeft?.isDown||this.touchLeft||!1,t=this.keyD?.isDown||this.keyRight?.isDown||this.touchRight||!1,i=this.keySpace?.isDown||this.keyW?.isDown||this.keyUp?.isDown||this.touchJump||!1;return{left:e,right:t,jump:i}}hasAnyInput(){const e=this.getInputState();return e.left||e.right||e.jump}destroy(){this.touchHandlers&&(this.scene.input.off("pointerdown",this.touchHandlers.pointerdown),this.scene.input.off("pointermove",this.touchHandlers.pointermove),this.scene.input.off("pointerup",this.touchHandlers.pointerup),this.touchHandlers=void 0)}}class tl extends W.Physics.Arcade.Sprite{animations;inputController;animState="idle";hasNotifiedMovement=!1;hasReceivedInput=!1;constructor(e,t,i){const s="white";super(e,t,i,`cat-idle-${s}`),e.add.existing(this),e.physics.add.existing(this),this.animations=new qa(e,s),this.animations.createAll(),this.inputController=new el({scene:e,getPlayerPosition:()=>({x:this.x,y:this.y})}),this.setCollideWorldBounds(!0),this.setBounce(0),this.setSize(16,12),this.setOffset(16,36),this.setScale(5),this.setDepth(We.PLAYER),this.animations.play(this,"idle")}changeSkin(e){this.animations.handleSkinChange(this,e)}updateJumpAnimation(e){const{animation:t,rotation:i,flipMultiplier:s}=this.animations.getJumpAnimationState(e);this.anims.currentAnim?.key!==t&&this.play(t);const r=this.flipX?i*s:-i*s;this.setAngle(r)}update(){const e=this.inputController.getInputState(),t=this.body,i=t&&(t.blocked.down||t.touching.down);switch(this.inputController.hasAnyInput()&&!this.hasReceivedInput&&(this.hasReceivedInput=!0),this.hasReceivedInput&&this.inputController.hasAnyInput()&&!this.hasNotifiedMovement&&(this.hasNotifiedMovement=!0,Fr.set(!0)),e.left?(this.setVelocityX(-350),this.setFlipX(!0),i&&(this.animState="running")):e.right?(this.setVelocityX(Ts.SPEED),this.setFlipX(!1),i&&(this.animState="running")):(this.setVelocityX(0),i&&(this.animState="idle")),e.jump&&i&&(this.setVelocityY(Ts.JUMP_STRENGTH),this.animState="jumping"),!i&&t&&t.velocity.y!==0&&(this.animState="jumping"),this.animState){case"idle":this.animations.play(this,"idle"),this.setAngle(0);break;case"running":this.animations.play(this,"walk"),this.setAngle(0);break;case"jumping":this.updateJumpAnimation(t.velocity.y);break}}destroy(e){this.inputController.destroy(),super.destroy(e)}}const Nt=[{name:"FOREST",folder:"forest",scrollFactors:[1,.8,.85,.9,.95,1]},{name:"FOREST BLUE",folder:"forest_blue",scrollFactors:[1,.8,.85,.9,.95,1]}];class nl{currentIndex=0;constructor(){const e=localStorage.getItem("background");if(e){const t=Nt.findIndex(i=>i.folder===e);t!==-1&&(this.currentIndex=t)}}getBackground(){return Nt[this.currentIndex].folder}getCurrentConfig(){return Nt[this.currentIndex]}setBackground(e){const t=Nt.findIndex(i=>i.folder===e);t!==-1&&(this.currentIndex=t,localStorage.setItem("background",e))}toggleBackground(){this.currentIndex=(this.currentIndex+1)%Nt.length;const e=Nt[this.currentIndex];return localStorage.setItem("background",e.folder),e}getAllBackgrounds(){return Nt}}const ii=new nl;function Yr(n,e){return new Promise(t=>{n.load.image(`bg0-${e.folder}`,`assets/backgrounds/${e.folder}/0.png`);for(let i=0;i<e.scrollFactors.length;i++){const s=i+1;n.load.image(`bg${s}-${e.folder}`,`assets/backgrounds/${e.folder}/${s}.png`)}n.load.once("complete",()=>{t(!0)}),n.load.once("loaderror",i=>{console.error(`Failed to load background asset: ${i.key}`),t(!1)}),n.load.start()})}function zr(n,e,t,i){const s=Math.max(t,n.scale.height),r=n.add.tileSprite(0,0,e,s,`bg0-${i.folder}`);r.setOrigin(0,0),r.setScrollFactor(1),r.setDepth(We.BACKGROUND_BASE),r.tilePositionX=0,r.tilePositionY=0;const o=[];for(let l=0;l<i.scrollFactors.length;l++){const d=`bg${l+1}-${i.folder}`;if(n.textures.exists(d)){const u=n.add.image(0,0,d);u.setOrigin(0,0),u.setScrollFactor(i.scrollFactors[l]),u.setDepth(We.BACKGROUND_LAYER_START+l),u.setDisplaySize(e,t),o.push(u)}}return{baseLayer:r,bgLayers:o}}function Gr(n,e){n&&(n.tilePositionX=e.scrollX)}function il(n){n.bgLayers.forEach(e=>e.destroy()),n.baseLayer.destroy()}const sl=[{code:"cs",label:"CZ"},{code:"en",label:"EN"}],Kr="cs",rl={isActive:!1,config:null,selectedItemId:null,itemDepthLayer:"behind",editMode:"items",selectedDialogZoneId:null,selectedFrameId:null},U=J(rl),Ur=Fe(U,n=>n.isActive),ol=Fe(U,n=>n.config),es=J(!0);function al(){es.update(n=>!n)}const Rt=J(!1);function Dn(n){Rt.set(n)}const dn=J(!1),Zt=J(!1),ts=J(!1);function ll(){dn.update(n=>!n)}function cl(){Zt.update(n=>!n)}function si(){ts.set(!0)}function dl(){ts.set(!1)}const ns=J(Kr);function ul(n){ns.set(n)}const is=Fe(U,n=>n.selectedItemId),Vr=Fe(U,n=>n.itemDepthLayer),Re=Fe(U,n=>n.editMode),vi=Fe(U,n=>n.selectedDialogZoneId),ss=Fe(U,n=>n.config?.dialogZones||[]),mi=Fe(U,n=>n.selectedFrameId),jr=Fe(U,n=>n.config?.placedFrames||[]),rs=J(new Map);function hl(n,e,t){rs.update(i=>{const s=new Map(i);return s.set(n,{x:e,y:t}),s})}function fl(n){rs.update(e=>{const t=new Map(e);return t.delete(n),t})}const qr=J(null);function Ii(n){qr.set(n)}const gl=Fe(U,n=>!n.selectedFrameId||!n.config?.placedFrames?null:n.config.placedFrames.find(e=>e.id===n.selectedFrameId)??null),Jr=J(null);function Ci(n){Jr.set(n)}const Qr=J(null);function Wn(n){Qr.set(n)}const os=J(!1);function eo(){os.set(!0)}function As(){os.set(!1)}const as=Fe(U,n=>!n.selectedItemId||!n.config?.placedItems?null:n.config.placedItems.find(e=>e.id===n.selectedItemId)??null),pl=Fe(as,n=>n?.physicsEnabled??!1),vl=Fe(as,n=>n?.flipX??!1);function ks(n,e){U.update(t=>t.config?{...t,config:{...t.config,playerStartX:n,playerStartY:e}}:t)}function ml(n){U.update(e=>{if(!e.config)return e;const t=e.config.placedItems||[];return{...e,config:{...e.config,placedItems:[...t,n]}}})}function On(n,e){U.update(t=>!t.config||!t.config.placedItems?t:{...t,config:{...t.config,placedItems:t.config.placedItems.map(i=>i.id===n?{...i,...e}:i)}})}function to(n){U.update(e=>!e.config||!e.config.placedItems?e:{...e,config:{...e.config,placedItems:e.config.placedItems.filter(t=>t.id!==n)},selectedItemId:e.selectedItemId===n?null:e.selectedItemId})}function no(n){U.update(e=>({...e,selectedItemId:n}))}function ls(){U.update(n=>({...n,selectedItemId:null}))}function _l(){U.update(n=>({...n,itemDepthLayer:n.itemDepthLayer==="behind"?"front":"behind"}))}function yl(n,e){On(n,{depth:e})}function wl(n,e){e?(On(n,{physicsEnabled:e,depth:Qi("behind")}),U.update(t=>({...t,itemDepthLayer:"behind"}))):On(n,{physicsEnabled:e})}function bl(n,e){On(n,{flipX:e})}function Sl(n){U.set({isActive:!0,config:{...n,placedItems:n.placedItems||[],dialogZones:n.dialogZones||[],placedFrames:n.placedFrames||[]},selectedItemId:null,itemDepthLayer:"behind",editMode:"items",selectedDialogZoneId:null,selectedFrameId:null}),yn.set(!1)}function El(){U.update(n=>{const e=n.config?{...n.config,dialogZones:(n.config.dialogZones||[]).filter(t=>t.texts.some(i=>i.title.trim()!==""||i.content.trim()!==""))}:n.config;return{...n,isActive:!1,selectedItemId:null,config:e}}),yn.set(!1)}function xl(){return pi(U).config}const yn=J(!1);function Ms(n){yn.set(n)}const _i=J({scrollX:0,scrollY:0,viewWidth:0,viewHeight:0,worldWidth:0,worldHeight:0,zoom:1,playerX:0,playerY:0});function Il(n){_i.update(e=>({...e,...n}))}function Yn(n){U.update(e=>({...e,editMode:n,selectedItemId:null,selectedDialogZoneId:null}))}function Cl(n){U.update(e=>{if(!e.config)return e;const t=e.config.dialogZones||[];return{...e,config:{...e.config,dialogZones:[...t,n]}}})}function sn(n,e){U.update(t=>!t.config||!t.config.dialogZones?t:{...t,config:{...t.config,dialogZones:t.config.dialogZones.map(i=>i.id===n?{...i,...e}:i)}})}function io(n){U.update(e=>!e.config||!e.config.dialogZones?e:{...e,config:{...e.config,dialogZones:e.config.dialogZones.filter(t=>t.id!==n)},selectedDialogZoneId:e.selectedDialogZoneId===n?null:e.selectedDialogZoneId})}function Tn(n){U.update(e=>({...e,selectedDialogZoneId:n}))}function Ps(n,e,t){U.update(i=>!i.config||!i.config.dialogZones?i:{...i,config:{...i.config,dialogZones:i.config.dialogZones.map(s=>{if(s.id!==n)return s;const r=s.texts.findIndex(l=>l.language===e);let o;return r>=0?o=s.texts.map((l,a)=>a===r?{...l,...t}:l):o=[...s.texts,{language:e,title:"",content:"",...t}],{...s,texts:o}})}})}function Dl(n){U.update(e=>{if(!e.config)return e;const t=e.config.placedFrames||[];return{...e,config:{...e.config,placedFrames:[...t,n]}}})}function vt(n,e){U.update(t=>!t.config||!t.config.placedFrames?t:{...t,config:{...t.config,placedFrames:t.config.placedFrames.map(i=>i.id===n?{...i,...e}:i)}})}function cs(n){U.update(e=>!e.config||!e.config.placedFrames?e:{...e,config:{...e.config,placedFrames:e.config.placedFrames.filter(t=>t.id!==n)},selectedFrameId:e.selectedFrameId===n?null:e.selectedFrameId})}function ln(n){U.update(e=>({...e,selectedFrameId:n}))}const ds=[{key:"tent",name:"Tent",path:"assets/ui/tent.png",scale:6,category:"structures"},{key:"lamp",name:"Lamp",path:"assets/ui/lamp.png",scale:8,category:"props"},{key:"sign_left",name:"Sign â",path:"assets/ui/sign_left.png",scale:7,category:"signs"},{key:"sign_right",name:"Sign â",path:"assets/ui/sign_right.png",scale:7,category:"signs"},{key:"stone_0",name:"Stone 0",path:"assets/ui/stone_0.png",scale:4,category:"nature",supportsPhysics:!0},{key:"stone_1",name:"Stone 1",path:"assets/ui/stone_1.png",scale:5,category:"nature",supportsPhysics:!0},{key:"stone_2",name:"Stone 2",path:"assets/ui/stone_2.png",scale:4,category:"nature",supportsPhysics:!0}];function so(n){return ds.find(e=>e.key===n)}function Tl(n){return so(n)?.scale||1}function Al(n){return so(n)?.supportsPhysics??!1}class $s{scene;groundY;constructor(e,t){this.scene=e,this.groundY=t}static preloadAssets(e){ds.forEach(t=>{e.load.image(t.key,t.path)})}createSprite(e){const{id:t,assetKey:i,x:s,scale:r=1,depth:o=5,yOffset:l=0,flipX:a=!1}=e,d=this.groundY+l,u=this.scene.add.sprite(s,d,i);return u.setScale(r),u.setDepth(o),u.setFlipX(a),u.setData("itemId",t),u}updatePosition(e,t,i){e.x=t,e.y=this.groundY+i}updateScale(e,t){e.setScale(t)}updateDepth(e,t){e.setDepth(t)}applyUpdates(e,t){t.x!==void 0&&(e.x=t.x),t.yOffset!==void 0&&(e.y=this.groundY+t.yOffset),t.scale!==void 0&&e.setScale(t.scale),t.depth!==void 0&&e.setDepth(t.depth),t.flipX!==void 0&&e.setFlipX(t.flipX)}worldYToOffset(e){return e-this.groundY}getGroundY(){return this.groundY}}const ri=40,kl=48,Os=5,Ml=We.PLAYER,oi=50,Pl=4871528,$l=.4,Ol=1,ro=We.GRID_OVERLAY,Di=16711680,Ll=2,Rl=.6,Hl=.1,Fl=1,Xl=.2,Ls=50,Nl=50,Bl=4886754;class Zl{lastClickTime=0;lastClickId=null;threshold;constructor(e=300){this.threshold=e}check(e){const t=Date.now(),i=this.lastClickId===e&&t-this.lastClickTime<this.threshold;return this.lastClickTime=t,this.lastClickId=e,i}reset(){this.lastClickTime=0,this.lastClickId=null}}function Rs(n,e){return Math.round(n/e)*e}function us(n){const{sprite:e,scene:t,callbacks:i={},constraints:s,useGridSnapping:r=!0,cursor:o="grab",hitArea:l}=n;let a=!1,d=0,u=0;l?e.setInteractive({hitArea:l,hitAreaCallback:W.Geom.Rectangle.Contains,useHandCursor:!0,cursor:o}):e.setInteractive({useHandCursor:!0,cursor:o});const h=_=>{Vt()||a||(i.onSelect?.(),!i.onDoubleClick?.()&&(a=!0,t.data.set("isDraggingItem",!0),Dn(!0),d=e.x-_.worldX,u=e.y-_.worldY,i.onDragStart?.()))},f=_=>{if(!a)return;if(!_.isDown){p();return}let w=_.worldX+d,v=_.worldY+u;r&&pi(es)&&(w=Rs(w,oi),v=Rs(v,oi)),s&&(s.minX!==void 0&&(w=Math.max(w,s.minX)),s.maxX!==void 0&&(w=Math.min(w,s.maxX)),s.minY!==void 0&&(v=Math.max(v,s.minY)),s.maxY!==void 0&&(v=Math.min(v,s.maxY))),e.setPosition(w,v),i.onDrag?.(w,v)},g=()=>{a&&p()},p=()=>{a=!1,t.data.set("isDraggingItem",!1),Dn(!1),i.onDragEnd?.(e.x,e.y)};return e.on("pointerdown",h),t.input.on("pointermove",f),t.input.on("pointerup",g),()=>{e.off("pointerdown",h),t.input.off("pointermove",f),t.input.off("pointerup",g)}}class Wl{scene;groundY;worldWidth;worldHeight;isDragging=!1;callbacks;cleanupFunctions=new Map;constructor(e,t,i,s,r={}){this.scene=e,this.groundY=t,this.worldWidth=i,this.worldHeight=s,this.callbacks=r}getIsDragging(){return this.isDragging}makeInteractive(e,t){const i=us({sprite:e,scene:this.scene,cursor:"pointer",constraints:{minX:0,maxX:this.worldWidth,minY:0,maxY:this.worldHeight},callbacks:{onSelect:()=>{no(t),this.callbacks.onSelect?.(t)},onDragStart:()=>{this.isDragging=!0,e.setTint(4886754),this.callbacks.onDragStart?.(t)},onDrag:(s,r)=>{this.callbacks.onDrag?.(t,s,r)},onDragEnd:(s,r)=>{e.clearTint(),this.isDragging=!1;const o=Math.round(s),a=Math.round(r)-this.groundY;On(t,{x:o,yOffset:a}),this.callbacks.onDragEnd?.(t,o,a)}}});this.cleanupFunctions.set(t,i)}removeInteractivity(e){if(!e||!e.scene)return;const t=e.getData("itemId");t&&this.cleanupFunctions.has(t)&&(this.cleanupFunctions.get(t)(),this.cleanupFunctions.delete(t)),e.removeInteractive()}destroy(){this.cleanupFunctions.forEach(e=>e()),this.cleanupFunctions.clear()}}const Yl={lineWidth:3,lineColor:4886754,lineAlpha:1,handleSize:8,handleColor:4886754,padding:5};class zl{scene;graphics;style;selectedId=null;constructor(e,t={}){this.scene=e,this.style={...Yl,...t},this.graphics=e.add.graphics(),this.graphics.setDepth(We.SELECTION_GRAPHICS)}setSelectedId(e){this.selectedId=e}getSelectedId(){return this.selectedId}updateVisuals(e){if(this.graphics.clear(),!e||!this.selectedId)return;const t=e.getBounds(),{lineWidth:i,lineColor:s,lineAlpha:r,handleSize:o,handleColor:l,padding:a}=this.style;this.graphics.lineStyle(i,s,r),this.graphics.strokeRect(t.x-a,t.y-a,t.width+a*2,t.height+a*2),this.graphics.fillStyle(l,1),this.graphics.fillCircle(t.x,t.y,o),this.graphics.fillCircle(t.x+t.width,t.y,o),this.graphics.fillCircle(t.x,t.y+t.height,o),this.graphics.fillCircle(t.x+t.width,t.y+t.height,o)}clearVisuals(){this.graphics.clear(),this.selectedId=null}setupBackgroundDeselect(e){this.scene.input.on("pointerdown",t=>{if(Vt()||e())return;this.scene.input.hitTestPointer(t).find(s=>s.type==="Sprite"&&s.getData("itemId"))||(ls(),this.clearVisuals())})}destroy(){this.graphics?.destroy()}}class ai{scene;items=new Map;isBuilderMode=!1;physicsGroup=null;renderer;dragController;selectionManager;constructor(e,t,i,s,r=!1){this.scene=e,this.isBuilderMode=r,this.renderer=new $s(e,t),r||(this.physicsGroup=e.physics.add.staticGroup()),this.isBuilderMode&&(this.dragController=new Wl(e,t,i,s,{onSelect:()=>this.updateSelectionVisuals(),onDrag:()=>this.updateSelectionVisuals()}),this.selectionManager=new zl(e))}static preloadAssets(e){$s.preloadAssets(e)}createItems(e){e.forEach(t=>{this.createItem(t)})}createItem(e){const t=this.renderer.createSprite(e),i={sprite:t,data:e};if(!this.isBuilderMode&&e.physicsEnabled&&this.physicsGroup){const s=this.createPhysicsBody(t,e);i.physicsBody=s}this.items.set(e.id,i),this.isBuilderMode&&this.dragController&&this.dragController.makeInteractive(t,e.id)}createPhysicsBody(e,t){const i=e.getBounds(),s=i.width*.5,r=i.height*.8,o=e.x,l=e.y,a=this.scene.add.rectangle(o,l,s,r);return a.setVisible(!1),this.physicsGroup.add(a),a.setData("itemId",t.id),a}updateSelectionVisuals(){if(!this.selectionManager)return;const e=this.scene.data.get("selectedItemId");if(this.selectionManager.setSelectedId(e),!e){this.selectionManager.clearVisuals(),Ii(null);return}const t=this.items.get(e);if(this.selectionManager.updateVisuals(t?.sprite??null),t?.sprite){const i=this.scene.cameras.main,s=t.sprite.getBounds(),{screenX:r,screenY:o}=an(s.centerX,s.centerY,i),l=s.height*i.zoom;Ii({screenX:r,screenY:o,itemHeight:l})}else Ii(null)}updateItem(e,t){const i=this.items.get(e);i&&(this.renderer.applyUpdates(i.sprite,t),i.data={...i.data,...t})}removeItem(e){const t=this.items.get(e);t&&(this.dragController&&this.dragController.removeInteractivity(t.sprite),t.physicsBody&&t.physicsBody.destroy(),t.sprite.destroy(),this.items.delete(e))}removeAllItems(){this.items.forEach(e=>{!e.sprite||!e.sprite.scene||(this.dragController&&this.dragController.removeInteractivity(e.sprite),e.physicsBody&&e.physicsBody.destroy(),e.sprite.destroy())}),this.items.clear()}getItem(e){return this.items.get(e)?.data}getAllItems(){return Array.from(this.items.values()).map(e=>e.data)}getPhysicsGroup(){return this.physicsGroup}setInteractiveEnabled(e){!this.isBuilderMode||!this.dragController||(this.items.forEach(({sprite:t,data:i})=>{e?(this.dragController.makeInteractive(t,i.id),t.setAlpha(1)):(t.disableInteractive(),t.setAlpha(.6))}),!e&&this.selectionManager&&this.selectionManager.clearVisuals())}destroy(){this.removeAllItems(),this.selectionManager?.destroy()}setupBackgroundDeselect(){!this.isBuilderMode||!this.selectionManager||this.selectionManager.setupBackgroundDeselect(()=>this.dragController?.getIsDragging()??!1)}}function Gl(){return`frame_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const Kl=["#ffffff","#f8f8f8","#fffacd","#ffefd5","#ffe4e1","#e6e6fa","#f0fff0","#f5fffa","#fff0f5","#f0f8ff","#2d2d2d","#1a1a2e","#16213e","#1a1a1a","#2d132c","#1e3a3a","#3d1a1a","#1a2f1a","#3d3d1a","#2a1a3d"],Ul=["#333333","#000000","#ffffff","#1a1a1a","#666666","#8b4513","#2c3e50","#c0392b","#27ae60","#2980b9","#8e44ad","#f39c12"],Vl=[12,14,16,18,20,24,28,32],oo={S:{label:"Small",scale:3},M:{label:"Medium",scale:4},L:{label:"Large",scale:5}};function jl(n){return oo[n].scale}function ql(n){return n<=3?"S":n>=5?"L":"M"}const yt=4,En="#ffffff",ao="#333333",Kn=16,Jl=64,Ql=96,ec=.06,Hs=32,li=[{key:"base_1",name:"Frame 1",path:"assets/frames/base 1.png",scale:4},{key:"base_2",name:"Frame 2",path:"assets/frames/base 2.png",scale:4},{key:"base_3",name:"Frame 3",path:"assets/frames/base 3.png",scale:4},{key:"base_4",name:"Frame 4",path:"assets/frames/base 4.png",scale:4},{key:"base_5",name:"Frame 5",path:"assets/frames/base 5.png",scale:4},{key:"base_6",name:"Frame 6",path:"assets/frames/base 6.png",scale:4},{key:"base_7",name:"Frame 7",path:"assets/frames/base 7.png",scale:4},{key:"base_8",name:"Frame 8",path:"assets/frames/base 8.png",scale:4},{key:"base_9",name:"Frame 9",path:"assets/frames/base 9.png",scale:4},{key:"base_10",name:"Frame 10",path:"assets/frames/base 10.png",scale:4},{key:"base_11",name:"Frame 11",path:"assets/frames/base 11.png",scale:4},{key:"base_12",name:"Frame 12",path:"assets/frames/base 12.png",scale:4},{key:"base_13",name:"Frame 13",path:"assets/frames/base 13.png",scale:4},{key:"base_14",name:"Frame 14",path:"assets/frames/base 14.png",scale:4},{key:"base_15",name:"Frame 15",path:"assets/frames/base 15.png",scale:4},{key:"base_16",name:"Frame 16",path:"assets/frames/base 16.png",scale:4},{key:"base_17",name:"Frame 17",path:"assets/frames/base 17.png",scale:4},{key:"base_18",name:"Frame 18",path:"assets/frames/base 18.png",scale:4},{key:"base_19",name:"Frame 19",path:"assets/frames/base 19.png",scale:4},{key:"base_20",name:"Frame 20",path:"assets/frames/base 20.png",scale:4},{key:"base_21",name:"Frame 21",path:"assets/frames/base 21.png",scale:4},{key:"base_22",name:"Frame 22",path:"assets/frames/base 22.png",scale:4},{key:"base_23",name:"Frame 23",path:"assets/frames/base 23.png",scale:4},{key:"base_24",name:"Frame 24",path:"assets/frames/base 24.png",scale:4},{key:"base_25",name:"Frame 25",path:"assets/frames/base 25.png",scale:4}];function tc(n){return li.find(e=>e.key===n)}function nc(n){return tc(n)?.scale??yt}function An(n=yt,e=!1){const t=Jl*n,i=Ql*n,s=e?i:t,r=e?t:i,o=Math.min(t,i)*ec,l=s-o*2,a=r-o*2,d=l-Hs*2,u=a-Hs*2;return{frameWidth:s,frameHeight:r,innerWidth:l,innerHeight:a,textWidth:d,textHeight:u}}function Un(n,e,t,i,s,r,o=4){n.clear();const l=parseInt(r.replace("#",""),16);n.fillStyle(l,1),n.fillRoundedRect(e-i/2,t-s/2,i,s,o)}class Fs{scene;frames=new Map;constructor(e){this.scene=e}static preloadAssets(e){for(let t=1;t<=25;t++)e.load.image(`frame_base_${t}`,`assets/frames/base ${t}.png`)}createFrames(e){e.forEach(t=>{this.createFrame(t)})}createFrame(e){const t=`frame_${e.frameKey}`;if(!this.scene.textures.exists(t)){console.warn(`[GameFrameManager] Frame texture not found: ${t}`);return}const i=e.scale??yt,s=e.depth??We.ITEMS_FRONT,r=(e.rotation??0)*(Math.PI/180),o=e.rotation===90,{innerWidth:l,innerHeight:a}=An(i,o),d=this.scene.add.graphics();d.setDepth(s-.1),Un(d,e.x,e.y,l,a,e.backgroundColor||En);const u=this.scene.add.sprite(e.x,e.y,t);u.setScale(i),u.setDepth(s),u.setOrigin(.5,.5),u.setRotation(r);const h={sprite:u,background:d,data:e};this.frames.set(e.id,h),e.url&&this.makeClickable(h)}makeClickable(e){const{sprite:t,data:i}=e;t.setInteractive({useHandCursor:!0}),t.on("pointerover",()=>{t.setScale((i.scale??yt)*1.05)}),t.on("pointerout",()=>{t.setScale(i.scale??yt)}),t.on("pointerdown",()=>{i.url&&(Ua(),window.open(i.url,"_blank","noopener,noreferrer"))})}destroy(){this.frames.forEach(({sprite:e,background:t})=>{e.destroy(),t.destroy()}),this.frames.clear()}}async function Xs(){const n=await fetch("./config/map.json");if(!n.ok)throw new Error(`Failed to load map config: ${n.status}`);const e=await n.json();if(!e.worldWidth||!e.worldHeight)throw new Error("Invalid map config structure");return e}const Vn={generateId(){return`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`},create(n){const{assetKey:e,x:t,yOffset:i=0,depthLayer:s="behind",scale:r}=n;return{id:Vn.generateId(),assetKey:e,x:Math.round(t),y:0,scale:r??Tl(e),depth:Qi(s),yOffset:Math.round(i)}},createAtWorldPosition(n,e,t,i,s="behind"){return Vn.create({assetKey:n,x:e,yOffset:t-i,depthLayer:s})},clone(n,e=50){return{...n,id:Vn.generateId(),x:n.x+e}}},Bt={HEIGHT:40,VISUAL:{COLOR:9139029,ALPHA:.3},PHYSICS:{COLOR:0,ALPHA:0}},Ln={getGroundY(n,e=Bt.HEIGHT){return n-e},createVisualGround(n,e){const t=e.height??Bt.HEIGHT,i=Ln.getGroundY(e.worldHeight,t),s=n.add.rectangle(0,i,e.worldWidth,t,e.color??Bt.VISUAL.COLOR,e.alpha??Bt.VISUAL.ALPHA);return s.setOrigin(0,0),s.setDepth(e.depth??We.GROUND_REFERENCE),{ground:s,groundY:i}},createPhysicsGround(n,e){const t=e.height??Bt.HEIGHT,i=Ln.getGroundY(e.worldHeight,t),s=n.add.rectangle(0,i,e.worldWidth,t,e.color??Bt.PHYSICS.COLOR,e.alpha??Bt.PHYSICS.ALPHA);return s.setOrigin(0,0),n.physics.add.existing(s,!0),{ground:s,groundY:i}},addPlayerCollision(n,e,t){return n.physics.add.collider(e,t)}},wt={GAME:"GameScene",BUILDER:"BuilderScene"};class ic extends W.Scene{player;mapConfig;parallaxLayers=null;loadedBackgrounds=new Set;itemManager;frameManager;dialogZones=[];currentDialogZone=null;unsubscribers=[];initData;constructor(){super({key:wt.GAME})}init(e){this.initData=e}preload(){pt.forEach(e=>{this.load.spritesheet(`cat-idle-${e}`,`assets/sprites/${e}/Idle.png`,{frameWidth:48,frameHeight:48}),this.load.spritesheet(`cat-walk-${e}`,`assets/sprites/${e}/Walk.png`,{frameWidth:48,frameHeight:48})}),ai.preloadAssets(this),Fs.preloadAssets(this)}create(){this.initializeScene()}async initializeScene(){Hi.set(!0);try{await this.loadMapConfiguration();const e=ii.getCurrentConfig();await this.loadBackgroundIfNeeded(e),this.createParallaxBackground();const{ground:t,groundY:i}=Ln.createPhysicsGround(this,{worldWidth:this.mapConfig.worldWidth,worldHeight:this.mapConfig.worldHeight});this.player=new tl(this,this.mapConfig.playerStartX,this.mapConfig.playerStartY),Ln.addPlayerCollision(this,this.player,t),this.itemManager=new ai(this,i,this.mapConfig.worldWidth,this.mapConfig.worldHeight,!1),this.mapConfig.placedItems&&this.mapConfig.placedItems.length>0&&this.itemManager.createItems(this.mapConfig.placedItems);const s=this.itemManager.getPhysicsGroup();s&&this.physics.add.collider(this.player,s),this.frameManager=new Fs(this),this.mapConfig.placedFrames&&this.mapConfig.placedFrames.length>0&&this.frameManager.createFrames(this.mapConfig.placedFrames),this.dialogZones=this.mapConfig.dialogZones||[];const r=ss.subscribe(o=>{this.dialogZones=o,this.recheckCurrentZone()});this.unsubscribers.push(r),this.cameras.main.startFollow(this.player,!0,.1,.1),this.cameras.main.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.physics.world.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.scale.on("resize",this.handleResize,this)}catch(e){console.error("[GameScene] Failed to initialize scene:",e)}finally{Hi.set(!1)}}async loadMapConfiguration(){try{if(this.initData?.useBuilderConfig){const e=xl();this.mapConfig=e||await Xs()}else this.mapConfig=await Xs()}catch(e){console.error("[GameScene] Failed to load map configuration:",e),this.mapConfig={worldWidth:3200,worldHeight:600,playerStartX:400,playerStartY:300,placedItems:[]}}}createParallaxBackground(){const e=ii.getCurrentConfig();this.parallaxLayers=zr(this,this.mapConfig.worldWidth,this.mapConfig.worldHeight,e)}async loadBackgroundIfNeeded(e){if(this.loadedBackgrounds.has(e.folder))return!0;const t=await Yr(this,e);return t&&this.loadedBackgrounds.add(e.folder),t}handleResize(e){if(!(!this.cameras?.main||!this.mapConfig)&&(this.cameras.main.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.parallaxLayers?.baseLayer)){const t=Math.max(this.mapConfig.worldHeight,e.height);this.parallaxLayers.baseLayer.setSize(this.mapConfig.worldWidth,t)}}shutdown(){this.scale.off("resize",this.handleResize,this),Ei(null),this.currentDialogZone=null,this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.itemManager&&this.itemManager.destroy()}update(){if(!this.player)return;this.player.update();const e=this.cameras.main,t=this.player.x-e.scrollX,i=this.player.y-e.scrollY;Ga(t,i),Ka(e.scrollX,e.scrollY,e.zoom),this.checkDialogZones(),this.parallaxLayers&&Gr(this.parallaxLayers.baseLayer,this.cameras.main)}checkDialogZones(){const e=this.player.x;let t=null;for(const i of this.dialogZones)if(e>=i.x&&e<=i.x+i.width){t=i;break}t?.id!==this.currentDialogZone?.id&&(this.currentDialogZone=t,Ei(t))}recheckCurrentZone(){if(!this.currentDialogZone)return;const e=this.dialogZones.find(t=>t.id===this.currentDialogZone?.id);e&&(this.currentDialogZone=e,Ei(e))}}const sc=.05,rc=1,zn=400;class oc{scene;camera;worldWidth;worldHeight;isPanning=!1;panStartX=0;panStartY=0;cameraDragStartX=0;cameraDragStartY=0;isDraggingToScroll=!1;dragScrollStartX=0;dragScrollStartY=0;dragScrollCameraStartX=0;dragScrollCameraStartY=0;isZoomedOut=!1;isAnimating=!1;savedScrollX=0;savedScrollY=0;constructor(e,t,i){this.scene=e,this.camera=e.cameras.main,this.worldWidth=t,this.worldHeight=i}setup(){this.setupCamera(),this.setupMouseControls(),this.setupKeyboardControls()}setupCamera(){this.camera.setBounds(0,0,this.worldWidth,this.worldHeight),this.camera.setZoom(1)}centerOn(e,t){this.camera.centerOn(e,t)}setupMouseControls(){this.scene.input.on("wheel",(e,t,i,s)=>{if(this.isZoomedOut)return;const r=this.camera.scrollX+i,o=this.camera.scrollY+s;this.camera.setScroll(W.Math.Clamp(r,0,this.worldWidth-this.camera.width),W.Math.Clamp(o,0,this.worldHeight-this.camera.height))}),this.scene.input.on("pointerdown",e=>{Vt()||this.isZoomedOut||Ds()||(e.rightButtonDown()||e.middleButtonDown()?(this.isPanning=!0,this.panStartX=e.x,this.panStartY=e.y,this.cameraDragStartX=this.camera.scrollX,this.cameraDragStartY=this.camera.scrollY):e.leftButtonDown()&&!this.isDraggingObject()&&(this.scene.data.get("isDraggingItem")===!0||(this.dragScrollStartX=e.x,this.dragScrollStartY=e.y,this.dragScrollCameraStartX=this.camera.scrollX,this.dragScrollCameraStartY=this.camera.scrollY)))}),this.scene.input.on("pointermove",e=>{if(!(this.isZoomedOut||Ds())){if(this.isPanning){const t=e.x-this.panStartX,i=e.y-this.panStartY,s=this.cameraDragStartX-t,r=this.cameraDragStartY-i;this.camera.setScroll(W.Math.Clamp(s,0,this.worldWidth-this.camera.width),W.Math.Clamp(r,0,this.worldHeight-this.camera.height))}else if(e.leftButtonDown()&&!this.isDraggingToScroll&&!this.isDraggingObject()&&!(this.scene.data.get("isDraggingItem")===!0)){const i=Math.abs(e.x-this.dragScrollStartX),s=Math.abs(e.y-this.dragScrollStartY);Math.sqrt(i*i+s*s)>10&&(this.isDraggingToScroll=!0,this.scene.input.setDefaultCursor("grabbing"))}if(this.isDraggingToScroll){const t=e.x-this.dragScrollStartX,i=e.y-this.dragScrollStartY,s=this.dragScrollCameraStartX-t,r=this.dragScrollCameraStartY-i;this.camera.setScroll(W.Math.Clamp(s,0,this.worldWidth-this.camera.width),W.Math.Clamp(r,0,this.worldHeight-this.camera.height))}}}),this.scene.input.on("pointerup",e=>{!e.rightButtonDown()&&!e.middleButtonDown()&&(this.isPanning=!1),this.isDraggingToScroll&&(this.isDraggingToScroll=!1,this.scene.input.setDefaultCursor("default"))})}setupKeyboardControls(){const e={up:this.scene.input.keyboard.addKey(W.Input.Keyboard.KeyCodes.UP,!1),down:this.scene.input.keyboard.addKey(W.Input.Keyboard.KeyCodes.DOWN,!1),left:this.scene.input.keyboard.addKey(W.Input.Keyboard.KeyCodes.LEFT,!1),right:this.scene.input.keyboard.addKey(W.Input.Keyboard.KeyCodes.RIGHT,!1)},t={w:this.scene.input.keyboard.addKey(W.Input.Keyboard.KeyCodes.W,!1),a:this.scene.input.keyboard.addKey(W.Input.Keyboard.KeyCodes.A,!1),s:this.scene.input.keyboard.addKey(W.Input.Keyboard.KeyCodes.S,!1),d:this.scene.input.keyboard.addKey(W.Input.Keyboard.KeyCodes.D,!1)};this.scene.input.keyboard.addKey(W.Input.Keyboard.KeyCodes.SPACE,!1).on("down",()=>{Cn()||this.isZoomedOut||this.centerOnPlayer()}),this.scene.input.keyboard.addKey(W.Input.Keyboard.KeyCodes.F,!1).on("down",()=>{Cn()||this.toggleZoomToFit()}),this.scene.events.on("update",()=>{if(this.isZoomedOut||Cn())return;const r=10;e.left.isDown||t.a.isDown?this.camera.scrollX=Math.max(0,this.camera.scrollX-r):(e.right.isDown||t.d.isDown)&&(this.camera.scrollX=Math.min(this.worldWidth-this.camera.width,this.camera.scrollX+r)),e.up.isDown||t.w.isDown?this.camera.scrollY=Math.max(0,this.camera.scrollY-r):(e.down.isDown||t.s.isDown)&&(this.camera.scrollY=Math.min(this.worldHeight-this.camera.height,this.camera.scrollY+r))})}centerOnPlayer(){const e=this.scene.data.get("playerSprite");e&&this.camera.centerOn(e.x,e.y)}isDraggingObject(){return this.scene.data.get("isDraggingObject")===!0}getIsZoomedOut(){return this.isZoomedOut}toggleZoomToFit(){this.isZoomedOut?this.resetZoom():this.zoomToFit()}zoomToFit(){if(this.isZoomedOut||this.isAnimating)return;this.savedScrollX=this.camera.scrollX,this.savedScrollY=this.camera.scrollY,this.isZoomedOut=!0,this.isAnimating=!0,Ms(!0);const e=this.camera.width/this.worldWidth,t=this.camera.height/this.worldHeight;let i=Math.min(e,t);i=Math.max(i,sc);const s=this.worldWidth/2,r=this.worldHeight/2;this.camera.removeBounds(),this.camera.pan(s,r,zn,"Sine.easeInOut"),this.camera.zoomTo(i,zn,"Sine.easeInOut",!1,(o,l)=>{l===1&&(this.isAnimating=!1)})}resetZoom(){if(!this.isZoomedOut||this.isAnimating)return;this.isZoomedOut=!1,this.isAnimating=!0,Ms(!1);const e=this.savedScrollX+this.camera.width/2,t=this.savedScrollY+this.camera.height/2;this.camera.pan(e,t,zn,"Sine.easeInOut"),this.camera.zoomTo(rc,zn,"Sine.easeInOut",!1,(i,s)=>{s===1&&(this.camera.setBounds(0,0,this.worldWidth,this.worldHeight),this.isAnimating=!1)})}destroy(){}}class ac{scene;player;worldWidth;groundY;unsubscribers=[];interactionCleanup=null;constructor(e,t,i){this.scene=e,this.worldWidth=t,this.groundY=i-ri}create(e,t){return this.player=this.scene.add.sprite(e,t,"cat-idle-white",0),this.player.setScale(Os),this.player.setDepth(Ml),this.scene.data.set("playerSprite",this.player),this.setupInteraction(),this.setupEditModeSubscription(),this.player}setupInteraction(){const e=new W.Geom.Rectangle(8,4,32,40);this.interactionCleanup=us({sprite:this.player,scene:this.scene,useGridSnapping:!1,cursor:"grab",hitArea:e,constraints:{minX:Ls,maxX:this.worldWidth-Ls,minY:Nl},callbacks:{onDragStart:()=>{this.player.setTint(Bl),this.scene.data.set("isDraggingObject",!0)},onDrag:(t,i)=>{ks(Math.round(t),Math.round(i))},onDragEnd:(t,i)=>{this.player.clearTint(),this.scene.data.set("isDraggingObject",!1);let s=this.player.y;const r=kl*Os;this.player.y+r/2>this.groundY&&(s=this.groundY-r/2,this.player.setY(s)),ks(Math.round(this.player.x),Math.round(s))}}})}setupEditModeSubscription(){const e=Re.subscribe(t=>{t==="dialogs"?(this.interactionCleanup&&(this.interactionCleanup(),this.interactionCleanup=null),this.player.disableInteractive(),this.player.setAlpha(.6)):(this.player.setAlpha(1),this.interactionCleanup||this.setupInteraction())});this.unsubscribers.push(e)}getSprite(){return this.player}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.interactionCleanup&&(this.interactionCleanup(),this.interactionCleanup=null),this.player&&this.player.destroy()}}class lc{scene;graphics;worldWidth;worldHeight;constructor(e,t,i){this.scene=e,this.worldWidth=t,this.worldHeight=i}create(){return this.graphics=this.scene.add.graphics(),this.graphics.setDepth(ro),this.draw(),this.graphics}draw(){this.graphics.clear(),this.graphics.lineStyle(Ol,Pl,$l);const e=Math.max(this.worldHeight,this.scene.scale.height);for(let i=0;i<=this.worldWidth;i+=oi)this.graphics.beginPath(),this.graphics.moveTo(i,0),this.graphics.lineTo(i,e),this.graphics.strokePath();for(let i=0;i<=e;i+=oi)this.graphics.beginPath(),this.graphics.moveTo(0,i),this.graphics.lineTo(this.worldWidth,i),this.graphics.strokePath();const t=this.worldHeight-ri;this.graphics.lineStyle(Ll,Di,Rl),this.graphics.beginPath(),this.graphics.moveTo(0,t),this.graphics.lineTo(this.worldWidth,t),this.graphics.strokePath(),this.graphics.lineStyle(Fl,Di,Xl),this.graphics.fillStyle(Di,Hl),this.graphics.fillRect(0,t,this.worldWidth,e-t)}getGraphics(){return this.graphics}redraw(){this.draw()}destroy(){this.graphics&&this.graphics.destroy()}}class cc{listeners=new Map;on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set);const i=this.listeners.get(e);return i.add(t),{unsubscribe:()=>{i.delete(t),i.size===0&&this.listeners.delete(e)}}}once(e,t){const i=this.on(e,s=>{i.unsubscribe(),t(s)});return i}emit(e,t){const i=this.listeners.get(e);i&&i.forEach(s=>{try{s(t)}catch(r){console.error(`[EventBus] Error in listener for "${e}":`,r)}})}off(e){this.listeners.delete(e)}clear(){this.listeners.clear()}listenerCount(e){return this.listeners.get(e)?.size??0}}const we=new cc,be={ASSET_DROPPED:"asset:dropped",FRAME_DROPPED:"frame:dropped",MINIMAP_NAVIGATE:"minimap:navigate",DIALOG_ZONE_CREATE:"dialogZone:create",DIALOG_ZONE_CREATE_AT:"dialogZone:createAt",TEMP_ZONE_BUTTON_SHOW:"tempZoneButton:show",TEMP_ZONE_BUTTON_HIDE:"tempZoneButton:hide"};class dc{scene;groundY;worldWidth;worldHeight;itemManager;unsubscribers=[];constructor(e,t,i,s){this.scene=e,this.groundY=t,this.worldWidth=i,this.worldHeight=s}create(e){return this.itemManager=new ai(this.scene,this.groundY,this.worldWidth,this.worldHeight,!0),e&&e.length>0&&this.itemManager.createItems(e),this.setupBackgroundDeselect(),this.setupStoreSubscriptions(),this.setupAssetDropListener(),this.setupDeleteKeys(),this.itemManager}setupBackgroundDeselect(){this.itemManager.setupBackgroundDeselect()}setupStoreSubscriptions(){const e=is.subscribe(r=>{this.scene.data.set("selectedItemId",r),this.itemManager.updateSelectionVisuals()});this.unsubscribers.push(e);const t=Re.subscribe(r=>{r==="dialogs"?(ls(),this.itemManager.setInteractiveEnabled(!1)):this.itemManager.setInteractiveEnabled(!0)});this.unsubscribers.push(t);let i=[];const s=ol.subscribe(r=>{if(!r?.placedItems)return;const o=r.placedItems;i.forEach(l=>{o.find(d=>d.id===l.id)||this.itemManager.removeItem(l.id)}),o.forEach(l=>{const a=i.find(d=>d.id===l.id);a&&JSON.stringify(a)!==JSON.stringify(l)&&this.itemManager.updateItem(l.id,l)}),i=o.map(l=>({...l}))});this.unsubscribers.push(s)}setupAssetDropListener(){const e=we.on(be.ASSET_DROPPED,t=>{const{assetKey:i,canvasX:s,canvasY:r}=t,l=this.scene.cameras.main.getWorldPoint(s,r),a=l.x,d=l.y;let u="behind";Vr.subscribe(g=>{u=g})();const f=Vn.createAtWorldPosition(i,a,d,this.groundY,u);ml(f),this.itemManager.createItem(f),no(f.id)});this.unsubscribers.push(()=>e.unsubscribe())}setupDeleteKeys(){const e=this.scene.input.keyboard.addKey(W.Input.Keyboard.KeyCodes.DELETE,!1),t=this.scene.input.keyboard.addKey(W.Input.Keyboard.KeyCodes.BACKSPACE,!1),i=()=>{if(Cn())return;const s=this.scene.data.get("selectedItemId");s&&to(s)};e.on("down",i),t.on("down",i)}getManager(){return this.itemManager}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.itemManager&&this.itemManager.destroy()}}class Ns{scene;worldWidth;worldHeight;frames=new Map;unsubscribers=[];selectionGraphics=null;cleanupFunctions=new Map;doubleClickDetector=new Zl;constructor(e,t,i){this.scene=e,this.worldWidth=t,this.worldHeight=i}static preloadAssets(e){for(let t=1;t<=25;t++)e.load.image(`frame_base_${t}`,`assets/frames/base ${t}.png`)}create(e){this.selectionGraphics=this.scene.add.graphics(),this.selectionGraphics.setDepth(We.SELECTION_GRAPHICS),e&&e.length>0&&e.forEach(t=>this.createFrame(t)),this.setupBackgroundDeselect(),this.setupStoreSubscriptions(),this.setupFrameDropListener(),this.setupDeleteKeys()}createFrame(e){const t=`frame_${e.frameKey}`;if(!this.scene.textures.exists(t)){console.warn(`Frame texture not found: ${t}`);return}const i=e.scale??yt,s=e.depth??We.ITEMS_FRONT,r=(e.rotation??0)*(Math.PI/180),o=e.rotation===90,{innerWidth:l,innerHeight:a}=An(i,o),d=this.scene.add.graphics();d.setDepth(s-.1),Un(d,e.x,e.y,l,a,e.backgroundColor||En);const u=this.scene.add.sprite(e.x,e.y,t);u.setScale(i),u.setDepth(s),u.setOrigin(.5,.5),u.setRotation(r);const h={sprite:u,background:d,data:e};this.frames.set(e.id,h),this.makeInteractive(h,e.id)}updateFrameVisuals(e){const{sprite:t,background:i,data:s}=e,r=`frame_${s.frameKey}`;t.texture.key!==r&&this.scene.textures.exists(r)&&t.setTexture(r);const o=s.scale??yt;t.setScale(o);const l=(s.rotation??0)*(Math.PI/180);t.setRotation(l);const a=s.rotation===90,{innerWidth:d,innerHeight:u}=An(o,a);Un(i,t.x,t.y,d,u,s.backgroundColor||En)}moveContainer(e,t,i){const{sprite:s,background:r,data:o}=e;s.setPosition(t,i);const l=o.scale??yt,a=o.rotation===90,{innerWidth:d,innerHeight:u}=An(l,a);Un(r,t,i,d,u,o.backgroundColor||En)}makeInteractive(e,t){const{sprite:i}=e,s=us({sprite:i,scene:this.scene,cursor:"grab",useGridSnapping:!0,constraints:{minX:0,maxX:this.worldWidth,minY:0,maxY:this.worldHeight},callbacks:{onSelect:()=>{ln(t),this.updateSelectionVisuals()},onDoubleClick:()=>this.doubleClickDetector.check(t)?(si(),!0):!1,onDrag:(r,o)=>{this.moveContainer(e,r,o),this.updateSelectionVisuals(),hl(t,r,o)},onDragEnd:(r,o)=>{fl(t),e.data.x=Math.round(r),e.data.y=Math.round(o),vt(t,{x:e.data.x,y:e.data.y})}}});this.cleanupFunctions.set(t,s)}setupBackgroundDeselect(){this.scene.input.on("pointerdown",e=>{if(Vt())return;let t="items";if(Re.subscribe(o=>t=o)(),t!=="frames"&&t!=="items")return;this.scene.input.hitTestPointer(e).some(o=>{for(const[l,a]of this.frames)if(a.sprite===o)return!0;return!1})||(ln(null),this.updateSelectionVisuals())})}setupStoreSubscriptions(){const e=mi.subscribe(r=>{this.scene.data.set("selectedFrameId",r),this.updateSelectionVisuals()});this.unsubscribers.push(e);const t=Re.subscribe(r=>{r==="dialogs"?(ln(null),this.setInteractiveEnabled(!1)):this.setInteractiveEnabled(!0)});this.unsubscribers.push(t);let i=[];const s=jr.subscribe(r=>{i.forEach(o=>{r.find(a=>a.id===o.id)||this.removeFrame(o.id)}),r.forEach(o=>{const l=i.find(d=>d.id===o.id),a=this.frames.get(o.id);if(a&&l){const d=l.backgroundColor!==o.backgroundColor,u=l.textColor!==o.textColor,h=l.textSize!==o.textSize,f=JSON.stringify(l.texts)!==JSON.stringify(o.texts),g=l.rotation!==o.rotation,p=l.scale!==o.scale,_=l.frameKey!==o.frameKey;a.data=o,(d||u||h||f||g||p||_)&&(this.updateFrameVisuals(a),this.scene.data.get("selectedFrameId")===o.id&&this.updateSelectionVisuals())}}),i=r.map(o=>({...o}))});this.unsubscribers.push(s)}setupFrameDropListener(){const e=we.on(be.FRAME_DROPPED,t=>{const{frameKey:i,canvasX:s,canvasY:r}=t,l=this.scene.cameras.main.getWorldPoint(s,r),a={id:Gl(),frameKey:i,x:Math.round(l.x),y:Math.round(l.y),scale:nc(i),depth:We.ITEMS_FRONT,rotation:90,backgroundColor:En,textColor:"#333333",textSize:16,texts:[{language:"cs",text:""},{language:"en",text:""}]};Dl(a),this.createFrame(a),ln(a.id),si()});this.unsubscribers.push(()=>e.unsubscribe())}setupDeleteKeys(){const e=this.scene.input.keyboard.addKey(W.Input.Keyboard.KeyCodes.DELETE,!1),t=this.scene.input.keyboard.addKey(W.Input.Keyboard.KeyCodes.BACKSPACE,!1),i=()=>{if(Cn())return;let s="items";if(Re.subscribe(l=>s=l)(),s!=="frames")return;const o=this.scene.data.get("selectedFrameId");o&&cs(o)};e.on("down",i),t.on("down",i)}updateSelectionVisuals(){if(!this.selectionGraphics)return;this.selectionGraphics.clear();const e=this.scene.data.get("selectedFrameId");if(!e){Ci(null);return}const t=this.frames.get(e);if(!t){Ci(null);return}const i=t.sprite,s=i.getBounds(),r=this.scene.cameras.main,{screenX:o,screenY:l}=an(i.x,i.y,r);Ci({screenX:o,screenY:l,frameHeight:s.height*r.zoom}),this.selectionGraphics.lineStyle(3,10181046,1),this.selectionGraphics.strokeRect(s.x-4,s.y-4,s.width+8,s.height+8);const a=8;this.selectionGraphics.fillStyle(10181046,1),this.selectionGraphics.fillRect(s.x-4-a/2,s.y-4-a/2,a,a),this.selectionGraphics.fillRect(s.right+4-a/2,s.y-4-a/2,a,a),this.selectionGraphics.fillRect(s.x-4-a/2,s.bottom+4-a/2,a,a),this.selectionGraphics.fillRect(s.right+4-a/2,s.bottom+4-a/2,a,a)}removeFrame(e){const t=this.frames.get(e);t&&(t.sprite.destroy(),t.background.destroy(),this.frames.delete(e)),this.updateSelectionVisuals()}setInteractiveEnabled(e){this.frames.forEach(({sprite:t,background:i})=>{e?(t.setInteractive({draggable:!0,useHandCursor:!0}),t.setAlpha(1),i.setAlpha(1)):(t.disableInteractive(),t.setAlpha(.6),i.setAlpha(.6))}),!e&&this.selectionGraphics&&this.selectionGraphics.clear()}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.frames.forEach(({sprite:e,background:t})=>{e.destroy(),t.destroy()}),this.frames.clear(),this.selectionGraphics&&(this.selectionGraphics.destroy(),this.selectionGraphics=null)}}const Ct=ro-1,Dt=50,Bs=150,uc=.3,hc=.5,Ti=40,Zs=60,Ws=16777215,Ys=.6,zs=0,st=60,Gs=8;class fc{scene;worldWidth;worldHeight;graphics=null;zoneAreas=new Map;leftHandles=new Map;leftHandleVisuals=new Map;rightHandles=new Map;rightHandleVisuals=new Map;arrowGraphics=new Map;dragging=null;unsubscribers=[];createZoneSubscription;currentEditMode="items";currentZones=[];currentSelectedId=null;lastClickTime=0;lastClickX=0;DOUBLE_CLICK_THRESHOLD=300;DOUBLE_CLICK_DISTANCE=20;pendingTap=null;TAP_MAX_DURATION=300;TAP_MAX_DISTANCE=15;pendingZoneSelection=null;createZoneAtSubscription;boundWindowPointerUp=()=>{};boundWindowPointerMove=()=>{};currentScreenX=0;autoScrollTimer=null;constructor(e,t,i){this.scene=e,this.worldWidth=t,this.worldHeight=i}create(){this.graphics=this.scene.add.graphics(),this.graphics.setDepth(Ct);const e=Re.subscribe(s=>{this.currentEditMode=s,this.render()});this.unsubscribers.push(e);const t=ss.subscribe(s=>{this.currentZones=s,this.render()});this.unsubscribers.push(t);const i=vi.subscribe(s=>{this.currentSelectedId=s,this.render()});this.unsubscribers.push(i),this.scene.input.on("pointermove",this.handlePointerMove,this),this.scene.input.on("pointerup",this.handlePointerUp,this),this.boundWindowPointerUp=this.handlePointerUp.bind(this),this.boundWindowPointerMove=this.handleWindowPointerMove.bind(this),window.addEventListener("pointerup",this.boundWindowPointerUp),window.addEventListener("pointermove",this.boundWindowPointerMove),this.scene.input.on("pointerdown",this.handlePointerDown,this),this.createZoneSubscription=we.on(be.DIALOG_ZONE_CREATE,()=>{this.createNewZone()}),this.createZoneAtSubscription=we.on(be.DIALOG_ZONE_CREATE_AT,s=>{this.createZoneAtPosition(s.worldX)}),this.render()}clearVisuals(){this.graphics&&this.graphics.clear(),this.zoneAreas.forEach(e=>e.destroy()),this.zoneAreas.clear(),this.leftHandles.forEach(e=>e.destroy()),this.leftHandles.clear(),this.rightHandles.forEach(e=>e.destroy()),this.rightHandles.clear(),this.leftHandleVisuals.forEach(e=>e.destroy()),this.leftHandleVisuals.clear(),this.rightHandleVisuals.forEach(e=>e.destroy()),this.rightHandleVisuals.clear(),this.arrowGraphics.forEach(e=>e.destroy()),this.arrowGraphics.clear()}render(){if(this.clearVisuals(),this.currentEditMode==="dialogs")for(const e of this.currentZones)this.renderZone(e,e.id===this.currentSelectedId)}renderZone(e,t){if(!this.graphics)return;const i=W.Display.Color.HexStringToColor(e.color).color,s=t?hc:uc;this.graphics.fillStyle(i,s),this.graphics.fillRect(e.x,0,e.width,this.worldHeight),this.graphics.lineStyle(2,i,.8),this.graphics.strokeRect(e.x,0,e.width,this.worldHeight);const r=this.scene.add.rectangle(e.x+e.width/2,this.worldHeight/2,e.width-Ti*2,this.worldHeight);r.setOrigin(.5,.5),r.setInteractive({cursor:t?"grab":"pointer"}),r.setDepth(Ct+.1),r.setAlpha(.001),r.setData("zoneId",e.id),r.on("pointerdown",o=>{if(this.isClickOnUIElement(o))return;const l=Date.now(),a=l-this.lastClickTime<this.DOUBLE_CLICK_THRESHOLD&&Math.abs(o.worldX-this.lastClickX)<this.DOUBLE_CLICK_DISTANCE;this.lastClickTime=l,this.lastClickX=o.worldX;const d=this.currentSelectedId===e.id;if(a&&d){eo();return}d?(this.scene.data.set("isDraggingItem",!0),Dn(!0),this.startDrag(e.id,"move",o.worldX)):this.pendingZoneSelection={zoneId:e.id,worldX:o.worldX,startTime:l}}),this.zoneAreas.set(e.id,r),t&&this.createHandles(e)}createHandles(e){const t=this.scene.cameras.main.scrollY,i=this.scene.cameras.main.height,s=t+i/2,r=this.scene.add.rectangle(e.x,this.worldHeight/2,Ti,this.worldHeight);r.setOrigin(.5,.5),r.setDepth(Ct+.2),r.setFillStyle(Ws,Ys);const o=this.scene.add.rectangle(e.x,this.worldHeight/2,Zs,this.worldHeight);o.setOrigin(.5,.5),o.setInteractive({cursor:"ew-resize"}),o.setDepth(Ct+.25),o.setAlpha(.001),o.setData("zoneId",e.id),o.setData("type","left"),o.on("pointerdown",f=>{this.isClickOnUIElement(f)||this.startDrag(e.id,"left",f.worldX)}),this.leftHandles.set(e.id,o),this.leftHandleVisuals.set(e.id,r);const l=8,a=this.scene.add.graphics();a.setDepth(Ct+.3),this.drawArrow(a,e.x-l,s,"left"),this.arrowGraphics.set(`${e.id}_left`,a);const d=this.scene.add.rectangle(e.x+e.width,this.worldHeight/2,Ti,this.worldHeight);d.setOrigin(.5,.5),d.setDepth(Ct+.2),d.setFillStyle(Ws,Ys);const u=this.scene.add.rectangle(e.x+e.width,this.worldHeight/2,Zs,this.worldHeight);u.setOrigin(.5,.5),u.setInteractive({cursor:"ew-resize"}),u.setDepth(Ct+.25),u.setAlpha(.001),u.setData("zoneId",e.id),u.setData("type","right"),u.on("pointerdown",f=>{this.isClickOnUIElement(f)||this.startDrag(e.id,"right",f.worldX)}),this.rightHandles.set(e.id,u),this.rightHandleVisuals.set(e.id,d);const h=this.scene.add.graphics();h.setDepth(Ct+.3),this.drawArrow(h,e.x+e.width+l,s,"right"),this.arrowGraphics.set(`${e.id}_right`,h)}drawArrow(e,t,i,s){const o=s==="left"?-1:1;e.fillStyle(3355443,.8),e.beginPath(),e.moveTo(t+o*10+1,i),e.lineTo(t-o*10+1,i-10+1),e.lineTo(t-o*10+1,i+10-1),e.closePath(),e.fillPath(),e.fillStyle(16777215,.9),e.beginPath(),e.moveTo(t+o*10,i),e.lineTo(t-o*10,i-10),e.lineTo(t-o*10,i+10),e.closePath(),e.fillPath()}startDrag(e,t,i){const s=this.currentZones.find(r=>r.id===e);s&&(this.scene.data.set("isDraggingItem",!0),Dn(!0),this.dragging={zoneId:e,type:t,startX:i,originalX:s.x,originalWidth:s.width})}getZoneBounds(e){let t=0,i=this.worldWidth;for(const s of this.currentZones){if(s.id===e)continue;const r=s.x+s.width,o=this.currentZones.find(l=>l.id===e);o&&(r<=o.x+o.width/2&&(t=Math.max(t,r+zs)),s.x>=o.x+o.width/2&&(i=Math.min(i,s.x-zs)))}return{minX:t,maxX:i-Dt,maxRight:i}}wouldOverlap(e,t,i){const s=t+i;for(const r of this.currentZones){if(r.id===e)continue;const o=r.x,l=r.x+r.width;if(t<l&&s>o)return!0}return!1}isClickOnUIElement(e){const t=e.downElement;return t?t.tagName?.toUpperCase()!=="CANVAS":!1}cancelPendingIfMoved(e){this.pendingTap&&Math.abs(e-this.pendingTap.worldX)>this.TAP_MAX_DISTANCE&&(this.pendingTap=null),this.pendingZoneSelection&&Math.abs(e-this.pendingZoneSelection.worldX)>this.TAP_MAX_DISTANCE&&(this.pendingZoneSelection=null)}screenToWorld(e,t){const i=this.scene.cameras.main,r=this.scene.game.canvas.getBoundingClientRect(),o=e-r.left,l=t-r.top;return Qa(o,l,i)}handleWindowPointerMove(e){const t=this.screenToWorld(e.clientX,e.clientY);if(this.cancelPendingIfMoved(t.worldX),!this.dragging)return;const s=this.scene.game.canvas.getBoundingClientRect();e.clientX>=s.left&&e.clientX<=s.right&&e.clientY>=s.top&&e.clientY<=s.bottom||(this.currentScreenX=e.clientX-s.left,this.updateDrag(t.worldX),this.checkAutoScroll())}handlePointerMove(e){this.cancelPendingIfMoved(e.worldX),this.dragging&&(this.currentScreenX=e.x,e.event?.stopPropagation?.(),this.updateDrag(e.worldX),this.checkAutoScroll())}checkAutoScroll(){if(!this.dragging||this.dragging.type!=="move"){this.stopAutoScroll();return}const e=this.scene.cameras.main,t=e.width,i=this.currentZones.find(E=>E.id===this.dragging?.zoneId);if(!i)return;const s=Math.max(0,this.worldWidth-e.width/e.zoom);if(s<=0){this.stopAutoScroll();return}const{screenX:r}=an(i.x,0,e),{screenX:o}=an(i.x+i.width,0,e),l=r<=st,a=o>=t-st,d=e.scrollX>0,u=e.scrollX<s,h=i.x>0,f=i.x+i.width<this.worldWidth,g=this.currentScreenX<st,p=this.currentScreenX>t-st,v=l&&g&&d&&h||a&&p&&u&&f;v&&!this.autoScrollTimer?this.autoScrollTimer=this.scene.time.addEvent({delay:16,callback:this.performAutoScroll,callbackScope:this,loop:!0}):!v&&this.autoScrollTimer&&this.stopAutoScroll()}performAutoScroll(){if(!this.dragging||this.dragging.type!=="move"){this.stopAutoScroll();return}const e=this.scene.cameras.main,t=e.width,i=this.currentZones.find(w=>w.id===this.dragging?.zoneId);if(!i)return;let s=0;if(this.currentScreenX<st){if(i.x<=0){this.stopAutoScroll();return}const v=(st-this.currentScreenX)/st;s=-Gs*v}else if(this.currentScreenX>t-st){if(i.x+i.width>=this.worldWidth){this.stopAutoScroll();return}const v=(this.currentScreenX-(t-st))/st;s=Gs*v}if(s===0)return;const r=e.scrollX+s,o=0,l=Math.max(0,this.worldWidth-e.width/e.zoom),d=Math.max(o,Math.min(l,r))-e.scrollX;if(l<=0){this.stopAutoScroll();return}if(d===0){this.stopAutoScroll();return}const u=i.x+d,h=Math.max(0,Math.min(this.worldWidth-i.width,u)),f=h-i.x;if(f===0){this.stopAutoScroll();return}const g=e.scrollX+f,p=Math.max(0,Math.min(l,g));if(Math.abs(p-e.scrollX)>Math.abs(f)*2){this.stopAutoScroll();return}e.scrollX=p,this.wouldOverlap(i.id,h,i.width)||(sn(i.id,{x:h}),this.dragging.originalX+=f,this.dragging.startX+=f)}stopAutoScroll(){this.autoScrollTimer&&(this.autoScrollTimer.destroy(),this.autoScrollTimer=null)}updateDrag(e){if(!this.dragging)return;const t=e-this.dragging.startX,i=this.currentZones.find(r=>r.id===this.dragging?.zoneId);if(!i)return;const s=this.getZoneBounds(i.id);if(this.dragging.type==="left"){let r=this.dragging.originalX+t,o=this.dragging.originalWidth-t;if(r<0&&(o+=r,r=0),o<Dt&&(r=this.dragging.originalX+this.dragging.originalWidth-Dt,o=Dt),r<s.minX){const l=s.minX-r;r=s.minX,o-=l}o>=Dt&&!this.wouldOverlap(i.id,r,o)&&sn(i.id,{x:r,width:o})}else if(this.dragging.type==="right"){let r=this.dragging.originalWidth+t;r<Dt&&(r=Dt),i.x+r>this.worldWidth&&(r=this.worldWidth-i.x),i.x+r>s.maxRight&&(r=s.maxRight-i.x),r>=Dt&&!this.wouldOverlap(i.id,i.x,r)&&sn(i.id,{width:r})}else if(this.dragging.type==="move"){let r=this.dragging.originalX+t;const o=i.width;if(r<0&&(r=0),r+o>this.worldWidth&&(r=this.worldWidth-o),!this.wouldOverlap(i.id,r,o))sn(i.id,{x:r});else{const l=this.findNonOverlappingPosition(i.id,r,o);l!==null&&sn(i.id,{x:l})}}}findNonOverlappingPosition(e,t,i){const s=this.currentZones.filter(u=>u.id!==e).sort((u,h)=>u.x-h.x);if(s.length===0)return Math.max(0,Math.min(t,this.worldWidth-i));let r=t,o=1/0;const l=s[0];if(l.x>=i){const u=l.x-i,h=Math.max(0,Math.min(t,u)),f=Math.abs(h-t);f<o&&(o=f,r=h)}for(let u=0;u<s.length-1;u++){const h=s[u],f=s[u+1],g=h.x+h.width,p=f.x;if(p-g>=i){const w=g,v=p-i,E=Math.max(w,Math.min(t,v)),A=Math.abs(E-t);A<o&&(o=A,r=E)}}const a=s[s.length-1],d=a.x+a.width;if(this.worldWidth-d>=i){const u=d,h=this.worldWidth-i,f=Math.max(u,Math.min(t,h)),g=Math.abs(f-t);g<o&&(o=g,r=f)}return o<1/0&&!this.wouldOverlap(e,r,i)?r:null}handlePointerUp(e){if(this.dragging&&(this.stopAutoScroll(),this.scene.data.set("isDraggingItem",!1),Dn(!1),this.dragging=null),this.pendingZoneSelection){let s=Date.now()-this.pendingZoneSelection.startTime<this.TAP_MAX_DURATION;s&&e&&e.worldX!==void 0&&(s=Math.abs(e.worldX-this.pendingZoneSelection.worldX)<this.TAP_MAX_DISTANCE),s&&Tn(this.pendingZoneSelection.zoneId),this.pendingZoneSelection=null}if(this.pendingTap&&this.currentEditMode==="dialogs"){if(Date.now()-this.pendingTap.startTime<this.TAP_MAX_DURATION){let s=!0;e&&e.worldX!==void 0&&(s=Math.abs(e.worldX-this.pendingTap.worldX)<this.TAP_MAX_DISTANCE),s&&this.showTempAddButton(this.pendingTap.worldX,this.pendingTap.worldY)}this.pendingTap=null}}handlePointerDown(e){if(Vt()||this.currentEditMode!=="dialogs"||this.dragging)return;const t=e.downElement;if(t&&t.tagName?.toUpperCase()!=="CANVAS")return;const i=e.worldX;for(const l of this.currentZones)if(i>=l.x&&i<=l.x+l.width)return;const s=Date.now(),r=s-this.lastClickTime,o=Math.abs(i-this.lastClickX);if(r<this.DOUBLE_CLICK_THRESHOLD&&o<this.DOUBLE_CLICK_DISTANCE){this.createZoneAtPosition(i),this.lastClickTime=0,this.hideTempAddButton();return}this.lastClickTime=s,this.lastClickX=i,this.pendingTap={worldX:i,worldY:e.worldY,startTime:s},this.currentSelectedId&&Tn(null)}showTempAddButton(e,t){const i=this.scene.cameras.main,{screenX:s,screenY:r}=an(e,t,i);we.emit(be.TEMP_ZONE_BUTTON_SHOW,{screenX:s,screenY:r,worldX:e})}hideTempAddButton(){we.emit(be.TEMP_ZONE_BUTTON_HIDE,{})}createZoneAtPosition(e){this.createZoneAt(e)}createNewZone(){const e=this.scene.cameras.main,t=e.worldView.x+e.worldView.width/2;this.createZoneAt(t)}createZoneAt(e){let t=e-Bs/2;const i=Bs;if(t=Math.max(0,Math.min(this.worldWidth-i,t)),this.wouldOverlap("",t,i)){const r=this.findNonOverlappingPosition("",t,i);if(r===null){console.warn("No room for a new dialog zone");return}t=r}const s=Ba(t,i);s.x=t,Cl(s),Tn(s.id)}updateSelectionVisuals(){if(this.currentEditMode!=="dialogs"){Wn(null);return}if(!this.currentSelectedId){Wn(null);return}const e=this.currentZones.find(o=>o.id===this.currentSelectedId);if(!e){Wn(null);return}const t=this.scene.cameras.main,i=e.x+e.width/2,{screenX:s}=an(i,0,t),r=t.height*.65;Wn({screenX:s,screenY:r})}destroy(){this.hideTempAddButton();for(const e of this.unsubscribers)e();this.unsubscribers=[],this.createZoneSubscription&&this.createZoneSubscription.unsubscribe(),this.createZoneAtSubscription&&this.createZoneAtSubscription.unsubscribe(),this.stopAutoScroll(),this.scene.input.off("pointerdown",this.handlePointerDown,this),this.scene.input.off("pointermove",this.handlePointerMove,this),this.scene.input.off("pointerup",this.handlePointerUp,this),window.removeEventListener("pointerup",this.boundWindowPointerUp),window.removeEventListener("pointermove",this.boundWindowPointerMove),this.clearVisuals(),this.graphics&&(this.graphics.destroy(),this.graphics=null),this.dragging=null}}class gc extends W.Scene{parallaxLayers=null;cameraController;playerController;gridOverlay;itemsController;framesController;dialogZoneRenderer;config;minimapSubscription;isShuttingDown=!1;get itemManager(){return this.itemsController?.getManager()}toggleZoom(){this.cameraController?.toggleZoomToFit()}constructor(){super({key:wt.BUILDER})}init(e){this.config=e.config}preload(){this.load.spritesheet("cat-idle-white","assets/sprites/white/Idle.png",{frameWidth:48,frameHeight:48}),ai.preloadAssets(this),Ns.preloadAssets(this)}create(){this.isShuttingDown=!1,this.physics.world.setBounds(0,0,this.config.worldWidth,this.config.worldHeight);const e=this.config.worldHeight-ri;this.cameraController=new oc(this,this.config.worldWidth,this.config.worldHeight),this.playerController=new ac(this,this.config.worldWidth,this.config.worldHeight),this.gridOverlay=new lc(this,this.config.worldWidth,this.config.worldHeight),this.itemsController=new dc(this,e,this.config.worldWidth,this.config.worldHeight),this.framesController=new Ns(this,this.config.worldWidth,this.config.worldHeight),this.dialogZoneRenderer=new fc(this,this.config.worldWidth,this.config.worldHeight),this.createBackground(),this.gridOverlay.create(),this.createGroundReference(),this.playerController.create(this.config.playerStartX,this.config.playerStartY),this.itemsController.create(this.config.placedItems||[]),this.framesController.create(this.config.placedFrames||[]),this.dialogZoneRenderer.create(),this.cameraController.setup(),this.cameraController.centerOn(this.config.playerStartX,this.config.playerStartY),this.minimapSubscription=we.on(be.MINIMAP_NAVIGATE,t=>{this.navigateToPosition(t.worldX,t.worldY)}),this.scale.on("resize",this.handleResize,this),this.events.on("shutdown",this.shutdown,this)}async createBackground(){const e=ii.getCurrentConfig();try{await Yr(this,e)}catch(t){console.error("Failed to load background:",t);return}this.parallaxLayers&&(il(this.parallaxLayers),this.parallaxLayers=null),this.parallaxLayers=zr(this,this.config.worldWidth,this.config.worldHeight,e)}createGroundReference(){Ln.createVisualGround(this,{worldWidth:this.config.worldWidth,worldHeight:this.config.worldHeight,height:ri})}update(){this.parallaxLayers&&Gr(this.parallaxLayers.baseLayer,this.cameras.main),this.itemManager?.updateSelectionVisuals(),this.framesController?.updateSelectionVisuals(),this.dialogZoneRenderer?.updateSelectionVisuals();const e=this.cameras.main,t=this.data.get("playerSprite");Il({scrollX:e.worldView.x,scrollY:e.worldView.y,viewWidth:e.width,viewHeight:e.height,worldWidth:this.config.worldWidth,worldHeight:this.config.worldHeight,zoom:e.zoom,playerX:t?.x??this.config.playerStartX,playerY:t?.y??this.config.playerStartY})}navigateToPosition(e,t){this.cameraController.getIsZoomedOut()||this.cameraController.centerOn(e,t)}handleResize(e){if(!(!this.cameras?.main||!this.config)){if(this.cameraController?.getIsZoomedOut()||this.cameras.main.setBounds(0,0,this.config.worldWidth,this.config.worldHeight),this.parallaxLayers?.baseLayer){const t=Math.max(this.config.worldHeight,e.height);this.parallaxLayers.baseLayer.setSize(this.config.worldWidth,t)}this.gridOverlay&&this.gridOverlay.redraw()}}shutdown(){this.isShuttingDown||(this.isShuttingDown=!0,this.scale.off("resize",this.handleResize,this),this.minimapSubscription&&this.minimapSubscription.unsubscribe(),this.cameraController&&this.cameraController.destroy(),this.playerController&&this.playerController.destroy(),this.gridOverlay&&this.gridOverlay.destroy(),this.itemsController&&this.itemsController.destroy(),this.framesController&&this.framesController.destroy(),this.dialogZoneRenderer&&this.dialogZoneRenderer.destroy())}}const pc="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(pc);Ho();class vc{currentLanguage="cs";setLanguage(e){this.currentLanguage=e,localStorage.setItem("language",e)}getLanguage(){const e=localStorage.getItem("language");return(e==="cs"||e==="en")&&(this.currentLanguage=e),this.currentLanguage}toggleLanguage(){return this.currentLanguage=this.currentLanguage==="cs"?"en":"cs",this.setLanguage(this.currentLanguage),this.currentLanguage}}const lo=new vc;let Ve=null;function mc(n){Ve=n}function _c(){if(!Ve)return console.error("Scene manager not initialized"),null;try{return Ve.scene.getScene(wt.GAME)?.mapConfig||null}catch(n){return console.error("Failed to get map config:",n),null}}function yc(n){if(!Ve)return console.error("Scene manager not initialized"),!1;try{return Ve.scene.getScene(wt.GAME)?(Ve.scene.stop(wt.GAME),Sl(n),Ve.scene.start(wt.BUILDER,{config:n}),!0):(console.error("GameScene not found"),!1)}catch(e){return console.error("Failed to switch to builder:",e),!1}}function wc(){if(!Ve)return console.error("Scene manager not initialized"),!1;try{return Ve.scene.stop(wt.BUILDER),El(),Ve.scene.start(wt.GAME,{useBuilderConfig:!0}),!0}catch(n){return console.error("Failed to switch to game:",n),!1}}function co(){if(Ve)try{Ve.scene.getScene(wt.BUILDER)?.toggleZoom()}catch(n){console.error("Failed to toggle zoom:",n)}}var bc=F('<button class="close-btn svelte-yrmttr" title="Close">Ã</button>'),Sc=F('<div class="resize-handle resize-handle-sw svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M1 1L9 9M1 5L5 9M1 9L1 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></div> <div class="resize-handle resize-handle-se svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M9 1L1 9M9 5L5 9M9 9L9 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></div>',1),Ec=F("<div><!></div> <!>",1),xc=F('<div data-ui=""><div class="panel-header svelte-yrmttr"><span class="panel-title svelte-yrmttr"> </span> <!> <div class="header-buttons svelte-yrmttr"><button class="minimize-btn svelte-yrmttr"> </button> <!></div></div> <!></div>');function yi(n,e){ue(e,!0);const t=()=>L(Rt,"$isDraggingInBuilder",i),[i,s]=Ie();let r=1e3,o=ee(e,"initialRight",3,10),l=ee(e,"initialTop",3,60),a=ee(e,"width",3,280),d=ee(e,"minWidth",3,200),u=ee(e,"minHeight",3,100),h=ee(e,"maxWidth",3,600),f=ee(e,"maxHeight",3,800),g=ee(e,"resizable",3,!1),p=ee(e,"startMinimized",3,!1),_=ee(e,"showClose",3,!1),w=Y(Ke(p())),v=Y(Ke({x:0,y:0})),E=Y(Ke({width:a(),height:e.height??0})),A=Y(!1),x=Y(!1),m=Y("se"),y=Y(Ke({x:0,y:0})),b=Y(null),D=Y(!1),T=Y(Ke(r));function N(){r++,P(T,r,!0)}Se(()=>{if(typeof window>"u")return;const R=localStorage.getItem(`panel-state-${e.panelId}`);if(R)try{const Z=JSON.parse(R);P(v,{x:Z.x,y:Z.y},!0),g()&&Z.width&&Z.height&&P(E,{width:Z.width,height:Z.height},!0)}catch{P(v,{x:window.innerWidth-a()-o(),y:l()},!0)}else P(v,{x:window.innerWidth-a()-o(),y:l()},!0);P(D,!0)}),Se(()=>{if(!c(D))return;const R=g()?{...c(v),width:c(E).width,height:c(E).height}:c(v);localStorage.setItem(`panel-state-${e.panelId}`,JSON.stringify(R))}),Se(()=>{if(!c(D))return;function R(){if(!c(b))return;const Z=g()?c(E).width:a();let ie=c(v).x,Ae=c(v).y,le=!1;const Ye=window.innerWidth-Z;c(v).x>Ye&&(ie=Math.max(10,Ye),le=!0);const xt=window.innerHeight-40;c(v).y>xt&&(Ae=Math.max(10,xt),le=!0),c(v).x<0&&(ie=10,le=!0),c(v).y<0&&(Ae=10,le=!0),le&&P(v,{x:ie,y:Ae},!0)}return window.addEventListener("resize",R),R(),()=>{window.removeEventListener("resize",R)}});function C(){P(w,!c(w))}function $(){e.onclose?.()}function I(R){R.target.closest("button")||(P(A,!0),P(y,{x:R.clientX-c(v).x,y:R.clientY-c(v).y},!0),R.currentTarget.setPointerCapture(R.pointerId),R.preventDefault())}function H(R){if(!c(A))return;const Z=R.clientX-c(y).x,ie=R.clientY-c(y).y,Ae=window.innerWidth-(c(b)?.offsetWidth??a()),le=window.innerHeight-40;P(v,{x:Math.max(0,Math.min(Z,Ae)),y:Math.max(0,Math.min(ie,le))},!0)}function k(R){c(A)&&(P(A,!1),R.currentTarget.releasePointerCapture(R.pointerId))}function B(R){return Z=>{g()&&(P(x,!0),P(m,R,!0),Z.currentTarget.setPointerCapture(Z.pointerId),Z.preventDefault(),Z.stopPropagation())}}function V(R){if(!c(x)||!c(b))return;const Z=c(b).getBoundingClientRect();let ie,Ae=R.clientY-Z.top,le=c(v).x;c(m)==="se"?ie=R.clientX-Z.left:(ie=Z.right-R.clientX,le=R.clientX);const Ye=Math.max(d(),Math.min(h(),ie)),xt=Math.max(u(),Math.min(f(),Ae));c(m)==="sw"&&(le=Z.right-Ye,le<0&&(le=0));const Ft=c(m)==="se"?window.innerWidth-c(v).x-10:Z.right-10,qt=window.innerHeight-c(v).y-10,gt=Math.min(Ye,Ft),Jt=Math.min(xt,qt);P(E,{width:gt,height:Jt},!0),c(m)==="sw"&&ie>=d()&&P(v,{...c(v),x:Math.max(0,le)},!0)}function j(R){c(x)&&(P(x,!1),R.currentTarget.releasePointerCapture(R.pointerId))}function tt(R){R.stopPropagation()}var de=xc();let Xe;de.__pointerdown=R=>{N(),tt(R)},de.__click=tt;var Ce=O(de);Ce.__pointerdown=I,Ce.__pointermove=H,Ce.__pointerup=k;var me=O(Ce),nt=O(me),_e=M(me,2);{var $e=R=>{var Z=Ee(),ie=ae(Z);gn(ie,()=>e.headerExtra),S(R,Z)};K(_e,R=>{e.headerExtra&&R($e)})}var De=M(_e,2),Te=O(De);Te.__click=C;var ht=O(Te),Ne=M(Te,2);{var ft=R=>{var Z=bc();Z.__click=$,S(R,Z)};K(Ne,R=>{_()&&R(ft)})}var qe=M(Ce,2);{var Ht=R=>{var Z=Ec(),ie=ae(Z);let Ae;var le=O(ie);gn(le,()=>e.children);var Ye=M(ie,2);{var xt=Ft=>{var qt=Sc(),gt=ae(qt),Jt=X(()=>B("sw"));gt.__pointerdown=function(...fe){c(Jt)?.apply(this,fe)},gt.__pointermove=V,gt.__pointerup=j;var Qt=M(gt,2),Q=X(()=>B("se"));Qt.__pointerdown=function(...fe){c(Q)?.apply(this,fe)},Qt.__pointermove=V,Qt.__pointerup=j,Ot("pointercancel",gt,j),Ot("pointercancel",Qt,j),S(Ft,qt)};K(Ye,Ft=>{g()&&Ft(xt)})}G(()=>Ae=Pe(ie,1,"panel-body svelte-yrmttr",null,Ae,{"has-fixed-height":g()&&c(E).height>0})),S(R,Z)};K(qe,R=>{c(w)||R(Ht)})}pn(de,R=>P(b,R),()=>c(b)),G(()=>{Xe=Pe(de,1,"draggable-panel svelte-yrmttr",null,Xe,{minimized:c(w),dragging:c(A),resizing:c(x),resizable:g()}),ce(de,`left: ${c(v).x??""}px; top: ${c(v).y??""}px; width: ${c(w)?"auto":`${g()?c(E).width:a()}px`}; ${g()&&c(E).height>0&&!c(w)?`height: ${c(E).height}px;`:""}${t()?" pointer-events: none;":""} z-index: ${c(T)??""};`),xe(nt,e.title),te(Te,"title",c(w)?"Expand":"Minimize"),xe(ht,c(w)?"â²":"â¼")}),Ot("pointercancel",Ce,k),S(n,de),he(),s()}et(["pointerdown","click","pointermove","pointerup"]);const Gn=10;function uo(n,e,t){const{previewSize:i,borderColor:s,dataKey:r,eventName:o,onDrop:l}=n,a=i/2;let d=0,u=0,h=!1;function f(m,y){if(!m.dataTransfer)return;t({draggedKey:y}),Zn(!0),m.dataTransfer.effectAllowed="copy",m.dataTransfer.setData(r,y);const D=m.target.querySelector("img")?.cloneNode(!0);D&&(D.style.position="absolute",D.style.top="-1000px",document.body.appendChild(D),m.dataTransfer.setDragImage(D,a,a),setTimeout(()=>D.remove(),0))}function g(){t({draggedKey:null}),Zn(!1)}function p(m,y){if(m.touches.length!==1)return;const b=m.touches[0];d=b.clientX,u=b.clientY,h=!1,t({draggedKey:y}),Zn(!0);const T=m.currentTarget.querySelector("img");if(T){const N=document.createElement("div");N.className="touch-drag-preview",N.innerHTML=`<img src="${T.src}" alt="" />`,N.style.cssText=`
        position: fixed;
        top: ${b.clientY-a}px;
        left: ${b.clientX-a}px;
        width: ${i}px;
        height: ${i}px;
        pointer-events: none;
        z-index: 10000;
        opacity: 0.9;
        image-rendering: pixelated;
        filter: drop-shadow(3px 3px 0 rgba(0, 0, 0, 0.5));
        border: 2px solid ${s};
        background: rgba(26, 26, 46, 0.9);
      `,N.querySelector("img").style.cssText=`
        width: 100%;
        height: 100%;
        object-fit: contain;
        image-rendering: pixelated;
      `,document.body.appendChild(N),t({touchDragElement:N})}}function _(m){const y=e();if(!y.draggedKey||!y.touchDragElement)return;const b=m.touches[0];if(y.touchDragElement.style.top=`${b.clientY-a}px`,y.touchDragElement.style.left=`${b.clientX-a}px`,!h){const D=b.clientX-d,T=b.clientY-u;(Math.abs(D)>Gn||Math.abs(T)>Gn)&&(h=!0)}m.preventDefault()}function w(m){const y=e();if(!y.draggedKey)return;const b=m.changedTouches[0],D=document.querySelector("canvas");if(y.touchDragElement&&(y.touchDragElement.remove(),t({touchDragElement:null})),!h){const T=b.clientX-d,N=b.clientY-u;(Math.abs(T)>Gn||Math.abs(N)>Gn)&&(h=!0)}if(D&&h){const T=D.getBoundingClientRect(),N=b.clientX,C=b.clientY;if(N>=T.left&&N<=T.right&&C>=T.top&&C<=T.bottom){const $=N-T.left,I=C-T.top;we.emit(o,{[r]:y.draggedKey,canvasX:$,canvasY:I}),l?.()}}t({draggedKey:null}),Zn(!1)}function v(m){m.preventDefault(),m.dataTransfer&&(m.dataTransfer.dropEffect="copy")}function E(m){m.preventDefault();const y=m.dataTransfer?.getData(r);if(!y)return;const D=m.target.getBoundingClientRect(),T=m.clientX-D.left,N=m.clientY-D.top;we.emit(o,{[r]:y,canvasX:T,canvasY:N}),l?.()}function A(){const m=document.querySelector("canvas");return m?(m.addEventListener("dragover",v),m.addEventListener("drop",E),()=>{m.removeEventListener("dragover",v),m.removeEventListener("drop",E)}):()=>{}}function x(){return document.addEventListener("touchmove",_,{passive:!1}),document.addEventListener("touchend",w),document.addEventListener("touchcancel",w),()=>{document.removeEventListener("touchmove",_),document.removeEventListener("touchend",w),document.removeEventListener("touchcancel",w)}}return{onDragStart:f,onDragEnd:g,onTouchStart:p,onTouchMove:_,onTouchEnd:w,setupCanvasListeners:A,setupTouchListeners:x}}var Ic=F('<span class="palette-hint svelte-1ahretz">Drag to place</span>'),Cc=F('<div data-ui="" draggable="true" role="button" tabindex="0"><img class="item-preview svelte-1ahretz"/></div>'),Dc=F('<div class="palette-content svelte-1ahretz" role="toolbar" tabindex="-1"><div class="palette-grid svelte-1ahretz"></div></div>');function Tc(n,e){ue(e,!0);const t=()=>L(dn,"$isAssetPaletteOpen",s),i=()=>L(Re,"$builderEditMode",s),[s,r]=Ie(),o="#4a90e2",l=600,a=ds;function d(){return window.innerWidth<l}function u(){d()&&dn.set(!1)}let h=Y(null),f=Y(null);const g=uo({previewSize:48,borderColor:o,dataKey:"assetKey",eventName:be.ASSET_DROPPED,onDrop:u},()=>({draggedKey:c(h),touchDragElement:c(f)}),x=>{"draggedKey"in x&&P(h,x.draggedKey??null,!0),"touchDragElement"in x&&P(f,x.touchDragElement??null,!0)});function p(x){x.stopPropagation()}function _(){dn.set(!1)}function w(x){const m=document.querySelector("canvas");if(!m)return;const y=m.getBoundingClientRect(),b=y.width/2,D=y.height/2;we.emit(be.ASSET_DROPPED,{assetKey:x,canvasX:b,canvasY:D}),u()}Nn(()=>g.setupCanvasListeners()),Se(()=>g.setupTouchListeners());var v=Ee(),E=ae(v);{var A=x=>{yi(x,{panelId:"asset-palette",title:"Assets",initialRight:10,initialTop:60,width:280,height:400,minWidth:200,minHeight:160,maxWidth:500,maxHeight:600,resizable:!0,showClose:!0,onclose:_,headerExtra:y=>{var b=Ic();S(y,b)},children:(y,b)=>{var D=Dc();D.__pointerdown=p;var T=O(D);Mt(T,21,()=>a,Wt,(N,C)=>{var $=Cc();let I;$.__touchstart=k=>g.onTouchStart(k,c(C).key),$.__dblclick=()=>w(c(C).key),ce($,"",{},{"--accent-color":o});var H=O($);G(()=>{I=Pe($,1,"palette-item svelte-1ahretz",null,I,{dragging:c(h)===c(C).key}),te($,"title",`${c(C).name??""} (double-click to place)`),te(H,"src",c(C).path),te(H,"alt",c(C).name)}),Ot("dragstart",$,k=>g.onDragStart(k,c(C).key)),Ot("dragend",$,function(...k){g.onDragEnd?.apply(this,k)}),S(N,$)}),S(y,D)},$$slots:{headerExtra:!0,default:!0}})};K(E,x=>{t()&&i()==="items"&&x(A)})}S(n,v),he(),r()}et(["pointerdown","touchstart","dblclick"]);var Ac=F('<span class="palette-hint svelte-jnw59q">Drag to place</span>'),kc=F('<div data-ui="" draggable="true" role="button" tabindex="0"><img class="item-preview svelte-jnw59q"/></div>'),Mc=F('<div class="palette-content svelte-jnw59q" role="toolbar" tabindex="-1"><div class="palette-grid svelte-jnw59q"></div></div>');function Pc(n,e){ue(e,!0);const t=()=>L(Zt,"$isFramePaletteOpen",s),i=()=>L(Re,"$builderEditMode",s),[s,r]=Ie(),o="#9b59b6",l=li;let a=Y(null),d=Y(null);const u=uo({previewSize:64,borderColor:o,dataKey:"frameKey",eventName:be.FRAME_DROPPED,onDrop:()=>{Zt.set(!1)}},()=>({draggedKey:c(a),touchDragElement:c(d)}),v=>{"draggedKey"in v&&P(a,v.draggedKey??null,!0),"touchDragElement"in v&&P(d,v.touchDragElement??null,!0)});function h(v){v.stopPropagation()}function f(){Zt.set(!1)}function g(v){const E=document.querySelector("canvas");if(!E)return;const A=E.getBoundingClientRect(),x=A.width/2,m=A.height/2;we.emit(be.FRAME_DROPPED,{frameKey:v,canvasX:x,canvasY:m}),Zt.set(!1),si()}Nn(()=>u.setupCanvasListeners()),Se(()=>u.setupTouchListeners());var p=Ee(),_=ae(p);{var w=v=>{yi(v,{panelId:"frame-palette",title:"Frames",initialRight:10,initialTop:60,width:320,height:400,minWidth:220,minHeight:200,maxWidth:600,maxHeight:600,resizable:!0,showClose:!0,onclose:f,headerExtra:A=>{var x=Ac();S(A,x)},children:(A,x)=>{var m=Mc();m.__pointerdown=h;var y=O(m);Mt(y,21,()=>l,Wt,(b,D)=>{var T=kc();let N;T.__touchstart=$=>u.onTouchStart($,c(D).key),T.__dblclick=()=>g(c(D).key),ce(T,"",{},{"--accent-color":o});var C=O(T);G(()=>{N=Pe(T,1,"palette-item svelte-jnw59q",null,N,{dragging:c(a)===c(D).key}),te(T,"title",`${c(D).name??""} (double-click to place)`),te(C,"src",c(D).path),te(C,"alt",c(D).name)}),Ot("dragstart",T,$=>u.onDragStart($,c(D).key)),Ot("dragend",T,function(...$){u.onDragEnd?.apply(this,$)}),S(b,T)}),S(A,m)},$$slots:{headerExtra:!0,default:!0}})};K(_,v=>{t()&&i()==="frames"&&v(w)})}S(n,p),he(),r()}et(["pointerdown","touchstart","dblclick"]);var $c=F("<button><!></button>");function oe(n,e){let t=ee(e,"variant",3,"default"),i=ee(e,"disabled",3,!1),s=ee(e,"title",3,"");const r={default:{base:"#4a90e2",hover:"#357abd",active:"#2a5f8f"},green:{base:"#27ae60",hover:"#229954",active:"#1e8449"},blue:{base:"#3498db",hover:"#2980b9",active:"#21618c"},orange:{base:"#ffa500",hover:"#ff8c00",active:"#e67e00"},red:{base:"#e74c3c",hover:"#c0392b",active:"#a02e22"},purple:{base:"#9b59b6",hover:"#8e44ad",active:"#7d3c98"},cyan:{base:"#17a2b8",hover:"#138496",active:"#0f6674"}},o=X(()=>r[t()]),l=X(()=>e.width?`--btn-width: ${e.width};`:"");var a=$c();let d;a.__click=function(...h){e.onclick?.apply(this,h)};var u=O(a);gn(u,()=>e.children??je),G(()=>{d=Pe(a,1,"pixel-btn svelte-lwc0vq",null,d,{disabled:i()}),ce(a,`${c(l)??""} --color-base: ${c(o).base??""}; --color-hover: ${c(o).hover??""}; --color-active: ${c(o).active??""}`),a.disabled=i(),te(a,"title",s())}),S(n,a)}et(["click"]);var Oc=F('<div><div class="minimap-bg svelte-1ycb7lo"></div> <div class="viewport-indicator svelte-1ycb7lo"></div> <div class="player-marker svelte-1ycb7lo"></div> <div class="minimap-frame svelte-1ycb7lo"></div></div>');function Lc(n,e){ue(e,!0);const t=()=>L(_i,"$builderCameraInfo",r),i=()=>L(yn,"$isBuilderZoomedOut",r),s=()=>L(Rt,"$isDraggingInBuilder",r),[r,o]=Ie(),l=120,a=60,d=200,u=100;let h=Y(!1),f=Y(null),g=X(()=>c(h)?d:l),p=X(()=>c(h)?u:a),_=X(()=>{const C=t();if(!C||C.worldWidth===0)return"display: none;";const $=c(g)/C.worldWidth,I=c(p)/C.worldHeight,H=C.viewWidth/C.zoom*$,k=C.viewHeight/C.zoom*I,B=C.scrollX*$,V=C.scrollY*I;return`
      left: ${Math.max(0,B)}px;
      top: ${Math.max(0,V)}px;
      width: ${Math.min(H,c(g)-B)}px;
      height: ${Math.min(k,c(p)-V)}px;
    `}),w=X(()=>{const C=t();if(!C||C.worldWidth===0)return"display: none;";const $=c(g)/C.worldWidth,I=c(p)/C.worldHeight,H=C.playerX*$,k=C.playerY*I;return`
      left: ${H}px;
      top: ${k}px;
    `});function v(C,$){const I=t();if(!I||I.worldWidth===0||!c(f))return;const H=c(f).getBoundingClientRect(),k=C-H.left,B=$-H.top,V=k/c(g)*I.worldWidth,j=B/c(p)*I.worldHeight;we.emit(be.MINIMAP_NAVIGATE,{worldX:V,worldY:j})}function E(C){C.stopPropagation(),C.preventDefault(),P(h,!0),v(C.clientX,C.clientY),window.addEventListener("mousemove",A),window.addEventListener("mouseup",x)}function A(C){c(h)&&(C.preventDefault(),v(C.clientX,C.clientY))}function x(){P(h,!1),window.removeEventListener("mousemove",A),window.removeEventListener("mouseup",x)}function m(C){C.stopPropagation(),C.preventDefault(),P(h,!0);const $=C.touches[0];v($.clientX,$.clientY),window.addEventListener("touchmove",y,{passive:!1}),window.addEventListener("touchend",b)}function y(C){if(!c(h))return;C.preventDefault();const $=C.touches[0];v($.clientX,$.clientY)}function b(){P(h,!1),window.removeEventListener("touchmove",y),window.removeEventListener("touchend",b)}var D=Ee(),T=ae(D);{var N=C=>{var $=Oc();let I;$.__mousedown=E,$.__touchstart=m;var H=M(O($),2),k=M(H,2);pn($,B=>P(f,B),()=>c(f)),G(()=>{I=Pe($,1,"minimap-container svelte-1ycb7lo",null,I,{enlarged:c(h)}),ce($,`width: ${c(g)??""}px; height: ${c(p)??""}px;${s()?" pointer-events: none;":""}`),ce(H,c(_)),ce(k,c(w))}),S(C,$)};K(T,C=>{i()||C(N)})}S(n,D),he(),o()}et(["mousedown","touchstart"]);var Rc=F('<div class="landscape-hint svelte-ugg786" data-ui=""><div class="hint-content svelte-ugg786"><div class="rotate-icon svelte-ugg786">ð±â»</div> <p class="hint-text svelte-ugg786">Rotate your phone for a better experience</p> <button class="dismiss-btn svelte-ugg786">OK</button></div></div>');function Hc(n,e){ue(e,!0);let t=Y(!0),i=Y(!1);const s="landscapeHintDismissed";Nn(()=>{sessionStorage.getItem(s)||(P(i,/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||"ontouchstart"in window&&window.innerWidth<=768,!0),c(i)&&P(t,!1))});function r(){P(t,!0),sessionStorage.setItem(s,"true")}var o=Ee(),l=ae(o);{var a=d=>{var u=Rc(),h=O(u),f=M(O(h),4);f.__click=r,S(d,u)};K(l,d=>{!c(t)&&c(i)&&d(a)})}S(n,o),he()}et(["click"]);var Fc=F("<button> </button>"),Xc=F('<div class="language-tabs svelte-ng6pis"></div>');function ho(n,e){ue(e,!0);let t=ee(e,"accentColor",3,"#88ddff");var i=Xc();Mt(i,21,()=>sl,Wt,(s,r)=>{var o=Fc();let l;o.__click=()=>e.onselect(c(r).code);let a;var d=O(o);G(()=>{l=Pe(o,1,"lang-tab svelte-ng6pis",null,l,{active:e.selectedLanguage===c(r).code}),a=ce(o,"",a,{"--accent-color":t()}),xe(d,c(r).label)}),S(s,o)}),S(n,i),he()}et(["click"]);var Nc=F("<button></button>"),Bc=F('<div class="color-picker svelte-1jc3e0j"></div>'),Zc=F('<div class="color-section svelte-1jc3e0j"><span class="color-label-title svelte-1jc3e0j"> </span> <button class="color-button svelte-1jc3e0j" title="Change color"><span class="color-preview svelte-1jc3e0j"></span> <span class="color-label svelte-1jc3e0j">Change</span></button> <!></div>');function Xi(n,e){ue(e,!0);let t=ee(e,"label",3,"Color"),i=ee(e,"accentColor",3,"#88ddff"),s=Y(!1),r=Y(null);Se(()=>{c(s)&&c(r)&&requestAnimationFrame(()=>{c(r)?.scrollIntoView({behavior:"smooth",block:"nearest"})})});function o(v){e.onselect(v)}function l(){P(s,!c(s))}var a=Zc(),d=O(a),u=O(d),h=M(d,2);h.__click=l;let f;var g=O(h);let p;var _=M(h,2);{var w=v=>{var E=Bc();Mt(E,21,()=>e.colors,Wt,(A,x)=>{var m=Nc();let y;m.__click=()=>o(c(x));let b;G(()=>{y=Pe(m,1,"color-swatch svelte-1jc3e0j",null,y,{selected:e.selectedColor===c(x)}),te(m,"title",c(x)),b=ce(m,"",b,{background:c(x),"--accent-color":i()})}),S(A,m)}),pn(E,A=>P(r,A),()=>c(r)),S(v,E)};K(_,v=>{c(s)&&v(w)})}G(()=>{xe(u,t()),f=ce(h,"",f,{"--accent-color":i()}),p=ce(g,"",p,{background:e.selectedColor})}),S(n,a),he()}et(["click"]);const Ks=50,Us=400,Wc=400,Yc=70;var zc=F('<div class="form-section svelte-jhtkop"><div class="form-group svelte-jhtkop"><label class="svelte-jhtkop"> </label> <input type="text" class="svelte-jhtkop"/></div> <div class="form-group svelte-jhtkop"><label class="svelte-jhtkop"> </label> <textarea rows="6" class="svelte-jhtkop"></textarea></div></div>');function Gc(n,e){ue(e,!0);let t=ee(e,"titlePlaceholder",3,"Enter title..."),i=ee(e,"contentPlaceholder",3,"Enter text..."),s=ee(e,"idPrefix",3,"text-form"),r=ee(e,"accentColor",3,"#88ddff");function o(E){const A=E.target;e.ontitlechange(A.value)}function l(E){const A=E.target;e.oncontentchange(A.value)}var a=zc();let d;var u=O(a),h=O(u),f=O(h),g=M(h,2);g.__input=o;var p=M(u,2),_=O(p),w=O(_),v=M(_,2);v.__input=l,G(()=>{d=ce(a,"",d,{"--accent-color":r()}),te(h,"for",`${s()??""}-title`),xe(f,`Title (max ${Ks} chars)`),te(g,"id",`${s()??""}-title`),ni(g,e.title),te(g,"placeholder",t()),te(g,"maxlength",Ks),te(_,"for",`${s()??""}-content`),xe(w,`Content (max ${Us} chars)`),te(v,"id",`${s()??""}-content`),ni(v,e.content),te(v,"placeholder",i()),te(v,"maxlength",Us)}),S(n,a),he()}et(["input"]);var Kc=F('<div class="panel-content svelte-zzlycq"><!> <!> <div class="panel-extras svelte-zzlycq"><!></div> <div class="panel-footer svelte-zzlycq"><!> <!></div></div>');function Uc(n,e){ue(e,!0);const t=()=>L(ss,"$dialogZones",r),i=()=>L(vi,"$selectedDialogZoneId",r),s=()=>L(os,"$isDialogZonePanelOpen",r),[r,o]=Ie(),l="#88ddff";let a=Y(Ke(Kr)),d=X(()=>t().find(x=>x.id===i())??null),u=X(()=>c(d)?.texts.find(x=>x.language===c(a))??null);function h(x){i()&&Ps(i(),c(a),{title:x})}function f(x){i()&&Ps(i(),c(a),{content:x})}function g(){i()&&(io(i()),As())}function p(){As()}function _(x){i()&&sn(i(),{color:x})}function w(x){P(a,x,!0)}var v=Ee(),E=ae(v);{var A=x=>{yi(x,{panelId:"dialog-zone-panel",title:"Dialog Zone",initialRight:10,initialTop:160,width:280,height:450,minWidth:250,minHeight:370,maxWidth:500,maxHeight:700,resizable:!0,showClose:!0,onclose:p,children:(m,y)=>{var b=Kc(),D=O(b);ho(D,{get selectedLanguage(){return c(a)},onselect:w,accentColor:l});var T=M(D,2);{let k=X(()=>c(u)?.title??""),B=X(()=>c(u)?.content??"");Gc(T,{get title(){return c(k)},get content(){return c(B)},ontitlechange:h,oncontentchange:f,titlePlaceholder:"Enter title...",contentPlaceholder:"Enter dialog text...",idPrefix:"dialog",accentColor:l})}var N=M(T,2),C=O(N);Xi(C,{get colors(){return Ri},get selectedColor(){return c(d).color},onselect:_,label:"Zone Color",accentColor:l});var $=M(N,2),I=O($);oe(I,{variant:"cyan",onclick:p,children:(k,B)=>{var V=re("CONFIRM");S(k,V)},$$slots:{default:!0}});var H=M(I,2);oe(H,{variant:"red",onclick:g,children:(k,B)=>{var V=re("DELETE");S(k,V)},$$slots:{default:!0}}),S(m,b)},$$slots:{default:!0}})};K(E,x=>{c(d)&&s()&&x(A)})}S(n,v),he(),o()}var Vc=F("<button> </button>"),jc=F("<option> </option>"),qc=F('<a target="_blank" rel="noopener noreferrer" class="url-preview svelte-ds1z4d">Test link â</a>'),Jc=F('<button><img class="svelte-ds1z4d"/></button>'),Qc=F('<div class="style-picker svelte-ds1z4d"></div>'),ed=F('<div class="panel-content svelte-ds1z4d"><!> <div class="frame-size-row svelte-ds1z4d"><div class="frame-size-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Frame Size</span> <div class="size-buttons svelte-ds1z4d"></div></div> <div class="rotate-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Rotate</span> <button class="rotate-btn svelte-ds1z4d"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-ds1z4d"><path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg></button></div></div> <div class="panel-extras svelte-ds1z4d"><div class="text-section svelte-ds1z4d"><label for="frame-text" class="svelte-ds1z4d">Text</label> <textarea id="frame-text" placeholder="Enter text..." rows="3" class="svelte-ds1z4d"></textarea></div> <div class="size-rotation-row svelte-ds1z4d"><div class="size-section svelte-ds1z4d"><label for="text-size" class="svelte-ds1z4d">Text Size</label> <select id="text-size" class="svelte-ds1z4d"></select></div></div> <div class="url-section svelte-ds1z4d"><label for="frame-url" class="svelte-ds1z4d">Link URL (opens on click)</label> <input id="frame-url" type="url" placeholder="https://example.com" class="svelte-ds1z4d"/> <!></div> <!> <!> <div class="style-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Frame Style</span> <button class="style-button svelte-ds1z4d" title="Change frame style"><img alt="Current frame" class="style-preview svelte-ds1z4d"/> <span class="style-label svelte-ds1z4d">Change Style</span></button> <!></div></div> <div class="panel-footer svelte-ds1z4d"><!> <!></div></div>');function td(n,e){ue(e,!0);const t=()=>L(ns,"$builderPreviewLanguage",o),i=()=>L(gl,"$selectedFrame",o),s=()=>L(mi,"$selectedFrameId",o),r=()=>L(ts,"$isFramePanelOpen",o),[o,l]=Ie(),a="#9b59b6";let d=X(t),u=X(i),h=X(()=>c(u)?.texts.find(k=>k.language===c(d))??null),f=X(()=>c(u)?ql(c(u).scale??4):"M");function g(k){const B=k.target;if(!s()||!c(u))return;const V=c(u).texts.map(j=>j.language===c(d)?{...j,text:B.value}:j);V.some(j=>j.language===c(d))||V.push({language:c(d),text:B.value}),vt(s(),{texts:V})}function p(k){const B=k.target;s()&&vt(s(),{url:B.value||void 0})}function _(k){s()&&vt(s(),{backgroundColor:k})}function w(k){s()&&vt(s(),{textColor:k})}function v(k){const B=k.target;s()&&vt(s(),{textSize:parseInt(B.value,10)})}function E(k){s()&&vt(s(),{scale:jl(k)})}function A(){if(!s()||!c(u))return;const B=(c(u).rotation??0)===0?90:0;vt(s(),{rotation:B})}function x(){s()&&cs(s())}function m(){dl(),ln(null)}function y(k){ul(k)}let b=Y(!1),D=Y(null),T=Y(null);function N(k){s()&&vt(s(),{frameKey:k})}function C(){P(b,!c(b))}Se(()=>{c(b)&&c(D)&&requestAnimationFrame(()=>{c(D)?.scrollIntoView({behavior:"smooth",block:"nearest"})})}),Se(()=>{if(!c(b))return;function k(B){const V=B.target;c(D)&&!c(D).contains(V)&&c(T)&&!c(T).contains(V)&&P(b,!1)}return document.addEventListener("click",k),()=>document.removeEventListener("click",k)});var $=Ee(),I=ae($);{var H=k=>{yi(k,{panelId:"frame-panel",title:"Edit Frame",initialRight:10,initialTop:160,width:280,height:520,minWidth:250,minHeight:450,maxWidth:500,maxHeight:700,resizable:!0,showClose:!0,onclose:m,children:(B,V)=>{var j=ed(),tt=O(j);ho(tt,{get selectedLanguage(){return c(d)},onselect:y,accentColor:a});var de=M(tt,2),Xe=O(de),Ce=M(O(Xe),2);Mt(Ce,21,()=>Object.entries(oo),Wt,(Q,fe)=>{var ke=X(()=>xo(c(fe),2));let Je=()=>c(ke)[0],it=()=>c(ke)[1].label;var It=Vc();let wn;It.__click=()=>E(Je());var vo=O(It);G(()=>{wn=Pe(It,1,"size-btn svelte-ds1z4d",null,wn,{active:c(f)===Je()}),te(It,"title",it()),xe(vo,Je())}),S(Q,It)});var me=M(Xe,2),nt=M(O(me),2);nt.__click=A;var _e=M(de,2),$e=O(_e),De=M(O($e),2);De.__input=g;var Te=M($e,2),ht=O(Te),Ne=M(O(ht),2);Ne.__change=v,Mt(Ne,21,()=>Vl,Wt,(Q,fe)=>{var ke=jc(),Je=O(ke),it={};G(()=>{xe(Je,`${c(fe)??""}px`),it!==(it=c(fe))&&(ke.value=(ke.__value=c(fe))??"")}),S(Q,ke)});var ft;Ma(Ne);var qe=M(Te,2),Ht=M(O(qe),2);Ht.__input=p;var R=M(Ht,2);{var Z=Q=>{var fe=qc();G(()=>te(fe,"href",c(u).url)),S(Q,fe)};K(R,Q=>{c(u).url&&Q(Z)})}var ie=M(qe,2);{let Q=X(()=>c(u).textColor??ao);Xi(ie,{get colors(){return Ul},get selectedColor(){return c(Q)},onselect:w,label:"Text Color",accentColor:a})}var Ae=M(ie,2);Xi(Ae,{get colors(){return Kl},get selectedColor(){return c(u).backgroundColor},onselect:_,label:"Background Color",accentColor:a});var le=M(Ae,2),Ye=M(O(le),2);Ye.__click=C;var xt=O(Ye);pn(Ye,Q=>P(T,Q),()=>c(T));var Ft=M(Ye,2);{var qt=Q=>{var fe=Qc();Mt(fe,21,()=>li,Wt,(ke,Je)=>{var it=Jc();let It;it.__click=()=>N(c(Je).key);var wn=O(it);G(()=>{It=Pe(it,1,"style-item svelte-ds1z4d",null,It,{selected:c(u).frameKey===c(Je).key}),te(it,"title",c(Je).name),te(wn,"src",c(Je).path),te(wn,"alt",c(Je).name)}),S(ke,it)}),pn(fe,ke=>P(D,ke),()=>c(D)),S(Q,fe)};K(Ft,Q=>{c(b)&&Q(qt)})}var gt=M(_e,2),Jt=O(gt);oe(Jt,{variant:"purple",onclick:m,children:(Q,fe)=>{var ke=re("CONFIRM");S(Q,ke)},$$slots:{default:!0}});var Qt=M(Jt,2);oe(Qt,{variant:"red",onclick:x,children:(Q,fe)=>{var ke=re("DELETE");S(Q,ke)},$$slots:{default:!0}}),G(Q=>{te(nt,"title",c(u).rotation===90?"Portrait (click to rotate)":"Landscape (click to rotate)"),ni(De,c(h)?.text??""),ft!==(ft=c(u).textSize??Kn)&&(Ne.value=(Ne.__value=c(u).textSize??Kn)??"",Lr(Ne,c(u).textSize??Kn)),ni(Ht,c(u).url??""),te(xt,"src",Q)},[()=>li.find(Q=>Q.key===c(u).frameKey)?.path??""]),S(B,j)},$$slots:{default:!0}})};K(I,k=>{r()&&c(u)&&k(H)})}S(n,$),he(),l()}et(["click","input","change"]);var nd=F('<div class="frame-text svelte-1vp2oo0"> </div>'),id=F('<div class="frame-content-layer svelte-1vp2oo0"></div>');function fo(n,e){ue(e,!0);const t=()=>L(jr,"$placedFrames",d),i=()=>L(Ur,"$isBuilderMode",d),s=()=>L(_i,"$builderCameraInfo",d),r=()=>L(Br,"$gameCameraInfo",d),o=()=>L(ns,"$builderPreviewLanguage",d),l=()=>L($n,"$currentLanguage",d),a=()=>L(rs,"$draggingFramePositions",d),[d,u]=Ie();let h=X(t),f=X(()=>i()?s().scrollX:r().scrollX),g=X(()=>i()?s().scrollY:r().scrollY),p=X(()=>i()?s().zoom:r().zoom),_=X(()=>i()?o():l()),w=X(a);function v(m){const y=c(w).get(m.id);return y||{x:m.x,y:m.y}}function E(m){const y=m.scale??yt,b=m.rotation===90,{textWidth:D,textHeight:T}=An(y,b),N=v(m),C=(N.x-c(f))*c(p),$=(N.y-c(g))*c(p);return{x:C,y:$,width:D*c(p),height:T*c(p)}}function A(m){return(m.texts.find(b=>b.language===c(_))||m.texts[0]||{text:""}).text||""}var x=id();Mt(x,21,()=>c(h),m=>m.id,(m,y)=>{const b=X(()=>E(c(y))),D=X(()=>A(c(y))),T=X(()=>(c(y).textSize??Kn)*c(p)),N=X(()=>c(y).textColor??ao);var C=Ee(),$=ae(C);{var I=H=>{var k=nd(),B=O(k);G(()=>{ce(k,`
          left: ${c(b).x??""}px;
          top: ${c(b).y??""}px;
          width: ${c(b).width??""}px;
          height: ${c(b).height??""}px;
          font-size: ${c(T)??""}px;
          color: ${c(N)??""};
        `),xe(B,c(D))}),S(H,k)};K($,H=>{c(D)&&H(I)})}S(m,C)}),S(n,x),he(),u()}var sd=F('<div class="temp-zone-button svelte-130i47e"><!></div>');function rd(n,e){ue(e,!0);const t=()=>L(_i,"$builderCameraInfo",r),i=()=>L(Re,"$builderEditMode",r),s=()=>L(Rt,"$isDraggingInBuilder",r),[r,o]=Ie();let l=Y(null),a=null,d=null,u=Y(null);function h(v){a&&clearTimeout(a),P(l,v,!0),P(u,t()?.scrollX??null,!0),a=setTimeout(()=>{P(l,null),P(u,null)},2e3)}function f(){c(l)&&(we.emit(be.DIALOG_ZONE_CREATE_AT,{worldX:c(l).worldX}),P(l,null),P(u,null),a&&(clearTimeout(a),a=null))}function g(){P(l,null),P(u,null),a&&(clearTimeout(a),a=null)}Nn(()=>{d=we.on(be.TEMP_ZONE_BUTTON_SHOW,h);const v=we.on(be.TEMP_ZONE_BUTTON_HIDE,g);return()=>{d?.unsubscribe(),v.unsubscribe()}}),Ra(()=>{a&&clearTimeout(a)}),Se(()=>{i()!=="dialogs"&&(P(l,null),P(u,null))}),Se(()=>{const v=t()?.scrollX;c(l)&&c(u)!==null&&v!==void 0&&Math.abs(v-c(u))>10&&(P(l,null),P(u,null),a&&(clearTimeout(a),a=null))});var p=Ee(),_=ae(p);{var w=v=>{var E=sd(),A=O(E);oe(A,{variant:"cyan",width:"90px",onclick:f,children:(x,m)=>{var y=re("+ ZONE");S(x,y)},$$slots:{default:!0}}),G(()=>ce(E,`left: ${c(l).screenX??""}px; top: ${c(l).screenY-50}px;${s()?" pointer-events: none;":""}`)),S(v,E)};K(_,v=>{c(l)&&i()==="dialogs"&&v(w)})}S(n,p),he(),o()}var od=F('<div class="dialog-hint svelte-1titkrs" data-ui=""><div class="hint-content svelte-1titkrs"><span class="hint-icon svelte-1titkrs">ð¡</span> <span class="hint-text svelte-1titkrs">Tip: Use <strong class="svelte-1titkrs">FIT</strong> view for dialog zones</span> <button class="hint-action svelte-1titkrs">FIT NOW</button></div></div>');function ad(n,e){ue(e,!0);const t=()=>L(Re,"$builderEditMode",s),i=()=>L(yn,"$isBuilderZoomedOut",s),[s,r]=Ie();let o=Y(!1),l=Y(!1),a=null;Se(()=>{t()==="dialogs"&&!c(o)&&!i()&&(P(o,!0),P(l,!0),a=setTimeout(()=>{P(l,!1)},5e3))}),Se(()=>{i()&&c(l)&&(P(l,!1),a&&(clearTimeout(a),a=null))});function d(p){p.stopPropagation(),p.preventDefault(),P(l,!1),a&&(clearTimeout(a),a=null)}function u(p){p.stopPropagation(),p.preventDefault(),co(),P(l,!1),a&&(clearTimeout(a),a=null)}var h=Ee(),f=ae(h);{var g=p=>{var _=od();_.__click=d,_.__pointerdown=E=>E.stopPropagation(),_.__touchstart=E=>E.stopPropagation();var w=O(_),v=M(O(w),4);v.__click=u,S(p,_)};K(f,p=>{c(l)&&p(g)})}S(n,h),he(),r()}et(["click","pointerdown","touchstart"]);var ld=F('<div class="item-controls svelte-1is3rex"><div class="controls-row svelte-1is3rex"><!> <!> <!> <!></div></div>');function cd(n,e){ue(e,!0);const t=()=>L(as,"$selectedItem",u),i=()=>L(qr,"$selectedItemScreenPosition",u),s=()=>L(is,"$selectedItemId",u),r=()=>L(Vr,"$itemDepthLayer",u),o=()=>L(pl,"$selectedItemPhysicsEnabled",u),l=()=>L(vl,"$selectedItemFlipX",u),a=()=>L(Re,"$builderEditMode",u),d=()=>L(Rt,"$isDraggingInBuilder",u),[u,h]=Ie();let f=X(()=>t()?Al(t().assetKey):!1),g=X(()=>{const m=i();if(!m)return null;const y=10,b=40,D=c(f)?380:290;let T=m.screenY-m.itemHeight/2-45;const N=y+b;T<N&&(T=m.screenY+m.itemHeight/2+10);const C=window.innerHeight-b-y;T>C&&(T=C);let $=m.screenX;const I=D/2,H=I+y,k=window.innerWidth-I-y;return $<H&&($=H),$>k&&($=k),{x:$,y:T}});function p(){if(!s())return;const m=r()==="behind"?"front":"behind",y=Qi(m);_l(),yl(s(),y)}function _(){s()&&wl(s(),!o())}function w(){s()&&bl(s(),!l())}function v(){s()&&(to(s()),ls())}var E=Ee(),A=ae(E);{var x=m=>{var y=ld(),b=O(y),D=O(b);{let I=X(()=>r()==="behind"?"blue":"orange"),H=X(()=>o()?"Solid items must be behind player":"Toggle item depth: behind or in front of player");oe(D,{get variant(){return c(I)},get title(){return c(H)},onclick:p,get disabled(){return o()},children:(k,B)=>{var V=re();G(()=>xe(V,r()==="behind"?"Front":"Back")),S(k,V)},$$slots:{default:!0}})}var T=M(D,2);{let I=X(()=>l()?"orange":"blue");oe(T,{get variant(){return c(I)},title:"Flip item horizontally",onclick:w,children:(H,k)=>{var B=re("Flip");S(H,B)},$$slots:{default:!0}})}var N=M(T,2);{var C=I=>{{let H=X(()=>o()?"orange":"blue");oe(I,{get variant(){return c(H)},title:"Toggle physics: item will block player movement",onclick:_,children:(k,B)=>{var V=re();G(()=>xe(V,o()?"Ghost":"Solid")),S(k,V)},$$slots:{default:!0}})}};K(N,I=>{c(f)&&I(C)})}var $=M(N,2);oe($,{variant:"red",title:"Delete selected item",onclick:v,children:(I,H)=>{var k=re("DEL");S(I,k)},$$slots:{default:!0}}),G(()=>ce(y,`left: ${c(g).x??""}px; top: ${c(g).y??""}px;${d()?" pointer-events: none;":""}`)),S(m,y)};K(A,m=>{a()==="items"&&s()&&c(g)&&m(x)})}S(n,E),he(),h()}var dd=F('<div class="frame-controls svelte-eqt3a9"><div class="controls-row svelte-eqt3a9"><!> <!></div></div>');function ud(n,e){ue(e,!0);const t=()=>L(Jr,"$selectedFrameScreenPosition",o),i=()=>L(mi,"$selectedFrameId",o),s=()=>L(Re,"$builderEditMode",o),r=()=>L(Rt,"$isDraggingInBuilder",o),[o,l]=Ie();let a=X(()=>{const p=t();if(!p)return null;const _=10,w=40,v=190;let E=p.screenY-p.frameHeight/2-45;const A=_+w;E<A&&(E=p.screenY+p.frameHeight/2+10);const x=window.innerHeight-w-_;E>x&&(E=x);let m=p.screenX;const y=v/2,b=y+_,D=window.innerWidth-y-_;return m<b&&(m=b),m>D&&(m=D),{x:m,y:E}});function d(){si()}function u(){i()&&(cs(i()),ln(null))}var h=Ee(),f=ae(h);{var g=p=>{var _=dd(),w=O(_),v=O(w);oe(v,{variant:"purple",title:"Edit frame content (or double-click)",onclick:d,children:(A,x)=>{var m=re("EDIT");S(A,m)},$$slots:{default:!0}});var E=M(v,2);oe(E,{variant:"red",title:"Delete selected frame",onclick:u,children:(A,x)=>{var m=re("DEL");S(A,m)},$$slots:{default:!0}}),G(()=>ce(_,`left: ${c(a).x??""}px; top: ${c(a).y??""}px;${r()?" pointer-events: none;":""}`)),S(p,_)};K(f,p=>{(s()==="frames"||s()==="items")&&i()&&c(a)&&p(g)})}S(n,h),he(),l()}var hd=F('<div class="zone-controls svelte-sm01rq"><div class="controls-row svelte-sm01rq"><!> <!> <!></div></div>');function fd(n,e){ue(e,!0);const t=()=>L(Qr,"$selectedDialogZoneScreenPosition",o),i=()=>L(vi,"$selectedDialogZoneId",o),s=()=>L(Re,"$builderEditMode",o),r=()=>L(Rt,"$isDraggingInBuilder",o),[o,l]=Ie();let a=X(()=>{const _=t();if(!_)return null;const w=10,v=40,E=190;let A=_.screenY;const x=w+v,m=window.innerHeight-v-w;A<x&&(A=x),A>m&&(A=m);let y=_.screenX;const b=E/2,D=b+w,T=window.innerWidth-b-w;return y<D&&(y=D),y>T&&(y=T),{x:y,y:A}});function d(){eo()}function u(){i()&&(io(i()),Tn(null))}function h(){Tn(null)}var f=Ee(),g=ae(f);{var p=_=>{var w=hd(),v=O(w),E=O(v);oe(E,{variant:"cyan",title:"Edit zone content (or double-click)",onclick:d,children:(m,y)=>{var b=re("EDIT");S(m,b)},$$slots:{default:!0}});var A=M(E,2);oe(A,{variant:"red",title:"Delete selected zone",onclick:u,children:(m,y)=>{var b=re("DEL");S(m,b)},$$slots:{default:!0}});var x=M(A,2);oe(x,{variant:"default",title:"Deselect zone",onclick:h,children:(m,y)=>{var b=re("DONE");S(m,b)},$$slots:{default:!0}}),G(()=>ce(w,`left: ${c(a).x??""}px; top: ${c(a).y??""}px;${r()?" pointer-events: none;":""}`)),S(_,w)};K(g,_=>{s()==="dialogs"&&i()&&c(a)&&_(p)})}S(n,f),he(),l()}var gd=F('<div class="hstack svelte-8vtf35"><!></div>');function pd(n,e){let t=ee(e,"gap",3,"10px"),i=ee(e,"align",3,"center");var s=gd(),r=O(s);gn(r,()=>e.children??je),G(()=>ce(s,`gap: ${t()??""}; align-items: ${(i()==="start"?"flex-start":i()==="end"?"flex-end":i())??""};`)),S(n,s)}var vd=F('<div class="vstack svelte-1y4dqnf"><!></div>');function md(n,e){let t=ee(e,"gap",3,"10px"),i=ee(e,"align",3,"stretch");var s=vd(),r=O(s);gn(r,()=>e.children??je),G(()=>ce(s,`gap: ${t()??""}; align-items: ${(i()==="start"?"flex-start":i()==="end"?"flex-end":i())??""};`)),S(n,s)}var _d=F("<div><!></div>");function Vs(n,e){const t=()=>L(Rt,"$isDraggingInBuilder",i),[i,s]=Ie();let r=ee(e,"padding",3,"10px");var o=_d();let l;var a=O(o);gn(a,()=>e.children??je),G(()=>{l=Pe(o,1,`fixed fixed--${e.position??""}`,"svelte-vwlo0e",l,{"dragging-in-builder":t()}),ce(o,`--padding: ${r()??""};`)}),S(n,o),s()}var yd=F("<div><!> <!> <!></div>"),wd=F("<!> <!>",1),bd=F("<!> <!> <!>",1),Sd=F("<div><!></div>"),Ed=F("<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!>",1);function xd(n,e){ue(e,!0);const t=()=>L(is,"$selectedItemId",u),i=()=>L(mi,"$selectedFrameId",u),s=()=>L(vi,"$selectedDialogZoneId",u),r=()=>L(Re,"$builderEditMode",u),o=()=>L(yn,"$isBuilderZoomedOut",u),l=()=>L(es,"$gridSnappingEnabled",u),a=()=>L(dn,"$isAssetPaletteOpen",u),d=()=>L(Zt,"$isFramePaletteOpen",u),[u,h]=Ie(),f=600;let g=Y(Ke(typeof window<"u"?window.innerWidth<f:!1)),p=X(()=>c(g)&&(t()!==null||i()!==null||s()!==null));Se(()=>{function j(){P(g,window.innerWidth<f)}return window.addEventListener("resize",j),()=>window.removeEventListener("resize",j)});function _(){wc()}function w(){co()}function v(){al()}function E(){we.emit(be.DIALOG_ZONE_CREATE)}var A=Ed(),x=ae(A);cd(x,{});var m=M(x,2);ud(m,{});var y=M(m,2);fd(y,{});var b=M(y,2);{var D=j=>{Tc(j,{})},T=j=>{var tt=Ee(),de=ae(tt);{var Xe=me=>{Uc(me,{})},Ce=me=>{var nt=Ee(),_e=ae(nt);{var $e=De=>{Pc(De,{})};K(_e,De=>{r()==="frames"&&De($e)},!0)}S(me,nt)};K(de,me=>{r()==="dialogs"?me(Xe):me(Ce,!1)},!0)}S(j,tt)};K(b,j=>{r()==="items"?j(D):j(T,!1)})}var N=M(b,2);td(N,{});var C=M(N,2);fo(C,{});var $=M(C,2);Lc($,{});var I=M($,2);Hc(I,{});var H=M(I,2);rd(H,{});var k=M(H,2);ad(k,{});var B=M(k,2);Vs(B,{position:"top-left",children:(j,tt)=>{var de=yd();let Xe;var Ce=O(de);oe(Ce,{variant:"green",width:"100px",onclick:_,children:(_e,$e)=>{var De=re("SAVE");S(_e,De)},$$slots:{default:!0}});var me=M(Ce,2);{let _e=X(()=>o()?"orange":"blue");oe(me,{get variant(){return c(_e)},width:"80px",onclick:w,title:"Toggle zoom (F)",children:($e,De)=>{var Te=re();G(()=>xe(Te,o()?"1:1":"FIT")),S($e,Te)},$$slots:{default:!0}})}var nt=M(me,2);{let _e=X(()=>l()?"blue":"orange");oe(nt,{get variant(){return c(_e)},width:"80px",onclick:v,title:"Toggle grid snapping",children:($e,De)=>{var Te=re();G(()=>xe(Te,l()?"FREE":"SNAP")),S($e,Te)},$$slots:{default:!0}})}G(()=>Xe=Pe(de,1,"left-buttons svelte-1vm8op7",null,Xe,{"hide-left":c(p)})),S(j,de)},$$slots:{default:!0}});var V=M(B,2);Vs(V,{position:"top-right",children:(j,tt)=>{var de=Sd();let Xe;var Ce=O(de);md(Ce,{align:"end",children:(me,nt)=>{var _e=bd(),$e=ae(_e);{let ht=X(()=>r()==="items"&&a()?"orange":"blue");oe($e,{get variant(){return c(ht)},onclick:()=>{r()==="items"?ll():(Yn("items"),dn.set(!0))},title:"Edit assets/items",children:(Ne,ft)=>{var qe=re("ASSETS");S(Ne,qe)},$$slots:{default:!0}})}var De=M($e,2);{let ht=X(()=>r()==="frames"&&d()?"orange":"purple");oe(De,{get variant(){return c(ht)},onclick:()=>{r()==="frames"?cl():(Yn("frames"),Zt.set(!0))},title:"Edit text frames",children:(Ne,ft)=>{var qe=re("FRAMES");S(Ne,qe)},$$slots:{default:!0}})}var Te=M(De,2);pd(Te,{children:(ht,Ne)=>{var ft=wd(),qe=ae(ft);{var Ht=Z=>{oe(Z,{variant:"cyan",width:"100px",onclick:E,title:"Create new dialog zone at center of view",children:(ie,Ae)=>{var le=re("+ ZONE");S(ie,le)},$$slots:{default:!0}})};K(qe,Z=>{r()==="dialogs"&&Z(Ht)})}var R=M(qe,2);{let Z=X(()=>r()==="dialogs"?"orange":"cyan");oe(R,{get variant(){return c(Z)},onclick:()=>{r()==="dialogs"?Yn("items"):Yn("dialogs")},title:"Edit dialog zones",children:(ie,Ae)=>{var le=re("DIALOGS");S(ie,le)},$$slots:{default:!0}})}S(ht,ft)},$$slots:{default:!0}}),S(me,_e)},$$slots:{default:!0}}),G(()=>Xe=Pe(de,1,"right-buttons svelte-1vm8op7",null,Xe,{"hide-right":c(p)})),S(j,de)},$$slots:{default:!0}}),S(n,A),he(),h()}var Id=F("<div> </div>"),Cd=F('<div class="dialog-content svelte-1jd14ss"> </div>'),Dd=F("<div><!> <!></div>");function Td(n,e){ue(e,!0);const t=()=>L(za,"$activeDialogText",s),i=()=>L(Nr,"$playerScreenPosition",s),[s,r]=Ie();let o=X(()=>t()?.title&&t()?.content),l=X(()=>Math.max(10,window.innerHeight-i().y+Yc)),a=X(()=>window.innerWidth<=Wc),d=X(()=>c(a)?50:i().x),u=X(()=>c(a)?"percent":"px");var h=Ee(),f=ae(h);{var g=p=>{var _=Dd();let w;var v=O(_);{var E=m=>{var y=Id();let b;var D=O(y);G(()=>{b=Pe(y,1,"dialog-title svelte-1jd14ss",null,b,{"has-divider":c(o)}),xe(D,t().title)}),S(m,y)};K(v,m=>{t().title&&m(E)})}var A=M(v,2);{var x=m=>{var y=Cd(),b=O(y);G(()=>xe(b,t().content)),S(m,y)};K(A,m=>{t().content&&m(x)})}G(()=>{w=Pe(_,1,"dialog-bubble svelte-1jd14ss",null,w,{narrow:c(a)}),ce(_,`bottom: ${c(l)??""}px; left: ${c(d)??""}${c(u)??""};`)}),S(p,_)};K(f,p=>{t()&&p(g)})}S(n,h),he(),r()}var Ad=F("<!> <!>",1),kd=F('<div class="touch-controls"><p class="touch-text">Tap and hold<br/>where you want<br/>to move</p></div>'),Md=F('<div class="desktop-controls"><div class="key-row"><div class="pixel-key">A</div> <div class="pixel-key">W</div> <div class="pixel-key">D</div></div> <p class="or-text">or</p> <div class="key-row"><div class="pixel-key">â</div> <div class="pixel-key">â</div> <div class="pixel-key">â</div></div></div>'),Pd=F('<div class="loader-overlay"><div class="pixel-loader"></div></div>'),$d=F('<div class="game-ui-wrapper svelte-13dvmla"><!> <!> <!> <dialog class="pixel-dialog"><h1>CONTROLS</h1> <div class="controls-content"><!></div></dialog> <!></div>');function Od(n,e){ue(e,!1);const t=()=>L(Sn,"$showControlsDialog",a),i=()=>L(Fr,"$hasPlayerMoved",a),s=()=>L(Ur,"$isBuilderMode",a),r=()=>L($n,"$currentLanguage",a),o=()=>L(Hr,"$isTouchDevice",a),l=()=>L(Hi,"$isLoading",a),[a,d]=Ie();let u=Ui();function h(){const I=lo.toggleLanguage();$n.set(I)}function f(I){!c(u)?.open||I.target.closest(".pixel-button")||Sn.set(!1)}function g(){const I=_c();if(!I){console.error("Cannot enter builder mode: map config not found");return}yc(I)}ys(()=>(c(u),t()),()=>{c(u)&&(t()?c(u).showModal():c(u).close())}),ys(()=>(i(),c(u),Sn),()=>{i()&&c(u)?.open&&Sn.set(!1)}),_a(),La();var p=$d();Ot("pointerdown",rr,f);var _=O(p);{var w=I=>{xd(I,{})},v=I=>{var H=Ad(),k=ae(H);Td(k,{});var B=M(k,2);fo(B,{}),S(I,H)};K(_,I=>{s()?I(w):I(v,!1)})}var E=M(_,2);{var A=I=>{oe(I,{position:"top-left",variant:"green",width:"120px",onclick:g,title:"Toggle Builder Mode",children:(H,k)=>{var B=re("BUILD");S(H,B)},$$slots:{default:!0}})};K(E,I=>{s()||I(A)})}var x=M(E,2);{var m=I=>{oe(I,{position:"top-right",variant:"default",width:"100px",onclick:h,title:"Toggle Language (L)",children:(H,k)=>{var B=re();G(V=>xe(B,V),[()=>(r(),Lt(()=>r().toUpperCase()))]),S(H,B)},$$slots:{default:!0}})};K(x,I=>{s()||I(m)})}var y=M(x,2),b=M(O(y),2),D=O(b);{var T=I=>{var H=kd();S(I,H)},N=I=>{var H=Md();S(I,H)};K(D,I=>{o()?I(T):I(N,!1)})}pn(y,I=>P(u,I),()=>c(u));var C=M(y,2);{var $=I=>{var H=Pd();S(I,H)};K(C,I=>{l()&&I($)})}S(n,p),he(),d()}Ja();const go=document.getElementById("game-ui");if(!go)throw new Error("game-ui element not found!");Ca(Od,{target:go});$n.set(lo.getLanguage());Wa.set(Zr.getSkin());Ya.set(ii.getCurrentConfig().name);const Ld={type:W.AUTO,width:800,height:600,parent:"game-container",backgroundColor:"#000000",pixelArt:!0,roundPixels:!0,scale:{mode:W.Scale.RESIZE,autoCenter:W.Scale.CENTER_BOTH},physics:{default:"arcade",arcade:{gravity:{y:1e3,x:0},debug:!1}},audio:{noAudio:!0},scene:[ic,gc]},po=new W.Game(Ld);mc(po);const Rd=po.device.input.touch;Hr.set(Rd);const Hd=performance.getEntriesByType("navigation")[0]&&performance.getEntriesByType("navigation")[0].type==="reload",Fd=sessionStorage.getItem("hasSeenControlsHint");(!Fd||Hd)&&(sessionStorage.setItem("hasSeenControlsHint","true"),Sn.set(!0));
//# sourceMappingURL=index-Bq_PASW1.js.map
