{"version":3,"file":"builder-BDhZmET1.js","sources":["../../src/scenes/CharacterPreviewScene.ts","../../src/ui/CharacterBuilder.svelte","../../src/builder.ts"],"sourcesContent":["/**\n * CharacterPreviewScene\n * \n * Phaser scene for previewing modular character customization.\n * Renders layered sprites and synchronizes animations.\n * \n * Spritesheet layout: 10 columns Ã— 7 rows\n * Each animation occupies its own row.\n */\n\nimport Phaser from 'phaser';\nimport {\n  type ModularCharacterSelection,\n  type ModularItem,\n  type ModularCategory,\n  MODULAR_FRAME,\n  MODULAR_ANIMATIONS,\n  LAYER_ORDER,\n  getItemsForSelection,\n  getModularAssetPath,\n  getModularTextureKey,\n  getItemById,\n  sortClothingByLayer,\n  getHatsFromClothing,\n} from '../data/modularConfig';\n\nexport default class CharacterPreviewScene extends Phaser.Scene {\n  private layerSprites: Phaser.GameObjects.Sprite[] = [];\n  private loadedTextures: Set<string> = new Set();\n  private currentAnimName: string = 'idle';\n  private currentSelection: ModularCharacterSelection | null = null;\n  \n  constructor() {\n    super({ key: 'CharacterPreviewScene' });\n  }\n  \n  create() {\n    // Listen for resize events\n    this.scale.on('resize', this.onResize, this);\n    \n    // Emit ready event for Svelte\n    this.game.events.emit('ready');\n  }\n  \n  /**\n   * Handle resize - reposition and rescale character\n   */\n  private onResize() {\n    if (this.layerSprites.length > 0) {\n      this.repositionCharacter();\n    }\n  }\n  \n  /**\n   * Calculate display scale based on canvas size\n   */\n  private getDisplayScale(): number {\n    const minDimension = Math.min(this.cameras.main.width, this.cameras.main.height);\n    // Scale to fit ~70% of the canvas height\n    return Math.max(3, Math.floor(minDimension / 64 * 0.65));\n  }\n  \n  /**\n   * Reposition and rescale all sprites\n   * Character sprite has empty space above head, so we offset Y slightly up\n   */\n  private repositionCharacter() {\n    const centerX = this.cameras.main.width / 2;\n    // Offset up by ~10% of height to account for empty space above character's head\n    const centerY = this.cameras.main.height / 2 - (this.cameras.main.height * 0.05);\n    const scale = this.getDisplayScale();\n    \n    this.layerSprites.forEach(sprite => {\n      sprite.setPosition(centerX, centerY);\n      sprite.setScale(scale);\n    });\n  }\n  \n  /**\n   * Update character with new selection (called from Svelte)\n   */\n  public updateCharacter(selection: ModularCharacterSelection) {\n    this.currentSelection = selection;\n    \n    const items = getItemsForSelection(selection);\n    this.loadTextures(items).then(() => {\n      this.rebuildCharacter();\n    });\n  }\n  \n  /**\n   * Load textures for items\n   */\n  private async loadTextures(items: ModularItem[]): Promise<void> {\n    const toLoad = items.filter(item => {\n      const key = getModularTextureKey(item);\n      return !this.loadedTextures.has(key);\n    });\n    \n    if (toLoad.length === 0) return;\n    \n    return new Promise((resolve) => {\n      toLoad.forEach(item => {\n        const key = getModularTextureKey(item);\n        const path = getModularAssetPath(item);\n        \n        this.load.spritesheet(key, path, {\n          frameWidth: MODULAR_FRAME.WIDTH,\n          frameHeight: MODULAR_FRAME.HEIGHT,\n        });\n      });\n      \n      this.load.once('complete', () => {\n        toLoad.forEach(item => {\n          const key = getModularTextureKey(item);\n          this.loadedTextures.add(key);\n          this.createAnimationsForTexture(key);\n        });\n        resolve();\n      });\n      \n      this.load.start();\n    });\n  }\n  \n  /**\n   * Create all animations for a texture\n   */\n  private createAnimationsForTexture(textureKey: string) {\n    MODULAR_ANIMATIONS.forEach(anim => {\n      const animKey = `${textureKey}-${anim.name}`;\n      \n      if (this.anims.exists(animKey)) return;\n      \n      this.anims.create({\n        key: animKey,\n        frames: this.anims.generateFrameNumbers(textureKey, {\n          start: anim.from,\n          end: anim.to,\n        }),\n        frameRate: anim.frameRate,\n        repeat: anim.name === 'death' ? 0 : -1,\n      });\n    });\n  }\n  \n  /**\n   * Rebuild character display - destroys old sprites and creates new ones\n   * Layer order: skins -> clothing (no hats) -> hair -> hats\n   */\n  private rebuildCharacter() {\n    // Destroy ALL existing layer sprites\n    this.layerSprites.forEach(sprite => {\n      if (sprite && sprite.active) {\n        sprite.destroy();\n      }\n    });\n    this.layerSprites = [];\n    \n    if (!this.currentSelection) return;\n    \n    const { width, height } = this.cameras.main;\n    const centerX = width / 2;\n    // Offset Y slightly up to account for empty space above character head\n    const centerY = height / 2 - (height * 0.05);\n    const scale = this.getDisplayScale();\n    \n    // Build layers in order: skins -> clothing (no hats) -> hair\n    LAYER_ORDER.forEach(category => {\n      const itemIds = this.getItemIdsForCategory(category);\n      \n      itemIds.forEach(itemId => {\n        const item = getItemById(itemId);\n        if (!item) return;\n        \n        const textureKey = getModularTextureKey(item);\n        if (!this.textures.exists(textureKey)) return;\n        \n        const sprite = this.add.sprite(centerX, centerY, textureKey);\n        sprite.setScale(scale);\n        sprite.setOrigin(0.5, 0.5);\n        \n        this.layerSprites.push(sprite);\n      });\n    });\n    \n    // Add hats AFTER hair (on top of everything)\n    const hatIds = getHatsFromClothing(this.currentSelection.clothing);\n    hatIds.forEach(hatId => {\n      const item = getItemById(hatId);\n      if (!item) return;\n      \n      const textureKey = getModularTextureKey(item);\n      if (!this.textures.exists(textureKey)) return;\n      \n      const sprite = this.add.sprite(centerX, centerY, textureKey);\n      sprite.setScale(scale);\n      sprite.setOrigin(0.5, 0.5);\n      \n      this.layerSprites.push(sprite);\n    });\n    \n    // Play animation on all sprites\n    this.playAnimationOnAll(this.currentAnimName);\n  }\n  \n  /**\n   * Get item IDs for a category (sorted by layer order for clothing)\n   */\n  private getItemIdsForCategory(category: ModularCategory): string[] {\n    if (!this.currentSelection) return [];\n    \n    switch (category) {\n      case 'skins':\n        return this.currentSelection.skin ? [this.currentSelection.skin] : [];\n      case 'hair':\n        return this.currentSelection.hair ? [this.currentSelection.hair] : [];\n      case 'clothing':\n        // Sort clothing by subcategory layer order (underwear -> legs -> chest -> feet -> hats)\n        return sortClothingByLayer(this.currentSelection.clothing);\n      default:\n        return [];\n    }\n  }\n  \n  /**\n   * Play animation on all layer sprites\n   */\n  private playAnimationOnAll(animName: string) {\n    this.layerSprites.forEach(sprite => {\n      const textureKey = sprite.texture.key;\n      const animKey = `${textureKey}-${animName}`;\n      \n      if (this.anims.exists(animKey)) {\n        sprite.play(animKey);\n      }\n    });\n  }\n  \n  /**\n   * Play a specific animation (called from Svelte)\n   */\n  public playAnimation(animName: string) {\n    this.currentAnimName = animName;\n    this.playAnimationOnAll(animName);\n  }\n  \n  /**\n   * Sync animations across all layers\n   */\n  update() {\n    if (this.layerSprites.length <= 1) return;\n    \n    const first = this.layerSprites[0];\n    if (!first?.anims?.currentFrame) return;\n    \n    const targetIndex = first.anims.currentFrame.index;\n    \n    for (let i = 1; i < this.layerSprites.length; i++) {\n      const sprite = this.layerSprites[i];\n      const anim = sprite.anims.currentAnim;\n      \n      if (anim && sprite.anims.currentFrame?.index !== targetIndex) {\n        const frame = anim.frames[targetIndex];\n        if (frame) {\n          sprite.anims.setCurrentFrame(frame);\n        }\n      }\n    }\n  }\n}\n","<script lang=\"ts\">\n  import { onMount, onDestroy } from 'svelte';\n  import Phaser from 'phaser';\n  import PixelButton from './PixelButton.svelte';\n  import {\n    type Gender,\n    type ModularCategory,\n    type ModularItem,\n    type ModularCharacterSelection,\n    type ClothingSubcategory,\n    LAYER_ORDER,\n    CLOTHING_UI_ORDER,\n    getItemsForGender,\n    getClothingBySubcategory,\n    createDefaultSelection,\n    getModularAssetPath,\n    getItemById,\n  } from '../data/modularConfig';\n  import CharacterPreviewScene from '../scenes/CharacterPreviewScene';\n  \n  // ============================================================================\n  // State\n  // ============================================================================\n  \n  let phaserGame: Phaser.Game | null = $state(null);\n  let gameContainer: HTMLDivElement | null = $state(null);\n  \n  // Character selection state\n  let selection: ModularCharacterSelection = $state(createDefaultSelection('male'));\n  \n  // UI state\n  let activeCategory: ModularCategory = $state('skins');\n  let activeClothingSubcategory: ClothingSubcategory = $state('chest');\n  \n  // Computed items for current gender\n  let currentItems = $derived(getItemsForGender(selection.gender));\n  let currentClothingBySubcategory = $derived(getClothingBySubcategory(selection.gender));\n  \n  // ============================================================================\n  // Lifecycle\n  // ============================================================================\n  \n  onMount(() => {\n    loadSavedSelection();\n    initPhaser();\n  });\n  \n  onDestroy(() => {\n    phaserGame?.destroy(true);\n    phaserGame = null;\n  });\n  \n  // ============================================================================\n  // Phaser initialization\n  // ============================================================================\n  \n  function initPhaser() {\n    if (!gameContainer) return;\n    \n    // Get container size for responsive canvas\n    const rect = gameContainer.getBoundingClientRect();\n    const width = Math.floor(rect.width) || 400;\n    const height = Math.floor(rect.height) || 400;\n    \n    const config: Phaser.Types.Core.GameConfig = {\n      type: Phaser.AUTO,\n      width: width,\n      height: height,\n      parent: gameContainer,\n      transparent: true,\n      pixelArt: true,\n      scale: {\n        mode: Phaser.Scale.RESIZE,\n        autoCenter: Phaser.Scale.CENTER_BOTH,\n      },\n      scene: [CharacterPreviewScene],\n    };\n    \n    phaserGame = new Phaser.Game(config);\n    \n    // Pass initial selection to scene\n    phaserGame.events.once('ready', () => {\n      updatePreview();\n    });\n  }\n  \n  // ============================================================================\n  // Selection management\n  // ============================================================================\n  \n  function setGender(gender: Gender) {\n    if (selection.gender === gender) return;\n    // Reset selection for new gender\n    selection = createDefaultSelection(gender);\n    updatePreview();\n  }\n  \n  function selectSkin(item: ModularItem) {\n    selection.skin = item.id;\n    updatePreview();\n  }\n  \n  function selectHair(item: ModularItem) {\n    // Toggle off if already selected\n    selection.hair = selection.hair === item.id ? null : item.id;\n    updatePreview();\n  }\n\n  function selectClothing(item: ModularItem) {\n    // Only one item per subcategory allowed\n    // Remove any existing item from same subcategory, then add this one (or toggle off)\n    const isCurrentlySelected = selection.clothing.includes(item.id);\n    \n    // Filter out items from the same subcategory\n    const filtered = selection.clothing.filter(id => {\n      const existing = getItemById(id);\n      return existing?.subcategory !== item.subcategory;\n    });\n    \n    if (isCurrentlySelected) {\n      // Toggle off - just use filtered list\n      selection.clothing = filtered;\n    } else {\n      // Select this item\n      selection.clothing = [...filtered, item.id];\n    }\n    updatePreview();\n  }\n  \n  function getSelectedClothingForSubcategory(subcategory: ClothingSubcategory): string | null {\n    for (const id of selection.clothing) {\n      const item = getItemById(id);\n      if (item?.subcategory === subcategory) {\n        return id;\n      }\n    }\n    return null;\n  }\n  \n  function isSelected(item: ModularItem): boolean {\n    switch (item.category) {\n      case 'skins':\n        return selection.skin === item.id;\n      case 'hair':\n        return selection.hair === item.id;\n      case 'clothing':\n        return selection.clothing.includes(item.id);\n      default:\n        return false;\n    }\n  }\n  \n  function handleItemClick(item: ModularItem) {\n    switch (item.category) {\n      case 'skins':\n        selectSkin(item);\n        break;\n      case 'hair':\n        selectHair(item);\n        break;\n      case 'clothing':\n        selectClothing(item);\n        break;\n    }\n  }\n  \n  // Get preview image path for an item (first frame)\n  function getItemPreviewPath(item: ModularItem): string {\n    return getModularAssetPath(item);\n  }  // ============================================================================\n  // Preview & Persistence\n  // ============================================================================\n  \n  function updatePreview() {\n    if (!phaserGame) return;\n    const scene = phaserGame.scene.getScene('CharacterPreviewScene') as CharacterPreviewScene;\n    if (scene && scene.updateCharacter) {\n      scene.updateCharacter(selection);\n    }\n  }\n  \n  function saveSelection() {\n    localStorage.setItem('characterSelection', JSON.stringify(selection));\n  }\n  \n  function loadSavedSelection() {\n    const saved = localStorage.getItem('characterSelection');\n    if (saved) {\n      try {\n        const parsed = JSON.parse(saved) as ModularCharacterSelection;\n        // Validate basic structure\n        if (parsed.gender && (parsed.gender === 'male' || parsed.gender === 'female')) {\n          selection = {\n            ...parsed,\n            clothing: Array.isArray(parsed.clothing) ? parsed.clothing : [],\n          };\n        }\n      } catch (e) {\n        console.warn('Failed to load saved character selection:', e);\n      }\n    }\n  }\n  \n  function handleSaveAndPlay() {\n    saveSelection();\n    // Mark that we want to use the modular player\n    localStorage.setItem('useModularPlayer', 'true');\n    // Navigate back to character/background selection\n    window.location.href = '/';\n  }\n  \n  // ============================================================================\n  // Animation controls\n  // ============================================================================\n  \n  let currentAnimation = $state('idle');\n  const animations = ['idle', 'run'];\n  \n  function playAnimation(animName: string) {\n    currentAnimation = animName;\n    if (!phaserGame) return;\n    const scene = phaserGame.scene.getScene('CharacterPreviewScene') as CharacterPreviewScene;\n    if (scene && scene.playAnimation) {\n      scene.playAnimation(animName);\n    }\n  }\n</script>\n\n<div class=\"character-builder\">\n  <!-- Header -->\n  <header class=\"header\">\n    <h1>Character Builder</h1>\n    <PixelButton variant=\"green\" onclick={handleSaveAndPlay}>\n      SAVE & PLAY\n    </PixelButton>\n  </header>\n  \n  <div class=\"main-content\">\n    <!-- Preview section (always visible, on top on mobile) -->\n    <div class=\"preview-section\">\n      <div class=\"preview-container\" bind:this={gameContainer}></div>\n      \n      <!-- Animation buttons -->\n      <div class=\"animation-controls\">\n        {#each animations as anim}\n          <button \n            class=\"anim-btn\"\n            class:active={currentAnimation === anim}\n            onclick={() => playAnimation(anim)}\n          >\n            {anim}\n          </button>\n        {/each}\n      </div>\n    </div>\n    \n    <!-- Selection panel -->\n    <div class=\"selection-panel\">\n      <!-- Gender toggle -->\n        <div class=\"gender-toggle\">\n          <button \n            class=\"gender-btn\"\n            class:active={selection.gender === 'male'}\n            onclick={() => setGender('male')}\n          >\n            Male\n          </button>\n          <button \n            class=\"gender-btn\"\n            class:active={selection.gender === 'female'}\n            onclick={() => setGender('female')}\n          >\n            Female\n          </button>\n        </div>\n        \n        <!-- Category tabs -->\n        <div class=\"category-tabs\">\n          {#each LAYER_ORDER as category}\n            <button \n              class=\"category-tab\"\n              class:active={activeCategory === category}\n              onclick={() => activeCategory = category}\n            >\n              {category}\n            </button>\n          {/each}\n        </div>\n        \n        <!-- Clothing subcategory tabs (only shown when clothing is active) -->\n        {#if activeCategory === 'clothing'}\n          <div class=\"subcategory-tabs\">\n            {#each CLOTHING_UI_ORDER as subcategory}\n              <button \n                class=\"subcategory-tab\"\n                class:active={activeClothingSubcategory === subcategory}\n                onclick={() => activeClothingSubcategory = subcategory}\n              >\n                {subcategory}\n              </button>\n            {/each}\n          </div>\n        {/if}\n        \n        <!-- Items grid -->\n        <div class=\"items-grid\">\n          {#if activeCategory === 'clothing'}\n            {#each currentClothingBySubcategory[activeClothingSubcategory] as item}\n              <button \n                class=\"item-btn\"\n                class:selected={isSelected(item)}\n                onclick={() => handleItemClick(item)}\n                title={item.name}\n              >\n                <div class=\"item-preview\">\n                  <img src={getItemPreviewPath(item)} alt={item.name} class=\"preview-img\" />\n                </div>\n                <span class=\"item-name\">{item.name}</span>\n              </button>\n            {/each}\n          {:else}\n            {#each currentItems[activeCategory] as item}\n              <button \n                class=\"item-btn\"\n                class:selected={isSelected(item)}\n                onclick={() => handleItemClick(item)}\n                title={item.name}\n              >\n                <div class=\"item-preview\">\n                  <img src={getItemPreviewPath(item)} alt={item.name} class=\"preview-img\" />\n                </div>\n                <span class=\"item-name\">{item.name}</span>\n              </button>\n            {/each}\n          {/if}\n        </div>\n    </div>\n  </div>\n</div>\n\n<style>\n  .character-builder {\n    width: 100vw;\n    height: 100vh;\n    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);\n    color: white;\n    font-family: 'Press Start 2P', monospace;\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n  }\n  \n  .header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 15px 20px;\n    background: rgba(0, 0, 0, 0.3);\n    border-bottom: 3px solid #333;\n    flex-shrink: 0;\n  }\n  \n  .header h1 {\n    font-size: 16px;\n    margin: 0;\n    text-shadow: 2px 2px 0 #000;\n  }\n  \n  .main-content {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n    padding: 15px;\n    overflow-y: auto;\n    overflow-x: hidden;\n  }\n  \n  /* Selection panel (now on top) */\n  .selection-panel {\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n    flex-shrink: 0;\n  }\n  \n  .gender-toggle {\n    display: flex;\n    gap: 10px;\n  }\n  \n  .gender-btn {\n    flex: 1;\n    padding: 12px;\n    background: #2a2a4a;\n    border: 3px solid #444;\n    color: #aaa;\n    font-family: inherit;\n    font-size: 11px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n  }\n  \n  .gender-btn:hover {\n    background: #3a3a5a;\n    color: white;\n  }\n  \n  .gender-btn.active {\n    background: #9b59b6;\n    border-color: #8e44ad;\n    color: white;\n  }\n  \n  .category-tabs {\n    display: flex;\n    gap: 8px;\n  }\n  \n  .category-tab {\n    flex: 1;\n    padding: 10px 8px;\n    background: #2a2a4a;\n    border: 2px solid #444;\n    color: #aaa;\n    font-family: inherit;\n    font-size: 10px;\n    text-transform: uppercase;\n    cursor: pointer;\n    transition: all 0.15s ease;\n  }\n  \n  .category-tab:hover {\n    background: #3a3a5a;\n    color: white;\n  }\n  \n  .category-tab.active {\n    background: #27ae60;\n    border-color: #229954;\n    color: white;\n  }\n  \n  .subcategory-tabs {\n    display: flex;\n    gap: 6px;\n    flex-wrap: wrap;\n  }\n  \n  .subcategory-tab {\n    flex: 1;\n    padding: 8px 6px;\n    background: #1a1a3a;\n    border: 2px solid #383858;\n    color: #888;\n    font-family: inherit;\n    font-size: 9px;\n    text-transform: uppercase;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    min-width: 55px;\n    max-width: 80px;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n  \n  .subcategory-tab:hover {\n    background: #2a2a4a;\n    color: #bbb;\n  }\n  \n  .subcategory-tab.active {\n    background: #e67e22;\n    border-color: #d35400;\n    color: white;\n  }\n\n  .items-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));\n    gap: 8px;\n    padding: 8px;\n    background: rgba(0, 0, 0, 0.2);\n    border: 2px solid #333;\n    border-radius: 4px;\n    max-height: 280px;\n    overflow-y: auto;\n    align-content: start;\n  }\n  \n  .item-btn {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 4px;\n    padding: 4px;\n    background: #2a2a4a;\n    border: 2px solid #444;\n    color: #ccc;\n    font-family: inherit;\n    font-size: 7px;\n    text-align: center;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    height: fit-content;\n  }\n  \n  .item-btn:hover {\n    background: #3a3a5a;\n    border-color: #555;\n    color: white;\n  }\n  \n  .item-btn.selected {\n    background: #3498db;\n    border-color: #2980b9;\n    color: white;\n  }\n  \n  .item-preview {\n    width: 80px;\n    height: 64px;\n    overflow: hidden;\n    display: flex;\n    align-items: flex-start;\n    justify-content: flex-start;\n    image-rendering: pixelated;\n  }\n  \n  .preview-img {\n    width: 800px;\n    height: 448px;\n    object-fit: none;\n    object-position: 0 0;\n    transform: scale(1);\n    transform-origin: top left;\n    image-rendering: pixelated;\n  }\n  \n  .item-name {\n    word-break: break-word;\n    line-height: 1.3;\n    max-width: 100%;\n    display: -webkit-box;\n    -webkit-line-clamp: 2;\n    -webkit-box-orient: vertical;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: normal;\n  }\n\n  /* Preview section */\n  .preview-section {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    flex-shrink: 0;\n  }\n  \n  .preview-container {\n    height: 200px;\n    background: \n      linear-gradient(to right, #2a2a4a 1px, transparent 1px),\n      linear-gradient(to bottom, #2a2a4a 1px, transparent 1px),\n      #1a1a2e;\n    background-size: 16px 16px;\n    border: 4px solid #333;\n    border-radius: 4px;\n    overflow: hidden;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n  \n  .animation-controls {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 6px;\n  }\n  \n  .anim-btn {\n    padding: 6px 10px;\n    background: #2a2a4a;\n    border: 2px solid #444;\n    color: #aaa;\n    font-family: inherit;\n    font-size: 9px;\n    text-transform: uppercase;\n    cursor: pointer;\n    transition: all 0.15s ease;\n  }\n  \n  .anim-btn:hover {\n    background: #3a3a5a;\n    color: white;\n  }\n  \n  .anim-btn.active {\n    background: #4a90e2;\n    border-color: #357abd;\n    color: white;\n  }\n  \n  /* Scrollbar styling */\n  .items-grid::-webkit-scrollbar,\n  .main-content::-webkit-scrollbar {\n    width: 8px;\n  }\n  \n  .items-grid::-webkit-scrollbar-track,\n  .main-content::-webkit-scrollbar-track {\n    background: #1a1a2e;\n  }\n  \n  .items-grid::-webkit-scrollbar-thumb,\n  .main-content::-webkit-scrollbar-thumb {\n    background: #444;\n    border-radius: 4px;\n  }\n  \n  .items-grid::-webkit-scrollbar-thumb:hover,\n  .main-content::-webkit-scrollbar-thumb:hover {\n    background: #555;\n  }\n  \n  /* Desktop: side by side layout */\n  @media (min-width: 900px) {\n    .main-content {\n      flex-direction: row;\n      overflow: hidden;\n    }\n    \n    .selection-panel {\n      flex: 1;\n      max-width: 550px;\n      overflow-y: auto;\n    }\n    \n    .items-grid {\n      flex: 1;\n      max-height: none;\n    }\n    \n    .preview-section {\n      width: 300px;\n      flex-shrink: 0;\n    }\n    \n    .preview-container {\n      flex: 1;\n      height: auto;\n      min-height: 200px;\n    }\n    \n    .selection-toggle {\n      display: none !important;\n    }\n  }\n  \n  /* Mobile */\n  @media (max-width: 899px) {\n    .header h1 {\n      font-size: 12px;\n    }\n    \n    .items-grid {\n      max-height: 200px;\n    }\n  }\n  \n  /* Very small screens */\n  @media (max-width: 500px) {\n    .items-grid {\n      grid-template-columns: repeat(auto-fill, minmax(85px, 1fr));\n    }\n    \n    .item-preview {\n      width: 64px;\n      height: 52px;\n    }\n    \n    .preview-img {\n      transform: scale(0.8);\n    }\n    \n    .subcategory-tab {\n      min-width: 45px;\n      font-size: 8px;\n      padding: 6px 4px;\n    }\n  }\n</style>\n","/**\n * Builder Entry Point\n * \n * Separate page for the modular character builder.\n */\n\nimport { mount } from 'svelte';\nimport CharacterBuilder from './ui/CharacterBuilder.svelte';\n\n// Wait for DOM to be ready\nconst builderRoot = document.getElementById('builder-root');\n\nif (!builderRoot) {\n  throw new Error('builder-root element not found!');\n}\n\n// Mount the CharacterBuilder component\nmount(CharacterBuilder, {\n  target: builderRoot,\n});\n"],"names":["CharacterPreviewScene","Phaser","minDimension","centerX","centerY","scale","sprite","selection","items","getItemsForSelection","toLoad","item","key","getModularTextureKey","resolve","path","getModularAssetPath","MODULAR_FRAME","textureKey","MODULAR_ANIMATIONS","anim","animKey","width","height","LAYER_ORDER","category","itemId","getItemById","getHatsFromClothing","hatId","sortClothingByLayer","animName","first","targetIndex","i","frame","phaserGame","gameContainer","$.state","$.proxy","createDefaultSelection","activeCategory","activeClothingSubcategory","currentItems","$.derived","getItemsForGender","$.get","currentClothingBySubcategory","getClothingBySubcategory","onMount","loadSavedSelection","initPhaser","onDestroy","$.set","rect","config","updatePreview","setGender","gender","selectSkin","selectHair","selectClothing","isCurrentlySelected","filtered","id","isSelected","handleItemClick","getItemPreviewPath","scene","saveSelection","saved","parsed","e","handleSaveAndPlay","currentAnimation","animations","playAnimation","$.bind_this","div_3","$$value","$.each","div_4","button","classes","$.set_class","button_1","button_2","div_7","button_3","classes_3","div_8","CLOTHING_UI_ORDER","subcategory","button_4","$$render","consequent","$.index","$$anchor","button_5","$.set_attribute","img","$.set_text","text_4","button_6","img_1","text_5","consequent_1","alternate","builderRoot","mount","CharacterBuilder"],"mappings":"oYA0BA,MAAqBA,WAA8BC,EAAO,KAAM,CACtD,aAA4C,CAAA,EAC5C,mBAAkC,IAClC,gBAA0B,OAC1B,iBAAqD,KAE7D,aAAc,CACZ,MAAM,CAAE,IAAK,wBAAyB,CACxC,CAEA,QAAS,CAEP,KAAK,MAAM,GAAG,SAAU,KAAK,SAAU,IAAI,EAG3C,KAAK,KAAK,OAAO,KAAK,OAAO,CAC/B,CAKQ,UAAW,CACb,KAAK,aAAa,OAAS,GAC7B,KAAK,oBAAA,CAET,CAKQ,iBAA0B,CAChC,MAAMC,EAAe,KAAK,IAAI,KAAK,QAAQ,KAAK,MAAO,KAAK,QAAQ,KAAK,MAAM,EAE/E,OAAO,KAAK,IAAI,EAAG,KAAK,MAAMA,EAAe,GAAK,GAAI,CAAC,CACzD,CAMQ,qBAAsB,CAC5B,MAAMC,EAAU,KAAK,QAAQ,KAAK,MAAQ,EAEpCC,EAAU,KAAK,QAAQ,KAAK,OAAS,EAAK,KAAK,QAAQ,KAAK,OAAS,IACrEC,EAAQ,KAAK,gBAAA,EAEnB,KAAK,aAAa,QAAQC,GAAU,CAClCA,EAAO,YAAYH,EAASC,CAAO,EACnCE,EAAO,SAASD,CAAK,CACvB,CAAC,CACH,CAKO,gBAAgBE,EAAsC,CAC3D,KAAK,iBAAmBA,EAExB,MAAMC,EAAQC,GAAqBF,CAAS,EAC5C,KAAK,aAAaC,CAAK,EAAE,KAAK,IAAM,CAClC,KAAK,iBAAA,CACP,CAAC,CACH,CAKA,MAAc,aAAaA,EAAqC,CAC9D,MAAME,EAASF,EAAM,OAAOG,GAAQ,CAClC,MAAMC,EAAMC,EAAqBF,CAAI,EACrC,MAAO,CAAC,KAAK,eAAe,IAAIC,CAAG,CACrC,CAAC,EAED,GAAIF,EAAO,SAAW,EAEtB,OAAO,IAAI,QAASI,GAAY,CAC9BJ,EAAO,QAAQC,GAAQ,CACrB,MAAMC,EAAMC,EAAqBF,CAAI,EAC/BI,EAAOC,GAAoBL,CAAI,EAErC,KAAK,KAAK,YAAYC,EAAKG,EAAM,CAC/B,WAAYE,GAAc,MAC1B,YAAaA,GAAc,MAAA,CAC5B,CACH,CAAC,EAED,KAAK,KAAK,KAAK,WAAY,IAAM,CAC/BP,EAAO,QAAQC,GAAQ,CACrB,MAAMC,EAAMC,EAAqBF,CAAI,EACrC,KAAK,eAAe,IAAIC,CAAG,EAC3B,KAAK,2BAA2BA,CAAG,CACrC,CAAC,EACDE,EAAA,CACF,CAAC,EAED,KAAK,KAAK,MAAA,CACZ,CAAC,CACH,CAKQ,2BAA2BI,EAAoB,CACrDC,GAAmB,QAAQC,GAAQ,CACjC,MAAMC,EAAU,GAAGH,CAAU,IAAIE,EAAK,IAAI,GAEtC,KAAK,MAAM,OAAOC,CAAO,GAE7B,KAAK,MAAM,OAAO,CAChB,IAAKA,EACL,OAAQ,KAAK,MAAM,qBAAqBH,EAAY,CAClD,MAAOE,EAAK,KACZ,IAAKA,EAAK,EAAA,CACX,EACD,UAAWA,EAAK,UAChB,OAAQA,EAAK,OAAS,QAAU,EAAI,EAAA,CACrC,CACH,CAAC,CACH,CAMQ,kBAAmB,CASzB,GAPA,KAAK,aAAa,QAAQd,GAAU,CAC9BA,GAAUA,EAAO,QACnBA,EAAO,QAAA,CAEX,CAAC,EACD,KAAK,aAAe,CAAA,EAEhB,CAAC,KAAK,iBAAkB,OAE5B,KAAM,CAAE,MAAAgB,EAAO,OAAAC,CAAA,EAAW,KAAK,QAAQ,KACjCpB,EAAUmB,EAAQ,EAElBlB,EAAUmB,EAAS,EAAKA,EAAS,IACjClB,EAAQ,KAAK,gBAAA,EAGnBmB,GAAY,QAAQC,GAAY,CACd,KAAK,sBAAsBA,CAAQ,EAE3C,QAAQC,GAAU,CACxB,MAAMf,EAAOgB,EAAYD,CAAM,EAC/B,GAAI,CAACf,EAAM,OAEX,MAAMO,EAAaL,EAAqBF,CAAI,EAC5C,GAAI,CAAC,KAAK,SAAS,OAAOO,CAAU,EAAG,OAEvC,MAAMZ,EAAS,KAAK,IAAI,OAAOH,EAASC,EAASc,CAAU,EAC3DZ,EAAO,SAASD,CAAK,EACrBC,EAAO,UAAU,GAAK,EAAG,EAEzB,KAAK,aAAa,KAAKA,CAAM,CAC/B,CAAC,CACH,CAAC,EAGcsB,GAAoB,KAAK,iBAAiB,QAAQ,EAC1D,QAAQC,GAAS,CACtB,MAAMlB,EAAOgB,EAAYE,CAAK,EAC9B,GAAI,CAAClB,EAAM,OAEX,MAAMO,EAAaL,EAAqBF,CAAI,EAC5C,GAAI,CAAC,KAAK,SAAS,OAAOO,CAAU,EAAG,OAEvC,MAAMZ,EAAS,KAAK,IAAI,OAAOH,EAASC,EAASc,CAAU,EAC3DZ,EAAO,SAASD,CAAK,EACrBC,EAAO,UAAU,GAAK,EAAG,EAEzB,KAAK,aAAa,KAAKA,CAAM,CAC/B,CAAC,EAGD,KAAK,mBAAmB,KAAK,eAAe,CAC9C,CAKQ,sBAAsBmB,EAAqC,CACjE,GAAI,CAAC,KAAK,iBAAkB,MAAO,CAAA,EAEnC,OAAQA,EAAA,CACN,IAAK,QACH,OAAO,KAAK,iBAAiB,KAAO,CAAC,KAAK,iBAAiB,IAAI,EAAI,CAAA,EACrE,IAAK,OACH,OAAO,KAAK,iBAAiB,KAAO,CAAC,KAAK,iBAAiB,IAAI,EAAI,CAAA,EACrE,IAAK,WAEH,OAAOK,GAAoB,KAAK,iBAAiB,QAAQ,EAC3D,QACE,MAAO,CAAA,CAAC,CAEd,CAKQ,mBAAmBC,EAAkB,CAC3C,KAAK,aAAa,QAAQzB,GAAU,CAElC,MAAMe,EAAU,GADGf,EAAO,QAAQ,GACL,IAAIyB,CAAQ,GAErC,KAAK,MAAM,OAAOV,CAAO,GAC3Bf,EAAO,KAAKe,CAAO,CAEvB,CAAC,CACH,CAKO,cAAcU,EAAkB,CACrC,KAAK,gBAAkBA,EACvB,KAAK,mBAAmBA,CAAQ,CAClC,CAKA,QAAS,CACP,GAAI,KAAK,aAAa,QAAU,EAAG,OAEnC,MAAMC,EAAQ,KAAK,aAAa,CAAC,EACjC,GAAI,CAACA,GAAO,OAAO,aAAc,OAEjC,MAAMC,EAAcD,EAAM,MAAM,aAAa,MAE7C,QAASE,EAAI,EAAGA,EAAI,KAAK,aAAa,OAAQA,IAAK,CACjD,MAAM5B,EAAS,KAAK,aAAa4B,CAAC,EAC5Bd,EAAOd,EAAO,MAAM,YAE1B,GAAIc,GAAQd,EAAO,MAAM,cAAc,QAAU2B,EAAa,CAC5D,MAAME,EAAQf,EAAK,OAAOa,CAAW,EACjCE,GACF7B,EAAO,MAAM,gBAAgB6B,CAAK,CAEtC,CACF,CACF,CACF,ujCC9QA,UAwBM,IAAAC,IAAwC,IAAI,EAC5CC,IAA8C,IAAI,EAGlD9B,EAAoC+B,EAAAC,GAAUC,GAAuB,MAAM,CAAA,CAAA,EAG3EC,IAAyC,OAAO,EAChDC,IAAwD,OAAO,EAG/DC,EAAYC,GAAA,IAAYC,GAAiBC,EAACvC,CAAS,EAAC,MAAM,CAAA,EAC1DwC,EAA4BH,GAAA,IAAYI,GAAwBF,EAACvC,CAAS,EAAC,MAAM,CAAA,EAMrF0C,GAAO,IAAO,CACZC,GAAkB,EAClBC,EAAU,CACZ,CAAC,EAEDC,GAAS,IAAO,GACdhB,CAAU,GAAE,QAAQ,EAAI,EACxBiB,EAAAjB,EAAa,IAAI,CACnB,CAAC,EAMQ,SAAAe,GAAa,OACfd,CAAa,EAAA,aAGZiB,EAAIR,EAAGT,CAAa,EAAC,sBAAqB,EAC1Cf,EAAQ,KAAK,MAAMgC,EAAK,KAAK,GAAK,IAClC/B,EAAS,KAAK,MAAM+B,EAAK,MAAM,GAAK,IAEpCC,EAAoC,CACxC,KAAMtD,EAAO,KACN,MAAAqB,EACC,OAAAC,EACR,SAAQc,CAAa,EACrB,YAAa,GACb,SAAU,GACV,MAAK,CACH,KAAMpC,EAAO,MAAM,OACnB,WAAYA,EAAO,MAAM,aAE3B,OAAQD,EAAqB,GAG/BqD,EAAAjB,EAAU,IAAOnC,EAAO,KAAKsD,CAAM,EAAA,EAAA,EAGnCT,EAAAV,CAAU,EAAC,OAAO,KAAK,QAAO,IAAQ,CACpCoB,EAAa,CACf,CAAC,CACH,UAMSC,EAAUC,EAAgB,GAC7BnD,CAAS,EAAC,SAAWmD,MAEzBnD,EAAYiC,GAAuBkB,CAAM,EAAA,EAAA,EACzCF,EAAa,EACf,UAESG,EAAWhD,EAAmB,CACrCmC,EAAAvC,CAAS,EAAC,KAAOI,EAAK,GACtB6C,EAAa,CACf,UAESI,EAAWjD,EAAmB,CAErCmC,EAAAvC,CAAS,EAAC,KAAIuC,EAAGvC,CAAS,EAAC,OAASI,EAAK,GAAK,KAAOA,EAAK,GAC1D6C,EAAa,CACf,UAESK,GAAelD,EAAmB,OAGnCmD,EAAmBhB,EAAGvC,CAAS,EAAC,SAAS,SAASI,EAAK,EAAE,EAGzDoD,EAAQjB,EAAGvC,CAAS,EAAC,SAAS,OAAOyD,GACxBrC,EAAYqC,CAAE,GACd,cAAgBrD,EAAK,WACvC,EAEGmD,IAEFvD,CAAS,EAAC,SAAWwD,EAGrBjB,EAAAvC,CAAS,EAAC,SAAQ,CAAA,GAAOwD,EAAUpD,EAAK,EAAE,EAE5C6C,EAAa,CACf,UAYSS,EAAWtD,EAA4B,CACtC,OAAAA,EAAK,SAAQ,KACd,QACI,OAAAmC,EAAAvC,CAAS,EAAC,OAASI,EAAK,OAC5B,OACI,OAAAmC,EAAAvC,CAAS,EAAC,OAASI,EAAK,OAC5B,WACI,OAAAmC,EAAAvC,CAAS,EAAC,SAAS,SAASI,EAAK,EAAE,gBAEnC,GAEb,UAESuD,EAAgBvD,EAAmB,CAClC,OAAAA,EAAK,SAAQ,KACd,QACHgD,EAAWhD,CAAI,YAEZ,OACHiD,EAAWjD,CAAI,YAEZ,WACHkD,GAAelD,CAAI,QAGzB,UAGSwD,EAAmBxD,EAA2B,CAC9C,OAAAK,GAAoBL,CAAI,CACjC,CAIS,SAAA6C,GAAgB,OAClBpB,CAAU,EAAA,OACT,MAAAgC,IAAQhC,CAAU,EAAC,MAAM,SAAS,uBAAuB,EAC3DgC,GAASA,EAAM,iBACjBA,EAAM,gBAAetB,EAACvC,CAAS,CAAA,CAEnC,CAES,SAAA8D,IAAgB,CACvB,aAAa,QAAQ,qBAAsB,KAAK,UAASvB,EAACvC,CAAS,CAAA,CAAA,CACrE,CAES,SAAA2C,IAAqB,CACtB,MAAAoB,EAAQ,aAAa,QAAQ,oBAAoB,EACnD,GAAAA,EACE,GAAA,CACI,MAAAC,EAAS,KAAK,MAAMD,CAAK,EAE3BC,EAAO,SAAWA,EAAO,SAAW,QAAUA,EAAO,SAAW,aAClEhE,MACKgE,EACH,SAAU,MAAM,QAAQA,EAAO,QAAQ,EAAIA,EAAO,SAAQ,CAAA,MAGhE,OAASC,EAAG,CACV,QAAQ,KAAK,4CAA6CA,CAAC,CAC7D,CAEJ,CAES,SAAAC,IAAoB,CAC3BJ,GAAa,EAEb,aAAa,QAAQ,mBAAoB,MAAM,EAE/C,OAAO,SAAS,KAAO,GACzB,CAMI,IAAAK,IAA0B,MAAM,QAC9BC,GAAU,CAAI,OAAQ,KAAK,WAExBC,GAAc7C,EAAkB,IACvCsB,EAAAqB,EAAmB3C,EAAQ,EAAA,KACtBK,CAAU,EAAA,OACT,MAAAgC,IAAQhC,CAAU,EAAC,MAAM,SAAS,uBAAuB,EAC3DgC,GAASA,EAAM,eACjBA,EAAM,cAAcrC,CAAQ,CAEhC,+DAOwC0C,wGAQMI,GAAAC,EAAAC,GAAA1B,EAAAhB,WAAAA,CAAa,CAAA,gBAI9C2C,EAAAC,GAAA,GAAA,IAAAN,QAAcvD,IAAI,kBAIN8D,EAAA,QAAA,IAAAN,KAAcxD,CAAI,CAAA,oBADnB+D,EAAAC,EAAAF,EAAA,EAAA,yBAAA,KAAAC,EAAA,CAAA,OAAArC,EAAA4B,CAAgB,MAAKtD,CAAI,CAAA,CAAA,QAGtCA,CAAI,CAAA,gDAaUiE,EAAA,QAAA,IAAA5B,EAAU,MAAM,uBAOhB6B,GAAA,QAAA,IAAA7B,EAAU,QAAQ,gBAQ5BuB,EAAAO,GAAA,GAAA,IAAA/D,QAAeC,IAAQ,kBAIX+D,EAAA,QAAA,IAAAnC,EAAAZ,IAAiBhB,CAAQ,EAAA,EAAA,oBAD1BgE,EAAAL,EAAAI,EAAA,EAAA,6BAAA,KAAAC,EAAA,CAAA,OAAA3C,EAAAL,CAAc,MAAKhB,CAAQ,CAAA,CAAA,QAGxCA,CAAQ,CAAA,mDAQJuD,EAAAU,EAAA,GAAA,IAAAC,QAAqBC,IAAW,kBAIpBC,EAAA,QAAA,IAAAxC,EAAAX,IAA4BkD,CAAW,EAAA,EAAA,oEADxC,OAAA9C,EAAAJ,CAAyB,MAAKkD,CAAW,UAGtDA,CAAW,CAAA,+BARf9C,EAAAL,CAAc,IAAK,YAAUqD,EAAAC,EAAA,wEAiBvBhD,CAA4B,EAAAD,EAACJ,CAAyB,CAAA,EAAAsD,EAAA,CAAAC,EAAKtF,IAAI,kBAInDuF,EAAA,QAAA,IAAAhC,IAAgBvD,CAAI,CAAA,yFAC5BwF,EAAAD,EAAA,QAAApD,EAAAnC,CAAI,EAAC,IAAI,eAG2BwF,EAAAC,EAAA,MAAAtD,EAAAnC,CAAI,EAAC,IAAI,EAE3B0F,EAAAC,EAAAxD,EAAAnC,CAAI,EAAC,IAAI,IAPlB,KAAA,CAAA,SAAAsD,IAAWtD,CAAI,CAAA,CAAA,GAKnB,IAAAwD,IAAmBxD,CAAI,CAAA,4DAMhCgC,CAAY,EAAAG,EAACL,CAAc,CAAA,EAAAuD,EAAA,CAAAC,EAAKtF,IAAI,kBAIxB4F,EAAA,QAAA,IAAArC,IAAgBvD,CAAI,CAAA,yFAC5BwF,EAAAI,EAAA,QAAAzD,EAAAnC,CAAI,EAAC,IAAI,eAG2BwF,EAAAK,EAAA,MAAA1D,EAAAnC,CAAI,EAAC,IAAI,EAE3B0F,EAAAI,EAAA3D,EAAAnC,CAAI,EAAC,IAAI,IAPlB,KAAA,CAAA,SAAAsD,IAAWtD,CAAI,CAAA,CAAA,GAKnB,IAAAwD,IAAmBxD,CAAI,CAAA,+BAvBpCmC,EAAAL,CAAc,IAAK,WAAUqD,EAAAY,EAAA,EAAAZ,EAAAa,GAAA,EAAA,+DA5ClBpG,CAAS,EAAC,SAAW,MAAM,CAAA,yDAO3BA,CAAS,EAAC,SAAW,QAAQ,CAAA,eA3CvD,eCxNA,MAAMqG,GAAc,SAAS,eAAe,cAAc,EAE1D,GAAI,CAACA,GACH,MAAM,IAAI,MAAM,iCAAiC,EAInDC,GAAMC,GAAkB,CACtB,OAAQF,EACV,CAAC"}