import{P as D,o as Ee,p as F,q as he,M as se,w as Pe,L as ue,v as K,y as Re,x as Fe,A as Te,B as Me,D as x,E as Oe,a9 as ne,Z as De,a4 as Be,F as w,a1 as He,H as v,J as Ne,_ as T,G as u,I as ie,g as e,K as A,T as m,U as Le,k as p,V as oe,W as ce,a2 as $e,N as S,Q as M,$ as O,aa as Ge,R as k,Y as le,ab as Ke,ac as Ue,a8 as Ye}from"./PixelButton-DPdsozSk.js";import"./phaser-DFK5Ua9d.js";class ze extends D.Scene{layerSprites=[];loadedTextures=new Set;currentAnimName="idle";currentSelection=null;constructor(){super({key:"CharacterPreviewScene"})}create(){this.scale.on("resize",this.onResize,this),this.game.events.emit("ready")}onResize(){this.layerSprites.length>0&&this.repositionCharacter()}getDisplayScale(){const n=Math.min(this.cameras.main.width,this.cameras.main.height);return Math.max(3,Math.floor(n/64*.65))}repositionCharacter(){const n=this.cameras.main.width/2,s=this.cameras.main.height/2-this.cameras.main.height*.05,o=this.getDisplayScale();this.layerSprites.forEach(a=>{a.setPosition(n,s),a.setScale(o)})}updateCharacter(n){this.currentSelection=n;const s=Ee(n);this.loadTextures(s).then(()=>{this.rebuildCharacter()})}async loadTextures(n){const s=n.filter(o=>{const a=F(o);return!this.loadedTextures.has(a)});if(s.length!==0)return new Promise(o=>{s.forEach(a=>{const h=F(a),g=he(a);this.load.spritesheet(h,g,{frameWidth:se.WIDTH,frameHeight:se.HEIGHT})}),this.load.once("complete",()=>{s.forEach(a=>{const h=F(a);this.loadedTextures.add(h),this.createAnimationsForTexture(h)}),o()}),this.load.start()})}createAnimationsForTexture(n){Pe.forEach(s=>{const o=`${n}-${s.name}`;this.anims.exists(o)||this.anims.create({key:o,frames:this.anims.generateFrameNumbers(n,{start:s.from,end:s.to}),frameRate:s.frameRate,repeat:s.name==="death"?0:-1})})}rebuildCharacter(){if(this.layerSprites.forEach(f=>{f&&f.active&&f.destroy()}),this.layerSprites=[],!this.currentSelection)return;const{width:n,height:s}=this.cameras.main,o=n/2,a=s/2-s*.05,h=this.getDisplayScale();ue.forEach(f=>{this.getItemIdsForCategory(f).forEach(b=>{const _=K(b);if(!_)return;const B=F(_);if(!this.textures.exists(B))return;const I=this.add.sprite(o,a,B);I.setScale(h),I.setOrigin(.5,.5),this.layerSprites.push(I)})}),Re(this.currentSelection.clothing).forEach(f=>{const C=K(f);if(!C)return;const b=F(C);if(!this.textures.exists(b))return;const _=this.add.sprite(o,a,b);_.setScale(h),_.setOrigin(.5,.5),this.layerSprites.push(_)}),this.playAnimationOnAll(this.currentAnimName)}getItemIdsForCategory(n){if(!this.currentSelection)return[];switch(n){case"skins":return this.currentSelection.skin?[this.currentSelection.skin]:[];case"hair":return this.currentSelection.hair?[this.currentSelection.hair]:[];case"clothing":return Fe(this.currentSelection.clothing);default:return[]}}playAnimationOnAll(n){this.layerSprites.forEach(s=>{const a=`${s.texture.key}-${n}`;this.anims.exists(a)&&s.play(a)})}playAnimation(n){this.currentAnimName=n,this.playAnimationOnAll(n)}update(){if(this.layerSprites.length<=1)return;const n=this.layerSprites[0];if(!n?.anims?.currentFrame)return;const s=n.anims.currentFrame.index;for(let o=1;o<this.layerSprites.length;o++){const a=this.layerSprites[o],h=a.anims.currentAnim;if(h&&a.anims.currentFrame?.index!==s){const g=h.frames[s];g&&a.anims.setCurrentFrame(g)}}}}var Je=w("<button> </button>"),We=w("<button> </button>"),Ve=w("<button> </button>"),Xe=w('<div class="subcategory-tabs svelte-9on13w"></div>'),Ze=w('<button><div class="item-preview svelte-9on13w"><img class="preview-img svelte-9on13w"/></div> <span class="item-name svelte-9on13w"> </span></button>'),qe=w('<button><div class="item-preview svelte-9on13w"><img class="preview-img svelte-9on13w"/></div> <span class="item-name svelte-9on13w"> </span></button>'),Qe=w('<div class="character-builder svelte-9on13w"><header class="header svelte-9on13w"><h1 class="svelte-9on13w">Character Builder</h1> <!></header> <div class="main-content svelte-9on13w"><div class="preview-section svelte-9on13w"><div class="preview-container svelte-9on13w"></div> <div class="animation-controls svelte-9on13w"></div></div> <div class="selection-panel svelte-9on13w"><div class="gender-toggle svelte-9on13w"><button>Male</button> <button>Female</button></div> <div class="category-tabs svelte-9on13w"></div> <!> <div class="items-grid svelte-9on13w"><!></div></div></div></div>');function je(U,n){Me(n,!0);let s=x(null),o=x(null),a=x(Oe(ne("male"))),h=x("skins"),g=x("chest"),f=le(()=>Ue(e(a).gender)),C=le(()=>Ke(e(a).gender));De(()=>{ge(),b()}),Be(()=>{e(s)?.destroy(!0),p(s,null)});function b(){if(!e(o))return;const t=e(o).getBoundingClientRect(),r=Math.floor(t.width)||400,c=Math.floor(t.height)||400,l={type:D.AUTO,width:r,height:c,parent:e(o),transparent:!0,pixelArt:!0,scale:{mode:D.Scale.RESIZE,autoCenter:D.Scale.CENTER_BOTH},scene:[ze]};p(s,new D.Game(l),!0),e(s).events.once("ready",()=>{E()})}function _(t){e(a).gender!==t&&(p(a,ne(t),!0),E())}function B(t){e(a).skin=t.id,E()}function I(t){e(a).hair=e(a).hair===t.id?null:t.id,E()}function ve(t){const r=e(a).clothing.includes(t.id),c=e(a).clothing.filter(l=>K(l)?.subcategory!==t.subcategory);r?e(a).clothing=c:e(a).clothing=[...c,t.id],E()}function Y(t){switch(t.category){case"skins":return e(a).skin===t.id;case"hair":return e(a).hair===t.id;case"clothing":return e(a).clothing.includes(t.id);default:return!1}}function z(t){switch(t.category){case"skins":B(t);break;case"hair":I(t);break;case"clothing":ve(t);break}}function J(t){return he(t)}function E(){if(!e(s))return;const t=e(s).scene.getScene("CharacterPreviewScene");t&&t.updateCharacter&&t.updateCharacter(e(a))}function me(){localStorage.setItem("characterSelection",JSON.stringify(e(a)))}function ge(){const t=localStorage.getItem("characterSelection");if(t)try{const r=JSON.parse(t);r.gender&&(r.gender==="male"||r.gender==="female")&&p(a,{...r,clothing:Array.isArray(r.clothing)?r.clothing:[]},!0)}catch(r){console.warn("Failed to load saved character selection:",r)}}function fe(){me(),localStorage.setItem("useModularPlayer","true"),window.location.href="/"}let W=x("idle");const _e=["idle","run"];function pe(t){if(p(W,t,!0),!e(s))return;const r=e(s).scene.getScene("CharacterPreviewScene");r&&r.playAnimation&&r.playAnimation(t)}var V=Qe(),X=u(V),ye=v(u(X),2);He(ye,{variant:"green",onclick:fe,children:(t,r)=>{var c=$e("SAVE & PLAY");m(t,c)},$$slots:{default:!0}});var Se=v(X,2),Z=u(Se),q=u(Z);Ne(q,t=>p(o,t),()=>e(o));var we=v(q,2);T(we,21,()=>_e,O,(t,r)=>{var c=Je();let l;c.__click=()=>pe(e(r));var i=u(c);A(()=>{l=S(c,1,"anim-btn svelte-9on13w",null,l,{active:e(W)===e(r)}),M(i,e(r))}),m(t,c)});var be=v(Z,2),Q=u(be),H=u(Q);let j;H.__click=()=>_("male");var ee=v(H,2);let te;ee.__click=()=>_("female");var ae=v(Q,2);T(ae,21,()=>ue,O,(t,r)=>{var c=We();let l;c.__click=()=>p(h,e(r),!0);var i=u(c);A(()=>{l=S(c,1,"category-tab svelte-9on13w",null,l,{active:e(h)===e(r)}),M(i,e(r))}),m(t,c)});var re=v(ae,2);{var xe=t=>{var r=Xe();T(r,21,()=>Ge,O,(c,l)=>{var i=Ve();let d;i.__click=()=>p(g,e(l),!0);var y=u(i);A(()=>{d=S(i,1,"subcategory-tab svelte-9on13w",null,d,{active:e(g)===e(l)}),M(y,e(l))}),m(c,i)}),m(t,r)};ie(re,t=>{e(h)==="clothing"&&t(xe)})}var Ae=v(re,2),ke=u(Ae);{var Ce=t=>{var r=oe(),c=ce(r);T(c,17,()=>e(C)[e(g)],O,(l,i)=>{var d=Ze();let y;d.__click=()=>z(e(i));var P=u(d),R=u(P),N=v(P,2),L=u(N);A(($,G)=>{y=S(d,1,"item-btn svelte-9on13w",null,y,$),k(d,"title",e(i).name),k(R,"src",G),k(R,"alt",e(i).name),M(L,e(i).name)},[()=>({selected:Y(e(i))}),()=>J(e(i))]),m(l,d)}),m(t,r)},Ie=t=>{var r=oe(),c=ce(r);T(c,17,()=>e(f)[e(h)],O,(l,i)=>{var d=qe();let y;d.__click=()=>z(e(i));var P=u(d),R=u(P),N=v(P,2),L=u(N);A(($,G)=>{y=S(d,1,"item-btn svelte-9on13w",null,y,$),k(d,"title",e(i).name),k(R,"src",G),k(R,"alt",e(i).name),M(L,e(i).name)},[()=>({selected:Y(e(i))}),()=>J(e(i))]),m(l,d)}),m(t,r)};ie(ke,t=>{e(h)==="clothing"?t(Ce):t(Ie,!1)})}A(()=>{j=S(H,1,"gender-btn svelte-9on13w",null,j,{active:e(a).gender==="male"}),te=S(ee,1,"gender-btn svelte-9on13w",null,te,{active:e(a).gender==="female"})}),m(U,V),Le()}Te(["click"]);const de=document.getElementById("builder-root");if(!de)throw new Error("builder-root element not found!");Ye(je,{target:de});
//# sourceMappingURL=builder-BDhZmET1.js.map
