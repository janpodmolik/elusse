import{r as ro,g as ao}from"./phaser-DFK5Ua9d.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();var oo=ro();const Y=ao(oo),Cr=240,lo=48;function vs(n){return n.variant?`assets/skins/${n.folder}/${n.variant}`:`assets/skins/${n.folder}`}function si(n){const e=n.frameHeight??lo;return Cr/e}const et=[{id:"succubus",name:"SUCCUBUS",folder:"succubus",variant:"basic",character:"human",frameWidth:156,frameHeight:72,facingLeft:!0,frameRates:{idle:8,run:12}}],Tr="succubus";class co{currentSkinId=Tr;constructor(){this.loadFromStorage()}loadFromStorage(){const e=localStorage.getItem("playerSkin");e&&this.isValidSkinId(e)&&(this.currentSkinId=e)}isValidSkinId(e){return et.some(t=>t.id===e)}setSkin(e){this.isValidSkinId(e)&&(this.currentSkinId=e,localStorage.setItem("playerSkin",e))}getSkinId(){return this.currentSkinId}getSkinConfig(){return et.find(e=>e.id===this.currentSkinId)||et[0]}getSkinById(e){return et.find(t=>t.id===e)}getAllSkins(){return et}getAnimationPrefix(){const e=this.getSkinConfig();return`${e.character}-${e.id}`}}const Un=new co,ii=!1;var mi=Array.isArray,uo=Array.prototype.indexOf,vi=Array.from,Dr=Object.defineProperty,Zn=Object.getOwnPropertyDescriptor,kr=Object.getOwnPropertyDescriptors,ho=Object.prototype,fo=Array.prototype,_i=Object.getPrototypeOf,Zi=Object.isExtensible;const mt=()=>{};function go(n){return n()}function Ss(n){for(var e=0;e<n.length;e++)n[e]()}function Pr(){var n,e,t=new Promise((s,i)=>{n=s,e=i});return{promise:t,resolve:n,reject:e}}function Ar(n,e){if(Array.isArray(n))return n;if(!(Symbol.iterator in n))return Array.from(n);const t=[];for(const s of n)if(t.push(s),t.length===e)break;return t}const ze=2,bi=4,Ms=8,po=1<<24,Ht=16,Xt=32,hn=64,$s=128,_t=512,Ye=1024,it=2048,At=4096,lt=8192,Yt=16384,yi=32768,on=65536,Yi=1<<17,Mr=1<<18,Mn=1<<19,$r=1<<20,ln=32768,ri=1<<21,wi=1<<22,Bt=1<<23,zt=Symbol("$state"),mo=Symbol(""),yn=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Lr(n){return n===this.v}function Or(n,e){return n!=n?e==e:n!==e||n!==null&&typeof n=="object"||typeof n=="function"}function Rr(n){return!Or(n,this.v)}function Fr(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function vo(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function _o(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function bo(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function yo(n){throw new Error("https://svelte.dev/e/effect_orphan")}function wo(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function So(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Eo(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function xo(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function Io(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}let os=!1,Co=!1;function To(){os=!0}const Do=1,ko=2,Po=16,Ao=1,Mo=2,Ke=Symbol(),$o="http://www.w3.org/1999/xhtml";let ve=null;function Tn(n){ve=n}function we(n,e=!1,t){ve={p:ve,i:!1,c:null,e:null,s:n,x:null,l:os&&!e?{s:null,u:null,$:[]}:null}}function Se(n){var e=ve,t=e.e;if(t!==null){e.e=null;for(var s of t)ra(s)}return e.i=!0,ve=e.p,{}}function ls(){return!os||ve!==null&&ve.l===null}let wn=[];function Lo(){var n=wn;wn=[],Ss(n)}function cs(n){if(wn.length===0){var e=wn;queueMicrotask(()=>{e===wn&&Lo()})}wn.push(n)}function Oo(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Ro(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function Je(n){if(typeof n!="object"||n===null||zt in n)return n;const e=_i(n);if(e!==ho&&e!==fo)return n;var t=new Map,s=mi(n),i=K(0),r=rn,a=o=>{if(rn===r)return o();var c=ee,d=rn;nt(null),Ui(r);var u=o();return nt(c),Ui(d),u};return s&&t.set("length",K(n.length)),new Proxy(n,{defineProperty(o,c,d){(!("value"in d)||d.configurable===!1||d.enumerable===!1||d.writable===!1)&&So();var u=t.get(c);return u===void 0?u=a(()=>{var h=K(d.value);return t.set(c,h),h}):$(u,d.value,!0),!0},deleteProperty(o,c){var d=t.get(c);if(d===void 0){if(c in o){const u=a(()=>K(Ke));t.set(c,u),Yn(i)}}else $(d,Ke),Yn(i);return!0},get(o,c,d){if(c===zt)return n;var u=t.get(c),h=c in o;if(u===void 0&&(!h||Zn(o,c)?.writable)&&(u=a(()=>{var p=Je(h?o[c]:Ke),m=K(p);return m}),t.set(c,u)),u!==void 0){var f=l(u);return f===Ke?void 0:f}return Reflect.get(o,c,d)},getOwnPropertyDescriptor(o,c){var d=Reflect.getOwnPropertyDescriptor(o,c);if(d&&"value"in d){var u=t.get(c);u&&(d.value=l(u))}else if(d===void 0){var h=t.get(c),f=h?.v;if(h!==void 0&&f!==Ke)return{enumerable:!0,configurable:!0,value:f,writable:!0}}return d},has(o,c){if(c===zt)return!0;var d=t.get(c),u=d!==void 0&&d.v!==Ke||Reflect.has(o,c);if(d!==void 0||se!==null&&(!u||Zn(o,c)?.writable)){d===void 0&&(d=a(()=>{var f=u?Je(o[c]):Ke,p=K(f);return p}),t.set(c,d));var h=l(d);if(h===Ke)return!1}return u},set(o,c,d,u){var h=t.get(c),f=c in o;if(s&&c==="length")for(var p=d;p<h.v;p+=1){var m=t.get(p+"");m!==void 0?$(m,Ke):p in o&&(m=a(()=>K(Ke)),t.set(p+"",m))}if(h===void 0)(!f||Zn(o,c)?.writable)&&(h=a(()=>K(void 0)),$(h,Je(d)),t.set(c,h));else{f=h.v!==Ke;var S=a(()=>Je(d));$(h,S)}var w=Reflect.getOwnPropertyDescriptor(o,c);if(w?.set&&w.set.call(u,d),!f){if(s&&typeof c=="string"){var g=t.get("length"),b=Number(c);Number.isInteger(b)&&b>=g.v&&$(g,b+1)}Yn(i)}return!0},ownKeys(o){l(i);var c=Reflect.ownKeys(o).filter(h=>{var f=t.get(h);return f===void 0||f.v!==Ke});for(var[d,u]of t)u.v!==Ke&&!(d in o)&&c.push(d);return c},setPrototypeOf(){Eo()}})}function Bi(n){try{if(n!==null&&typeof n=="object"&&zt in n)return n[zt]}catch{}return n}function Fo(n,e){return Object.is(Bi(n),Bi(e))}var zi,Hr,Xr,Nr,Wr;function Ho(){if(zi===void 0){zi=window,Hr=document,Xr=/Firefox/.test(navigator.userAgent);var n=Element.prototype,e=Node.prototype,t=Text.prototype;Nr=Zn(e,"firstChild").get,Wr=Zn(e,"nextSibling").get,Zi(n)&&(n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__style=void 0,n.__e=void 0),Zi(t)&&(t.__t=void 0)}}function Ft(n=""){return document.createTextNode(n)}function Es(n){return Nr.call(n)}function ds(n){return Wr.call(n)}function M(n,e){return Es(n)}function de(n,e=!1){{var t=Es(n);return t instanceof Comment&&t.data===""?ds(t):t}}function k(n,e=1,t=!1){let s=n;for(;e--;)s=ds(s);return s}function Xo(n){n.textContent=""}function Zr(){return!1}function Yr(n){var e=se;if(e===null)return ee.f|=Bt,n;if((e.f&yi)===0){if((e.f&$s)===0)throw n;e.b.error(n)}else Dn(n,e)}function Dn(n,e){for(;e!==null;){if((e.f&$s)!==0)try{e.b.error(n);return}catch(t){n=t}e=e.parent}throw n}const hs=new Set;let _e=null,ht=null,It=[],Si=null,ai=!1;class Tt{committed=!1;current=new Map;previous=new Map;#e=new Set;#t=new Set;#s=0;#n=0;#l=null;#r=[];#i=[];skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#n>0}process(e){It=[],this.apply();var t={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const s of e)this.#a(s,t);this.is_fork||this.#d(),this.is_deferred()?(this.#o(t.effects),this.#o(t.render_effects),this.#o(t.block_effects)):(_e=null,Ki(t.render_effects),Ki(t.effects),this.#l?.resolve()),ht=null}#a(e,t){e.f^=Ye;for(var s=e.first;s!==null;){var i=s.f,r=(i&(Xt|hn))!==0,a=r&&(i&Ye)!==0,o=a||(i&lt)!==0||this.skipped_effects.has(s);if((s.f&$s)!==0&&s.b?.is_pending()&&(t={parent:t,effect:s,effects:[],render_effects:[],block_effects:[]}),!o&&s.fn!==null){r?s.f^=Ye:(i&bi)!==0?t.effects.push(s):Ln(s)&&((s.f&Ht)!==0&&t.block_effects.push(s),kn(s));var c=s.first;if(c!==null){s=c;continue}}var d=s.parent;for(s=s.next;s===null&&d!==null;)d===t.effect&&(this.#o(t.effects),this.#o(t.render_effects),this.#o(t.block_effects),t=t.parent),s=d.next,d=d.parent}}#o(e){for(const t of e)((t.f&it)!==0?this.#r:this.#i).push(t),this.#c(t.deps),Be(t,Ye)}#c(e){if(e!==null)for(const t of e)(t.f&ze)===0||(t.f&ln)===0||(t.f^=ln,this.#c(t.deps))}capture(e,t){this.previous.has(e)||this.previous.set(e,t),(e.f&Bt)===0&&(this.current.set(e,e.v),ht?.set(e,e.v))}activate(){_e=this,this.apply()}deactivate(){_e===this&&(_e=null,ht=null)}flush(){if(this.activate(),It.length>0){if(No(),_e!==null&&_e!==this)return}else this.#s===0&&this.process([]);this.deactivate()}discard(){for(const e of this.#t)e(this);this.#t.clear()}#d(){if(this.#n===0){for(const e of this.#e)e();this.#e.clear()}this.#s===0&&this.#u()}#u(){if(hs.size>1){this.previous.clear();var e=ht,t=!0,s={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const r of hs){if(r===this){t=!1;continue}const a=[];for(const[c,d]of this.current){if(r.current.has(c))if(t&&d!==r.current.get(c))r.current.set(c,d);else continue;a.push(c)}if(a.length===0)continue;const o=[...r.current.keys()].filter(c=>!this.current.has(c));if(o.length>0){var i=It;It=[];const c=new Set,d=new Map;for(const u of a)Br(u,o,c,d);if(It.length>0){_e=r,r.apply();for(const u of It)r.#a(u,s);r.deactivate()}It=i}}_e=null,ht=e}this.committed=!0,hs.delete(this)}increment(e){this.#s+=1,e&&(this.#n+=1)}decrement(e){this.#s-=1,e&&(this.#n-=1),this.revive()}revive(){for(const e of this.#r)Be(e,it),cn(e);for(const e of this.#i)Be(e,At),cn(e);this.#r=[],this.#i=[],this.flush()}oncommit(e){this.#e.add(e)}ondiscard(e){this.#t.add(e)}settled(){return(this.#l??=Pr()).promise}static ensure(){if(_e===null){const e=_e=new Tt;hs.add(_e),Tt.enqueue(()=>{_e===e&&e.flush()})}return _e}static enqueue(e){cs(e)}apply(){}}function No(){var n=Gt;ai=!0;var e=null;try{var t=0;for(Is(!0);It.length>0;){var s=Tt.ensure();if(t++>1e3){var i,r;Wo()}s.process(It),Kt.clear()}}finally{ai=!1,Is(n),Si=null}}function Wo(){try{wo()}catch(n){Dn(n,Si)}}let $t=null;function Ki(n){var e=n.length;if(e!==0){for(var t=0;t<e;){var s=n[t++];if((s.f&(Yt|lt))===0&&Ln(s)&&($t=new Set,kn(s),s.deps===null&&s.first===null&&s.nodes_start===null&&(s.teardown===null&&s.ac===null?ca(s):s.fn=null),$t?.size>0)){Kt.clear();for(const i of $t){if((i.f&(Yt|lt))!==0)continue;const r=[i];let a=i.parent;for(;a!==null;)$t.has(a)&&($t.delete(a),r.push(a)),a=a.parent;for(let o=r.length-1;o>=0;o--){const c=r[o];(c.f&(Yt|lt))===0&&kn(c)}}$t.clear()}}$t=null}}function Br(n,e,t,s){if(!t.has(n)&&(t.add(n),n.reactions!==null))for(const i of n.reactions){const r=i.f;(r&ze)!==0?Br(i,e,t,s):(r&(wi|Ht))!==0&&(r&it)===0&&zr(i,e,s)&&(Be(i,it),cn(i))}}function zr(n,e,t){const s=t.get(n);if(s!==void 0)return s;if(n.deps!==null)for(const i of n.deps){if(e.includes(i))return!0;if((i.f&ze)!==0&&zr(i,e,t))return t.set(i,!0),!0}return t.set(n,!1),!1}function cn(n){for(var e=Si=n;e.parent!==null;){e=e.parent;var t=e.f;if(ai&&e===se&&(t&Ht)!==0&&(t&Mr)===0)return;if((t&(hn|Xt))!==0){if((t&Ye)===0)return;e.f^=Ye}}It.push(e)}function Zo(n){let e=0,t=dn(0),s;return()=>{qn()&&(l(t),Rs(()=>(e===0&&(s=Pt(()=>n(()=>Yn(t)))),e+=1,()=>{cs(()=>{e-=1,e===0&&(s?.(),s=void 0,Yn(t))})})))}}var Yo=on|Mn|$s;function Bo(n,e,t){new zo(n,e,t)}class zo{parent;#e=!1;#t;#s=null;#n;#l;#r;#i=null;#a=null;#o=null;#c=null;#d=null;#u=0;#h=0;#g=!1;#f=null;#b=Zo(()=>(this.#f=dn(this.#u),()=>{this.#f=null}));constructor(e,t,s){this.#t=e,this.#n=t,this.#l=s,this.parent=se.b,this.#e=!!this.#n.pending,this.#r=Fs(()=>{se.b=this;{var i=this.#v();try{this.#i=ut(()=>s(i))}catch(r){this.error(r)}this.#h>0?this.#m():this.#e=!1}return()=>{this.#d?.remove()}},Yo)}#y(){try{this.#i=ut(()=>this.#l(this.#t))}catch(e){this.error(e)}this.#e=!1}#w(){const e=this.#n.pending;e&&(this.#a=ut(()=>e(this.#t)),Tt.enqueue(()=>{var t=this.#v();this.#i=this.#p(()=>(Tt.ensure(),ut(()=>this.#l(t)))),this.#h>0?this.#m():(En(this.#a,()=>{this.#a=null}),this.#e=!1)}))}#v(){var e=this.#t;return this.#e&&(this.#d=Ft(),this.#t.before(this.#d),e=this.#d),e}is_pending(){return this.#e||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!this.#n.pending}#p(e){var t=se,s=ee,i=ve;kt(this.#r),nt(this.#r),Tn(this.#r.ctx);try{return e()}catch(r){return Yr(r),null}finally{kt(t),nt(s),Tn(i)}}#m(){const e=this.#n.pending;this.#i!==null&&(this.#c=document.createDocumentFragment(),this.#c.append(this.#d),ha(this.#i,this.#c)),this.#a===null&&(this.#a=ut(()=>e(this.#t)))}#_(e){if(!this.has_pending_snippet()){this.parent&&this.parent.#_(e);return}this.#h+=e,this.#h===0&&(this.#e=!1,this.#a&&En(this.#a,()=>{this.#a=null}),this.#c&&(this.#t.before(this.#c),this.#c=null))}update_pending_count(e){this.#_(e),this.#u+=e,this.#f&&Vn(this.#f,this.#u)}get_effect_pending(){return this.#b(),l(this.#f)}error(e){var t=this.#n.onerror;let s=this.#n.failed;if(this.#g||!t&&!s)throw e;this.#i&&(st(this.#i),this.#i=null),this.#a&&(st(this.#a),this.#a=null),this.#o&&(st(this.#o),this.#o=null);var i=!1,r=!1;const a=()=>{if(i){Ro();return}i=!0,r&&Io(),Tt.ensure(),this.#u=0,this.#o!==null&&En(this.#o,()=>{this.#o=null}),this.#e=this.has_pending_snippet(),this.#i=this.#p(()=>(this.#g=!1,ut(()=>this.#l(this.#t)))),this.#h>0?this.#m():this.#e=!1};var o=ee;try{nt(null),r=!0,t?.(e,a),r=!1}catch(c){Dn(c,this.#r&&this.#r.parent)}finally{nt(o)}s&&cs(()=>{this.#o=this.#p(()=>{Tt.ensure(),this.#g=!0;try{return ut(()=>{s(this.#t,()=>e,()=>a)})}catch(c){return Dn(c,this.#r.parent),null}finally{this.#g=!1}})})}}function ot(n,e){return e}function Ko(n,e,t){for(var s=[],i=e.length,r=0;r<i;r++)Ii(e[r].e,s,!0);da(s,()=>{var a=s.length===0&&t!==null;if(a){var o=t,c=o.parentNode;Xo(c),c.append(o),n.items.clear(),xt(n,e[0].prev,e[i-1].next)}for(var d=0;d<i;d++){var u=e[d];a||(n.items.delete(u.k),xt(n,u.prev,u.next)),st(u.e,!a)}n.first===e[0]&&(n.first=e[0].prev)})}function tt(n,e,t,s,i,r=null){var a=n,o=new Map,c=null;{var d=n;a=d.appendChild(Ft())}var u=null,h=Kr(()=>{var g=t();return mi(g)?g:g==null?[]:vi(g)}),f,p=!0;function m(){Go(w,f,a,e,s),u!==null&&(f.length===0?(u.fragment?(a.before(u.fragment),u.fragment=null):Ci(u.effect),S.first=u.effect):En(u.effect,()=>{u=null}))}var S=Fs(()=>{f=l(h);for(var g=f.length,b=new Set,y=_e,v=null,_=Zr(),x=0;x<g;x+=1){var C=f[x],T=s(C,x),A=p?null:o.get(T);A?(Vn(A.v,C),A.i=x,_&&y.skipped_effects.delete(A.e)):(A=Uo(p?a:null,v,C,T,x,i,e,t),p&&(A.o=!0,v===null?c=A:v.next=A,v=A),o.set(T,A)),b.add(T)}if(g===0&&r&&!u)if(p)u={fragment:null,effect:ut(()=>r(a))};else{var I=document.createDocumentFragment(),D=Ft();I.append(D),u={fragment:I,effect:ut(()=>r(D))}}if(!p)if(_){for(const[P,O]of o)b.has(P)||y.skipped_effects.add(O.e);y.oncommit(m),y.ondiscard(()=>{})}else m();l(h)}),w={effect:S,items:o,first:c};p=!1}function Go(n,e,t,s,i){var r=e.length,a=n.items,o=n.first,c,d=null,u=[],h=[],f,p,m,S;for(S=0;S<r;S+=1){if(f=e[S],p=i(f,S),m=a.get(p),n.first??=m,!m.o){m.o=!0;var w=d?d.next:o;xt(n,d,m),xt(n,m,w),Bs(m,w,t),d=m,u=[],h=[],o=d.next;continue}if((m.e.f&lt)!==0&&Ci(m.e),m!==o){if(c!==void 0&&c.has(m)){if(u.length<h.length){var g=h[0],b;d=g.prev;var y=u[0],v=u[u.length-1];for(b=0;b<u.length;b+=1)Bs(u[b],g,t);for(b=0;b<h.length;b+=1)c.delete(h[b]);xt(n,y.prev,v.next),xt(n,d,y),xt(n,v,g),o=g,d=v,S-=1,u=[],h=[]}else c.delete(m),Bs(m,o,t),xt(n,m.prev,m.next),xt(n,m,d===null?n.first:d.next),xt(n,d,m),d=m;continue}for(u=[],h=[];o!==null&&o.k!==p;)(o.e.f&lt)===0&&(c??=new Set).add(o),h.push(o),o=o.next;if(o===null)continue;m=o}u.push(m),d=m,o=m.next}if(o!==null||c!==void 0){for(var _=c===void 0?[]:vi(c);o!==null;)(o.e.f&lt)===0&&_.push(o),o=o.next;var x=_.length;if(x>0){var C=r===0?t:null;Ko(n,_,C)}}}function Uo(n,e,t,s,i,r,a,o){var c=(a&Do)!==0,d=(a&Po)===0,u=c?d?Ct(t,!1,!1):dn(t):t,h=(a&ko)===0?i:dn(i),f={i:h,v:u,k:s,a:null,e:null,o:!1,prev:e,next:null};try{if(n===null){var p=document.createDocumentFragment();p.append(n=Ft())}return f.e=ut(()=>r(n,u,h,o)),e!==null&&(e.next=f),f}finally{}}function Bs(n,e,t){for(var s=n.next?n.next.e.nodes_start:t,i=e?e.e.nodes_start:t,r=n.e.nodes_start;r!==null&&r!==s;){var a=ds(r);i.before(r),r=a}}function xt(n,e,t){e===null?(n.first=t,n.effect.first=t&&t.e):(e.e.next&&(e.e.next.prev=null),e.next=t,e.e.next=t&&t.e),t===null?n.effect.last=e&&e.e:(t.e.prev&&(t.e.prev.next=null),t.prev=e,t.e.prev=e&&e.e)}function Vo(n,e,t,s){const i=ls()?Ls:Kr;if(t.length===0&&n.length===0){s(e.map(i));return}var r=_e,a=se,o=jo();function c(){Promise.all(t.map(d=>qo(d))).then(d=>{o();try{s([...e.map(i),...d])}catch(u){(a.f&Yt)===0&&Dn(u,a)}r?.deactivate(),xs()}).catch(d=>{Dn(d,a)})}n.length>0?Promise.all(n).then(()=>{o();try{return c()}finally{r?.deactivate(),xs()}}):c()}function jo(){var n=se,e=ee,t=ve,s=_e;return function(r=!0){kt(n),nt(e),Tn(t),r&&s?.activate()}}function xs(){kt(null),nt(null),Tn(null)}function Ls(n){var e=ze|it,t=ee!==null&&(ee.f&ze)!==0?ee:null;return se!==null&&(se.f|=Mn),{ctx:ve,deps:null,effects:null,equals:Lr,f:e,fn:n,reactions:null,rv:0,v:Ke,wv:0,parent:t??se,ac:null}}function qo(n,e){let t=se;t===null&&vo();var s=t.b,i=void 0,r=dn(Ke),a=!ee,o=new Map;return ll(()=>{var c=Pr();i=c.promise;try{Promise.resolve(n()).then(c.resolve,c.reject).then(()=>{d===_e&&d.committed&&d.deactivate(),xs()})}catch(f){c.reject(f),xs()}var d=_e;if(a){var u=!s.is_pending();s.update_pending_count(1),d.increment(u),o.get(d)?.reject(yn),o.delete(d),o.set(d,c)}const h=(f,p=void 0)=>{if(d.activate(),p)p!==yn&&(r.f|=Bt,Vn(r,p));else{(r.f&Bt)!==0&&(r.f^=Bt),Vn(r,f);for(const[m,S]of o){if(o.delete(m),m===d)break;S.reject(yn)}}a&&(s.update_pending_count(-1),d.decrement(u))};c.promise.then(h,f=>h(null,f||"unknown"))}),Os(()=>{for(const c of o.values())c.reject(yn)}),new Promise(c=>{function d(u){function h(){u===i?c(r):d(i)}u.then(h,h)}d(i)})}function N(n){const e=Ls(n);return qr(e),e}function Kr(n){const e=Ls(n);return e.equals=Rr,e}function Gr(n){var e=n.effects;if(e!==null){n.effects=null;for(var t=0;t<e.length;t+=1)st(e[t])}}function Jo(n){for(var e=n.parent;e!==null;){if((e.f&ze)===0)return(e.f&Yt)===0?e:null;e=e.parent}return null}function Ei(n){var e,t=se;kt(Jo(n));try{n.f&=~ln,Gr(n),e=ta(n)}finally{kt(t)}return e}function Ur(n){var e=Ei(n);if(n.equals(e)||(_e?.is_fork||(n.v=e),n.wv=Qr()),!$n)if(ht!==null)(qn()||_e?.is_fork)&&ht.set(n,e);else{var t=(n.f&_t)===0?At:Ye;Be(n,t)}}let oi=new Set;const Kt=new Map;let Vr=!1;function dn(n,e){var t={f:0,v:n,reactions:null,equals:Lr,rv:0,wv:0};return t}function K(n,e){const t=dn(n);return qr(t),t}function Ct(n,e=!1,t=!0){const s=dn(n);return e||(s.equals=Rr),os&&t&&ve!==null&&ve.l!==null&&(ve.l.s??=[]).push(s),s}function $(n,e,t=!1){ee!==null&&(!Dt||(ee.f&Yi)!==0)&&ls()&&(ee.f&(ze|Ht|wi|Yi))!==0&&!Ot?.includes(n)&&xo();let s=t?Je(e):e;return Vn(n,s)}function Vn(n,e){if(!n.equals(e)){var t=n.v;$n?Kt.set(n,e):Kt.set(n,t),n.v=e;var s=Tt.ensure();s.capture(n,t),(n.f&ze)!==0&&((n.f&it)!==0&&Ei(n),Be(n,(n.f&_t)!==0?Ye:At)),n.wv=Qr(),jr(n,it),ls()&&se!==null&&(se.f&Ye)!==0&&(se.f&(Xt|hn))===0&&(dt===null?el([n]):dt.push(n)),!s.is_fork&&oi.size>0&&!Vr&&Qo()}return e}function Qo(){Vr=!1;var n=Gt;Is(!0);const e=Array.from(oi);try{for(const t of e)(t.f&Ye)!==0&&Be(t,At),Ln(t)&&kn(t)}finally{Is(n)}oi.clear()}function Yn(n){$(n,n.v+1)}function jr(n,e){var t=n.reactions;if(t!==null)for(var s=ls(),i=t.length,r=0;r<i;r++){var a=t[r],o=a.f;if(!(!s&&a===se)){var c=(o&it)===0;if(c&&Be(a,e),(o&ze)!==0){var d=a;ht?.delete(d),(o&ln)===0&&(o&_t&&(a.f|=ln),jr(d,At))}else c&&((o&Ht)!==0&&$t!==null&&$t.add(a),cn(a))}}}function xi(n){var e=ee,t=se;nt(null),kt(null);try{return n()}finally{nt(e),kt(t)}}let Gt=!1;function Is(n){Gt=n}let $n=!1;function Gi(n){$n=n}let ee=null,Dt=!1;function nt(n){ee=n}let se=null;function kt(n){se=n}let Ot=null;function qr(n){ee!==null&&(Ot===null?Ot=[n]:Ot.push(n))}let qe=null,at=0,dt=null;function el(n){dt=n}let Jr=1,jn=0,rn=jn;function Ui(n){rn=n}function Qr(){return++Jr}function Ln(n){var e=n.f;if((e&it)!==0)return!0;if(e&ze&&(n.f&=~ln),(e&At)!==0){var t=n.deps;if(t!==null)for(var s=t.length,i=0;i<s;i++){var r=t[i];if(Ln(r)&&Ur(r),r.wv>n.wv)return!0}(e&_t)!==0&&ht===null&&Be(n,Ye)}return!1}function ea(n,e,t=!0){var s=n.reactions;if(s!==null&&!Ot?.includes(n))for(var i=0;i<s.length;i++){var r=s[i];(r.f&ze)!==0?ea(r,e,!1):e===r&&(t?Be(r,it):(r.f&Ye)!==0&&Be(r,At),cn(r))}}function ta(n){var e=qe,t=at,s=dt,i=ee,r=Ot,a=ve,o=Dt,c=rn,d=n.f;qe=null,at=0,dt=null,ee=(d&(Xt|hn))===0?n:null,Ot=null,Tn(n.ctx),Dt=!1,rn=++jn,n.ac!==null&&(xi(()=>{n.ac.abort(yn)}),n.ac=null);try{n.f|=ri;var u=n.fn,h=u(),f=n.deps;if(qe!==null){var p;if(Cs(n,at),f!==null&&at>0)for(f.length=at+qe.length,p=0;p<qe.length;p++)f[at+p]=qe[p];else n.deps=f=qe;if(Gt&&qn()&&(n.f&_t)!==0)for(p=at;p<f.length;p++)(f[p].reactions??=[]).push(n)}else f!==null&&at<f.length&&(Cs(n,at),f.length=at);if(ls()&&dt!==null&&!Dt&&f!==null&&(n.f&(ze|At|it))===0)for(p=0;p<dt.length;p++)ea(dt[p],n);return i!==null&&i!==n&&(jn++,dt!==null&&(s===null?s=dt:s.push(...dt))),(n.f&Bt)!==0&&(n.f^=Bt),h}catch(m){return Yr(m)}finally{n.f^=ri,qe=e,at=t,dt=s,ee=i,Ot=r,Tn(a),Dt=o,rn=c}}function tl(n,e){let t=e.reactions;if(t!==null){var s=uo.call(t,n);if(s!==-1){var i=t.length-1;i===0?t=e.reactions=null:(t[s]=t[i],t.pop())}}t===null&&(e.f&ze)!==0&&(qe===null||!qe.includes(e))&&(Be(e,At),(e.f&_t)!==0&&(e.f^=_t,e.f&=~ln),Gr(e),Cs(e,0))}function Cs(n,e){var t=n.deps;if(t!==null)for(var s=e;s<t.length;s++)tl(n,t[s])}function kn(n){var e=n.f;if((e&Yt)===0){Be(n,Ye);var t=se,s=Gt;se=n,Gt=!0;try{(e&(Ht|po))!==0?cl(n):la(n),oa(n);var i=ta(n);n.teardown=typeof i=="function"?i:null,n.wv=Jr;var r;ii&&Co&&(n.f&it)!==0&&n.deps}finally{Gt=s,se=t}}}function l(n){var e=n.f,t=(e&ze)!==0;if(ee!==null&&!Dt){var s=se!==null&&(se.f&Yt)!==0;if(!s&&!Ot?.includes(n)){var i=ee.deps;if((ee.f&ri)!==0)n.rv<jn&&(n.rv=jn,qe===null&&i!==null&&i[at]===n?at++:qe===null?qe=[n]:qe.includes(n)||qe.push(n));else{(ee.deps??=[]).push(n);var r=n.reactions;r===null?n.reactions=[ee]:r.includes(ee)||r.push(ee)}}}if($n){if(Kt.has(n))return Kt.get(n);if(t){var a=n,o=a.v;return((a.f&Ye)===0&&a.reactions!==null||sa(a))&&(o=Ei(a)),Kt.set(a,o),o}}else t&&(!ht?.has(n)||_e?.is_fork&&!qn())&&(a=n,Ln(a)&&Ur(a),Gt&&qn()&&(a.f&_t)===0&&na(a));if(ht?.has(n))return ht.get(n);if((n.f&Bt)!==0)throw n.v;return n.v}function na(n){if(n.deps!==null){n.f^=_t;for(const e of n.deps)(e.reactions??=[]).push(n),(e.f&ze)!==0&&(e.f&_t)===0&&na(e)}}function sa(n){if(n.v===Ke)return!0;if(n.deps===null)return!1;for(const e of n.deps)if(Kt.has(e)||(e.f&ze)!==0&&sa(e))return!0;return!1}function Pt(n){var e=Dt;try{return Dt=!0,n()}finally{Dt=e}}const nl=-7169;function Be(n,e){n.f=n.f&nl|e}function sl(n){if(!(typeof n!="object"||!n||n instanceof EventTarget)){if(zt in n)li(n);else if(!Array.isArray(n))for(let e in n){const t=n[e];typeof t=="object"&&t&&zt in t&&li(t)}}}function li(n,e=new Set){if(typeof n=="object"&&n!==null&&!(n instanceof EventTarget)&&!e.has(n)){e.add(n),n instanceof Date&&n.getTime();for(let s in n)try{li(n[s],e)}catch{}const t=_i(n);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const s=kr(t);for(let i in s){const r=s[i].get;if(r)try{r.call(n)}catch{}}}}}function ia(n){se===null&&(ee===null&&yo(),bo()),$n&&_o()}function il(n,e){var t=e.last;t===null?e.last=e.first=n:(t.next=n,n.prev=t,e.last=n)}function Mt(n,e,t){var s=se;s!==null&&(s.f&lt)!==0&&(n|=lt);var i={ctx:ve,deps:null,nodes_start:null,nodes_end:null,f:n|it|_t,first:null,fn:e,last:null,next:null,parent:s,b:s&&s.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(t)try{kn(i),i.f|=yi}catch(o){throw st(i),o}else e!==null&&cn(i);var r=i;if(t&&r.deps===null&&r.teardown===null&&r.nodes_start===null&&r.first===r.last&&(r.f&Mn)===0&&(r=r.first,(n&Ht)!==0&&(n&on)!==0&&r!==null&&(r.f|=on)),r!==null&&(r.parent=s,s!==null&&il(r,s),ee!==null&&(ee.f&ze)!==0&&(n&hn)===0)){var a=ee;(a.effects??=[]).push(r)}return i}function qn(){return ee!==null&&!Dt}function Os(n){const e=Mt(Ms,null,!1);return Be(e,Ye),e.teardown=n,e}function Re(n){ia();var e=se.f,t=!ee&&(e&Xt)!==0&&(e&yi)===0;if(t){var s=ve;(s.e??=[]).push(n)}else return ra(n)}function ra(n){return Mt(bi|$r,n,!1)}function rl(n){return ia(),Mt(Ms|$r,n,!0)}function al(n){Tt.ensure();const e=Mt(hn|Mn,n,!0);return(t={})=>new Promise(s=>{t.outro?En(e,()=>{st(e),s(void 0)}):(st(e),s(void 0))})}function ol(n){return Mt(bi,n,!1)}function Lt(n,e){var t=ve,s={effect:null,ran:!1,deps:n};t.l.$.push(s),s.effect=Rs(()=>{n(),!s.ran&&(s.ran=!0,Pt(e))})}function aa(){var n=ve;Rs(()=>{for(var e of n.l.$){e.deps();var t=e.effect;(t.f&Ye)!==0&&Be(t,At),Ln(t)&&kn(t),e.ran=!1}})}function ll(n){return Mt(wi|Mn,n,!0)}function Rs(n,e=0){return Mt(Ms|e,n,!0)}function B(n,e=[],t=[],s=[]){Vo(s,e,t,i=>{Mt(Ms,()=>n(...i.map(l)),!0)})}function Fs(n,e=0){var t=Mt(Ht|e,n,!0);return t}function ut(n){return Mt(Xt|Mn,n,!0)}function oa(n){var e=n.teardown;if(e!==null){const t=$n,s=ee;Gi(!0),nt(null);try{e.call(null)}finally{Gi(t),nt(s)}}}function la(n,e=!1){var t=n.first;for(n.first=n.last=null;t!==null;){const i=t.ac;i!==null&&xi(()=>{i.abort(yn)});var s=t.next;(t.f&hn)!==0?t.parent=null:st(t,e),t=s}}function cl(n){for(var e=n.first;e!==null;){var t=e.next;(e.f&Xt)===0&&st(e),e=t}}function st(n,e=!0){var t=!1;(e||(n.f&Mr)!==0)&&n.nodes_start!==null&&n.nodes_end!==null&&(dl(n.nodes_start,n.nodes_end),t=!0),la(n,e&&!t),Cs(n,0),Be(n,Yt);var s=n.transitions;if(s!==null)for(const r of s)r.stop();oa(n);var i=n.parent;i!==null&&i.first!==null&&ca(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes_start=n.nodes_end=n.ac=null}function dl(n,e){for(;n!==null;){var t=n===e?null:ds(n);n.remove(),n=t}}function ca(n){var e=n.parent,t=n.prev,s=n.next;t!==null&&(t.next=s),s!==null&&(s.prev=t),e!==null&&(e.first===n&&(e.first=s),e.last===n&&(e.last=t))}function En(n,e,t=!0){var s=[];Ii(n,s,!0),da(s,()=>{t&&st(n),e&&e()})}function da(n,e){var t=n.length;if(t>0){var s=()=>--t||e();for(var i of n)i.out(s)}else e()}function Ii(n,e,t){if((n.f&lt)===0){if(n.f^=lt,n.transitions!==null)for(const a of n.transitions)(a.is_global||t)&&e.push(a);for(var s=n.first;s!==null;){var i=s.next,r=(s.f&on)!==0||(s.f&Xt)!==0&&(n.f&Ht)!==0;Ii(s,e,r?t:!1),s=i}}}function Ci(n){ua(n,!0)}function ua(n,e){if((n.f&lt)!==0){n.f^=lt,(n.f&Ye)===0&&(Be(n,it),cn(n));for(var t=n.first;t!==null;){var s=t.next,i=(t.f&on)!==0||(t.f&Xt)!==0;ua(t,i?e:!1),t=s}if(n.transitions!==null)for(const r of n.transitions)(r.is_global||e)&&r.in()}}function ha(n,e){for(var t=n.nodes_start,s=n.nodes_end;t!==null;){var i=t===s?null:ds(t);e.append(t),t=i}}const ul=["touchstart","touchmove"];function hl(n){return ul.includes(n)}const fa=new Set,ci=new Set;function fl(n,e,t,s={}){function i(r){if(s.capture||Xn.call(e,r),!r.cancelBubble)return xi(()=>t?.call(this,r))}return n.startsWith("pointer")||n.startsWith("touch")||n==="wheel"?cs(()=>{e.addEventListener(n,i,s)}):e.addEventListener(n,i,s),i}function ft(n,e,t,s,i){var r={capture:s,passive:i},a=fl(n,e,t,r);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&Os(()=>{e.removeEventListener(n,a,r)})}function bt(n){for(var e=0;e<n.length;e++)fa.add(n[e]);for(var t of ci)t(n)}let Vi=null;function Xn(n){var e=this,t=e.ownerDocument,s=n.type,i=n.composedPath?.()||[],r=i[0]||n.target;Vi=n;var a=0,o=Vi===n&&n.__root;if(o){var c=i.indexOf(o);if(c!==-1&&(e===document||e===window)){n.__root=e;return}var d=i.indexOf(e);if(d===-1)return;c<=d&&(a=c)}if(r=i[a]||n.target,r!==e){Dr(n,"currentTarget",{configurable:!0,get(){return r||t}});var u=ee,h=se;nt(null),kt(null);try{for(var f,p=[];r!==null;){var m=r.assignedSlot||r.parentNode||r.host||null;try{var S=r["__"+s];S!=null&&(!r.disabled||n.target===r)&&S.call(r,n)}catch(w){f?p.push(w):f=w}if(n.cancelBubble||m===e||m===null)break;r=m}if(f){for(let w of p)queueMicrotask(()=>{throw w});throw f}}finally{n.__root=e,delete n.currentTarget,nt(u),kt(h)}}}function gl(n){var e=document.createElement("template");return e.innerHTML=n.replaceAll("<!>","<!---->"),e.content}function Ts(n,e){var t=se;t.nodes_start===null&&(t.nodes_start=n,t.nodes_end=e)}function F(n,e){var t=(e&Ao)!==0,s=(e&Mo)!==0,i,r=!n.startsWith("<!>");return()=>{i===void 0&&(i=gl(r?n:"<!>"+n),t||(i=Es(i)));var a=s||Xr?document.importNode(i,!0):i.cloneNode(!0);if(t){var o=Es(a),c=a.lastChild;Ts(o,c)}else Ts(a,a);return a}}function ae(n=""){{var e=Ft(n+"");return Ts(e,e),e}}function Fe(){var n=document.createDocumentFragment(),e=document.createComment(""),t=Ft();return n.append(e,t),Ts(e,t),n}function E(n,e){n!==null&&n.before(e)}function Ce(n,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(n.__t??=n.nodeValue)&&(n.__t=t,n.nodeValue=t+"")}function pl(n,e){return ml(n,e)}const gn=new Map;function ml(n,{target:e,anchor:t,props:s={},events:i,context:r,intro:a=!0}){Ho();var o=new Set,c=h=>{for(var f=0;f<h.length;f++){var p=h[f];if(!o.has(p)){o.add(p);var m=hl(p);e.addEventListener(p,Xn,{passive:m});var S=gn.get(p);S===void 0?(document.addEventListener(p,Xn,{passive:m}),gn.set(p,1)):gn.set(p,S+1)}}};c(vi(fa)),ci.add(c);var d=void 0,u=al(()=>{var h=t??e.appendChild(Ft());return Bo(h,{pending:()=>{}},f=>{if(r){we({});var p=ve;p.c=r}i&&(s.$$events=i),d=n(f,s)||{},r&&Se()}),()=>{for(var f of o){e.removeEventListener(f,Xn);var p=gn.get(f);--p===0?(document.removeEventListener(f,Xn),gn.delete(f)):gn.set(f,p)}ci.delete(c),h!==t&&h.parentNode?.removeChild(h)}});return vl.set(d,u),d}let vl=new WeakMap;class ga{anchor;#e=new Map;#t=new Map;#s=new Map;#n=new Set;#l=!0;constructor(e,t=!0){this.anchor=e,this.#l=t}#r=()=>{var e=_e;if(this.#e.has(e)){var t=this.#e.get(e),s=this.#t.get(t);if(s)Ci(s),this.#n.delete(t);else{var i=this.#s.get(t);i&&(this.#t.set(t,i.effect),this.#s.delete(t),i.fragment.lastChild.remove(),this.anchor.before(i.fragment),s=i.effect)}for(const[r,a]of this.#e){if(this.#e.delete(r),r===e)break;const o=this.#s.get(a);o&&(st(o.effect),this.#s.delete(a))}for(const[r,a]of this.#t){if(r===t||this.#n.has(r))continue;const o=()=>{if(Array.from(this.#e.values()).includes(r)){var d=document.createDocumentFragment();ha(a,d),d.append(Ft()),this.#s.set(r,{effect:a,fragment:d})}else st(a);this.#n.delete(r),this.#t.delete(r)};this.#l||!s?(this.#n.add(r),En(a,o,!1)):o()}}};#i=e=>{this.#e.delete(e);const t=Array.from(this.#e.values());for(const[s,i]of this.#s)t.includes(s)||(st(i.effect),this.#s.delete(s))};ensure(e,t){var s=_e,i=Zr();if(t&&!this.#t.has(e)&&!this.#s.has(e))if(i){var r=document.createDocumentFragment(),a=Ft();r.append(a),this.#s.set(e,{effect:ut(()=>t(a)),fragment:r})}else this.#t.set(e,ut(()=>t(this.anchor)));if(this.#e.set(s,e),i){for(const[o,c]of this.#t)o===e?s.skipped_effects.delete(c):s.skipped_effects.add(c);for(const[o,c]of this.#s)o===e?s.skipped_effects.delete(c.effect):s.skipped_effects.add(c.effect);s.oncommit(this.#r),s.ondiscard(this.#i)}else this.#r()}}function V(n,e,t=!1){var s=new ga(n),i=t?on:0;function r(a,o){s.ensure(a,o)}Fs(()=>{var a=!1;e((o,c=!0)=>{a=!0,r(c,o)}),a||r(!1,null)},i)}function Pn(n,e,...t){var s=new ga(n);Fs(()=>{const i=e()??null;s.ensure(i,i&&(r=>i(r,...t)))},on)}const ji=[...` 	
\r\fÂ \v\uFEFF`];function _l(n,e,t){var s=n==null?"":""+n;if(e&&(s=s?s+" "+e:e),t){for(var i in t)if(t[i])s=s?s+" "+i:i;else if(s.length)for(var r=i.length,a=0;(a=s.indexOf(i,a))>=0;){var o=a+r;(a===0||ji.includes(s[a-1]))&&(o===s.length||ji.includes(s[o]))?s=(a===0?"":s.substring(0,a))+s.substring(o+1):a=o}}return s===""?null:s}function qi(n,e=!1){var t=e?" !important;":";",s="";for(var i in n){var r=n[i];r!=null&&r!==""&&(s+=" "+i+": "+r+t)}return s}function zs(n){return n[0]!=="-"||n[1]!=="-"?n.toLowerCase():n}function bl(n,e){if(e){var t="",s,i;if(Array.isArray(e)?(s=e[0],i=e[1]):s=e,n){n=String(n).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var r=!1,a=0,o=!1,c=[];s&&c.push(...Object.keys(s).map(zs)),i&&c.push(...Object.keys(i).map(zs));var d=0,u=-1;const S=n.length;for(var h=0;h<S;h++){var f=n[h];if(o?f==="/"&&n[h-1]==="*"&&(o=!1):r?r===f&&(r=!1):f==="/"&&n[h+1]==="*"?o=!0:f==='"'||f==="'"?r=f:f==="("?a++:f===")"&&a--,!o&&r===!1&&a===0){if(f===":"&&u===-1)u=h;else if(f===";"||h===S-1){if(u!==-1){var p=zs(n.substring(d,u).trim());if(!c.includes(p)){f!==";"&&h++;var m=n.substring(d,h).trim();t+=" "+m+";"}}d=h+1,u=-1}}}}return s&&(t+=qi(s)),i&&(t+=qi(i,!0)),t=t.trim(),t===""?null:t}return n==null?null:String(n)}function De(n,e,t,s,i,r){var a=n.__className;if(a!==t||a===void 0){var o=_l(t,s,r);o==null?n.removeAttribute("class"):n.className=o,n.__className=t}else if(r&&i!==r)for(var c in r){var d=!!r[c];(i==null||d!==!!i[c])&&n.classList.toggle(c,d)}return r}function Ks(n,e={},t,s){for(var i in t){var r=t[i];e[i]!==r&&(t[i]==null?n.style.removeProperty(i):n.style.setProperty(i,r,s))}}function ue(n,e,t,s){var i=n.__style;if(i!==e){var r=bl(e,s);r==null?n.removeAttribute("style"):n.style.cssText=r,n.__style=e}else s&&(Array.isArray(s)?(Ks(n,t?.[0],s[0]),Ks(n,t?.[1],s[1],"important")):Ks(n,t,s));return s}function pa(n,e,t=!1){if(n.multiple){if(e==null)return;if(!mi(e))return Oo();for(var s of n.options)s.selected=e.includes(Ji(s));return}for(s of n.options){var i=Ji(s);if(Fo(i,e)){s.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function yl(n){var e=new MutationObserver(()=>{pa(n,n.__value)});e.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Os(()=>{e.disconnect()})}function Ji(n){return"__value"in n?n.__value:n.value}const wl=Symbol("is custom element"),Sl=Symbol("is html");function Jn(n,e){var t=ma(n);t.value===(t.value=e??void 0)||n.value===e&&(e!==0||n.nodeName!=="PROGRESS")||(n.value=e??"")}function U(n,e,t,s){var i=ma(n);i[e]!==(i[e]=t)&&(e==="loading"&&(n[mo]=t),t==null?n.removeAttribute(e):typeof t!="string"&&El(n).includes(e)?n[e]=t:n.setAttribute(e,t))}function ma(n){return n.__attributes??={[wl]:n.nodeName.includes("-"),[Sl]:n.namespaceURI===$o}}var Qi=new Map;function El(n){var e=n.getAttribute("is")||n.nodeName,t=Qi.get(e);if(t)return t;Qi.set(e,t=[]);for(var s,i=n,r=Element.prototype;r!==i;){s=kr(i);for(var a in s)s[a].set&&t.push(a);i=_i(i)}return t}function er(n,e){return n===e||n?.[zt]===e}function Ut(n={},e,t,s){return ol(()=>{var i,r;return Rs(()=>{i=r,r=s?.()||[],Pt(()=>{n!==t(...r)&&(e(n,...r),i&&er(t(...i),n)&&e(null,...i))})}),()=>{cs(()=>{r&&er(t(...r),n)&&e(null,...r)})}}),n}function xl(n=!1){const e=ve,t=e.l.u;if(!t)return;let s=()=>sl(e.s);if(n){let i=0,r={};const a=Ls(()=>{let o=!1;const c=e.s;for(const d in c)c[d]!==r[d]&&(r[d]=c[d],o=!0);return o&&i++,i});s=()=>l(a)}t.b.length&&rl(()=>{tr(e,s),Ss(t.b)}),Re(()=>{const i=Pt(()=>t.m.map(go));return()=>{for(const r of i)typeof r=="function"&&r()}}),t.a.length&&Re(()=>{tr(e,s),Ss(t.a)})}function tr(n,e){if(n.l.s)for(const t of n.l.s)l(t);e()}let di=Symbol();function L(n,e,t){const s=t[e]??={store:null,source:Ct(void 0),unsubscribe:mt};if(s.store!==n&&!(di in t))if(s.unsubscribe(),s.store=n??null,n==null)s.source.v=void 0,s.unsubscribe=mt;else{var i=!0;s.unsubscribe=Ti(n,r=>{i?s.source.v=r:$(s.source,r)}),i=!1}return n&&di in t?gt(n):l(s.source)}function He(){const n={};function e(){Os(()=>{for(var t in n)n[t].unsubscribe();Dr(n,di,{enumerable:!1,value:!0})})}return[n,e]}function he(n,e,t,s){var i=s,r=!0,a=()=>(r&&(r=!1,i=s),i),o;o=n[e],o===void 0&&s!==void 0&&(o=a());var c;return c=()=>{var d=n[e];return d===void 0?a():(r=!0,d)},c}function us(n){ve===null&&Fr(),os&&ve.l!==null?Cl(ve).m.push(n):Re(()=>{const e=Pt(n);if(typeof e=="function")return e})}function Il(n){ve===null&&Fr(),us(()=>()=>Pt(n))}function Cl(n){var e=n.l;return e.u??={a:[],b:[],m:[]}}function Ti(n,e,t){if(n==null)return e(void 0),t&&t(void 0),mt;const s=Pt(()=>n.subscribe(e,t));return s.unsubscribe?()=>s.unsubscribe():s}const pn=[];function Tl(n,e){return{subscribe:q(n,e).subscribe}}function q(n,e=mt){let t=null;const s=new Set;function i(o){if(Or(n,o)&&(n=o,t)){const c=!pn.length;for(const d of s)d[1](),pn.push(d,n);if(c){for(let d=0;d<pn.length;d+=2)pn[d][0](pn[d+1]);pn.length=0}}}function r(o){i(o(n))}function a(o,c=mt){const d=[o,c];return s.add(d),s.size===1&&(t=e(i,r)||mt),o(n),()=>{s.delete(d),s.size===0&&t&&(t(),t=null)}}return{set:i,update:r,subscribe:a}}function Xe(n,e,t){const s=!Array.isArray(n),i=s?[n]:n;if(!i.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const r=e.length<2;return Tl(t,(a,o)=>{let c=!1;const d=[];let u=0,h=mt;const f=()=>{if(u)return;h();const m=e(s?d[0]:d,a,o);r?a(m):h=typeof m=="function"?m:mt},p=i.map((m,S)=>Ti(m,w=>{d[S]=w,u&=~(1<<S),c&&f()},()=>{u|=1<<S}));return c=!0,f(),function(){Ss(p),h(),c=!1}})}function gt(n){let e;return Ti(n,t=>e=t)(),e}function Dl(){return`zone_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const ui=["#e74c3c","#e67e22","#f1c40f","#2ecc71","#1abc9c","#3498db","#9b59b6","#e91e8f"];function kl(){return ui[Math.floor(Math.random()*ui.length)]}function Pl(n,e=300){return{id:Dl(),x:n,width:e,color:kl(),texts:[{language:"cs",title:"",content:""}]}}function Al(n,e){const t=n.texts.find(s=>s.language===e);return t||n.texts[0]||null}const Qn=q("cs"),va=q("cat_orange"),_a=q("Forest"),ba=q(!1),hi=q(!1),Nn=q(!1),ya=q(!1),wa=q(!1),Ml=q("#2a1a0a"),$l=q(!0),Sa=q(null),Ll=Xe([Sa,Qn],([n,e])=>n?Al(n,e):null);function Gs(n){Sa.set(n)}const Ea=q({x:0,y:0});function Ol(n,e){Ea.set({x:n,y:e})}const xa=q({scrollX:0,scrollY:0,zoom:1});function Rl(n,e,t=1){xa.set({scrollX:n,scrollY:e,zoom:t})}const Ia=q({worldWidth:640,worldHeight:640,offsetX:0,offsetY:0});function Fl(n,e,t,s,i=1){const r=n*i,a=e*i,o=Math.max(0,(t-r)/2),c=Math.max(0,(s-a)/2);Ia.set({worldWidth:r,worldHeight:a,offsetX:o,offsetY:c})}const fi=q(!1);function Ca(){fi.set(!0),setTimeout(()=>fi.set(!1),150)}const Ue={BACKGROUND_LAYER_START:-99,GROUND_REFERENCE:-1,ITEMS_BEHIND:5,PLAYER:10,ITEMS_FRONT:15,FOREGROUND_LAYER_START:50,SELECTION_GRAPHICS:999,GRID_OVERLAY:1e3};function Di(n){return n==="behind"?Ue.ITEMS_BEHIND:Ue.ITEMS_FRONT}const Ta={DEPTH:Ue.PLAYER},Hl={HALF_HEIGHT:Cr/2},An=40;function Xl(n){return n-An}function es(n){return Xl(n)-Hl.HALF_HEIGHT}function Nl(n,e){const t=es(e);return Math.min(n,t)}function Wl(n,e){const t=es(e);return n>t}class Zl{scene;currentSkinId;constructor(e,t=Tr){this.scene=e,this.currentSkinId=t}createAll(){console.log("PlayerAnimations.createAll() is deprecated - animations created by skinLoader")}getSkinId(){return this.currentSkinId}setSkinId(e){this.currentSkinId=e}getAnimationKey(e){return`${this.currentSkinId}-${e}`}play(e,t){const s=this.getAnimationKey(t);if(e.anims.currentAnim?.key!==s){if(!this.scene.anims.exists(s)){console.warn(`[PlayerAnimations] Animation not found: ${s}`);return}e.play(s)}}handleSkinChange(e,t){const s=this.currentSkinId;this.currentSkinId=t;const i=e.anims.currentAnim?.key;if(i){const r=i.replace(`${s}-`,""),a=`${t}-${r}`;if(this.scene.anims.exists(a))e.play(a);else{const o=`${t}-idle`;this.scene.anims.exists(o)&&e.play(o)}}}}let Da=!1,vn=!1;function fs(n){Da=n}function nr(){return Da}function un(){return vn}function Us(n){if(!n||n.tagName==="CANVAS")return!1;if(n.closest("[data-ui]"))return!0;const e=document.getElementById("game-ui");return!!(e&&e.contains(n)||n.closest("button"))}function Yl(){document.addEventListener("pointerdown",n=>{vn=Us(n.target)},{capture:!0}),document.addEventListener("pointermove",n=>{n.buttons>0||(vn=Us(n.target))},{capture:!0}),document.addEventListener("pointerup",()=>{setTimeout(()=>{vn=!1},10)},{capture:!0}),document.addEventListener("touchstart",n=>{vn=Us(n.target)},{capture:!0,passive:!0}),document.addEventListener("touchend",()=>{setTimeout(()=>{vn=!1},10)},{capture:!0,passive:!0})}function xn(){const n=document.activeElement;if(!n)return!1;const e=n.tagName.toUpperCase();return e==="INPUT"||e==="TEXTAREA"||n.getAttribute("contenteditable")==="true"}function en(n,e,t){const s=(n-t.worldView.x)*t.zoom,i=(e-t.worldView.y)*t.zoom;return{screenX:s,screenY:i}}function Bl(n,e,t){const s=n/t.zoom+t.worldView.x,i=e/t.zoom+t.worldView.y;return{worldX:s,worldY:i}}const Jt={THRESHOLD_X:20,LANGUAGE_BUTTON:{width:120,height:60},SKIN_BUTTON:{width:120,height:60,yOffset:60}},zl={SPEED:350};class Kl{scene;getPlayerPosition;keyLeft;keyRight;keyA;keyD;touchLeft=!1;touchRight=!1;touchHandlers;constructor(e){this.scene=e.scene,this.getPlayerPosition=e.getPlayerPosition,this.setupKeyboardControls(),this.setupTouchControls()}setupKeyboardControls(){this.scene.input.keyboard&&(this.keyLeft=this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.LEFT,!1),this.keyRight=this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.RIGHT,!1),this.keyA=this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.A,!1),this.keyD=this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.D,!1))}setupTouchControls(){const e=this.scene,t=a=>{if(gt(fi)){this.touchLeft=!1,this.touchRight=!1;return}const o=a.x,c=a.y,d=e.scale.width;if(o>d-Jt.LANGUAGE_BUTTON.width&&c<Jt.LANGUAGE_BUTTON.height||o>d-Jt.SKIN_BUTTON.width&&c>=Jt.SKIN_BUTTON.yOffset&&c<Jt.SKIN_BUTTON.yOffset+Jt.SKIN_BUTTON.height)return;const u=e.cameras.main,f=this.getPlayerPosition().x-u.scrollX,p=o-f;p<-20?(this.touchLeft=!0,this.touchRight=!1):p>Jt.THRESHOLD_X?(this.touchRight=!0,this.touchLeft=!1):(this.touchLeft=!1,this.touchRight=!1)},s=a=>{un()||t(a)},i=a=>{un()||a.isDown&&t(a)},r=()=>{this.touchLeft=!1,this.touchRight=!1};e.input.on("pointerdown",s),e.input.on("pointermove",i),e.input.on("pointerup",r),this.touchHandlers={pointerdown:s,pointermove:i,pointerup:r}}getInputState(){const e=this.keyA?.isDown||this.keyLeft?.isDown||this.touchLeft||!1,t=this.keyD?.isDown||this.keyRight?.isDown||this.touchRight||!1;return{left:e,right:t}}hasAnyInput(){const e=this.getInputState();return e.left||e.right}destroy(){this.touchHandlers&&(this.scene.input.off("pointerdown",this.touchHandlers.pointerdown),this.scene.input.off("pointermove",this.touchHandlers.pointermove),this.scene.input.off("pointerup",this.touchHandlers.pointerup),this.touchHandlers=void 0)}}class Gl extends Y.Physics.Arcade.Sprite{animations;inputController;animState="idle";hasNotifiedMovement=!1;hasReceivedInput=!1;currentSkin;constructor(e,t,s){const i=Un.getSkinId();super(e,t,s,`${i}-idle`),e.add.existing(this),e.physics.add.existing(this),this.animations=new Zl(e,i),this.inputController=new Kl({scene:e,getPlayerPosition:()=>({x:this.x,y:this.y})}),this.setCollideWorldBounds(!0),this.setBounce(0),this.currentSkin=et.find(f=>f.id===i)??et[0];const r=si(this.currentSkin),a=this.currentSkin.frameWidth??48,o=this.currentSkin.frameHeight??48,c=Math.round(a*.33),d=Math.round(o*.25),u=Math.round((a-c)/2),h=Math.round(o*.75);this.setSize(c,d),this.setOffset(u,h),this.setScale(r),this.setDepth(Ta.DEPTH),this.animations.play(this,"idle")}changeSkin(e){this.currentSkin=et.find(d=>d.id===e)??et[0];const t=si(this.currentSkin),s=this.currentSkin.frameWidth??48,i=this.currentSkin.frameHeight??48,r=Math.round(s*.33),a=Math.round(i*.25),o=Math.round((s-r)/2),c=Math.round(i*.75);this.setSize(r,a),this.setOffset(o,c),this.setScale(t),this.animations.handleSkinChange(this,e)}update(){const e=this.inputController.getInputState();this.inputController.hasAnyInput()&&!this.hasReceivedInput&&(this.hasReceivedInput=!0),this.hasReceivedInput&&this.inputController.hasAnyInput()&&!this.hasNotifiedMovement&&(this.hasNotifiedMovement=!0,wa.set(!0));const t=this.currentSkin.facingLeft??!1;switch(e.left?(this.setVelocityX(-350),this.setFlipX(!t),this.animState="running"):e.right?(this.setVelocityX(zl.SPEED),this.setFlipX(t),this.animState="running"):(this.setVelocityX(0),this.animState="idle"),this.animState){case"idle":this.animations.play(this,"idle");break;case"running":this.animations.play(this,"run");break}}destroy(e){this.inputController.destroy(),super.destroy(e)}}const Ul=48,Vl=48;function ka(n){et.forEach(e=>{const t=e.frameWidth??Ul,s=e.frameHeight??Vl,i=vs(e);n.load.spritesheet(`${e.id}-idle`,`${i}/idle.png`,{frameWidth:t,frameHeight:s}),n.load.spritesheet(`${e.id}-run`,`${i}/run.png`,{frameWidth:t,frameHeight:s})})}function jl(n,e){const t=e.id;n.anims.exists(`${t}-idle`)&&n.anims.remove(`${t}-idle`),n.anims.exists(`${t}-run`)&&n.anims.remove(`${t}-run`);const s=n.textures.get(`${t}-idle`),i=n.textures.get(`${t}-run`),r=s.frameTotal-1,a=i.frameTotal-1,o=e.frameRates?.idle??6,c=e.frameRates?.run??12;n.anims.create({key:`${t}-idle`,frames:n.anims.generateFrameNumbers(`${t}-idle`,{start:0,end:r-1}),frameRate:o,repeat:-1}),n.anims.create({key:`${t}-run`,frames:n.anims.generateFrameNumbers(`${t}-run`,{start:0,end:a-1}),frameRate:c,repeat:-1})}function Pa(n){et.forEach(e=>{jl(n,e)})}const St=[{name:"FOREST GREEN",folder:"forest_green",scrollFactors:[.75,.8,.85,.9,1,1],foregroundLayers:1},{name:"FOREST BLUE",folder:"forest_blue",scrollFactors:[.75,.8,.85,.9,.95,1]},{name:"FOREST BIRCH",folder:"forest_birch",scrollFactors:[.75,.8,.85,.95,1],foregroundLayers:1},{name:"FOREST FANTASY",folder:"forest_fantasy",scrollFactors:[.75,.8,.85,.9,1,1,1],foregroundLayers:2},{name:"FOREST GOLD",folder:"forest_gold",scrollFactors:[.75,.8,.85,1,1,1],foregroundLayers:2},{name:"FOREST JUNGLE",folder:"forest_jungle",scrollFactors:[.75,.8,.95,1],foregroundLayers:1},{name:"FOREST SUMMER",folder:"forest_summer",scrollFactors:[.75,.8,.85,1,1],foregroundLayers:1},{name:"CAVE DARK",folder:"cave_dark",scrollFactors:[.7,.75,.8,.85,.9,1,1],foregroundLayers:2},{name:"FOREST DEAD",folder:"forest_dead",scrollFactors:[.75,.8,.85,.9,.95,1],foregroundLayers:1}];class ql{currentIndex=0;constructor(){const e=localStorage.getItem("background");if(e){const t=St.findIndex(s=>s.folder===e);t!==-1&&(this.currentIndex=t)}}getBackground(){return St[this.currentIndex].folder}getCurrentConfig(){return St[this.currentIndex]}setBackground(e){const t=St.findIndex(s=>s.folder===e);t!==-1&&(this.currentIndex=t,localStorage.setItem("background",e))}toggleBackground(){this.currentIndex=(this.currentIndex+1)%St.length;const e=St[this.currentIndex];return localStorage.setItem("background",e.folder),e}getAllBackgrounds(){return St}setBackgroundByIndex(e){e>=0&&e<St.length&&(this.currentIndex=e,localStorage.setItem("background",St[e].folder))}getCurrentIndex(){return this.currentIndex}}const ts=new ql;function Aa(n,e){return new Promise(t=>{for(let s=0;s<e.scrollFactors.length;s++){const i=s+1;n.load.image(`bg${i}-${e.folder}`,`assets/backgrounds/${e.folder}/${i}.png`)}n.load.once("complete",()=>{t(!0)}),n.load.once("loaderror",s=>{console.error(`Failed to load background asset: ${s.key}`),t(!1)}),n.load.start()})}function Ma(n,e,t,s){const i=[],r=[],a=s.foregroundLayers??0,c=s.scrollFactors.length-a;for(let d=0;d<s.scrollFactors.length;d++){const h=`bg${d+1}-${s.folder}`,f=s.scrollFactors[d];if(n.textures.exists(h)){const p=n.textures.getFrame(h),m=p.width,S=p.height,w=t/S,g=m*w,b=e*3,y=Math.ceil(b/g)*m+m,v=n.add.tileSprite(0,0,y,S,h);v.setOrigin(0,0),v.setScale(w),v.setScrollFactor(1),v.setData("scrollFactor",f),v.setData("scale",w),d>=c?(v.setDepth(Ue.FOREGROUND_LAYER_START+(d-c)),r.push(v)):(v.setDepth(Ue.BACKGROUND_LAYER_START+d),i.push(v))}}return{bgLayers:i,fgLayers:r}}function $a(n,e){if(!n)return;const t=e.width/e.zoom,s=e.getBounds().width,i=Math.max(0,s-t),r=Math.max(0,Math.min(e.scrollX,i)),a=[...n.bgLayers,...n.fgLayers];for(const o of a){const c=o.getData("scrollFactor"),d=o.getData("scale");o.tilePositionX=r*(1-c)/d}}function Jl(n){n.bgLayers.forEach(e=>e.destroy()),n.fgLayers.forEach(e=>e.destroy())}const Ql=[{code:"cs",label:"CZ"},{code:"en",label:"EN"}],La="cs",ec={isActive:!1,config:null,selectedItemId:null,itemDepthLayer:"behind",editMode:"items",selectedDialogZoneId:null,selectedFrameId:null,selectedSocialId:null,isPlayerSelected:!1},z=q(ec),Oa=Xe(z,n=>n.isActive),tc=Xe(z,n=>n.config),Ds=q(!0);function nc(){Ds.update(n=>!n)}const Vt=q(!1);function In(n){Vt.set(n)}const gi=q(!1);function Vs(n){gi.set(n)}const an=q(!1),tn=q(!1),Hs=q(!1),nn=q(!1),Xs=q(!1);function sc(){an.update(n=>!n)}function ic(){tn.update(n=>!n)}function Ra(){Hs.set(!0)}function rc(){Hs.set(!1)}function ac(){nn.update(n=>!n)}function Fa(){Xs.set(!0)}function oc(){Xs.set(!1)}const ki=q(La);function lc(n){ki.set(n)}const Ns=Xe(z,n=>n.selectedItemId),Ha=Xe(z,n=>n.itemDepthLayer),Ve=Xe(z,n=>n.editMode),Ws=Xe(z,n=>n.selectedDialogZoneId),Pi=Xe(z,n=>n.config?.dialogZones||[]),ns=Xe(z,n=>n.selectedFrameId),js=Xe(z,n=>n.isPlayerSelected),Xa=Xe(z,n=>n.config?.placedFrames||[]),ss=Xe(z,n=>n.selectedSocialId),cc=Xe(z,n=>n.config?.placedSocials||[]),dc=Xe(z,n=>!n.selectedSocialId||!n.config?.placedSocials?null:n.config.placedSocials.find(e=>e.id===n.selectedSocialId)??null),Na=q(null);function qs(n){Na.set(n)}const Ai=q(new Map);function uc(n,e,t){Ai.update(s=>{const i=new Map(s);return i.set(n,{x:e,y:t}),i})}function hc(n){Ai.update(e=>{const t=new Map(e);return t.delete(n),t})}const Wa=q(null);function Js(n){Wa.set(n)}const fc=Xe(z,n=>!n.selectedFrameId||!n.config?.placedFrames?null:n.config.placedFrames.find(e=>e.id===n.selectedFrameId)??null),Za=q(null);function Qs(n){Za.set(n)}const Ya=q(null);function gs(n){Ya.set(n)}const Mi=q(!1);function Ba(){Mi.set(!0)}function sr(){Mi.set(!1)}const $i=Xe(z,n=>!n.selectedItemId||!n.config?.placedItems?null:n.config.placedItems.find(e=>e.id===n.selectedItemId)??null),gc=Xe($i,n=>n?.physicsEnabled??!1),pc=Xe($i,n=>n?.flipX??!1);function ir(n,e){z.update(t=>t.config?{...t,config:{...t.config,playerStartX:n,playerStartY:e}}:t)}function mc(n){z.update(e=>{if(!e.config)return e;const t=e.config.placedItems||[];return{...e,config:{...e.config,placedItems:[...t,n]}}})}function is(n,e){z.update(t=>!t.config||!t.config.placedItems?t:{...t,config:{...t.config,placedItems:t.config.placedItems.map(s=>s.id===n?{...s,...e}:s)}})}function za(n){z.update(e=>!e.config||!e.config.placedItems?e:{...e,config:{...e.config,placedItems:e.config.placedItems.filter(t=>t.id!==n)},selectedItemId:e.selectedItemId===n?null:e.selectedItemId})}function Ka(n){z.update(e=>({...e,selectedItemId:n,isPlayerSelected:n?!1:e.isPlayerSelected}))}function vc(n){z.update(e=>({...e,isPlayerSelected:n,selectedItemId:null}))}function Li(){z.update(n=>({...n,selectedItemId:null,selectedFrameId:null,selectedDialogZoneId:null,selectedSocialId:null,isPlayerSelected:!1}))}function _c(){z.update(n=>({...n,itemDepthLayer:n.itemDepthLayer==="behind"?"front":"behind"}))}function bc(n,e){is(n,{depth:e})}function yc(n,e){e?(is(n,{physicsEnabled:e,depth:Di("behind")}),z.update(t=>({...t,itemDepthLayer:"behind"}))):is(n,{physicsEnabled:e})}function wc(n,e){is(n,{flipX:e})}function Sc(n){z.set({isActive:!0,config:{...n,placedItems:n.placedItems||[],dialogZones:n.dialogZones||[],placedFrames:n.placedFrames||[],placedSocials:n.placedSocials||[]},selectedItemId:null,itemDepthLayer:"behind",editMode:"items",selectedDialogZoneId:null,selectedFrameId:null,selectedSocialId:null,isPlayerSelected:!1}),Oi.set(1)}function Ec(){z.update(n=>{const e=n.config?{...n.config,dialogZones:(n.config.dialogZones||[]).filter(t=>t.texts.some(s=>s.title.trim()!==""||s.content.trim()!==""))}:n.config;return{...n,isActive:!1,selectedItemId:null,config:e}}),Oi.set(1)}function xc(){return gt(z).config}const Oi=q(1);function ps(n){Oi.set(n)}const Ri=q({scrollX:0,scrollY:0,viewWidth:0,viewHeight:0,worldWidth:0,worldHeight:0,zoom:1,playerX:0,playerY:0});function Ic(n){Ri.update(e=>({...e,...n}))}function Hn(n){z.update(e=>({...e,editMode:n,selectedItemId:null,selectedDialogZoneId:null}))}function Cc(n){z.update(e=>{if(!e.config)return e;const t=e.config.dialogZones||[];return{...e,config:{...e.config,dialogZones:[...t,n]}}})}function _n(n,e){z.update(t=>!t.config||!t.config.dialogZones?t:{...t,config:{...t.config,dialogZones:t.config.dialogZones.map(s=>s.id===n?{...s,...e}:s)}})}function Ga(n){z.update(e=>!e.config||!e.config.dialogZones?e:{...e,config:{...e.config,dialogZones:e.config.dialogZones.filter(t=>t.id!==n)},selectedDialogZoneId:e.selectedDialogZoneId===n?null:e.selectedDialogZoneId})}function Bn(n){z.update(e=>({...e,selectedDialogZoneId:n}))}function rr(n,e,t){z.update(s=>!s.config||!s.config.dialogZones?s:{...s,config:{...s.config,dialogZones:s.config.dialogZones.map(i=>{if(i.id!==n)return i;const r=i.texts.findIndex(o=>o.language===e);let a;return r>=0?a=i.texts.map((o,c)=>c===r?{...o,...t}:o):a=[...i.texts,{language:e,title:"",content:"",...t}],{...i,texts:a}})}})}function Tc(n){z.update(e=>{if(!e.config)return e;const t=e.config.placedFrames||[];return{...e,config:{...e.config,placedFrames:[...t,n]}}})}function Et(n,e){z.update(t=>!t.config||!t.config.placedFrames?t:{...t,config:{...t.config,placedFrames:t.config.placedFrames.map(s=>s.id===n?{...s,...e}:s)}})}function Fi(n){z.update(e=>!e.config||!e.config.placedFrames?e:{...e,config:{...e.config,placedFrames:e.config.placedFrames.filter(t=>t.id!==n)},selectedFrameId:e.selectedFrameId===n?null:e.selectedFrameId})}function zn(n){Hs.set(!1),z.update(e=>({...e,selectedFrameId:n,isPlayerSelected:n?!1:e.isPlayerSelected,selectedItemId:n?null:e.selectedItemId}))}function Dc(n){z.update(e=>{if(!e.config)return e;const t=e.config.placedSocials||[];return{...e,config:{...e.config,placedSocials:[...t,n]}}})}function _s(n,e){z.update(t=>!t.config||!t.config.placedSocials?t:{...t,config:{...t.config,placedSocials:t.config.placedSocials.map(s=>s.id===n?{...s,...e}:s)}})}function Hi(n){z.update(e=>!e.config||!e.config.placedSocials?e:{...e,config:{...e.config,placedSocials:e.config.placedSocials.filter(t=>t.id!==n)},selectedSocialId:e.selectedSocialId===n?null:e.selectedSocialId})}function Kn(n){Xs.set(!1),z.update(e=>({...e,selectedSocialId:n,isPlayerSelected:n?!1:e.isPlayerSelected,selectedItemId:n?null:e.selectedItemId,selectedFrameId:n?null:e.selectedFrameId}))}const Xi=[{key:"tent",name:"Tent",path:"assets/ui/tent.png",scale:6,category:"structures"},{key:"lamp",name:"Lamp",path:"assets/ui/lamp.png",scale:8,category:"props"},{key:"sign_left",name:"Sign â",path:"assets/ui/sign_left.png",scale:7,category:"signs"},{key:"sign_right",name:"Sign â",path:"assets/ui/sign_right.png",scale:7,category:"signs"},{key:"stone_0",name:"Stone 0",path:"assets/ui/stone_0.png",scale:4,category:"nature",supportsPhysics:!0},{key:"stone_1",name:"Stone 1",path:"assets/ui/stone_1.png",scale:5,category:"nature",supportsPhysics:!0},{key:"stone_2",name:"Stone 2",path:"assets/ui/stone_2.png",scale:4,category:"nature",supportsPhysics:!0}];function Ua(n){return Xi.find(e=>e.key===n)}function kc(n){return Ua(n)?.scale||1}function Pc(n){return Ua(n)?.supportsPhysics??!1}class ar{scene;groundY;constructor(e,t){this.scene=e,this.groundY=t}static preloadAssets(e){Xi.forEach(t=>{e.load.image(t.key,t.path)})}createSprite(e){const{id:t,assetKey:s,x:i,scale:r=1,depth:a=5,yOffset:o=0,flipX:c=!1}=e,d=this.groundY+o,u=this.scene.add.sprite(i,d,s);return u.setScale(r),u.setDepth(a),u.setFlipX(c),u.setData("itemId",t),u}updatePosition(e,t,s){e.x=t,e.y=this.groundY+s}updateScale(e,t){e.setScale(t)}updateDepth(e,t){e.setDepth(t)}applyUpdates(e,t){t.x!==void 0&&(e.x=t.x),t.yOffset!==void 0&&(e.y=this.groundY+t.yOffset),t.scale!==void 0&&e.setScale(t.scale),t.depth!==void 0&&e.setDepth(t.depth),t.flipX!==void 0&&e.setFlipX(t.flipX)}worldYToOffset(e){return e-this.groundY}getGroundY(){return this.groundY}}function bn(n){return parseInt(n.replace("#",""),16)}const Qt={BLUE:"#4a90e2",GREEN:"#27ae60",PURPLE:"#9b59b6",TEAL:"#1abc9c",PINK:"#e91e8f"},On={ITEM:{hex:bn(Qt.BLUE)},FRAME:{hex:bn(Qt.PURPLE)},SOCIAL:{css:Qt.PINK,hex:bn(Qt.PINK)},DIALOG_ZONE:{hex:bn(Qt.TEAL)},PLAYER:{hex:bn(Qt.GREEN)}},Va=bn(Qt.BLUE),Sn=50,Ac=4871528,Mc=.4,$c=1,ja=Ue.GRID_OVERLAY,ei=16711680,Lc=2,Oc=.6,Rc=.1,Fc=1,Hc=.2,or=50,Xc=50,Ni=Va;class qa{lastClickTime=0;lastClickId=null;threshold;constructor(e=300){this.threshold=e}check(e){const t=Date.now(),s=this.lastClickId===e&&t-this.lastClickTime<this.threshold;return this.lastClickTime=t,this.lastClickId=e,s}reset(){this.lastClickTime=0,this.lastClickId=null}}function ms(n,e){return Math.round(n/e)*e}function Zs(n){const{sprite:e,scene:t,callbacks:s={},constraints:i,useGridSnapping:r=!0,cursor:a="grab",hitArea:o}=n;let c=!1,d=0,u=0,h=0;o?e.setInteractive({hitArea:o,hitAreaCallback:Y.Geom.Rectangle.Contains,useHandCursor:!0,cursor:a}):e.setInteractive({useHandCursor:!0,cursor:a});const f=(y,v)=>{const _=e.getBounds(),x=5;return y>=_.x-x&&y<=_.x+_.width+x&&v>=_.y-x&&v<=_.y+_.height+x},p=()=>{const y=t.data.get("lastTapTime");if(!y||y===h||Date.now()-y>100)return;h=y;const v=t.data.get("lastTapWorldX"),_=t.data.get("lastTapWorldY");f(v,_)&&s.onSelect?.()},m=y=>{if(y.wasTouch||gt(gi)||un()||c||s.onDoubleClick?.())return;const v=s.isSelected?.()??!1;s.onSelect?.(),v&&(c=!0,t.data.set("isDraggingItem",!0),In(!0),d=e.x-y.worldX,u=e.y-y.worldY,s.onDragStart?.())},S=y=>{if(y.wasTouch){const x=t.data.get("touchDragStarted");if(!c&&x&&s.isSelected?.()){const T=t.data.get("touchStartWorldX"),A=t.data.get("touchStartWorldY"),I=e.getBounds(),D=10;T>=I.x-D&&T<=I.x+I.width+D&&A>=I.y-D&&A<=I.y+I.height+D&&(c=!0,t.data.set("isDraggingItem",!0),t.data.set("touchDragStarted",!1),In(!0),d=e.x-T,u=e.y-A,s.onDragStart?.())}if(c){let C=y.worldX+d,T=y.worldY+u;r&&gt(Ds)&&(C=ms(C,Sn),T=ms(T,Sn)),i&&(i.minX!==void 0&&(C=Math.max(C,i.minX)),i.maxX!==void 0&&(C=Math.min(C,i.maxX)),i.minY!==void 0&&(T=Math.max(T,i.minY)),i.maxY!==void 0&&(T=Math.min(T,i.maxY))),e.setPosition(C,T),s.onDrag?.(C,T)}return}if(!c)return;if(gt(gi)){g();return}if(!y.isDown){g();return}let v=y.worldX+d,_=y.worldY+u;r&&gt(Ds)&&(v=ms(v,Sn),_=ms(_,Sn)),i&&(i.minX!==void 0&&(v=Math.max(v,i.minX)),i.maxX!==void 0&&(v=Math.min(v,i.maxX)),i.minY!==void 0&&(_=Math.max(_,i.minY)),i.maxY!==void 0&&(_=Math.min(_,i.maxY))),e.setPosition(v,_),s.onDrag?.(v,_)},w=()=>{c&&g()},g=()=>{c=!1,t.data.set("isDraggingItem",!1),In(!1),s.onDragEnd?.(e.x,e.y)};e.on("pointerdown",m),t.input.on("pointermove",S),t.input.on("pointerup",w);const b=()=>{p()};return t.events.on("update",b),()=>{e.off("pointerdown",m),t.input.off("pointermove",S),t.input.off("pointerup",w),t.events.off("update",b)}}class Nc{scene;groundY;worldWidth;worldHeight;isDragging=!1;callbacks;cleanupFunctions=new Map;constructor(e,t,s,i,r={}){this.scene=e,this.groundY=t,this.worldWidth=s,this.worldHeight=i,this.callbacks=r}getIsDragging(){return this.isDragging}makeInteractive(e,t){const s=Zs({sprite:e,scene:this.scene,cursor:"pointer",constraints:{minX:0,maxX:this.worldWidth,minY:0,maxY:this.worldHeight},callbacks:{onSelect:()=>{Ka(t),this.callbacks.onSelect?.(t)},isSelected:()=>gt(Ns)===t,onDragStart:()=>{this.isDragging=!0,e.setTint(Va),this.callbacks.onDragStart?.(t)},onDrag:(i,r)=>{this.callbacks.onDrag?.(t,i,r)},onDragEnd:(i,r)=>{e.clearTint(),this.isDragging=!1;const a=Math.round(i),c=Math.round(r)-this.groundY;is(t,{x:a,yOffset:c}),this.callbacks.onDragEnd?.(t,a,c)}}});this.cleanupFunctions.set(t,s)}removeInteractivity(e){if(!e||!e.scene)return;const t=e.getData("itemId");t&&this.cleanupFunctions.has(t)&&(this.cleanupFunctions.get(t)(),this.cleanupFunctions.delete(t)),e.removeInteractive()}destroy(){this.cleanupFunctions.forEach(e=>e()),this.cleanupFunctions.clear()}}const sn={ITEM:"itemId",FRAME:"frameId",SOCIAL:"socialId",PLAYER:"isPlayer",ZONE:"zoneId"},Wc={[sn.ITEM]:"selectedItemId",[sn.FRAME]:"selectedFrameId",[sn.SOCIAL]:"selectedSocialId",[sn.PLAYER]:"isPlayerSelected"};function Zc(n,e){if(!(n instanceof Y.GameObjects.Sprite))return!1;for(const[t,s]of Object.entries(Wc)){const i=n.getData(t);if(i)if(t===sn.PLAYER){const r=e.data.get(s),a=e.data.get("playerSprite");if(r&&n===a)return!0}else{const r=e.data.get(s);if(i===r)return!0}}return!1}function Yc(n,e){const t=n.input.hitTestPointer(e);for(const s of t)if(Zc(s,n))return!0;return!1}const Bc={lineWidth:3,lineColor:On.ITEM.hex,lineAlpha:1,padding:5};class zc{scene;graphics;style;selectedId=null;constructor(e,t={}){this.scene=e,this.style={...Bc,...t},this.graphics=e.add.graphics(),this.graphics.setDepth(Ue.SELECTION_GRAPHICS)}setSelectedId(e){this.selectedId=e}getSelectedId(){return this.selectedId}updateVisuals(e){if(this.graphics.clear(),!e||!this.selectedId)return;const t=e.getBounds(),{lineWidth:s,lineColor:i,lineAlpha:r,padding:a}=this.style;this.graphics.lineStyle(s,i,r),this.graphics.strokeRect(t.x-a,t.y-a,t.width+a*2,t.height+a*2)}clearVisuals(){this.graphics.clear(),this.selectedId=null}setupBackgroundDeselect(e){this.scene.input.on("pointerdown",t=>{if(un()||e())return;this.scene.input.hitTestPointer(t).find(r=>r.type==="Sprite"?Object.values(sn).some(a=>r.getData(a)):r.type==="Rectangle"?r.getData(sn.ZONE):!1)||(Li(),this.clearVisuals())})}destroy(){this.graphics?.destroy()}}class ks{scene;items=new Map;isBuilderMode=!1;physicsGroup=null;renderer;dragController;selectionManager;constructor(e,t,s,i,r=!1){this.scene=e,this.isBuilderMode=r,this.renderer=new ar(e,t),r||(this.physicsGroup=e.physics.add.staticGroup()),this.isBuilderMode&&(this.dragController=new Nc(e,t,s,i,{onSelect:()=>this.updateSelectionVisuals(),onDrag:()=>this.updateSelectionVisuals()}),this.selectionManager=new zc(e))}static preloadAssets(e){ar.preloadAssets(e)}createItems(e){e.forEach(t=>{this.createItem(t)})}createItem(e){const t=this.renderer.createSprite(e),s={sprite:t,data:e};if(!this.isBuilderMode&&e.physicsEnabled&&this.physicsGroup){const i=this.createPhysicsBody(t,e);s.physicsBody=i}this.items.set(e.id,s),this.isBuilderMode&&this.dragController&&this.dragController.makeInteractive(t,e.id)}createPhysicsBody(e,t){const s=e.getBounds(),i=s.width*.5,r=s.height*.8,a=e.x,o=e.y,c=this.scene.add.rectangle(a,o,i,r);return c.setVisible(!1),this.physicsGroup.add(c),c.setData("itemId",t.id),c}updateSelectionVisuals(){if(!this.selectionManager)return;const e=this.scene.data.get("selectedItemId");if(this.selectionManager.setSelectedId(e),!e){this.selectionManager.clearVisuals(),Js(null);return}const t=this.items.get(e);if(this.selectionManager.updateVisuals(t?.sprite??null),t?.sprite){const s=this.scene.cameras.main,i=t.sprite.getBounds(),{screenX:r,screenY:a}=en(i.centerX,i.centerY,s),o=i.height*s.zoom;Js({screenX:r,screenY:a,itemHeight:o})}else Js(null)}updateItem(e,t){const s=this.items.get(e);s&&(this.renderer.applyUpdates(s.sprite,t),s.data={...s.data,...t})}removeItem(e){const t=this.items.get(e);t&&(this.dragController&&this.dragController.removeInteractivity(t.sprite),t.physicsBody&&t.physicsBody.destroy(),t.sprite.destroy(),this.items.delete(e))}removeAllItems(){this.items.forEach(e=>{!e.sprite||!e.sprite.scene||(this.dragController&&this.dragController.removeInteractivity(e.sprite),e.physicsBody&&e.physicsBody.destroy(),e.sprite.destroy())}),this.items.clear()}getItem(e){return this.items.get(e)?.data}getAllItems(){return Array.from(this.items.values()).map(e=>e.data)}getPhysicsGroup(){return this.physicsGroup}setInteractiveEnabled(e){!this.isBuilderMode||!this.dragController||(this.items.forEach(({sprite:t,data:s})=>{e?(this.dragController.makeInteractive(t,s.id),t.setAlpha(1)):(t.disableInteractive(),t.setAlpha(.6))}),!e&&this.selectionManager&&this.selectionManager.clearVisuals())}destroy(){this.removeAllItems(),this.selectionManager?.destroy()}setupBackgroundDeselect(){!this.isBuilderMode||!this.selectionManager||this.selectionManager.setupBackgroundDeselect(()=>this.dragController?.getIsDragging()??!1)}}function Kc(){return`frame_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const Gc=["#ffffff","#f8f8f8","#fffacd","#ffefd5","#ffe4e1","#e6e6fa","#f0fff0","#f5fffa","#fff0f5","#f0f8ff","#2d2d2d","#1a1a2e","#16213e","#1a1a1a","#2d132c","#1e3a3a","#3d1a1a","#1a2f1a","#3d3d1a","#2a1a3d"],Uc=["#333333","#000000","#ffffff","#1a1a1a","#666666","#8b4513","#2c3e50","#c0392b","#27ae60","#2980b9","#8e44ad","#f39c12"],Vc=[12,14,16,18,20,24,28,32],jc=[{value:"top",label:"Top",icon:"â"},{value:"center",label:"Center",icon:"â¬"},{value:"bottom",label:"Bottom",icon:"â"}],Ja={S:{label:"Small",scale:3},M:{label:"Medium",scale:4},L:{label:"Large",scale:5}};function qc(n){return Ja[n].scale}function Jc(n){return n<=3?"S":n>=5?"L":"M"}const Rt=4,Wn="#ffffff",Qa="#333333",bs=16,eo="center",Qc=64,ed=96,td=.06,lr=32,Ps=[{key:"base_1",name:"Frame 1",path:"assets/frames/base 1.png",scale:4},{key:"base_2",name:"Frame 2",path:"assets/frames/base 2.png",scale:4},{key:"base_3",name:"Frame 3",path:"assets/frames/base 3.png",scale:4},{key:"base_4",name:"Frame 4",path:"assets/frames/base 4.png",scale:4},{key:"base_5",name:"Frame 5",path:"assets/frames/base 5.png",scale:4},{key:"base_6",name:"Frame 6",path:"assets/frames/base 6.png",scale:4},{key:"base_7",name:"Frame 7",path:"assets/frames/base 7.png",scale:4},{key:"base_8",name:"Frame 8",path:"assets/frames/base 8.png",scale:4},{key:"base_9",name:"Frame 9",path:"assets/frames/base 9.png",scale:4},{key:"base_10",name:"Frame 10",path:"assets/frames/base 10.png",scale:4},{key:"base_11",name:"Frame 11",path:"assets/frames/base 11.png",scale:4},{key:"base_12",name:"Frame 12",path:"assets/frames/base 12.png",scale:4},{key:"base_13",name:"Frame 13",path:"assets/frames/base 13.png",scale:4},{key:"base_14",name:"Frame 14",path:"assets/frames/base 14.png",scale:4},{key:"base_15",name:"Frame 15",path:"assets/frames/base 15.png",scale:4},{key:"base_16",name:"Frame 16",path:"assets/frames/base 16.png",scale:4},{key:"base_17",name:"Frame 17",path:"assets/frames/base 17.png",scale:4},{key:"base_18",name:"Frame 18",path:"assets/frames/base 18.png",scale:4},{key:"base_19",name:"Frame 19",path:"assets/frames/base 19.png",scale:4},{key:"base_20",name:"Frame 20",path:"assets/frames/base 20.png",scale:4},{key:"base_21",name:"Frame 21",path:"assets/frames/base 21.png",scale:4},{key:"base_22",name:"Frame 22",path:"assets/frames/base 22.png",scale:4},{key:"base_23",name:"Frame 23",path:"assets/frames/base 23.png",scale:4},{key:"base_24",name:"Frame 24",path:"assets/frames/base 24.png",scale:4},{key:"base_25",name:"Frame 25",path:"assets/frames/base 25.png",scale:4}];function nd(n){return Ps.find(e=>e.key===n)}function sd(n){return nd(n)?.scale??Rt}function Gn(n=Rt,e=!1){const t=Qc*n,s=ed*n,i=e?s:t,r=e?t:s,a=Math.min(t,s)*td,o=i-a*2,c=r-a*2,d=o-lr*2,u=c-lr*2;return{frameWidth:i,frameHeight:r,innerWidth:o,innerHeight:c,textWidth:d,textHeight:u}}function ys(n,e,t,s,i,r,a=4){n.clear();const o=parseInt(r.replace("#",""),16);n.fillStyle(o,1),n.fillRoundedRect(e-s/2,t-i/2,s,i,a)}class cr{scene;frames=new Map;constructor(e){this.scene=e}static preloadAssets(e){for(let t=1;t<=25;t++)e.load.image(`frame_base_${t}`,`assets/frames/base ${t}.png`)}createFrames(e){e.forEach(t=>{this.createFrame(t)})}createFrame(e){const t=`frame_${e.frameKey}`;if(!this.scene.textures.exists(t)){console.warn(`[GameFrameManager] Frame texture not found: ${t}`);return}const s=e.scale??Rt,i=e.depth??Ue.ITEMS_FRONT,r=(e.rotation??0)*(Math.PI/180),a=e.rotation===90,{innerWidth:o,innerHeight:c}=Gn(s,a),d=this.scene.add.graphics();d.setDepth(i-.1),ys(d,e.x,e.y,o,c,e.backgroundColor||Wn);const u=this.scene.add.sprite(e.x,e.y,t);u.setScale(s),u.setDepth(i),u.setOrigin(.5,.5),u.setRotation(r);const h={sprite:u,background:d,data:e};this.frames.set(e.id,h),e.url&&this.makeClickable(h)}makeClickable(e){const{sprite:t,data:s}=e;t.setInteractive({useHandCursor:!0}),t.on("pointerover",()=>{t.setScale((s.scale??Rt)*1.05)}),t.on("pointerout",()=>{t.setScale(s.scale??Rt)}),t.on("pointerdown",()=>{s.url&&(Ca(),window.open(s.url,"_blank","noopener,noreferrer"))})}destroy(){this.frames.forEach(({sprite:e,background:t})=>{e.destroy(),t.destroy()}),this.frames.clear()}}function id(){return`social_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const rs={S:{label:"Small",scale:1.5},M:{label:"Medium",scale:2},L:{label:"Large",scale:2.5}},Cn=rs.M.scale;function rd(n){return rs[n].scale}function ad(n){return n<=rs.S.scale?"S":n>=rs.L.scale?"L":"M"}const As=[{key:"discord",name:"Discord",path:"assets/socials/Discord.png",scale:1},{key:"facebook",name:"Facebook",path:"assets/socials/Facebook.png",scale:1},{key:"instagram",name:"Instagram",path:"assets/socials/Instagram.png",scale:1},{key:"kofi",name:"Ko-Fi",path:"assets/socials/Ko Fi.png",scale:1},{key:"linkedin",name:"LinkedIn",path:"assets/socials/LinkedIn.png",scale:1},{key:"patreon",name:"Patreon",path:"assets/socials/Patreon.png",scale:1},{key:"tiktok",name:"TikTok",path:"assets/socials/TikTok.png",scale:1},{key:"twitch",name:"Twitch",path:"assets/socials/Twitch.png",scale:1},{key:"twitter",name:"Twitter",path:"assets/socials/Twitter.png",scale:1},{key:"whatsapp",name:"WhatsApp",path:"assets/socials/Whatsapp.png",scale:1},{key:"youtube",name:"YouTube",path:"assets/socials/Youtube.png",scale:1}];class dr{scene;socials=new Map;constructor(e){this.scene=e}static preloadAssets(e){As.forEach(t=>{e.load.image(`social_${t.key}`,t.path)})}createSocials(e){e.forEach(t=>{this.createSocial(t)})}createSocial(e){const t=`social_${e.socialKey}`;if(!this.scene.textures.exists(t)){console.warn(`[GameSocialManager] Social texture not found: ${t}`);return}const s=e.scale??Cn,i=e.depth??Ue.ITEMS_FRONT,r=this.scene.add.sprite(e.x,e.y,t);r.setScale(s),r.setDepth(i),r.setOrigin(.5,.5),this.socials.set(e.id,r),e.url&&this.makeClickable(r,e)}makeClickable(e,t){const s=t.scale??Cn;e.setInteractive({useHandCursor:!0}),e.on("pointerover",()=>{e.setScale(s*1.1)}),e.on("pointerout",()=>{e.setScale(s)}),e.on("pointerdown",()=>{t.url&&(Ca(),window.open(t.url,"_blank","noopener,noreferrer"))})}destroy(){this.socials.forEach(e=>{e.destroy()}),this.socials.clear()}}async function ur(){const n=await fetch("./config/map.json");if(!n.ok)throw new Error(`Failed to load map config: ${n.status}`);const e=await n.json();if(!e.worldWidth||!e.worldHeight)throw new Error("Invalid map config structure");return e}const ws={generateId(){return`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`},create(n){const{assetKey:e,x:t,yOffset:s=0,depthLayer:i="behind",scale:r}=n;return{id:ws.generateId(),assetKey:e,x:Math.round(t),y:0,scale:r??kc(e),depth:Di(i),yOffset:Math.round(s)}},createAtWorldPosition(n,e,t,s,i="behind"){return ws.create({assetKey:n,x:e,yOffset:t-s,depthLayer:i})},clone(n,e=50){return{...n,id:ws.generateId(),x:n.x+e}}},mn={HEIGHT:An,VISUAL:{COLOR:9139029,ALPHA:.3},PHYSICS:{COLOR:0,ALPHA:0}},as={getGroundY(n,e=An){return n-e},createVisualGround(n,e){const t=e.height??mn.HEIGHT,s=as.getGroundY(e.worldHeight,t),i=n.add.rectangle(0,s,e.worldWidth,t,e.color??mn.VISUAL.COLOR,e.alpha??mn.VISUAL.ALPHA);return i.setOrigin(0,0),i.setDepth(e.depth??Ue.GROUND_REFERENCE),{ground:i,groundY:s}},createPhysicsGround(n,e){const t=e.height??mn.HEIGHT,s=as.getGroundY(e.worldHeight,t),i=n.add.rectangle(0,s,e.worldWidth,t,e.color??mn.PHYSICS.COLOR,e.alpha??mn.PHYSICS.ALPHA);return i.setOrigin(0,0),n.physics.add.existing(i,!0),{ground:i,groundY:s}},addPlayerCollision(n,e,t){return n.physics.add.collider(e,t)}},vt={GAME:"GameScene",BUILDER:"BuilderScene"};class od extends Y.Scene{player;mapConfig;parallaxLayers=null;loadedBackgrounds=new Set;itemManager;frameManager;socialManager;dialogZones=[];currentDialogZone=null;unsubscribers=[];initData;isInitialized=!1;constructor(){super({key:vt.GAME})}init(e){this.initData=e,this.isInitialized=!1}preload(){ka(this),ks.preloadAssets(this),cr.preloadAssets(this),dr.preloadAssets(this)}create(){this.events.on("shutdown",this.shutdown,this),this.initializeScene()}async initializeScene(){hi.set(!0);try{Pa(this),await this.loadMapConfiguration();const e=ts.getCurrentConfig();await this.loadBackgroundIfNeeded(e),this.createParallaxBackground();const{ground:t,groundY:s}=as.createPhysicsGround(this,{worldWidth:this.mapConfig.worldWidth,worldHeight:this.mapConfig.worldHeight}),i=Nl(this.mapConfig.playerStartY,this.mapConfig.worldHeight);this.player=new Gl(this,this.mapConfig.playerStartX,i),as.addPlayerCollision(this,this.player,t),this.itemManager=new ks(this,s,this.mapConfig.worldWidth,this.mapConfig.worldHeight,!1),this.mapConfig.placedItems&&this.mapConfig.placedItems.length>0&&this.itemManager.createItems(this.mapConfig.placedItems);const r=this.itemManager.getPhysicsGroup();r&&this.physics.add.collider(this.player,r),this.frameManager=new cr(this),this.mapConfig.placedFrames&&this.mapConfig.placedFrames.length>0&&this.frameManager.createFrames(this.mapConfig.placedFrames),this.socialManager=new dr(this),this.mapConfig.placedSocials&&this.mapConfig.placedSocials.length>0&&this.socialManager.createSocials(this.mapConfig.placedSocials),this.dialogZones=this.mapConfig.dialogZones||[];const a=Pi.subscribe(o=>{this.dialogZones=o,this.recheckCurrentZone()});this.unsubscribers.push(a),this.cameras.main.startFollow(this.player,!0,.1,.1),this.setupCameraBounds(),this.physics.world.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.scale.on("resize",this.handleResize,this),this.isInitialized=!0}catch(e){console.error("[GameScene] Failed to initialize scene:",e)}finally{hi.set(!1)}}async loadMapConfiguration(){try{if(this.initData?.useBuilderConfig){const e=xc();this.mapConfig=e||await ur()}else this.mapConfig=await ur()}catch(e){console.error("[GameScene] Failed to load map configuration:",e);const t=600;this.mapConfig={worldWidth:3200,worldHeight:t,playerStartX:400,playerStartY:es(t),placedItems:[]}}}createParallaxBackground(){const e=ts.getCurrentConfig();this.parallaxLayers=Ma(this,this.mapConfig.worldWidth,this.mapConfig.worldHeight,e)}async loadBackgroundIfNeeded(e){if(this.loadedBackgrounds.has(e.folder))return!0;const t=await Aa(this,e);return t&&this.loadedBackgrounds.add(e.folder),t}setupCameraBounds(){const e=this.cameras.main,t=e.height,s=e.width,i=t/this.mapConfig.worldHeight,r=Math.min(1,i);e.setZoom(r);const a=t/r,o=s/r;let c=0,d=this.mapConfig.worldHeight;a>this.mapConfig.worldHeight&&(c=(this.mapConfig.worldHeight-a)/2,d=a);let u=0,h=this.mapConfig.worldWidth;o>this.mapConfig.worldWidth&&(u=(this.mapConfig.worldWidth-o)/2,h=o),e.setBounds(u,c,h,d),Fl(this.mapConfig.worldWidth,this.mapConfig.worldHeight,s,t,r)}handleResize(e){!this.cameras?.main||!this.mapConfig||this.setupCameraBounds()}shutdown(){this.isInitialized=!1,this.scale.off("resize",this.handleResize,this),Gs(null),this.currentDialogZone=null,this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.itemManager&&this.itemManager.destroy(),this.frameManager&&this.frameManager.destroy(),this.socialManager&&this.socialManager.destroy()}update(){if(!this.isInitialized||!this.player)return;this.player.update();const e=this.cameras.main,t=this.player.x-e.scrollX,s=this.player.y-e.scrollY;Ol(t,s),Rl(e.scrollX,e.scrollY,e.zoom),this.checkDialogZones(),this.parallaxLayers&&$a(this.parallaxLayers,this.cameras.main)}checkDialogZones(){const e=this.player.x;let t=null;for(const s of this.dialogZones)if(e>=s.x&&e<=s.x+s.width){t=s;break}t?.id!==this.currentDialogZone?.id&&(this.currentDialogZone=t,Gs(t))}recheckCurrentZone(){if(!this.currentDialogZone)return;const e=this.dialogZones.find(t=>t.id===this.currentDialogZone?.id);e&&(this.currentDialogZone=e,Gs(e))}}const ti=1,hr=.001,ld=.15,fr=400;class cd{scene;camera;worldWidth;worldHeight;isPanning=!1;panStartX=0;panStartY=0;cameraDragStartX=0;cameraDragStartY=0;isDraggingToScroll=!1;dragScrollStartX=0;dragScrollStartY=0;dragScrollCameraStartX=0;dragScrollCameraStartY=0;currentZoom=1;targetZoom=1;minZoom=.1;isAnimatingReset=!1;zoomTargetWorldPoint=null;pinchStartDistance=0;pinchStartZoom=1;activeTouches=new Map;pinchEndTime=0;isPinching=!1;PINCH_COOLDOWN=150;touchStartTime=0;touchStartPos=null;touchOnSelectedSprite=!1;TAP_MAX_DURATION=200;TAP_MAX_DISTANCE=10;constructor(e,t,s){this.scene=e,this.camera=e.cameras.main,this.worldWidth=t,this.worldHeight=s}setup(){this.calculateMinZoom(),this.setupCamera(),this.setupMouseControls(),this.setupKeyboardControls(),this.setupUpdateLoop()}calculateMinZoom(){const e=this.camera.width/this.worldWidth,t=this.camera.height/this.worldHeight;this.minZoom=Math.min(e,t)}setupCamera(){this.currentZoom=this.minZoom,this.targetZoom=this.minZoom,this.camera.setZoom(this.minZoom);const e=this.camera.width/this.minZoom,t=this.camera.height/this.minZoom,s=Math.min(0,(this.worldWidth-e)/2),i=Math.min(0,(this.worldHeight-t)/2),r=Math.max(this.worldWidth,e),a=Math.max(this.worldHeight,t);this.camera.setBounds(s,i,r,a),this.camera.centerOn(this.worldWidth/2,this.worldHeight/2),ps(this.minZoom)}centerOn(e,t){this.camera.centerOn(e,t),this.clampScroll()}handleResize(){this.calculateMinZoom(),this.currentZoom<this.minZoom&&(this.currentZoom=this.minZoom,this.targetZoom=this.minZoom,this.camera.setZoom(this.minZoom)),this.targetZoom<this.minZoom&&(this.targetZoom=this.minZoom),this.updateCameraBounds(),this.clampScroll(),ps(this.currentZoom)}updateCameraBounds(){const e=this.camera.width/this.currentZoom,t=this.camera.height/this.currentZoom,s=Math.min(0,(this.worldWidth-e)/2),i=Math.min(0,(this.worldHeight-t)/2),r=Math.max(this.worldWidth,e),a=Math.max(this.worldHeight,t);this.camera.setBounds(s,i,r,a)}getScrollBounds(e=!0){const t=this.camera.width/this.currentZoom,s=this.camera.height/this.currentZoom;let i,r,a,o;return t>this.worldWidth?e?i=r=(this.worldWidth-t)/2:(i=this.worldWidth-t,r=0):(i=0,r=this.worldWidth-t),s>this.worldHeight?e?a=o=(this.worldHeight-s)/2:(a=this.worldHeight-s,o=0):(a=0,o=this.worldHeight-s),{minX:i,maxX:r,minY:a,maxY:o}}clampScroll(){const e=this.getScrollBounds(!0);this.camera.scrollX=Y.Math.Clamp(this.camera.scrollX,e.minX,e.maxX),this.camera.scrollY=Y.Math.Clamp(this.camera.scrollY,e.minY,e.maxY)}softClampScroll(){const e=this.getScrollBounds(!1);this.camera.scrollX=Y.Math.Clamp(this.camera.scrollX,e.minX,e.maxX),this.camera.scrollY=Y.Math.Clamp(this.camera.scrollY,e.minY,e.maxY)}applyPanDelta(e,t,s,i,r,a){const o=this.getScrollBounds(),c=(e-s)/this.currentZoom,d=(t-i)/this.currentZoom;this.camera.scrollX=Y.Math.Clamp(r-c,o.minX,o.maxX),this.camera.scrollY=Y.Math.Clamp(a-d,o.minY,o.maxY)}zoomToPoint(e,t,s){const i=this.camera.getWorldPoint(e,t);this.zoomToWorldPoint(i.x,i.y,s)}zoomToWorldPoint(e,t,s){const i=this.camera.scrollX,r=this.camera.scrollY,a=this.currentZoom;this.currentZoom=s,this.camera.setZoom(s),this.updateCameraBounds(),this.camera.scrollX=e-(e-i)*a/s,this.camera.scrollY=t-(t-r)*a/s,this.softClampScroll(),ps(this.currentZoom)}setupMouseControls(){this.scene.input.on("wheel",(e,t,s,i,r)=>{if(this.isAnimatingReset)return;if((e.event.ctrlKey||Math.abs(s)<5&&Math.abs(i)>0)&&!e.event.ctrlKey){const o=-i*hr*3;this.targetZoom=Y.Math.Clamp(this.targetZoom+o,this.minZoom,ti);const c=this.camera.getWorldPoint(e.x,e.y);this.zoomTargetWorldPoint={x:c.x,y:c.y}}else if(e.event.ctrlKey){const o=-i*hr,c=Y.Math.Clamp(this.currentZoom+o,this.minZoom,ti);this.targetZoom=c,this.zoomToPoint(e.x,e.y,c)}else{const o=this.getScrollBounds();this.camera.scrollX=Y.Math.Clamp(this.camera.scrollX+s/this.currentZoom,o.minX,o.maxX),this.camera.scrollY=Y.Math.Clamp(this.camera.scrollY+i/this.currentZoom,o.minY,o.maxY)}}),this.scene.input.on("pointerdown",e=>{if(e.wasTouch){if(this.activeTouches.set(e.id,{x:e.x,y:e.y}),this.activeTouches.size===2){this.isPinching=!0,this.startPinch(),this.touchStartPos=null,this.touchOnSelectedSprite=!1,this.scene.data.set("touchDraggingSprite",!1);return}this.activeTouches.size===1&&!this.isPinching&&(this.touchStartTime=Date.now(),this.touchStartPos={x:e.x,y:e.y},this.dragScrollStartX=e.x,this.dragScrollStartY=e.y,this.dragScrollCameraStartX=this.camera.scrollX,this.dragScrollCameraStartY=this.camera.scrollY,this.touchOnSelectedSprite=Yc(this.scene,e),this.scene.data.set("touchDraggingSprite",!1),this.scene.data.set("touchStartOnSelectedSprite",this.touchOnSelectedSprite),this.scene.data.set("touchStartWorldX",e.worldX),this.scene.data.set("touchStartWorldY",e.worldY));return}un()||nr()||this.isAnimatingReset||(e.rightButtonDown()||e.middleButtonDown()?(this.isPanning=!0,this.panStartX=e.x,this.panStartY=e.y,this.cameraDragStartX=this.camera.scrollX,this.cameraDragStartY=this.camera.scrollY):e.leftButtonDown()&&!this.isDraggingObject()&&(this.scene.data.get("isDraggingItem")===!0||(this.dragScrollStartX=e.x,this.dragScrollStartY=e.y,this.dragScrollCameraStartX=this.camera.scrollX,this.dragScrollCameraStartY=this.camera.scrollY)))}),this.scene.input.on("pointermove",e=>{if(e.wasTouch){if(this.activeTouches.has(e.id)&&this.activeTouches.set(e.id,{x:e.x,y:e.y}),this.activeTouches.size>=2&&this.isPinching){this.handlePinch();return}if(this.isPinching||Date.now()-this.pinchEndTime<this.PINCH_COOLDOWN||this.scene.data.get("touchDraggingSprite"))return;if(this.touchStartPos&&!this.isDraggingToScroll){const t=Math.abs(e.x-this.touchStartPos.x),s=Math.abs(e.y-this.touchStartPos.y);if(Math.sqrt(t*t+s*s)>this.TAP_MAX_DISTANCE){if(this.touchOnSelectedSprite){this.scene.data.set("touchDragStarted",!0),this.scene.data.set("touchDraggingSprite",!0),this.touchStartPos=null;return}!un()&&!this.isDraggingObject()&&!this.scene.data.get("isDraggingItem")&&(this.isDraggingToScroll=!0,this.touchStartPos=null)}}this.isDraggingToScroll&&this.applyPanDelta(e.x,e.y,this.dragScrollStartX,this.dragScrollStartY,this.dragScrollCameraStartX,this.dragScrollCameraStartY);return}if(!(nr()||this.isAnimatingReset)){if(this.isPanning)this.applyPanDelta(e.x,e.y,this.panStartX,this.panStartY,this.cameraDragStartX,this.cameraDragStartY);else if(e.leftButtonDown()&&!this.isDraggingToScroll&&!this.isDraggingObject()&&!(this.scene.data.get("isDraggingItem")===!0)){const s=Math.abs(e.x-this.dragScrollStartX),i=Math.abs(e.y-this.dragScrollStartY);Math.sqrt(s*s+i*i)>10&&(this.isDraggingToScroll=!0,this.scene.input.setDefaultCursor("grabbing"))}this.isDraggingToScroll&&this.applyPanDelta(e.x,e.y,this.dragScrollStartX,this.dragScrollStartY,this.dragScrollCameraStartX,this.dragScrollCameraStartY)}}),this.scene.input.on("pointerup",e=>{if(e.wasTouch){if(this.isPinching&&(this.pinchEndTime=Date.now(),this.isPinching=!1,Vs(!1)),this.touchStartPos&&!this.isDraggingToScroll){const t=Date.now()-this.touchStartTime,s=Math.abs(e.x-this.touchStartPos.x),i=Math.abs(e.y-this.touchStartPos.y),r=Math.sqrt(s*s+i*i);t<this.TAP_MAX_DURATION&&r<this.TAP_MAX_DISTANCE&&(this.scene.data.set("lastTapTime",Date.now()),this.scene.data.set("lastTapWorldX",e.worldX),this.scene.data.set("lastTapWorldY",e.worldY))}this.touchStartPos=null,this.touchOnSelectedSprite=!1,this.activeTouches.delete(e.id),this.scene.data.set("touchDraggingSprite",!1),this.scene.data.set("touchDragStarted",!1),this.scene.data.set("touchStartOnSelectedSprite",!1),this.isDraggingToScroll&&(this.isDraggingToScroll=!1);return}!e.rightButtonDown()&&!e.middleButtonDown()&&(this.isPanning=!1),this.isDraggingToScroll&&(this.isDraggingToScroll=!1,this.scene.input.setDefaultCursor("default"))}),this.scene.input.on("pointerout",e=>{e.wasTouch&&(this.activeTouches.delete(e.id),this.touchStartPos=null,this.touchOnSelectedSprite=!1,this.isPinching&&this.activeTouches.size<2&&(this.isPinching=!1,this.pinchEndTime=Date.now(),Vs(!1)))})}startPinch(){const e=Array.from(this.activeTouches.values());if(e.length!==2)return;const[t,s]=e;this.pinchStartDistance=Math.hypot(s.x-t.x,s.y-t.y),this.pinchStartZoom=this.currentZoom,Vs(!0)}handlePinch(){const e=Array.from(this.activeTouches.values());if(e.length!==2)return;const[t,s]=e,i=Math.hypot(s.x-t.x,s.y-t.y),r=(t.x+s.x)/2,a=(t.y+s.y)/2,o=i/this.pinchStartDistance,c=Y.Math.Clamp(this.pinchStartZoom*o,this.minZoom,ti);this.targetZoom=c,this.zoomToPoint(r,a,c)}setupKeyboardControls(){const e={up:this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.UP,!1),down:this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.DOWN,!1),left:this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.LEFT,!1),right:this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.RIGHT,!1)},t={w:this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.W,!1),a:this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.A,!1),s:this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.S,!1),d:this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.D,!1)};this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.SPACE,!1).on("down",()=>{xn()||this.centerOnPlayer()}),this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.F,!1).on("down",()=>{xn()||this.resetToFit()}),this.scene.data.set("cameraArrowKeys",e),this.scene.data.set("cameraWasdKeys",t)}setupUpdateLoop(){const e=this.scene.data.get("cameraArrowKeys"),t=this.scene.data.get("cameraWasdKeys");this.scene.events.on("update",()=>{if(!this.isAnimatingReset&&Math.abs(this.currentZoom-this.targetZoom)>1e-4){const r=Y.Math.Linear(this.currentZoom,this.targetZoom,ld);this.zoomTargetWorldPoint?this.zoomToWorldPoint(this.zoomTargetWorldPoint.x,this.zoomTargetWorldPoint.y,r):this.zoomToPoint(this.camera.width/2,this.camera.height/2,r),Math.abs(this.currentZoom-this.targetZoom)<.001&&(this.zoomTargetWorldPoint=null)}if(xn()||this.isAnimatingReset)return;const s=10/this.currentZoom,i=this.getScrollBounds();e?.left?.isDown||t?.a?.isDown?this.camera.scrollX=Y.Math.Clamp(this.camera.scrollX-s,i.minX,i.maxX):(e?.right?.isDown||t?.d?.isDown)&&(this.camera.scrollX=Y.Math.Clamp(this.camera.scrollX+s,i.minX,i.maxX)),e?.up?.isDown||t?.w?.isDown?this.camera.scrollY=Y.Math.Clamp(this.camera.scrollY-s,i.minY,i.maxY):(e?.down?.isDown||t?.s?.isDown)&&(this.camera.scrollY=Y.Math.Clamp(this.camera.scrollY+s,i.minY,i.maxY))})}centerOnPlayer(){const e=this.scene.data.get("playerSprite");e&&(this.camera.centerOn(e.x,e.y),this.clampScroll())}isDraggingObject(){return this.scene.data.get("isDraggingObject")===!0||this.scene.data.get("isDraggingItem")===!0}resetToFit(){if(this.isAnimatingReset)return;this.isAnimatingReset=!0,this.targetZoom=this.minZoom;const e=this.camera.width/this.minZoom,t=this.camera.height/this.minZoom,s=(this.worldWidth-e)/2,i=(this.worldHeight-t)/2,r=s+e/2,a=i+t/2;this.camera.pan(r,a,fr,"Sine.easeInOut"),this.camera.zoomTo(this.minZoom,fr,"Sine.easeInOut",!1,(o,c)=>{c===1&&(this.currentZoom=this.minZoom,this.camera.scrollX=s,this.camera.scrollY=i,this.isAnimatingReset=!1,ps(this.minZoom))})}destroy(){this.activeTouches.clear()}}const dd=On.PLAYER.hex;class ud{scene;player;worldWidth;worldHeight;unsubscribers=[];interactionCleanup=null;constructor(e,t,s){this.scene=e,this.worldWidth=t,this.worldHeight=s}create(e,t){const s=Math.min(t,es(this.worldHeight)),i=Un.getSkinId(),r=et.find(o=>o.id===i)??et[0],a=si(r);return this.player=this.scene.add.sprite(e,s,`${i}-idle`,0),this.player.setScale(a),this.player.setDepth(Ta.DEPTH),this.player.setData("isPlayer",!0),this.scene.data.set("playerSprite",this.player),this.setupInteraction(),this.setupEditModeSubscription(),this.setupSelectionSubscription(),this.player}setupInteraction(){const e=new Y.Geom.Rectangle(8,4,32,40);this.interactionCleanup=Zs({sprite:this.player,scene:this.scene,useGridSnapping:!1,cursor:"grab",hitArea:e,constraints:{minX:or,maxX:this.worldWidth-or,minY:Xc},callbacks:{onSelect:()=>{vc(!0)},isSelected:()=>gt(js),onDragStart:()=>{this.player.setTint(Ni),this.scene.data.set("isDraggingObject",!0)},onDrag:(t,s)=>{ir(Math.round(t),Math.round(s))},onDragEnd:(t,s)=>{this.updateSelectionVisual(gt(js)),this.scene.data.set("isDraggingObject",!1);let i=this.player.y;Wl(this.player.y,this.worldHeight)&&(i=es(this.worldHeight),this.player.setY(i)),ir(Math.round(this.player.x),Math.round(i))}}})}setupSelectionSubscription(){const e=js.subscribe(t=>{this.updateSelectionVisual(t),this.scene.data.set("isPlayerSelected",t)});this.unsubscribers.push(e)}updateSelectionVisual(e){this.player&&(e?this.player.setTint(dd):this.player.clearTint())}setupEditModeSubscription(){const e=Ve.subscribe(t=>{t==="dialogs"?(this.interactionCleanup&&(this.interactionCleanup(),this.interactionCleanup=null),this.player.disableInteractive(),this.player.setAlpha(.6)):(this.player.setAlpha(1),this.interactionCleanup||this.setupInteraction())});this.unsubscribers.push(e)}getSprite(){return this.player}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.interactionCleanup&&(this.interactionCleanup(),this.interactionCleanup=null),this.player&&this.player.destroy()}}class hd{scene;graphics;worldWidth;worldHeight;constructor(e,t,s){this.scene=e,this.worldWidth=t,this.worldHeight=s}create(){return this.graphics=this.scene.add.graphics(),this.graphics.setDepth(ja),this.draw(),this.graphics}draw(){this.graphics.clear(),this.graphics.lineStyle($c,Ac,Mc);const e=Math.max(this.worldHeight,this.scene.scale.height);for(let s=0;s<=this.worldWidth;s+=Sn)this.graphics.beginPath(),this.graphics.moveTo(s,0),this.graphics.lineTo(s,e),this.graphics.strokePath();for(let s=0;s<=e;s+=Sn)this.graphics.beginPath(),this.graphics.moveTo(0,s),this.graphics.lineTo(this.worldWidth,s),this.graphics.strokePath();const t=this.worldHeight-An;this.graphics.lineStyle(Lc,ei,Oc),this.graphics.beginPath(),this.graphics.moveTo(0,t),this.graphics.lineTo(this.worldWidth,t),this.graphics.strokePath(),this.graphics.lineStyle(Fc,ei,Hc),this.graphics.fillStyle(ei,Rc),this.graphics.fillRect(0,t,this.worldWidth,e-t)}getGraphics(){return this.graphics}redraw(){this.draw()}destroy(){this.graphics&&this.graphics.destroy()}}class fd{listeners=new Map;on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set);const s=this.listeners.get(e);return s.add(t),{unsubscribe:()=>{s.delete(t),s.size===0&&this.listeners.delete(e)}}}once(e,t){const s=this.on(e,i=>{s.unsubscribe(),t(i)});return s}emit(e,t){const s=this.listeners.get(e);s&&s.forEach(i=>{try{i(t)}catch(r){console.error(`[EventBus] Error in listener for "${e}":`,r)}})}off(e){this.listeners.delete(e)}clear(){this.listeners.clear()}listenerCount(e){return this.listeners.get(e)?.size??0}}const Ge=new fd,Oe={ASSET_DROPPED:"asset:dropped",FRAME_DROPPED:"frame:dropped",SOCIAL_DROPPED:"social:dropped",MINIMAP_NAVIGATE:"minimap:navigate",DIALOG_ZONE_CREATE:"dialogZone:create",DIALOG_ZONE_CREATE_AT:"dialogZone:createAt",TEMP_ZONE_BUTTON_SHOW:"tempZoneButton:show",TEMP_ZONE_BUTTON_HIDE:"tempZoneButton:hide"};class gd{scene;groundY;worldWidth;worldHeight;itemManager;unsubscribers=[];constructor(e,t,s,i){this.scene=e,this.groundY=t,this.worldWidth=s,this.worldHeight=i}create(e){return this.itemManager=new ks(this.scene,this.groundY,this.worldWidth,this.worldHeight,!0),e&&e.length>0&&this.itemManager.createItems(e),this.setupBackgroundDeselect(),this.setupStoreSubscriptions(),this.setupAssetDropListener(),this.setupDeleteKeys(),this.itemManager}setupBackgroundDeselect(){this.itemManager.setupBackgroundDeselect()}setupStoreSubscriptions(){const e=Ns.subscribe(r=>{this.scene.data.set("selectedItemId",r),this.itemManager.updateSelectionVisuals()});this.unsubscribers.push(e);const t=Ve.subscribe(r=>{r==="dialogs"?(Li(),this.itemManager.setInteractiveEnabled(!1)):this.itemManager.setInteractiveEnabled(!0)});this.unsubscribers.push(t);let s=[];const i=tc.subscribe(r=>{if(!r?.placedItems)return;const a=r.placedItems;s.forEach(o=>{a.find(d=>d.id===o.id)||this.itemManager.removeItem(o.id)}),a.forEach(o=>{const c=s.find(d=>d.id===o.id);c&&JSON.stringify(c)!==JSON.stringify(o)&&this.itemManager.updateItem(o.id,o)}),s=a.map(o=>({...o}))});this.unsubscribers.push(i)}setupAssetDropListener(){const e=Ge.on(Oe.ASSET_DROPPED,t=>{const{assetKey:s,canvasX:i,canvasY:r}=t,o=this.scene.cameras.main.getWorldPoint(i,r),c=Math.max(0,Math.min(this.worldWidth,o.x)),d=Math.max(0,Math.min(this.worldHeight,o.y));let u="behind";Ha.subscribe(p=>{u=p})();const f=ws.createAtWorldPosition(s,c,d,this.groundY,u);mc(f),this.itemManager.createItem(f),Ka(f.id),an.set(!1)});this.unsubscribers.push(()=>e.unsubscribe())}setupDeleteKeys(){const e=this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.DELETE,!1),t=this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.BACKSPACE,!1),s=()=>{if(xn())return;const i=this.scene.data.get("selectedItemId");i&&za(i)};e.on("down",s),t.on("down",s)}getManager(){return this.itemManager}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.itemManager&&this.itemManager.destroy()}}class gr{scene;worldWidth;worldHeight;frames=new Map;unsubscribers=[];selectionGraphics=null;cleanupFunctions=new Map;doubleClickDetector=new qa;constructor(e,t,s){this.scene=e,this.worldWidth=t,this.worldHeight=s}static preloadAssets(e){for(let t=1;t<=25;t++)e.load.image(`frame_base_${t}`,`assets/frames/base ${t}.png`)}create(e){this.selectionGraphics=this.scene.add.graphics(),this.selectionGraphics.setDepth(Ue.SELECTION_GRAPHICS),e&&e.length>0&&e.forEach(t=>this.createFrame(t)),this.setupStoreSubscriptions(),this.setupFrameDropListener(),this.setupDeleteKeys()}createFrame(e){const t=`frame_${e.frameKey}`;if(!this.scene.textures.exists(t)){console.warn(`Frame texture not found: ${t}`);return}const s=e.scale??Rt,i=e.depth??Ue.ITEMS_FRONT,r=(e.rotation??0)*(Math.PI/180),a=e.rotation===90,{innerWidth:o,innerHeight:c}=Gn(s,a),d=this.scene.add.graphics();d.setDepth(i-.1),ys(d,e.x,e.y,o,c,e.backgroundColor||Wn);const u=this.scene.add.sprite(e.x,e.y,t);u.setScale(s),u.setDepth(i),u.setOrigin(.5,.5),u.setRotation(r),u.setData("frameId",e.id);const h={sprite:u,background:d,data:e};this.frames.set(e.id,h),this.makeInteractive(h,e.id)}updateFrameVisuals(e){const{sprite:t,background:s,data:i}=e,r=`frame_${i.frameKey}`;t.texture.key!==r&&this.scene.textures.exists(r)&&t.setTexture(r);const a=i.scale??Rt;t.setScale(a);const o=(i.rotation??0)*(Math.PI/180);t.setRotation(o);const c=i.rotation===90,{innerWidth:d,innerHeight:u}=Gn(a,c);ys(s,t.x,t.y,d,u,i.backgroundColor||Wn)}moveContainer(e,t,s){const{sprite:i,background:r,data:a}=e;i.setPosition(t,s);const o=a.scale??Rt,c=a.rotation===90,{innerWidth:d,innerHeight:u}=Gn(o,c);ys(r,t,s,d,u,a.backgroundColor||Wn)}makeInteractive(e,t){const{sprite:s}=e,i=Zs({sprite:s,scene:this.scene,cursor:"grab",useGridSnapping:!0,constraints:{minX:0,maxX:this.worldWidth,minY:0,maxY:this.worldHeight},callbacks:{onSelect:()=>{zn(t),this.updateSelectionVisuals()},isSelected:()=>gt(ns)===t,onDoubleClick:()=>this.doubleClickDetector.check(t)?(Ra(),!0):!1,onDragStart:()=>{s.setTint(Ni)},onDrag:(r,a)=>{this.moveContainer(e,r,a),this.updateSelectionVisuals(),uc(t,r,a)},onDragEnd:(r,a)=>{s.clearTint(),hc(t),e.data.x=Math.round(r),e.data.y=Math.round(a),Et(t,{x:e.data.x,y:e.data.y})}}});this.cleanupFunctions.set(t,i)}setupStoreSubscriptions(){const e=ns.subscribe(r=>{this.scene.data.set("selectedFrameId",r),this.updateSelectionVisuals()});this.unsubscribers.push(e);const t=Ve.subscribe(r=>{r==="dialogs"?(zn(null),this.setInteractiveEnabled(!1)):this.setInteractiveEnabled(!0)});this.unsubscribers.push(t);let s=[];const i=Xa.subscribe(r=>{s.forEach(a=>{r.find(c=>c.id===a.id)||this.removeFrame(a.id)}),r.forEach(a=>{const o=s.find(d=>d.id===a.id),c=this.frames.get(a.id);if(c&&o){const d=o.backgroundColor!==a.backgroundColor,u=o.textColor!==a.textColor,h=o.textSize!==a.textSize,f=JSON.stringify(o.texts)!==JSON.stringify(a.texts),p=o.rotation!==a.rotation,m=o.scale!==a.scale,S=o.frameKey!==a.frameKey;c.data=a,(d||u||h||f||p||m||S)&&(this.updateFrameVisuals(c),this.scene.data.get("selectedFrameId")===a.id&&this.updateSelectionVisuals())}}),s=r.map(a=>({...a}))});this.unsubscribers.push(i)}setupFrameDropListener(){const e=Ge.on(Oe.FRAME_DROPPED,t=>{const{frameKey:s,canvasX:i,canvasY:r}=t,o=this.scene.cameras.main.getWorldPoint(i,r),c=Math.max(0,Math.min(this.worldWidth,o.x)),d=Math.max(0,Math.min(this.worldHeight,o.y)),u={id:Kc(),frameKey:s,x:Math.round(c),y:Math.round(d),scale:sd(s),depth:Ue.ITEMS_FRONT,rotation:90,backgroundColor:Wn,textColor:"#333333",textSize:16,texts:[{language:"cs",text:""},{language:"en",text:""}]};Tc(u),this.createFrame(u),zn(u.id)});this.unsubscribers.push(()=>e.unsubscribe())}setupDeleteKeys(){const e=this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.DELETE,!1),t=this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.BACKSPACE,!1),s=()=>{if(xn())return;let i="items";if(Ve.subscribe(o=>i=o)(),i!=="frames")return;const a=this.scene.data.get("selectedFrameId");a&&Fi(a)};e.on("down",s),t.on("down",s)}updateSelectionVisuals(){if(!this.selectionGraphics)return;this.selectionGraphics.clear();const e=this.scene.data.get("selectedFrameId");if(!e){Qs(null);return}const t=this.frames.get(e);if(!t){Qs(null);return}const s=t.sprite,i=s.getBounds(),r=this.scene.cameras.main,{screenX:a,screenY:o}=en(s.x,s.y,r);Qs({screenX:a,screenY:o,frameHeight:i.height*r.zoom}),this.selectionGraphics.lineStyle(3,On.FRAME.hex,1),this.selectionGraphics.strokeRect(i.x-4,i.y-4,i.width+8,i.height+8)}removeFrame(e){const t=this.frames.get(e);t&&(t.sprite.destroy(),t.background.destroy(),this.frames.delete(e)),this.updateSelectionVisuals()}setInteractiveEnabled(e){this.frames.forEach(({sprite:t,background:s})=>{e?(t.setInteractive(),t.setAlpha(1),s.setAlpha(1)):(t.disableInteractive(),t.setAlpha(.6),s.setAlpha(.6))}),!e&&this.selectionGraphics&&this.selectionGraphics.clear()}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.frames.forEach(({sprite:e,background:t})=>{e.destroy(),t.destroy()}),this.frames.clear(),this.selectionGraphics&&(this.selectionGraphics.destroy(),this.selectionGraphics=null)}}class pr{scene;worldWidth;worldHeight;socials=new Map;unsubscribers=[];selectionGraphics=null;cleanupFunctions=new Map;doubleClickDetector=new qa;constructor(e,t,s){this.scene=e,this.worldWidth=t,this.worldHeight=s}static preloadAssets(e){e.load.image("social_discord","assets/socials/Discord.png"),e.load.image("social_facebook","assets/socials/Facebook.png"),e.load.image("social_instagram","assets/socials/Instagram.png"),e.load.image("social_kofi","assets/socials/Ko Fi.png"),e.load.image("social_linkedin","assets/socials/LinkedIn.png"),e.load.image("social_patreon","assets/socials/Patreon.png"),e.load.image("social_tiktok","assets/socials/TikTok.png"),e.load.image("social_twitch","assets/socials/Twitch.png"),e.load.image("social_twitter","assets/socials/Twitter.png"),e.load.image("social_whatsapp","assets/socials/Whatsapp.png"),e.load.image("social_youtube","assets/socials/Youtube.png")}create(e){this.selectionGraphics=this.scene.add.graphics(),this.selectionGraphics.setDepth(Ue.SELECTION_GRAPHICS),e&&e.length>0&&e.forEach(t=>this.createSocial(t)),this.setupStoreSubscriptions(),this.setupSocialDropListener(),this.setupDeleteKeys()}createSocial(e){const t=`social_${e.socialKey}`;if(!this.scene.textures.exists(t)){console.warn(`Social texture not found: ${t}`);return}const s=e.scale??Cn,i=e.depth??Ue.ITEMS_FRONT,r=this.scene.add.sprite(e.x,e.y,t);r.setScale(s),r.setDepth(i),r.setOrigin(.5,.5),r.setData("socialId",e.id),this.socials.set(e.id,{sprite:r,data:e}),this.makeInteractive(e.id)}updateSocialVisuals(e){const t=this.socials.get(e);if(!t)return;const{sprite:s,data:i}=t,r=`social_${i.socialKey}`;s.texture.key!==r&&this.scene.textures.exists(r)&&s.setTexture(r);const a=i.scale??Cn;s.setScale(a)}makeInteractive(e){const t=this.socials.get(e);if(!t)return;const{sprite:s}=t,i=Zs({sprite:s,scene:this.scene,cursor:"grab",useGridSnapping:!0,constraints:{minX:0,maxX:this.worldWidth,minY:0,maxY:this.worldHeight},callbacks:{onSelect:()=>{Kn(e),this.updateSelectionVisuals()},isSelected:()=>gt(ss)===e,onDoubleClick:()=>this.doubleClickDetector.check(e)?(Fa(),!0):!1,onDragStart:()=>{s.setTint(Ni)},onDrag:()=>{this.updateSelectionVisuals()},onDragEnd:(r,a)=>{s.clearTint();const o=this.socials.get(e);o&&(o.data.x=Math.round(r),o.data.y=Math.round(a),_s(e,{x:o.data.x,y:o.data.y}))}}});this.cleanupFunctions.set(e,i)}setupStoreSubscriptions(){const e=ss.subscribe(r=>{this.scene.data.set("selectedSocialId",r),this.updateSelectionVisuals()});this.unsubscribers.push(e);const t=Ve.subscribe(r=>{r==="dialogs"?(Kn(null),this.setInteractiveEnabled(!1)):this.setInteractiveEnabled(!0)});this.unsubscribers.push(t);let s=[];const i=cc.subscribe(r=>{s.forEach(a=>{r.find(c=>c.id===a.id)||this.removeSocial(a.id)}),r.forEach(a=>{const o=s.find(d=>d.id===a.id),c=this.socials.get(a.id);if(c&&o){const d=o.scale!==a.scale,u=o.socialKey!==a.socialKey;c.data=a,(d||u)&&(this.updateSocialVisuals(a.id),this.scene.data.get("selectedSocialId")===a.id&&this.updateSelectionVisuals())}}),s=r.map(a=>({...a}))});this.unsubscribers.push(i)}setupSocialDropListener(){const e=Ge.on(Oe.SOCIAL_DROPPED,t=>{const{socialKey:s,canvasX:i,canvasY:r}=t,o=this.scene.cameras.main.getWorldPoint(i,r),c=Math.max(0,Math.min(this.worldWidth,o.x)),d=Math.max(0,Math.min(this.worldHeight,o.y)),u={id:id(),socialKey:s,x:Math.round(c),y:Math.round(d),scale:Cn,depth:Ue.ITEMS_FRONT};Dc(u),this.createSocial(u),Kn(u.id)});this.unsubscribers.push(()=>e.unsubscribe())}setupDeleteKeys(){const e=this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.DELETE,!1),t=this.scene.input.keyboard.addKey(Y.Input.Keyboard.KeyCodes.BACKSPACE,!1),s=()=>{if(xn())return;let i="items";if(Ve.subscribe(o=>i=o)(),i!=="socials")return;const a=this.scene.data.get("selectedSocialId");a&&Hi(a)};e.on("down",s),t.on("down",s)}updateSelectionVisuals(){if(!this.selectionGraphics)return;this.selectionGraphics.clear();const e=this.scene.data.get("selectedSocialId");if(!e){qs(null);return}const t=this.socials.get(e);if(!t){qs(null);return}const s=t.sprite,i=s.getBounds(),r=this.scene.cameras.main,{screenX:a,screenY:o}=en(s.x,s.y,r);qs({screenX:a,screenY:o,socialHeight:i.height*r.zoom}),this.selectionGraphics.lineStyle(3,On.SOCIAL.hex,1),this.selectionGraphics.strokeRect(i.x-4,i.y-4,i.width+8,i.height+8)}removeSocial(e){const t=this.socials.get(e);t&&(t.sprite.destroy(),this.socials.delete(e));const s=this.cleanupFunctions.get(e);s&&(s(),this.cleanupFunctions.delete(e)),this.updateSelectionVisuals()}setInteractiveEnabled(e){this.socials.forEach(({sprite:t})=>{e?(t.setInteractive(),t.setAlpha(1)):(t.disableInteractive(),t.setAlpha(.6))}),!e&&this.selectionGraphics&&this.selectionGraphics.clear()}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.cleanupFunctions.forEach(e=>e()),this.cleanupFunctions.clear(),this.socials.forEach(({sprite:e})=>{e.destroy()}),this.socials.clear(),this.selectionGraphics&&(this.selectionGraphics.destroy(),this.selectionGraphics=null)}}const Wt=ja-1,Zt=300,mr=150,pd=.3,md=.5,ni=40,vr=60,_r=16777215,br=.6,yr=0,wt=60,wr=8;class vd{scene;worldWidth;worldHeight;graphics=null;zoneAreas=new Map;leftHandles=new Map;leftHandleVisuals=new Map;rightHandles=new Map;rightHandleVisuals=new Map;arrowGraphics=new Map;dragging=null;unsubscribers=[];createZoneSubscription;currentEditMode="items";currentZones=[];currentSelectedId=null;lastClickTime=0;lastClickX=0;DOUBLE_CLICK_THRESHOLD=300;DOUBLE_CLICK_DISTANCE=20;pendingTap=null;TAP_MAX_DURATION=300;TAP_MAX_DISTANCE=15;pendingZoneSelection=null;createZoneAtSubscription;boundWindowPointerUp=()=>{};boundWindowPointerMove=()=>{};currentScreenX=0;autoScrollTimer=null;constructor(e,t,s){this.scene=e,this.worldWidth=t,this.worldHeight=s}create(){this.graphics=this.scene.add.graphics(),this.graphics.setDepth(Wt);const e=Ve.subscribe(i=>{this.currentEditMode=i,this.render()});this.unsubscribers.push(e);const t=Pi.subscribe(i=>{this.currentZones=i,this.render()});this.unsubscribers.push(t);const s=Ws.subscribe(i=>{this.currentSelectedId=i,this.render()});this.unsubscribers.push(s),this.scene.input.on("pointermove",this.handlePointerMove,this),this.scene.input.on("pointerup",this.handlePointerUp,this),this.boundWindowPointerUp=this.handlePointerUp.bind(this),this.boundWindowPointerMove=this.handleWindowPointerMove.bind(this),window.addEventListener("pointerup",this.boundWindowPointerUp),window.addEventListener("pointermove",this.boundWindowPointerMove),this.scene.input.on("pointerdown",this.handlePointerDown,this),this.createZoneSubscription=Ge.on(Oe.DIALOG_ZONE_CREATE,()=>{this.createNewZone()}),this.createZoneAtSubscription=Ge.on(Oe.DIALOG_ZONE_CREATE_AT,i=>{this.createZoneAtPosition(i.worldX)}),this.render()}clearVisuals(){this.graphics&&this.graphics.clear(),this.zoneAreas.forEach(e=>e.destroy()),this.zoneAreas.clear(),this.leftHandles.forEach(e=>e.destroy()),this.leftHandles.clear(),this.rightHandles.forEach(e=>e.destroy()),this.rightHandles.clear(),this.leftHandleVisuals.forEach(e=>e.destroy()),this.leftHandleVisuals.clear(),this.rightHandleVisuals.forEach(e=>e.destroy()),this.rightHandleVisuals.clear(),this.arrowGraphics.forEach(e=>e.destroy()),this.arrowGraphics.clear()}render(){if(this.clearVisuals(),this.currentEditMode==="dialogs")for(const e of this.currentZones)this.renderZone(e,e.id===this.currentSelectedId)}renderZone(e,t){if(!this.graphics)return;const s=Y.Display.Color.HexStringToColor(e.color).color,i=t?md:pd;this.graphics.fillStyle(s,i),this.graphics.fillRect(e.x,0,e.width,this.worldHeight),this.graphics.lineStyle(2,s,.8),this.graphics.strokeRect(e.x,0,e.width,this.worldHeight);const r=this.scene.add.rectangle(e.x+e.width/2,this.worldHeight/2,e.width-ni*2,this.worldHeight);r.setOrigin(.5,.5),r.setInteractive({cursor:t?"grab":"pointer"}),r.setDepth(Wt+.1),r.setAlpha(.001),r.setData("zoneId",e.id),r.on("pointerdown",a=>{if(this.isClickOnUIElement(a))return;const o=Date.now(),c=o-this.lastClickTime<this.DOUBLE_CLICK_THRESHOLD&&Math.abs(a.worldX-this.lastClickX)<this.DOUBLE_CLICK_DISTANCE;this.lastClickTime=o,this.lastClickX=a.worldX;const d=this.currentSelectedId===e.id;if(c&&d){Ba();return}d?(this.scene.data.set("isDraggingItem",!0),In(!0),this.startDrag(e.id,"move",a.worldX)):this.pendingZoneSelection={zoneId:e.id,worldX:a.worldX,startTime:o}}),this.zoneAreas.set(e.id,r),t&&this.createHandles(e)}createHandles(e){const t=this.scene.cameras.main.scrollY,s=this.scene.cameras.main.height,i=t+s/2,r=this.scene.add.rectangle(e.x,this.worldHeight/2,ni,this.worldHeight);r.setOrigin(.5,.5),r.setDepth(Wt+.2),r.setFillStyle(_r,br);const a=this.scene.add.rectangle(e.x,this.worldHeight/2,vr,this.worldHeight);a.setOrigin(.5,.5),a.setInteractive({cursor:"ew-resize"}),a.setDepth(Wt+.25),a.setAlpha(.001),a.setData("zoneId",e.id),a.setData("type","left"),a.on("pointerdown",f=>{this.isClickOnUIElement(f)||this.startDrag(e.id,"left",f.worldX)}),this.leftHandles.set(e.id,a),this.leftHandleVisuals.set(e.id,r);const o=8,c=this.scene.add.graphics();c.setDepth(Wt+.3),this.drawArrow(c,e.x-o,i,"left"),this.arrowGraphics.set(`${e.id}_left`,c);const d=this.scene.add.rectangle(e.x+e.width,this.worldHeight/2,ni,this.worldHeight);d.setOrigin(.5,.5),d.setDepth(Wt+.2),d.setFillStyle(_r,br);const u=this.scene.add.rectangle(e.x+e.width,this.worldHeight/2,vr,this.worldHeight);u.setOrigin(.5,.5),u.setInteractive({cursor:"ew-resize"}),u.setDepth(Wt+.25),u.setAlpha(.001),u.setData("zoneId",e.id),u.setData("type","right"),u.on("pointerdown",f=>{this.isClickOnUIElement(f)||this.startDrag(e.id,"right",f.worldX)}),this.rightHandles.set(e.id,u),this.rightHandleVisuals.set(e.id,d);const h=this.scene.add.graphics();h.setDepth(Wt+.3),this.drawArrow(h,e.x+e.width+o,i,"right"),this.arrowGraphics.set(`${e.id}_right`,h)}drawArrow(e,t,s,i){const a=i==="left"?-1:1;e.fillStyle(3355443,.8),e.beginPath(),e.moveTo(t+a*10+1,s),e.lineTo(t-a*10+1,s-10+1),e.lineTo(t-a*10+1,s+10-1),e.closePath(),e.fillPath(),e.fillStyle(16777215,.9),e.beginPath(),e.moveTo(t+a*10,s),e.lineTo(t-a*10,s-10),e.lineTo(t-a*10,s+10),e.closePath(),e.fillPath()}startDrag(e,t,s){const i=this.currentZones.find(r=>r.id===e);i&&(this.scene.data.set("isDraggingItem",!0),In(!0),this.dragging={zoneId:e,type:t,startX:s,originalX:i.x,originalWidth:i.width})}getZoneBounds(e){let t=0,s=this.worldWidth;for(const i of this.currentZones){if(i.id===e)continue;const r=i.x+i.width,a=this.currentZones.find(o=>o.id===e);a&&(r<=a.x+a.width/2&&(t=Math.max(t,r+yr)),i.x>=a.x+a.width/2&&(s=Math.min(s,i.x-yr)))}return{minX:t,maxX:s-Zt,maxRight:s}}wouldOverlap(e,t,s){const i=t+s;for(const r of this.currentZones){if(r.id===e)continue;const a=r.x,o=r.x+r.width;if(t<o&&i>a)return!0}return!1}isClickOnUIElement(e){const t=e.downElement;return t?t.tagName?.toUpperCase()!=="CANVAS":!1}cancelPendingIfMoved(e){this.pendingTap&&Math.abs(e-this.pendingTap.worldX)>this.TAP_MAX_DISTANCE&&(this.pendingTap=null),this.pendingZoneSelection&&Math.abs(e-this.pendingZoneSelection.worldX)>this.TAP_MAX_DISTANCE&&(this.pendingZoneSelection=null)}screenToWorld(e,t){const s=this.scene.cameras.main,r=this.scene.game.canvas.getBoundingClientRect(),a=e-r.left,o=t-r.top;return Bl(a,o,s)}handleWindowPointerMove(e){const t=this.screenToWorld(e.clientX,e.clientY);if(this.cancelPendingIfMoved(t.worldX),!this.dragging)return;const i=this.scene.game.canvas.getBoundingClientRect();e.clientX>=i.left&&e.clientX<=i.right&&e.clientY>=i.top&&e.clientY<=i.bottom||(this.currentScreenX=e.clientX-i.left,this.updateDrag(t.worldX),this.checkAutoScroll())}handlePointerMove(e){this.cancelPendingIfMoved(e.worldX),this.dragging&&(this.currentScreenX=e.x,e.event?.stopPropagation?.(),this.updateDrag(e.worldX),this.checkAutoScroll())}checkAutoScroll(){if(!this.dragging||this.dragging.type!=="move"){this.stopAutoScroll();return}const e=this.scene.cameras.main,t=e.width,s=this.currentZones.find(b=>b.id===this.dragging?.zoneId);if(!s)return;const i=Math.max(0,this.worldWidth-e.width/e.zoom);if(i<=0){this.stopAutoScroll();return}const{screenX:r}=en(s.x,0,e),{screenX:a}=en(s.x+s.width,0,e),o=r<=wt,c=a>=t-wt,d=e.scrollX>0,u=e.scrollX<i,h=s.x>0,f=s.x+s.width<this.worldWidth,p=this.currentScreenX<wt,m=this.currentScreenX>t-wt,g=o&&p&&d&&h||c&&m&&u&&f;g&&!this.autoScrollTimer?this.autoScrollTimer=this.scene.time.addEvent({delay:16,callback:this.performAutoScroll,callbackScope:this,loop:!0}):!g&&this.autoScrollTimer&&this.stopAutoScroll()}performAutoScroll(){if(!this.dragging||this.dragging.type!=="move"){this.stopAutoScroll();return}const e=this.scene.cameras.main,t=e.width,s=this.currentZones.find(w=>w.id===this.dragging?.zoneId);if(!s)return;let i=0;if(this.currentScreenX<wt){if(s.x<=0){this.stopAutoScroll();return}const g=(wt-this.currentScreenX)/wt;i=-wr*g}else if(this.currentScreenX>t-wt){if(s.x+s.width>=this.worldWidth){this.stopAutoScroll();return}const g=(this.currentScreenX-(t-wt))/wt;i=wr*g}if(i===0)return;const r=e.scrollX+i,a=0,o=Math.max(0,this.worldWidth-e.width/e.zoom),d=Math.max(a,Math.min(o,r))-e.scrollX;if(o<=0){this.stopAutoScroll();return}if(d===0){this.stopAutoScroll();return}const u=s.x+d,h=Math.max(0,Math.min(this.worldWidth-s.width,u)),f=h-s.x;if(f===0){this.stopAutoScroll();return}const p=e.scrollX+f,m=Math.max(0,Math.min(o,p));if(Math.abs(m-e.scrollX)>Math.abs(f)*2){this.stopAutoScroll();return}e.scrollX=m,this.wouldOverlap(s.id,h,s.width)||(_n(s.id,{x:h}),this.dragging.originalX+=f,this.dragging.startX+=f)}stopAutoScroll(){this.autoScrollTimer&&(this.autoScrollTimer.destroy(),this.autoScrollTimer=null)}updateDrag(e){if(!this.dragging)return;const t=e-this.dragging.startX,s=this.currentZones.find(r=>r.id===this.dragging?.zoneId);if(!s)return;const i=this.getZoneBounds(s.id);if(this.dragging.type==="left"){let r=this.dragging.originalX+t,a=this.dragging.originalWidth-t;if(r<0&&(a+=r,r=0),a<Zt&&(r=this.dragging.originalX+this.dragging.originalWidth-Zt,a=Zt),r<i.minX){const o=i.minX-r;r=i.minX,a-=o}a>=Zt&&!this.wouldOverlap(s.id,r,a)&&_n(s.id,{x:r,width:a})}else if(this.dragging.type==="right"){let r=this.dragging.originalWidth+t;r<Zt&&(r=Zt),s.x+r>this.worldWidth&&(r=this.worldWidth-s.x),s.x+r>i.maxRight&&(r=i.maxRight-s.x),r>=Zt&&!this.wouldOverlap(s.id,s.x,r)&&_n(s.id,{width:r})}else if(this.dragging.type==="move"){let r=this.dragging.originalX+t;const a=s.width;if(r<0&&(r=0),r+a>this.worldWidth&&(r=this.worldWidth-a),!this.wouldOverlap(s.id,r,a))_n(s.id,{x:r});else{const o=this.findNonOverlappingPosition(s.id,r,a);o!==null&&_n(s.id,{x:o})}}}findNonOverlappingPosition(e,t,s){const i=this.currentZones.filter(u=>u.id!==e).sort((u,h)=>u.x-h.x);if(i.length===0)return Math.max(0,Math.min(t,this.worldWidth-s));let r=t,a=1/0;const o=i[0];if(o.x>=s){const u=o.x-s,h=Math.max(0,Math.min(t,u)),f=Math.abs(h-t);f<a&&(a=f,r=h)}for(let u=0;u<i.length-1;u++){const h=i[u],f=i[u+1],p=h.x+h.width,m=f.x;if(m-p>=s){const w=p,g=m-s,b=Math.max(w,Math.min(t,g)),y=Math.abs(b-t);y<a&&(a=y,r=b)}}const c=i[i.length-1],d=c.x+c.width;if(this.worldWidth-d>=s){const u=d,h=this.worldWidth-s,f=Math.max(u,Math.min(t,h)),p=Math.abs(f-t);p<a&&(a=p,r=f)}return a<1/0&&!this.wouldOverlap(e,r,s)?r:null}handlePointerUp(e){if(this.dragging&&(this.stopAutoScroll(),this.scene.data.set("isDraggingItem",!1),In(!1),this.dragging=null),this.pendingZoneSelection){let i=Date.now()-this.pendingZoneSelection.startTime<this.TAP_MAX_DURATION;i&&e&&e.worldX!==void 0&&(i=Math.abs(e.worldX-this.pendingZoneSelection.worldX)<this.TAP_MAX_DISTANCE),i&&Bn(this.pendingZoneSelection.zoneId),this.pendingZoneSelection=null}if(this.pendingTap&&this.currentEditMode==="dialogs"){if(Date.now()-this.pendingTap.startTime<this.TAP_MAX_DURATION){let i=!0;e&&e.worldX!==void 0&&(i=Math.abs(e.worldX-this.pendingTap.worldX)<this.TAP_MAX_DISTANCE),i&&this.showTempAddButton(this.pendingTap.worldX,this.pendingTap.worldY)}this.pendingTap=null}}handlePointerDown(e){if(un()||this.currentEditMode!=="dialogs"||this.dragging)return;const t=e.downElement;if(t&&t.tagName?.toUpperCase()!=="CANVAS")return;const s=e.worldX;for(const o of this.currentZones)if(s>=o.x&&s<=o.x+o.width)return;const i=Date.now(),r=i-this.lastClickTime,a=Math.abs(s-this.lastClickX);if(r<this.DOUBLE_CLICK_THRESHOLD&&a<this.DOUBLE_CLICK_DISTANCE){this.createZoneAtPosition(s),this.lastClickTime=0,this.hideTempAddButton();return}this.lastClickTime=i,this.lastClickX=s,this.pendingTap={worldX:s,worldY:e.worldY,startTime:i},this.currentSelectedId&&Bn(null)}showTempAddButton(e,t){const s=this.scene.cameras.main,{screenX:i,screenY:r}=en(e,t,s);Ge.emit(Oe.TEMP_ZONE_BUTTON_SHOW,{screenX:i,screenY:r,worldX:e})}hideTempAddButton(){Ge.emit(Oe.TEMP_ZONE_BUTTON_HIDE,{})}createZoneAtPosition(e){this.createZoneAt(e)}createNewZone(){const e=this.scene.cameras.main,t=e.worldView.x+e.worldView.width/2;this.createZoneAt(t)}createZoneAt(e){let t=e-mr/2;const s=mr;if(t=Math.max(0,Math.min(this.worldWidth-s,t)),this.wouldOverlap("",t,s)){const r=this.findNonOverlappingPosition("",t,s);if(r===null){console.warn("No room for a new dialog zone");return}t=r}const i=Pl(t,s);i.x=t,Cc(i),Bn(i.id)}updateSelectionVisuals(){if(this.currentEditMode!=="dialogs"){gs(null);return}if(!this.currentSelectedId){gs(null);return}const e=this.currentZones.find(a=>a.id===this.currentSelectedId);if(!e){gs(null);return}const t=this.scene.cameras.main,s=e.x+e.width/2,{screenX:i}=en(s,0,t),r=t.height*.65;gs({screenX:i,screenY:r})}destroy(){this.hideTempAddButton();for(const e of this.unsubscribers)e();this.unsubscribers=[],this.createZoneSubscription&&this.createZoneSubscription.unsubscribe(),this.createZoneAtSubscription&&this.createZoneAtSubscription.unsubscribe(),this.stopAutoScroll(),this.scene.input.off("pointerdown",this.handlePointerDown,this),this.scene.input.off("pointermove",this.handlePointerMove,this),this.scene.input.off("pointerup",this.handlePointerUp,this),window.removeEventListener("pointerup",this.boundWindowPointerUp),window.removeEventListener("pointermove",this.boundWindowPointerMove),this.clearVisuals(),this.graphics&&(this.graphics.destroy(),this.graphics=null),this.dragging=null}}class _d extends Y.Scene{parallaxLayers=null;cameraController;playerController;gridOverlay;itemsController;framesController;socialsController;dialogZoneRenderer;config;minimapSubscription;isShuttingDown=!1;get itemManager(){return this.itemsController?.getManager()}resetZoom(){this.cameraController?.resetToFit()}constructor(){super({key:vt.BUILDER})}init(e){this.config=e.config}preload(){ka(this),ks.preloadAssets(this),gr.preloadAssets(this),pr.preloadAssets(this)}create(){this.isShuttingDown=!1,this.initializeScene()}initializeScene(){Pa(this),this.physics.world.setBounds(0,0,this.config.worldWidth,this.config.worldHeight);const e=this.config.worldHeight-An;this.cameraController=new cd(this,this.config.worldWidth,this.config.worldHeight),this.playerController=new ud(this,this.config.worldWidth,this.config.worldHeight),this.gridOverlay=new hd(this,this.config.worldWidth,this.config.worldHeight),this.itemsController=new gd(this,e,this.config.worldWidth,this.config.worldHeight),this.framesController=new gr(this,this.config.worldWidth,this.config.worldHeight),this.socialsController=new pr(this,this.config.worldWidth,this.config.worldHeight),this.dialogZoneRenderer=new vd(this,this.config.worldWidth,this.config.worldHeight),this.createBackground(),this.gridOverlay.create(),this.createGroundReference(),this.playerController.create(this.config.playerStartX,this.config.playerStartY),this.itemsController.create(this.config.placedItems||[]),this.framesController.create(this.config.placedFrames||[]),this.socialsController.create(this.config.placedSocials||[]),this.dialogZoneRenderer.create(),this.cameraController.setup(),this.cameraController.centerOn(this.config.playerStartX,this.config.playerStartY),this.minimapSubscription=Ge.on(Oe.MINIMAP_NAVIGATE,t=>{this.navigateToPosition(t.worldX,t.worldY)}),this.scale.on("resize",this.handleResize,this),this.events.on("shutdown",this.shutdown,this)}async createBackground(){const e=ts.getCurrentConfig();try{await Aa(this,e)}catch(t){console.error("Failed to load background:",t);return}this.parallaxLayers&&(Jl(this.parallaxLayers),this.parallaxLayers=null),this.parallaxLayers=Ma(this,this.config.worldWidth,this.config.worldHeight,e)}createGroundReference(){as.createVisualGround(this,{worldWidth:this.config.worldWidth,worldHeight:this.config.worldHeight,height:An})}update(){this.parallaxLayers&&$a(this.parallaxLayers,this.cameras.main),this.itemManager?.updateSelectionVisuals(),this.framesController?.updateSelectionVisuals(),this.socialsController?.updateSelectionVisuals(),this.dialogZoneRenderer?.updateSelectionVisuals();const e=this.cameras.main,t=this.data.get("playerSprite");Ic({scrollX:e.worldView.x,scrollY:e.worldView.y,viewWidth:e.width,viewHeight:e.height,worldWidth:this.config.worldWidth,worldHeight:this.config.worldHeight,zoom:e.zoom,playerX:t?.x??this.config.playerStartX,playerY:t?.y??this.config.playerStartY})}navigateToPosition(e,t){this.cameraController.centerOn(e,t)}handleResize(e){!this.cameras?.main||!this.config||(this.cameraController?.handleResize(),this.gridOverlay&&this.gridOverlay.redraw())}shutdown(){this.isShuttingDown||(this.isShuttingDown=!0,this.scale.off("resize",this.handleResize,this),this.minimapSubscription&&this.minimapSubscription.unsubscribe(),this.cameraController&&this.cameraController.destroy(),this.playerController&&this.playerController.destroy(),this.gridOverlay&&this.gridOverlay.destroy(),this.itemsController&&this.itemsController.destroy(),this.framesController&&this.framesController.destroy(),this.socialsController&&this.socialsController.destroy(),this.dialogZoneRenderer&&this.dialogZoneRenderer.destroy())}}const bd="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(bd);To();class yd{currentLanguage="cs";setLanguage(e){this.currentLanguage=e,localStorage.setItem("language",e)}getLanguage(){const e=localStorage.getItem("language");return(e==="cs"||e==="en")&&(this.currentLanguage=e),this.currentLanguage}toggleLanguage(){return this.currentLanguage=this.currentLanguage==="cs"?"en":"cs",this.setLanguage(this.currentLanguage),this.currentLanguage}}const to=new yd;let pt=null;function wd(n){pt=n}function Sd(){if(!pt)return console.error("Scene manager not initialized"),null;try{return pt.scene.getScene(vt.GAME)?.mapConfig||null}catch(n){return console.error("Failed to get map config:",n),null}}function Ed(n){if(!pt)return console.error("Scene manager not initialized"),!1;try{return pt.scene.getScene(vt.GAME)?(pt.scene.stop(vt.GAME),Sc(n),pt.scene.start(vt.BUILDER,{config:n}),!0):(console.error("GameScene not found"),!1)}catch(e){return console.error("Failed to switch to builder:",e),!1}}function xd(){if(console.log("[SceneManager] switchToGame called"),!pt)return console.error("Scene manager not initialized"),!1;try{return console.log("[SceneManager] Stopping builder scene..."),pt.scene.stop(vt.BUILDER),console.log("[SceneManager] Exiting builder mode..."),Ec(),console.log("[SceneManager] Starting game scene..."),pt.scene.start(vt.GAME,{useBuilderConfig:!0}),console.log("[SceneManager] switchToGame completed successfully"),!0}catch(n){return console.error("Failed to switch to game:",n),!1}}function Id(){if(!pt){console.error("Scene manager not initialized");return}try{pt.scene.start(vt.GAME)}catch(n){console.error("Failed to start game scene:",n)}}var Cd=F('<button class="close-btn svelte-yrmttr" title="Close">Ã</button>'),Td=F('<div class="resize-handle resize-handle-nw svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M9 9L1 1M5 1L1 1L1 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" fill="none"></path></svg></div>  <div class="resize-handle resize-handle-ne svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M1 9L9 1M5 1L9 1L9 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" fill="none"></path></svg></div>  <div class="resize-handle resize-handle-sw svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M9 1L1 9M1 5L1 9L5 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" fill="none"></path></svg></div>  <div class="resize-handle resize-handle-se svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M1 1L9 9M9 5L9 9L5 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" fill="none"></path></svg></div>',1),Dd=F("<div><!></div> <!>",1),kd=F('<div data-ui=""><div class="panel-header svelte-yrmttr"><span class="panel-title svelte-yrmttr"> </span> <!> <div class="header-buttons svelte-yrmttr"><button class="minimize-btn svelte-yrmttr"> </button> <!></div></div> <!></div>');function Rn(n,e){we(e,!0);const t=()=>L(Vt,"$isDraggingInBuilder",s),[s,i]=He();let r=1e3,a=he(e,"initialRight",3,10),o=he(e,"initialTop",3,60),c=he(e,"width",3,280),d=he(e,"minWidth",3,200),u=he(e,"minHeight",3,100),h=he(e,"maxWidth",3,600),f=he(e,"maxHeight",3,800),p=he(e,"resizable",3,!1),m=he(e,"startMinimized",3,!1),S=he(e,"showClose",3,!1),w=K(Je(m())),g=K(!1),b=K(Je({x:0,y:0})),y=K(Je({width:c(),height:e.height??0})),v=K(!1),_=K(!1),x=K("se"),C=K(Je({x:0,y:0})),T=K(null),A=K(!1),I=K(Je(r)),D=K(null),P=K("");function O(){r++,$(I,r,!0)}function G(R,W,ie){let $e=R;const Qe=window.innerWidth-ie-10;$e>Qe&&($e=Math.max(10,Qe)),$e<10&&($e=10);let We=W;const yt=window.innerHeight-40;return We>yt&&(We=Math.max(10,yt)),We<10&&(We=10),{x:$e,y:We}}Re(()=>{if(typeof window>"u"||l(A))return;const R=localStorage.getItem(`panel-state-${e.panelId}`);if(R)try{const W=JSON.parse(R),ie=p()&&W.width?W.width:c(),pe=G(W.x,W.y,ie);$(b,pe,!0),p()&&W.width&&W.height&&$(y,{width:W.width,height:W.height},!0);const ye=p()?{x:pe.x,y:pe.y,width:l(y).width,height:l(y).height}:{x:pe.x,y:pe.y};$(P,JSON.stringify(ye),!0)}catch{$(b,{x:window.innerWidth-c()-a(),y:o()},!0)}else $(b,{x:window.innerWidth-c()-a(),y:o()},!0);$(A,!0)}),Re(()=>{if(!l(A))return;const R=p()?{x:l(b).x,y:l(b).y,width:l(y).width,height:l(y).height}:{x:l(b).x,y:l(b).y},W=JSON.stringify(R);W!==l(P)&&($(P,W,!0),localStorage.setItem(`panel-state-${e.panelId}`,W))}),Re(()=>{if(!l(A))return;function R(){if(!l(T))return;const W=p()?l(y).width:c();let ie=l(b).x,pe=l(b).y,ye=!1;const $e=window.innerWidth-W;l(b).x>$e&&(ie=Math.max(10,$e),ye=!0);const Qe=window.innerHeight-40;l(b).y>Qe&&(pe=Math.max(10,Qe),ye=!0),l(b).x<0&&(ie=10,ye=!0),l(b).y<0&&(pe=10,ye=!0),ye&&$(b,{x:ie,y:pe},!0)}return window.addEventListener("resize",R),()=>{window.removeEventListener("resize",R)}});function Z(){$(w,!l(w))}function H(){e.onclose?.()}function J(){if(p())if(l(g))l(D)&&($(b,{x:l(D).x,y:l(D).y},!0),$(y,{width:l(D).width,height:l(D).height},!0),$(D,null)),$(g,!1);else{$(D,{x:l(b).x,y:l(b).y,width:l(y).width,height:l(y).height},!0);const R=20,W=Math.min(h(),window.innerWidth-R*2),ie=Math.min(f(),window.innerHeight-R*2),pe=Math.max(R,(window.innerWidth-W)/2),ye=Math.max(R,(window.innerHeight-ie)/2);$(b,{x:pe,y:ye},!0),$(y,{width:W,height:ie},!0),$(g,!0)}}function te(R){R.target.closest("button")||J()}function ke(R){R.target.closest("button")||($(v,!0),$(C,{x:R.clientX-l(b).x,y:R.clientY-l(b).y},!0),R.currentTarget.setPointerCapture(R.pointerId),R.preventDefault())}function Ee(R){if(!l(v))return;const W=R.clientX-l(C).x,ie=R.clientY-l(C).y,pe=window.innerWidth-(l(T)?.offsetWidth??c()),ye=window.innerHeight-40;$(b,{x:Math.max(0,Math.min(W,pe)),y:Math.max(0,Math.min(ie,ye))},!0)}function Pe(R){l(v)&&($(v,!1),R.currentTarget.releasePointerCapture(R.pointerId))}function Ae(R){return W=>{p()&&($(_,!0),$(x,R,!0),W.currentTarget.setPointerCapture(W.pointerId),W.preventDefault(),W.stopPropagation())}}function X(R){if(!l(_)||!l(T))return;const W=l(T).getBoundingClientRect();let ie,pe,ye=l(b).x,$e=l(b).y;const Qe=l(x)==="se"||l(x)==="ne",We=l(x)==="se"||l(x)==="sw";Qe?ie=R.clientX-W.left:(ie=W.right-R.clientX,ye=R.clientX),We?pe=R.clientY-W.top:(pe=W.bottom-R.clientY,$e=R.clientY);const yt=Math.max(d(),Math.min(h(),ie)),j=Math.max(u(),Math.min(f(),pe));Qe||(ye=W.right-yt,ye<0&&(ye=0)),We||($e=W.bottom-j,$e<0&&($e=0));const Ie=Qe?window.innerWidth-l(b).x-10:W.right-10,ce=We?window.innerHeight-l(b).y-10:W.bottom-10,Le=Math.min(yt,Ie),me=Math.min(j,ce);$(y,{width:Le,height:me},!0);let Ze=!1,je=l(b).x,fn=l(b).y;!Qe&&ie>=d()&&(je=Math.max(0,ye),Ze=!0),!We&&pe>=u()&&(fn=Math.max(0,$e),Ze=!0),Ze&&$(b,{x:je,y:fn},!0)}function Q(R){l(_)&&($(_,!1),R.currentTarget.releasePointerCapture(R.pointerId))}function Te(R){R.stopPropagation()}var re=kd();let Me;re.__pointerdown=R=>{O(),Te(R)},re.__click=Te;var be=M(re);be.__pointerdown=ke,be.__pointermove=Ee,be.__pointerup=Pe,be.__dblclick=te;var le=M(be),fe=M(le),ne=k(le,2);{var ge=R=>{var W=Fe(),ie=de(W);Pn(ie,()=>e.headerExtra),E(R,W)};V(ne,R=>{e.headerExtra&&R(ge)})}var xe=k(ne,2),Ne=M(xe);Ne.__click=Z;var ct=M(Ne),rt=k(Ne,2);{var jt=R=>{var W=Cd();W.__click=H,E(R,W)};V(rt,R=>{S()&&R(jt)})}var Fn=k(be,2);{var Nt=R=>{var W=Dd(),ie=de(W);let pe;var ye=M(ie);Pn(ye,()=>e.children);var $e=k(ie,2);{var Qe=We=>{var yt=Td(),j=de(yt),Ie=N(()=>Ae("nw"));j.__pointerdown=function(...qt){l(Ie)?.apply(this,qt)},j.__pointermove=X,j.__pointerup=Q;var ce=k(j,2),Le=N(()=>Ae("ne"));ce.__pointerdown=function(...qt){l(Le)?.apply(this,qt)},ce.__pointermove=X,ce.__pointerup=Q;var me=k(ce,2),Ze=N(()=>Ae("sw"));me.__pointerdown=function(...qt){l(Ze)?.apply(this,qt)},me.__pointermove=X,me.__pointerup=Q;var je=k(me,2),fn=N(()=>Ae("se"));je.__pointerdown=function(...qt){l(fn)?.apply(this,qt)},je.__pointermove=X,je.__pointerup=Q,ft("pointercancel",j,Q),ft("pointercancel",ce,Q),ft("pointercancel",me,Q),ft("pointercancel",je,Q),E(We,yt)};V($e,We=>{p()&&We(Qe)})}B(()=>pe=De(ie,1,"panel-body svelte-yrmttr",null,pe,{"has-fixed-height":p()&&l(y).height>0})),E(R,W)};V(Fn,R=>{l(w)||R(Nt)})}Ut(re,R=>$(T,R),()=>l(T)),B(()=>{Me=De(re,1,"draggable-panel svelte-yrmttr",null,Me,{minimized:l(w),maximized:l(g),dragging:l(v),resizing:l(_),resizable:p()}),ue(re,`left: ${l(b).x??""}px; top: ${l(b).y??""}px; width: ${l(w)?"auto":`${p()?l(y).width:c()}px`}; ${p()&&l(y).height>0&&!l(w)?`height: ${l(y).height}px;`:""}${t()?" pointer-events: none;":""} z-index: ${l(I)??""};`),Ce(fe,e.title),U(Ne,"title",l(w)?"Expand":"Minimize"),Ce(ct,l(w)?"â²":"â¼")}),ft("pointercancel",be,Pe),E(n,re),Se(),i()}bt(["pointerdown","click","pointermove","pointerup","dblclick"]);const Sr=10,Pd=150,Ad=`
  position: fixed;
  pointer-events: none;
  z-index: 10000;
  opacity: 0.9;
  image-rendering: pixelated;
  filter: drop-shadow(3px 3px 0 rgba(0, 0, 0, 0.5));
  background: rgba(26, 26, 46, 0.9);
`,Md=`
  width: 100%;
  height: 100%;
  object-fit: contain;
  image-rendering: pixelated;
`;function Wi(n,e,t){const{previewSize:s,borderColor:i,dataKey:r,eventName:a,onDrop:o}=n,c=s/2,d={startX:0,startY:0,hasMoved:!1,isActivated:!1,pendingKey:null,pendingTarget:null,longPressTimer:null};function u(I,D,P){Ge.emit(a,{[r]:I,canvasX:D,canvasY:P}),o?.()}function h(I,D){const P=document.querySelector("canvas");if(!P)return null;const O=P.getBoundingClientRect();return I>=O.left&&I<=O.right&&D>=O.top&&D<=O.bottom?{canvasX:I-O.left,canvasY:D-O.top}:null}function f(I,D,P){const O=document.createElement("div");return O.className="touch-drag-preview",O.innerHTML=`<img src="${I}" alt="" />`,O.style.cssText=`
      ${Ad}
      top: ${P-c}px;
      left: ${D-c}px;
      width: ${s}px;
      height: ${s}px;
      border: 2px solid ${i};
    `,O.querySelector("img").style.cssText=Md,document.body.appendChild(O),O}function p(I,D,P){I.style.top=`${P-c}px`,I.style.left=`${D-c}px`}function m(){d.longPressTimer&&(clearTimeout(d.longPressTimer),d.longPressTimer=null),d.pendingKey=null,d.pendingTarget=null,d.isActivated=!1,d.hasMoved=!1}function S(){m();const I=e();I.touchDragElement&&(I.touchDragElement.remove(),t({touchDragElement:null})),t({draggedKey:null}),fs(!1)}function w(I,D){if(!I.dataTransfer)return;t({draggedKey:D}),fs(!0),I.dataTransfer.effectAllowed="copy",I.dataTransfer.setData(r,D);const O=I.target.querySelector("img")?.cloneNode(!0);O&&(O.style.cssText="position: absolute; top: -1000px;",document.body.appendChild(O),I.dataTransfer.setDragImage(O,c,c),requestAnimationFrame(()=>O.remove()))}function g(){t({draggedKey:null}),fs(!1)}function b(I){I.preventDefault(),I.dataTransfer&&(I.dataTransfer.dropEffect="copy")}function y(I){I.preventDefault();const D=I.dataTransfer?.getData(r);if(!D)return;const P=h(I.clientX,I.clientY);P&&u(D,P.canvasX,P.canvasY)}function v(I,D){if(!d.pendingKey||!d.pendingTarget||d.isActivated)return;d.isActivated=!0,t({draggedKey:d.pendingKey}),fs(!0);const P=d.pendingTarget.querySelector("img");if(P){const O=f(P.src,I,D);t({touchDragElement:O})}}function _(I,D){if(I.touches.length!==1)return;const P=I.touches[0];d.startX=P.clientX,d.startY=P.clientY,d.hasMoved=!1,d.isActivated=!1,d.pendingKey=D,d.pendingTarget=I.currentTarget,d.longPressTimer=setTimeout(()=>{d.pendingKey&&!d.hasMoved&&v(P.clientX,P.clientY)},Pd)}function x(I){const D=I.touches[0],P=D.clientX-d.startX,O=D.clientY-d.startY;if(!d.hasMoved&&(Math.abs(P)>Sr||Math.abs(O)>Sr)&&(d.hasMoved=!0,!d.isActivated)){if(Math.abs(O)>Math.abs(P)){m();return}v(D.clientX,D.clientY)}const G=e();d.isActivated&&G.touchDragElement&&(p(G.touchDragElement,D.clientX,D.clientY),I.preventDefault())}function C(I){const D=e(),P=d.isActivated,O=D.draggedKey;if(P&&O&&d.hasMoved){const G=I.changedTouches[0],Z=h(G.clientX,G.clientY);Z&&u(O,Z.canvasX,Z.canvasY)}S()}function T(){const I=document.querySelector("canvas");return I?(I.addEventListener("dragover",b),I.addEventListener("drop",y),()=>{I.removeEventListener("dragover",b),I.removeEventListener("drop",y)}):()=>{}}function A(){return document.addEventListener("touchmove",x,{passive:!1}),document.addEventListener("touchend",C),document.addEventListener("touchcancel",C),()=>{document.removeEventListener("touchmove",x),document.removeEventListener("touchend",C),document.removeEventListener("touchcancel",C)}}return{onDragStart:w,onDragEnd:g,onTouchStart:_,setupCanvasListeners:T,setupTouchListeners:A}}var $d=F('<span class="palette-hint svelte-ntcafk">Drag to place</span>'),Ld=F('<div data-ui="" draggable="true" role="button" tabindex="0"><img class="item-preview svelte-ntcafk"/></div>'),Od=F('<div class="palette-content svelte-ntcafk" role="toolbar" tabindex="-1"><div class="palette-grid svelte-ntcafk"></div></div>');function Rd(n,e){we(e,!0);const t=()=>L(an,"$isItemPaletteOpen",i),s=()=>L(Ve,"$builderEditMode",i),[i,r]=He(),a="#4a90e2",o=600,c=Xi;function d(){return window.innerWidth<o}function u(){d()&&an.set(!1)}let h=K(null),f=K(null);const p=Wi({previewSize:48,borderColor:a,dataKey:"assetKey",eventName:Oe.ASSET_DROPPED,onDrop:u},()=>({draggedKey:l(h),touchDragElement:l(f)}),v=>{"draggedKey"in v&&$(h,v.draggedKey??null,!0),"touchDragElement"in v&&$(f,v.touchDragElement??null,!0)});function m(v){v.stopPropagation()}function S(){an.set(!1)}function w(v){const _=document.querySelector("canvas");if(!_)return;const x=_.getBoundingClientRect(),C=x.width/2,T=x.height/2;Ge.emit(Oe.ASSET_DROPPED,{assetKey:v,canvasX:C,canvasY:T}),u()}us(()=>p.setupCanvasListeners()),Re(()=>p.setupTouchListeners());var g=Fe(),b=de(g);{var y=v=>{Rn(v,{panelId:"item-palette",title:"Items",initialRight:10,initialTop:60,width:280,height:400,minWidth:200,minHeight:160,maxWidth:500,maxHeight:600,resizable:!0,showClose:!0,onclose:S,headerExtra:x=>{var C=$d();E(x,C)},children:(x,C)=>{var T=Od();T.__pointerdown=m;var A=M(T);tt(A,21,()=>c,ot,(I,D)=>{var P=Ld();let O;P.__touchstart=Z=>p.onTouchStart(Z,l(D).key),P.__dblclick=()=>w(l(D).key),ue(P,"",{},{"--accent-color":a});var G=M(P);B(()=>{O=De(P,1,"palette-item svelte-ntcafk",null,O,{dragging:l(h)===l(D).key}),U(P,"title",`${l(D).name??""} (double-click to place)`),U(G,"src",l(D).path),U(G,"alt",l(D).name)}),ft("dragstart",P,Z=>p.onDragStart(Z,l(D).key)),ft("dragend",P,function(...Z){p.onDragEnd?.apply(this,Z)}),E(I,P)}),E(x,T)},$$slots:{headerExtra:!0,default:!0}})};V(b,v=>{t()&&s()==="items"&&v(y)})}E(n,g),Se(),r()}bt(["pointerdown","touchstart","dblclick"]);var Fd=F('<span class="palette-hint svelte-jnw59q">Drag to place</span>'),Hd=F('<div data-ui="" draggable="true" role="button" tabindex="0"><img class="item-preview svelte-jnw59q"/></div>'),Xd=F('<div class="palette-content svelte-jnw59q" role="toolbar" tabindex="-1"><div class="palette-grid svelte-jnw59q"></div></div>');function Nd(n,e){we(e,!0);const t=()=>L(tn,"$isFramePaletteOpen",i),s=()=>L(Ve,"$builderEditMode",i),[i,r]=He(),a="#9b59b6",o=Ps;let c=K(null),d=K(null);const u=Wi({previewSize:64,borderColor:a,dataKey:"frameKey",eventName:Oe.FRAME_DROPPED,onDrop:()=>{tn.set(!1)}},()=>({draggedKey:l(c),touchDragElement:l(d)}),g=>{"draggedKey"in g&&$(c,g.draggedKey??null,!0),"touchDragElement"in g&&$(d,g.touchDragElement??null,!0)});function h(g){g.stopPropagation()}function f(){tn.set(!1)}function p(g){const b=document.querySelector("canvas");if(!b)return;const y=b.getBoundingClientRect(),v=y.width/2,_=y.height/2;Ge.emit(Oe.FRAME_DROPPED,{frameKey:g,canvasX:v,canvasY:_}),tn.set(!1)}us(()=>u.setupCanvasListeners()),Re(()=>u.setupTouchListeners());var m=Fe(),S=de(m);{var w=g=>{Rn(g,{panelId:"frame-palette",title:"Frames",initialRight:10,initialTop:60,width:320,height:400,minWidth:220,minHeight:200,maxWidth:600,maxHeight:600,resizable:!0,showClose:!0,onclose:f,headerExtra:y=>{var v=Fd();E(y,v)},children:(y,v)=>{var _=Xd();_.__pointerdown=h;var x=M(_);tt(x,21,()=>o,ot,(C,T)=>{var A=Hd();let I;A.__touchstart=P=>u.onTouchStart(P,l(T).key),A.__dblclick=()=>p(l(T).key),ue(A,"",{},{"--accent-color":a});var D=M(A);B(()=>{I=De(A,1,"palette-item svelte-jnw59q",null,I,{dragging:l(c)===l(T).key}),U(A,"title",`${l(T).name??""} (double-click to place)`),U(D,"src",l(T).path),U(D,"alt",l(T).name)}),ft("dragstart",A,P=>u.onDragStart(P,l(T).key)),ft("dragend",A,function(...P){u.onDragEnd?.apply(this,P)}),E(C,A)}),E(y,_)},$$slots:{headerExtra:!0,default:!0}})};V(S,g=>{t()&&s()==="frames"&&g(w)})}E(n,m),Se(),r()}bt(["pointerdown","touchstart","dblclick"]);var Wd=F('<span class="palette-hint svelte-whpd9j">Drag to place</span>'),Zd=F('<div data-ui="" draggable="true" role="button" tabindex="0"><img class="item-preview svelte-whpd9j"/> <span class="item-name svelte-whpd9j"> </span></div>'),Yd=F('<div class="palette-content svelte-whpd9j" role="toolbar" tabindex="-1"><div class="palette-grid svelte-whpd9j"></div></div>');function Bd(n,e){we(e,!0);const t=()=>L(nn,"$isSocialPaletteOpen",i),s=()=>L(Ve,"$builderEditMode",i),[i,r]=He(),a=On.SOCIAL.css,o=As;let c=K(null),d=K(null);const u=Wi({previewSize:64,borderColor:a,dataKey:"socialKey",eventName:Oe.SOCIAL_DROPPED,onDrop:()=>{nn.set(!1)}},()=>({draggedKey:l(c),touchDragElement:l(d)}),g=>{"draggedKey"in g&&$(c,g.draggedKey??null,!0),"touchDragElement"in g&&$(d,g.touchDragElement??null,!0)});function h(g){g.stopPropagation()}function f(){nn.set(!1)}function p(g){const b=document.querySelector("canvas");if(!b)return;const y=b.getBoundingClientRect(),v=y.width/2,_=y.height/2;Ge.emit(Oe.SOCIAL_DROPPED,{socialKey:g,canvasX:v,canvasY:_}),nn.set(!1)}us(()=>u.setupCanvasListeners()),Re(()=>u.setupTouchListeners());var m=Fe(),S=de(m);{var w=g=>{Rn(g,{panelId:"social-palette",title:"Socials",initialRight:10,initialTop:60,width:280,height:350,minWidth:200,minHeight:200,maxWidth:500,maxHeight:500,resizable:!0,showClose:!0,onclose:f,headerExtra:y=>{var v=Wd();E(y,v)},children:(y,v)=>{var _=Yd();_.__pointerdown=h;var x=M(_);tt(x,21,()=>o,ot,(C,T)=>{var A=Zd();let I;A.__touchstart=Z=>u.onTouchStart(Z,l(T).key),A.__dblclick=()=>p(l(T).key);let D;var P=M(A),O=k(P,2),G=M(O);B(()=>{I=De(A,1,"palette-item svelte-whpd9j",null,I,{dragging:l(c)===l(T).key}),U(A,"title",`${l(T).name??""} (double-click to place)`),D=ue(A,"",D,{"--accent-color":a}),U(P,"src",l(T).path),U(P,"alt",l(T).name),Ce(G,l(T).name)}),ft("dragstart",A,Z=>u.onDragStart(Z,l(T).key)),ft("dragend",A,function(...Z){u.onDragEnd?.apply(this,Z)}),E(C,A)}),E(y,_)},$$slots:{headerExtra:!0,default:!0}})};V(S,g=>{t()&&s()==="socials"&&g(w)})}E(n,m),Se(),r()}bt(["pointerdown","touchstart","dblclick"]);var zd=F("<button><!></button>");function oe(n,e){let t=he(e,"variant",3,"default"),s=he(e,"disabled",3,!1),i=he(e,"title",3,"");const r={default:{base:"#4a90e2",hover:"#357abd",active:"#2a5f8f"},green:{base:"#27ae60",hover:"#229954",active:"#1e8449"},blue:{base:"#3498db",hover:"#2980b9",active:"#21618c"},orange:{base:"#ffa500",hover:"#ff8c00",active:"#e67e00"},red:{base:"#e74c3c",hover:"#c0392b",active:"#a02e22"},purple:{base:"#9b59b6",hover:"#8e44ad",active:"#7d3c98"},cyan:{base:"#17a2b8",hover:"#138496",active:"#0f6674"},pink:{base:"#e91e8f",hover:"#c9177a",active:"#a31265"}},a=N(()=>r[t()]),o=N(()=>e.width?`--btn-width: ${e.width};`:"");var c=zd();let d;c.__click=function(...h){e.onclick?.apply(this,h)};var u=M(c);Pn(u,()=>e.children??mt),B(()=>{d=De(c,1,"pixel-btn svelte-lwc0vq",null,d,{disabled:s()}),ue(c,`${l(o)??""} --color-base: ${l(a).base??""}; --color-hover: ${l(a).hover??""}; --color-active: ${l(a).active??""}`),c.disabled=s(),U(c,"title",i())}),E(n,c)}bt(["click"]);var Kd=F("<button> </button>"),Gd=F('<div class="language-tabs svelte-ng6pis"></div>');function no(n,e){we(e,!0);let t=he(e,"accentColor",3,"#88ddff");var s=Gd();tt(s,21,()=>Ql,ot,(i,r)=>{var a=Kd();let o;a.__click=()=>e.onselect(l(r).code);let c;var d=M(a);B(()=>{o=De(a,1,"lang-tab svelte-ng6pis",null,o,{active:e.selectedLanguage===l(r).code}),c=ue(a,"",c,{"--accent-color":t()}),Ce(d,l(r).label)}),E(i,a)}),E(n,s),Se()}bt(["click"]);var Ud=F("<button></button>"),Vd=F('<div class="color-picker svelte-1jc3e0j"></div>'),jd=F('<div class="color-section svelte-1jc3e0j"><span class="color-label-title svelte-1jc3e0j"> </span> <button class="color-button svelte-1jc3e0j" title="Change color"><span class="color-preview svelte-1jc3e0j"></span> <span class="color-label svelte-1jc3e0j">Change</span></button> <!></div>');function pi(n,e){we(e,!0);let t=he(e,"label",3,"Color"),s=he(e,"accentColor",3,"#88ddff"),i=K(!1),r=K(null);Re(()=>{l(i)&&l(r)&&requestAnimationFrame(()=>{l(r)?.scrollIntoView({behavior:"smooth",block:"nearest"})})});function a(g){e.onselect(g)}function o(){$(i,!l(i))}var c=jd(),d=M(c),u=M(d),h=k(d,2);h.__click=o;let f;var p=M(h);let m;var S=k(h,2);{var w=g=>{var b=Vd();tt(b,21,()=>e.colors,ot,(y,v)=>{var _=Ud();let x;_.__click=()=>a(l(v));let C;B(()=>{x=De(_,1,"color-swatch svelte-1jc3e0j",null,x,{selected:e.selectedColor===l(v)}),U(_,"title",l(v)),C=ue(_,"",C,{background:l(v),"--accent-color":s()})}),E(y,_)}),Ut(b,y=>$(r,y),()=>l(r)),E(g,b)};V(S,g=>{l(i)&&g(w)})}B(()=>{Ce(u,t()),f=ue(h,"",f,{"--accent-color":s()}),m=ue(p,"",m,{background:e.selectedColor})}),E(n,c),Se()}bt(["click"]);const Er=50,xr=400,qd=400,Jd=70;var Qd=F('<div class="form-section svelte-jhtkop"><div class="form-group svelte-jhtkop"><label class="svelte-jhtkop"> </label> <input type="text" class="svelte-jhtkop"/></div> <div class="form-group svelte-jhtkop"><label class="svelte-jhtkop"> </label> <textarea rows="6" class="svelte-jhtkop"></textarea></div></div>');function eu(n,e){we(e,!0);let t=he(e,"titlePlaceholder",3,"Enter title..."),s=he(e,"contentPlaceholder",3,"Enter text..."),i=he(e,"idPrefix",3,"text-form"),r=he(e,"accentColor",3,"#88ddff");function a(b){const y=b.target;e.ontitlechange(y.value)}function o(b){const y=b.target;e.oncontentchange(y.value)}var c=Qd();let d;var u=M(c),h=M(u),f=M(h),p=k(h,2);p.__input=a;var m=k(u,2),S=M(m),w=M(S),g=k(S,2);g.__input=o,B(()=>{d=ue(c,"",d,{"--accent-color":r()}),U(h,"for",`${i()??""}-title`),Ce(f,`Title (max ${Er} chars)`),U(p,"id",`${i()??""}-title`),Jn(p,e.title),U(p,"placeholder",t()),U(p,"maxlength",Er),U(S,"for",`${i()??""}-content`),Ce(w,`Content (max ${xr} chars)`),U(g,"id",`${i()??""}-content`),Jn(g,e.content),U(g,"placeholder",s()),U(g,"maxlength",xr)}),E(n,c),Se()}bt(["input"]);var tu=F('<div class="panel-content svelte-zzlycq"><!> <!> <div class="panel-extras svelte-zzlycq"><!></div> <div class="panel-footer svelte-zzlycq"><!> <!></div></div>');function nu(n,e){we(e,!0);const t=()=>L(Pi,"$dialogZones",r),s=()=>L(Ws,"$selectedDialogZoneId",r),i=()=>L(Mi,"$isDialogZonePanelOpen",r),[r,a]=He(),o="#88ddff";let c=K(Je(La)),d=N(()=>t().find(v=>v.id===s())??null),u=N(()=>l(d)?.texts.find(v=>v.language===l(c))??null);function h(v){s()&&rr(s(),l(c),{title:v})}function f(v){s()&&rr(s(),l(c),{content:v})}function p(){s()&&(Ga(s()),sr())}function m(){sr()}function S(v){s()&&_n(s(),{color:v})}function w(v){$(c,v,!0)}var g=Fe(),b=de(g);{var y=v=>{Rn(v,{panelId:"dialog-zone-panel",title:"Dialog Zone",initialRight:10,initialTop:160,width:280,height:450,minWidth:250,minHeight:370,maxWidth:500,maxHeight:700,resizable:!0,showClose:!0,onclose:m,children:(_,x)=>{var C=tu(),T=M(C);no(T,{get selectedLanguage(){return l(c)},onselect:w,accentColor:o});var A=k(T,2);{let Z=N(()=>l(u)?.title??""),H=N(()=>l(u)?.content??"");eu(A,{get title(){return l(Z)},get content(){return l(H)},ontitlechange:h,oncontentchange:f,titlePlaceholder:"Enter title...",contentPlaceholder:"Enter dialog text...",idPrefix:"dialog",accentColor:o})}var I=k(A,2),D=M(I);pi(D,{get colors(){return ui},get selectedColor(){return l(d).color},onselect:S,label:"Zone Color",accentColor:o});var P=k(I,2),O=M(P);oe(O,{variant:"cyan",onclick:m,children:(Z,H)=>{var J=ae("CONFIRM");E(Z,J)},$$slots:{default:!0}});var G=k(O,2);oe(G,{variant:"red",onclick:p,children:(Z,H)=>{var J=ae("DELETE");E(Z,J)},$$slots:{default:!0}}),E(_,C)},$$slots:{default:!0}})};V(b,v=>{l(d)&&i()&&v(y)})}E(n,g),Se(),a()}var su=F("<button> </button>"),iu=F("<option> </option>"),ru=F("<button> </button>"),au=F('<a target="_blank" rel="noopener noreferrer" class="url-preview svelte-ds1z4d">Test link â</a>'),ou=F('<button><img class="svelte-ds1z4d"/></button>'),lu=F('<div class="style-picker svelte-ds1z4d"></div>'),cu=F('<div class="panel-content svelte-ds1z4d"><!> <div class="frame-size-row svelte-ds1z4d"><div class="frame-size-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Frame Size</span> <div class="size-buttons svelte-ds1z4d"></div></div> <div class="rotate-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Rotate</span> <button class="rotate-btn svelte-ds1z4d"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-ds1z4d"><path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg></button></div></div> <div class="panel-extras svelte-ds1z4d"><div class="text-section svelte-ds1z4d"><label for="frame-text" class="svelte-ds1z4d">Text</label> <textarea id="frame-text" placeholder="Enter text..." rows="3" class="svelte-ds1z4d"></textarea></div> <div class="size-rotation-row svelte-ds1z4d"><div class="size-section svelte-ds1z4d"><label for="text-size" class="svelte-ds1z4d">Text Size</label> <select id="text-size" class="svelte-ds1z4d"></select></div></div> <div class="text-align-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Text Alignment</span> <div class="align-buttons svelte-ds1z4d"></div></div> <div class="url-section svelte-ds1z4d"><label for="frame-url" class="svelte-ds1z4d">Link URL (opens on click)</label> <input id="frame-url" type="url" placeholder="https://example.com" class="svelte-ds1z4d"/> <!></div> <!> <!> <div class="style-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Frame Style</span> <button class="style-button svelte-ds1z4d" title="Change frame style"><img alt="Current frame" class="style-preview svelte-ds1z4d"/> <span class="style-label svelte-ds1z4d">Change Style</span></button> <!></div></div> <div class="panel-footer svelte-ds1z4d"><!> <!></div></div>');function du(n,e){we(e,!0);const t=()=>L(ki,"$builderPreviewLanguage",a),s=()=>L(fc,"$selectedFrame",a),i=()=>L(ns,"$selectedFrameId",a),r=()=>L(Hs,"$isFramePanelOpen",a),[a,o]=He(),c="#9b59b6";let d=N(t),u=N(s),h=N(()=>l(u)?.texts.find(H=>H.language===l(d))??null),f=N(()=>l(u)?Jc(l(u).scale??4):"M");function p(H){const J=H.target;if(!i()||!l(u))return;const te=l(u).texts.map(ke=>ke.language===l(d)?{...ke,text:J.value}:ke);te.some(ke=>ke.language===l(d))||te.push({language:l(d),text:J.value}),Et(i(),{texts:te})}function m(H){const J=H.target;i()&&Et(i(),{url:J.value||void 0})}function S(H){i()&&Et(i(),{backgroundColor:H})}function w(H){i()&&Et(i(),{textColor:H})}function g(H){const J=H.target;i()&&Et(i(),{textSize:parseInt(J.value,10)})}function b(H){i()&&Et(i(),{scale:qc(H)})}function y(H){i()&&Et(i(),{textAlign:H})}function v(){if(!i()||!l(u))return;const J=(l(u).rotation??0)===0?90:0;Et(i(),{rotation:J})}function _(){i()&&Fi(i())}function x(){rc(),zn(null)}function C(H){lc(H)}let T=K(!1),A=K(null),I=K(null);function D(H){i()&&Et(i(),{frameKey:H})}function P(){$(T,!l(T))}Re(()=>{l(T)&&l(A)&&requestAnimationFrame(()=>{l(A)?.scrollIntoView({behavior:"smooth",block:"nearest"})})}),Re(()=>{if(!l(T))return;function H(J){const te=J.target;l(A)&&!l(A).contains(te)&&l(I)&&!l(I).contains(te)&&$(T,!1)}return document.addEventListener("click",H),()=>document.removeEventListener("click",H)});var O=Fe(),G=de(O);{var Z=H=>{Rn(H,{panelId:"frame-panel",title:"Edit Frame",initialRight:10,initialTop:160,width:280,height:520,minWidth:250,minHeight:450,maxWidth:500,maxHeight:700,resizable:!0,showClose:!0,onclose:x,children:(J,te)=>{var ke=cu(),Ee=M(ke);no(Ee,{get selectedLanguage(){return l(d)},onselect:C,accentColor:c});var Pe=k(Ee,2),Ae=M(Pe),X=k(M(Ae),2);tt(X,21,()=>Object.entries(Ja),ot,(j,Ie)=>{var ce=N(()=>Ar(l(Ie),2));let Le=()=>l(ce)[0],me=()=>l(ce)[1].label;var Ze=su();let je;Ze.__click=()=>b(Le());var fn=M(Ze);B(()=>{je=De(Ze,1,"size-btn svelte-ds1z4d",null,je,{active:l(f)===Le()}),U(Ze,"title",me()),Ce(fn,Le())}),E(j,Ze)});var Q=k(Ae,2),Te=k(M(Q),2);Te.__click=v;var re=k(Pe,2),Me=M(re),be=k(M(Me),2);be.__input=p;var le=k(Me,2),fe=M(le),ne=k(M(fe),2);ne.__change=g,tt(ne,21,()=>Vc,ot,(j,Ie)=>{var ce=iu(),Le=M(ce),me={};B(()=>{Ce(Le,`${l(Ie)??""}px`),me!==(me=l(Ie))&&(ce.value=(ce.__value=l(Ie))??"")}),E(j,ce)});var ge;yl(ne);var xe=k(le,2),Ne=k(M(xe),2);tt(Ne,21,()=>jc,ot,(j,Ie)=>{let ce=()=>l(Ie).value,Le=()=>l(Ie).label;var me=ru();let Ze;me.__click=()=>y(ce());var je=M(me);B(()=>{Ze=De(me,1,"align-btn svelte-ds1z4d",null,Ze,{active:(l(u).textAlign??eo)===ce()}),U(me,"title",Le()),Ce(je,Le())}),E(j,me)});var ct=k(xe,2),rt=k(M(ct),2);rt.__input=m;var jt=k(rt,2);{var Fn=j=>{var Ie=au();B(()=>U(Ie,"href",l(u).url)),E(j,Ie)};V(jt,j=>{l(u).url&&j(Fn)})}var Nt=k(ct,2);{let j=N(()=>l(u).textColor??Qa);pi(Nt,{get colors(){return Uc},get selectedColor(){return l(j)},onselect:w,label:"Text Color",accentColor:c})}var R=k(Nt,2);pi(R,{get colors(){return Gc},get selectedColor(){return l(u).backgroundColor},onselect:S,label:"Background Color",accentColor:c});var W=k(R,2),ie=k(M(W),2);ie.__click=P;var pe=M(ie);Ut(ie,j=>$(I,j),()=>l(I));var ye=k(ie,2);{var $e=j=>{var Ie=lu();tt(Ie,21,()=>Ps,ot,(ce,Le)=>{var me=ou();let Ze;me.__click=()=>D(l(Le).key);var je=M(me);B(()=>{Ze=De(me,1,"style-item svelte-ds1z4d",null,Ze,{selected:l(u).frameKey===l(Le).key}),U(me,"title",l(Le).name),U(je,"src",l(Le).path),U(je,"alt",l(Le).name)}),E(ce,me)}),Ut(Ie,ce=>$(A,ce),()=>l(A)),E(j,Ie)};V(ye,j=>{l(T)&&j($e)})}var Qe=k(re,2),We=M(Qe);oe(We,{variant:"purple",onclick:x,children:(j,Ie)=>{var ce=ae("CONFIRM");E(j,ce)},$$slots:{default:!0}});var yt=k(We,2);oe(yt,{variant:"red",onclick:_,children:(j,Ie)=>{var ce=ae("DELETE");E(j,ce)},$$slots:{default:!0}}),B(j=>{U(Te,"title",l(u).rotation===90?"Portrait (click to rotate)":"Landscape (click to rotate)"),Jn(be,l(h)?.text??""),ge!==(ge=l(u).textSize??bs)&&(ne.value=(ne.__value=l(u).textSize??bs)??"",pa(ne,l(u).textSize??bs)),Jn(rt,l(u).url??""),U(pe,"src",j)},[()=>Ps.find(j=>j.key===l(u).frameKey)?.path??""]),E(J,ke)},$$slots:{default:!0}})};V(G,H=>{r()&&l(u)&&H(Z)})}E(n,O),Se(),o()}bt(["click","input","change"]);var uu=F("<button> </button>"),hu=F('<a target="_blank" rel="noopener noreferrer" class="url-preview svelte-1v3ae2c">Test link â</a>'),fu=F('<button><img class="svelte-1v3ae2c"/></button>'),gu=F('<div class="style-picker svelte-1v3ae2c"></div>'),pu=F('<div class="panel-content svelte-1v3ae2c"><div class="social-size-row svelte-1v3ae2c"><div class="social-size-section svelte-1v3ae2c"><span class="section-label svelte-1v3ae2c">Size</span> <div class="size-buttons svelte-1v3ae2c"></div></div></div> <div class="panel-extras svelte-1v3ae2c"><div class="url-section svelte-1v3ae2c"><label for="social-url" class="svelte-1v3ae2c">Link URL (opens on click)</label> <input id="social-url" type="url" placeholder="https://example.com" class="svelte-1v3ae2c"/> <!></div> <div class="style-section svelte-1v3ae2c"><span class="section-label svelte-1v3ae2c">Social Icon</span> <button class="style-button svelte-1v3ae2c" title="Change social icon"><img alt="Current social" class="style-preview svelte-1v3ae2c"/> <span class="style-label svelte-1v3ae2c"> </span></button> <!></div></div> <div class="panel-footer svelte-1v3ae2c"><!> <!></div></div>');function mu(n,e){we(e,!0);const t=()=>L(dc,"$selectedSocial",r),s=()=>L(ss,"$selectedSocialId",r),i=()=>L(Xs,"$isSocialPanelOpen",r),[r,a]=He(),o=On.SOCIAL.css;let c=N(t),d=N(()=>l(c)?ad(l(c).scale??Cn):"M"),u=N(()=>l(c)?As.find(C=>C.key===l(c).socialKey):null);function h(C){const T=C.target;s()&&_s(s(),{url:T.value||void 0})}function f(C){s()&&_s(s(),{scale:rd(C)})}function p(){s()&&Hi(s())}function m(){oc(),Kn(null)}let S=K(!1),w=K(null),g=K(null);function b(C){s()&&_s(s(),{socialKey:C})}function y(){$(S,!l(S))}Re(()=>{l(S)&&l(w)&&requestAnimationFrame(()=>{l(w)?.scrollIntoView({behavior:"smooth",block:"nearest"})})}),Re(()=>{if(!l(S))return;function C(T){const A=T.target;l(w)&&!l(w).contains(A)&&l(g)&&!l(g).contains(A)&&$(S,!1)}return document.addEventListener("click",C),()=>document.removeEventListener("click",C)});var v=Fe(),_=de(v);{var x=C=>{Rn(C,{panelId:"social-panel",title:"Edit Social",initialRight:10,initialTop:160,width:280,height:350,minWidth:250,minHeight:300,maxWidth:400,maxHeight:500,resizable:!0,showClose:!0,onclose:m,children:(T,A)=>{var I=pu(),D=M(I),P=M(D),O=k(M(P),2);tt(O,21,()=>Object.entries(rs),ot,(le,fe)=>{var ne=N(()=>Ar(l(fe),2));let ge=()=>l(ne)[0],xe=()=>l(ne)[1].label;var Ne=uu();let ct;Ne.__click=()=>f(ge());var rt=M(Ne);B(()=>{ct=De(Ne,1,"size-btn svelte-1v3ae2c",null,ct,{active:l(d)===ge()}),U(Ne,"title",xe()),Ce(rt,ge())}),E(le,Ne)});var G=k(D,2),Z=M(G),H=k(M(Z),2);H.__input=h;var J=k(H,2);{var te=le=>{var fe=hu();B(()=>U(fe,"href",l(c).url)),E(le,fe)};V(J,le=>{l(c).url&&le(te)})}var ke=k(Z,2),Ee=k(M(ke),2);Ee.__click=y;var Pe=M(Ee),Ae=k(Pe,2),X=M(Ae);Ut(Ee,le=>$(g,le),()=>l(g));var Q=k(Ee,2);{var Te=le=>{var fe=gu();tt(fe,21,()=>As,ot,(ne,ge)=>{var xe=fu();let Ne;xe.__click=()=>b(l(ge).key);var ct=M(xe);B(()=>{Ne=De(xe,1,"style-item svelte-1v3ae2c",null,Ne,{selected:l(c).socialKey===l(ge).key}),U(xe,"title",l(ge).name),U(ct,"src",l(ge).path),U(ct,"alt",l(ge).name)}),E(ne,xe)}),Ut(fe,ne=>$(w,ne),()=>l(w)),E(le,fe)};V(Q,le=>{l(S)&&le(Te)})}var re=k(G,2),Me=M(re);oe(Me,{variant:"pink",onclick:m,children:(le,fe)=>{var ne=ae("CONFIRM");E(le,ne)},$$slots:{default:!0}});var be=k(Me,2);oe(be,{variant:"red",onclick:p,children:(le,fe)=>{var ne=ae("DELETE");E(le,ne)},$$slots:{default:!0}}),B(()=>{ue(I,`--accent-color: ${o}`),Jn(H,l(c).url??""),U(Pe,"src",l(u)?.path??""),Ce(X,l(u)?.name??"Select")}),E(T,I)},$$slots:{default:!0}})};V(_,C=>{i()&&l(c)&&C(x)})}E(n,v),Se(),a()}bt(["click","input"]);var vu=F("<div> </div>"),_u=F('<div class="frame-content-layer svelte-1vp2oo0"></div>');function so(n,e){we(e,!0);const t=()=>L(Xa,"$placedFrames",d),s=()=>L(Oa,"$isBuilderMode",d),i=()=>L(Ri,"$builderCameraInfo",d),r=()=>L(xa,"$gameCameraInfo",d),a=()=>L(ki,"$builderPreviewLanguage",d),o=()=>L(Qn,"$currentLanguage",d),c=()=>L(Ai,"$draggingFramePositions",d),[d,u]=He();let h=N(t),f=N(()=>s()?i().scrollX:r().scrollX),p=N(()=>s()?i().scrollY:r().scrollY),m=N(()=>s()?i().zoom:r().zoom),S=N(()=>s()?a():o()),w=N(c);function g(_){const x=l(w).get(_.id);return x||{x:_.x,y:_.y}}function b(_){const x=_.scale??Rt,C=_.rotation===90,{textWidth:T,textHeight:A}=Gn(x,C),I=g(_),D=(I.x-l(f))*l(m),P=(I.y-l(p))*l(m);return{x:D,y:P,width:T*l(m),height:A*l(m)}}function y(_){return(_.texts.find(C=>C.language===l(S))||_.texts[0]||{text:""}).text||""}var v=_u();tt(v,21,()=>l(h),_=>_.id,(_,x)=>{const C=N(()=>b(l(x))),T=N(()=>y(l(x))),A=N(()=>(l(x).textSize??bs)*l(m)),I=N(()=>l(x).textColor??Qa),D=N(()=>l(x).textAlign??eo);var P=Fe(),O=de(P);{var G=Z=>{var H=vu();let J;var te=M(H);B(()=>{J=De(H,1,"frame-text svelte-1vp2oo0",null,J,{"align-top":l(D)==="top","align-center":l(D)==="center","align-bottom":l(D)==="bottom"}),ue(H,`
          left: ${l(C).x??""}px;
          top: ${l(C).y??""}px;
          width: ${l(C).width??""}px;
          height: ${l(C).height??""}px;
          font-size: ${l(A)??""}px;
          color: ${l(I)??""};
        `),Ce(te,l(T))}),E(Z,H)};V(O,Z=>{l(T)&&Z(G)})}E(_,P)}),E(n,v),Se(),u()}var bu=F('<div class="temp-zone-button svelte-130i47e"><!></div>');function yu(n,e){we(e,!0);const t=()=>L(Ri,"$builderCameraInfo",r),s=()=>L(Ve,"$builderEditMode",r),i=()=>L(Vt,"$isDraggingInBuilder",r),[r,a]=He();let o=K(null),c=null,d=null,u=K(null);function h(g){c&&clearTimeout(c),$(o,g,!0),$(u,t()?.scrollX??null,!0),c=setTimeout(()=>{$(o,null),$(u,null)},2e3)}function f(){l(o)&&(Ge.emit(Oe.DIALOG_ZONE_CREATE_AT,{worldX:l(o).worldX}),$(o,null),$(u,null),c&&(clearTimeout(c),c=null))}function p(){$(o,null),$(u,null),c&&(clearTimeout(c),c=null)}us(()=>{d=Ge.on(Oe.TEMP_ZONE_BUTTON_SHOW,h);const g=Ge.on(Oe.TEMP_ZONE_BUTTON_HIDE,p);return()=>{d?.unsubscribe(),g.unsubscribe()}}),Il(()=>{c&&clearTimeout(c)}),Re(()=>{s()!=="dialogs"&&($(o,null),$(u,null))}),Re(()=>{const g=t()?.scrollX;l(o)&&l(u)!==null&&g!==void 0&&Math.abs(g-l(u))>10&&($(o,null),$(u,null),c&&(clearTimeout(c),c=null))});var m=Fe(),S=de(m);{var w=g=>{var b=bu(),y=M(b);oe(y,{variant:"cyan",width:"90px",onclick:f,children:(v,_)=>{var x=ae("+ ZONE");E(v,x)},$$slots:{default:!0}}),B(()=>ue(b,`left: ${l(o).screenX??""}px; top: ${l(o).screenY-50}px;${i()?" pointer-events: none;":""}`)),E(g,b)};V(S,g=>{l(o)&&s()==="dialogs"&&g(w)})}E(n,m),Se(),a()}var wu=F('<div class="item-controls svelte-1is3rex"><div class="controls-row svelte-1is3rex"><!> <!> <!> <!></div></div>');function Su(n,e){we(e,!0);const t=()=>L($i,"$selectedItem",u),s=()=>L(Wa,"$selectedItemScreenPosition",u),i=()=>L(Ns,"$selectedItemId",u),r=()=>L(Ha,"$itemDepthLayer",u),a=()=>L(gc,"$selectedItemPhysicsEnabled",u),o=()=>L(pc,"$selectedItemFlipX",u),c=()=>L(Ve,"$builderEditMode",u),d=()=>L(Vt,"$isDraggingInBuilder",u),[u,h]=He();let f=N(()=>t()?Pc(t().assetKey):!1),p=N(()=>{const _=s();if(!_)return null;const x=10,C=40,T=l(f)?380:290;let A=_.screenY-_.itemHeight/2-45;const I=x+C;A<I&&(A=_.screenY+_.itemHeight/2+10);const D=window.innerHeight-C-x;A>D&&(A=D);let P=_.screenX;const O=T/2,G=O+x,Z=window.innerWidth-O-x;return P<G&&(P=G),P>Z&&(P=Z),{x:P,y:A}});function m(){if(!i())return;const _=r()==="behind"?"front":"behind",x=Di(_);_c(),bc(i(),x)}function S(){i()&&yc(i(),!a())}function w(){i()&&wc(i(),!o())}function g(){i()&&(za(i()),Li())}var b=Fe(),y=de(b);{var v=_=>{var x=wu(),C=M(x),T=M(C);{let O=N(()=>r()==="behind"?"blue":"orange"),G=N(()=>a()?"Solid items must be behind player":"Toggle item depth: behind or in front of player");oe(T,{get variant(){return l(O)},get title(){return l(G)},onclick:m,get disabled(){return a()},children:(Z,H)=>{var J=ae();B(()=>Ce(J,r()==="behind"?"Front":"Back")),E(Z,J)},$$slots:{default:!0}})}var A=k(T,2);{let O=N(()=>o()?"orange":"blue");oe(A,{get variant(){return l(O)},title:"Flip item horizontally",onclick:w,children:(G,Z)=>{var H=ae("Flip");E(G,H)},$$slots:{default:!0}})}var I=k(A,2);{var D=O=>{{let G=N(()=>a()?"orange":"blue");oe(O,{get variant(){return l(G)},title:"Toggle physics: item will block player movement",onclick:S,children:(Z,H)=>{var J=ae();B(()=>Ce(J,a()?"Ghost":"Solid")),E(Z,J)},$$slots:{default:!0}})}};V(I,O=>{l(f)&&O(D)})}var P=k(I,2);oe(P,{variant:"red",title:"Delete selected item",onclick:g,children:(O,G)=>{var Z=ae("DEL");E(O,Z)},$$slots:{default:!0}}),B(()=>ue(x,`left: ${l(p).x??""}px; top: ${l(p).y??""}px;${d()?" pointer-events: none;":""}`)),E(_,x)};V(y,_=>{c()!=="dialogs"&&i()&&l(p)&&_(v)})}E(n,b),Se(),h()}var Eu=F('<div class="frame-controls svelte-eqt3a9"><div class="controls-row svelte-eqt3a9"><!> <!></div></div>');function xu(n,e){we(e,!0);const t=()=>L(Za,"$selectedFrameScreenPosition",a),s=()=>L(ns,"$selectedFrameId",a),i=()=>L(Ve,"$builderEditMode",a),r=()=>L(Vt,"$isDraggingInBuilder",a),[a,o]=He();let c=N(()=>{const m=t();if(!m)return null;const S=10,w=40,g=190;let b=m.screenY-m.frameHeight/2-45;const y=S+w;b<y&&(b=m.screenY+m.frameHeight/2+10);const v=window.innerHeight-w-S;b>v&&(b=v);let _=m.screenX;const x=g/2,C=x+S,T=window.innerWidth-x-S;return _<C&&(_=C),_>T&&(_=T),{x:_,y:b}});function d(){Ra()}function u(){s()&&(Fi(s()),zn(null))}var h=Fe(),f=de(h);{var p=m=>{var S=Eu(),w=M(S),g=M(w);oe(g,{variant:"purple",title:"Edit frame content (or double-click)",onclick:d,children:(y,v)=>{var _=ae("EDIT");E(y,_)},$$slots:{default:!0}});var b=k(g,2);oe(b,{variant:"red",title:"Delete selected frame",onclick:u,children:(y,v)=>{var _=ae("DEL");E(y,_)},$$slots:{default:!0}}),B(()=>ue(S,`left: ${l(c).x??""}px; top: ${l(c).y??""}px;${r()?" pointer-events: none;":""}`)),E(m,S)};V(f,m=>{i()!=="dialogs"&&s()&&l(c)&&m(p)})}E(n,h),Se(),o()}var Iu=F('<div class="zone-controls svelte-sm01rq"><div class="controls-row svelte-sm01rq"><!> <!> <!></div></div>');function Cu(n,e){we(e,!0);const t=()=>L(Ya,"$selectedDialogZoneScreenPosition",a),s=()=>L(Ws,"$selectedDialogZoneId",a),i=()=>L(Ve,"$builderEditMode",a),r=()=>L(Vt,"$isDraggingInBuilder",a),[a,o]=He();let c=N(()=>{const S=t();if(!S)return null;const w=10,g=120,b=85;let y=S.screenY;const v=w+g/2,_=window.innerHeight-g/2-w;y<v&&(y=v),y>_&&(y=_);let x=S.screenX;const C=b/2,T=C+w,A=window.innerWidth-C-w;return x<T&&(x=T),x>A&&(x=A),{x,y}});function d(){Ba()}function u(){s()&&(Ga(s()),Bn(null))}function h(){Bn(null)}var f=Fe(),p=de(f);{var m=S=>{var w=Iu(),g=M(w),b=M(g);oe(b,{variant:"cyan",title:"Edit zone content (or double-click)",onclick:d,children:(_,x)=>{var C=ae("EDIT");E(_,C)},$$slots:{default:!0}});var y=k(b,2);oe(y,{variant:"red",title:"Delete selected zone",onclick:u,children:(_,x)=>{var C=ae("DEL");E(_,C)},$$slots:{default:!0}});var v=k(y,2);oe(v,{variant:"default",title:"Deselect zone",onclick:h,children:(_,x)=>{var C=ae("DONE");E(_,C)},$$slots:{default:!0}}),B(()=>ue(w,`left: ${l(c).x??""}px; top: ${l(c).y??""}px;${r()?" pointer-events: none;":""}`)),E(S,w)};V(p,S=>{i()==="dialogs"&&s()&&l(c)&&S(m)})}E(n,f),Se(),o()}var Tu=F('<div class="social-controls svelte-1v4dckp"><div class="controls-row svelte-1v4dckp"><!> <!></div></div>');function Du(n,e){we(e,!0);const t=()=>L(Na,"$selectedSocialScreenPosition",a),s=()=>L(ss,"$selectedSocialId",a),i=()=>L(Ve,"$builderEditMode",a),r=()=>L(Vt,"$isDraggingInBuilder",a),[a,o]=He();let c=N(()=>{const m=t();if(!m)return null;const S=10,w=40,g=190;let b=m.screenY-m.socialHeight/2-45;const y=S+w;b<y&&(b=m.screenY+m.socialHeight/2+10);const v=window.innerHeight-w-S;b>v&&(b=v);let _=m.screenX;const x=g/2,C=x+S,T=window.innerWidth-x-S;return _<C&&(_=C),_>T&&(_=T),{x:_,y:b}});function d(){Fa()}function u(){s()&&(Hi(s()),Kn(null))}var h=Fe(),f=de(h);{var p=m=>{var S=Tu(),w=M(S),g=M(w);oe(g,{variant:"pink",title:"Edit social settings (or double-click)",onclick:d,children:(y,v)=>{var _=ae("EDIT");E(y,_)},$$slots:{default:!0}});var b=k(g,2);oe(b,{variant:"red",title:"Delete selected social",onclick:u,children:(y,v)=>{var _=ae("DEL");E(y,_)},$$slots:{default:!0}}),B(()=>ue(S,`left: ${l(c).x??""}px; top: ${l(c).y??""}px;${r()?" pointer-events: none;":""}`)),E(m,S)};V(f,m=>{i()!=="dialogs"&&s()&&l(c)&&m(p)})}E(n,h),Se(),o()}var ku=F('<div class="hstack svelte-8vtf35"><!></div>');function Pu(n,e){let t=he(e,"gap",3,"10px"),s=he(e,"align",3,"center");var i=ku(),r=M(i);Pn(r,()=>e.children??mt),B(()=>ue(i,`gap: ${t()??""}; align-items: ${(s()==="start"?"flex-start":s()==="end"?"flex-end":s())??""};`)),E(n,i)}var Au=F('<div class="vstack svelte-1y4dqnf"><!></div>');function Mu(n,e){let t=he(e,"gap",3,"10px"),s=he(e,"align",3,"stretch");var i=Au(),r=M(i);Pn(r,()=>e.children??mt),B(()=>ue(i,`gap: ${t()??""}; align-items: ${(s()==="start"?"flex-start":s()==="end"?"flex-end":s())??""};`)),E(n,i)}var $u=F("<div><!></div>");function Ir(n,e){const t=()=>L(Vt,"$isDraggingInBuilder",s),[s,i]=He();let r=he(e,"padding",3,"10px");var a=$u();let o;var c=M(a);Pn(c,()=>e.children??mt),B(()=>{o=De(a,1,`fixed fixed--${e.position??""}`,"svelte-vwlo0e",o,{"dragging-in-builder":t()}),ue(a,`--padding: ${r()??""};`)}),E(n,a),i()}var Lu=F("<div><!> <!></div>"),Ou=F("<!> <!>",1),Ru=F("<!> <!> <!> <!>",1),Fu=F("<div><!></div>"),Hu=F("<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!>",1);function Xu(n,e){we(e,!0);const t=()=>L(Ns,"$selectedItemId",h),s=()=>L(ns,"$selectedFrameId",h),i=()=>L(Ws,"$selectedDialogZoneId",h),r=()=>L(ss,"$selectedSocialId",h),a=()=>L(Ve,"$builderEditMode",h),o=()=>L(Ds,"$gridSnappingEnabled",h),c=()=>L(an,"$isItemPaletteOpen",h),d=()=>L(tn,"$isFramePaletteOpen",h),u=()=>L(nn,"$isSocialPaletteOpen",h),[h,f]=He(),p=600;let m=K(Je(typeof window<"u"?window.innerWidth<p:!1)),S=N(()=>l(m)&&(t()!==null||s()!==null||i()!==null||r()!==null));Re(()=>{function te(){$(m,window.innerWidth<p)}return window.addEventListener("resize",te),()=>window.removeEventListener("resize",te)});function w(){console.log("[BuilderUI] handleSave called, switching to game...");const te=xd();console.log("[BuilderUI] switchToGame result:",te)}function g(){nc()}function b(){Ge.emit(Oe.DIALOG_ZONE_CREATE)}var y=Hu(),v=de(y);Su(v,{});var _=k(v,2);xu(_,{});var x=k(_,2);Cu(x,{});var C=k(x,2);Du(C,{});var T=k(C,2);{var A=te=>{Rd(te,{})},I=te=>{var ke=Fe(),Ee=de(ke);{var Pe=X=>{nu(X,{})},Ae=X=>{var Q=Fe(),Te=de(Q);{var re=be=>{Nd(be,{})},Me=be=>{var le=Fe(),fe=de(le);{var ne=ge=>{Bd(ge,{})};V(fe,ge=>{a()==="socials"&&ge(ne)},!0)}E(be,le)};V(Te,be=>{a()==="frames"?be(re):be(Me,!1)},!0)}E(X,Q)};V(Ee,X=>{a()==="dialogs"?X(Pe):X(Ae,!1)},!0)}E(te,ke)};V(T,te=>{a()==="items"?te(A):te(I,!1)})}var D=k(T,2);du(D,{});var P=k(D,2);mu(P,{});var O=k(P,2);so(O,{});var G=k(O,2);yu(G,{});var Z=k(G,2),H=k(Z,2);Ir(H,{position:"top-left",children:(te,ke)=>{var Ee=Lu();let Pe;var Ae=M(Ee);oe(Ae,{variant:"green",width:"100px",onclick:w,children:(Q,Te)=>{var re=ae("SAVE");E(Q,re)},$$slots:{default:!0}});var X=k(Ae,2);{let Q=N(()=>o()?"blue":"orange");oe(X,{get variant(){return l(Q)},width:"80px",onclick:g,title:"Toggle grid snapping",children:(Te,re)=>{var Me=ae();B(()=>Ce(Me,o()?"FREE":"SNAP")),E(Te,Me)},$$slots:{default:!0}})}B(()=>Pe=De(Ee,1,"left-buttons svelte-1vm8op7",null,Pe,{"hide-left":l(S)})),E(te,Ee)},$$slots:{default:!0}});var J=k(H,2);Ir(J,{position:"top-right",children:(te,ke)=>{var Ee=Fu();let Pe;var Ae=M(Ee);Mu(Ae,{align:"end",children:(X,Q)=>{var Te=Ru(),re=de(Te);{let fe=N(()=>a()==="items"&&c()?"orange":"blue");oe(re,{get variant(){return l(fe)},onclick:()=>{a()==="items"?sc():(Hn("items"),an.set(!0))},title:"Edit items",children:(ne,ge)=>{var xe=ae("ITEMS");E(ne,xe)},$$slots:{default:!0}})}var Me=k(re,2);{let fe=N(()=>a()==="frames"&&d()?"orange":"purple");oe(Me,{get variant(){return l(fe)},onclick:()=>{a()==="frames"?ic():(Hn("frames"),tn.set(!0))},title:"Edit text frames",children:(ne,ge)=>{var xe=ae("FRAMES");E(ne,xe)},$$slots:{default:!0}})}var be=k(Me,2);{let fe=N(()=>a()==="socials"&&u()?"orange":"pink");oe(be,{get variant(){return l(fe)},onclick:()=>{a()==="socials"?ac():(Hn("socials"),nn.set(!0))},title:"Edit social icons",children:(ne,ge)=>{var xe=ae("SOCIALS");E(ne,xe)},$$slots:{default:!0}})}var le=k(be,2);Pu(le,{children:(fe,ne)=>{var ge=Ou(),xe=de(ge);{var Ne=rt=>{oe(rt,{variant:"cyan",width:"100px",onclick:b,title:"Create new dialog zone at center of view",children:(jt,Fn)=>{var Nt=ae("+ ZONE");E(jt,Nt)},$$slots:{default:!0}})};V(xe,rt=>{a()==="dialogs"&&rt(Ne)})}var ct=k(xe,2);{let rt=N(()=>a()==="dialogs"?"orange":"cyan");oe(ct,{get variant(){return l(rt)},onclick:()=>{a()==="dialogs"?Hn("items"):Hn("dialogs")},title:"Edit dialog zones",children:(jt,Fn)=>{var Nt=ae("DIALOGS");E(jt,Nt)},$$slots:{default:!0}})}E(fe,ge)},$$slots:{default:!0}}),E(X,Te)},$$slots:{default:!0}}),B(()=>Pe=De(Ee,1,"right-buttons svelte-1vm8op7",null,Pe,{"hide-right":l(S)})),E(te,Ee)},$$slots:{default:!0}}),E(n,y),Se(),f()}var Nu=F('<img class="skin-preview-img svelte-crre06"/>'),Wu=F('<canvas width="96" height="96" class="skin-preview svelte-crre06"></canvas>'),Zu=F('<button type="button"><div class="skin-preview-container svelte-crre06"><!></div> <span class="skin-name svelte-crre06"> </span></button>'),Yu=F('<button class="background-card svelte-crre06" type="button"><div class="preview-container svelte-crre06"><img class="preview-image svelte-crre06"/></div> <span class="background-name svelte-crre06"> </span></button>'),Bu=F('<div class="background-select-screen svelte-crre06"><div class="content svelte-crre06"><h1 class="title svelte-crre06">SELECT CHARACTER</h1> <div class="skins-grid svelte-crre06"></div> <h1 class="title svelte-crre06">SELECT BACKGROUND</h1> <div class="backgrounds-grid svelte-crre06"></div></div></div>');function zu(n,e){we(e,!0);const t=St,s=et;let i=K(Je(Un.getSkinId())),r=Je({}),a=Je({});Re(()=>{s.forEach(w=>{const g=vs(w),b=new Image;b.onload=()=>{a[w.id]=!0},b.onerror=()=>{a[w.id]=!1,c(w)},b.src=`./${g}/preview.png`})});function o(w){return`./${vs(w)}/preview.png`}function c(w){const g=r[w.id];if(!g)return;const b=g.getContext("2d");if(!b)return;const y=w.frameWidth??48,v=w.frameHeight??48,_=vs(w),x=new Image;x.src=`./${_}/idle.png`,x.onload=()=>{b.clearRect(0,0,g.width,g.height),b.imageSmoothingEnabled=!1;const C=g.width/y,T=g.height/v,A=Math.min(C,T),I=y*A,D=v*A,P=(g.width-I)/2,O=(g.height-D)/2;b.drawImage(x,0,0,y,v,P,O,I,D)}}function d(w){return`./assets/backgrounds/${w}/preview.png`}function u(w){$(i,w,!0),Un.setSkin(w),va.set(w)}function h(w){ts.setBackgroundByIndex(w),_a.set(t[w].name),ba.set(!0),Id()}var f=Bu(),p=M(f),m=k(M(p),2);tt(m,21,()=>s,ot,(w,g)=>{var b=Zu();let y;b.__click=()=>u(l(g).id);var v=M(b),_=M(v);{var x=I=>{var D=Nu();B(P=>{U(D,"src",P),U(D,"alt",l(g).name)},[()=>o(l(g))]),E(I,D)},C=I=>{var D=Wu();Ut(D,(P,O)=>r[O.id]=P,P=>r?.[P.id],()=>[l(g)]),E(I,D)};V(_,I=>{a[l(g).id]?I(x):I(C,!1)})}var T=k(v,2),A=M(T);B(()=>{y=De(b,1,"skin-card svelte-crre06",null,y,{selected:l(i)===l(g).id}),Ce(A,l(g).name)}),E(w,b)});var S=k(m,4);tt(S,21,()=>t,ot,(w,g,b)=>{var y=Yu();y.__click=()=>h(b);var v=M(y),_=M(v),x=k(v,2),C=M(x);B(T=>{U(_,"src",T),U(_,"alt",l(g).name),Ce(C,l(g).name)},[()=>d(l(g).folder)]),E(w,y)}),E(n,f),Se()}bt(["click"]);var Ku=F("<div> </div>"),Gu=F('<div class="dialog-content svelte-1jd14ss"> </div>'),Uu=F("<div><!> <!></div>");function Vu(n,e){we(e,!0);const t=()=>L(Ll,"$activeDialogText",i),s=()=>L(Ea,"$playerScreenPosition",i),[i,r]=He();let a=N(()=>t()?.title&&t()?.content),o=N(()=>Math.max(10,window.innerHeight-s().y+Jd)),c=N(()=>window.innerWidth<=qd),d=N(()=>l(c)?50:s().x),u=N(()=>l(c)?"percent":"px");var h=Fe(),f=de(h);{var p=m=>{var S=Uu();let w;var g=M(S);{var b=_=>{var x=Ku();let C;var T=M(x);B(()=>{C=De(x,1,"dialog-title svelte-1jd14ss",null,C,{"has-divider":l(a)}),Ce(T,t().title)}),E(_,x)};V(g,_=>{t().title&&_(b)})}var y=k(g,2);{var v=_=>{var x=Gu(),C=M(x);B(()=>Ce(C,t().content)),E(_,x)};V(y,_=>{t().content&&_(v)})}B(()=>{w=De(S,1,"dialog-bubble svelte-1jd14ss",null,w,{narrow:l(c)}),ue(S,`bottom: ${l(o)??""}px; left: ${l(d)??""}${l(u)??""};`)}),E(m,S)};V(f,m=>{t()&&m(p)})}E(n,h),Se(),r()}var ju=F('<div class="game-mask mask-top svelte-ptsgmd"></div> <div class="game-mask mask-bottom svelte-ptsgmd"></div> <div class="game-mask mask-left svelte-ptsgmd"></div> <div class="game-mask mask-right svelte-ptsgmd"></div> <div class="game-frame svelte-ptsgmd"><div class="frame-border frame-top svelte-ptsgmd"></div> <div class="frame-border frame-bottom svelte-ptsgmd"></div> <div class="frame-border frame-left svelte-ptsgmd"></div> <div class="frame-border frame-right svelte-ptsgmd"></div> <div class="frame-corner corner-top-left svelte-ptsgmd"></div> <div class="frame-corner corner-top-right svelte-ptsgmd"></div> <div class="frame-corner corner-bottom-left svelte-ptsgmd"></div> <div class="frame-corner corner-bottom-right svelte-ptsgmd"></div></div>',1);function qu(n,e){we(e,!1);const t=()=>L(Ml,"$gameFrameColor",i),s=()=>L(Ia,"$gameWorldDimensions",i),[i,r]=He(),a=Ct(),o=Ct(),c=Ct(),d=Ct(),u=Ct(),h=Ct(),f=Ct();Lt(()=>t(),()=>{$(a,t())}),Lt(()=>s(),()=>{$(o,s())}),Lt(()=>l(o),()=>{$(c,`
    top: ${l(o).offsetY}px;
    left: ${l(o).offsetX}px;
    width: ${l(o).worldWidth}px;
    height: ${l(o).worldHeight}px;
  `)}),Lt(()=>l(o),()=>{$(d,l(o).offsetY)}),Lt(()=>l(o),()=>{$(u,l(o).offsetX)}),Lt(()=>l(o),()=>{$(h,l(o).offsetX+l(o).worldWidth)}),Lt(()=>l(o),()=>{$(f,l(o).offsetY+l(o).worldHeight)}),aa();var p=ju(),m=de(p),S=k(m,2),w=k(S,2),g=k(w,2),b=k(g,2);B(()=>{ue(m,`height: ${l(d)??""}px; background: ${l(a)??""};`),ue(S,`top: ${l(f)??""}px; background: ${l(a)??""};`),ue(w,`top: ${l(d)??""}px; height: ${l(o),Pt(()=>l(o).worldHeight)??""}px; width: ${l(u)??""}px; background: ${l(a)??""};`),ue(g,`top: ${l(d)??""}px; height: ${l(o),Pt(()=>l(o).worldHeight)??""}px; left: ${l(h)??""}px; background: ${l(a)??""};`),ue(b,`--frame-thickness: 16px; --frame-color: ${l(a)??""}; ${l(c)??""}`)}),E(n,p),Se(),r()}var Ju=F("<!> <!>",1),Qu=F('<div class="touch-controls"><p class="touch-text">Tap and hold<br/>where you want<br/>to move</p></div>'),eh=F('<div class="desktop-controls"><div class="key-row"><div class="pixel-key">A</div> <div class="pixel-key">W</div> <div class="pixel-key">D</div></div> <p class="or-text">or</p> <div class="key-row"><div class="pixel-key">â</div> <div class="pixel-key">â</div> <div class="pixel-key">â</div></div></div>'),th=F('<div class="loader-overlay"><div class="pixel-loader"></div></div>'),nh=F('<!> <div class="game-ui-wrapper svelte-13dvmla"><!> <!> <!> <dialog class="pixel-dialog"><h1>CONTROLS</h1> <div class="controls-content"><!></div></dialog> <!></div>',1);function sh(n,e){we(e,!1);const t=()=>L(Nn,"$showControlsDialog",u),s=()=>L(wa,"$hasPlayerMoved",u),i=()=>L(ba,"$hasSelectedBackground",u),r=()=>L($l,"$gameFrameVisible",u),a=()=>L(Oa,"$isBuilderMode",u),o=()=>L(Qn,"$currentLanguage",u),c=()=>L(ya,"$isTouchDevice",u),d=()=>L(hi,"$isLoading",u),[u,h]=He();let f=Ct();function p(){const v=to.toggleLanguage();Qn.set(v)}function m(v){!l(f)?.open||v.target.closest(".pixel-button")||Nn.set(!1)}function S(){const v=Sd();if(!v){console.error("Cannot enter builder mode: map config not found");return}Ed(v)}Lt(()=>(l(f),t()),()=>{l(f)&&(t()?l(f).showModal():l(f).close())}),Lt(()=>(s(),l(f),Nn),()=>{s()&&l(f)?.open&&Nn.set(!1)}),aa(),xl();var w=Fe();ft("pointerdown",Hr,m);var g=de(w);{var b=v=>{zu(v,{})},y=v=>{var _=nh(),x=de(_);{var C=X=>{qu(X,{})};V(x,X=>{r()&&!a()&&X(C)})}var T=k(x,2),A=M(T);{var I=X=>{Xu(X,{})},D=X=>{var Q=Ju(),Te=de(Q);Vu(Te,{});var re=k(Te,2);so(re,{}),E(X,Q)};V(A,X=>{a()?X(I):X(D,!1)})}var P=k(A,2);{var O=X=>{oe(X,{position:"top-left",variant:"green",width:"120px",onclick:S,title:"Toggle Builder Mode",children:(Q,Te)=>{var re=ae("BUILD");E(Q,re)},$$slots:{default:!0}})};V(P,X=>{a()||X(O)})}var G=k(P,2);{var Z=X=>{oe(X,{position:"top-right",variant:"default",width:"100px",onclick:p,title:"Toggle Language (L)",children:(Q,Te)=>{var re=ae();B(Me=>Ce(re,Me),[()=>(o(),Pt(()=>o().toUpperCase()))]),E(Q,re)},$$slots:{default:!0}})};V(G,X=>{a()||X(Z)})}var H=k(G,2),J=k(M(H),2),te=M(J);{var ke=X=>{var Q=Qu();E(X,Q)},Ee=X=>{var Q=eh();E(X,Q)};V(te,X=>{c()?X(ke):X(Ee,!1)})}Ut(H,X=>$(f,X),()=>l(f));var Pe=k(H,2);{var Ae=X=>{var Q=th();E(X,Q)};V(Pe,X=>{d()&&X(Ae)})}E(v,_)};V(g,v=>{i()?v(y,!1):v(b)})}E(n,w),Se(),h()}Yl();const io=document.getElementById("game-ui");if(!io)throw new Error("game-ui element not found!");pl(sh,{target:io});Qn.set(to.getLanguage());va.set(Un.getSkinId());_a.set(ts.getCurrentConfig().name);const ih={type:Y.AUTO,width:800,height:600,parent:"game-container",backgroundColor:"#000000",pixelArt:!0,roundPixels:!0,scale:{mode:Y.Scale.RESIZE,autoCenter:Y.Scale.CENTER_BOTH},input:{activePointers:3},physics:{default:"arcade",arcade:{gravity:{y:1e3,x:0},debug:!1}},audio:{noAudio:!0},scene:[]},Ys=new Y.Game(ih);Ys.scene.add(vt.GAME,od);Ys.scene.add(vt.BUILDER,_d);wd(Ys);const rh=Ys.device.input.touch;ya.set(rh);const ah=performance.getEntriesByType("navigation")[0]&&performance.getEntriesByType("navigation")[0].type==="reload",oh=sessionStorage.getItem("hasSeenControlsHint");(!oh||ah)&&(sessionStorage.setItem("hasSeenControlsHint","true"),Nn.set(!0));
//# sourceMappingURL=index-DffUcHOB.js.map
