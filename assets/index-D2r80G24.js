import{r as zr,g as Fr}from"./phaser-DFK5Ua9d.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function i(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=i(r);fetch(r.href,s)}})();var Ur=zr();const O=Fr(Ur),Oi=!1;var $n=Array.isArray,Vr=Array.prototype.indexOf,Ki=Array.from,Bn=Object.defineProperty,Yt=Object.getOwnPropertyDescriptor,Zn=Object.getOwnPropertyDescriptors,qr=Object.prototype,jr=Array.prototype,zi=Object.getPrototypeOf,hn=Object.isExtensible;const We=()=>{};function Jr(t){return t()}function ai(t){for(var e=0;e<t.length;e++)t[e]()}function Yn(){var t,e,i=new Promise((n,r)=>{t=n,e=r});return{promise:i,resolve:t,reject:e}}const re=2,Fi=4,wi=8,Qr=1<<24,Ve=16,qe=32,yt=64,bi=128,xe=512,ie=1024,ge=2048,Le=4096,_e=8192,et=16384,Ui=32768,ft=65536,fn=1<<17,Wn=1<<18,kt=1<<19,Gn=1<<20,gt=32768,Pi=1<<21,Vi=1<<22,tt=1<<23,xt=Symbol("$state"),es=Symbol(""),It=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Xn(t){return t===this.v}function Kn(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function zn(t){return!Kn(t,this.v)}function ts(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function is(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function ns(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function rs(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function ss(t){throw new Error("https://svelte.dev/e/effect_orphan")}function os(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function as(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function ls(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function cs(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function us(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}let Ft=!1,ds=!1;function hs(){Ft=!0}const fs=1,gs=2,ps=16,vs=1,ms=2,se=Symbol(),_s="http://www.w3.org/1999/xhtml";let j=null;function Ct(t){j=t}function je(t,e=!1,i){j={p:j,i:!1,c:null,e:null,s:t,x:null,l:Ft&&!e?{s:null,u:null,$:[]}:null}}function Je(t){var e=j,i=e.e;if(i!==null){e.e=null;for(var n of i)gr(n)}return e.i=!0,j=e.p,{}}function Ut(){return!Ft||j!==null&&j.l===null}let Et=[];function ys(){var t=Et;Et=[],ai(t)}function Vt(t){if(Et.length===0){var e=Et;queueMicrotask(()=>{e===Et&&ys()})}Et.push(t)}function ws(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function Ye(t){if(typeof t!="object"||t===null||xt in t)return t;const e=zi(t);if(e!==qr&&e!==jr)return t;var i=new Map,n=$n(t),r=G(0),s=dt,o=a=>{if(dt===s)return a();var l=R,c=dt;he(null),mn(s);var d=a();return he(l),mn(c),d};return n&&i.set("length",G(t.length)),new Proxy(t,{defineProperty(a,l,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&as();var d=i.get(l);return d===void 0?d=o(()=>{var g=G(c.value);return i.set(l,g),g}):I(d,c.value,!0),!0},deleteProperty(a,l){var c=i.get(l);if(c===void 0){if(l in a){const d=o(()=>G(se));i.set(l,d),Wt(r)}}else I(c,se),Wt(r);return!0},get(a,l,c){if(l===xt)return t;var d=i.get(l),g=l in a;if(d===void 0&&(!g||Yt(a,l)?.writable)&&(d=o(()=>{var h=Ye(g?a[l]:se),p=G(h);return p}),i.set(l,d)),d!==void 0){var f=u(d);return f===se?void 0:f}return Reflect.get(a,l,c)},getOwnPropertyDescriptor(a,l){var c=Reflect.getOwnPropertyDescriptor(a,l);if(c&&"value"in c){var d=i.get(l);d&&(c.value=u(d))}else if(c===void 0){var g=i.get(l),f=g?.v;if(g!==void 0&&f!==se)return{enumerable:!0,configurable:!0,value:f,writable:!0}}return c},has(a,l){if(l===xt)return!0;var c=i.get(l),d=c!==void 0&&c.v!==se||Reflect.has(a,l);if(c!==void 0||B!==null&&(!d||Yt(a,l)?.writable)){c===void 0&&(c=o(()=>{var f=d?Ye(a[l]):se,h=G(f);return h}),i.set(l,c));var g=u(c);if(g===se)return!1}return d},set(a,l,c,d){var g=i.get(l),f=l in a;if(n&&l==="length")for(var h=c;h<g.v;h+=1){var p=i.get(h+"");p!==void 0?I(p,se):h in a&&(p=o(()=>G(se)),i.set(h+"",p))}if(g===void 0)(!f||Yt(a,l)?.writable)&&(g=o(()=>G(void 0)),I(g,Ye(c)),i.set(l,g));else{f=g.v!==se;var b=o(()=>Ye(c));I(g,b)}var T=Reflect.getOwnPropertyDescriptor(a,l);if(T?.set&&T.set.call(d,c),!f){if(n&&typeof l=="string"){var k=i.get("length"),L=Number(l);Number.isInteger(L)&&L>=k.v&&I(k,L+1)}Wt(r)}return!0},ownKeys(a){u(r);var l=Reflect.ownKeys(a).filter(g=>{var f=i.get(g);return f===void 0||f.v!==se});for(var[c,d]of i)d.v!==se&&!(c in a)&&l.push(c);return l},setPrototypeOf(){ls()}})}var gn,Fn,Un,Vn,qn;function bs(){if(gn===void 0){gn=window,Fn=document,Un=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,i=Text.prototype;Vn=Yt(e,"firstChild").get,qn=Yt(e,"nextSibling").get,hn(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),hn(i)&&(i.__t=void 0)}}function ze(t=""){return document.createTextNode(t)}function li(t){return Vn.call(t)}function qt(t){return qn.call(t)}function N(t,e){return li(t)}function Ge(t,e=!1){{var i=li(t);return i instanceof Comment&&i.data===""?qt(i):i}}function P(t,e=1,i=!1){let n=t;for(;e--;)n=qt(n);return n}function Ss(t){t.textContent=""}function jn(){return!1}function Jn(t){var e=B;if(e===null)return R.f|=tt,t;if((e.f&Ui)===0){if((e.f&bi)===0)throw t;e.b.error(t)}else Tt(t,e)}function Tt(t,e){for(;e!==null;){if((e.f&bi)!==0)try{e.b.error(t);return}catch(i){t=i}e=e.parent}throw t}const ti=new Set;let V=null,Ie=null,Ce=[],qi=null,Ri=!1;class Te{committed=!1;current=new Map;previous=new Map;#e=new Set;#t=new Set;#n=0;#i=0;#l=null;#s=[];#r=[];skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#i>0}process(e){Ce=[],this.apply();var i={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const n of e)this.#o(n,i);this.is_fork||this.#u(),this.is_deferred()?(this.#a(i.effects),this.#a(i.render_effects),this.#a(i.block_effects)):(V=null,pn(i.render_effects),pn(i.effects),this.#l?.resolve()),Ie=null}#o(e,i){e.f^=ie;for(var n=e.first;n!==null;){var r=n.f,s=(r&(qe|yt))!==0,o=s&&(r&ie)!==0,a=o||(r&_e)!==0||this.skipped_effects.has(n);if((n.f&bi)!==0&&n.b?.is_pending()&&(i={parent:i,effect:n,effects:[],render_effects:[],block_effects:[]}),!a&&n.fn!==null){s?n.f^=ie:(r&Fi)!==0?i.effects.push(n):Ot(n)&&((n.f&Ve)!==0&&i.block_effects.push(n),Mt(n));var l=n.first;if(l!==null){n=l;continue}}var c=n.parent;for(n=n.next;n===null&&c!==null;)c===i.effect&&(this.#a(i.effects),this.#a(i.render_effects),this.#a(i.block_effects),i=i.parent),n=c.next,c=c.parent}}#a(e){for(const i of e)((i.f&ge)!==0?this.#s:this.#r).push(i),this.#c(i.deps),ne(i,ie)}#c(e){if(e!==null)for(const i of e)(i.f&re)===0||(i.f&gt)===0||(i.f^=gt,this.#c(i.deps))}capture(e,i){this.previous.has(e)||this.previous.set(e,i),(e.f&tt)===0&&(this.current.set(e,e.v),Ie?.set(e,e.v))}activate(){V=this,this.apply()}deactivate(){V===this&&(V=null,Ie=null)}flush(){if(this.activate(),Ce.length>0){if(Is(),V!==null&&V!==this)return}else this.#n===0&&this.process([]);this.deactivate()}discard(){for(const e of this.#t)e(this);this.#t.clear()}#u(){if(this.#i===0){for(const e of this.#e)e();this.#e.clear()}this.#n===0&&this.#d()}#d(){if(ti.size>1){this.previous.clear();var e=Ie,i=!0,n={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const s of ti){if(s===this){i=!1;continue}const o=[];for(const[l,c]of this.current){if(s.current.has(l))if(i&&c!==s.current.get(l))s.current.set(l,c);else continue;o.push(l)}if(o.length===0)continue;const a=[...s.current.keys()].filter(l=>!this.current.has(l));if(a.length>0){var r=Ce;Ce=[];const l=new Set,c=new Map;for(const d of o)Qn(d,a,l,c);if(Ce.length>0){V=s,s.apply();for(const d of Ce)s.#o(d,n);s.deactivate()}Ce=r}}V=null,Ie=e}this.committed=!0,ti.delete(this)}increment(e){this.#n+=1,e&&(this.#i+=1)}decrement(e){this.#n-=1,e&&(this.#i-=1),this.revive()}revive(){for(const e of this.#s)ne(e,ge),pt(e);for(const e of this.#r)ne(e,Le),pt(e);this.#s=[],this.#r=[],this.flush()}oncommit(e){this.#e.add(e)}ondiscard(e){this.#t.add(e)}settled(){return(this.#l??=Yn()).promise}static ensure(){if(V===null){const e=V=new Te;ti.add(V),Te.enqueue(()=>{V===e&&e.flush()})}return V}static enqueue(e){Vt(e)}apply(){}}function Is(){var t=nt;Ri=!0;var e=null;try{var i=0;for(ui(!0);Ce.length>0;){var n=Te.ensure();if(i++>1e3){var r,s;Es()}n.process(Ce),it.clear()}}finally{Ri=!1,ui(t),qi=null}}function Es(){try{os()}catch(t){Tt(t,qi)}}let Ze=null;function pn(t){var e=t.length;if(e!==0){for(var i=0;i<e;){var n=t[i++];if((n.f&(et|_e))===0&&Ot(n)&&(Ze=new Set,Mt(n),n.deps===null&&n.first===null&&n.nodes_start===null&&(n.teardown===null&&n.ac===null?mr(n):n.fn=null),Ze?.size>0)){it.clear();for(const r of Ze){if((r.f&(et|_e))!==0)continue;const s=[r];let o=r.parent;for(;o!==null;)Ze.has(o)&&(Ze.delete(o),s.push(o)),o=o.parent;for(let a=s.length-1;a>=0;a--){const l=s[a];(l.f&(et|_e))===0&&Mt(l)}}Ze.clear()}}Ze=null}}function Qn(t,e,i,n){if(!i.has(t)&&(i.add(t),t.reactions!==null))for(const r of t.reactions){const s=r.f;(s&re)!==0?Qn(r,e,i,n):(s&(Vi|Ve))!==0&&(s&ge)===0&&er(r,e,n)&&(ne(r,ge),pt(r))}}function er(t,e,i){const n=i.get(t);if(n!==void 0)return n;if(t.deps!==null)for(const r of t.deps){if(e.includes(r))return!0;if((r.f&re)!==0&&er(r,e,i))return i.set(r,!0),!0}return i.set(t,!1),!1}function pt(t){for(var e=qi=t;e.parent!==null;){e=e.parent;var i=e.f;if(Ri&&e===B&&(i&Ve)!==0&&(i&Wn)===0)return;if((i&(yt|qe))!==0){if((i&ie)===0)return;e.f^=ie}}Ce.push(e)}function xs(t){let e=0,i=vt(0),n;return()=>{Kt()&&(u(i),Ii(()=>(e===0&&(n=wt(()=>t(()=>Wt(i)))),e+=1,()=>{Vt(()=>{e-=1,e===0&&(n?.(),n=void 0,Wt(i))})})))}}var Ds=ft|kt|bi;function As(t,e,i){new Cs(t,e,i)}class Cs{parent;#e=!1;#t;#n=null;#i;#l;#s;#r=null;#o=null;#a=null;#c=null;#u=null;#d=0;#h=0;#g=!1;#f=null;#y=xs(()=>(this.#f=vt(this.#d),()=>{this.#f=null}));constructor(e,i,n){this.#t=e,this.#i=i,this.#l=n,this.parent=B.b,this.#e=!!this.#i.pending,this.#s=Ei(()=>{B.b=this;{var r=this.#m();try{this.#r=we(()=>n(r))}catch(s){this.error(s)}this.#h>0?this.#v():this.#e=!1}return()=>{this.#u?.remove()}},Ds)}#w(){try{this.#r=we(()=>this.#l(this.#t))}catch(e){this.error(e)}this.#e=!1}#b(){const e=this.#i.pending;e&&(this.#o=we(()=>e(this.#t)),Te.enqueue(()=>{var i=this.#m();this.#r=this.#p(()=>(Te.ensure(),we(()=>this.#l(i)))),this.#h>0?this.#v():(Dt(this.#o,()=>{this.#o=null}),this.#e=!1)}))}#m(){var e=this.#t;return this.#e&&(this.#u=ze(),this.#t.before(this.#u),e=this.#u),e}is_pending(){return this.#e||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!this.#i.pending}#p(e){var i=B,n=R,r=j;ke(this.#s),he(this.#s),Ct(this.#s.ctx);try{return e()}catch(s){return Jn(s),null}finally{ke(i),he(n),Ct(r)}}#v(){const e=this.#i.pending;this.#r!==null&&(this.#c=document.createDocumentFragment(),this.#c.append(this.#u),wr(this.#r,this.#c)),this.#o===null&&(this.#o=we(()=>e(this.#t)))}#_(e){if(!this.has_pending_snippet()){this.parent&&this.parent.#_(e);return}this.#h+=e,this.#h===0&&(this.#e=!1,this.#o&&Dt(this.#o,()=>{this.#o=null}),this.#c&&(this.#t.before(this.#c),this.#c=null))}update_pending_count(e){this.#_(e),this.#d+=e,this.#f&&Gt(this.#f,this.#d)}get_effect_pending(){return this.#y(),u(this.#f)}error(e){var i=this.#i.onerror;let n=this.#i.failed;if(this.#g||!i&&!n)throw e;this.#r&&(fe(this.#r),this.#r=null),this.#o&&(fe(this.#o),this.#o=null),this.#a&&(fe(this.#a),this.#a=null);var r=!1,s=!1;const o=()=>{if(r){ws();return}r=!0,s&&us(),Te.ensure(),this.#d=0,this.#a!==null&&Dt(this.#a,()=>{this.#a=null}),this.#e=this.has_pending_snippet(),this.#r=this.#p(()=>(this.#g=!1,we(()=>this.#l(this.#t)))),this.#h>0?this.#v():this.#e=!1};var a=R;try{he(null),s=!0,i?.(e,o),s=!1}catch(l){Tt(l,this.#s&&this.#s.parent)}finally{he(a)}n&&Vt(()=>{this.#a=this.#p(()=>{Te.ensure(),this.#g=!0;try{return we(()=>{n(this.#t,()=>e,()=>o)})}catch(l){return Tt(l,this.#s.parent),null}finally{this.#g=!1}})})}}function Hi(t,e){return e}function Ts(t,e,i){for(var n=[],r=e.length,s=0;s<r;s++)tn(e[s].e,n,!0);_r(n,()=>{var o=n.length===0&&i!==null;if(o){var a=i,l=a.parentNode;Ss(l),l.append(a),t.items.clear(),Ae(t,e[0].prev,e[r-1].next)}for(var c=0;c<r;c++){var d=e[c];o||(t.items.delete(d.k),Ae(t,d.prev,d.next)),fe(d.e,!o)}t.first===e[0]&&(t.first=e[0].prev)})}function Ni(t,e,i,n,r,s=null){var o=t,a=new Map,l=null;{var c=t;o=c.appendChild(ze())}var d=null,g=tr(()=>{var k=i();return $n(k)?k:k==null?[]:Ki(k)}),f,h=!0;function p(){Ms(T,f,o,e,n),d!==null&&(f.length===0?(d.fragment?(o.before(d.fragment),d.fragment=null):nn(d.effect),b.first=d.effect):Dt(d.effect,()=>{d=null}))}var b=Ei(()=>{f=u(g);for(var k=f.length,L=new Set,H=V,Y=null,Z=jn(),$=0;$<k;$+=1){var m=f[$],S=n(m,$),x=h?null:a.get(S);x?(Gt(x.v,m),x.i=$,Z&&H.skipped_effects.delete(x.e)):(x=ks(h?o:null,Y,m,S,$,r,e,i),h&&(x.o=!0,Y===null?l=x:Y.next=x,Y=x),a.set(S,x)),L.add(S)}if(k===0&&s&&!d)if(h)d={fragment:null,effect:we(()=>s(o))};else{var v=document.createDocumentFragment(),y=ze();v.append(y),d={fragment:v,effect:we(()=>s(y))}}if(!h)if(Z){for(const[D,_]of a)L.has(D)||H.skipped_effects.add(_.e);H.oncommit(p),H.ondiscard(()=>{})}else p();u(g)}),T={effect:b,items:a,first:l};h=!1}function Ms(t,e,i,n,r){var s=e.length,o=t.items,a=t.first,l,c=null,d=[],g=[],f,h,p,b;for(b=0;b<s;b+=1){if(f=e[b],h=r(f,b),p=o.get(h),t.first??=p,!p.o){p.o=!0;var T=c?c.next:a;Ae(t,c,p),Ae(t,p,T),Ti(p,T,i),c=p,d=[],g=[],a=c.next;continue}if((p.e.f&_e)!==0&&nn(p.e),p!==a){if(l!==void 0&&l.has(p)){if(d.length<g.length){var k=g[0],L;c=k.prev;var H=d[0],Y=d[d.length-1];for(L=0;L<d.length;L+=1)Ti(d[L],k,i);for(L=0;L<g.length;L+=1)l.delete(g[L]);Ae(t,H.prev,Y.next),Ae(t,c,H),Ae(t,Y,k),a=k,c=Y,b-=1,d=[],g=[]}else l.delete(p),Ti(p,a,i),Ae(t,p.prev,p.next),Ae(t,p,c===null?t.first:c.next),Ae(t,c,p),c=p;continue}for(d=[],g=[];a!==null&&a.k!==h;)(a.e.f&_e)===0&&(l??=new Set).add(a),g.push(a),a=a.next;if(a===null)continue;p=a}d.push(p),c=p,a=p.next}if(a!==null||l!==void 0){for(var Z=l===void 0?[]:Ki(l);a!==null;)(a.e.f&_e)===0&&Z.push(a),a=a.next;var $=Z.length;if($>0){var m=s===0?i:null;Ts(t,Z,m)}}}function ks(t,e,i,n,r,s,o,a){var l=(o&fs)!==0,c=(o&ps)===0,d=l?c?Ji(i,!1,!1):vt(i):i,g=(o&gs)===0?r:vt(r),f={i:g,v:d,k:n,a:null,e:null,o:!1,prev:e,next:null};try{if(t===null){var h=document.createDocumentFragment();h.append(t=ze())}return f.e=we(()=>s(t,d,g,a)),e!==null&&(e.next=f),f}finally{}}function Ti(t,e,i){for(var n=t.next?t.next.e.nodes_start:i,r=e?e.e.nodes_start:i,s=t.e.nodes_start;s!==null&&s!==n;){var o=qt(s);r.before(s),s=o}}function Ae(t,e,i){e===null?(t.first=i,t.effect.first=i&&i.e):(e.e.next&&(e.e.next.prev=null),e.next=i,e.e.next=i&&i.e),i===null?t.effect.last=e&&e.e:(i.e.prev&&(i.e.prev.next=null),i.prev=e,i.e.prev=e&&e.e)}function Ls(t,e,i,n){const r=Ut()?Si:tr;if(i.length===0&&t.length===0){n(e.map(r));return}var s=V,o=B,a=Os();function l(){Promise.all(i.map(c=>Ps(c))).then(c=>{a();try{n([...e.map(r),...c])}catch(d){(o.f&et)===0&&Tt(d,o)}s?.deactivate(),ci()}).catch(c=>{Tt(c,o)})}t.length>0?Promise.all(t).then(()=>{a();try{return l()}finally{s?.deactivate(),ci()}}):l()}function Os(){var t=B,e=R,i=j,n=V;return function(s=!0){ke(t),he(e),Ct(i),s&&n?.activate()}}function ci(){ke(null),he(null),Ct(null)}function Si(t){var e=re|ge,i=R!==null&&(R.f&re)!==0?R:null;return B!==null&&(B.f|=kt),{ctx:j,deps:null,effects:null,equals:Xn,f:e,fn:t,reactions:null,rv:0,v:se,wv:0,parent:i??B,ac:null}}function Ps(t,e){let i=B;i===null&&is();var n=i.b,r=void 0,s=vt(se),o=!R,a=new Map;return zs(()=>{var l=Yn();r=l.promise;try{Promise.resolve(t()).then(l.resolve,l.reject).then(()=>{c===V&&c.committed&&c.deactivate(),ci()})}catch(f){l.reject(f),ci()}var c=V;if(o){var d=!n.is_pending();n.update_pending_count(1),c.increment(d),a.get(c)?.reject(It),a.delete(c),a.set(c,l)}const g=(f,h=void 0)=>{if(c.activate(),h)h!==It&&(s.f|=tt,Gt(s,h));else{(s.f&tt)!==0&&(s.f^=tt),Gt(s,f);for(const[p,b]of a){if(a.delete(p),p===c)break;b.reject(It)}}o&&(n.update_pending_count(-1),c.decrement(d))};l.promise.then(g,f=>g(null,f||"unknown"))}),en(()=>{for(const l of a.values())l.reject(It)}),new Promise(l=>{function c(d){function g(){d===r?l(s):c(r)}d.then(g,g)}c(r)})}function q(t){const e=Si(t);return or(e),e}function tr(t){const e=Si(t);return e.equals=zn,e}function ir(t){var e=t.effects;if(e!==null){t.effects=null;for(var i=0;i<e.length;i+=1)fe(e[i])}}function Rs(t){for(var e=t.parent;e!==null;){if((e.f&re)===0)return(e.f&et)===0?e:null;e=e.parent}return null}function ji(t){var e,i=B;ke(Rs(t));try{t.f&=~gt,ir(t),e=ur(t)}finally{ke(i)}return e}function nr(t){var e=ji(t);if(t.equals(e)||(V?.is_fork||(t.v=e),t.wv=lr()),!Lt)if(Ie!==null)(Kt()||V?.is_fork)&&Ie.set(t,e);else{var i=(t.f&xe)===0?Le:ie;ne(t,i)}}let $i=new Set;const it=new Map;let rr=!1;function vt(t,e){var i={f:0,v:t,reactions:null,equals:Xn,rv:0,wv:0};return i}function G(t,e){const i=vt(t);return or(i),i}function Ji(t,e=!1,i=!0){const n=vt(t);return e||(n.equals=zn),Ft&&i&&j!==null&&j.l!==null&&(j.l.s??=[]).push(n),n}function I(t,e,i=!1){R!==null&&(!Me||(R.f&fn)!==0)&&Ut()&&(R.f&(re|Ve|Vi|fn))!==0&&!Xe?.includes(t)&&cs();let n=i?Ye(e):e;return Gt(t,n)}function Gt(t,e){if(!t.equals(e)){var i=t.v;Lt?it.set(t,e):it.set(t,i),t.v=e;var n=Te.ensure();n.capture(t,i),(t.f&re)!==0&&((t.f&ge)!==0&&ji(t),ne(t,(t.f&xe)!==0?ie:Le)),t.wv=lr(),sr(t,ge),Ut()&&B!==null&&(B.f&ie)!==0&&(B.f&(qe|yt))===0&&(ye===null?Ns([t]):ye.push(t)),!n.is_fork&&$i.size>0&&!rr&&Hs()}return e}function Hs(){rr=!1;var t=nt;ui(!0);const e=Array.from($i);try{for(const i of e)(i.f&ie)!==0&&ne(i,Le),Ot(i)&&Mt(i)}finally{ui(t)}$i.clear()}function Wt(t){I(t,t.v+1)}function sr(t,e){var i=t.reactions;if(i!==null)for(var n=Ut(),r=i.length,s=0;s<r;s++){var o=i[s],a=o.f;if(!(!n&&o===B)){var l=(a&ge)===0;if(l&&ne(o,e),(a&re)!==0){var c=o;Ie?.delete(c),(a&gt)===0&&(a&xe&&(o.f|=gt),sr(c,Le))}else l&&((a&Ve)!==0&&Ze!==null&&Ze.add(o),pt(o))}}}function Qi(t){var e=R,i=B;he(null),ke(null);try{return t()}finally{he(e),ke(i)}}let nt=!1;function ui(t){nt=t}let Lt=!1;function vn(t){Lt=t}let R=null,Me=!1;function he(t){R=t}let B=null;function ke(t){B=t}let Xe=null;function or(t){R!==null&&(Xe===null?Xe=[t]:Xe.push(t))}let le=null,ve=0,ye=null;function Ns(t){ye=t}let ar=1,Xt=0,dt=Xt;function mn(t){dt=t}function lr(){return++ar}function Ot(t){var e=t.f;if((e&ge)!==0)return!0;if(e&re&&(t.f&=~gt),(e&Le)!==0){var i=t.deps;if(i!==null)for(var n=i.length,r=0;r<n;r++){var s=i[r];if(Ot(s)&&nr(s),s.wv>t.wv)return!0}(e&xe)!==0&&Ie===null&&ne(t,ie)}return!1}function cr(t,e,i=!0){var n=t.reactions;if(n!==null&&!Xe?.includes(t))for(var r=0;r<n.length;r++){var s=n[r];(s.f&re)!==0?cr(s,e,!1):e===s&&(i?ne(s,ge):(s.f&ie)!==0&&ne(s,Le),pt(s))}}function ur(t){var e=le,i=ve,n=ye,r=R,s=Xe,o=j,a=Me,l=dt,c=t.f;le=null,ve=0,ye=null,R=(c&(qe|yt))===0?t:null,Xe=null,Ct(t.ctx),Me=!1,dt=++Xt,t.ac!==null&&(Qi(()=>{t.ac.abort(It)}),t.ac=null);try{t.f|=Pi;var d=t.fn,g=d(),f=t.deps;if(le!==null){var h;if(di(t,ve),f!==null&&ve>0)for(f.length=ve+le.length,h=0;h<le.length;h++)f[ve+h]=le[h];else t.deps=f=le;if(nt&&Kt()&&(t.f&xe)!==0)for(h=ve;h<f.length;h++)(f[h].reactions??=[]).push(t)}else f!==null&&ve<f.length&&(di(t,ve),f.length=ve);if(Ut()&&ye!==null&&!Me&&f!==null&&(t.f&(re|Le|ge))===0)for(h=0;h<ye.length;h++)cr(ye[h],t);return r!==null&&r!==t&&(Xt++,ye!==null&&(n===null?n=ye:n.push(...ye))),(t.f&tt)!==0&&(t.f^=tt),g}catch(p){return Jn(p)}finally{t.f^=Pi,le=e,ve=i,ye=n,R=r,Xe=s,Ct(o),Me=a,dt=l}}function $s(t,e){let i=e.reactions;if(i!==null){var n=Vr.call(i,t);if(n!==-1){var r=i.length-1;r===0?i=e.reactions=null:(i[n]=i[r],i.pop())}}i===null&&(e.f&re)!==0&&(le===null||!le.includes(e))&&(ne(e,Le),(e.f&xe)!==0&&(e.f^=xe,e.f&=~gt),ir(e),di(e,0))}function di(t,e){var i=t.deps;if(i!==null)for(var n=e;n<i.length;n++)$s(t,i[n])}function Mt(t){var e=t.f;if((e&et)===0){ne(t,ie);var i=B,n=nt;B=t,nt=!0;try{(e&(Ve|Qr))!==0?Fs(t):vr(t),pr(t);var r=ur(t);t.teardown=typeof r=="function"?r:null,t.wv=ar;var s;Oi&&ds&&(t.f&ge)!==0&&t.deps}finally{nt=n,B=i}}}function u(t){var e=t.f,i=(e&re)!==0;if(R!==null&&!Me){var n=B!==null&&(B.f&et)!==0;if(!n&&!Xe?.includes(t)){var r=R.deps;if((R.f&Pi)!==0)t.rv<Xt&&(t.rv=Xt,le===null&&r!==null&&r[ve]===t?ve++:le===null?le=[t]:le.includes(t)||le.push(t));else{(R.deps??=[]).push(t);var s=t.reactions;s===null?t.reactions=[R]:s.includes(R)||s.push(R)}}}if(Lt){if(it.has(t))return it.get(t);if(i){var o=t,a=o.v;return((o.f&ie)===0&&o.reactions!==null||hr(o))&&(a=ji(o)),it.set(o,a),a}}else i&&(!Ie?.has(t)||V?.is_fork&&!Kt())&&(o=t,Ot(o)&&nr(o),nt&&Kt()&&(o.f&xe)===0&&dr(o));if(Ie?.has(t))return Ie.get(t);if((t.f&tt)!==0)throw t.v;return t.v}function dr(t){if(t.deps!==null){t.f^=xe;for(const e of t.deps)(e.reactions??=[]).push(t),(e.f&re)!==0&&(e.f&xe)===0&&dr(e)}}function hr(t){if(t.v===se)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(it.has(e)||(e.f&re)!==0&&hr(e))return!0;return!1}function wt(t){var e=Me;try{return Me=!0,t()}finally{Me=e}}const Bs=-7169;function ne(t,e){t.f=t.f&Bs|e}function Zs(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(xt in t)Bi(t);else if(!Array.isArray(t))for(let e in t){const i=t[e];typeof i=="object"&&i&&xt in i&&Bi(i)}}}function Bi(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let n in t)try{Bi(t[n],e)}catch{}const i=zi(t);if(i!==Object.prototype&&i!==Array.prototype&&i!==Map.prototype&&i!==Set.prototype&&i!==Date.prototype){const n=Zn(i);for(let r in n){const s=n[r].get;if(s)try{s.call(t)}catch{}}}}}function fr(t){B===null&&(R===null&&ss(),rs()),Lt&&ns()}function Ys(t,e){var i=e.last;i===null?e.last=e.first=t:(i.next=t,t.prev=i,e.last=t)}function Oe(t,e,i){var n=B;n!==null&&(n.f&_e)!==0&&(t|=_e);var r={ctx:j,deps:null,nodes_start:null,nodes_end:null,f:t|ge|xe,first:null,fn:e,last:null,next:null,parent:n,b:n&&n.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(i)try{Mt(r),r.f|=Ui}catch(a){throw fe(r),a}else e!==null&&pt(r);var s=r;if(i&&s.deps===null&&s.teardown===null&&s.nodes_start===null&&s.first===s.last&&(s.f&kt)===0&&(s=s.first,(t&Ve)!==0&&(t&ft)!==0&&s!==null&&(s.f|=ft)),s!==null&&(s.parent=n,n!==null&&Ys(s,n),R!==null&&(R.f&re)!==0&&(t&yt)===0)){var o=R;(o.effects??=[]).push(s)}return r}function Kt(){return R!==null&&!Me}function en(t){const e=Oe(wi,null,!1);return ne(e,ie),e.teardown=t,e}function ht(t){fr();var e=B.f,i=!R&&(e&qe)!==0&&(e&Ui)===0;if(i){var n=j;(n.e??=[]).push(t)}else return gr(t)}function gr(t){return Oe(Fi|Gn,t,!1)}function Ws(t){return fr(),Oe(wi|Gn,t,!0)}function Gs(t){Te.ensure();const e=Oe(yt|kt,t,!0);return(i={})=>new Promise(n=>{i.outro?Dt(e,()=>{fe(e),n(void 0)}):(fe(e),n(void 0))})}function Xs(t){return Oe(Fi,t,!1)}function _n(t,e){var i=j,n={effect:null,ran:!1,deps:t};i.l.$.push(n),n.effect=Ii(()=>{t(),!n.ran&&(n.ran=!0,wt(e))})}function Ks(){var t=j;Ii(()=>{for(var e of t.l.$){e.deps();var i=e.effect;(i.f&ie)!==0&&ne(i,Le),Ot(i)&&Mt(i),e.ran=!1}})}function zs(t){return Oe(Vi|kt,t,!0)}function Ii(t,e=0){return Oe(wi|e,t,!0)}function oe(t,e=[],i=[],n=[]){Ls(n,e,i,r=>{Oe(wi,()=>t(...r.map(u)),!0)})}function Ei(t,e=0){var i=Oe(Ve|e,t,!0);return i}function we(t){return Oe(qe|kt,t,!0)}function pr(t){var e=t.teardown;if(e!==null){const i=Lt,n=R;vn(!0),he(null);try{e.call(null)}finally{vn(i),he(n)}}}function vr(t,e=!1){var i=t.first;for(t.first=t.last=null;i!==null;){const r=i.ac;r!==null&&Qi(()=>{r.abort(It)});var n=i.next;(i.f&yt)!==0?i.parent=null:fe(i,e),i=n}}function Fs(t){for(var e=t.first;e!==null;){var i=e.next;(e.f&qe)===0&&fe(e),e=i}}function fe(t,e=!0){var i=!1;(e||(t.f&Wn)!==0)&&t.nodes_start!==null&&t.nodes_end!==null&&(Us(t.nodes_start,t.nodes_end),i=!0),vr(t,e&&!i),di(t,0),ne(t,et);var n=t.transitions;if(n!==null)for(const s of n)s.stop();pr(t);var r=t.parent;r!==null&&r.first!==null&&mr(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes_start=t.nodes_end=t.ac=null}function Us(t,e){for(;t!==null;){var i=t===e?null:qt(t);t.remove(),t=i}}function mr(t){var e=t.parent,i=t.prev,n=t.next;i!==null&&(i.next=n),n!==null&&(n.prev=i),e!==null&&(e.first===t&&(e.first=n),e.last===t&&(e.last=i))}function Dt(t,e,i=!0){var n=[];tn(t,n,!0),_r(n,()=>{i&&fe(t),e&&e()})}function _r(t,e){var i=t.length;if(i>0){var n=()=>--i||e();for(var r of t)r.out(n)}else e()}function tn(t,e,i){if((t.f&_e)===0){if(t.f^=_e,t.transitions!==null)for(const o of t.transitions)(o.is_global||i)&&e.push(o);for(var n=t.first;n!==null;){var r=n.next,s=(n.f&ft)!==0||(n.f&qe)!==0&&(t.f&Ve)!==0;tn(n,e,s?i:!1),n=r}}}function nn(t){yr(t,!0)}function yr(t,e){if((t.f&_e)!==0){t.f^=_e,(t.f&ie)===0&&(ne(t,ge),pt(t));for(var i=t.first;i!==null;){var n=i.next,r=(i.f&ft)!==0||(i.f&qe)!==0;yr(i,r?e:!1),i=n}if(t.transitions!==null)for(const s of t.transitions)(s.is_global||e)&&s.in()}}function wr(t,e){for(var i=t.nodes_start,n=t.nodes_end;i!==null;){var r=i===n?null:qt(i);e.append(i),i=r}}const Vs=["touchstart","touchmove"];function qs(t){return Vs.includes(t)}const br=new Set,Zi=new Set;function js(t,e,i,n={}){function r(s){if(n.capture||$t.call(e,s),!s.cancelBubble)return Qi(()=>i?.call(this,s))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?Vt(()=>{e.addEventListener(t,r,n)}):e.addEventListener(t,r,n),r}function At(t,e,i,n,r){var s={capture:n,passive:r},o=js(t,e,i,s);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&en(()=>{e.removeEventListener(t,o,s)})}function Pt(t){for(var e=0;e<t.length;e++)br.add(t[e]);for(var i of Zi)i(t)}let yn=null;function $t(t){var e=this,i=e.ownerDocument,n=t.type,r=t.composedPath?.()||[],s=r[0]||t.target;yn=t;var o=0,a=yn===t&&t.__root;if(a){var l=r.indexOf(a);if(l!==-1&&(e===document||e===window)){t.__root=e;return}var c=r.indexOf(e);if(c===-1)return;l<=c&&(o=l)}if(s=r[o]||t.target,s!==e){Bn(t,"currentTarget",{configurable:!0,get(){return s||i}});var d=R,g=B;he(null),ke(null);try{for(var f,h=[];s!==null;){var p=s.assignedSlot||s.parentNode||s.host||null;try{var b=s["__"+n];b!=null&&(!s.disabled||t.target===s)&&b.call(s,t)}catch(T){f?h.push(T):f=T}if(t.cancelBubble||p===e||p===null)break;s=p}if(f){for(let T of h)queueMicrotask(()=>{throw T});throw f}}finally{t.__root=e,delete t.currentTarget,he(d),ke(g)}}}function Js(t){var e=document.createElement("template");return e.innerHTML=t.replaceAll("<!>","<!---->"),e.content}function hi(t,e){var i=B;i.nodes_start===null&&(i.nodes_start=t,i.nodes_end=e)}function X(t,e){var i=(e&vs)!==0,n=(e&ms)!==0,r,s=!t.startsWith("<!>");return()=>{r===void 0&&(r=Js(s?t:"<!>"+t),i||(r=li(r)));var o=n||Un?document.importNode(r,!0):r.cloneNode(!0);if(i){var a=li(o),l=o.lastChild;hi(a,l)}else hi(o,o);return o}}function be(t=""){{var e=ze(t+"");return hi(e,e),e}}function xi(){var t=document.createDocumentFragment(),e=document.createComment(""),i=ze();return t.append(e,i),hi(e,i),t}function C(t,e){t!==null&&t.before(e)}function me(t,e){var i=e==null?"":typeof e=="object"?e+"":e;i!==(t.__t??=t.nodeValue)&&(t.__t=i,t.nodeValue=i+"")}function Qs(t,e){return eo(t,e)}const bt=new Map;function eo(t,{target:e,anchor:i,props:n={},events:r,context:s,intro:o=!0}){bs();var a=new Set,l=g=>{for(var f=0;f<g.length;f++){var h=g[f];if(!a.has(h)){a.add(h);var p=qs(h);e.addEventListener(h,$t,{passive:p});var b=bt.get(h);b===void 0?(document.addEventListener(h,$t,{passive:p}),bt.set(h,1)):bt.set(h,b+1)}}};l(Ki(br)),Zi.add(l);var c=void 0,d=Gs(()=>{var g=i??e.appendChild(ze());return As(g,{pending:()=>{}},f=>{if(s){je({});var h=j;h.c=s}r&&(n.$$events=r),c=t(f,n)||{},s&&Je()}),()=>{for(var f of a){e.removeEventListener(f,$t);var h=bt.get(f);--h===0?(document.removeEventListener(f,$t),bt.delete(f)):bt.set(f,h)}Zi.delete(l),g!==i&&g.parentNode?.removeChild(g)}});return to.set(c,d),c}let to=new WeakMap;class Sr{anchor;#e=new Map;#t=new Map;#n=new Map;#i=new Set;#l=!0;constructor(e,i=!0){this.anchor=e,this.#l=i}#s=()=>{var e=V;if(this.#e.has(e)){var i=this.#e.get(e),n=this.#t.get(i);if(n)nn(n),this.#i.delete(i);else{var r=this.#n.get(i);r&&(this.#t.set(i,r.effect),this.#n.delete(i),r.fragment.lastChild.remove(),this.anchor.before(r.fragment),n=r.effect)}for(const[s,o]of this.#e){if(this.#e.delete(s),s===e)break;const a=this.#n.get(o);a&&(fe(a.effect),this.#n.delete(o))}for(const[s,o]of this.#t){if(s===i||this.#i.has(s))continue;const a=()=>{if(Array.from(this.#e.values()).includes(s)){var c=document.createDocumentFragment();wr(o,c),c.append(ze()),this.#n.set(s,{effect:o,fragment:c})}else fe(o);this.#i.delete(s),this.#t.delete(s)};this.#l||!n?(this.#i.add(s),Dt(o,a,!1)):a()}}};#r=e=>{this.#e.delete(e);const i=Array.from(this.#e.values());for(const[n,r]of this.#n)i.includes(n)||(fe(r.effect),this.#n.delete(n))};ensure(e,i){var n=V,r=jn();if(i&&!this.#t.has(e)&&!this.#n.has(e))if(r){var s=document.createDocumentFragment(),o=ze();s.append(o),this.#n.set(e,{effect:we(()=>i(o)),fragment:s})}else this.#t.set(e,we(()=>i(this.anchor)));if(this.#e.set(n,e),r){for(const[a,l]of this.#t)a===e?n.skipped_effects.delete(l):n.skipped_effects.add(l);for(const[a,l]of this.#n)a===e?n.skipped_effects.delete(l.effect):n.skipped_effects.add(l.effect);n.oncommit(this.#s),n.ondiscard(this.#r)}else this.#s()}}function J(t,e,i=!1){var n=new Sr(t),r=i?ft:0;function s(o,a){n.ensure(o,a)}Ei(()=>{var o=!1;e((a,l=!0)=>{o=!0,s(l,a)}),o||s(!1,null)},r)}function Yi(t,e,...i){var n=new Sr(t);Ei(()=>{const r=e()??null;n.ensure(r,r&&(s=>r(s,...i)))},ft)}const wn=[...` 	
\r\f \v\uFEFF`];function io(t,e,i){var n=t==null?"":""+t;if(e&&(n=n?n+" "+e:e),i){for(var r in i)if(i[r])n=n?n+" "+r:r;else if(n.length)for(var s=r.length,o=0;(o=n.indexOf(r,o))>=0;){var a=o+s;(o===0||wn.includes(n[o-1]))&&(a===n.length||wn.includes(n[a]))?n=(o===0?"":n.substring(0,o))+n.substring(a+1):o=a}}return n===""?null:n}function no(t,e){return t==null?null:String(t)}function Fe(t,e,i,n,r,s){var o=t.__className;if(o!==i||o===void 0){var a=io(i,n,s);a==null?t.removeAttribute("class"):t.className=a,t.__className=i}else if(s&&r!==s)for(var l in s){var c=!!s[l];(r==null||c!==!!r[l])&&t.classList.toggle(l,c)}return s}function rt(t,e,i,n){var r=t.__style;if(r!==e){var s=no(e);s==null?t.removeAttribute("style"):t.style.cssText=s,t.__style=e}return n}const ro=Symbol("is custom element"),so=Symbol("is html");function bn(t,e){var i=Ir(t);i.value===(i.value=e??void 0)||t.value===e&&(e!==0||t.nodeName!=="PROGRESS")||(t.value=e??"")}function st(t,e,i,n){var r=Ir(t);r[e]!==(r[e]=i)&&(e==="loading"&&(t[es]=i),i==null?t.removeAttribute(e):typeof i!="string"&&oo(t).includes(e)?t[e]=i:t.setAttribute(e,i))}function Ir(t){return t.__attributes??={[ro]:t.nodeName.includes("-"),[so]:t.namespaceURI===_s}}var Sn=new Map;function oo(t){var e=t.getAttribute("is")||t.nodeName,i=Sn.get(e);if(i)return i;Sn.set(e,i=[]);for(var n,r=t,s=Element.prototype;s!==r;){n=Zn(r);for(var o in n)n[o].set&&i.push(o);r=zi(r)}return i}function In(t,e){return t===e||t?.[xt]===e}function rn(t={},e,i,n){return Xs(()=>{var r,s;return Ii(()=>{r=s,s=[],wt(()=>{t!==i(...s)&&(e(t,...s),r&&In(i(...r),t)&&e(null,...r))})}),()=>{Vt(()=>{s&&In(i(...s),t)&&e(null,...s)})}}),t}function ao(t=!1){const e=j,i=e.l.u;if(!i)return;let n=()=>Zs(e.s);if(t){let r=0,s={};const o=Si(()=>{let a=!1;const l=e.s;for(const c in l)l[c]!==s[c]&&(s[c]=l[c],a=!0);return a&&r++,r});n=()=>u(o)}i.b.length&&Ws(()=>{En(e,n),ai(i.b)}),ht(()=>{const r=wt(()=>i.m.map(Jr));return()=>{for(const s of r)typeof s=="function"&&s()}}),i.a.length&&ht(()=>{En(e,n),ai(i.a)})}function En(t,e){if(t.l.s)for(const i of t.l.s)u(i);e()}let Wi=Symbol();function Q(t,e,i){const n=i[e]??={store:null,source:Ji(void 0),unsubscribe:We};if(n.store!==t&&!(Wi in i))if(n.unsubscribe(),n.store=t??null,t==null)n.source.v=void 0,n.unsubscribe=We;else{var r=!0;n.unsubscribe=sn(t,s=>{r?n.source.v=s:I(n.source,s)}),r=!1}return t&&Wi in i?on(t):u(n.source)}function Rt(){const t={};function e(){en(()=>{for(var i in t)t[i].unsubscribe();Bn(t,Wi,{enumerable:!1,value:!0})})}return[t,e]}function de(t,e,i,n){var r=n,s=!0,o=()=>(s&&(s=!1,r=n),r),a;a=t[e],a===void 0&&n!==void 0&&(a=o());var l;return l=()=>{var c=t[e];return c===void 0?o():(s=!0,c)},l}function Er(t){j===null&&ts(),Ft&&j.l!==null?lo(j).m.push(t):ht(()=>{const e=wt(t);if(typeof e=="function")return e})}function lo(t){var e=t.l;return e.u??={a:[],b:[],m:[]}}function sn(t,e,i){if(t==null)return e(void 0),i&&i(void 0),We;const n=wt(()=>t.subscribe(e,i));return n.unsubscribe?()=>n.unsubscribe():n}const St=[];function co(t,e){return{subscribe:pe(t,e).subscribe}}function pe(t,e=We){let i=null;const n=new Set;function r(a){if(Kn(t,a)&&(t=a,i)){const l=!St.length;for(const c of n)c[1](),St.push(c,t);if(l){for(let c=0;c<St.length;c+=2)St[c][0](St[c+1]);St.length=0}}}function s(a){r(a(t))}function o(a,l=We){const c=[a,l];return n.add(c),n.size===1&&(i=e(r,s)||We),a(t),()=>{n.delete(c),n.size===0&&i&&(i(),i=null)}}return{set:r,update:s,subscribe:o}}function Pe(t,e,i){const n=!Array.isArray(t),r=n?[t]:t;if(!r.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const s=e.length<2;return co(i,(o,a)=>{let l=!1;const c=[];let d=0,g=We;const f=()=>{if(d)return;g();const p=e(n?c[0]:c,o,a);s?o(p):g=typeof p=="function"?p:We},h=r.map((p,b)=>sn(p,T=>{c[b]=T,d&=~(1<<b),l&&f()},()=>{d|=1<<b}));return l=!0,f(),function(){ai(h),g(),l=!1}})}function on(t){let e;return sn(t,i=>e=i)(),e}function uo(){return`zone_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const Gi=["#e74c3c","#e67e22","#f1c40f","#2ecc71","#1abc9c","#3498db","#9b59b6","#e91e8f"];function ho(){return Gi[Math.floor(Math.random()*Gi.length)]}function fo(t,e=200){return{id:uo(),x:t,width:e,color:ho(),texts:[{language:"cs",title:"",content:""}]}}function go(t,e){const i=t.texts.find(n=>n.language===e);return i||t.texts[0]||null}const fi=pe("cs"),po=pe("orange"),vo=pe("Forest"),Xi=pe(!1),Bt=pe(!1),xr=pe(!1),Dr=pe(!1),Ar=pe(null),mo=Pe([Ar,fi],([t,e])=>t?go(t,e):null);function Mi(t){Ar.set(t)}const Cr=pe({x:0,y:0});function _o(t,e){Cr.set({x:t,y:e})}const Ue={BACKGROUND_BASE:-100,BACKGROUND_LAYER_START:-99,GROUND_REFERENCE:-1,ITEMS_BEHIND:5,PLAYER:10,ITEMS_FRONT:15,SELECTION_GRAPHICS:999,GRID_OVERLAY:1e3};function an(t){return t==="behind"?Ue.ITEMS_BEHIND:Ue.ITEMS_FRONT}const Be=["orange","white"];class yo{currentSkin=Be[0];currentIndex=0;setSkin(e){Be.includes(e)&&(this.currentSkin=e,this.currentIndex=Be.indexOf(e),localStorage.setItem("catSkin",e))}getSkin(){const e=localStorage.getItem("catSkin");return e&&Be.includes(e)&&(this.currentSkin=e,this.currentIndex=Be.indexOf(e)),this.currentSkin}toggleSkin(){return this.currentIndex=(this.currentIndex+1)%Be.length,this.currentSkin=Be[this.currentIndex],this.setSkin(this.currentSkin),this.currentSkin}getAllSkins(){return Be}}const Tr=new yo,wo={FAST_VELOCITY_THRESHOLD:100,ROTATION_FULL:15,ROTATION_SLIGHT:8};class bo{scene;currentSkin;constructor(e,i="white"){this.scene=e,this.currentSkin=i}createAll(){Tr.getAllSkins().forEach(i=>{this.createAnimationsForSkin(i)})}createAnimationsForSkin(e){const i=this.scene;i.anims.exists(`cat-idle-${e}`)||i.anims.create({key:`cat-idle-${e}`,frames:i.anims.generateFrameNumbers(`cat-idle-${e}`,{start:0,end:3}),frameRate:6,repeat:-1}),i.anims.exists(`cat-walk-${e}`)||i.anims.create({key:`cat-walk-${e}`,frames:i.anims.generateFrameNumbers(`cat-walk-${e}`,{start:0,end:5}),frameRate:12,repeat:-1}),[{key:`cat-jump-up-${e}`,frame:2},{key:`cat-jump-peak-up-${e}`,frame:3},{key:`cat-jump-peak-down-${e}`,frame:3},{key:`cat-jump-down-${e}`,frame:4}].forEach(({key:r,frame:s})=>{i.anims.exists(r)||i.anims.create({key:r,frames:[{key:`cat-walk-${e}`,frame:s}],frameRate:1,repeat:0})})}getSkin(){return this.currentSkin}setSkin(e){this.currentSkin=e}getAnimationKey(e){return`cat-${e}-${this.currentSkin}`}play(e,i){const n=this.getAnimationKey(i);e.anims.currentAnim?.key!==n&&e.play(n)}getJumpAnimationState(e){const{FAST_VELOCITY_THRESHOLD:i,ROTATION_FULL:n,ROTATION_SLIGHT:r}=wo;return e<-i?{animation:this.getAnimationKey("jump-up"),rotation:n,flipMultiplier:1}:e<-20?{animation:this.getAnimationKey("jump-peak-up"),rotation:r,flipMultiplier:1}:e<=i?{animation:this.getAnimationKey("jump-peak-down"),rotation:r,flipMultiplier:-1}:{animation:this.getAnimationKey("jump-down"),rotation:n,flipMultiplier:-1}}handleSkinChange(e,i){const n=this.currentSkin;this.currentSkin=i;const r=e.anims.currentAnim?.key;if(r){const o=`cat-${r.replace("cat-","").replace(`-${n}`,"")}-${i}`;this.scene.anims.exists(o)&&e.play(o)}}}const lt={THRESHOLD_X:20,LANGUAGE_BUTTON:{width:120,height:60},SKIN_BUTTON:{width:120,height:60,yOffset:60}},xn={SPEED:350,JUMP_STRENGTH:-500};class So{scene;getPlayerPosition;keyUp;keyLeft;keyRight;keyA;keyD;keyW;keySpace;touchLeft=!1;touchRight=!1;touchJump=!1;touchHandlers;constructor(e){this.scene=e.scene,this.getPlayerPosition=e.getPlayerPosition,this.setupKeyboardControls(),this.setupTouchControls()}setupKeyboardControls(){this.scene.input.keyboard&&(this.keyUp=this.scene.input.keyboard.addKey(O.Input.Keyboard.KeyCodes.UP,!1),this.keyLeft=this.scene.input.keyboard.addKey(O.Input.Keyboard.KeyCodes.LEFT,!1),this.keyRight=this.scene.input.keyboard.addKey(O.Input.Keyboard.KeyCodes.RIGHT,!1),this.keyA=this.scene.input.keyboard.addKey(O.Input.Keyboard.KeyCodes.A,!1),this.keyD=this.scene.input.keyboard.addKey(O.Input.Keyboard.KeyCodes.D,!1),this.keyW=this.scene.input.keyboard.addKey(O.Input.Keyboard.KeyCodes.W,!1),this.keySpace=this.scene.input.keyboard.addKey(O.Input.Keyboard.KeyCodes.SPACE,!1))}setupTouchControls(){const e=this.scene,i=o=>{const a=o.x,l=o.y,c=e.scale.width;if(a>c-lt.LANGUAGE_BUTTON.width&&l<lt.LANGUAGE_BUTTON.height||a>c-lt.SKIN_BUTTON.width&&l>=lt.SKIN_BUTTON.yOffset&&l<lt.SKIN_BUTTON.yOffset+lt.SKIN_BUTTON.height)return;const d=e.cameras.main,g=this.getPlayerPosition(),f=g.x-d.scrollX,h=g.y-d.scrollY,p=a-f,b=l-h;p<-20?(this.touchLeft=!0,this.touchRight=!1):p>lt.THRESHOLD_X?(this.touchRight=!0,this.touchLeft=!1):(this.touchLeft=!1,this.touchRight=!1),this.touchJump=b<-80},n=o=>{i(o)},r=o=>{o.isDown&&i(o)},s=()=>{this.touchLeft=!1,this.touchRight=!1,this.touchJump=!1};e.input.on("pointerdown",n),e.input.on("pointermove",r),e.input.on("pointerup",s),this.touchHandlers={pointerdown:n,pointermove:r,pointerup:s}}getInputState(){const e=this.keyA?.isDown||this.keyLeft?.isDown||this.touchLeft||!1,i=this.keyD?.isDown||this.keyRight?.isDown||this.touchRight||!1,n=this.keySpace?.isDown||this.keyW?.isDown||this.keyUp?.isDown||this.touchJump||!1;return{left:e,right:i,jump:n}}hasAnyInput(){const e=this.getInputState();return e.left||e.right||e.jump}destroy(){this.touchHandlers&&(this.scene.input.off("pointerdown",this.touchHandlers.pointerdown),this.scene.input.off("pointermove",this.touchHandlers.pointermove),this.scene.input.off("pointerup",this.touchHandlers.pointerup),this.touchHandlers=void 0)}}class Io extends O.Physics.Arcade.Sprite{animations;inputController;animState="idle";hasNotifiedMovement=!1;hasReceivedInput=!1;constructor(e,i,n){const r="white";super(e,i,n,`cat-idle-${r}`),e.add.existing(this),e.physics.add.existing(this),this.animations=new bo(e,r),this.animations.createAll(),this.inputController=new So({scene:e,getPlayerPosition:()=>({x:this.x,y:this.y})}),this.setCollideWorldBounds(!0),this.setBounce(0),this.setSize(16,12),this.setOffset(16,36),this.setScale(5),this.setDepth(Ue.PLAYER),this.animations.play(this,"idle")}changeSkin(e){this.animations.handleSkinChange(this,e)}updateJumpAnimation(e){const{animation:i,rotation:n,flipMultiplier:r}=this.animations.getJumpAnimationState(e);this.anims.currentAnim?.key!==i&&this.play(i);const s=this.flipX?n*r:-n*r;this.setAngle(s)}update(){const e=this.inputController.getInputState(),i=this.body,n=i&&(i.blocked.down||i.touching.down);switch(this.inputController.hasAnyInput()&&!this.hasReceivedInput&&(this.hasReceivedInput=!0),this.hasReceivedInput&&this.inputController.hasAnyInput()&&!this.hasNotifiedMovement&&(this.hasNotifiedMovement=!0,Dr.set(!0)),e.left?(this.setVelocityX(-350),this.setFlipX(!0),n&&(this.animState="running")):e.right?(this.setVelocityX(xn.SPEED),this.setFlipX(!1),n&&(this.animState="running")):(this.setVelocityX(0),n&&(this.animState="idle")),e.jump&&n&&(this.setVelocityY(xn.JUMP_STRENGTH),this.animState="jumping"),!n&&i&&i.velocity.y!==0&&(this.animState="jumping"),this.animState){case"idle":this.animations.play(this,"idle"),this.setAngle(0);break;case"running":this.animations.play(this,"walk"),this.setAngle(0);break;case"jumping":this.updateJumpAnimation(i.velocity.y);break}}destroy(e){this.inputController.destroy(),super.destroy(e)}}const ct=[{name:"FOREST",folder:"forest",scrollFactors:[1,.8,.85,.9,.95,1]},{name:"FOREST BLUE",folder:"forest_blue",scrollFactors:[1,.8,.85,.9,.95,1]}];class Eo{currentIndex=0;constructor(){const e=localStorage.getItem("background");if(e){const i=ct.findIndex(n=>n.folder===e);i!==-1&&(this.currentIndex=i)}}getBackground(){return ct[this.currentIndex].folder}getCurrentConfig(){return ct[this.currentIndex]}setBackground(e){const i=ct.findIndex(n=>n.folder===e);i!==-1&&(this.currentIndex=i,localStorage.setItem("background",e))}toggleBackground(){this.currentIndex=(this.currentIndex+1)%ct.length;const e=ct[this.currentIndex];return localStorage.setItem("background",e.folder),e}getAllBackgrounds(){return ct}}const gi=new Eo;function Mr(t,e){return new Promise(i=>{t.load.image(`bg0-${e.folder}`,`assets/backgrounds/${e.folder}/0.png`);for(let n=0;n<e.scrollFactors.length;n++){const r=n+1;t.load.image(`bg${r}-${e.folder}`,`assets/backgrounds/${e.folder}/${r}.png`)}t.load.once("complete",()=>{i(!0)}),t.load.once("loaderror",n=>{console.error(`Failed to load background asset: ${n.key}`),i(!1)}),t.load.start()})}function kr(t,e,i,n){const r=Math.max(i,t.scale.height),s=t.add.tileSprite(0,0,e,r,`bg0-${n.folder}`);s.setOrigin(0,0),s.setScrollFactor(1),s.setDepth(Ue.BACKGROUND_BASE),s.tilePositionX=0,s.tilePositionY=0;const o=[];for(let a=0;a<n.scrollFactors.length;a++){const c=`bg${a+1}-${n.folder}`;if(t.textures.exists(c)){const d=t.add.image(0,0,c);d.setOrigin(0,0),d.setScrollFactor(n.scrollFactors[a]),d.setDepth(Ue.BACKGROUND_LAYER_START+a),d.setDisplaySize(e,i),o.push(d)}}return{baseLayer:s,bgLayers:o}}function Lr(t,e){t&&(t.tilePositionX=e.scrollX)}function xo(t){t.bgLayers.forEach(e=>e.destroy()),t.baseLayer.destroy()}const Do={isActive:!1,config:null,selectedItemId:null,itemDepthLayer:"behind",editMode:"items",selectedDialogZoneId:null},K=pe(Do),Ao=Pe(K,t=>t.isActive),Co=Pe(K,t=>t.config),ln=pe(!0);function To(){ln.update(t=>!t)}const Or=Pe(K,t=>t.selectedItemId),Pr=Pe(K,t=>t.itemDepthLayer),jt=Pe(K,t=>t.editMode),Rr=Pe(K,t=>t.selectedDialogZoneId),cn=Pe(K,t=>t.config?.dialogZones||[]),Hr=Pe(K,t=>!t.selectedItemId||!t.config?.placedItems?null:t.config.placedItems.find(e=>e.id===t.selectedItemId)??null),Mo=Pe(Hr,t=>t?.physicsEnabled??!1);function Dn(t,e){K.update(i=>i.config?{...i,config:{...i.config,playerStartX:t,playerStartY:e}}:i)}function ko(t){K.update(e=>{if(!e.config)return e;const i=e.config.placedItems||[];return{...e,config:{...e.config,placedItems:[...i,t]}}})}function pi(t,e){K.update(i=>!i.config||!i.config.placedItems?i:{...i,config:{...i.config,placedItems:i.config.placedItems.map(n=>n.id===t?{...n,...e}:n)}})}function Nr(t){K.update(e=>!e.config||!e.config.placedItems?e:{...e,config:{...e.config,placedItems:e.config.placedItems.filter(i=>i.id!==t)},selectedItemId:e.selectedItemId===t?null:e.selectedItemId})}function vi(t){K.update(e=>({...e,selectedItemId:t}))}function un(){K.update(t=>({...t,selectedItemId:null}))}function Lo(){K.update(t=>({...t,itemDepthLayer:t.itemDepthLayer==="behind"?"front":"behind"}))}function Oo(t,e){pi(t,{depth:e})}function Po(t,e){e?(pi(t,{physicsEnabled:e,depth:an("behind")}),K.update(i=>({...i,itemDepthLayer:"behind"}))):pi(t,{physicsEnabled:e})}function Ro(t){K.set({isActive:!0,config:{...t,placedItems:t.placedItems||[],dialogZones:t.dialogZones||[]},selectedItemId:null,itemDepthLayer:"behind",editMode:"items",selectedDialogZoneId:null}),Jt.set(!1)}function Ho(){K.update(t=>{const e=t.config?{...t.config,dialogZones:(t.config.dialogZones||[]).filter(i=>i.texts.some(n=>n.title.trim()!==""||n.content.trim()!==""))}:t.config;return{...t,isActive:!1,selectedItemId:null,config:e}}),Jt.set(!1)}function No(){return on(K).config}const Jt=pe(!1);function An(t){Jt.set(t)}const $r=pe({scrollX:0,scrollY:0,viewWidth:0,viewHeight:0,worldWidth:0,worldHeight:0,zoom:1,playerX:0,playerY:0});function $o(t){$r.update(e=>({...e,...t}))}function Bo(){K.update(t=>({...t,editMode:t.editMode==="items"?"dialogs":"items",selectedItemId:null,selectedDialogZoneId:null}))}function Zo(t){K.update(e=>{if(!e.config)return e;const i=e.config.dialogZones||[];return{...e,config:{...e.config,dialogZones:[...i,t]}}})}function Zt(t,e){K.update(i=>!i.config||!i.config.dialogZones?i:{...i,config:{...i.config,dialogZones:i.config.dialogZones.map(n=>n.id===t?{...n,...e}:n)}})}function Yo(t){K.update(e=>!e.config||!e.config.dialogZones?e:{...e,config:{...e.config,dialogZones:e.config.dialogZones.filter(i=>i.id!==t)},selectedDialogZoneId:e.selectedDialogZoneId===t?null:e.selectedDialogZoneId})}function ri(t){K.update(e=>({...e,selectedDialogZoneId:t}))}function Cn(t,e,i){K.update(n=>!n.config||!n.config.dialogZones?n:{...n,config:{...n.config,dialogZones:n.config.dialogZones.map(r=>{if(r.id!==t)return r;const s=r.texts.findIndex(a=>a.language===e);let o;return s>=0?o=r.texts.map((a,l)=>l===s?{...a,...i}:a):o=[...r.texts,{language:e,title:"",content:"",...i}],{...r,texts:o}})}})}const dn=[{key:"tent",name:"Tent",path:"assets/ui/tent.png",scale:6,category:"structures"},{key:"lamp",name:"Lamp",path:"assets/ui/lamp.png",scale:8,category:"props"},{key:"sign_left",name:"Sign ←",path:"assets/ui/sign_left.png",scale:7,category:"signs"},{key:"sign_right",name:"Sign →",path:"assets/ui/sign_right.png",scale:7,category:"signs"},{key:"stone_0",name:"Stone 0",path:"assets/ui/stone_0.png",scale:4,category:"nature",supportsPhysics:!0},{key:"stone_1",name:"Stone 1",path:"assets/ui/stone_1.png",scale:5,category:"nature",supportsPhysics:!0},{key:"stone_2",name:"Stone 2",path:"assets/ui/stone_2.png",scale:4,category:"nature",supportsPhysics:!0}];function Br(t){return dn.find(e=>e.key===t)}function Wo(t){return Br(t)?.scale||1}function Go(t){return Br(t)?.supportsPhysics??!1}class Tn{scene;groundY;constructor(e,i){this.scene=e,this.groundY=i}static preloadAssets(e){dn.forEach(i=>{e.load.image(i.key,i.path)})}createSprite(e){const{id:i,assetKey:n,x:r,scale:s=1,depth:o=5,yOffset:a=0}=e,l=this.groundY+a,c=this.scene.add.sprite(r,l,n);return c.setScale(s),c.setDepth(o),c.setData("itemId",i),c}updatePosition(e,i,n){e.x=i,e.y=this.groundY+n}updateScale(e,i){e.setScale(i)}updateDepth(e,i){e.setDepth(i)}applyUpdates(e,i){i.x!==void 0&&(e.x=i.x),i.yOffset!==void 0&&(e.y=this.groundY+i.yOffset),i.scale!==void 0&&e.setScale(i.scale),i.depth!==void 0&&e.setDepth(i.depth)}worldYToOffset(e){return e-this.groundY}getGroundY(){return this.groundY}}const mi=40,Xo=48,Mn=5,Ko=Ue.PLAYER,_i=100,zo=4871528,Fo=.4,Uo=1,Zr=Ue.GRID_OVERLAY,ki=16711680,Vo=2,qo=.6,jo=.1,Jo=1,Qo=.2,kn=50,ea=50,ta=10,ia=4886754;function Ln(t,e){return Math.round(t/e)*e}class na{scene;groundY;isDragging=!1;callbacks;constructor(e,i,n={}){this.scene=e,this.groundY=i,this.callbacks=n}getIsDragging(){return this.isDragging}makeInteractive(e,i){e.setInteractive({cursor:"pointer"}),this.scene.input.setDraggable(e),e.on("pointerdown",()=>{this.isDragging||vi(i)}),e.on("dragstart",()=>{this.isDragging=!1,e.setTint(4886754),this.scene.data?.set("isDraggingItem",!0),this.callbacks.onDragStart?.(i)}),e.on("drag",(n,r,s)=>{this.isDragging=!0;const o=on(ln),a=o?Ln(r,_i):r,l=o?Ln(s,_i):s;e.setPosition(a,l),this.callbacks.onDrag?.(i,a,l)}),e.on("dragend",()=>{e.clearTint(),this.scene.data?.set("isDraggingItem",!1);const n=Math.round(e.x),s=Math.round(e.y)-this.groundY;pi(i,{x:n,yOffset:s}),this.callbacks.onDragEnd?.(i,n,s),this.scene.time.delayedCall(50,()=>{this.isDragging=!1})})}removeInteractivity(e){!e||!e.scene||(e.removeInteractive(),e.off("pointerdown"),e.off("dragstart"),e.off("drag"),e.off("dragend"))}}const ra={lineWidth:3,lineColor:4886754,lineAlpha:1,handleSize:8,handleColor:4886754,padding:5};class sa{scene;graphics;style;selectedId=null;constructor(e,i={}){this.scene=e,this.style={...ra,...i},this.graphics=e.add.graphics(),this.graphics.setDepth(Ue.SELECTION_GRAPHICS)}setSelectedId(e){this.selectedId=e}getSelectedId(){return this.selectedId}updateVisuals(e){if(this.graphics.clear(),!e||!this.selectedId)return;const i=e.getBounds(),{lineWidth:n,lineColor:r,lineAlpha:s,handleSize:o,handleColor:a,padding:l}=this.style;this.graphics.lineStyle(n,r,s),this.graphics.strokeRect(i.x-l,i.y-l,i.width+l*2,i.height+l*2),this.graphics.fillStyle(a,1),this.graphics.fillCircle(i.x,i.y,o),this.graphics.fillCircle(i.x+i.width,i.y,o),this.graphics.fillCircle(i.x,i.y+i.height,o),this.graphics.fillCircle(i.x+i.width,i.y+i.height,o)}clearVisuals(){this.graphics.clear(),this.selectedId=null}setupBackgroundDeselect(e){this.scene.input.on("pointerdown",i=>{if(e())return;this.scene.input.hitTestPointer(i).find(r=>r.type==="Sprite"&&r.getData("itemId"))||(un(),this.clearVisuals())})}destroy(){this.graphics?.destroy()}}class yi{scene;items=new Map;isBuilderMode=!1;physicsGroup=null;renderer;dragController;selectionManager;constructor(e,i,n=!1){this.scene=e,this.isBuilderMode=n,this.renderer=new Tn(e,i),n||(this.physicsGroup=e.physics.add.staticGroup()),this.isBuilderMode&&(this.dragController=new na(e,i,{onDrag:()=>this.updateSelectionVisuals()}),this.selectionManager=new sa(e))}static preloadAssets(e){Tn.preloadAssets(e)}createItems(e){e.forEach(i=>{this.createItem(i)})}createItem(e){const i=this.renderer.createSprite(e),n={sprite:i,data:e};if(!this.isBuilderMode&&e.physicsEnabled&&this.physicsGroup){const r=this.createPhysicsBody(i,e);n.physicsBody=r}this.items.set(e.id,n),this.isBuilderMode&&this.dragController&&(this.dragController.makeInteractive(i,e.id),i.on("pointerdown",()=>{this.dragController?.getIsDragging()||(vi(e.id),this.updateSelectionVisuals())}))}createPhysicsBody(e,i){const n=e.getBounds(),r=n.width*.5,s=n.height*.8,o=e.x,a=e.y,l=this.scene.add.rectangle(o,a,r,s);return l.setVisible(!1),this.physicsGroup.add(l),l.setData("itemId",i.id),l}updateSelectionVisuals(){if(!this.selectionManager)return;const e=this.scene.data.get("selectedItemId");if(this.selectionManager.setSelectedId(e),!e){this.selectionManager.clearVisuals();return}const i=this.items.get(e);this.selectionManager.updateVisuals(i?.sprite??null)}updateItem(e,i){const n=this.items.get(e);n&&(this.renderer.applyUpdates(n.sprite,i),n.data={...n.data,...i})}removeItem(e){const i=this.items.get(e);i&&(this.dragController&&this.dragController.removeInteractivity(i.sprite),i.physicsBody&&i.physicsBody.destroy(),i.sprite.destroy(),this.items.delete(e))}removeAllItems(){this.items.forEach(e=>{!e.sprite||!e.sprite.scene||(this.dragController&&this.dragController.removeInteractivity(e.sprite),e.physicsBody&&e.physicsBody.destroy(),e.sprite.destroy())}),this.items.clear()}getItem(e){return this.items.get(e)?.data}getAllItems(){return Array.from(this.items.values()).map(e=>e.data)}getPhysicsGroup(){return this.physicsGroup}setInteractiveEnabled(e){!this.isBuilderMode||!this.dragController||(this.items.forEach(({sprite:i,data:n})=>{e?(this.dragController.makeInteractive(i,n.id),i.setAlpha(1),i.on("pointerdown",()=>{this.dragController?.getIsDragging()||(vi(n.id),this.updateSelectionVisuals())})):(i.disableInteractive(),i.off("pointerdown"),i.setAlpha(.6))}),!e&&this.selectionManager&&this.selectionManager.clearVisuals())}destroy(){this.removeAllItems(),this.selectionManager?.destroy()}setupBackgroundDeselect(){!this.isBuilderMode||!this.selectionManager||this.selectionManager.setupBackgroundDeselect(()=>this.dragController?.getIsDragging()??!1)}}async function On(){const t=await fetch("./config/map.json");if(!t.ok)throw new Error(`Failed to load map config: ${t.status}`);const e=await t.json();if(!e.worldWidth||!e.worldHeight)throw new Error("Invalid map config structure");return e}const si={generateId(){return`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`},create(t){const{assetKey:e,x:i,yOffset:n=0,depthLayer:r="behind",scale:s}=t;return{id:si.generateId(),assetKey:e,x:Math.round(i),y:0,scale:s??Wo(e),depth:an(r),yOffset:Math.round(n)}},createAtWorldPosition(t,e,i,n,r="behind"){return si.create({assetKey:t,x:e,yOffset:i-n,depthLayer:r})},clone(t,e=50){return{...t,id:si.generateId(),x:t.x+e}}},ut={HEIGHT:40,VISUAL:{COLOR:9139029,ALPHA:.3},PHYSICS:{COLOR:0,ALPHA:0}},zt={getGroundY(t,e=ut.HEIGHT){return t-e},createVisualGround(t,e){const i=e.height??ut.HEIGHT,n=zt.getGroundY(e.worldHeight,i),r=t.add.rectangle(0,n,e.worldWidth,i,e.color??ut.VISUAL.COLOR,e.alpha??ut.VISUAL.ALPHA);return r.setOrigin(0,0),r.setDepth(e.depth??Ue.GROUND_REFERENCE),{ground:r,groundY:n}},createPhysicsGround(t,e){const i=e.height??ut.HEIGHT,n=zt.getGroundY(e.worldHeight,i),r=t.add.rectangle(0,n,e.worldWidth,i,e.color??ut.PHYSICS.COLOR,e.alpha??ut.PHYSICS.ALPHA);return r.setOrigin(0,0),t.physics.add.existing(r,!0),{ground:r,groundY:n}},addPlayerCollision(t,e,i){return t.physics.add.collider(e,i)}},Ke={GAME:"GameScene",BUILDER:"BuilderScene"};class oa extends O.Scene{player;mapConfig;parallaxLayers=null;loadedBackgrounds=new Set;itemManager;dialogZones=[];currentDialogZone=null;unsubscribers=[];initData;constructor(){super({key:Ke.GAME})}init(e){this.initData=e}preload(){Be.forEach(e=>{this.load.spritesheet(`cat-idle-${e}`,`assets/sprites/${e}/Idle.png`,{frameWidth:48,frameHeight:48}),this.load.spritesheet(`cat-walk-${e}`,`assets/sprites/${e}/Walk.png`,{frameWidth:48,frameHeight:48})}),yi.preloadAssets(this)}create(){this.initializeScene()}async initializeScene(){Xi.set(!0);try{await this.loadMapConfiguration();const e=gi.getCurrentConfig();await this.loadBackgroundIfNeeded(e),this.createParallaxBackground();const{ground:i,groundY:n}=zt.createPhysicsGround(this,{worldWidth:this.mapConfig.worldWidth,worldHeight:this.mapConfig.worldHeight});this.player=new Io(this,this.mapConfig.playerStartX,this.mapConfig.playerStartY),zt.addPlayerCollision(this,this.player,i),this.itemManager=new yi(this,n,!1),this.mapConfig.placedItems&&this.mapConfig.placedItems.length>0&&this.itemManager.createItems(this.mapConfig.placedItems);const r=this.itemManager.getPhysicsGroup();r&&this.physics.add.collider(this.player,r),this.dialogZones=this.mapConfig.dialogZones||[];const s=cn.subscribe(o=>{this.dialogZones=o,this.recheckCurrentZone()});this.unsubscribers.push(s),this.cameras.main.startFollow(this.player,!0,.1,.1),this.cameras.main.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.physics.world.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.scale.on("resize",this.handleResize,this)}catch(e){console.error("[GameScene] Failed to initialize scene:",e)}finally{Xi.set(!1)}}async loadMapConfiguration(){try{if(this.initData?.useBuilderConfig){const e=No();this.mapConfig=e||await On()}else this.mapConfig=await On()}catch(e){console.error("[GameScene] Failed to load map configuration:",e),this.mapConfig={worldWidth:3200,worldHeight:600,playerStartX:400,playerStartY:300,placedItems:[]}}}createParallaxBackground(){const e=gi.getCurrentConfig();this.parallaxLayers=kr(this,this.mapConfig.worldWidth,this.mapConfig.worldHeight,e)}async loadBackgroundIfNeeded(e){if(this.loadedBackgrounds.has(e.folder))return!0;const i=await Mr(this,e);return i&&this.loadedBackgrounds.add(e.folder),i}handleResize(e){if(!(!this.cameras?.main||!this.mapConfig)&&(this.cameras.main.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.parallaxLayers?.baseLayer)){const i=Math.max(this.mapConfig.worldHeight,e.height);this.parallaxLayers.baseLayer.setSize(this.mapConfig.worldWidth,i)}}shutdown(){this.scale.off("resize",this.handleResize,this),Mi(null),this.currentDialogZone=null,this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.itemManager&&this.itemManager.destroy()}update(){if(!this.player)return;this.player.update();const e=this.cameras.main,i=this.player.x-e.scrollX,n=this.player.y-e.scrollY;_o(i,n),this.checkDialogZones(),this.parallaxLayers&&Lr(this.parallaxLayers.baseLayer,this.cameras.main)}checkDialogZones(){const e=this.player.x;let i=null;for(const n of this.dialogZones)if(e>=n.x&&e<=n.x+n.width){i=n;break}i?.id!==this.currentDialogZone?.id&&(this.currentDialogZone=i,Mi(i))}recheckCurrentZone(){if(!this.currentDialogZone)return;const e=this.dialogZones.find(i=>i.id===this.currentDialogZone?.id);e&&(this.currentDialogZone=e,Mi(e))}}function oi(){const t=document.activeElement;if(!t)return!1;const e=t.tagName.toUpperCase();return e==="INPUT"||e==="TEXTAREA"||t.getAttribute("contenteditable")==="true"}const aa=.05,la=1,ii=400;class ca{scene;camera;worldWidth;worldHeight;isPanning=!1;panStartX=0;cameraDragStartX=0;isDraggingToScroll=!1;dragScrollStartX=0;dragScrollStartY=0;dragScrollCameraStartX=0;dragScrollCameraStartY=0;isZoomedOut=!1;isAnimating=!1;savedScrollX=0;savedScrollY=0;constructor(e,i,n){this.scene=e,this.camera=e.cameras.main,this.worldWidth=i,this.worldHeight=n}setup(){this.setupCamera(),this.setupMouseControls(),this.setupKeyboardControls()}setupCamera(){this.camera.setBounds(0,0,this.worldWidth,this.worldHeight),this.camera.setZoom(1)}centerOn(e,i){this.camera.centerOn(e,i)}setupMouseControls(){this.scene.input.on("wheel",(e,i,n,r)=>{if(this.isZoomedOut)return;const s=n!==0?n:r,o=this.camera.scrollX+s;this.camera.setScroll(O.Math.Clamp(o,0,this.worldWidth-this.camera.width),this.camera.scrollY)}),this.scene.input.on("pointerdown",e=>{this.isZoomedOut||(e.rightButtonDown()||e.middleButtonDown()?(this.isPanning=!0,this.panStartX=e.x,this.cameraDragStartX=this.camera.scrollX):e.leftButtonDown()&&!this.isDraggingObject()&&(this.scene.data.get("isDraggingItem")===!0||(this.dragScrollStartX=e.x,this.dragScrollStartY=e.y,this.dragScrollCameraStartX=this.camera.scrollX,this.dragScrollCameraStartY=this.camera.scrollY)))}),this.scene.input.on("pointermove",e=>{if(!this.isZoomedOut){if(this.isPanning){const i=e.x-this.panStartX,n=this.cameraDragStartX-i;this.camera.setScroll(O.Math.Clamp(n,0,this.worldWidth-this.camera.width),this.camera.scrollY)}else if(e.leftButtonDown()&&!this.isDraggingToScroll&&!this.isDraggingObject()&&!(this.scene.data.get("isDraggingItem")===!0)){const n=Math.abs(e.x-this.dragScrollStartX),r=Math.abs(e.y-this.dragScrollStartY);Math.sqrt(n*n+r*r)>10&&(this.isDraggingToScroll=!0,this.scene.input.setDefaultCursor("grabbing"))}if(this.isDraggingToScroll){const i=e.x-this.dragScrollStartX,n=e.y-this.dragScrollStartY,r=this.dragScrollCameraStartX-i,s=this.dragScrollCameraStartY-n;this.camera.setScroll(O.Math.Clamp(r,0,this.worldWidth-this.camera.width),O.Math.Clamp(s,0,this.worldHeight-this.camera.height))}}}),this.scene.input.on("pointerup",e=>{!e.rightButtonDown()&&!e.middleButtonDown()&&(this.isPanning=!1),this.isDraggingToScroll&&(this.isDraggingToScroll=!1,this.scene.input.setDefaultCursor("default"))})}setupKeyboardControls(){const e={up:this.scene.input.keyboard.addKey(O.Input.Keyboard.KeyCodes.UP,!1),down:this.scene.input.keyboard.addKey(O.Input.Keyboard.KeyCodes.DOWN,!1),left:this.scene.input.keyboard.addKey(O.Input.Keyboard.KeyCodes.LEFT,!1),right:this.scene.input.keyboard.addKey(O.Input.Keyboard.KeyCodes.RIGHT,!1)},i={w:this.scene.input.keyboard.addKey(O.Input.Keyboard.KeyCodes.W,!1),a:this.scene.input.keyboard.addKey(O.Input.Keyboard.KeyCodes.A,!1),s:this.scene.input.keyboard.addKey(O.Input.Keyboard.KeyCodes.S,!1),d:this.scene.input.keyboard.addKey(O.Input.Keyboard.KeyCodes.D,!1)};this.scene.input.keyboard.addKey(O.Input.Keyboard.KeyCodes.SPACE,!1).on("down",()=>{oi()||this.isZoomedOut||this.centerOnPlayer()}),this.scene.input.keyboard.addKey(O.Input.Keyboard.KeyCodes.F,!1).on("down",()=>{oi()||this.toggleZoomToFit()}),this.scene.events.on("update",()=>{if(this.isZoomedOut||oi())return;const s=10;e.left.isDown||i.a.isDown?this.camera.scrollX=Math.max(0,this.camera.scrollX-s):(e.right.isDown||i.d.isDown)&&(this.camera.scrollX=Math.min(this.worldWidth-this.camera.width,this.camera.scrollX+s)),e.up.isDown||i.w.isDown?this.camera.scrollY=Math.max(0,this.camera.scrollY-s):(e.down.isDown||i.s.isDown)&&(this.camera.scrollY=Math.min(this.worldHeight-this.camera.height,this.camera.scrollY+s))})}centerOnPlayer(){const e=this.scene.data.get("playerSprite");e&&this.camera.centerOn(e.x,e.y)}isDraggingObject(){return this.scene.data.get("isDraggingObject")===!0}getIsZoomedOut(){return this.isZoomedOut}toggleZoomToFit(){this.isZoomedOut?this.resetZoom():this.zoomToFit()}zoomToFit(){if(this.isZoomedOut||this.isAnimating)return;this.savedScrollX=this.camera.scrollX,this.savedScrollY=this.camera.scrollY,this.isZoomedOut=!0,this.isAnimating=!0,An(!0);const e=this.camera.width/this.worldWidth,i=this.camera.height/this.worldHeight;let n=Math.min(e,i);n=Math.max(n,aa);const r=this.worldWidth/2,s=this.worldHeight/2;this.camera.removeBounds(),this.camera.pan(r,s,ii,"Sine.easeInOut"),this.camera.zoomTo(n,ii,"Sine.easeInOut",!1,(o,a)=>{a===1&&(this.isAnimating=!1)})}resetZoom(){if(!this.isZoomedOut||this.isAnimating)return;this.isZoomedOut=!1,this.isAnimating=!0,An(!1);const e=this.savedScrollX+this.camera.width/2,i=this.savedScrollY+this.camera.height/2;this.camera.pan(e,i,ii,"Sine.easeInOut"),this.camera.zoomTo(la,ii,"Sine.easeInOut",!1,(n,r)=>{r===1&&(this.camera.setBounds(0,0,this.worldWidth,this.worldHeight),this.isAnimating=!1)})}destroy(){}}class ua{scene;player;worldWidth;worldHeight;groundY;unsubscribers=[];constructor(e,i,n){this.scene=e,this.worldWidth=i,this.worldHeight=n,this.groundY=n-mi}create(e,i){this.player=this.scene.add.sprite(e,i,"cat-idle-white",0),this.player.setScale(Mn),this.player.setDepth(Ko);const n=new O.Geom.Rectangle(8,4,32,40);return this.player.setInteractive({hitArea:n,hitAreaCallback:O.Geom.Rectangle.Contains,draggable:!0,cursor:"grab"}),this.scene.data.set("playerSprite",this.player),this.setupDragHandlers(),this.setupEditModeSubscription(),this.player}setupEditModeSubscription(){const e=jt.subscribe(i=>{if(i==="dialogs")this.player.disableInteractive(),this.player.setAlpha(.6);else{const n=new O.Geom.Rectangle(8,4,32,40);this.player.setInteractive({hitArea:n,hitAreaCallback:O.Geom.Rectangle.Contains,draggable:!0,cursor:"grab"}),this.player.setAlpha(1)}});this.unsubscribers.push(e)}setupDragHandlers(){this.player.on("dragstart",()=>{this.player.setTint(ia),this.scene.data.set("isDraggingObject",!0)}),this.player.on("drag",(e,i,n)=>{const r=O.Math.Clamp(i,kn,this.worldWidth-kn),s=O.Math.Clamp(n,ea,this.worldHeight-ta);this.player.setPosition(r,s),Dn(Math.round(r),Math.round(s))}),this.player.on("dragend",()=>{this.player.clearTint(),this.scene.data.set("isDraggingObject",!1);let e=this.player.y;const i=Xo*Mn;this.player.y+i/2>this.groundY&&(e=this.groundY-i/2,this.player.setY(e)),Dn(Math.round(this.player.x),Math.round(e))})}getSprite(){return this.player}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.player&&this.player.destroy()}}class da{scene;graphics;worldWidth;worldHeight;constructor(e,i,n){this.scene=e,this.worldWidth=i,this.worldHeight=n}create(){return this.graphics=this.scene.add.graphics(),this.graphics.setDepth(Zr),this.draw(),this.graphics}draw(){this.graphics.clear(),this.graphics.lineStyle(Uo,zo,Fo);const e=Math.max(this.worldHeight,this.scene.scale.height);for(let n=0;n<=this.worldWidth;n+=_i)this.graphics.beginPath(),this.graphics.moveTo(n,0),this.graphics.lineTo(n,e),this.graphics.strokePath();for(let n=0;n<=e;n+=_i)this.graphics.beginPath(),this.graphics.moveTo(0,n),this.graphics.lineTo(this.worldWidth,n),this.graphics.strokePath();const i=this.worldHeight-mi;this.graphics.lineStyle(Vo,ki,qo),this.graphics.beginPath(),this.graphics.moveTo(0,i),this.graphics.lineTo(this.worldWidth,i),this.graphics.strokePath(),this.graphics.lineStyle(Jo,ki,Qo),this.graphics.fillStyle(ki,jo),this.graphics.fillRect(0,i,this.worldWidth,e-i)}getGraphics(){return this.graphics}redraw(){this.draw()}destroy(){this.graphics&&this.graphics.destroy()}}class ha{listeners=new Map;on(e,i){this.listeners.has(e)||this.listeners.set(e,new Set);const n=this.listeners.get(e);return n.add(i),{unsubscribe:()=>{n.delete(i),n.size===0&&this.listeners.delete(e)}}}once(e,i){const n=this.on(e,r=>{n.unsubscribe(),i(r)});return n}emit(e,i){const n=this.listeners.get(e);n&&n.forEach(r=>{try{r(i)}catch(s){console.error(`[EventBus] Error in listener for "${e}":`,s)}})}off(e){this.listeners.delete(e)}clear(){this.listeners.clear()}listenerCount(e){return this.listeners.get(e)?.size??0}}const mt=new ha,_t={ASSET_DROPPED:"asset:dropped",MINIMAP_NAVIGATE:"minimap:navigate",DIALOG_ZONE_CREATE:"dialogZone:create"};class fa{scene;groundY;itemManager;unsubscribers=[];constructor(e,i){this.scene=e,this.groundY=i}create(e){return this.itemManager=new yi(this.scene,this.groundY,!0),e&&e.length>0&&this.itemManager.createItems(e),this.setupBackgroundDeselect(),this.setupStoreSubscriptions(),this.setupAssetDropListener(),this.setupDeleteKeys(),this.itemManager}setupBackgroundDeselect(){this.itemManager.setupBackgroundDeselect()}setupStoreSubscriptions(){const e=Or.subscribe(s=>{this.scene.data.set("selectedItemId",s),this.itemManager.updateSelectionVisuals()});this.unsubscribers.push(e);const i=jt.subscribe(s=>{s==="dialogs"?(un(),this.itemManager.setInteractiveEnabled(!1)):this.itemManager.setInteractiveEnabled(!0)});this.unsubscribers.push(i);let n=[];const r=Co.subscribe(s=>{if(!s?.placedItems)return;const o=s.placedItems;n.forEach(a=>{o.find(c=>c.id===a.id)||this.itemManager.removeItem(a.id)}),o.forEach(a=>{const l=n.find(c=>c.id===a.id);l&&JSON.stringify(l)!==JSON.stringify(a)&&this.itemManager.updateItem(a.id,a)}),n=o.map(a=>({...a}))});this.unsubscribers.push(r)}setupAssetDropListener(){const e=mt.on(_t.ASSET_DROPPED,i=>{const{assetKey:n,canvasX:r,canvasY:s}=i,a=this.scene.cameras.main.getWorldPoint(r,s),l=a.x,c=a.y;let d="behind";Pr.subscribe(h=>{d=h})();const f=si.createAtWorldPosition(n,l,c,this.groundY,d);ko(f),this.itemManager.createItem(f),vi(f.id)});this.unsubscribers.push(()=>e.unsubscribe())}setupDeleteKeys(){const e=this.scene.input.keyboard.addKey(O.Input.Keyboard.KeyCodes.DELETE,!1),i=this.scene.input.keyboard.addKey(O.Input.Keyboard.KeyCodes.BACKSPACE,!1),n=()=>{if(oi())return;const r=this.scene.data.get("selectedItemId");r&&Nr(r)};e.on("down",n),i.on("down",n)}getManager(){return this.itemManager}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.itemManager&&this.itemManager.destroy()}}const ni=Zr-1,Qe=50,Pn=150,ga=.3,pa=.5,Li=16,Rn=16777215,Hn=.6,Nn=0;class va{scene;worldWidth;worldHeight;graphics=null;zoneAreas=new Map;leftHandles=new Map;rightHandles=new Map;dragging=null;unsubscribers=[];createZoneSubscription;currentEditMode="items";currentZones=[];currentSelectedId=null;constructor(e,i,n){this.scene=e,this.worldWidth=i,this.worldHeight=n}create(){this.graphics=this.scene.add.graphics(),this.graphics.setDepth(ni);const e=jt.subscribe(r=>{this.currentEditMode=r,this.render()});this.unsubscribers.push(e);const i=cn.subscribe(r=>{this.currentZones=r,this.render()});this.unsubscribers.push(i);const n=Rr.subscribe(r=>{this.currentSelectedId=r,this.render()});this.unsubscribers.push(n),this.scene.input.on("pointermove",this.handlePointerMove,this),this.scene.input.on("pointerup",this.handlePointerUp,this),this.scene.input.on("pointerdown",this.handlePointerDown,this),this.createZoneSubscription=mt.on(_t.DIALOG_ZONE_CREATE,()=>{this.createNewZone()}),this.render()}clearVisuals(){this.graphics&&this.graphics.clear(),this.zoneAreas.forEach(e=>e.destroy()),this.zoneAreas.clear(),this.leftHandles.forEach(e=>e.destroy()),this.leftHandles.clear(),this.rightHandles.forEach(e=>e.destroy()),this.rightHandles.clear()}render(){if(this.clearVisuals(),this.currentEditMode==="dialogs")for(const e of this.currentZones)this.renderZone(e,e.id===this.currentSelectedId)}renderZone(e,i){if(!this.graphics)return;const n=O.Display.Color.HexStringToColor(e.color).color,r=i?pa:ga;this.graphics.fillStyle(n,r),this.graphics.fillRect(e.x,0,e.width,this.worldHeight),this.graphics.lineStyle(2,n,.8),this.graphics.strokeRect(e.x,0,e.width,this.worldHeight);const s=this.scene.add.rectangle(e.x+e.width/2,this.worldHeight/2,e.width-Li*2,this.worldHeight);s.setOrigin(.5,.5),s.setInteractive({cursor:i?"grab":"pointer"}),s.setDepth(ni+.1),s.setAlpha(.001),s.setData("zoneId",e.id),s.on("pointerdown",o=>{this.scene.data.set("isDraggingItem",!0),this.currentSelectedId===e.id?this.startDrag(e.id,"move",o.worldX):(ri(e.id),this.scene.data.set("isDraggingItem",!1))}),this.zoneAreas.set(e.id,s),i&&this.createHandles(e)}createHandles(e){const i=this.scene.add.rectangle(e.x,this.worldHeight/2,Li,this.worldHeight);i.setOrigin(.5,.5),i.setInteractive({cursor:"ew-resize"}),i.setDepth(ni+.2),i.setFillStyle(Rn,Hn),i.setData("zoneId",e.id),i.setData("type","left"),i.on("pointerdown",r=>{this.startDrag(e.id,"left",r.worldX)}),this.leftHandles.set(e.id,i);const n=this.scene.add.rectangle(e.x+e.width,this.worldHeight/2,Li,this.worldHeight);n.setOrigin(.5,.5),n.setInteractive({cursor:"ew-resize"}),n.setDepth(ni+.2),n.setFillStyle(Rn,Hn),n.setData("zoneId",e.id),n.setData("type","right"),n.on("pointerdown",r=>{this.startDrag(e.id,"right",r.worldX)}),this.rightHandles.set(e.id,n)}startDrag(e,i,n){const r=this.currentZones.find(s=>s.id===e);r&&(this.scene.data.set("isDraggingItem",!0),this.dragging={zoneId:e,type:i,startX:n,originalX:r.x,originalWidth:r.width})}getZoneBounds(e){let i=0,n=this.worldWidth;for(const r of this.currentZones){if(r.id===e)continue;const s=r.x+r.width,o=this.currentZones.find(a=>a.id===e);o&&(s<=o.x+o.width/2&&(i=Math.max(i,s+Nn)),r.x>=o.x+o.width/2&&(n=Math.min(n,r.x-Nn)))}return{minX:i,maxX:n-Qe,maxRight:n}}wouldOverlap(e,i,n){const r=i+n;for(const s of this.currentZones){if(s.id===e)continue;const o=s.x,a=s.x+s.width;if(i<a&&r>o)return!0}return!1}handlePointerMove(e){if(!this.dragging)return;e.event?.stopPropagation?.();const i=e.worldX-this.dragging.startX,n=this.currentZones.find(s=>s.id===this.dragging?.zoneId);if(!n)return;const r=this.getZoneBounds(n.id);if(this.dragging.type==="left"){let s=this.dragging.originalX+i,o=this.dragging.originalWidth-i;if(s<0&&(o+=s,s=0),o<Qe&&(s=this.dragging.originalX+this.dragging.originalWidth-Qe,o=Qe),s<r.minX){const a=r.minX-s;s=r.minX,o-=a}o>=Qe&&!this.wouldOverlap(n.id,s,o)&&Zt(n.id,{x:s,width:o})}else if(this.dragging.type==="right"){let s=this.dragging.originalWidth+i;s<Qe&&(s=Qe),n.x+s>this.worldWidth&&(s=this.worldWidth-n.x),n.x+s>r.maxRight&&(s=r.maxRight-n.x),s>=Qe&&!this.wouldOverlap(n.id,n.x,s)&&Zt(n.id,{width:s})}else if(this.dragging.type==="move"){let s=this.dragging.originalX+i;const o=n.width;if(s<0&&(s=0),s+o>this.worldWidth&&(s=this.worldWidth-o),!this.wouldOverlap(n.id,s,o))Zt(n.id,{x:s});else{const a=this.findNonOverlappingPosition(n.id,s,o);a!==null&&Zt(n.id,{x:a})}}}findNonOverlappingPosition(e,i,n){const r=this.currentZones.filter(d=>d.id!==e).sort((d,g)=>d.x-g.x);if(r.length===0)return Math.max(0,Math.min(i,this.worldWidth-n));let s=i,o=1/0;const a=r[0];if(a.x>=n){const d=a.x-n,g=Math.max(0,Math.min(i,d)),f=Math.abs(g-i);f<o&&(o=f,s=g)}for(let d=0;d<r.length-1;d++){const g=r[d],f=r[d+1],h=g.x+g.width,p=f.x;if(p-h>=n){const T=h,k=p-n,L=Math.max(T,Math.min(i,k)),H=Math.abs(L-i);H<o&&(o=H,s=L)}}const l=r[r.length-1],c=l.x+l.width;if(this.worldWidth-c>=n){const d=c,g=this.worldWidth-n,f=Math.max(d,Math.min(i,g)),h=Math.abs(f-i);h<o&&(o=h,s=f)}return o<1/0&&!this.wouldOverlap(e,s,n)?s:null}handlePointerUp(){this.dragging&&this.scene.data.set("isDraggingItem",!1),this.dragging=null}handlePointerDown(e){if(this.currentEditMode!=="dialogs"||this.dragging)return;const i=e.downElement;if(i&&i.tagName?.toUpperCase()!=="CANVAS")return;const n=e.worldX;for(const r of this.currentZones)if(n>=r.x&&n<=r.x+r.width)return;this.currentSelectedId&&ri(null)}createNewZone(){const e=this.scene.cameras.main;let n=e.scrollX+e.width/2-Pn/2;const r=Pn;if(n=Math.max(0,Math.min(this.worldWidth-r,n)),this.wouldOverlap("",n,r)){const o=this.findNonOverlappingPosition("",n,r);if(o===null){console.warn("No room for a new dialog zone");return}n=o}const s=fo(n,r);s.x=n,Zo(s),ri(s.id)}destroy(){for(const e of this.unsubscribers)e();this.unsubscribers=[],this.createZoneSubscription&&this.createZoneSubscription.unsubscribe(),this.scene.input.off("pointerdown",this.handlePointerDown,this),this.scene.input.off("pointermove",this.handlePointerMove,this),this.scene.input.off("pointerup",this.handlePointerUp,this),this.clearVisuals(),this.graphics&&(this.graphics.destroy(),this.graphics=null),this.dragging=null}}class ma extends O.Scene{parallaxLayers=null;cameraController;playerController;gridOverlay;itemsController;dialogZoneRenderer;config;minimapSubscription;isShuttingDown=!1;get itemManager(){return this.itemsController?.getManager()}toggleZoom(){this.cameraController?.toggleZoomToFit()}constructor(){super({key:Ke.BUILDER})}init(e){this.config=e.config}preload(){this.load.spritesheet("cat-idle-white","assets/sprites/white/Idle.png",{frameWidth:48,frameHeight:48}),yi.preloadAssets(this)}create(){this.isShuttingDown=!1,this.physics.world.setBounds(0,0,this.config.worldWidth,this.config.worldHeight);const e=this.config.worldHeight-mi;this.cameraController=new ca(this,this.config.worldWidth,this.config.worldHeight),this.playerController=new ua(this,this.config.worldWidth,this.config.worldHeight),this.gridOverlay=new da(this,this.config.worldWidth,this.config.worldHeight),this.itemsController=new fa(this,e),this.dialogZoneRenderer=new va(this,this.config.worldWidth,this.config.worldHeight),this.createBackground(),this.gridOverlay.create(),this.createGroundReference(),this.playerController.create(this.config.playerStartX,this.config.playerStartY),this.itemsController.create(this.config.placedItems||[]),this.dialogZoneRenderer.create(),this.cameraController.setup(),this.cameraController.centerOn(this.config.playerStartX,this.config.playerStartY),this.minimapSubscription=mt.on(_t.MINIMAP_NAVIGATE,i=>{this.navigateToPosition(i.worldX,i.worldY)}),this.scale.on("resize",this.handleResize,this),this.events.on("shutdown",this.shutdown,this)}async createBackground(){const e=gi.getCurrentConfig();try{await Mr(this,e)}catch(i){console.error("Failed to load background:",i);return}this.parallaxLayers&&(xo(this.parallaxLayers),this.parallaxLayers=null),this.parallaxLayers=kr(this,this.config.worldWidth,this.config.worldHeight,e)}createGroundReference(){zt.createVisualGround(this,{worldWidth:this.config.worldWidth,worldHeight:this.config.worldHeight,height:mi})}update(){this.parallaxLayers&&Lr(this.parallaxLayers.baseLayer,this.cameras.main);const e=this.cameras.main,i=this.data.get("playerSprite");$o({scrollX:e.scrollX,scrollY:e.scrollY,viewWidth:e.width,viewHeight:e.height,worldWidth:this.config.worldWidth,worldHeight:this.config.worldHeight,zoom:e.zoom,playerX:i?.x??this.config.playerStartX,playerY:i?.y??this.config.playerStartY})}navigateToPosition(e,i){this.cameraController.getIsZoomedOut()||this.cameraController.centerOn(e,i)}handleResize(e){if(!(!this.cameras?.main||!this.config)){if(this.cameraController?.getIsZoomedOut()||this.cameras.main.setBounds(0,0,this.config.worldWidth,this.config.worldHeight),this.parallaxLayers?.baseLayer){const i=Math.max(this.config.worldHeight,e.height);this.parallaxLayers.baseLayer.setSize(this.config.worldWidth,i)}this.gridOverlay&&this.gridOverlay.redraw()}}shutdown(){this.isShuttingDown||(this.isShuttingDown=!0,this.scale.off("resize",this.handleResize,this),this.minimapSubscription&&this.minimapSubscription.unsubscribe(),this.cameraController&&this.cameraController.destroy(),this.playerController&&this.playerController.destroy(),this.gridOverlay&&this.gridOverlay.destroy(),this.itemsController&&this.itemsController.destroy(),this.dialogZoneRenderer&&this.dialogZoneRenderer.destroy())}}const _a="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(_a);hs();class ya{currentLanguage="cs";setLanguage(e){this.currentLanguage=e,localStorage.setItem("language",e)}getLanguage(){const e=localStorage.getItem("language");return(e==="cs"||e==="en")&&(this.currentLanguage=e),this.currentLanguage}toggleLanguage(){return this.currentLanguage=this.currentLanguage==="cs"?"en":"cs",this.setLanguage(this.currentLanguage),this.currentLanguage}}const Yr=new ya;let Ee=null;function wa(t){Ee=t}function ba(){if(!Ee)return console.error("Scene manager not initialized"),null;try{return Ee.scene.getScene(Ke.GAME)?.mapConfig||null}catch(t){return console.error("Failed to get map config:",t),null}}function Sa(t){if(!Ee)return console.error("Scene manager not initialized"),!1;try{return Ee.scene.getScene(Ke.GAME)?(Ee.scene.stop(Ke.GAME),Ro(t),Ee.scene.start(Ke.BUILDER,{config:t}),!0):(console.error("GameScene not found"),!1)}catch(e){return console.error("Failed to switch to builder:",e),!1}}function Ia(){if(!Ee)return console.error("Scene manager not initialized"),!1;try{return Ee.scene.stop(Ke.BUILDER),Ho(),Ee.scene.start(Ke.GAME,{useBuilderConfig:!0}),!0}catch(t){return console.error("Failed to switch to game:",t),!1}}function Ea(){if(Ee)try{Ee.scene.getScene(Ke.BUILDER)?.toggleZoom()}catch(t){console.error("Failed to toggle zoom:",t)}}var xa=X("<button><!></button>");function Se(t,e){let i=de(e,"position",3,"inline"),n=de(e,"variant",3,"default"),r=de(e,"disabled",3,!1),s=de(e,"title",3,"");const o={default:{base:"#4a90e2",hover:"#357abd",active:"#2a5f8f"},green:{base:"#27ae60",hover:"#229954",active:"#1e8449"},blue:{base:"#3498db",hover:"#2980b9",active:"#21618c"},orange:{base:"#ffa500",hover:"#ff8c00",active:"#e67e00"},red:{base:"#e74c3c",hover:"#c0392b",active:"#a02e22"}},a=q(()=>o[n()]),l=q(()=>e.width?`--btn-width: ${e.width};`:"");var c=xa();let d;c.__click=function(...f){e.onclick?.apply(this,f)};var g=N(c);Yi(g,()=>e.children??We),oe(()=>{d=Fe(c,1,`pixel-btn pixel-btn--${i()??""}`,"svelte-lwc0vq",d,{disabled:r()}),rt(c,`${u(l)??""} --color-base: ${u(a).base??""}; --color-hover: ${u(a).hover??""}; --color-active: ${u(a).active??""}`),c.disabled=r(),st(c,"title",s())}),C(t,c)}Pt(["click"]);var Da=X('<button class="close-btn svelte-yrmttr" title="Close">×</button>'),Aa=X('<div class="resize-handle resize-handle-sw svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M1 1L9 9M1 5L5 9M1 9L1 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></div> <div class="resize-handle resize-handle-se svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M9 1L1 9M9 5L5 9M9 9L9 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></div>',1),Ca=X("<div><!></div> <!>",1),Ta=X('<div><div class="panel-header svelte-yrmttr"><span class="panel-title svelte-yrmttr"> </span> <!> <div class="header-buttons svelte-yrmttr"><button class="minimize-btn svelte-yrmttr"> </button> <!></div></div> <!></div>');function Wr(t,e){je(e,!0);let i=de(e,"initialRight",3,10),n=de(e,"initialTop",3,60),r=de(e,"width",3,280),s=de(e,"minWidth",3,200),o=de(e,"minHeight",3,100),a=de(e,"maxWidth",3,600),l=de(e,"maxHeight",3,800),c=de(e,"resizable",3,!1),d=de(e,"startMinimized",3,!1),g=de(e,"showClose",3,!1),f=G(Ye(d())),h=G(Ye({x:0,y:0})),p=G(Ye({width:r(),height:e.height??0})),b=G(!1),T=G(!1),k=G("se"),L=G(Ye({x:0,y:0})),H=G(null),Y=G(!1);ht(()=>{if(typeof window>"u")return;const w=localStorage.getItem(`panel-state-${e.panelId}`);if(w)try{const M=JSON.parse(w);I(h,{x:M.x,y:M.y},!0),c()&&M.width&&M.height&&I(p,{width:M.width,height:M.height},!0)}catch{I(h,{x:window.innerWidth-r()-i(),y:n()},!0)}else I(h,{x:window.innerWidth-r()-i(),y:n()},!0);I(Y,!0)}),ht(()=>{if(!u(Y))return;const w=c()?{...u(h),width:u(p).width,height:u(p).height}:u(h);localStorage.setItem(`panel-state-${e.panelId}`,JSON.stringify(w))}),ht(()=>{if(!u(Y))return;function w(){if(!u(H))return;const M=c()?u(p).width:r();let F=u(h).x,ee=u(h).y,U=!1;const ae=window.innerWidth-M;u(h).x>ae&&(F=Math.max(10,ae),U=!0);const $e=window.innerHeight-40;u(h).y>$e&&(ee=Math.max(10,$e),U=!0),u(h).x<0&&(F=10,U=!0),u(h).y<0&&(ee=10,U=!0),U&&I(h,{x:F,y:ee},!0)}return window.addEventListener("resize",w),w(),()=>{window.removeEventListener("resize",w)}});function Z(){I(f,!u(f))}function $(){e.onclose?.()}function m(w){w.target.closest("button")||(I(b,!0),I(L,{x:w.clientX-u(h).x,y:w.clientY-u(h).y},!0),w.currentTarget.setPointerCapture(w.pointerId),w.preventDefault())}function S(w){if(!u(b))return;const M=w.clientX-u(L).x,F=w.clientY-u(L).y,ee=window.innerWidth-(u(H)?.offsetWidth??r()),U=window.innerHeight-40;I(h,{x:Math.max(0,Math.min(M,ee)),y:Math.max(0,Math.min(F,U))},!0)}function x(w){u(b)&&(I(b,!1),w.currentTarget.releasePointerCapture(w.pointerId))}function v(w){return M=>{c()&&(I(T,!0),I(k,w,!0),M.currentTarget.setPointerCapture(M.pointerId),M.preventDefault(),M.stopPropagation())}}function y(w){if(!u(T)||!u(H))return;const M=u(H).getBoundingClientRect();let F,ee=w.clientY-M.top,U=u(h).x;u(k)==="se"?F=w.clientX-M.left:(F=M.right-w.clientX,U=w.clientX);const ae=Math.max(s(),Math.min(a(),F)),$e=Math.max(o(),Math.min(l(),ee));u(k)==="sw"&&(U=M.right-ae,U<0&&(U=0));const Nt=u(k)==="se"?window.innerWidth-u(h).x-10:M.right-10,Qt=window.innerHeight-u(h).y-10,at=Math.min(ae,Nt),Ai=Math.min($e,Qt);I(p,{width:at,height:Ai},!0),u(k)==="sw"&&F>=s()&&I(h,{...u(h),x:Math.max(0,U)},!0)}function D(w){u(T)&&(I(T,!1),w.currentTarget.releasePointerCapture(w.pointerId))}function _(w){w.stopPropagation()}var A=Ta();let z;A.__pointerdown=_,A.__click=_;var E=N(A);E.__pointerdown=m,E.__pointermove=S,E.__pointerup=x;var W=N(E),ce=N(W),te=P(W,2);{var Re=w=>{var M=xi(),F=Ge(M);Yi(F,()=>e.headerExtra),C(w,M)};J(te,w=>{e.headerExtra&&w(Re)})}var ot=P(te,2),ue=N(ot);ue.__click=Z;var De=N(ue),He=P(ue,2);{var Ht=w=>{var M=Da();M.__click=$,C(w,M)};J(He,w=>{g()&&w(Ht)})}var Ne=P(E,2);{var Di=w=>{var M=Ca(),F=Ge(M);let ee;var U=N(F);Yi(U,()=>e.children);var ae=P(F,2);{var $e=Nt=>{var Qt=Aa(),at=Ge(Qt),Ai=q(()=>v("sw"));at.__pointerdown=function(...Ci){u(Ai)?.apply(this,Ci)},at.__pointermove=y,at.__pointerup=D;var ei=P(at,2),Kr=q(()=>v("se"));ei.__pointerdown=function(...Ci){u(Kr)?.apply(this,Ci)},ei.__pointermove=y,ei.__pointerup=D,At("pointercancel",at,D),At("pointercancel",ei,D),C(Nt,Qt)};J(ae,Nt=>{c()&&Nt($e)})}oe(()=>ee=Fe(F,1,"panel-body svelte-yrmttr",null,ee,{"has-fixed-height":c()&&u(p).height>0})),C(w,M)};J(Ne,w=>{u(f)||w(Di)})}rn(A,w=>I(H,w),()=>u(H)),oe(()=>{z=Fe(A,1,"draggable-panel svelte-yrmttr",null,z,{minimized:u(f),dragging:u(b),resizing:u(T),resizable:c()}),rt(A,`left: ${u(h).x??""}px; top: ${u(h).y??""}px; width: ${u(f)?"auto":`${c()?u(p).width:r()}px`}; ${c()&&u(p).height>0&&!u(f)?`height: ${u(p).height}px;`:""}`),me(ce,e.title),st(ue,"title",u(f)?"Expand":"Minimize"),me(De,u(f)?"▲":"▼")}),At("pointercancel",E,x),C(t,A),Je()}Pt(["pointerdown","click","pointermove","pointerup"]);var Ma=X('<span class="palette-hint svelte-1ahretz">Drag to place</span>'),ka=X('<div draggable="true" role="button" tabindex="0"><img class="asset-preview svelte-1ahretz"/> <span class="asset-name svelte-1ahretz"> </span></div>'),La=X('<div class="palette-content svelte-1ahretz" role="toolbar" tabindex="-1"><div class="palette-grid svelte-1ahretz"></div></div>'),Oa=X("<!> <!>",1);function Pa(t,e){je(e,!0);const i=()=>Q(jt,"$builderEditMode",n),[n,r]=Rt(),s=dn;let o=G(!1),a=G(null),l=G(null);function c(){I(o,!u(o))}function d(m,S){if(!m.dataTransfer)return;I(a,S,!0),m.dataTransfer.effectAllowed="copy",m.dataTransfer.setData("assetKey",S);const v=m.target.querySelector("img")?.cloneNode(!0);v&&(v.style.position="absolute",v.style.top="-1000px",document.body.appendChild(v),m.dataTransfer.setDragImage(v,24,24),setTimeout(()=>v.remove(),0))}function g(){I(a,null)}function f(m,S){if(m.touches.length!==1)return;const x=m.touches[0];I(a,S,!0);const y=m.currentTarget.querySelector("img");if(y){const D=document.createElement("div");D.className="touch-drag-preview",D.innerHTML=`<img src="${y.src}" alt="" />`,D.style.cssText=`
        position: fixed;
        top: ${x.clientY-24}px;
        left: ${x.clientX-24}px;
        width: 48px;
        height: 48px;
        pointer-events: none;
        z-index: 10000;
        opacity: 0.9;
        image-rendering: pixelated;
        filter: drop-shadow(3px 3px 0 rgba(0, 0, 0, 0.5));
        border: 2px solid #4a90e2;
        background: rgba(26, 26, 46, 0.9);
      `,D.querySelector("img").style.cssText=`
        width: 100%;
        height: 100%;
        object-fit: contain;
        image-rendering: pixelated;
      `,document.body.appendChild(D),I(l,D,!0)}}function h(m){if(!u(a)||!u(l))return;const S=m.touches[0];u(l).style.top=`${S.clientY-24}px`,u(l).style.left=`${S.clientX-24}px`,m.preventDefault()}function p(m){if(!u(a))return;const S=m.changedTouches[0],x=document.querySelector("canvas");if(u(l)&&(u(l).remove(),I(l,null)),x){const v=x.getBoundingClientRect(),y=S.clientX,D=S.clientY;if(y>=v.left&&y<=v.right&&D>=v.top&&D<=v.bottom){const _=y-v.left,A=D-v.top;mt.emit(_t.ASSET_DROPPED,{assetKey:u(a),canvasX:_,canvasY:A})}}I(a,null)}function b(m){m.stopPropagation()}function T(m){m.preventDefault(),m.dataTransfer&&(m.dataTransfer.dropEffect="copy")}function k(m){m.preventDefault();const S=m.dataTransfer?.getData("assetKey");if(!S)return;const v=m.target.getBoundingClientRect(),y=m.clientX-v.left,D=m.clientY-v.top;mt.emit(_t.ASSET_DROPPED,{assetKey:S,canvasX:y,canvasY:D})}Er(()=>{const m=document.querySelector("canvas");if(m)return m.addEventListener("dragover",T),m.addEventListener("drop",k),()=>{m.removeEventListener("dragover",T),m.removeEventListener("drop",k)}}),ht(()=>(document.addEventListener("touchmove",h,{passive:!1}),document.addEventListener("touchend",p),document.addEventListener("touchcancel",p),()=>{document.removeEventListener("touchmove",h),document.removeEventListener("touchend",p),document.removeEventListener("touchcancel",p)}));var L=Oa(),H=Ge(L);{var Y=m=>{{let S=q(()=>u(o)?"orange":"blue");Se(m,{onclick:c,position:"top-right",get variant(){return u(S)},width:"120px",title:"Toggle Asset Palette",children:(x,v)=>{var y=be("ASSETS");C(x,y)},$$slots:{default:!0}})}};J(H,m=>{i()==="items"&&m(Y)})}var Z=P(H,2);{var $=m=>{Wr(m,{panelId:"asset-palette",title:"Assets",initialRight:10,initialTop:60,width:280,height:400,minWidth:200,minHeight:160,maxWidth:500,maxHeight:600,resizable:!0,headerExtra:x=>{var v=Ma();C(x,v)},children:(x,v)=>{var y=La();y.__pointerdown=b;var D=N(y);Ni(D,21,()=>s,Hi,(_,A)=>{var z=ka();let E;z.__touchstart=Re=>f(Re,u(A).key);var W=N(z),ce=P(W,2),te=N(ce);oe(()=>{E=Fe(z,1,"asset-item svelte-1ahretz",null,E,{dragging:u(a)===u(A).key}),st(z,"title",u(A).name),st(W,"src",u(A).path),st(W,"alt",u(A).name),me(te,u(A).name)}),At("dragstart",z,Re=>d(Re,u(A).key)),At("dragend",z,g),C(_,z)}),C(x,y)},$$slots:{headerExtra:!0,default:!0}})};J(Z,m=>{u(o)&&i()==="items"&&m($)})}C(t,L),Je(),r()}Pt(["pointerdown","touchstart"]);var Ra=X('<div><div class="minimap-bg svelte-1ycb7lo"></div> <div class="viewport-indicator svelte-1ycb7lo"></div> <div class="player-marker svelte-1ycb7lo"></div> <div class="minimap-frame svelte-1ycb7lo"></div></div>');function Ha(t,e){je(e,!0);const i=()=>Q($r,"$builderCameraInfo",r),n=()=>Q(Jt,"$isBuilderZoomedOut",r),[r,s]=Rt(),o=120,a=60,l=200,c=100;let d=G(!1),g=G(null),f=q(()=>u(d)?l:o),h=q(()=>u(d)?c:a),p=q(()=>{const v=i();if(!v||v.worldWidth===0)return"display: none;";const y=u(f)/v.worldWidth,D=u(h)/v.worldHeight,_=v.viewWidth/v.zoom*y,A=v.viewHeight/v.zoom*D,z=v.scrollX*y,E=v.scrollY*D;return`
      left: ${Math.max(0,z)}px;
      top: ${Math.max(0,E)}px;
      width: ${Math.min(_,u(f)-z)}px;
      height: ${Math.min(A,u(h)-E)}px;
    `}),b=q(()=>{const v=i();if(!v||v.worldWidth===0)return"display: none;";const y=u(f)/v.worldWidth,D=u(h)/v.worldHeight,_=v.playerX*y,A=v.playerY*D;return`
      left: ${_}px;
      top: ${A}px;
    `});function T(v,y){const D=i();if(!D||D.worldWidth===0||!u(g))return;const _=u(g).getBoundingClientRect(),A=v-_.left,z=y-_.top,E=A/u(f)*D.worldWidth,W=z/u(h)*D.worldHeight;mt.emit(_t.MINIMAP_NAVIGATE,{worldX:E,worldY:W})}function k(v){v.stopPropagation(),v.preventDefault(),I(d,!0),T(v.clientX,v.clientY),window.addEventListener("mousemove",L),window.addEventListener("mouseup",H)}function L(v){u(d)&&(v.preventDefault(),T(v.clientX,v.clientY))}function H(){I(d,!1),window.removeEventListener("mousemove",L),window.removeEventListener("mouseup",H)}function Y(v){v.stopPropagation(),v.preventDefault(),I(d,!0);const y=v.touches[0];T(y.clientX,y.clientY),window.addEventListener("touchmove",Z,{passive:!1}),window.addEventListener("touchend",$)}function Z(v){if(!u(d))return;v.preventDefault();const y=v.touches[0];T(y.clientX,y.clientY)}function $(){I(d,!1),window.removeEventListener("touchmove",Z),window.removeEventListener("touchend",$)}var m=xi(),S=Ge(m);{var x=v=>{var y=Ra();let D;y.__mousedown=k,y.__touchstart=Y;var _=P(N(y),2),A=P(_,2);rn(y,z=>I(g,z),()=>u(g)),oe(()=>{D=Fe(y,1,"minimap-container svelte-1ycb7lo",null,D,{enlarged:u(d)}),rt(y,`width: ${u(f)??""}px; height: ${u(h)??""}px;`),rt(_,u(p)),rt(A,u(b))}),C(v,y)};J(S,v=>{n()||v(x)})}C(t,m),Je(),s()}Pt(["mousedown","touchstart"]);var Na=X('<div class="landscape-hint svelte-ugg786"><div class="hint-content svelte-ugg786"><div class="rotate-icon svelte-ugg786">📱↻</div> <p class="hint-text svelte-ugg786">Rotate your phone for a better experience</p> <button class="dismiss-btn svelte-ugg786">OK</button></div></div>');function $a(t,e){je(e,!0);let i=G(!0),n=G(!1);const r="landscapeHintDismissed";Er(()=>{sessionStorage.getItem(r)||(I(n,/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||"ontouchstart"in window&&window.innerWidth<=768,!0),u(n)&&I(i,!1))});function s(){I(i,!0),sessionStorage.setItem(r,"true")}var o=xi(),a=Ge(o);{var l=c=>{var d=Na(),g=N(d),f=P(N(g),4);f.__click=s,C(c,d)};J(a,c=>{!u(i)&&u(n)&&c(l)})}C(t,o),Je()}Pt(["click"]);const Ba=50,Za=400,Ya=400,Wa=70;var Ga=X("<button> </button>"),Xa=X("<button></button>"),Ka=X('<div class="color-picker svelte-zzlycq"></div>'),za=X('<div class="panel-content svelte-zzlycq"><div class="language-tabs svelte-zzlycq"></div> <div class="form-section svelte-zzlycq"><div class="form-group svelte-zzlycq"><label for="dialog-title" class="svelte-zzlycq"> </label> <input id="dialog-title" type="text" placeholder="Enter title..." class="svelte-zzlycq"/></div> <div class="form-group svelte-zzlycq"><label for="dialog-content" class="svelte-zzlycq"> </label> <textarea id="dialog-content" placeholder="Enter dialog text..." rows="6" class="svelte-zzlycq"></textarea></div> <div class="color-section svelte-zzlycq"><span class="color-label-title svelte-zzlycq">Color</span> <button class="color-button svelte-zzlycq" title="Change zone color"><span class="zone-color svelte-zzlycq"></span> <span class="color-label svelte-zzlycq">Change</span></button> <!></div></div> <div class="panel-footer svelte-zzlycq"><!></div></div>'),Fa=X("<!> <!>",1);function Ua(t,e){je(e,!0);const i=()=>Q(cn,"$dialogZones",r),n=()=>Q(Rr,"$selectedDialogZoneId",r),[r,s]=Rt(),o=Ba,a=Za,l=[{code:"cs",label:"CZ"},{code:"en",label:"EN"}];let c=G("cs"),d=G(!1),g=q(()=>i().find(S=>S.id===n())??null),f=q(()=>u(g)?.texts.find(S=>S.language===u(c))??null);function h(S){const x=S.target;n()&&Cn(n(),u(c),{title:x.value})}function p(S){const x=S.target;n()&&Cn(n(),u(c),{content:x.value})}function b(){n()&&Yo(n())}function T(){ri(null)}function k(){mt.emit(_t.DIALOG_ZONE_CREATE)}function L(S){n()&&(Zt(n(),{color:S}),I(d,!1))}function H(){I(d,!u(d))}var Y=Fa(),Z=Ge(Y);Se(Z,{position:"top-right",variant:"green",width:"120px",onclick:k,title:"Create new dialog zone at center of view",children:(S,x)=>{var v=be("+ ZONE");C(S,v)},$$slots:{default:!0}});var $=P(Z,2);{var m=S=>{Wr(S,{panelId:"dialog-zone-panel",title:"Dialog Zone",initialRight:10,initialTop:160,width:280,height:450,minWidth:250,minHeight:370,maxWidth:500,maxHeight:700,resizable:!0,showClose:!0,onclose:T,children:(x,v)=>{var y=za(),D=N(y);Ni(D,21,()=>l,Hi,(M,F)=>{var ee=Ga();let U;ee.__click=()=>I(c,u(F).code,!0);var ae=N(ee);oe(()=>{U=Fe(ee,1,"lang-tab svelte-zzlycq",null,U,{active:u(c)===u(F).code}),me(ae,u(F).label)}),C(M,ee)});var _=P(D,2),A=N(_),z=N(A),E=N(z),W=P(z,2);W.__input=h;var ce=P(A,2),te=N(ce),Re=N(te),ot=P(te,2);ot.__input=p;var ue=P(ce,2),De=P(N(ue),2);De.__click=H;var He=N(De),Ht=P(De,2);{var Ne=M=>{var F=Ka();Ni(F,21,()=>Gi,Hi,(ee,U)=>{var ae=Xa();let $e;ae.__click=()=>L(u(U)),oe(()=>{$e=Fe(ae,1,"color-swatch svelte-zzlycq",null,$e,{selected:u(g).color===u(U)}),rt(ae,`background: ${u(U)??""}`),st(ae,"title",u(U))}),C(ee,ae)}),C(M,F)};J(Ht,M=>{u(d)&&M(Ne)})}var Di=P(_,2),w=N(Di);Se(w,{variant:"red",onclick:b,children:(M,F)=>{var ee=be("DELETE ZONE");C(M,ee)},$$slots:{default:!0}}),oe(()=>{me(E,`Title (max ${o} chars)`),bn(W,u(f)?.title??""),st(W,"maxlength",o),me(Re,`Content (max ${a} chars)`),bn(ot,u(f)?.content??""),st(ot,"maxlength",a),rt(He,`background: ${u(g).color??""}`)}),C(x,y)},$$slots:{default:!0}})};J($,S=>{u(g)&&S(m)})}C(t,Y),Je(),s()}Pt(["click","input"]);var Va=X('<div class="item-controls svelte-1vm8op7"><!> <!> <!></div>'),qa=X('<!> <!> <!> <div class="top-left-buttons svelte-1vm8op7"><!> <!> <!></div> <!> <!>',1);function ja(t,e){je(e,!0);const i=()=>Q(Hr,"$selectedItem",c),n=()=>Q(Or,"$selectedItemId",c),r=()=>Q(Pr,"$itemDepthLayer",c),s=()=>Q(Mo,"$selectedItemPhysicsEnabled",c),o=()=>Q(jt,"$builderEditMode",c),a=()=>Q(Jt,"$isBuilderZoomedOut",c),l=()=>Q(ln,"$gridSnappingEnabled",c),[c,d]=Rt();let g=q(()=>i()?Go(i().assetKey):!1);function f(){Ia()}function h(){Ea()}function p(){if(!n())return;const E=r()==="behind"?"front":"behind",W=an(E);Lo(),Oo(n(),W)}function b(){n()&&Po(n(),!s())}function T(){n()&&(Nr(n()),un())}function k(){Bo()}function L(){To()}var H=qa(),Y=Ge(H);{var Z=E=>{Pa(E,{})},$=E=>{Ua(E,{})};J(Y,E=>{o()==="items"?E(Z):E($,!1)})}var m=P(Y,2);Ha(m,{});var S=P(m,2);$a(S,{});var x=P(S,2),v=N(x);Se(v,{variant:"green",width:"100px",onclick:f,children:(E,W)=>{var ce=be("SAVE");C(E,ce)},$$slots:{default:!0}});var y=P(v,2);{let E=q(()=>a()?"orange":"blue");Se(y,{get variant(){return u(E)},width:"80px",onclick:h,title:"Toggle zoom (F)",children:(W,ce)=>{var te=be();oe(()=>me(te,a()?"1:1":"FIT")),C(W,te)},$$slots:{default:!0}})}var D=P(y,2);{let E=q(()=>l()?"orange":"blue");Se(D,{get variant(){return u(E)},width:"80px",onclick:L,title:"Toggle grid snapping",children:(W,ce)=>{var te=be();oe(()=>me(te,l()?"SNAP":"FREE")),C(W,te)},$$slots:{default:!0}})}var _=P(x,2);{let E=q(()=>o()==="dialogs"?"orange":"blue");Se(_,{position:"stack-2",get variant(){return u(E)},onclick:k,title:"Toggle edit mode: items or dialog zones",children:(W,ce)=>{var te=be("DIALOGS");C(W,te)},$$slots:{default:!0}})}var A=P(_,2);{var z=E=>{var W=Va(),ce=N(W);{let ue=q(()=>r()==="behind"?"blue":"orange"),De=q(()=>s()?"Solid items must be behind player":"Toggle item depth: behind or in front of player");Se(ce,{get variant(){return u(ue)},get title(){return u(De)},onclick:p,get disabled(){return s()},children:(He,Ht)=>{var Ne=be();oe(()=>me(Ne,r()==="behind"?"Behind":"Front")),C(He,Ne)},$$slots:{default:!0}})}var te=P(ce,2);{var Re=ue=>{{let De=q(()=>s()?"orange":"blue");Se(ue,{get variant(){return u(De)},title:"Toggle physics: item will block player movement",onclick:b,children:(He,Ht)=>{var Ne=be();oe(()=>me(Ne,s()?"Solid":"Ghost")),C(He,Ne)},$$slots:{default:!0}})}};J(te,ue=>{u(g)&&ue(Re)})}var ot=P(te,2);Se(ot,{variant:"red",title:"Delete selected item",onclick:T,children:(ue,De)=>{var He=be("DELETE");C(ue,He)},$$slots:{default:!0}}),C(E,W)};J(A,E=>{o()==="items"&&n()&&E(z)})}C(t,H),Je(),d()}var Ja=X("<div> </div>"),Qa=X('<div class="dialog-content svelte-1jd14ss"> </div>'),el=X("<div><!> <!></div>");function tl(t,e){je(e,!0);const i=()=>Q(mo,"$activeDialogText",r),n=()=>Q(Cr,"$playerScreenPosition",r),[r,s]=Rt();let o=q(()=>i()?.title&&i()?.content),a=q(()=>Math.max(10,window.innerHeight-n().y+Wa)),l=q(()=>window.innerWidth<=Ya),c=q(()=>u(l)?50:n().x),d=q(()=>u(l)?"percent":"px");var g=xi(),f=Ge(g);{var h=p=>{var b=el();let T;var k=N(b);{var L=Z=>{var $=Ja();let m;var S=N($);oe(()=>{m=Fe($,1,"dialog-title svelte-1jd14ss",null,m,{"has-divider":u(o)}),me(S,i().title)}),C(Z,$)};J(k,Z=>{i().title&&Z(L)})}var H=P(k,2);{var Y=Z=>{var $=Qa(),m=N($);oe(()=>me(m,i().content)),C(Z,$)};J(H,Z=>{i().content&&Z(Y)})}oe(()=>{T=Fe(b,1,"dialog-bubble svelte-1jd14ss",null,T,{narrow:u(l)}),rt(b,`bottom: ${u(a)??""}px; left: ${u(c)??""}${u(d)??""};`)}),C(p,b)};J(f,p=>{i()&&p(h)})}C(t,g),Je(),s()}var il=X('<div class="touch-controls"><p class="touch-text">Tap and hold<br/>where you want<br/>to move</p></div>'),nl=X('<div class="desktop-controls"><div class="key-row"><div class="pixel-key">A</div> <div class="pixel-key">W</div> <div class="pixel-key">D</div></div> <p class="or-text">or</p> <div class="key-row"><div class="pixel-key">←</div> <div class="pixel-key">↑</div> <div class="pixel-key">→</div></div></div>'),rl=X('<div class="loader-overlay"><div class="pixel-loader"></div></div>'),sl=X('<div class="game-ui-wrapper svelte-13dvmla"><!> <!> <!> <dialog class="pixel-dialog"><h1>CONTROLS</h1> <div class="controls-content"><!></div></dialog> <!></div>');function ol(t,e){je(e,!1);const i=()=>Q(Bt,"$showControlsDialog",l),n=()=>Q(Dr,"$hasPlayerMoved",l),r=()=>Q(Ao,"$isBuilderMode",l),s=()=>Q(fi,"$currentLanguage",l),o=()=>Q(xr,"$isTouchDevice",l),a=()=>Q(Xi,"$isLoading",l),[l,c]=Rt();let d=Ji();function g(){const _=Yr.toggleLanguage();fi.set(_)}function f(_){!u(d)?.open||_.target.closest(".pixel-button")||Bt.set(!1)}function h(){const _=ba();if(!_){console.error("Cannot enter builder mode: map config not found");return}Sa(_)}_n(()=>(u(d),i()),()=>{u(d)&&(i()?u(d).showModal():u(d).close())}),_n(()=>(n(),u(d),Bt),()=>{n()&&u(d)?.open&&Bt.set(!1)}),Ks(),ao();var p=sl();At("pointerdown",Fn,f);var b=N(p);{var T=_=>{ja(_,{})},k=_=>{tl(_,{})};J(b,_=>{r()?_(T):_(k,!1)})}var L=P(b,2);{var H=_=>{Se(_,{position:"top-left",variant:"green",width:"120px",onclick:h,title:"Toggle Builder Mode",children:(A,z)=>{var E=be("BUILD");C(A,E)},$$slots:{default:!0}})};J(L,_=>{r()||_(H)})}var Y=P(L,2);{var Z=_=>{Se(_,{position:"top-right",variant:"default",width:"100px",onclick:g,title:"Toggle Language (L)",children:(A,z)=>{var E=be();oe(W=>me(E,W),[()=>(s(),wt(()=>s().toUpperCase()))]),C(A,E)},$$slots:{default:!0}})};J(Y,_=>{r()||_(Z)})}var $=P(Y,2),m=P(N($),2),S=N(m);{var x=_=>{var A=il();C(_,A)},v=_=>{var A=nl();C(_,A)};J(S,_=>{o()?_(x):_(v,!1)})}rn($,_=>I(d,_),()=>u(d));var y=P($,2);{var D=_=>{var A=rl();C(_,A)};J(y,_=>{a()&&_(D)})}C(t,p),Je(),c()}const Gr=document.getElementById("game-ui");if(!Gr)throw new Error("game-ui element not found!");Qs(ol,{target:Gr});fi.set(Yr.getLanguage());po.set(Tr.getSkin());vo.set(gi.getCurrentConfig().name);const al={type:O.AUTO,width:800,height:600,parent:"game-container",backgroundColor:"#000000",pixelArt:!0,roundPixels:!0,scale:{mode:O.Scale.RESIZE,autoCenter:O.Scale.CENTER_BOTH},physics:{default:"arcade",arcade:{gravity:{y:1e3,x:0},debug:!1}},audio:{noAudio:!0},scene:[oa,ma]},Xr=new O.Game(al);wa(Xr);const ll=Xr.device.input.touch;xr.set(ll);const cl=performance.getEntriesByType("navigation")[0]&&performance.getEntriesByType("navigation")[0].type==="reload",ul=sessionStorage.getItem("hasSeenControlsHint");(!ul||cl)&&(sessionStorage.setItem("hasSeenControlsHint","true"),Bt.set(!0));
//# sourceMappingURL=index-D2r80G24.js.map
