import{r as Ks,g as zs}from"./phaser-DFK5Ua9d.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();var Ws=Ks();const H=zs(Ws),fi=!1;var Ei=Array.isArray,Us=Array.prototype.indexOf,Ii=Array.from,Dr=Object.defineProperty,fn=Object.getOwnPropertyDescriptor,Ar=Object.getOwnPropertyDescriptors,js=Object.prototype,Vs=Array.prototype,Ci=Object.getPrototypeOf,Wi=Object.isExtensible;const Ye=()=>{};function qs(t){return t()}function Hn(t){for(var e=0;e<t.length;e++)t[e]()}function Tr(){var t,e,n=new Promise((i,r)=>{t=i,e=r});return{promise:n,resolve:t,reject:e}}function Js(t,e){if(Array.isArray(t))return t;if(!(Symbol.iterator in t))return Array.from(t);const n=[];for(const i of t)if(n.push(i),n.length===e)break;return n}const _e=2,ki=4,Vn=8,Qs=1<<24,pt=16,vt=32,Ht=64,qn=128,Ue=512,pe=1024,Te=2048,it=4096,Oe=8192,bt=16384,Di=32768,Ot=65536,Ui=1<<17,Mr=1<<18,en=1<<19,Pr=1<<20,$t=32768,gi=1<<21,Ai=1<<22,wt=1<<23,St=Symbol("$state"),ea=Symbol(""),Kt=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Lr(t){return t===this.v}function Or(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function $r(t){return!Or(t,this.v)}function ta(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function na(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function ia(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function ra(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function sa(t){throw new Error("https://svelte.dev/e/effect_orphan")}function aa(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function oa(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function la(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function ca(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function da(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}let In=!1,ua=!1;function ha(){In=!0}const fa=1,ga=2,pa=16,va=1,ma=2,we=Symbol(),_a="http://www.w3.org/1999/xhtml";let ie=null;function Ut(t){ie=t}function Ee(t,e=!1,n){ie={p:ie,i:!1,c:null,e:null,s:t,x:null,l:In&&!e?{s:null,u:null,$:[]}:null}}function Ie(t){var e=ie,n=e.e;if(n!==null){e.e=null;for(var i of n)is(i)}return e.i=!0,ie=e.p,{}}function Cn(){return!In||ie!==null&&ie.l===null}let zt=[];function ya(){var t=zt;zt=[],Hn(t)}function kn(t){if(zt.length===0){var e=zt;queueMicrotask(()=>{e===zt&&ya()})}zt.push(t)}function ba(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function wa(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function Qe(t){if(typeof t!="object"||t===null||St in t)return t;const e=Ci(t);if(e!==js&&e!==Vs)return t;var n=new Map,i=Ei(t),r=z(0),s=Lt,a=o=>{if(Lt===s)return o();var l=X,c=Lt;De(null),Qi(s);var u=o();return De(l),Qi(c),u};return i&&n.set("length",z(t.length)),new Proxy(t,{defineProperty(o,l,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&oa();var u=n.get(l);return u===void 0?u=a(()=>{var g=z(c.value);return n.set(l,g),g}):$(u,c.value,!0),!0},deleteProperty(o,l){var c=n.get(l);if(c===void 0){if(l in o){const u=a(()=>z(we));n.set(l,u),gn(r)}}else $(c,we),gn(r);return!0},get(o,l,c){if(l===St)return t;var u=n.get(l),g=l in o;if(u===void 0&&(!g||fn(o,l)?.writable)&&(u=a(()=>{var f=Qe(g?o[l]:we),p=z(f);return p}),n.set(l,u)),u!==void 0){var h=d(u);return h===we?void 0:h}return Reflect.get(o,l,c)},getOwnPropertyDescriptor(o,l){var c=Reflect.getOwnPropertyDescriptor(o,l);if(c&&"value"in c){var u=n.get(l);u&&(c.value=d(u))}else if(c===void 0){var g=n.get(l),h=g?.v;if(g!==void 0&&h!==we)return{enumerable:!0,configurable:!0,value:h,writable:!0}}return c},has(o,l){if(l===St)return!0;var c=n.get(l),u=c!==void 0&&c.v!==we||Reflect.has(o,l);if(c!==void 0||U!==null&&(!u||fn(o,l)?.writable)){c===void 0&&(c=a(()=>{var h=u?Qe(o[l]):we,f=z(h);return f}),n.set(l,c));var g=d(c);if(g===we)return!1}return u},set(o,l,c,u){var g=n.get(l),h=l in o;if(i&&l==="length")for(var f=c;f<g.v;f+=1){var p=n.get(f+"");p!==void 0?$(p,we):f in o&&(p=a(()=>z(we)),n.set(f+"",p))}if(g===void 0)(!h||fn(o,l)?.writable)&&(g=a(()=>z(void 0)),$(g,Qe(c)),n.set(l,g));else{h=g.v!==we;var E=a(()=>Qe(c));$(g,E)}var w=Reflect.getOwnPropertyDescriptor(o,l);if(w?.set&&w.set.call(u,c),!h){if(i&&typeof l=="string"){var v=n.get("length"),_=Number(l);Number.isInteger(_)&&_>=v.v&&$(v,_+1)}gn(r)}return!0},ownKeys(o){d(r);var l=Reflect.ownKeys(o).filter(g=>{var h=n.get(g);return h===void 0||h.v!==we});for(var[c,u]of n)u.v!==we&&!(c in o)&&l.push(c);return l},setPrototypeOf(){la()}})}function ji(t){try{if(t!==null&&typeof t=="object"&&St in t)return t[St]}catch{}return t}function Sa(t,e){return Object.is(ji(t),ji(e))}var Vi,Rr,Fr,Hr,Nr;function xa(){if(Vi===void 0){Vi=window,Rr=document,Fr=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,n=Text.prototype;Hr=fn(e,"firstChild").get,Nr=fn(e,"nextSibling").get,Wi(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),Wi(n)&&(n.__t=void 0)}}function gt(t=""){return document.createTextNode(t)}function Nn(t){return Hr.call(t)}function Dn(t){return Nr.call(t)}function P(t,e){return Nn(t)}function oe(t,e=!1){{var n=Nn(t);return n instanceof Comment&&n.data===""?Dn(n):n}}function T(t,e=1,n=!1){let i=t;for(;e--;)i=Dn(i);return i}function Ea(t){t.textContent=""}function Br(){return!1}function Zr(t){var e=U;if(e===null)return X.f|=wt,t;if((e.f&Di)===0){if((e.f&qn)===0)throw t;e.b.error(t)}else jt(t,e)}function jt(t,e){for(;e!==null;){if((e.f&qn)!==0)try{e.b.error(t);return}catch(n){t=n}e=e.parent}throw t}const Mn=new Set;let ne=null,Ze=null,Je=[],Ti=null,pi=!1;class et{committed=!1;current=new Map;previous=new Map;#e=new Set;#t=new Set;#i=0;#n=0;#l=null;#s=[];#r=[];skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#n>0}process(e){Je=[],this.apply();var n={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const i of e)this.#a(i,n);this.is_fork||this.#d(),this.is_deferred()?(this.#o(n.effects),this.#o(n.render_effects),this.#o(n.block_effects)):(ne=null,qi(n.render_effects),qi(n.effects),this.#l?.resolve()),Ze=null}#a(e,n){e.f^=pe;for(var i=e.first;i!==null;){var r=i.f,s=(r&(vt|Ht))!==0,a=s&&(r&pe)!==0,o=a||(r&Oe)!==0||this.skipped_effects.has(i);if((i.f&qn)!==0&&i.b?.is_pending()&&(n={parent:n,effect:i,effects:[],render_effects:[],block_effects:[]}),!o&&i.fn!==null){s?i.f^=pe:(r&ki)!==0?n.effects.push(i):nn(i)&&((i.f&pt)!==0&&n.block_effects.push(i),Vt(i));var l=i.first;if(l!==null){i=l;continue}}var c=i.parent;for(i=i.next;i===null&&c!==null;)c===n.effect&&(this.#o(n.effects),this.#o(n.render_effects),this.#o(n.block_effects),n=n.parent),i=c.next,c=c.parent}}#o(e){for(const n of e)((n.f&Te)!==0?this.#s:this.#r).push(n),this.#c(n.deps),ve(n,pe)}#c(e){if(e!==null)for(const n of e)(n.f&_e)===0||(n.f&$t)===0||(n.f^=$t,this.#c(n.deps))}capture(e,n){this.previous.has(e)||this.previous.set(e,n),(e.f&wt)===0&&(this.current.set(e,e.v),Ze?.set(e,e.v))}activate(){ne=this,this.apply()}deactivate(){ne===this&&(ne=null,Ze=null)}flush(){if(this.activate(),Je.length>0){if(Ia(),ne!==null&&ne!==this)return}else this.#i===0&&this.process([]);this.deactivate()}discard(){for(const e of this.#t)e(this);this.#t.clear()}#d(){if(this.#n===0){for(const e of this.#e)e();this.#e.clear()}this.#i===0&&this.#u()}#u(){if(Mn.size>1){this.previous.clear();var e=Ze,n=!0,i={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const s of Mn){if(s===this){n=!1;continue}const a=[];for(const[l,c]of this.current){if(s.current.has(l))if(n&&c!==s.current.get(l))s.current.set(l,c);else continue;a.push(l)}if(a.length===0)continue;const o=[...s.current.keys()].filter(l=>!this.current.has(l));if(o.length>0){var r=Je;Je=[];const l=new Set,c=new Map;for(const u of a)Gr(u,o,l,c);if(Je.length>0){ne=s,s.apply();for(const u of Je)s.#a(u,i);s.deactivate()}Je=r}}ne=null,Ze=e}this.committed=!0,Mn.delete(this)}increment(e){this.#i+=1,e&&(this.#n+=1)}decrement(e){this.#i-=1,e&&(this.#n-=1),this.revive()}revive(){for(const e of this.#s)ve(e,Te),Rt(e);for(const e of this.#r)ve(e,it),Rt(e);this.#s=[],this.#r=[],this.flush()}oncommit(e){this.#e.add(e)}ondiscard(e){this.#t.add(e)}settled(){return(this.#l??=Tr()).promise}static ensure(){if(ne===null){const e=ne=new et;Mn.add(ne),et.enqueue(()=>{ne===e&&e.flush()})}return ne}static enqueue(e){kn(e)}apply(){}}function Ia(){var t=It;pi=!0;var e=null;try{var n=0;for(Zn(!0);Je.length>0;){var i=et.ensure();if(n++>1e3){var r,s;Ca()}i.process(Je),Et.clear()}}finally{pi=!1,Zn(t),Ti=null}}function Ca(){try{aa()}catch(t){jt(t,Ti)}}let ct=null;function qi(t){var e=t.length;if(e!==0){for(var n=0;n<e;){var i=t[n++];if((i.f&(bt|Oe))===0&&nn(i)&&(ct=new Set,Vt(i),i.deps===null&&i.first===null&&i.nodes_start===null&&(i.teardown===null&&i.ac===null?as(i):i.fn=null),ct?.size>0)){Et.clear();for(const r of ct){if((r.f&(bt|Oe))!==0)continue;const s=[r];let a=r.parent;for(;a!==null;)ct.has(a)&&(ct.delete(a),s.push(a)),a=a.parent;for(let o=s.length-1;o>=0;o--){const l=s[o];(l.f&(bt|Oe))===0&&Vt(l)}}ct.clear()}}ct=null}}function Gr(t,e,n,i){if(!n.has(t)&&(n.add(t),t.reactions!==null))for(const r of t.reactions){const s=r.f;(s&_e)!==0?Gr(r,e,n,i):(s&(Ai|pt))!==0&&(s&Te)===0&&Yr(r,e,i)&&(ve(r,Te),Rt(r))}}function Yr(t,e,n){const i=n.get(t);if(i!==void 0)return i;if(t.deps!==null)for(const r of t.deps){if(e.includes(r))return!0;if((r.f&_e)!==0&&Yr(r,e,n))return n.set(r,!0),!0}return n.set(t,!1),!1}function Rt(t){for(var e=Ti=t;e.parent!==null;){e=e.parent;var n=e.f;if(pi&&e===U&&(n&pt)!==0&&(n&Mr)===0)return;if((n&(Ht|vt))!==0){if((n&pe)===0)return;e.f^=pe}}Je.push(e)}function ka(t){let e=0,n=Ft(0),i;return()=>{yn()&&(d(n),ei(()=>(e===0&&(i=Nt(()=>t(()=>gn(n)))),e+=1,()=>{kn(()=>{e-=1,e===0&&(i?.(),i=void 0,gn(n))})})))}}var Da=Ot|en|qn;function Aa(t,e,n){new Ta(t,e,n)}class Ta{parent;#e=!1;#t;#i=null;#n;#l;#s;#r=null;#a=null;#o=null;#c=null;#d=null;#u=0;#h=0;#g=!1;#f=null;#y=ka(()=>(this.#f=Ft(this.#u),()=>{this.#f=null}));constructor(e,n,i){this.#t=e,this.#n=n,this.#l=i,this.parent=U.b,this.#e=!!this.#n.pending,this.#s=ti(()=>{U.b=this;{var r=this.#m();try{this.#r=Be(()=>i(r))}catch(s){this.error(s)}this.#h>0?this.#v():this.#e=!1}return()=>{this.#d?.remove()}},Da)}#b(){try{this.#r=Be(()=>this.#l(this.#t))}catch(e){this.error(e)}this.#e=!1}#w(){const e=this.#n.pending;e&&(this.#a=Be(()=>e(this.#t)),et.enqueue(()=>{var n=this.#m();this.#r=this.#p(()=>(et.ensure(),Be(()=>this.#l(n)))),this.#h>0?this.#v():(Wt(this.#a,()=>{this.#a=null}),this.#e=!1)}))}#m(){var e=this.#t;return this.#e&&(this.#d=gt(),this.#t.before(this.#d),e=this.#d),e}is_pending(){return this.#e||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!this.#n.pending}#p(e){var n=U,i=X,r=ie;nt(this.#s),De(this.#s),Ut(this.#s.ctx);try{return e()}catch(s){return Zr(s),null}finally{nt(n),De(i),Ut(r)}}#v(){const e=this.#n.pending;this.#r!==null&&(this.#c=document.createDocumentFragment(),this.#c.append(this.#d),cs(this.#r,this.#c)),this.#a===null&&(this.#a=Be(()=>e(this.#t)))}#_(e){if(!this.has_pending_snippet()){this.parent&&this.parent.#_(e);return}this.#h+=e,this.#h===0&&(this.#e=!1,this.#a&&Wt(this.#a,()=>{this.#a=null}),this.#c&&(this.#t.before(this.#c),this.#c=null))}update_pending_count(e){this.#_(e),this.#u+=e,this.#f&&mn(this.#f,this.#u)}get_effect_pending(){return this.#y(),d(this.#f)}error(e){var n=this.#n.onerror;let i=this.#n.failed;if(this.#g||!n&&!i)throw e;this.#r&&(Ae(this.#r),this.#r=null),this.#a&&(Ae(this.#a),this.#a=null),this.#o&&(Ae(this.#o),this.#o=null);var r=!1,s=!1;const a=()=>{if(r){wa();return}r=!0,s&&da(),et.ensure(),this.#u=0,this.#o!==null&&Wt(this.#o,()=>{this.#o=null}),this.#e=this.has_pending_snippet(),this.#r=this.#p(()=>(this.#g=!1,Be(()=>this.#l(this.#t)))),this.#h>0?this.#v():this.#e=!1};var o=X;try{De(null),s=!0,n?.(e,a),s=!1}catch(l){jt(l,this.#s&&this.#s.parent)}finally{De(o)}i&&kn(()=>{this.#o=this.#p(()=>{et.ensure(),this.#g=!0;try{return Be(()=>{i(this.#t,()=>e,()=>a)})}catch(l){return jt(l,this.#s.parent),null}finally{this.#g=!1}})})}}function Pt(t,e){return e}function Ma(t,e,n){for(var i=[],r=e.length,s=0;s<r;s++)Oi(e[s].e,i,!0);os(i,()=>{var a=i.length===0&&n!==null;if(a){var o=n,l=o.parentNode;Ea(l),l.append(o),t.items.clear(),qe(t,e[0].prev,e[r-1].next)}for(var c=0;c<r;c++){var u=e[c];a||(t.items.delete(u.k),qe(t,u.prev,u.next)),Ae(u.e,!a)}t.first===e[0]&&(t.first=e[0].prev)})}function xt(t,e,n,i,r,s=null){var a=t,o=new Map,l=null;{var c=t;a=c.appendChild(gt())}var u=null,g=Xr(()=>{var v=n();return Ei(v)?v:v==null?[]:Ii(v)}),h,f=!0;function p(){Pa(w,h,a,e,i),u!==null&&(h.length===0?(u.fragment?(a.before(u.fragment),u.fragment=null):$i(u.effect),E.first=u.effect):Wt(u.effect,()=>{u=null}))}var E=ti(()=>{h=d(g);for(var v=h.length,_=new Set,y=ne,M=null,k=Br(),I=0;I<v;I+=1){var D=h[I],L=i(D,I),Z=f?null:o.get(L);Z?(mn(Z.v,D),Z.i=I,k&&y.skipped_effects.delete(Z.e)):(Z=La(f?a:null,M,D,L,I,r,e,n),f&&(Z.o=!0,M===null?l=Z:M.next=Z,M=Z),o.set(L,Z)),_.add(L)}if(v===0&&s&&!u)if(f)u={fragment:null,effect:Be(()=>s(a))};else{var C=document.createDocumentFragment(),O=gt();C.append(O),u={fragment:C,effect:Be(()=>s(O))}}if(!f)if(k){for(const[B,b]of o)_.has(B)||y.skipped_effects.add(b.e);y.oncommit(p),y.ondiscard(()=>{})}else p();d(g)}),w={effect:E,items:o,first:l};f=!1}function Pa(t,e,n,i,r){var s=e.length,a=t.items,o=t.first,l,c=null,u=[],g=[],h,f,p,E;for(E=0;E<s;E+=1){if(h=e[E],f=r(h,E),p=a.get(f),t.first??=p,!p.o){p.o=!0;var w=c?c.next:o;qe(t,c,p),qe(t,p,w),si(p,w,n),c=p,u=[],g=[],o=c.next;continue}if((p.e.f&Oe)!==0&&$i(p.e),p!==o){if(l!==void 0&&l.has(p)){if(u.length<g.length){var v=g[0],_;c=v.prev;var y=u[0],M=u[u.length-1];for(_=0;_<u.length;_+=1)si(u[_],v,n);for(_=0;_<g.length;_+=1)l.delete(g[_]);qe(t,y.prev,M.next),qe(t,c,y),qe(t,M,v),o=v,c=M,E-=1,u=[],g=[]}else l.delete(p),si(p,o,n),qe(t,p.prev,p.next),qe(t,p,c===null?t.first:c.next),qe(t,c,p),c=p;continue}for(u=[],g=[];o!==null&&o.k!==f;)(o.e.f&Oe)===0&&(l??=new Set).add(o),g.push(o),o=o.next;if(o===null)continue;p=o}u.push(p),c=p,o=p.next}if(o!==null||l!==void 0){for(var k=l===void 0?[]:Ii(l);o!==null;)(o.e.f&Oe)===0&&k.push(o),o=o.next;var I=k.length;if(I>0){var D=s===0?n:null;Ma(t,k,D)}}}function La(t,e,n,i,r,s,a,o){var l=(a&fa)!==0,c=(a&pa)===0,u=l?c?Pi(n,!1,!1):Ft(n):n,g=(a&ga)===0?r:Ft(r),h={i:g,v:u,k:i,a:null,e:null,o:!1,prev:e,next:null};try{if(t===null){var f=document.createDocumentFragment();f.append(t=gt())}return h.e=Be(()=>s(t,u,g,o)),e!==null&&(e.next=h),h}finally{}}function si(t,e,n){for(var i=t.next?t.next.e.nodes_start:n,r=e?e.e.nodes_start:n,s=t.e.nodes_start;s!==null&&s!==i;){var a=Dn(s);r.before(s),s=a}}function qe(t,e,n){e===null?(t.first=n,t.effect.first=n&&n.e):(e.e.next&&(e.e.next.prev=null),e.next=n,e.e.next=n&&n.e),n===null?t.effect.last=e&&e.e:(n.e.prev&&(n.e.prev.next=null),n.prev=e,n.e.prev=e&&e.e)}function Oa(t,e,n,i){const r=Cn()?Jn:Xr;if(n.length===0&&t.length===0){i(e.map(r));return}var s=ne,a=U,o=$a();function l(){Promise.all(n.map(c=>Ra(c))).then(c=>{o();try{i([...e.map(r),...c])}catch(u){(a.f&bt)===0&&jt(u,a)}s?.deactivate(),Bn()}).catch(c=>{jt(c,a)})}t.length>0?Promise.all(t).then(()=>{o();try{return l()}finally{s?.deactivate(),Bn()}}):l()}function $a(){var t=U,e=X,n=ie,i=ne;return function(s=!0){nt(t),De(e),Ut(n),s&&i?.activate()}}function Bn(){nt(null),De(null),Ut(null)}function Jn(t){var e=_e|Te,n=X!==null&&(X.f&_e)!==0?X:null;return U!==null&&(U.f|=en),{ctx:ie,deps:null,effects:null,equals:Lr,f:e,fn:t,reactions:null,rv:0,v:we,wv:0,parent:n??U,ac:null}}function Ra(t,e){let n=U;n===null&&na();var i=n.b,r=void 0,s=Ft(we),a=!X,o=new Map;return Ua(()=>{var l=Tr();r=l.promise;try{Promise.resolve(t()).then(l.resolve,l.reject).then(()=>{c===ne&&c.committed&&c.deactivate(),Bn()})}catch(h){l.reject(h),Bn()}var c=ne;if(a){var u=!i.is_pending();i.update_pending_count(1),c.increment(u),o.get(c)?.reject(Kt),o.delete(c),o.set(c,l)}const g=(h,f=void 0)=>{if(c.activate(),f)f!==Kt&&(s.f|=wt,mn(s,f));else{(s.f&wt)!==0&&(s.f^=wt),mn(s,h);for(const[p,E]of o){if(o.delete(p),p===c)break;E.reject(Kt)}}a&&(i.update_pending_count(-1),c.decrement(u))};l.promise.then(g,h=>g(null,h||"unknown"))}),Qn(()=>{for(const l of o.values())l.reject(Kt)}),new Promise(l=>{function c(u){function g(){u===r?l(s):c(r)}u.then(g,g)}c(r)})}function F(t){const e=Jn(t);return jr(e),e}function Xr(t){const e=Jn(t);return e.equals=$r,e}function Kr(t){var e=t.effects;if(e!==null){t.effects=null;for(var n=0;n<e.length;n+=1)Ae(e[n])}}function Fa(t){for(var e=t.parent;e!==null;){if((e.f&_e)===0)return(e.f&bt)===0?e:null;e=e.parent}return null}function Mi(t){var e,n=U;nt(Fa(t));try{t.f&=~$t,Kr(t),e=Qr(t)}finally{nt(n)}return e}function zr(t){var e=Mi(t);if(t.equals(e)||(ne?.is_fork||(t.v=e),t.wv=qr()),!tn)if(Ze!==null)(yn()||ne?.is_fork)&&Ze.set(t,e);else{var n=(t.f&Ue)===0?it:pe;ve(t,n)}}let vi=new Set;const Et=new Map;let Wr=!1;function Ft(t,e){var n={f:0,v:t,reactions:null,equals:Lr,rv:0,wv:0};return n}function z(t,e){const n=Ft(t);return jr(n),n}function Pi(t,e=!1,n=!0){const i=Ft(t);return e||(i.equals=$r),In&&n&&ie!==null&&ie.l!==null&&(ie.l.s??=[]).push(i),i}function $(t,e,n=!1){X!==null&&(!tt||(X.f&Ui)!==0)&&Cn()&&(X.f&(_e|pt|Ai|Ui))!==0&&!dt?.includes(t)&&ca();let i=n?Qe(e):e;return mn(t,i)}function mn(t,e){if(!t.equals(e)){var n=t.v;tn?Et.set(t,e):Et.set(t,n),t.v=e;var i=et.ensure();i.capture(t,n),(t.f&_e)!==0&&((t.f&Te)!==0&&Mi(t),ve(t,(t.f&Ue)!==0?pe:it)),t.wv=qr(),Ur(t,Te),Cn()&&U!==null&&(U.f&pe)!==0&&(U.f&(vt|Ht))===0&&(Ne===null?Na([t]):Ne.push(t)),!i.is_fork&&vi.size>0&&!Wr&&Ha()}return e}function Ha(){Wr=!1;var t=It;Zn(!0);const e=Array.from(vi);try{for(const n of e)(n.f&pe)!==0&&ve(n,it),nn(n)&&Vt(n)}finally{Zn(t)}vi.clear()}function gn(t){$(t,t.v+1)}function Ur(t,e){var n=t.reactions;if(n!==null)for(var i=Cn(),r=n.length,s=0;s<r;s++){var a=n[s],o=a.f;if(!(!i&&a===U)){var l=(o&Te)===0;if(l&&ve(a,e),(o&_e)!==0){var c=a;Ze?.delete(c),(o&$t)===0&&(o&Ue&&(a.f|=$t),Ur(c,it))}else l&&((o&pt)!==0&&ct!==null&&ct.add(a),Rt(a))}}}function Li(t){var e=X,n=U;De(null),nt(null);try{return t()}finally{De(e),nt(n)}}let It=!1;function Zn(t){It=t}let tn=!1;function Ji(t){tn=t}let X=null,tt=!1;function De(t){X=t}let U=null;function nt(t){U=t}let dt=null;function jr(t){X!==null&&(dt===null?dt=[t]:dt.push(t))}let xe=null,Le=0,Ne=null;function Na(t){Ne=t}let Vr=1,_n=0,Lt=_n;function Qi(t){Lt=t}function qr(){return++Vr}function nn(t){var e=t.f;if((e&Te)!==0)return!0;if(e&_e&&(t.f&=~$t),(e&it)!==0){var n=t.deps;if(n!==null)for(var i=n.length,r=0;r<i;r++){var s=n[r];if(nn(s)&&zr(s),s.wv>t.wv)return!0}(e&Ue)!==0&&Ze===null&&ve(t,pe)}return!1}function Jr(t,e,n=!0){var i=t.reactions;if(i!==null&&!dt?.includes(t))for(var r=0;r<i.length;r++){var s=i[r];(s.f&_e)!==0?Jr(s,e,!1):e===s&&(n?ve(s,Te):(s.f&pe)!==0&&ve(s,it),Rt(s))}}function Qr(t){var e=xe,n=Le,i=Ne,r=X,s=dt,a=ie,o=tt,l=Lt,c=t.f;xe=null,Le=0,Ne=null,X=(c&(vt|Ht))===0?t:null,dt=null,Ut(t.ctx),tt=!1,Lt=++_n,t.ac!==null&&(Li(()=>{t.ac.abort(Kt)}),t.ac=null);try{t.f|=gi;var u=t.fn,g=u(),h=t.deps;if(xe!==null){var f;if(Gn(t,Le),h!==null&&Le>0)for(h.length=Le+xe.length,f=0;f<xe.length;f++)h[Le+f]=xe[f];else t.deps=h=xe;if(It&&yn()&&(t.f&Ue)!==0)for(f=Le;f<h.length;f++)(h[f].reactions??=[]).push(t)}else h!==null&&Le<h.length&&(Gn(t,Le),h.length=Le);if(Cn()&&Ne!==null&&!tt&&h!==null&&(t.f&(_e|it|Te))===0)for(f=0;f<Ne.length;f++)Jr(Ne[f],t);return r!==null&&r!==t&&(_n++,Ne!==null&&(i===null?i=Ne:i.push(...Ne))),(t.f&wt)!==0&&(t.f^=wt),g}catch(p){return Zr(p)}finally{t.f^=gi,xe=e,Le=n,Ne=i,X=r,dt=s,Ut(a),tt=o,Lt=l}}function Ba(t,e){let n=e.reactions;if(n!==null){var i=Us.call(n,t);if(i!==-1){var r=n.length-1;r===0?n=e.reactions=null:(n[i]=n[r],n.pop())}}n===null&&(e.f&_e)!==0&&(xe===null||!xe.includes(e))&&(ve(e,it),(e.f&Ue)!==0&&(e.f^=Ue,e.f&=~$t),Kr(e),Gn(e,0))}function Gn(t,e){var n=t.deps;if(n!==null)for(var i=e;i<n.length;i++)Ba(t,n[i])}function Vt(t){var e=t.f;if((e&bt)===0){ve(t,pe);var n=U,i=It;U=t,It=!0;try{(e&(pt|Qs))!==0?ja(t):ss(t),rs(t);var r=Qr(t);t.teardown=typeof r=="function"?r:null,t.wv=Vr;var s;fi&&ua&&(t.f&Te)!==0&&t.deps}finally{It=i,U=n}}}function d(t){var e=t.f,n=(e&_e)!==0;if(X!==null&&!tt){var i=U!==null&&(U.f&bt)!==0;if(!i&&!dt?.includes(t)){var r=X.deps;if((X.f&gi)!==0)t.rv<_n&&(t.rv=_n,xe===null&&r!==null&&r[Le]===t?Le++:xe===null?xe=[t]:xe.includes(t)||xe.push(t));else{(X.deps??=[]).push(t);var s=t.reactions;s===null?t.reactions=[X]:s.includes(X)||s.push(X)}}}if(tn){if(Et.has(t))return Et.get(t);if(n){var a=t,o=a.v;return((a.f&pe)===0&&a.reactions!==null||ts(a))&&(o=Mi(a)),Et.set(a,o),o}}else n&&(!Ze?.has(t)||ne?.is_fork&&!yn())&&(a=t,nn(a)&&zr(a),It&&yn()&&(a.f&Ue)===0&&es(a));if(Ze?.has(t))return Ze.get(t);if((t.f&wt)!==0)throw t.v;return t.v}function es(t){if(t.deps!==null){t.f^=Ue;for(const e of t.deps)(e.reactions??=[]).push(t),(e.f&_e)!==0&&(e.f&Ue)===0&&es(e)}}function ts(t){if(t.v===we)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(Et.has(e)||(e.f&_e)!==0&&ts(e))return!0;return!1}function Nt(t){var e=tt;try{return tt=!0,t()}finally{tt=e}}const Za=-7169;function ve(t,e){t.f=t.f&Za|e}function Ga(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(St in t)mi(t);else if(!Array.isArray(t))for(let e in t){const n=t[e];typeof n=="object"&&n&&St in n&&mi(n)}}}function mi(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let i in t)try{mi(t[i],e)}catch{}const n=Ci(t);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const i=Ar(n);for(let r in i){const s=i[r].get;if(s)try{s.call(t)}catch{}}}}}function ns(t){U===null&&(X===null&&sa(),ra()),tn&&ia()}function Ya(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function rt(t,e,n){var i=U;i!==null&&(i.f&Oe)!==0&&(t|=Oe);var r={ctx:ie,deps:null,nodes_start:null,nodes_end:null,f:t|Te|Ue,first:null,fn:e,last:null,next:null,parent:i,b:i&&i.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(n)try{Vt(r),r.f|=Di}catch(o){throw Ae(r),o}else e!==null&&Rt(r);var s=r;if(n&&s.deps===null&&s.teardown===null&&s.nodes_start===null&&s.first===s.last&&(s.f&en)===0&&(s=s.first,(t&pt)!==0&&(t&Ot)!==0&&s!==null&&(s.f|=Ot)),s!==null&&(s.parent=i,i!==null&&Ya(s,i),X!==null&&(X.f&_e)!==0&&(t&Ht)===0)){var a=X;(a.effects??=[]).push(s)}return r}function yn(){return X!==null&&!tt}function Qn(t){const e=rt(Vn,null,!1);return ve(e,pe),e.teardown=t,e}function We(t){ns();var e=U.f,n=!X&&(e&vt)!==0&&(e&Di)===0;if(n){var i=ie;(i.e??=[]).push(t)}else return is(t)}function is(t){return rt(ki|Pr,t,!1)}function Xa(t){return ns(),rt(Vn|Pr,t,!0)}function Ka(t){et.ensure();const e=rt(Ht|en,t,!0);return(n={})=>new Promise(i=>{n.outro?Wt(e,()=>{Ae(e),i(void 0)}):(Ae(e),i(void 0))})}function za(t){return rt(ki,t,!1)}function er(t,e){var n=ie,i={effect:null,ran:!1,deps:t};n.l.$.push(i),i.effect=ei(()=>{t(),!i.ran&&(i.ran=!0,Nt(e))})}function Wa(){var t=ie;ei(()=>{for(var e of t.l.$){e.deps();var n=e.effect;(n.f&pe)!==0&&ve(n,it),nn(n)&&Vt(n),e.ran=!1}})}function Ua(t){return rt(Ai|en,t,!0)}function ei(t,e=0){return rt(Vn|e,t,!0)}function q(t,e=[],n=[],i=[]){Oa(i,e,n,r=>{rt(Vn,()=>t(...r.map(d)),!0)})}function ti(t,e=0){var n=rt(pt|e,t,!0);return n}function Be(t){return rt(vt|en,t,!0)}function rs(t){var e=t.teardown;if(e!==null){const n=tn,i=X;Ji(!0),De(null);try{e.call(null)}finally{Ji(n),De(i)}}}function ss(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){const r=n.ac;r!==null&&Li(()=>{r.abort(Kt)});var i=n.next;(n.f&Ht)!==0?n.parent=null:Ae(n,e),n=i}}function ja(t){for(var e=t.first;e!==null;){var n=e.next;(e.f&vt)===0&&Ae(e),e=n}}function Ae(t,e=!0){var n=!1;(e||(t.f&Mr)!==0)&&t.nodes_start!==null&&t.nodes_end!==null&&(Va(t.nodes_start,t.nodes_end),n=!0),ss(t,e&&!n),Gn(t,0),ve(t,bt);var i=t.transitions;if(i!==null)for(const s of i)s.stop();rs(t);var r=t.parent;r!==null&&r.first!==null&&as(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes_start=t.nodes_end=t.ac=null}function Va(t,e){for(;t!==null;){var n=t===e?null:Dn(t);t.remove(),t=n}}function as(t){var e=t.parent,n=t.prev,i=t.next;n!==null&&(n.next=i),i!==null&&(i.prev=n),e!==null&&(e.first===t&&(e.first=i),e.last===t&&(e.last=n))}function Wt(t,e,n=!0){var i=[];Oi(t,i,!0),os(i,()=>{n&&Ae(t),e&&e()})}function os(t,e){var n=t.length;if(n>0){var i=()=>--n||e();for(var r of t)r.out(i)}else e()}function Oi(t,e,n){if((t.f&Oe)===0){if(t.f^=Oe,t.transitions!==null)for(const a of t.transitions)(a.is_global||n)&&e.push(a);for(var i=t.first;i!==null;){var r=i.next,s=(i.f&Ot)!==0||(i.f&vt)!==0&&(t.f&pt)!==0;Oi(i,e,s?n:!1),i=r}}}function $i(t){ls(t,!0)}function ls(t,e){if((t.f&Oe)!==0){t.f^=Oe,(t.f&pe)===0&&(ve(t,Te),Rt(t));for(var n=t.first;n!==null;){var i=n.next,r=(n.f&Ot)!==0||(n.f&vt)!==0;ls(n,r?e:!1),n=i}if(t.transitions!==null)for(const s of t.transitions)(s.is_global||e)&&s.in()}}function cs(t,e){for(var n=t.nodes_start,i=t.nodes_end;n!==null;){var r=n===i?null:Dn(n);e.append(n),n=r}}const qa=["touchstart","touchmove"];function Ja(t){return qa.includes(t)}const ds=new Set,_i=new Set;function Qa(t,e,n,i={}){function r(s){if(i.capture||on.call(e,s),!s.cancelBubble)return Li(()=>n?.call(this,s))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?kn(()=>{e.addEventListener(t,r,i)}):e.addEventListener(t,r,i),r}function Ct(t,e,n,i,r){var s={capture:i,passive:r},a=Qa(t,e,n,s);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&Qn(()=>{e.removeEventListener(t,a,s)})}function st(t){for(var e=0;e<t.length;e++)ds.add(t[e]);for(var n of _i)n(t)}let tr=null;function on(t){var e=this,n=e.ownerDocument,i=t.type,r=t.composedPath?.()||[],s=r[0]||t.target;tr=t;var a=0,o=tr===t&&t.__root;if(o){var l=r.indexOf(o);if(l!==-1&&(e===document||e===window)){t.__root=e;return}var c=r.indexOf(e);if(c===-1)return;l<=c&&(a=l)}if(s=r[a]||t.target,s!==e){Dr(t,"currentTarget",{configurable:!0,get(){return s||n}});var u=X,g=U;De(null),nt(null);try{for(var h,f=[];s!==null;){var p=s.assignedSlot||s.parentNode||s.host||null;try{var E=s["__"+i];E!=null&&(!s.disabled||t.target===s)&&E.call(s,t)}catch(w){h?f.push(w):h=w}if(t.cancelBubble||p===e||p===null)break;s=p}if(h){for(let w of f)queueMicrotask(()=>{throw w});throw h}}finally{t.__root=e,delete t.currentTarget,De(u),nt(g)}}}function eo(t){var e=document.createElement("template");return e.innerHTML=t.replaceAll("<!>","<!---->"),e.content}function Yn(t,e){var n=U;n.nodes_start===null&&(n.nodes_start=t,n.nodes_end=e)}function R(t,e){var n=(e&va)!==0,i=(e&ma)!==0,r,s=!t.startsWith("<!>");return()=>{r===void 0&&(r=eo(s?t:"<!>"+t),n||(r=Nn(r)));var a=i||Fr?document.importNode(r,!0):r.cloneNode(!0);if(n){var o=Nn(a),l=a.lastChild;Yn(o,l)}else Yn(a,a);return a}}function fe(t=""){{var e=gt(t+"");return Yn(e,e),e}}function je(){var t=document.createDocumentFragment(),e=document.createComment(""),n=gt();return t.append(e,n),Yn(e,n),t}function m(t,e){t!==null&&t.before(e)}function ue(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??=t.nodeValue)&&(t.__t=n,t.nodeValue=n+"")}function to(t,e){return no(t,e)}const Gt=new Map;function no(t,{target:e,anchor:n,props:i={},events:r,context:s,intro:a=!0}){xa();var o=new Set,l=g=>{for(var h=0;h<g.length;h++){var f=g[h];if(!o.has(f)){o.add(f);var p=Ja(f);e.addEventListener(f,on,{passive:p});var E=Gt.get(f);E===void 0?(document.addEventListener(f,on,{passive:p}),Gt.set(f,1)):Gt.set(f,E+1)}}};l(Ii(ds)),_i.add(l);var c=void 0,u=Ka(()=>{var g=n??e.appendChild(gt());return Aa(g,{pending:()=>{}},h=>{if(s){Ee({});var f=ie;f.c=s}r&&(i.$$events=r),c=t(h,i)||{},s&&Ie()}),()=>{for(var h of o){e.removeEventListener(h,on);var f=Gt.get(h);--f===0?(document.removeEventListener(h,on),Gt.delete(h)):Gt.set(h,f)}_i.delete(l),g!==n&&g.parentNode?.removeChild(g)}});return io.set(c,u),c}let io=new WeakMap;class us{anchor;#e=new Map;#t=new Map;#i=new Map;#n=new Set;#l=!0;constructor(e,n=!0){this.anchor=e,this.#l=n}#s=()=>{var e=ne;if(this.#e.has(e)){var n=this.#e.get(e),i=this.#t.get(n);if(i)$i(i),this.#n.delete(n);else{var r=this.#i.get(n);r&&(this.#t.set(n,r.effect),this.#i.delete(n),r.fragment.lastChild.remove(),this.anchor.before(r.fragment),i=r.effect)}for(const[s,a]of this.#e){if(this.#e.delete(s),s===e)break;const o=this.#i.get(a);o&&(Ae(o.effect),this.#i.delete(a))}for(const[s,a]of this.#t){if(s===n||this.#n.has(s))continue;const o=()=>{if(Array.from(this.#e.values()).includes(s)){var c=document.createDocumentFragment();cs(a,c),c.append(gt()),this.#i.set(s,{effect:a,fragment:c})}else Ae(a);this.#n.delete(s),this.#t.delete(s)};this.#l||!i?(this.#n.add(s),Wt(a,o,!1)):o()}}};#r=e=>{this.#e.delete(e);const n=Array.from(this.#e.values());for(const[i,r]of this.#i)n.includes(i)||(Ae(r.effect),this.#i.delete(i))};ensure(e,n){var i=ne,r=Br();if(n&&!this.#t.has(e)&&!this.#i.has(e))if(r){var s=document.createDocumentFragment(),a=gt();s.append(a),this.#i.set(e,{effect:Be(()=>n(a)),fragment:s})}else this.#t.set(e,Be(()=>n(this.anchor)));if(this.#e.set(i,e),r){for(const[o,l]of this.#t)o===e?i.skipped_effects.delete(l):i.skipped_effects.add(l);for(const[o,l]of this.#i)o===e?i.skipped_effects.delete(l.effect):i.skipped_effects.add(l.effect);i.oncommit(this.#s),i.ondiscard(this.#r)}else this.#s()}}function V(t,e,n=!1){var i=new us(t),r=n?Ot:0;function s(a,o){i.ensure(a,o)}ti(()=>{var a=!1;e((o,l=!0)=>{a=!0,s(l,o)}),a||s(!1,null)},r)}function qt(t,e,...n){var i=new us(t);ti(()=>{const r=e()??null;i.ensure(r,r&&(s=>r(s,...n)))},Ot)}const nr=[...` 	
\r\f \v\uFEFF`];function ro(t,e,n){var i=t==null?"":""+t;if(e&&(i=i?i+" "+e:e),n){for(var r in n)if(n[r])i=i?i+" "+r:r;else if(i.length)for(var s=r.length,a=0;(a=i.indexOf(r,a))>=0;){var o=a+s;(a===0||nr.includes(i[a-1]))&&(o===i.length||nr.includes(i[o]))?i=(a===0?"":i.substring(0,a))+i.substring(o+1):a=o}}return i===""?null:i}function ir(t,e=!1){var n=e?" !important;":";",i="";for(var r in t){var s=t[r];s!=null&&s!==""&&(i+=" "+r+": "+s+n)}return i}function ai(t){return t[0]!=="-"||t[1]!=="-"?t.toLowerCase():t}function so(t,e){if(e){var n="",i,r;if(Array.isArray(e)?(i=e[0],r=e[1]):i=e,t){t=String(t).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var s=!1,a=0,o=!1,l=[];i&&l.push(...Object.keys(i).map(ai)),r&&l.push(...Object.keys(r).map(ai));var c=0,u=-1;const E=t.length;for(var g=0;g<E;g++){var h=t[g];if(o?h==="/"&&t[g-1]==="*"&&(o=!1):s?s===h&&(s=!1):h==="/"&&t[g+1]==="*"?o=!0:h==='"'||h==="'"?s=h:h==="("?a++:h===")"&&a--,!o&&s===!1&&a===0){if(h===":"&&u===-1)u=g;else if(h===";"||g===E-1){if(u!==-1){var f=ai(t.substring(c,u).trim());if(!l.includes(f)){h!==";"&&g++;var p=t.substring(c,g).trim();n+=" "+p+";"}}c=g+1,u=-1}}}}return i&&(n+=ir(i)),r&&(n+=ir(r,!0)),n=n.trim(),n===""?null:n}return t==null?null:String(t)}function Re(t,e,n,i,r,s){var a=t.__className;if(a!==n||a===void 0){var o=ro(n,i,s);o==null?t.removeAttribute("class"):t.className=o,t.__className=n}else if(s&&r!==s)for(var l in s){var c=!!s[l];(r==null||c!==!!r[l])&&t.classList.toggle(l,c)}return s}function oi(t,e={},n,i){for(var r in n){var s=n[r];e[r]!==s&&(n[r]==null?t.style.removeProperty(r):t.style.setProperty(r,s,i))}}function me(t,e,n,i){var r=t.__style;if(r!==e){var s=so(e,i);s==null?t.removeAttribute("style"):t.style.cssText=s,t.__style=e}else i&&(Array.isArray(i)?(oi(t,n?.[0],i[0]),oi(t,n?.[1],i[1],"important")):oi(t,n,i));return i}function hs(t,e,n=!1){if(t.multiple){if(e==null)return;if(!Ei(e))return ba();for(var i of t.options)i.selected=e.includes(rr(i));return}for(i of t.options){var r=rr(i);if(Sa(r,e)){i.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function ao(t){var e=new MutationObserver(()=>{hs(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Qn(()=>{e.disconnect()})}function rr(t){return"__value"in t?t.__value:t.value}const oo=Symbol("is custom element"),lo=Symbol("is html");function Xn(t,e){var n=fs(t);n.value===(n.value=e??void 0)||t.value===e&&(e!==0||t.nodeName!=="PROGRESS")||(t.value=e??"")}function Q(t,e,n,i){var r=fs(t);r[e]!==(r[e]=n)&&(e==="loading"&&(t[ea]=n),n==null?t.removeAttribute(e):typeof n!="string"&&co(t).includes(e)?t[e]=n:t.setAttribute(e,n))}function fs(t){return t.__attributes??={[oo]:t.nodeName.includes("-"),[lo]:t.namespaceURI===_a}}var sr=new Map;function co(t){var e=t.getAttribute("is")||t.nodeName,n=sr.get(e);if(n)return n;sr.set(e,n=[]);for(var i,r=t,s=Element.prototype;s!==r;){i=Ar(r);for(var a in i)i[a].set&&n.push(a);r=Ci(r)}return n}function ar(t,e){return t===e||t?.[St]===e}function Jt(t={},e,n,i){return za(()=>{var r,s;return ei(()=>{r=s,s=[],Nt(()=>{t!==n(...s)&&(e(t,...s),r&&ar(n(...r),t)&&e(null,...r))})}),()=>{kn(()=>{s&&ar(n(...s),t)&&e(null,...s)})}}),t}function uo(t=!1){const e=ie,n=e.l.u;if(!n)return;let i=()=>Ga(e.s);if(t){let r=0,s={};const a=Jn(()=>{let o=!1;const l=e.s;for(const c in l)l[c]!==s[c]&&(s[c]=l[c],o=!0);return o&&r++,r});i=()=>d(a)}n.b.length&&Xa(()=>{or(e,i),Hn(n.b)}),We(()=>{const r=Nt(()=>n.m.map(qs));return()=>{for(const s of r)typeof s=="function"&&s()}}),n.a.length&&We(()=>{or(e,i),Hn(n.a)})}function or(t,e){if(t.l.s)for(const n of t.l.s)d(n);e()}let yi=Symbol();function G(t,e,n){const i=n[e]??={store:null,source:Pi(void 0),unsubscribe:Ye};if(i.store!==t&&!(yi in n))if(i.unsubscribe(),i.store=t??null,t==null)i.source.v=void 0,i.unsubscribe=Ye;else{var r=!0;i.unsubscribe=Fi(t,s=>{r?i.source.v=s:$(i.source,s)}),r=!1}return t&&yi in n?An(t):d(i.source)}function mt(){const t={};function e(){Qn(()=>{for(var n in t)t[n].unsubscribe();Dr(t,yi,{enumerable:!1,value:!0})})}return[t,e]}function J(t,e,n,i){var r=i,s=!0,a=()=>(s&&(s=!1,r=i),r),o;o=t[e],o===void 0&&i!==void 0&&(o=a());var l;return l=()=>{var c=t[e];return c===void 0?a():(s=!0,c)},l}function Ri(t){ie===null&&ta(),In&&ie.l!==null?ho(ie).m.push(t):We(()=>{const e=Nt(t);if(typeof e=="function")return e})}function ho(t){var e=t.l;return e.u??={a:[],b:[],m:[]}}function Fi(t,e,n){if(t==null)return e(void 0),n&&n(void 0),Ye;const i=Nt(()=>t.subscribe(e,n));return i.unsubscribe?()=>i.unsubscribe():i}const Yt=[];function fo(t,e){return{subscribe:le(t,e).subscribe}}function le(t,e=Ye){let n=null;const i=new Set;function r(o){if(Or(t,o)&&(t=o,n)){const l=!Yt.length;for(const c of i)c[1](),Yt.push(c,t);if(l){for(let c=0;c<Yt.length;c+=2)Yt[c][0](Yt[c+1]);Yt.length=0}}}function s(o){r(o(t))}function a(o,l=Ye){const c=[o,l];return i.add(c),i.size===1&&(n=e(r,s)||Ye),o(t),()=>{i.delete(c),i.size===0&&n&&(n(),n=null)}}return{set:r,update:s,subscribe:a}}function Me(t,e,n){const i=!Array.isArray(t),r=i?[t]:t;if(!r.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const s=e.length<2;return fo(n,(a,o)=>{let l=!1;const c=[];let u=0,g=Ye;const h=()=>{if(u)return;g();const p=e(i?c[0]:c,a,o);s?a(p):g=typeof p=="function"?p:Ye},f=r.map((p,E)=>Fi(p,w=>{c[E]=w,u&=~(1<<E),l&&h()},()=>{u|=1<<E}));return l=!0,h(),function(){Hn(f),g(),l=!1}})}function An(t){let e;return Fi(t,n=>e=n)(),e}function go(){return`zone_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const bi=["#e74c3c","#e67e22","#f1c40f","#2ecc71","#1abc9c","#3498db","#9b59b6","#e91e8f"];function po(){return bi[Math.floor(Math.random()*bi.length)]}function vo(t,e=200){return{id:go(),x:t,width:e,color:po(),texts:[{language:"cs",title:"",content:""}]}}function mo(t,e){const n=t.texts.find(i=>i.language===e);return n||t.texts[0]||null}const bn=le("cs"),_o=le("orange"),yo=le("Forest"),wi=le(!1),ln=le(!1),gs=le(!1),ps=le(!1),vs=le(null),bo=Me([vs,bn],([t,e])=>t?mo(t,e):null);function li(t){vs.set(t)}const ms=le({x:0,y:0});function wo(t,e){ms.set({x:t,y:e})}const _s=le({scrollX:0,scrollY:0,zoom:1});function So(t,e,n=1){_s.set({scrollX:t,scrollY:e,zoom:n})}const Si=le(!1);function xo(){Si.set(!0),setTimeout(()=>Si.set(!1),150)}const $e={BACKGROUND_BASE:-100,BACKGROUND_LAYER_START:-99,GROUND_REFERENCE:-1,ITEMS_BEHIND:5,PLAYER:10,ITEMS_FRONT:15,SELECTION_GRAPHICS:999,GRID_OVERLAY:1e3};function Hi(t){return t==="behind"?$e.ITEMS_BEHIND:$e.ITEMS_FRONT}const ot=["orange","white"];class Eo{currentSkin=ot[0];currentIndex=0;setSkin(e){ot.includes(e)&&(this.currentSkin=e,this.currentIndex=ot.indexOf(e),localStorage.setItem("catSkin",e))}getSkin(){const e=localStorage.getItem("catSkin");return e&&ot.includes(e)&&(this.currentSkin=e,this.currentIndex=ot.indexOf(e)),this.currentSkin}toggleSkin(){return this.currentIndex=(this.currentIndex+1)%ot.length,this.currentSkin=ot[this.currentIndex],this.setSkin(this.currentSkin),this.currentSkin}getAllSkins(){return ot}}const ys=new Eo,Io={FAST_VELOCITY_THRESHOLD:100,ROTATION_FULL:15,ROTATION_SLIGHT:8};class Co{scene;currentSkin;constructor(e,n="white"){this.scene=e,this.currentSkin=n}createAll(){ys.getAllSkins().forEach(n=>{this.createAnimationsForSkin(n)})}createAnimationsForSkin(e){const n=this.scene;n.anims.exists(`cat-idle-${e}`)||n.anims.create({key:`cat-idle-${e}`,frames:n.anims.generateFrameNumbers(`cat-idle-${e}`,{start:0,end:3}),frameRate:6,repeat:-1}),n.anims.exists(`cat-walk-${e}`)||n.anims.create({key:`cat-walk-${e}`,frames:n.anims.generateFrameNumbers(`cat-walk-${e}`,{start:0,end:5}),frameRate:12,repeat:-1}),[{key:`cat-jump-up-${e}`,frame:2},{key:`cat-jump-peak-up-${e}`,frame:3},{key:`cat-jump-peak-down-${e}`,frame:3},{key:`cat-jump-down-${e}`,frame:4}].forEach(({key:r,frame:s})=>{n.anims.exists(r)||n.anims.create({key:r,frames:[{key:`cat-walk-${e}`,frame:s}],frameRate:1,repeat:0})})}getSkin(){return this.currentSkin}setSkin(e){this.currentSkin=e}getAnimationKey(e){return`cat-${e}-${this.currentSkin}`}play(e,n){const i=this.getAnimationKey(n);e.anims.currentAnim?.key!==i&&e.play(i)}getJumpAnimationState(e){const{FAST_VELOCITY_THRESHOLD:n,ROTATION_FULL:i,ROTATION_SLIGHT:r}=Io;return e<-n?{animation:this.getAnimationKey("jump-up"),rotation:i,flipMultiplier:1}:e<-20?{animation:this.getAnimationKey("jump-peak-up"),rotation:r,flipMultiplier:1}:e<=n?{animation:this.getAnimationKey("jump-peak-down"),rotation:r,flipMultiplier:-1}:{animation:this.getAnimationKey("jump-down"),rotation:i,flipMultiplier:-1}}handleSkinChange(e,n){const i=this.currentSkin;this.currentSkin=n;const r=e.anims.currentAnim?.key;if(r){const a=`cat-${r.replace("cat-","").replace(`-${i}`,"")}-${n}`;this.scene.anims.exists(a)&&e.play(a)}}}const At={THRESHOLD_X:20,LANGUAGE_BUTTON:{width:120,height:60},SKIN_BUTTON:{width:120,height:60,yOffset:60}},lr={SPEED:350,JUMP_STRENGTH:-500};class ko{scene;getPlayerPosition;keyUp;keyLeft;keyRight;keyA;keyD;keyW;keySpace;touchLeft=!1;touchRight=!1;touchJump=!1;touchHandlers;constructor(e){this.scene=e.scene,this.getPlayerPosition=e.getPlayerPosition,this.setupKeyboardControls(),this.setupTouchControls()}setupKeyboardControls(){this.scene.input.keyboard&&(this.keyUp=this.scene.input.keyboard.addKey(H.Input.Keyboard.KeyCodes.UP,!1),this.keyLeft=this.scene.input.keyboard.addKey(H.Input.Keyboard.KeyCodes.LEFT,!1),this.keyRight=this.scene.input.keyboard.addKey(H.Input.Keyboard.KeyCodes.RIGHT,!1),this.keyA=this.scene.input.keyboard.addKey(H.Input.Keyboard.KeyCodes.A,!1),this.keyD=this.scene.input.keyboard.addKey(H.Input.Keyboard.KeyCodes.D,!1),this.keyW=this.scene.input.keyboard.addKey(H.Input.Keyboard.KeyCodes.W,!1),this.keySpace=this.scene.input.keyboard.addKey(H.Input.Keyboard.KeyCodes.SPACE,!1))}setupTouchControls(){const e=this.scene,n=a=>{if(An(Si)){this.touchLeft=!1,this.touchRight=!1,this.touchJump=!1;return}const o=a.x,l=a.y,c=e.scale.width;if(o>c-At.LANGUAGE_BUTTON.width&&l<At.LANGUAGE_BUTTON.height||o>c-At.SKIN_BUTTON.width&&l>=At.SKIN_BUTTON.yOffset&&l<At.SKIN_BUTTON.yOffset+At.SKIN_BUTTON.height)return;const u=e.cameras.main,g=this.getPlayerPosition(),h=g.x-u.scrollX,f=g.y-u.scrollY,p=o-h,E=l-f;p<-20?(this.touchLeft=!0,this.touchRight=!1):p>At.THRESHOLD_X?(this.touchRight=!0,this.touchLeft=!1):(this.touchLeft=!1,this.touchRight=!1),this.touchJump=E<-80},i=a=>{n(a)},r=a=>{a.isDown&&n(a)},s=()=>{this.touchLeft=!1,this.touchRight=!1,this.touchJump=!1};e.input.on("pointerdown",i),e.input.on("pointermove",r),e.input.on("pointerup",s),this.touchHandlers={pointerdown:i,pointermove:r,pointerup:s}}getInputState(){const e=this.keyA?.isDown||this.keyLeft?.isDown||this.touchLeft||!1,n=this.keyD?.isDown||this.keyRight?.isDown||this.touchRight||!1,i=this.keySpace?.isDown||this.keyW?.isDown||this.keyUp?.isDown||this.touchJump||!1;return{left:e,right:n,jump:i}}hasAnyInput(){const e=this.getInputState();return e.left||e.right||e.jump}destroy(){this.touchHandlers&&(this.scene.input.off("pointerdown",this.touchHandlers.pointerdown),this.scene.input.off("pointermove",this.touchHandlers.pointermove),this.scene.input.off("pointerup",this.touchHandlers.pointerup),this.touchHandlers=void 0)}}class Do extends H.Physics.Arcade.Sprite{animations;inputController;animState="idle";hasNotifiedMovement=!1;hasReceivedInput=!1;constructor(e,n,i){const r="white";super(e,n,i,`cat-idle-${r}`),e.add.existing(this),e.physics.add.existing(this),this.animations=new Co(e,r),this.animations.createAll(),this.inputController=new ko({scene:e,getPlayerPosition:()=>({x:this.x,y:this.y})}),this.setCollideWorldBounds(!0),this.setBounce(0),this.setSize(16,12),this.setOffset(16,36),this.setScale(5),this.setDepth($e.PLAYER),this.animations.play(this,"idle")}changeSkin(e){this.animations.handleSkinChange(this,e)}updateJumpAnimation(e){const{animation:n,rotation:i,flipMultiplier:r}=this.animations.getJumpAnimationState(e);this.anims.currentAnim?.key!==n&&this.play(n);const s=this.flipX?i*r:-i*r;this.setAngle(s)}update(){const e=this.inputController.getInputState(),n=this.body,i=n&&(n.blocked.down||n.touching.down);switch(this.inputController.hasAnyInput()&&!this.hasReceivedInput&&(this.hasReceivedInput=!0),this.hasReceivedInput&&this.inputController.hasAnyInput()&&!this.hasNotifiedMovement&&(this.hasNotifiedMovement=!0,ps.set(!0)),e.left?(this.setVelocityX(-350),this.setFlipX(!0),i&&(this.animState="running")):e.right?(this.setVelocityX(lr.SPEED),this.setFlipX(!1),i&&(this.animState="running")):(this.setVelocityX(0),i&&(this.animState="idle")),e.jump&&i&&(this.setVelocityY(lr.JUMP_STRENGTH),this.animState="jumping"),!i&&n&&n.velocity.y!==0&&(this.animState="jumping"),this.animState){case"idle":this.animations.play(this,"idle"),this.setAngle(0);break;case"running":this.animations.play(this,"walk"),this.setAngle(0);break;case"jumping":this.updateJumpAnimation(n.velocity.y);break}}destroy(e){this.inputController.destroy(),super.destroy(e)}}const Tt=[{name:"FOREST",folder:"forest",scrollFactors:[1,.8,.85,.9,.95,1]},{name:"FOREST BLUE",folder:"forest_blue",scrollFactors:[1,.8,.85,.9,.95,1]}];class Ao{currentIndex=0;constructor(){const e=localStorage.getItem("background");if(e){const n=Tt.findIndex(i=>i.folder===e);n!==-1&&(this.currentIndex=n)}}getBackground(){return Tt[this.currentIndex].folder}getCurrentConfig(){return Tt[this.currentIndex]}setBackground(e){const n=Tt.findIndex(i=>i.folder===e);n!==-1&&(this.currentIndex=n,localStorage.setItem("background",e))}toggleBackground(){this.currentIndex=(this.currentIndex+1)%Tt.length;const e=Tt[this.currentIndex];return localStorage.setItem("background",e.folder),e}getAllBackgrounds(){return Tt}}const Kn=new Ao;function bs(t,e){return new Promise(n=>{t.load.image(`bg0-${e.folder}`,`assets/backgrounds/${e.folder}/0.png`);for(let i=0;i<e.scrollFactors.length;i++){const r=i+1;t.load.image(`bg${r}-${e.folder}`,`assets/backgrounds/${e.folder}/${r}.png`)}t.load.once("complete",()=>{n(!0)}),t.load.once("loaderror",i=>{console.error(`Failed to load background asset: ${i.key}`),n(!1)}),t.load.start()})}function ws(t,e,n,i){const r=Math.max(n,t.scale.height),s=t.add.tileSprite(0,0,e,r,`bg0-${i.folder}`);s.setOrigin(0,0),s.setScrollFactor(1),s.setDepth($e.BACKGROUND_BASE),s.tilePositionX=0,s.tilePositionY=0;const a=[];for(let o=0;o<i.scrollFactors.length;o++){const c=`bg${o+1}-${i.folder}`;if(t.textures.exists(c)){const u=t.add.image(0,0,c);u.setOrigin(0,0),u.setScrollFactor(i.scrollFactors[o]),u.setDepth($e.BACKGROUND_LAYER_START+o),u.setDisplaySize(e,n),a.push(u)}}return{baseLayer:s,bgLayers:a}}function Ss(t,e){t&&(t.tilePositionX=e.scrollX)}function To(t){t.bgLayers.forEach(e=>e.destroy()),t.baseLayer.destroy()}const Mo=[{code:"cs",label:"CZ"},{code:"en",label:"EN"}],xs="cs",Po={isActive:!1,config:null,selectedItemId:null,itemDepthLayer:"behind",editMode:"items",selectedDialogZoneId:null,selectedFrameId:null},K=le(Po),Es=Me(K,t=>t.isActive),Lo=Me(K,t=>t.config),ni=le(!0);function Oo(){ni.update(t=>!t)}const wn=le(!1),Sn=le(!1);function $o(){wn.update(t=>!t)}function Ro(){Sn.update(t=>!t)}const Ni=le(xs);function Fo(t){Ni.set(t)}const Is=Me(K,t=>t.selectedItemId),Cs=Me(K,t=>t.itemDepthLayer),ut=Me(K,t=>t.editMode),ks=Me(K,t=>t.selectedDialogZoneId),Bi=Me(K,t=>t.config?.dialogZones||[]),Ds=Me(K,t=>t.selectedFrameId),As=Me(K,t=>t.config?.placedFrames||[]),Zi=le(new Map);function Ho(t,e,n){Zi.update(i=>{const r=new Map(i);return r.set(t,{x:e,y:n}),r})}function No(t){Zi.update(e=>{const n=new Map(e);return n.delete(t),n})}const Bo=Me(K,t=>!t.selectedFrameId||!t.config?.placedFrames?null:t.config.placedFrames.find(e=>e.id===t.selectedFrameId)??null),Gi=Me(K,t=>!t.selectedItemId||!t.config?.placedItems?null:t.config.placedItems.find(e=>e.id===t.selectedItemId)??null),Zo=Me(Gi,t=>t?.physicsEnabled??!1),Go=Me(Gi,t=>t?.flipX??!1);function cr(t,e){K.update(n=>n.config?{...n,config:{...n.config,playerStartX:t,playerStartY:e}}:n)}function Yo(t){K.update(e=>{if(!e.config)return e;const n=e.config.placedItems||[];return{...e,config:{...e.config,placedItems:[...n,t]}}})}function xn(t,e){K.update(n=>!n.config||!n.config.placedItems?n:{...n,config:{...n.config,placedItems:n.config.placedItems.map(i=>i.id===t?{...i,...e}:i)}})}function Ts(t){K.update(e=>!e.config||!e.config.placedItems?e:{...e,config:{...e.config,placedItems:e.config.placedItems.filter(n=>n.id!==t)},selectedItemId:e.selectedItemId===t?null:e.selectedItemId})}function zn(t){K.update(e=>({...e,selectedItemId:t}))}function Yi(){K.update(t=>({...t,selectedItemId:null}))}function Xo(){K.update(t=>({...t,itemDepthLayer:t.itemDepthLayer==="behind"?"front":"behind"}))}function Ko(t,e){xn(t,{depth:e})}function zo(t,e){e?(xn(t,{physicsEnabled:e,depth:Hi("behind")}),K.update(n=>({...n,itemDepthLayer:"behind"}))):xn(t,{physicsEnabled:e})}function Wo(t,e){xn(t,{flipX:e})}function Uo(t){K.set({isActive:!0,config:{...t,placedItems:t.placedItems||[],dialogZones:t.dialogZones||[],placedFrames:t.placedFrames||[]},selectedItemId:null,itemDepthLayer:"behind",editMode:"items",selectedDialogZoneId:null,selectedFrameId:null}),Tn.set(!1)}function jo(){K.update(t=>{const e=t.config?{...t.config,dialogZones:(t.config.dialogZones||[]).filter(n=>n.texts.some(i=>i.title.trim()!==""||i.content.trim()!==""))}:t.config;return{...t,isActive:!1,selectedItemId:null,config:e}}),Tn.set(!1)}function Vo(){return An(K).config}const Tn=le(!1);function dr(t){Tn.set(t)}const Xi=le({scrollX:0,scrollY:0,viewWidth:0,viewHeight:0,worldWidth:0,worldHeight:0,zoom:1,playerX:0,playerY:0});function qo(t){Xi.update(e=>({...e,...t}))}function cn(t){K.update(e=>({...e,editMode:t,selectedItemId:t==="items"?e.selectedItemId:null,selectedDialogZoneId:t==="dialogs"?e.selectedDialogZoneId:null,selectedFrameId:t==="frames"?e.selectedFrameId:null}))}function Jo(t){K.update(e=>{if(!e.config)return e;const n=e.config.dialogZones||[];return{...e,config:{...e.config,dialogZones:[...n,t]}}})}function dn(t,e){K.update(n=>!n.config||!n.config.dialogZones?n:{...n,config:{...n.config,dialogZones:n.config.dialogZones.map(i=>i.id===t?{...i,...e}:i)}})}function Qo(t){K.update(e=>!e.config||!e.config.dialogZones?e:{...e,config:{...e.config,dialogZones:e.config.dialogZones.filter(n=>n.id!==t)},selectedDialogZoneId:e.selectedDialogZoneId===t?null:e.selectedDialogZoneId})}function On(t){K.update(e=>({...e,selectedDialogZoneId:t}))}function ur(t,e,n){K.update(i=>!i.config||!i.config.dialogZones?i:{...i,config:{...i.config,dialogZones:i.config.dialogZones.map(r=>{if(r.id!==t)return r;const s=r.texts.findIndex(o=>o.language===e);let a;return s>=0?a=r.texts.map((o,l)=>l===s?{...o,...n}:o):a=[...r.texts,{language:e,title:"",content:"",...n}],{...r,texts:a}})}})}function el(t){K.update(e=>{if(!e.config)return e;const n=e.config.placedFrames||[];return{...e,config:{...e.config,placedFrames:[...n,t]}}})}function lt(t,e){K.update(n=>!n.config||!n.config.placedFrames?n:{...n,config:{...n.config,placedFrames:n.config.placedFrames.map(i=>i.id===t?{...i,...e}:i)}})}function Ms(t){K.update(e=>!e.config||!e.config.placedFrames?e:{...e,config:{...e.config,placedFrames:e.config.placedFrames.filter(n=>n.id!==t)},selectedFrameId:e.selectedFrameId===t?null:e.selectedFrameId})}function un(t){K.update(e=>({...e,selectedFrameId:t}))}const Ki=[{key:"tent",name:"Tent",path:"assets/ui/tent.png",scale:6,category:"structures"},{key:"lamp",name:"Lamp",path:"assets/ui/lamp.png",scale:8,category:"props"},{key:"sign_left",name:"Sign ←",path:"assets/ui/sign_left.png",scale:7,category:"signs"},{key:"sign_right",name:"Sign →",path:"assets/ui/sign_right.png",scale:7,category:"signs"},{key:"stone_0",name:"Stone 0",path:"assets/ui/stone_0.png",scale:4,category:"nature",supportsPhysics:!0},{key:"stone_1",name:"Stone 1",path:"assets/ui/stone_1.png",scale:5,category:"nature",supportsPhysics:!0},{key:"stone_2",name:"Stone 2",path:"assets/ui/stone_2.png",scale:4,category:"nature",supportsPhysics:!0}];function Ps(t){return Ki.find(e=>e.key===t)}function tl(t){return Ps(t)?.scale||1}function nl(t){return Ps(t)?.supportsPhysics??!1}class hr{scene;groundY;constructor(e,n){this.scene=e,this.groundY=n}static preloadAssets(e){Ki.forEach(n=>{e.load.image(n.key,n.path)})}createSprite(e){const{id:n,assetKey:i,x:r,scale:s=1,depth:a=5,yOffset:o=0,flipX:l=!1}=e,c=this.groundY+o,u=this.scene.add.sprite(r,c,i);return u.setScale(s),u.setDepth(a),u.setFlipX(l),u.setData("itemId",n),u}updatePosition(e,n,i){e.x=n,e.y=this.groundY+i}updateScale(e,n){e.setScale(n)}updateDepth(e,n){e.setDepth(n)}applyUpdates(e,n){n.x!==void 0&&(e.x=n.x),n.yOffset!==void 0&&(e.y=this.groundY+n.yOffset),n.scale!==void 0&&e.setScale(n.scale),n.depth!==void 0&&e.setDepth(n.depth),n.flipX!==void 0&&e.setFlipX(n.flipX)}worldYToOffset(e){return e-this.groundY}getGroundY(){return this.groundY}}const Wn=40,il=48,fr=5,rl=$e.PLAYER,Qt=50,sl=4871528,al=.4,ol=1,Ls=$e.GRID_OVERLAY,ci=16711680,ll=2,cl=.6,dl=.1,ul=1,hl=.2,gr=50,fl=50,gl=10,pl=4886754;function pr(t,e){return Math.round(t/e)*e}class vl{scene;groundY;isDragging=!1;callbacks;constructor(e,n,i={}){this.scene=e,this.groundY=n,this.callbacks=i}getIsDragging(){return this.isDragging}makeInteractive(e,n){e.setInteractive({cursor:"pointer"}),this.scene.input.setDraggable(e),e.on("pointerdown",()=>{this.isDragging||zn(n)}),e.on("dragstart",()=>{this.isDragging=!1,e.setTint(4886754),this.scene.data?.set("isDraggingItem",!0),this.callbacks.onDragStart?.(n)}),e.on("drag",(i,r,s)=>{this.isDragging=!0;const a=An(ni),o=a?pr(r,Qt):r,l=a?pr(s,Qt):s;e.setPosition(o,l),this.callbacks.onDrag?.(n,o,l)}),e.on("dragend",()=>{e.clearTint(),this.scene.data?.set("isDraggingItem",!1);const i=Math.round(e.x),s=Math.round(e.y)-this.groundY;xn(n,{x:i,yOffset:s}),this.callbacks.onDragEnd?.(n,i,s),this.scene.time.delayedCall(50,()=>{this.isDragging=!1})})}removeInteractivity(e){!e||!e.scene||(e.removeInteractive(),e.off("pointerdown"),e.off("dragstart"),e.off("drag"),e.off("dragend"))}}const ml={lineWidth:3,lineColor:4886754,lineAlpha:1,handleSize:8,handleColor:4886754,padding:5};class _l{scene;graphics;style;selectedId=null;constructor(e,n={}){this.scene=e,this.style={...ml,...n},this.graphics=e.add.graphics(),this.graphics.setDepth($e.SELECTION_GRAPHICS)}setSelectedId(e){this.selectedId=e}getSelectedId(){return this.selectedId}updateVisuals(e){if(this.graphics.clear(),!e||!this.selectedId)return;const n=e.getBounds(),{lineWidth:i,lineColor:r,lineAlpha:s,handleSize:a,handleColor:o,padding:l}=this.style;this.graphics.lineStyle(i,r,s),this.graphics.strokeRect(n.x-l,n.y-l,n.width+l*2,n.height+l*2),this.graphics.fillStyle(o,1),this.graphics.fillCircle(n.x,n.y,a),this.graphics.fillCircle(n.x+n.width,n.y,a),this.graphics.fillCircle(n.x,n.y+n.height,a),this.graphics.fillCircle(n.x+n.width,n.y+n.height,a)}clearVisuals(){this.graphics.clear(),this.selectedId=null}setupBackgroundDeselect(e){this.scene.input.on("pointerdown",n=>{if(e())return;this.scene.input.hitTestPointer(n).find(r=>r.type==="Sprite"&&r.getData("itemId"))||(Yi(),this.clearVisuals())})}destroy(){this.graphics?.destroy()}}class Un{scene;items=new Map;isBuilderMode=!1;physicsGroup=null;renderer;dragController;selectionManager;constructor(e,n,i=!1){this.scene=e,this.isBuilderMode=i,this.renderer=new hr(e,n),i||(this.physicsGroup=e.physics.add.staticGroup()),this.isBuilderMode&&(this.dragController=new vl(e,n,{onDrag:()=>this.updateSelectionVisuals()}),this.selectionManager=new _l(e))}static preloadAssets(e){hr.preloadAssets(e)}createItems(e){e.forEach(n=>{this.createItem(n)})}createItem(e){const n=this.renderer.createSprite(e),i={sprite:n,data:e};if(!this.isBuilderMode&&e.physicsEnabled&&this.physicsGroup){const r=this.createPhysicsBody(n,e);i.physicsBody=r}this.items.set(e.id,i),this.isBuilderMode&&this.dragController&&(this.dragController.makeInteractive(n,e.id),n.on("pointerdown",()=>{this.dragController?.getIsDragging()||(zn(e.id),this.updateSelectionVisuals())}))}createPhysicsBody(e,n){const i=e.getBounds(),r=i.width*.5,s=i.height*.8,a=e.x,o=e.y,l=this.scene.add.rectangle(a,o,r,s);return l.setVisible(!1),this.physicsGroup.add(l),l.setData("itemId",n.id),l}updateSelectionVisuals(){if(!this.selectionManager)return;const e=this.scene.data.get("selectedItemId");if(this.selectionManager.setSelectedId(e),!e){this.selectionManager.clearVisuals();return}const n=this.items.get(e);this.selectionManager.updateVisuals(n?.sprite??null)}updateItem(e,n){const i=this.items.get(e);i&&(this.renderer.applyUpdates(i.sprite,n),i.data={...i.data,...n})}removeItem(e){const n=this.items.get(e);n&&(this.dragController&&this.dragController.removeInteractivity(n.sprite),n.physicsBody&&n.physicsBody.destroy(),n.sprite.destroy(),this.items.delete(e))}removeAllItems(){this.items.forEach(e=>{!e.sprite||!e.sprite.scene||(this.dragController&&this.dragController.removeInteractivity(e.sprite),e.physicsBody&&e.physicsBody.destroy(),e.sprite.destroy())}),this.items.clear()}getItem(e){return this.items.get(e)?.data}getAllItems(){return Array.from(this.items.values()).map(e=>e.data)}getPhysicsGroup(){return this.physicsGroup}setInteractiveEnabled(e){!this.isBuilderMode||!this.dragController||(this.items.forEach(({sprite:n,data:i})=>{e?(this.dragController.makeInteractive(n,i.id),n.setAlpha(1),n.on("pointerdown",()=>{this.dragController?.getIsDragging()||(zn(i.id),this.updateSelectionVisuals())})):(n.disableInteractive(),n.off("pointerdown"),n.setAlpha(.6))}),!e&&this.selectionManager&&this.selectionManager.clearVisuals())}destroy(){this.removeAllItems(),this.selectionManager?.destroy()}setupBackgroundDeselect(){!this.isBuilderMode||!this.selectionManager||this.selectionManager.setupBackgroundDeselect(()=>this.dragController?.getIsDragging()??!1)}}function yl(){return`frame_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const bl=["#ffffff","#f8f8f8","#fffacd","#ffefd5","#ffe4e1","#e6e6fa","#f0fff0","#f5fffa","#fff0f5","#f0f8ff","#2d2d2d","#1a1a2e","#16213e","#1a1a1a","#2d132c","#1e3a3a","#3d1a1a","#1a2f1a","#3d3d1a","#2a1a3d"],wl=["#333333","#000000","#ffffff","#1a1a1a","#666666","#8b4513","#2c3e50","#c0392b","#27ae60","#2980b9","#8e44ad","#f39c12"],Sl=[12,14,16,18,20,24,28,32],Os={S:{label:"Small",scale:3},M:{label:"Medium",scale:4},L:{label:"Large",scale:5}};function xl(t){return Os[t].scale}function El(t){return t<=3?"S":t>=5?"L":"M"}const ht=4,hn="#ffffff",$s="#333333",$n=16,Il=64,Cl=96,kl=.06,vr=32,jn=[{key:"base_1",name:"Frame 1",path:"assets/frames/base 1.png",scale:4},{key:"base_2",name:"Frame 2",path:"assets/frames/base 2.png",scale:4},{key:"base_3",name:"Frame 3",path:"assets/frames/base 3.png",scale:4},{key:"base_4",name:"Frame 4",path:"assets/frames/base 4.png",scale:4},{key:"base_5",name:"Frame 5",path:"assets/frames/base 5.png",scale:4},{key:"base_6",name:"Frame 6",path:"assets/frames/base 6.png",scale:4},{key:"base_7",name:"Frame 7",path:"assets/frames/base 7.png",scale:4},{key:"base_8",name:"Frame 8",path:"assets/frames/base 8.png",scale:4},{key:"base_9",name:"Frame 9",path:"assets/frames/base 9.png",scale:4},{key:"base_10",name:"Frame 10",path:"assets/frames/base 10.png",scale:4},{key:"base_11",name:"Frame 11",path:"assets/frames/base 11.png",scale:4},{key:"base_12",name:"Frame 12",path:"assets/frames/base 12.png",scale:4},{key:"base_13",name:"Frame 13",path:"assets/frames/base 13.png",scale:4},{key:"base_14",name:"Frame 14",path:"assets/frames/base 14.png",scale:4},{key:"base_15",name:"Frame 15",path:"assets/frames/base 15.png",scale:4},{key:"base_16",name:"Frame 16",path:"assets/frames/base 16.png",scale:4},{key:"base_17",name:"Frame 17",path:"assets/frames/base 17.png",scale:4},{key:"base_18",name:"Frame 18",path:"assets/frames/base 18.png",scale:4},{key:"base_19",name:"Frame 19",path:"assets/frames/base 19.png",scale:4},{key:"base_20",name:"Frame 20",path:"assets/frames/base 20.png",scale:4},{key:"base_21",name:"Frame 21",path:"assets/frames/base 21.png",scale:4},{key:"base_22",name:"Frame 22",path:"assets/frames/base 22.png",scale:4},{key:"base_23",name:"Frame 23",path:"assets/frames/base 23.png",scale:4},{key:"base_24",name:"Frame 24",path:"assets/frames/base 24.png",scale:4},{key:"base_25",name:"Frame 25",path:"assets/frames/base 25.png",scale:4}];function Dl(t){return jn.find(e=>e.key===t)}function Al(t){return Dl(t)?.scale??ht}function pn(t=ht,e=!1){const n=Il*t,i=Cl*t,r=e?i:n,s=e?n:i,a=Math.min(n,i)*kl,o=r-a*2,l=s-a*2,c=o-vr*2,u=l-vr*2;return{frameWidth:r,frameHeight:s,innerWidth:o,innerHeight:l,textWidth:c,textHeight:u}}function Rn(t,e,n,i,r,s,a=4){t.clear();const o=parseInt(s.replace("#",""),16);t.fillStyle(o,1),t.fillRoundedRect(e-i/2,n-r/2,i,r,a)}class Tl{lastClickTime=0;lastClickedId=null;threshold;constructor(e=300){this.threshold=e}check(e){const n=Date.now();return this.lastClickedId===e&&n-this.lastClickTime<this.threshold?(this.reset(),!0):(this.lastClickTime=n,this.lastClickedId=e,!1)}reset(){this.lastClickTime=0,this.lastClickedId=null}}class mr{scene;frames=new Map;constructor(e){this.scene=e}static preloadAssets(e){for(let n=1;n<=25;n++)e.load.image(`frame_base_${n}`,`assets/frames/base ${n}.png`)}createFrames(e){e.forEach(n=>{this.createFrame(n)})}createFrame(e){const n=`frame_${e.frameKey}`;if(!this.scene.textures.exists(n)){console.warn(`[GameFrameManager] Frame texture not found: ${n}`);return}const i=e.scale??ht,r=e.depth??$e.ITEMS_FRONT,s=(e.rotation??0)*(Math.PI/180),a=e.rotation===90,{innerWidth:o,innerHeight:l}=pn(i,a),c=this.scene.add.graphics();c.setDepth(r-.1),Rn(c,e.x,e.y,o,l,e.backgroundColor||hn);const u=this.scene.add.sprite(e.x,e.y,n);u.setScale(i),u.setDepth(r),u.setOrigin(.5,.5),u.setRotation(s);const g={sprite:u,background:c,data:e};this.frames.set(e.id,g),e.url&&this.makeClickable(g)}makeClickable(e){const{sprite:n,data:i}=e;n.setInteractive({useHandCursor:!0}),n.on("pointerover",()=>{n.setScale((i.scale??ht)*1.05)}),n.on("pointerout",()=>{n.setScale(i.scale??ht)}),n.on("pointerdown",()=>{i.url&&(xo(),window.open(i.url,"_blank","noopener,noreferrer"))})}destroy(){this.frames.forEach(({sprite:e,background:n})=>{e.destroy(),n.destroy()}),this.frames.clear()}}async function _r(){const t=await fetch("./config/map.json");if(!t.ok)throw new Error(`Failed to load map config: ${t.status}`);const e=await t.json();if(!e.worldWidth||!e.worldHeight)throw new Error("Invalid map config structure");return e}const Fn={generateId(){return`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`},create(t){const{assetKey:e,x:n,yOffset:i=0,depthLayer:r="behind",scale:s}=t;return{id:Fn.generateId(),assetKey:e,x:Math.round(n),y:0,scale:s??tl(e),depth:Hi(r),yOffset:Math.round(i)}},createAtWorldPosition(t,e,n,i,r="behind"){return Fn.create({assetKey:t,x:e,yOffset:n-i,depthLayer:r})},clone(t,e=50){return{...t,id:Fn.generateId(),x:t.x+e}}},Mt={HEIGHT:40,VISUAL:{COLOR:9139029,ALPHA:.3},PHYSICS:{COLOR:0,ALPHA:0}},En={getGroundY(t,e=Mt.HEIGHT){return t-e},createVisualGround(t,e){const n=e.height??Mt.HEIGHT,i=En.getGroundY(e.worldHeight,n),r=t.add.rectangle(0,i,e.worldWidth,n,e.color??Mt.VISUAL.COLOR,e.alpha??Mt.VISUAL.ALPHA);return r.setOrigin(0,0),r.setDepth(e.depth??$e.GROUND_REFERENCE),{ground:r,groundY:i}},createPhysicsGround(t,e){const n=e.height??Mt.HEIGHT,i=En.getGroundY(e.worldHeight,n),r=t.add.rectangle(0,i,e.worldWidth,n,e.color??Mt.PHYSICS.COLOR,e.alpha??Mt.PHYSICS.ALPHA);return r.setOrigin(0,0),t.physics.add.existing(r,!0),{ground:r,groundY:i}},addPlayerCollision(t,e,n){return t.physics.add.collider(e,n)}},ft={GAME:"GameScene",BUILDER:"BuilderScene"};class Ml extends H.Scene{player;mapConfig;parallaxLayers=null;loadedBackgrounds=new Set;itemManager;frameManager;dialogZones=[];currentDialogZone=null;unsubscribers=[];initData;constructor(){super({key:ft.GAME})}init(e){this.initData=e}preload(){ot.forEach(e=>{this.load.spritesheet(`cat-idle-${e}`,`assets/sprites/${e}/Idle.png`,{frameWidth:48,frameHeight:48}),this.load.spritesheet(`cat-walk-${e}`,`assets/sprites/${e}/Walk.png`,{frameWidth:48,frameHeight:48})}),Un.preloadAssets(this),mr.preloadAssets(this)}create(){this.initializeScene()}async initializeScene(){wi.set(!0);try{await this.loadMapConfiguration();const e=Kn.getCurrentConfig();await this.loadBackgroundIfNeeded(e),this.createParallaxBackground();const{ground:n,groundY:i}=En.createPhysicsGround(this,{worldWidth:this.mapConfig.worldWidth,worldHeight:this.mapConfig.worldHeight});this.player=new Do(this,this.mapConfig.playerStartX,this.mapConfig.playerStartY),En.addPlayerCollision(this,this.player,n),this.itemManager=new Un(this,i,!1),this.mapConfig.placedItems&&this.mapConfig.placedItems.length>0&&this.itemManager.createItems(this.mapConfig.placedItems);const r=this.itemManager.getPhysicsGroup();r&&this.physics.add.collider(this.player,r),this.frameManager=new mr(this),this.mapConfig.placedFrames&&this.mapConfig.placedFrames.length>0&&this.frameManager.createFrames(this.mapConfig.placedFrames),this.dialogZones=this.mapConfig.dialogZones||[];const s=Bi.subscribe(a=>{this.dialogZones=a,this.recheckCurrentZone()});this.unsubscribers.push(s),this.cameras.main.startFollow(this.player,!0,.1,.1),this.cameras.main.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.physics.world.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.scale.on("resize",this.handleResize,this)}catch(e){console.error("[GameScene] Failed to initialize scene:",e)}finally{wi.set(!1)}}async loadMapConfiguration(){try{if(this.initData?.useBuilderConfig){const e=Vo();this.mapConfig=e||await _r()}else this.mapConfig=await _r()}catch(e){console.error("[GameScene] Failed to load map configuration:",e),this.mapConfig={worldWidth:3200,worldHeight:600,playerStartX:400,playerStartY:300,placedItems:[]}}}createParallaxBackground(){const e=Kn.getCurrentConfig();this.parallaxLayers=ws(this,this.mapConfig.worldWidth,this.mapConfig.worldHeight,e)}async loadBackgroundIfNeeded(e){if(this.loadedBackgrounds.has(e.folder))return!0;const n=await bs(this,e);return n&&this.loadedBackgrounds.add(e.folder),n}handleResize(e){if(!(!this.cameras?.main||!this.mapConfig)&&(this.cameras.main.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.parallaxLayers?.baseLayer)){const n=Math.max(this.mapConfig.worldHeight,e.height);this.parallaxLayers.baseLayer.setSize(this.mapConfig.worldWidth,n)}}shutdown(){this.scale.off("resize",this.handleResize,this),li(null),this.currentDialogZone=null,this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.itemManager&&this.itemManager.destroy()}update(){if(!this.player)return;this.player.update();const e=this.cameras.main,n=this.player.x-e.scrollX,i=this.player.y-e.scrollY;wo(n,i),So(e.scrollX,e.scrollY,e.zoom),this.checkDialogZones(),this.parallaxLayers&&Ss(this.parallaxLayers.baseLayer,this.cameras.main)}checkDialogZones(){const e=this.player.x;let n=null;for(const i of this.dialogZones)if(e>=i.x&&e<=i.x+i.width){n=i;break}n?.id!==this.currentDialogZone?.id&&(this.currentDialogZone=n,li(n))}recheckCurrentZone(){if(!this.currentDialogZone)return;const e=this.dialogZones.find(n=>n.id===this.currentDialogZone?.id);e&&(this.currentDialogZone=e,li(e))}}let Rs=!1;function Pn(t){Rs=t}function yr(){return Rs}function vn(){const t=document.activeElement;if(!t)return!1;const e=t.tagName.toUpperCase();return e==="INPUT"||e==="TEXTAREA"||t.getAttribute("contenteditable")==="true"}const Pl=.05,Ll=1,Ln=400;class Ol{scene;camera;worldWidth;worldHeight;isPanning=!1;panStartX=0;panStartY=0;cameraDragStartX=0;cameraDragStartY=0;isDraggingToScroll=!1;dragScrollStartX=0;dragScrollStartY=0;dragScrollCameraStartX=0;dragScrollCameraStartY=0;isZoomedOut=!1;isAnimating=!1;savedScrollX=0;savedScrollY=0;constructor(e,n,i){this.scene=e,this.camera=e.cameras.main,this.worldWidth=n,this.worldHeight=i}setup(){this.setupCamera(),this.setupMouseControls(),this.setupKeyboardControls()}setupCamera(){this.camera.setBounds(0,0,this.worldWidth,this.worldHeight),this.camera.setZoom(1)}centerOn(e,n){this.camera.centerOn(e,n)}setupMouseControls(){this.scene.input.on("wheel",(e,n,i,r)=>{if(this.isZoomedOut)return;const s=this.camera.scrollX+i,a=this.camera.scrollY+r;this.camera.setScroll(H.Math.Clamp(s,0,this.worldWidth-this.camera.width),H.Math.Clamp(a,0,this.worldHeight-this.camera.height))}),this.scene.input.on("pointerdown",e=>{this.isZoomedOut||yr()||(e.rightButtonDown()||e.middleButtonDown()?(this.isPanning=!0,this.panStartX=e.x,this.panStartY=e.y,this.cameraDragStartX=this.camera.scrollX,this.cameraDragStartY=this.camera.scrollY):e.leftButtonDown()&&!this.isDraggingObject()&&(this.scene.data.get("isDraggingItem")===!0||(this.dragScrollStartX=e.x,this.dragScrollStartY=e.y,this.dragScrollCameraStartX=this.camera.scrollX,this.dragScrollCameraStartY=this.camera.scrollY)))}),this.scene.input.on("pointermove",e=>{if(!(this.isZoomedOut||yr())){if(this.isPanning){const n=e.x-this.panStartX,i=e.y-this.panStartY,r=this.cameraDragStartX-n,s=this.cameraDragStartY-i;this.camera.setScroll(H.Math.Clamp(r,0,this.worldWidth-this.camera.width),H.Math.Clamp(s,0,this.worldHeight-this.camera.height))}else if(e.leftButtonDown()&&!this.isDraggingToScroll&&!this.isDraggingObject()&&!(this.scene.data.get("isDraggingItem")===!0)){const i=Math.abs(e.x-this.dragScrollStartX),r=Math.abs(e.y-this.dragScrollStartY);Math.sqrt(i*i+r*r)>10&&(this.isDraggingToScroll=!0,this.scene.input.setDefaultCursor("grabbing"))}if(this.isDraggingToScroll){const n=e.x-this.dragScrollStartX,i=e.y-this.dragScrollStartY,r=this.dragScrollCameraStartX-n,s=this.dragScrollCameraStartY-i;this.camera.setScroll(H.Math.Clamp(r,0,this.worldWidth-this.camera.width),H.Math.Clamp(s,0,this.worldHeight-this.camera.height))}}}),this.scene.input.on("pointerup",e=>{!e.rightButtonDown()&&!e.middleButtonDown()&&(this.isPanning=!1),this.isDraggingToScroll&&(this.isDraggingToScroll=!1,this.scene.input.setDefaultCursor("default"))})}setupKeyboardControls(){const e={up:this.scene.input.keyboard.addKey(H.Input.Keyboard.KeyCodes.UP,!1),down:this.scene.input.keyboard.addKey(H.Input.Keyboard.KeyCodes.DOWN,!1),left:this.scene.input.keyboard.addKey(H.Input.Keyboard.KeyCodes.LEFT,!1),right:this.scene.input.keyboard.addKey(H.Input.Keyboard.KeyCodes.RIGHT,!1)},n={w:this.scene.input.keyboard.addKey(H.Input.Keyboard.KeyCodes.W,!1),a:this.scene.input.keyboard.addKey(H.Input.Keyboard.KeyCodes.A,!1),s:this.scene.input.keyboard.addKey(H.Input.Keyboard.KeyCodes.S,!1),d:this.scene.input.keyboard.addKey(H.Input.Keyboard.KeyCodes.D,!1)};this.scene.input.keyboard.addKey(H.Input.Keyboard.KeyCodes.SPACE,!1).on("down",()=>{vn()||this.isZoomedOut||this.centerOnPlayer()}),this.scene.input.keyboard.addKey(H.Input.Keyboard.KeyCodes.F,!1).on("down",()=>{vn()||this.toggleZoomToFit()}),this.scene.events.on("update",()=>{if(this.isZoomedOut||vn())return;const s=10;e.left.isDown||n.a.isDown?this.camera.scrollX=Math.max(0,this.camera.scrollX-s):(e.right.isDown||n.d.isDown)&&(this.camera.scrollX=Math.min(this.worldWidth-this.camera.width,this.camera.scrollX+s)),e.up.isDown||n.w.isDown?this.camera.scrollY=Math.max(0,this.camera.scrollY-s):(e.down.isDown||n.s.isDown)&&(this.camera.scrollY=Math.min(this.worldHeight-this.camera.height,this.camera.scrollY+s))})}centerOnPlayer(){const e=this.scene.data.get("playerSprite");e&&this.camera.centerOn(e.x,e.y)}isDraggingObject(){return this.scene.data.get("isDraggingObject")===!0}getIsZoomedOut(){return this.isZoomedOut}toggleZoomToFit(){this.isZoomedOut?this.resetZoom():this.zoomToFit()}zoomToFit(){if(this.isZoomedOut||this.isAnimating)return;this.savedScrollX=this.camera.scrollX,this.savedScrollY=this.camera.scrollY,this.isZoomedOut=!0,this.isAnimating=!0,dr(!0);const e=this.camera.width/this.worldWidth,n=this.camera.height/this.worldHeight;let i=Math.min(e,n);i=Math.max(i,Pl);const r=this.worldWidth/2,s=this.worldHeight/2;this.camera.removeBounds(),this.camera.pan(r,s,Ln,"Sine.easeInOut"),this.camera.zoomTo(i,Ln,"Sine.easeInOut",!1,(a,o)=>{o===1&&(this.isAnimating=!1)})}resetZoom(){if(!this.isZoomedOut||this.isAnimating)return;this.isZoomedOut=!1,this.isAnimating=!0,dr(!1);const e=this.savedScrollX+this.camera.width/2,n=this.savedScrollY+this.camera.height/2;this.camera.pan(e,n,Ln,"Sine.easeInOut"),this.camera.zoomTo(Ll,Ln,"Sine.easeInOut",!1,(i,r)=>{r===1&&(this.camera.setBounds(0,0,this.worldWidth,this.worldHeight),this.isAnimating=!1)})}destroy(){}}class $l{scene;player;worldWidth;worldHeight;groundY;unsubscribers=[];constructor(e,n,i){this.scene=e,this.worldWidth=n,this.worldHeight=i,this.groundY=i-Wn}create(e,n){this.player=this.scene.add.sprite(e,n,"cat-idle-white",0),this.player.setScale(fr),this.player.setDepth(rl);const i=new H.Geom.Rectangle(8,4,32,40);return this.player.setInteractive({hitArea:i,hitAreaCallback:H.Geom.Rectangle.Contains,draggable:!0,cursor:"grab"}),this.scene.data.set("playerSprite",this.player),this.setupDragHandlers(),this.setupEditModeSubscription(),this.player}setupEditModeSubscription(){const e=ut.subscribe(n=>{if(n==="dialogs")this.player.disableInteractive(),this.player.setAlpha(.6);else{const i=new H.Geom.Rectangle(8,4,32,40);this.player.setInteractive({hitArea:i,hitAreaCallback:H.Geom.Rectangle.Contains,draggable:!0,cursor:"grab"}),this.player.setAlpha(1)}});this.unsubscribers.push(e)}setupDragHandlers(){this.player.on("dragstart",()=>{this.player.setTint(pl),this.scene.data.set("isDraggingObject",!0)}),this.player.on("drag",(e,n,i)=>{const r=H.Math.Clamp(n,gr,this.worldWidth-gr),s=H.Math.Clamp(i,fl,this.worldHeight-gl);this.player.setPosition(r,s),cr(Math.round(r),Math.round(s))}),this.player.on("dragend",()=>{this.player.clearTint(),this.scene.data.set("isDraggingObject",!1);let e=this.player.y;const n=il*fr;this.player.y+n/2>this.groundY&&(e=this.groundY-n/2,this.player.setY(e)),cr(Math.round(this.player.x),Math.round(e))})}getSprite(){return this.player}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.player&&this.player.destroy()}}class Rl{scene;graphics;worldWidth;worldHeight;constructor(e,n,i){this.scene=e,this.worldWidth=n,this.worldHeight=i}create(){return this.graphics=this.scene.add.graphics(),this.graphics.setDepth(Ls),this.draw(),this.graphics}draw(){this.graphics.clear(),this.graphics.lineStyle(ol,sl,al);const e=Math.max(this.worldHeight,this.scene.scale.height);for(let i=0;i<=this.worldWidth;i+=Qt)this.graphics.beginPath(),this.graphics.moveTo(i,0),this.graphics.lineTo(i,e),this.graphics.strokePath();for(let i=0;i<=e;i+=Qt)this.graphics.beginPath(),this.graphics.moveTo(0,i),this.graphics.lineTo(this.worldWidth,i),this.graphics.strokePath();const n=this.worldHeight-Wn;this.graphics.lineStyle(ll,ci,cl),this.graphics.beginPath(),this.graphics.moveTo(0,n),this.graphics.lineTo(this.worldWidth,n),this.graphics.strokePath(),this.graphics.lineStyle(ul,ci,hl),this.graphics.fillStyle(ci,dl),this.graphics.fillRect(0,n,this.worldWidth,e-n)}getGraphics(){return this.graphics}redraw(){this.draw()}destroy(){this.graphics&&this.graphics.destroy()}}class Fl{listeners=new Map;on(e,n){this.listeners.has(e)||this.listeners.set(e,new Set);const i=this.listeners.get(e);return i.add(n),{unsubscribe:()=>{i.delete(n),i.size===0&&this.listeners.delete(e)}}}once(e,n){const i=this.on(e,r=>{i.unsubscribe(),n(r)});return i}emit(e,n){const i=this.listeners.get(e);i&&i.forEach(r=>{try{r(n)}catch(s){console.error(`[EventBus] Error in listener for "${e}":`,s)}})}off(e){this.listeners.delete(e)}clear(){this.listeners.clear()}listenerCount(e){return this.listeners.get(e)?.size??0}}const kt=new Fl,Dt={ASSET_DROPPED:"asset:dropped",FRAME_DROPPED:"frame:dropped",MINIMAP_NAVIGATE:"minimap:navigate",DIALOG_ZONE_CREATE:"dialogZone:create"};class Hl{scene;groundY;itemManager;unsubscribers=[];constructor(e,n){this.scene=e,this.groundY=n}create(e){return this.itemManager=new Un(this.scene,this.groundY,!0),e&&e.length>0&&this.itemManager.createItems(e),this.setupBackgroundDeselect(),this.setupStoreSubscriptions(),this.setupAssetDropListener(),this.setupDeleteKeys(),this.itemManager}setupBackgroundDeselect(){this.itemManager.setupBackgroundDeselect()}setupStoreSubscriptions(){const e=Is.subscribe(s=>{this.scene.data.set("selectedItemId",s),this.itemManager.updateSelectionVisuals()});this.unsubscribers.push(e);const n=ut.subscribe(s=>{s==="dialogs"?(Yi(),this.itemManager.setInteractiveEnabled(!1)):this.itemManager.setInteractiveEnabled(!0)});this.unsubscribers.push(n);let i=[];const r=Lo.subscribe(s=>{if(!s?.placedItems)return;const a=s.placedItems;i.forEach(o=>{a.find(c=>c.id===o.id)||this.itemManager.removeItem(o.id)}),a.forEach(o=>{const l=i.find(c=>c.id===o.id);l&&JSON.stringify(l)!==JSON.stringify(o)&&this.itemManager.updateItem(o.id,o)}),i=a.map(o=>({...o}))});this.unsubscribers.push(r)}setupAssetDropListener(){const e=kt.on(Dt.ASSET_DROPPED,n=>{const{assetKey:i,canvasX:r,canvasY:s}=n,o=this.scene.cameras.main.getWorldPoint(r,s),l=o.x,c=o.y;let u="behind";Cs.subscribe(f=>{u=f})();const h=Fn.createAtWorldPosition(i,l,c,this.groundY,u);Yo(h),this.itemManager.createItem(h),zn(h.id)});this.unsubscribers.push(()=>e.unsubscribe())}setupDeleteKeys(){const e=this.scene.input.keyboard.addKey(H.Input.Keyboard.KeyCodes.DELETE,!1),n=this.scene.input.keyboard.addKey(H.Input.Keyboard.KeyCodes.BACKSPACE,!1),i=()=>{if(vn())return;const r=this.scene.data.get("selectedItemId");r&&Ts(r)};e.on("down",i),n.on("down",i)}getManager(){return this.itemManager}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.itemManager&&this.itemManager.destroy()}}function br(t,e){return Math.round(t/e)*e}class wr{scene;frames=new Map;unsubscribers=[];selectionGraphics=null;isDragging=!1;dragStartX=0;dragStartY=0;doubleClickDetector=new Tl;constructor(e){this.scene=e}static preloadAssets(e){for(let n=1;n<=25;n++)e.load.image(`frame_base_${n}`,`assets/frames/base ${n}.png`)}create(e){this.selectionGraphics=this.scene.add.graphics(),this.selectionGraphics.setDepth($e.SELECTION_GRAPHICS),e&&e.length>0&&e.forEach(n=>this.createFrame(n)),this.setupBackgroundDeselect(),this.setupStoreSubscriptions(),this.setupFrameDropListener(),this.setupDeleteKeys()}createFrame(e){const n=`frame_${e.frameKey}`;if(!this.scene.textures.exists(n)){console.warn(`Frame texture not found: ${n}`);return}const i=e.scale??ht,r=e.depth??$e.ITEMS_FRONT,s=(e.rotation??0)*(Math.PI/180),a=e.rotation===90,{innerWidth:o,innerHeight:l}=pn(i,a),c=this.scene.add.graphics();c.setDepth(r-.1),Rn(c,e.x,e.y,o,l,e.backgroundColor||hn);const u=this.scene.add.sprite(e.x,e.y,n);u.setScale(i),u.setDepth(r),u.setOrigin(.5,.5),u.setRotation(s);const g={sprite:u,background:c,data:e};this.frames.set(e.id,g),this.makeInteractive(g,e.id)}updateFrameVisuals(e){const{sprite:n,background:i,data:r}=e,s=`frame_${r.frameKey}`;n.texture.key!==s&&this.scene.textures.exists(s)&&n.setTexture(s);const a=r.scale??ht;n.setScale(a);const o=(r.rotation??0)*(Math.PI/180);n.setRotation(o);const l=r.rotation===90,{innerWidth:c,innerHeight:u}=pn(a,l);Rn(i,n.x,n.y,c,u,r.backgroundColor||hn)}moveContainer(e,n,i){const{sprite:r,background:s,data:a}=e;r.setPosition(n,i);const o=a.scale??ht,l=a.rotation===90,{innerWidth:c,innerHeight:u}=pn(o,l);Rn(s,n,i,c,u,a.backgroundColor||hn)}makeInteractive(e,n){const{sprite:i}=e;i.setInteractive({draggable:!0,useHandCursor:!0}),i.on("pointerdown",r=>{if(!this.isDragging){if(un(n),this.updateSelectionVisuals(),this.doubleClickDetector.check(n)){cn("frames");return}this.isDragging=!0,this.scene.data.set("isDraggingItem",!0),this.dragStartX=i.x-r.worldX,this.dragStartY=i.y-r.worldY}}),i.on("pointermove",r=>{if(!this.isDragging)return;if(!r.isDown){this.isDragging=!1;return}let s=r.worldX+this.dragStartX,a=r.worldY+this.dragStartY;An(ni)&&(s=br(s,Qt),a=br(a,Qt)),this.moveContainer(e,s,a),this.updateSelectionVisuals(),Ho(n,s,a)}),i.on("pointerup",()=>{this.isDragging&&(this.isDragging=!1,this.scene.data.set("isDraggingItem",!1),No(n),e.data.x=Math.round(i.x),e.data.y=Math.round(i.y),lt(n,{x:e.data.x,y:e.data.y}))})}setupBackgroundDeselect(){this.scene.input.on("pointerdown",e=>{let n="items";if(ut.subscribe(a=>n=a)(),n!=="frames")return;!this.scene.input.hitTestPointer(e).some(a=>{for(const[o,l]of this.frames)if(l.sprite===a)return!0;return!1})&&!this.isDragging&&(un(null),this.updateSelectionVisuals())})}setupStoreSubscriptions(){const e=Ds.subscribe(s=>{this.scene.data.set("selectedFrameId",s),this.updateSelectionVisuals()});this.unsubscribers.push(e);const n=ut.subscribe(s=>{s==="dialogs"?(un(null),this.setInteractiveEnabled(!1)):this.setInteractiveEnabled(!0)});this.unsubscribers.push(n);let i=[];const r=As.subscribe(s=>{i.forEach(a=>{s.find(l=>l.id===a.id)||this.removeFrame(a.id)}),s.forEach(a=>{const o=i.find(c=>c.id===a.id),l=this.frames.get(a.id);if(l&&o){const c=o.backgroundColor!==a.backgroundColor,u=o.textColor!==a.textColor,g=o.textSize!==a.textSize,h=JSON.stringify(o.texts)!==JSON.stringify(a.texts),f=o.rotation!==a.rotation,p=o.scale!==a.scale,E=o.frameKey!==a.frameKey;l.data=a,(c||u||g||h||f||p||E)&&(this.updateFrameVisuals(l),this.scene.data.get("selectedFrameId")===a.id&&this.updateSelectionVisuals())}}),i=s.map(a=>({...a}))});this.unsubscribers.push(r)}setupFrameDropListener(){const e=kt.on(Dt.FRAME_DROPPED,n=>{const{frameKey:i,canvasX:r,canvasY:s}=n,o=this.scene.cameras.main.getWorldPoint(r,s),l={id:yl(),frameKey:i,x:Math.round(o.x),y:Math.round(o.y),scale:Al(i),depth:$e.ITEMS_FRONT,rotation:90,backgroundColor:hn,textColor:"#333333",textSize:16,texts:[{language:"cs",text:""},{language:"en",text:""}]};el(l),this.createFrame(l),un(l.id)});this.unsubscribers.push(()=>e.unsubscribe())}setupDeleteKeys(){const e=this.scene.input.keyboard.addKey(H.Input.Keyboard.KeyCodes.DELETE,!1),n=this.scene.input.keyboard.addKey(H.Input.Keyboard.KeyCodes.BACKSPACE,!1),i=()=>{if(vn())return;let r="items";if(ut.subscribe(o=>r=o)(),r!=="frames")return;const a=this.scene.data.get("selectedFrameId");a&&Ms(a)};e.on("down",i),n.on("down",i)}updateSelectionVisuals(){if(!this.selectionGraphics)return;this.selectionGraphics.clear();const e=this.scene.data.get("selectedFrameId");if(!e)return;const n=this.frames.get(e);if(!n)return;const r=n.sprite.getBounds();this.selectionGraphics.lineStyle(3,10181046,1),this.selectionGraphics.strokeRect(r.x-4,r.y-4,r.width+8,r.height+8);const s=8;this.selectionGraphics.fillStyle(10181046,1),this.selectionGraphics.fillRect(r.x-4-s/2,r.y-4-s/2,s,s),this.selectionGraphics.fillRect(r.right+4-s/2,r.y-4-s/2,s,s),this.selectionGraphics.fillRect(r.x-4-s/2,r.bottom+4-s/2,s,s),this.selectionGraphics.fillRect(r.right+4-s/2,r.bottom+4-s/2,s,s)}removeFrame(e){const n=this.frames.get(e);n&&(n.sprite.destroy(),n.background.destroy(),this.frames.delete(e)),this.updateSelectionVisuals()}setInteractiveEnabled(e){this.frames.forEach(({sprite:n,background:i})=>{e?(n.setInteractive({draggable:!0,useHandCursor:!0}),n.setAlpha(1),i.setAlpha(1)):(n.disableInteractive(),n.setAlpha(.6),i.setAlpha(.6))}),!e&&this.selectionGraphics&&this.selectionGraphics.clear()}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.frames.forEach(({sprite:e,background:n})=>{e.destroy(),n.destroy()}),this.frames.clear(),this.selectionGraphics&&(this.selectionGraphics.destroy(),this.selectionGraphics=null)}}const Xt=Ls-1,yt=50,Sr=150,Nl=.3,Bl=.5,di=16,xr=16777215,Er=.6,Ir=0;class Zl{scene;worldWidth;worldHeight;graphics=null;zoneAreas=new Map;leftHandles=new Map;rightHandles=new Map;arrowGraphics=new Map;dragging=null;unsubscribers=[];createZoneSubscription;currentEditMode="items";currentZones=[];currentSelectedId=null;constructor(e,n,i){this.scene=e,this.worldWidth=n,this.worldHeight=i}create(){this.graphics=this.scene.add.graphics(),this.graphics.setDepth(Xt);const e=ut.subscribe(r=>{this.currentEditMode=r,this.render()});this.unsubscribers.push(e);const n=Bi.subscribe(r=>{this.currentZones=r,this.render()});this.unsubscribers.push(n);const i=ks.subscribe(r=>{this.currentSelectedId=r,this.render()});this.unsubscribers.push(i),this.scene.input.on("pointermove",this.handlePointerMove,this),this.scene.input.on("pointerup",this.handlePointerUp,this),this.scene.input.on("pointerdown",this.handlePointerDown,this),this.createZoneSubscription=kt.on(Dt.DIALOG_ZONE_CREATE,()=>{this.createNewZone()}),this.render()}clearVisuals(){this.graphics&&this.graphics.clear(),this.zoneAreas.forEach(e=>e.destroy()),this.zoneAreas.clear(),this.leftHandles.forEach(e=>e.destroy()),this.leftHandles.clear(),this.rightHandles.forEach(e=>e.destroy()),this.rightHandles.clear(),this.arrowGraphics.forEach(e=>e.destroy()),this.arrowGraphics.clear()}render(){if(this.clearVisuals(),this.currentEditMode==="dialogs")for(const e of this.currentZones)this.renderZone(e,e.id===this.currentSelectedId)}renderZone(e,n){if(!this.graphics)return;const i=H.Display.Color.HexStringToColor(e.color).color,r=n?Bl:Nl;this.graphics.fillStyle(i,r),this.graphics.fillRect(e.x,0,e.width,this.worldHeight),this.graphics.lineStyle(2,i,.8),this.graphics.strokeRect(e.x,0,e.width,this.worldHeight);const s=this.scene.add.rectangle(e.x+e.width/2,this.worldHeight/2,e.width-di*2,this.worldHeight);s.setOrigin(.5,.5),s.setInteractive({cursor:n?"grab":"pointer"}),s.setDepth(Xt+.1),s.setAlpha(.001),s.setData("zoneId",e.id),s.on("pointerdown",a=>{this.scene.data.set("isDraggingItem",!0),this.currentSelectedId===e.id?this.startDrag(e.id,"move",a.worldX):(On(e.id),this.scene.data.set("isDraggingItem",!1))}),this.zoneAreas.set(e.id,s),n&&this.createHandles(e)}createHandles(e){const n=this.scene.cameras.main.scrollY,i=this.scene.cameras.main.height,r=n+i/2,s=this.scene.add.rectangle(e.x,this.worldHeight/2,di,this.worldHeight);s.setOrigin(.5,.5),s.setInteractive({cursor:"ew-resize"}),s.setDepth(Xt+.2),s.setFillStyle(xr,Er),s.setData("zoneId",e.id),s.setData("type","left"),s.on("pointerdown",u=>{this.startDrag(e.id,"left",u.worldX)}),this.leftHandles.set(e.id,s);const a=8,o=this.scene.add.graphics();o.setDepth(Xt+.3),this.drawArrow(o,e.x-a,r,"left"),this.arrowGraphics.set(`${e.id}_left`,o);const l=this.scene.add.rectangle(e.x+e.width,this.worldHeight/2,di,this.worldHeight);l.setOrigin(.5,.5),l.setInteractive({cursor:"ew-resize"}),l.setDepth(Xt+.2),l.setFillStyle(xr,Er),l.setData("zoneId",e.id),l.setData("type","right"),l.on("pointerdown",u=>{this.startDrag(e.id,"right",u.worldX)}),this.rightHandles.set(e.id,l);const c=this.scene.add.graphics();c.setDepth(Xt+.3),this.drawArrow(c,e.x+e.width+a,r,"right"),this.arrowGraphics.set(`${e.id}_right`,c)}drawArrow(e,n,i,r){const a=r==="left"?-1:1;e.fillStyle(3355443,.8),e.beginPath(),e.moveTo(n+a*10+1,i),e.lineTo(n-a*10+1,i-10+1),e.lineTo(n-a*10+1,i+10-1),e.closePath(),e.fillPath(),e.fillStyle(16777215,.9),e.beginPath(),e.moveTo(n+a*10,i),e.lineTo(n-a*10,i-10),e.lineTo(n-a*10,i+10),e.closePath(),e.fillPath()}startDrag(e,n,i){const r=this.currentZones.find(s=>s.id===e);r&&(this.scene.data.set("isDraggingItem",!0),this.dragging={zoneId:e,type:n,startX:i,originalX:r.x,originalWidth:r.width})}getZoneBounds(e){let n=0,i=this.worldWidth;for(const r of this.currentZones){if(r.id===e)continue;const s=r.x+r.width,a=this.currentZones.find(o=>o.id===e);a&&(s<=a.x+a.width/2&&(n=Math.max(n,s+Ir)),r.x>=a.x+a.width/2&&(i=Math.min(i,r.x-Ir)))}return{minX:n,maxX:i-yt,maxRight:i}}wouldOverlap(e,n,i){const r=n+i;for(const s of this.currentZones){if(s.id===e)continue;const a=s.x,o=s.x+s.width;if(n<o&&r>a)return!0}return!1}handlePointerMove(e){if(!this.dragging)return;e.event?.stopPropagation?.();const n=e.worldX-this.dragging.startX,i=this.currentZones.find(s=>s.id===this.dragging?.zoneId);if(!i)return;const r=this.getZoneBounds(i.id);if(this.dragging.type==="left"){let s=this.dragging.originalX+n,a=this.dragging.originalWidth-n;if(s<0&&(a+=s,s=0),a<yt&&(s=this.dragging.originalX+this.dragging.originalWidth-yt,a=yt),s<r.minX){const o=r.minX-s;s=r.minX,a-=o}a>=yt&&!this.wouldOverlap(i.id,s,a)&&dn(i.id,{x:s,width:a})}else if(this.dragging.type==="right"){let s=this.dragging.originalWidth+n;s<yt&&(s=yt),i.x+s>this.worldWidth&&(s=this.worldWidth-i.x),i.x+s>r.maxRight&&(s=r.maxRight-i.x),s>=yt&&!this.wouldOverlap(i.id,i.x,s)&&dn(i.id,{width:s})}else if(this.dragging.type==="move"){let s=this.dragging.originalX+n;const a=i.width;if(s<0&&(s=0),s+a>this.worldWidth&&(s=this.worldWidth-a),!this.wouldOverlap(i.id,s,a))dn(i.id,{x:s});else{const o=this.findNonOverlappingPosition(i.id,s,a);o!==null&&dn(i.id,{x:o})}}}findNonOverlappingPosition(e,n,i){const r=this.currentZones.filter(u=>u.id!==e).sort((u,g)=>u.x-g.x);if(r.length===0)return Math.max(0,Math.min(n,this.worldWidth-i));let s=n,a=1/0;const o=r[0];if(o.x>=i){const u=o.x-i,g=Math.max(0,Math.min(n,u)),h=Math.abs(g-n);h<a&&(a=h,s=g)}for(let u=0;u<r.length-1;u++){const g=r[u],h=r[u+1],f=g.x+g.width,p=h.x;if(p-f>=i){const w=f,v=p-i,_=Math.max(w,Math.min(n,v)),y=Math.abs(_-n);y<a&&(a=y,s=_)}}const l=r[r.length-1],c=l.x+l.width;if(this.worldWidth-c>=i){const u=c,g=this.worldWidth-i,h=Math.max(u,Math.min(n,g)),f=Math.abs(h-n);f<a&&(a=f,s=h)}return a<1/0&&!this.wouldOverlap(e,s,i)?s:null}handlePointerUp(){this.dragging&&this.scene.data.set("isDraggingItem",!1),this.dragging=null}handlePointerDown(e){if(this.currentEditMode!=="dialogs"||this.dragging)return;const n=e.downElement;if(n&&n.tagName?.toUpperCase()!=="CANVAS")return;const i=e.worldX;for(const r of this.currentZones)if(i>=r.x&&i<=r.x+r.width)return;this.currentSelectedId&&On(null)}createNewZone(){const e=this.scene.cameras.main;let i=e.scrollX+e.width/2-Sr/2;const r=Sr;if(i=Math.max(0,Math.min(this.worldWidth-r,i)),this.wouldOverlap("",i,r)){const a=this.findNonOverlappingPosition("",i,r);if(a===null){console.warn("No room for a new dialog zone");return}i=a}const s=vo(i,r);s.x=i,Jo(s),On(s.id)}destroy(){for(const e of this.unsubscribers)e();this.unsubscribers=[],this.createZoneSubscription&&this.createZoneSubscription.unsubscribe(),this.scene.input.off("pointerdown",this.handlePointerDown,this),this.scene.input.off("pointermove",this.handlePointerMove,this),this.scene.input.off("pointerup",this.handlePointerUp,this),this.clearVisuals(),this.graphics&&(this.graphics.destroy(),this.graphics=null),this.dragging=null}}class Gl extends H.Scene{parallaxLayers=null;cameraController;playerController;gridOverlay;itemsController;framesController;dialogZoneRenderer;config;minimapSubscription;isShuttingDown=!1;get itemManager(){return this.itemsController?.getManager()}toggleZoom(){this.cameraController?.toggleZoomToFit()}constructor(){super({key:ft.BUILDER})}init(e){this.config=e.config}preload(){this.load.spritesheet("cat-idle-white","assets/sprites/white/Idle.png",{frameWidth:48,frameHeight:48}),Un.preloadAssets(this),wr.preloadAssets(this)}create(){this.isShuttingDown=!1,this.physics.world.setBounds(0,0,this.config.worldWidth,this.config.worldHeight);const e=this.config.worldHeight-Wn;this.cameraController=new Ol(this,this.config.worldWidth,this.config.worldHeight),this.playerController=new $l(this,this.config.worldWidth,this.config.worldHeight),this.gridOverlay=new Rl(this,this.config.worldWidth,this.config.worldHeight),this.itemsController=new Hl(this,e),this.framesController=new wr(this),this.dialogZoneRenderer=new Zl(this,this.config.worldWidth,this.config.worldHeight),this.createBackground(),this.gridOverlay.create(),this.createGroundReference(),this.playerController.create(this.config.playerStartX,this.config.playerStartY),this.itemsController.create(this.config.placedItems||[]),this.framesController.create(this.config.placedFrames||[]),this.dialogZoneRenderer.create(),this.cameraController.setup(),this.cameraController.centerOn(this.config.playerStartX,this.config.playerStartY),this.minimapSubscription=kt.on(Dt.MINIMAP_NAVIGATE,n=>{this.navigateToPosition(n.worldX,n.worldY)}),this.scale.on("resize",this.handleResize,this),this.events.on("shutdown",this.shutdown,this)}async createBackground(){const e=Kn.getCurrentConfig();try{await bs(this,e)}catch(n){console.error("Failed to load background:",n);return}this.parallaxLayers&&(To(this.parallaxLayers),this.parallaxLayers=null),this.parallaxLayers=ws(this,this.config.worldWidth,this.config.worldHeight,e)}createGroundReference(){En.createVisualGround(this,{worldWidth:this.config.worldWidth,worldHeight:this.config.worldHeight,height:Wn})}update(){this.parallaxLayers&&Ss(this.parallaxLayers.baseLayer,this.cameras.main);const e=this.cameras.main,n=this.data.get("playerSprite");qo({scrollX:e.worldView.x,scrollY:e.worldView.y,viewWidth:e.width,viewHeight:e.height,worldWidth:this.config.worldWidth,worldHeight:this.config.worldHeight,zoom:e.zoom,playerX:n?.x??this.config.playerStartX,playerY:n?.y??this.config.playerStartY})}navigateToPosition(e,n){this.cameraController.getIsZoomedOut()||this.cameraController.centerOn(e,n)}handleResize(e){if(!(!this.cameras?.main||!this.config)){if(this.cameraController?.getIsZoomedOut()||this.cameras.main.setBounds(0,0,this.config.worldWidth,this.config.worldHeight),this.parallaxLayers?.baseLayer){const n=Math.max(this.config.worldHeight,e.height);this.parallaxLayers.baseLayer.setSize(this.config.worldWidth,n)}this.gridOverlay&&this.gridOverlay.redraw()}}shutdown(){this.isShuttingDown||(this.isShuttingDown=!0,this.scale.off("resize",this.handleResize,this),this.minimapSubscription&&this.minimapSubscription.unsubscribe(),this.cameraController&&this.cameraController.destroy(),this.playerController&&this.playerController.destroy(),this.gridOverlay&&this.gridOverlay.destroy(),this.itemsController&&this.itemsController.destroy(),this.framesController&&this.framesController.destroy(),this.dialogZoneRenderer&&this.dialogZoneRenderer.destroy())}}const Yl="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Yl);ha();class Xl{currentLanguage="cs";setLanguage(e){this.currentLanguage=e,localStorage.setItem("language",e)}getLanguage(){const e=localStorage.getItem("language");return(e==="cs"||e==="en")&&(this.currentLanguage=e),this.currentLanguage}toggleLanguage(){return this.currentLanguage=this.currentLanguage==="cs"?"en":"cs",this.setLanguage(this.currentLanguage),this.currentLanguage}}const Fs=new Xl;let Ge=null;function Kl(t){Ge=t}function zl(){if(!Ge)return console.error("Scene manager not initialized"),null;try{return Ge.scene.getScene(ft.GAME)?.mapConfig||null}catch(t){return console.error("Failed to get map config:",t),null}}function Wl(t){if(!Ge)return console.error("Scene manager not initialized"),!1;try{return Ge.scene.getScene(ft.GAME)?(Ge.scene.stop(ft.GAME),Uo(t),Ge.scene.start(ft.BUILDER,{config:t}),!0):(console.error("GameScene not found"),!1)}catch(e){return console.error("Failed to switch to builder:",e),!1}}function Ul(){if(!Ge)return console.error("Scene manager not initialized"),!1;try{return Ge.scene.stop(ft.BUILDER),jo(),Ge.scene.start(ft.GAME,{useBuilderConfig:!0}),!0}catch(t){return console.error("Failed to switch to game:",t),!1}}function jl(){if(Ge)try{Ge.scene.getScene(ft.BUILDER)?.toggleZoom()}catch(t){console.error("Failed to toggle zoom:",t)}}var Vl=R('<button class="close-btn svelte-yrmttr" title="Close">×</button>'),ql=R('<div class="resize-handle resize-handle-sw svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M1 1L9 9M1 5L5 9M1 9L1 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></div> <div class="resize-handle resize-handle-se svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M9 1L1 9M9 5L5 9M9 9L9 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></div>',1),Jl=R("<div><!></div> <!>",1),Ql=R('<div><div class="panel-header svelte-yrmttr"><span class="panel-title svelte-yrmttr"> </span> <!> <div class="header-buttons svelte-yrmttr"><button class="minimize-btn svelte-yrmttr"> </button> <!></div></div> <!></div>');function ii(t,e){Ee(e,!0);let n=J(e,"initialRight",3,10),i=J(e,"initialTop",3,60),r=J(e,"width",3,280),s=J(e,"minWidth",3,200),a=J(e,"minHeight",3,100),o=J(e,"maxWidth",3,600),l=J(e,"maxHeight",3,800),c=J(e,"resizable",3,!1),u=J(e,"startMinimized",3,!1),g=J(e,"showClose",3,!1),h=z(Qe(u())),f=z(Qe({x:0,y:0})),p=z(Qe({width:r(),height:e.height??0})),E=z(!1),w=z(!1),v=z("se"),_=z(Qe({x:0,y:0})),y=z(null),M=z(!1);We(()=>{if(typeof window>"u")return;const x=localStorage.getItem(`panel-state-${e.panelId}`);if(x)try{const A=JSON.parse(x);$(f,{x:A.x,y:A.y},!0),c()&&A.width&&A.height&&$(p,{width:A.width,height:A.height},!0)}catch{$(f,{x:window.innerWidth-r()-n(),y:i()},!0)}else $(f,{x:window.innerWidth-r()-n(),y:i()},!0);$(M,!0)}),We(()=>{if(!d(M))return;const x=c()?{...d(f),width:d(p).width,height:d(p).height}:d(f);localStorage.setItem(`panel-state-${e.panelId}`,JSON.stringify(x))}),We(()=>{if(!d(M))return;function x(){if(!d(y))return;const A=c()?d(p).width:r();let W=d(f).x,ee=d(f).y,j=!1;const de=window.innerWidth-A;d(f).x>de&&(W=Math.max(10,de),j=!0);const Ke=window.innerHeight-40;d(f).y>Ke&&(ee=Math.max(10,Ke),j=!0),d(f).x<0&&(W=10,j=!0),d(f).y<0&&(ee=10,j=!0),j&&$(f,{x:W,y:ee},!0)}return window.addEventListener("resize",x),x(),()=>{window.removeEventListener("resize",x)}});function k(){$(h,!d(h))}function I(){e.onclose?.()}function D(x){x.target.closest("button")||($(E,!0),$(_,{x:x.clientX-d(f).x,y:x.clientY-d(f).y},!0),x.currentTarget.setPointerCapture(x.pointerId),x.preventDefault())}function L(x){if(!d(E))return;const A=x.clientX-d(_).x,W=x.clientY-d(_).y,ee=window.innerWidth-(d(y)?.offsetWidth??r()),j=window.innerHeight-40;$(f,{x:Math.max(0,Math.min(A,ee)),y:Math.max(0,Math.min(W,j))},!0)}function Z(x){d(E)&&($(E,!1),x.currentTarget.releasePointerCapture(x.pointerId))}function C(x){return A=>{c()&&($(w,!0),$(v,x,!0),A.currentTarget.setPointerCapture(A.pointerId),A.preventDefault(),A.stopPropagation())}}function O(x){if(!d(w)||!d(y))return;const A=d(y).getBoundingClientRect();let W,ee=x.clientY-A.top,j=d(f).x;d(v)==="se"?W=x.clientX-A.left:(W=A.right-x.clientX,j=x.clientX);const de=Math.max(s(),Math.min(o(),W)),Ke=Math.max(a(),Math.min(l(),ee));d(v)==="sw"&&(j=A.right-de,j<0&&(j=0));const Fe=d(v)==="se"?window.innerWidth-d(f).x-10:A.right-10,Bt=window.innerHeight-d(f).y-10,He=Math.min(de,Fe),rn=Math.min(Ke,Bt);$(p,{width:He,height:rn},!0),d(v)==="sw"&&W>=s()&&$(f,{...d(f),x:Math.max(0,j)},!0)}function B(x){d(w)&&($(w,!1),x.currentTarget.releasePointerCapture(x.pointerId))}function b(x){x.stopPropagation()}var S=Ql();let N;S.__pointerdown=b,S.__click=b;var Y=P(S);Y.__pointerdown=D,Y.__pointermove=L,Y.__pointerup=Z;var he=P(Y),re=P(he),Ce=T(he,2);{var Xe=x=>{var A=je(),W=oe(A);qt(W,()=>e.headerExtra),m(x,A)};V(Ce,x=>{e.headerExtra&&x(Xe)})}var at=T(Ce,2),ye=P(at);ye.__click=k;var ae=P(ye),be=T(ye,2);{var Pe=x=>{var A=Vl();A.__click=I,m(x,A)};V(be,x=>{g()&&x(Pe)})}var se=T(Y,2);{var ce=x=>{var A=Jl(),W=oe(A);let ee;var j=P(W);qt(j,()=>e.children);var de=T(W,2);{var Ke=Fe=>{var Bt=ql(),He=oe(Bt),rn=F(()=>C("sw"));He.__pointerdown=function(...sn){d(rn)?.apply(this,sn)},He.__pointermove=O,He.__pointerup=B;var Zt=T(He,2),ri=F(()=>C("se"));Zt.__pointerdown=function(...sn){d(ri)?.apply(this,sn)},Zt.__pointermove=O,Zt.__pointerup=B,Ct("pointercancel",He,B),Ct("pointercancel",Zt,B),m(Fe,Bt)};V(de,Fe=>{c()&&Fe(Ke)})}q(()=>ee=Re(W,1,"panel-body svelte-yrmttr",null,ee,{"has-fixed-height":c()&&d(p).height>0})),m(x,A)};V(se,x=>{d(h)||x(ce)})}Jt(S,x=>$(y,x),()=>d(y)),q(()=>{N=Re(S,1,"draggable-panel svelte-yrmttr",null,N,{minimized:d(h),dragging:d(E),resizing:d(w),resizable:c()}),me(S,`left: ${d(f).x??""}px; top: ${d(f).y??""}px; width: ${d(h)?"auto":`${c()?d(p).width:r()}px`}; ${c()&&d(p).height>0&&!d(h)?`height: ${d(p).height}px;`:""}`),ue(re,e.title),Q(ye,"title",d(h)?"Expand":"Minimize"),ue(ae,d(h)?"▲":"▼")}),Ct("pointercancel",Y,Z),m(t,S),Ie()}st(["pointerdown","click","pointermove","pointerup"]);function Hs(t,e,n){const{previewSize:i,borderColor:r,dataKey:s,eventName:a}=t,o=i/2;function l(v,_){if(!v.dataTransfer)return;n({draggedKey:_}),Pn(!0),v.dataTransfer.effectAllowed="copy",v.dataTransfer.setData(s,_);const M=v.target.querySelector("img")?.cloneNode(!0);M&&(M.style.position="absolute",M.style.top="-1000px",document.body.appendChild(M),v.dataTransfer.setDragImage(M,o,o),setTimeout(()=>M.remove(),0))}function c(){n({draggedKey:null}),Pn(!1)}function u(v,_){if(v.touches.length!==1)return;const y=v.touches[0];n({draggedKey:_}),Pn(!0);const k=v.currentTarget.querySelector("img");if(k){const I=document.createElement("div");I.className="touch-drag-preview",I.innerHTML=`<img src="${k.src}" alt="" />`,I.style.cssText=`
        position: fixed;
        top: ${y.clientY-o}px;
        left: ${y.clientX-o}px;
        width: ${i}px;
        height: ${i}px;
        pointer-events: none;
        z-index: 10000;
        opacity: 0.9;
        image-rendering: pixelated;
        filter: drop-shadow(3px 3px 0 rgba(0, 0, 0, 0.5));
        border: 2px solid ${r};
        background: rgba(26, 26, 46, 0.9);
      `,I.querySelector("img").style.cssText=`
        width: 100%;
        height: 100%;
        object-fit: contain;
        image-rendering: pixelated;
      `,document.body.appendChild(I),n({touchDragElement:I})}}function g(v){const _=e();if(!_.draggedKey||!_.touchDragElement)return;const y=v.touches[0];_.touchDragElement.style.top=`${y.clientY-o}px`,_.touchDragElement.style.left=`${y.clientX-o}px`,v.preventDefault()}function h(v){const _=e();if(!_.draggedKey)return;const y=v.changedTouches[0],M=document.querySelector("canvas");if(_.touchDragElement&&(_.touchDragElement.remove(),n({touchDragElement:null})),M){const k=M.getBoundingClientRect(),I=y.clientX,D=y.clientY;if(I>=k.left&&I<=k.right&&D>=k.top&&D<=k.bottom){const L=I-k.left,Z=D-k.top;kt.emit(a,{[s]:_.draggedKey,canvasX:L,canvasY:Z})}}n({draggedKey:null}),Pn(!1)}function f(v){v.preventDefault(),v.dataTransfer&&(v.dataTransfer.dropEffect="copy")}function p(v){v.preventDefault();const _=v.dataTransfer?.getData(s);if(!_)return;const M=v.target.getBoundingClientRect(),k=v.clientX-M.left,I=v.clientY-M.top;kt.emit(a,{[s]:_,canvasX:k,canvasY:I})}function E(){const v=document.querySelector("canvas");return v?(v.addEventListener("dragover",f),v.addEventListener("drop",p),()=>{v.removeEventListener("dragover",f),v.removeEventListener("drop",p)}):()=>{}}function w(){return document.addEventListener("touchmove",g,{passive:!1}),document.addEventListener("touchend",h),document.addEventListener("touchcancel",h),()=>{document.removeEventListener("touchmove",g),document.removeEventListener("touchend",h),document.removeEventListener("touchcancel",h)}}return{onDragStart:l,onDragEnd:c,onTouchStart:u,onTouchMove:g,onTouchEnd:h,setupCanvasListeners:E,setupTouchListeners:w}}var ec=R('<span class="palette-hint svelte-1ahretz">Drag to place</span>'),tc=R('<div draggable="true" role="button" tabindex="0"><img class="item-preview svelte-1ahretz"/> <span class="item-name svelte-1ahretz"> </span></div>'),nc=R('<div class="palette-content svelte-1ahretz" role="toolbar" tabindex="-1"><div class="palette-grid svelte-1ahretz"></div></div>');function ic(t,e){Ee(e,!0);const n=()=>G(wn,"$isAssetPaletteOpen",r),i=()=>G(ut,"$builderEditMode",r),[r,s]=mt(),a="#4a90e2",o=Ki;let l=z(null),c=z(null);const u=Hs({previewSize:48,borderColor:a,dataKey:"assetKey",eventName:Dt.ASSET_DROPPED},()=>({draggedKey:d(l),touchDragElement:d(c)}),w=>{"draggedKey"in w&&$(l,w.draggedKey??null,!0),"touchDragElement"in w&&$(c,w.touchDragElement??null,!0)});function g(w){w.stopPropagation()}function h(){wn.set(!1)}Ri(()=>u.setupCanvasListeners()),We(()=>u.setupTouchListeners());var f=je(),p=oe(f);{var E=w=>{ii(w,{panelId:"asset-palette",title:"Assets",initialRight:10,initialTop:60,width:280,height:400,minWidth:200,minHeight:160,maxWidth:500,maxHeight:600,resizable:!0,showClose:!0,onclose:h,headerExtra:_=>{var y=ec();m(_,y)},children:(_,y)=>{var M=nc();M.__pointerdown=g;var k=P(M);xt(k,21,()=>o,Pt,(I,D)=>{var L=tc();let Z;L.__touchstart=b=>u.onTouchStart(b,d(D).key),me(L,"",{},{"--accent-color":a});var C=P(L),O=T(C,2),B=P(O);q(()=>{Z=Re(L,1,"palette-item svelte-1ahretz",null,Z,{dragging:d(l)===d(D).key}),Q(L,"title",d(D).name),Q(C,"src",d(D).path),Q(C,"alt",d(D).name),ue(B,d(D).name)}),Ct("dragstart",L,b=>u.onDragStart(b,d(D).key)),Ct("dragend",L,function(...b){u.onDragEnd?.apply(this,b)}),m(I,L)}),m(_,M)},$$slots:{headerExtra:!0,default:!0}})};V(p,w=>{n()&&i()==="items"&&w(E)})}m(t,f),Ie(),s()}st(["pointerdown","touchstart"]);var rc=R('<span class="palette-hint svelte-jnw59q">Drag to place</span>'),sc=R('<div draggable="true" role="button" tabindex="0"><img class="item-preview item-preview--landscape svelte-jnw59q"/> <span class="item-name svelte-jnw59q"> </span></div>'),ac=R('<div class="palette-content svelte-jnw59q" role="toolbar" tabindex="-1"><div class="palette-grid svelte-jnw59q"></div></div>');function oc(t,e){Ee(e,!0);const n=()=>G(Sn,"$isFramePaletteOpen",r),i=()=>G(ut,"$builderEditMode",r),[r,s]=mt(),a="#9b59b6",o=jn;let l=z(null),c=z(null);const u=Hs({previewSize:64,borderColor:a,dataKey:"frameKey",eventName:Dt.FRAME_DROPPED},()=>({draggedKey:d(l),touchDragElement:d(c)}),w=>{"draggedKey"in w&&$(l,w.draggedKey??null,!0),"touchDragElement"in w&&$(c,w.touchDragElement??null,!0)});function g(w){w.stopPropagation()}function h(){Sn.set(!1)}Ri(()=>u.setupCanvasListeners()),We(()=>u.setupTouchListeners());var f=je(),p=oe(f);{var E=w=>{ii(w,{panelId:"frame-palette",title:"Frames",initialRight:10,initialTop:60,width:320,height:400,minWidth:220,minHeight:200,maxWidth:600,maxHeight:600,resizable:!0,showClose:!0,onclose:h,headerExtra:_=>{var y=rc();m(_,y)},children:(_,y)=>{var M=ac();M.__pointerdown=g;var k=P(M);xt(k,21,()=>o,Pt,(I,D)=>{var L=sc();let Z;L.__touchstart=b=>u.onTouchStart(b,d(D).key),me(L,"",{},{"--accent-color":a});var C=P(L),O=T(C,2),B=P(O);q(()=>{Z=Re(L,1,"palette-item svelte-jnw59q",null,Z,{dragging:d(l)===d(D).key}),Q(L,"title",d(D).name),Q(C,"src",d(D).path),Q(C,"alt",d(D).name),ue(B,d(D).name)}),Ct("dragstart",L,b=>u.onDragStart(b,d(D).key)),Ct("dragend",L,function(...b){u.onDragEnd?.apply(this,b)}),m(I,L)}),m(_,M)},$$slots:{headerExtra:!0,default:!0}})};V(p,w=>{n()&&i()==="frames"&&w(E)})}m(t,f),Ie(),s()}st(["pointerdown","touchstart"]);var lc=R("<button><!></button>");function ge(t,e){let n=J(e,"variant",3,"default"),i=J(e,"disabled",3,!1),r=J(e,"title",3,"");const s={default:{base:"#4a90e2",hover:"#357abd",active:"#2a5f8f"},green:{base:"#27ae60",hover:"#229954",active:"#1e8449"},blue:{base:"#3498db",hover:"#2980b9",active:"#21618c"},orange:{base:"#ffa500",hover:"#ff8c00",active:"#e67e00"},red:{base:"#e74c3c",hover:"#c0392b",active:"#a02e22"},purple:{base:"#9b59b6",hover:"#8e44ad",active:"#7d3c98"},cyan:{base:"#17a2b8",hover:"#138496",active:"#0f6674"}},a=F(()=>s[n()]),o=F(()=>e.width?`--btn-width: ${e.width};`:"");var l=lc();let c;l.__click=function(...g){e.onclick?.apply(this,g)};var u=P(l);qt(u,()=>e.children??Ye),q(()=>{c=Re(l,1,"pixel-btn svelte-lwc0vq",null,c,{disabled:i()}),me(l,`${d(o)??""} --color-base: ${d(a).base??""}; --color-hover: ${d(a).hover??""}; --color-active: ${d(a).active??""}`),l.disabled=i(),Q(l,"title",r())}),m(t,l)}st(["click"]);var cc=R('<div><div class="minimap-bg svelte-1ycb7lo"></div> <div class="viewport-indicator svelte-1ycb7lo"></div> <div class="player-marker svelte-1ycb7lo"></div> <div class="minimap-frame svelte-1ycb7lo"></div></div>');function dc(t,e){Ee(e,!0);const n=()=>G(Xi,"$builderCameraInfo",r),i=()=>G(Tn,"$isBuilderZoomedOut",r),[r,s]=mt(),a=120,o=60,l=200,c=100;let u=z(!1),g=z(null),h=F(()=>d(u)?l:a),f=F(()=>d(u)?c:o),p=F(()=>{const C=n();if(!C||C.worldWidth===0)return"display: none;";const O=d(h)/C.worldWidth,B=d(f)/C.worldHeight,b=C.viewWidth/C.zoom*O,S=C.viewHeight/C.zoom*B,N=C.scrollX*O,Y=C.scrollY*B;return`
      left: ${Math.max(0,N)}px;
      top: ${Math.max(0,Y)}px;
      width: ${Math.min(b,d(h)-N)}px;
      height: ${Math.min(S,d(f)-Y)}px;
    `}),E=F(()=>{const C=n();if(!C||C.worldWidth===0)return"display: none;";const O=d(h)/C.worldWidth,B=d(f)/C.worldHeight,b=C.playerX*O,S=C.playerY*B;return`
      left: ${b}px;
      top: ${S}px;
    `});function w(C,O){const B=n();if(!B||B.worldWidth===0||!d(g))return;const b=d(g).getBoundingClientRect(),S=C-b.left,N=O-b.top,Y=S/d(h)*B.worldWidth,he=N/d(f)*B.worldHeight;kt.emit(Dt.MINIMAP_NAVIGATE,{worldX:Y,worldY:he})}function v(C){C.stopPropagation(),C.preventDefault(),$(u,!0),w(C.clientX,C.clientY),window.addEventListener("mousemove",_),window.addEventListener("mouseup",y)}function _(C){d(u)&&(C.preventDefault(),w(C.clientX,C.clientY))}function y(){$(u,!1),window.removeEventListener("mousemove",_),window.removeEventListener("mouseup",y)}function M(C){C.stopPropagation(),C.preventDefault(),$(u,!0);const O=C.touches[0];w(O.clientX,O.clientY),window.addEventListener("touchmove",k,{passive:!1}),window.addEventListener("touchend",I)}function k(C){if(!d(u))return;C.preventDefault();const O=C.touches[0];w(O.clientX,O.clientY)}function I(){$(u,!1),window.removeEventListener("touchmove",k),window.removeEventListener("touchend",I)}var D=je(),L=oe(D);{var Z=C=>{var O=cc();let B;O.__mousedown=v,O.__touchstart=M;var b=T(P(O),2),S=T(b,2);Jt(O,N=>$(g,N),()=>d(g)),q(()=>{B=Re(O,1,"minimap-container svelte-1ycb7lo",null,B,{enlarged:d(u)}),me(O,`width: ${d(h)??""}px; height: ${d(f)??""}px;`),me(b,d(p)),me(S,d(E))}),m(C,O)};V(L,C=>{i()||C(Z)})}m(t,D),Ie(),s()}st(["mousedown","touchstart"]);var uc=R('<div class="landscape-hint svelte-ugg786"><div class="hint-content svelte-ugg786"><div class="rotate-icon svelte-ugg786">📱↻</div> <p class="hint-text svelte-ugg786">Rotate your phone for a better experience</p> <button class="dismiss-btn svelte-ugg786">OK</button></div></div>');function hc(t,e){Ee(e,!0);let n=z(!0),i=z(!1);const r="landscapeHintDismissed";Ri(()=>{sessionStorage.getItem(r)||($(i,/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||"ontouchstart"in window&&window.innerWidth<=768,!0),d(i)&&$(n,!1))});function s(){$(n,!0),sessionStorage.setItem(r,"true")}var a=je(),o=oe(a);{var l=c=>{var u=uc(),g=P(u),h=T(P(g),4);h.__click=s,m(c,u)};V(o,c=>{!d(n)&&d(i)&&c(l)})}m(t,a),Ie()}st(["click"]);var fc=R("<button> </button>"),gc=R('<div class="language-tabs svelte-ng6pis"></div>');function Ns(t,e){Ee(e,!0);let n=J(e,"accentColor",3,"#88ddff");var i=gc();xt(i,21,()=>Mo,Pt,(r,s)=>{var a=fc();let o;a.__click=()=>e.onselect(d(s).code);let l;var c=P(a);q(()=>{o=Re(a,1,"lang-tab svelte-ng6pis",null,o,{active:e.selectedLanguage===d(s).code}),l=me(a,"",l,{"--accent-color":n()}),ue(c,d(s).label)}),m(r,a)}),m(t,i),Ie()}st(["click"]);var pc=R("<button></button>"),vc=R('<div class="color-picker svelte-1jc3e0j"></div>'),mc=R('<div class="color-section svelte-1jc3e0j"><span class="color-label-title svelte-1jc3e0j"> </span> <button class="color-button svelte-1jc3e0j" title="Change color"><span class="color-preview svelte-1jc3e0j"></span> <span class="color-label svelte-1jc3e0j">Change</span></button> <!></div>');function xi(t,e){Ee(e,!0);let n=J(e,"label",3,"Color"),i=J(e,"accentColor",3,"#88ddff"),r=z(!1),s=z(null);We(()=>{d(r)&&d(s)&&requestAnimationFrame(()=>{d(s)?.scrollIntoView({behavior:"smooth",block:"nearest"})})});function a(v){e.onselect(v)}function o(){$(r,!d(r))}var l=mc(),c=P(l),u=P(c),g=T(c,2);g.__click=o;let h;var f=P(g);let p;var E=T(g,2);{var w=v=>{var _=vc();xt(_,21,()=>e.colors,Pt,(y,M)=>{var k=pc();let I;k.__click=()=>a(d(M));let D;q(()=>{I=Re(k,1,"color-swatch svelte-1jc3e0j",null,I,{selected:e.selectedColor===d(M)}),Q(k,"title",d(M)),D=me(k,"",D,{background:d(M),"--accent-color":i()})}),m(y,k)}),Jt(_,y=>$(s,y),()=>d(s)),m(v,_)};V(E,v=>{d(r)&&v(w)})}q(()=>{ue(u,n()),h=me(g,"",h,{"--accent-color":i()}),p=me(f,"",p,{background:e.selectedColor})}),m(t,l),Ie()}st(["click"]);const Cr=50,kr=400,_c=400,yc=70;var bc=R('<div class="form-section svelte-jhtkop"><div class="form-group svelte-jhtkop"><label class="svelte-jhtkop"> </label> <input type="text" class="svelte-jhtkop"/></div> <div class="form-group svelte-jhtkop"><label class="svelte-jhtkop"> </label> <textarea rows="6" class="svelte-jhtkop"></textarea></div></div>');function wc(t,e){Ee(e,!0);let n=J(e,"titlePlaceholder",3,"Enter title..."),i=J(e,"contentPlaceholder",3,"Enter text..."),r=J(e,"idPrefix",3,"text-form"),s=J(e,"accentColor",3,"#88ddff");function a(_){const y=_.target;e.ontitlechange(y.value)}function o(_){const y=_.target;e.oncontentchange(y.value)}var l=bc();let c;var u=P(l),g=P(u),h=P(g),f=T(g,2);f.__input=a;var p=T(u,2),E=P(p),w=P(E),v=T(E,2);v.__input=o,q(()=>{c=me(l,"",c,{"--accent-color":s()}),Q(g,"for",`${r()??""}-title`),ue(h,`Title (max ${Cr} chars)`),Q(f,"id",`${r()??""}-title`),Xn(f,e.title),Q(f,"placeholder",n()),Q(f,"maxlength",Cr),Q(E,"for",`${r()??""}-content`),ue(w,`Content (max ${kr} chars)`),Q(v,"id",`${r()??""}-content`),Xn(v,e.content),Q(v,"placeholder",i()),Q(v,"maxlength",kr)}),m(t,l),Ie()}st(["input"]);var Sc=R('<div class="panel-content svelte-zzlycq"><!> <!> <div class="panel-extras svelte-zzlycq"><!></div> <div class="panel-footer svelte-zzlycq"><!> <!></div></div>');function xc(t,e){Ee(e,!0);const n=()=>G(Bi,"$dialogZones",r),i=()=>G(ks,"$selectedDialogZoneId",r),[r,s]=mt(),a="#88ddff";let o=z(Qe(xs)),l=F(()=>n().find(y=>y.id===i())??null),c=F(()=>d(l)?.texts.find(y=>y.language===d(o))??null);function u(y){i()&&ur(i(),d(o),{title:y})}function g(y){i()&&ur(i(),d(o),{content:y})}function h(){i()&&Qo(i())}function f(){On(null)}function p(y){i()&&dn(i(),{color:y})}function E(y){$(o,y,!0)}var w=je(),v=oe(w);{var _=y=>{ii(y,{panelId:"dialog-zone-panel",title:"Dialog Zone",initialRight:10,initialTop:160,width:280,height:450,minWidth:250,minHeight:370,maxWidth:500,maxHeight:700,resizable:!0,showClose:!0,onclose:f,children:(M,k)=>{var I=Sc(),D=P(I);Ns(D,{get selectedLanguage(){return d(o)},onselect:E,accentColor:a});var L=T(D,2);{let S=F(()=>d(c)?.title??""),N=F(()=>d(c)?.content??"");wc(L,{get title(){return d(S)},get content(){return d(N)},ontitlechange:u,oncontentchange:g,titlePlaceholder:"Enter title...",contentPlaceholder:"Enter dialog text...",idPrefix:"dialog",accentColor:a})}var Z=T(L,2),C=P(Z);xi(C,{get colors(){return bi},get selectedColor(){return d(l).color},onselect:p,label:"Zone Color",accentColor:a});var O=T(Z,2),B=P(O);ge(B,{variant:"cyan",onclick:f,children:(S,N)=>{var Y=fe("CONFIRM");m(S,Y)},$$slots:{default:!0}});var b=T(B,2);ge(b,{variant:"red",onclick:h,children:(S,N)=>{var Y=fe("DELETE ZONE");m(S,Y)},$$slots:{default:!0}}),m(M,I)},$$slots:{default:!0}})};V(v,y=>{d(l)&&y(_)})}m(t,w),Ie(),s()}var Ec=R("<button> </button>"),Ic=R("<option> </option>"),Cc=R('<a target="_blank" rel="noopener noreferrer" class="url-preview svelte-ds1z4d">Test link ↗</a>'),kc=R('<button><img class="svelte-ds1z4d"/></button>'),Dc=R('<div class="style-picker svelte-ds1z4d"></div>'),Ac=R('<div class="panel-content svelte-ds1z4d"><!> <div class="frame-size-row svelte-ds1z4d"><div class="frame-size-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Frame Size</span> <div class="size-buttons svelte-ds1z4d"></div></div> <button class="rotate-btn svelte-ds1z4d"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-ds1z4d"><path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg></button></div> <div class="panel-extras svelte-ds1z4d"><div class="text-section svelte-ds1z4d"><label for="frame-text" class="svelte-ds1z4d">Text</label> <textarea id="frame-text" placeholder="Enter text..." rows="3" class="svelte-ds1z4d"></textarea></div> <div class="size-rotation-row svelte-ds1z4d"><div class="size-section svelte-ds1z4d"><label for="text-size" class="svelte-ds1z4d">Text Size</label> <select id="text-size" class="svelte-ds1z4d"></select></div></div> <div class="url-section svelte-ds1z4d"><label for="frame-url" class="svelte-ds1z4d">Link URL (opens on click)</label> <input id="frame-url" type="url" placeholder="https://example.com" class="svelte-ds1z4d"/> <!></div> <!> <!> <div class="style-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Frame Style</span> <button class="style-button svelte-ds1z4d" title="Change frame style"><img alt="Current frame" class="style-preview svelte-ds1z4d"/> <span class="style-label svelte-ds1z4d">Change Style</span></button> <!></div></div> <div class="panel-footer svelte-ds1z4d"><!> <!></div></div>');function Tc(t,e){Ee(e,!0);const n=()=>G(Ni,"$builderPreviewLanguage",s),i=()=>G(Bo,"$selectedFrame",s),r=()=>G(Ds,"$selectedFrameId",s),[s,a]=mt(),o="#9b59b6";let l=F(n),c=F(i),u=F(()=>d(c)?.texts.find(S=>S.language===d(l))??null),g=F(()=>d(c)?El(d(c).scale??4):"M");function h(S){const N=S.target;if(!r()||!d(c))return;const Y=d(c).texts.map(he=>he.language===d(l)?{...he,text:N.value}:he);Y.some(he=>he.language===d(l))||Y.push({language:d(l),text:N.value}),lt(r(),{texts:Y})}function f(S){const N=S.target;r()&&lt(r(),{url:N.value||void 0})}function p(S){r()&&lt(r(),{backgroundColor:S})}function E(S){r()&&lt(r(),{textColor:S})}function w(S){const N=S.target;r()&&lt(r(),{textSize:parseInt(N.value,10)})}function v(S){r()&&lt(r(),{scale:xl(S)})}function _(){if(!r()||!d(c))return;const N=(d(c).rotation??0)===0?90:0;lt(r(),{rotation:N})}function y(){r()&&Ms(r())}function M(){un(null)}function k(S){Fo(S)}let I=z(!1),D=z(null),L=z(null);function Z(S){r()&&lt(r(),{frameKey:S})}function C(){$(I,!d(I))}We(()=>{d(I)&&d(D)&&requestAnimationFrame(()=>{d(D)?.scrollIntoView({behavior:"smooth",block:"nearest"})})}),We(()=>{if(!d(I))return;function S(N){const Y=N.target;d(D)&&!d(D).contains(Y)&&d(L)&&!d(L).contains(Y)&&$(I,!1)}return document.addEventListener("click",S),()=>document.removeEventListener("click",S)});var O=je(),B=oe(O);{var b=S=>{ii(S,{panelId:"frame-panel",title:"Edit Frame",initialRight:10,initialTop:160,width:280,height:520,minWidth:250,minHeight:450,maxWidth:500,maxHeight:700,resizable:!0,showClose:!0,onclose:M,children:(N,Y)=>{var he=Ac(),re=P(he);Ns(re,{get selectedLanguage(){return d(l)},onselect:k,accentColor:o});var Ce=T(re,2),Xe=P(Ce),at=T(P(Xe),2);xt(at,21,()=>Object.entries(Os),Pt,(te,ke)=>{var Se=F(()=>Js(d(ke),2));let ze=()=>d(Se)[0],Ve=()=>d(Se)[1].label;var _t=Ec();let an;_t.__click=()=>v(ze());var Xs=P(_t);q(()=>{an=Re(_t,1,"size-btn svelte-ds1z4d",null,an,{active:d(g)===ze()}),Q(_t,"title",Ve()),ue(Xs,ze())}),m(te,_t)});var ye=T(Xe,2);ye.__click=_;var ae=T(Ce,2),be=P(ae),Pe=T(P(be),2);Pe.__input=h;var se=T(be,2),ce=P(se),x=T(P(ce),2);x.__change=w,xt(x,21,()=>Sl,Pt,(te,ke)=>{var Se=Ic(),ze=P(Se),Ve={};q(()=>{ue(ze,`${d(ke)??""}px`),Ve!==(Ve=d(ke))&&(Se.value=(Se.__value=d(ke))??"")}),m(te,Se)});var A;ao(x);var W=T(se,2),ee=T(P(W),2);ee.__input=f;var j=T(ee,2);{var de=te=>{var ke=Cc();q(()=>Q(ke,"href",d(c).url)),m(te,ke)};V(j,te=>{d(c).url&&te(de)})}var Ke=T(W,2);{let te=F(()=>d(c).textColor??$s);xi(Ke,{get colors(){return wl},get selectedColor(){return d(te)},onselect:E,label:"Text Color",accentColor:o})}var Fe=T(Ke,2);xi(Fe,{get colors(){return bl},get selectedColor(){return d(c).backgroundColor},onselect:p,label:"Background Color",accentColor:o});var Bt=T(Fe,2),He=T(P(Bt),2);He.__click=C;var rn=P(He);Jt(He,te=>$(L,te),()=>d(L));var Zt=T(He,2);{var ri=te=>{var ke=Dc();xt(ke,21,()=>jn,Pt,(Se,ze)=>{var Ve=kc();let _t;Ve.__click=()=>Z(d(ze).key);var an=P(Ve);q(()=>{_t=Re(Ve,1,"style-item svelte-ds1z4d",null,_t,{selected:d(c).frameKey===d(ze).key}),Q(Ve,"title",d(ze).name),Q(an,"src",d(ze).path),Q(an,"alt",d(ze).name)}),m(Se,Ve)}),Jt(ke,Se=>$(D,Se),()=>d(D)),m(te,ke)};V(Zt,te=>{d(I)&&te(ri)})}var sn=T(ae,2),zi=P(sn);ge(zi,{variant:"purple",onclick:M,children:(te,ke)=>{var Se=fe("CONFIRM");m(te,Se)},$$slots:{default:!0}});var Ys=T(zi,2);ge(Ys,{variant:"red",onclick:y,children:(te,ke)=>{var Se=fe("DELETE FRAME");m(te,Se)},$$slots:{default:!0}}),q(te=>{Q(ye,"title",d(c).rotation===90?"Portrait (click to rotate)":"Landscape (click to rotate)"),Xn(Pe,d(u)?.text??""),A!==(A=d(c).textSize??$n)&&(x.value=(x.__value=d(c).textSize??$n)??"",hs(x,d(c).textSize??$n)),Xn(ee,d(c).url??""),Q(rn,"src",te)},[()=>jn.find(te=>te.key===d(c).frameKey)?.path??""]),m(N,he)},$$slots:{default:!0}})};V(B,S=>{d(c)&&S(b)})}m(t,O),Ie(),a()}st(["click","input","change"]);var Mc=R('<div class="frame-text svelte-1vp2oo0"> </div>'),Pc=R('<div class="frame-content-layer svelte-1vp2oo0"></div>');function Bs(t,e){Ee(e,!0);const n=()=>G(As,"$placedFrames",c),i=()=>G(Es,"$isBuilderMode",c),r=()=>G(Xi,"$builderCameraInfo",c),s=()=>G(_s,"$gameCameraInfo",c),a=()=>G(Ni,"$builderPreviewLanguage",c),o=()=>G(bn,"$currentLanguage",c),l=()=>G(Zi,"$draggingFramePositions",c),[c,u]=mt();let g=F(n),h=F(()=>i()?r().scrollX:s().scrollX),f=F(()=>i()?r().scrollY:s().scrollY),p=F(()=>i()?r().zoom:s().zoom),E=F(()=>i()?a():o()),w=F(l);function v(k){const I=d(w).get(k.id);return I||{x:k.x,y:k.y}}function _(k){const I=k.scale??ht,D=k.rotation===90,{textWidth:L,textHeight:Z}=pn(I,D),C=v(k),O=(C.x-d(h))*d(p),B=(C.y-d(f))*d(p);return{x:O,y:B,width:L*d(p),height:Z*d(p)}}function y(k){return(k.texts.find(D=>D.language===d(E))||k.texts[0]||{text:""}).text||""}var M=Pc();xt(M,21,()=>d(g),k=>k.id,(k,I)=>{const D=F(()=>_(d(I))),L=F(()=>y(d(I))),Z=F(()=>(d(I).textSize??$n)*d(p)),C=F(()=>d(I).textColor??$s);var O=je(),B=oe(O);{var b=S=>{var N=Mc(),Y=P(N);q(()=>{me(N,`
          left: ${d(D).x??""}px;
          top: ${d(D).y??""}px;
          width: ${d(D).width??""}px;
          height: ${d(D).height??""}px;
          font-size: ${d(Z)??""}px;
          color: ${d(C)??""};
        `),ue(Y,d(L))}),m(S,N)};V(B,S=>{d(L)&&S(b)})}m(k,O)}),m(t,M),Ie(),u()}var Lc=R('<div class="hstack svelte-8vtf35"><!></div>');function ui(t,e){let n=J(e,"gap",3,"10px"),i=J(e,"align",3,"center");var r=Lc(),s=P(r);qt(s,()=>e.children??Ye),q(()=>me(r,`gap: ${n()??""}; align-items: ${(i()==="start"?"flex-start":i()==="end"?"flex-end":i())??""};`)),m(t,r)}var Oc=R('<div class="vstack svelte-1y4dqnf"><!></div>');function $c(t,e){let n=J(e,"gap",3,"10px"),i=J(e,"align",3,"stretch");var r=Oc(),s=P(r);qt(s,()=>e.children??Ye),q(()=>me(r,`gap: ${n()??""}; align-items: ${(i()==="start"?"flex-start":i()==="end"?"flex-end":i())??""};`)),m(t,r)}var Rc=R("<div><!></div>");function hi(t,e){let n=J(e,"padding",3,"10px");var i=Rc(),r=P(i);qt(r,()=>e.children??Ye),q(()=>{Re(i,1,`fixed fixed--${e.position??""}`,"svelte-vwlo0e"),me(i,`--padding: ${n()??""};`)}),m(t,i)}var Fc=R("<!> <!>",1),Hc=R("<!> <!> <!>",1),Nc=R("<!> <!>",1),Bc=R("<!> <!> <!>",1),Zc=R("<!> <!> <!> <!>",1),Gc=R("<!> <!> <!> <!> <!> <!> <!>",1);function Yc(t,e){Ee(e,!0);const n=()=>G(Gi,"$selectedItem",h),i=()=>G(Is,"$selectedItemId",h),r=()=>G(Cs,"$itemDepthLayer",h),s=()=>G(Zo,"$selectedItemPhysicsEnabled",h),a=()=>G(Go,"$selectedItemFlipX",h),o=()=>G(ut,"$builderEditMode",h),l=()=>G(Tn,"$isBuilderZoomedOut",h),c=()=>G(ni,"$gridSnappingEnabled",h),u=()=>G(wn,"$isAssetPaletteOpen",h),g=()=>G(Sn,"$isFramePaletteOpen",h),[h,f]=mt();let p=F(()=>n()?nl(n().assetKey):!1);function E(){Ul()}function w(){jl()}function v(){if(!i())return;const re=r()==="behind"?"front":"behind",Ce=Hi(re);Xo(),Ko(i(),Ce)}function _(){i()&&zo(i(),!s())}function y(){i()&&Wo(i(),!a())}function M(){i()&&(Ts(i()),Yi())}function k(){Oo()}function I(){kt.emit(Dt.DIALOG_ZONE_CREATE)}var D=Gc(),L=oe(D);{var Z=re=>{ic(re,{})},C=re=>{var Ce=je(),Xe=oe(Ce);{var at=ae=>{xc(ae,{})},ye=ae=>{var be=je(),Pe=oe(be);{var se=ce=>{var x=Fc(),A=oe(x);oc(A,{});var W=T(A,2);Tc(W,{}),m(ce,x)};V(Pe,ce=>{o()==="frames"&&ce(se)},!0)}m(ae,be)};V(Xe,ae=>{o()==="dialogs"?ae(at):ae(ye,!1)},!0)}m(re,Ce)};V(L,re=>{o()==="items"?re(Z):re(C,!1)})}var O=T(L,2);Bs(O,{});var B=T(O,2);dc(B,{});var b=T(B,2);hc(b,{});var S=T(b,2);hi(S,{position:"top-left",children:(re,Ce)=>{ui(re,{children:(Xe,at)=>{var ye=Hc(),ae=oe(ye);ge(ae,{variant:"green",width:"100px",onclick:E,children:(se,ce)=>{var x=fe("SAVE");m(se,x)},$$slots:{default:!0}});var be=T(ae,2);{let se=F(()=>l()?"orange":"blue");ge(be,{get variant(){return d(se)},width:"80px",onclick:w,title:"Toggle zoom (F)",children:(ce,x)=>{var A=fe();q(()=>ue(A,l()?"1:1":"FIT")),m(ce,A)},$$slots:{default:!0}})}var Pe=T(be,2);{let se=F(()=>c()?"orange":"blue");ge(Pe,{get variant(){return d(se)},width:"80px",onclick:k,title:"Toggle grid snapping",children:(ce,x)=>{var A=fe();q(()=>ue(A,c()?"FREE":"SNAP")),m(ce,A)},$$slots:{default:!0}})}m(Xe,ye)},$$slots:{default:!0}})},$$slots:{default:!0}});var N=T(S,2);hi(N,{position:"top-right",children:(re,Ce)=>{$c(re,{align:"end",children:(Xe,at)=>{var ye=Bc(),ae=oe(ye);{let se=F(()=>o()==="items"&&u()?"orange":"blue");ge(ae,{get variant(){return d(se)},onclick:()=>{o()==="items"?$o():(cn("items"),wn.set(!0))},title:"Edit assets/items",children:(ce,x)=>{var A=fe("ASSETS");m(ce,A)},$$slots:{default:!0}})}var be=T(ae,2);{let se=F(()=>o()==="frames"&&g()?"orange":"purple");ge(be,{get variant(){return d(se)},onclick:()=>{o()==="frames"?Ro():(cn("frames"),Sn.set(!0))},title:"Edit text frames",children:(ce,x)=>{var A=fe("FRAMES");m(ce,A)},$$slots:{default:!0}})}var Pe=T(be,2);ui(Pe,{children:(se,ce)=>{var x=Nc(),A=oe(x);{var W=j=>{ge(j,{variant:"cyan",width:"100px",onclick:I,title:"Create new dialog zone at center of view",children:(de,Ke)=>{var Fe=fe("+ ZONE");m(de,Fe)},$$slots:{default:!0}})};V(A,j=>{o()==="dialogs"&&j(W)})}var ee=T(A,2);{let j=F(()=>o()==="dialogs"?"orange":"cyan");ge(ee,{get variant(){return d(j)},onclick:()=>{o()==="dialogs"?cn("items"):cn("dialogs")},title:"Edit dialog zones",children:(de,Ke)=>{var Fe=fe("DIALOGS");m(de,Fe)},$$slots:{default:!0}})}m(se,x)},$$slots:{default:!0}}),m(Xe,ye)},$$slots:{default:!0}})},$$slots:{default:!0}});var Y=T(N,2);{var he=re=>{hi(re,{position:"top-center",children:(Ce,Xe)=>{ui(Ce,{children:(at,ye)=>{var ae=Zc(),be=oe(ae);{let A=F(()=>r()==="behind"?"blue":"orange"),W=F(()=>s()?"Solid items must be behind player":"Toggle item depth: behind or in front of player");ge(be,{get variant(){return d(A)},get title(){return d(W)},onclick:v,get disabled(){return s()},children:(ee,j)=>{var de=fe();q(()=>ue(de,r()==="behind"?"To Front":"To Back")),m(ee,de)},$$slots:{default:!0}})}var Pe=T(be,2);{let A=F(()=>a()?"orange":"blue");ge(Pe,{get variant(){return d(A)},title:"Flip item horizontally",onclick:y,children:(W,ee)=>{var j=fe();q(()=>ue(j,a()?"Unflip":"Flip")),m(W,j)},$$slots:{default:!0}})}var se=T(Pe,2);{var ce=A=>{{let W=F(()=>s()?"orange":"blue");ge(A,{get variant(){return d(W)},title:"Toggle physics: item will block player movement",onclick:_,children:(ee,j)=>{var de=fe();q(()=>ue(de,s()?"Ghost":"Solid")),m(ee,de)},$$slots:{default:!0}})}};V(se,A=>{d(p)&&A(ce)})}var x=T(se,2);ge(x,{variant:"red",title:"Delete selected item",onclick:M,children:(A,W)=>{var ee=fe("DELETE");m(A,ee)},$$slots:{default:!0}}),m(at,ae)},$$slots:{default:!0}})},$$slots:{default:!0}})};V(Y,re=>{o()==="items"&&i()&&re(he)})}m(t,D),Ie(),f()}var Xc=R("<div> </div>"),Kc=R('<div class="dialog-content svelte-1jd14ss"> </div>'),zc=R("<div><!> <!></div>");function Wc(t,e){Ee(e,!0);const n=()=>G(bo,"$activeDialogText",r),i=()=>G(ms,"$playerScreenPosition",r),[r,s]=mt();let a=F(()=>n()?.title&&n()?.content),o=F(()=>Math.max(10,window.innerHeight-i().y+yc)),l=F(()=>window.innerWidth<=_c),c=F(()=>d(l)?50:i().x),u=F(()=>d(l)?"percent":"px");var g=je(),h=oe(g);{var f=p=>{var E=zc();let w;var v=P(E);{var _=k=>{var I=Xc();let D;var L=P(I);q(()=>{D=Re(I,1,"dialog-title svelte-1jd14ss",null,D,{"has-divider":d(a)}),ue(L,n().title)}),m(k,I)};V(v,k=>{n().title&&k(_)})}var y=T(v,2);{var M=k=>{var I=Kc(),D=P(I);q(()=>ue(D,n().content)),m(k,I)};V(y,k=>{n().content&&k(M)})}q(()=>{w=Re(E,1,"dialog-bubble svelte-1jd14ss",null,w,{narrow:d(l)}),me(E,`bottom: ${d(o)??""}px; left: ${d(c)??""}${d(u)??""};`)}),m(p,E)};V(h,p=>{n()&&p(f)})}m(t,g),Ie(),s()}var Uc=R("<!> <!>",1),jc=R('<div class="touch-controls"><p class="touch-text">Tap and hold<br/>where you want<br/>to move</p></div>'),Vc=R('<div class="desktop-controls"><div class="key-row"><div class="pixel-key">A</div> <div class="pixel-key">W</div> <div class="pixel-key">D</div></div> <p class="or-text">or</p> <div class="key-row"><div class="pixel-key">←</div> <div class="pixel-key">↑</div> <div class="pixel-key">→</div></div></div>'),qc=R('<div class="loader-overlay"><div class="pixel-loader"></div></div>'),Jc=R('<div class="game-ui-wrapper svelte-13dvmla"><!> <!> <!> <dialog class="pixel-dialog"><h1>CONTROLS</h1> <div class="controls-content"><!></div></dialog> <!></div>');function Qc(t,e){Ee(e,!1);const n=()=>G(ln,"$showControlsDialog",l),i=()=>G(ps,"$hasPlayerMoved",l),r=()=>G(Es,"$isBuilderMode",l),s=()=>G(bn,"$currentLanguage",l),a=()=>G(gs,"$isTouchDevice",l),o=()=>G(wi,"$isLoading",l),[l,c]=mt();let u=Pi();function g(){const b=Fs.toggleLanguage();bn.set(b)}function h(b){!d(u)?.open||b.target.closest(".pixel-button")||ln.set(!1)}function f(){const b=zl();if(!b){console.error("Cannot enter builder mode: map config not found");return}Wl(b)}er(()=>(d(u),n()),()=>{d(u)&&(n()?d(u).showModal():d(u).close())}),er(()=>(i(),d(u),ln),()=>{i()&&d(u)?.open&&ln.set(!1)}),Wa(),uo();var p=Jc();Ct("pointerdown",Rr,h);var E=P(p);{var w=b=>{Yc(b,{})},v=b=>{var S=Uc(),N=oe(S);Wc(N,{});var Y=T(N,2);Bs(Y,{}),m(b,S)};V(E,b=>{r()?b(w):b(v,!1)})}var _=T(E,2);{var y=b=>{ge(b,{position:"top-left",variant:"green",width:"120px",onclick:f,title:"Toggle Builder Mode",children:(S,N)=>{var Y=fe("BUILD");m(S,Y)},$$slots:{default:!0}})};V(_,b=>{r()||b(y)})}var M=T(_,2);{var k=b=>{ge(b,{position:"top-right",variant:"default",width:"100px",onclick:g,title:"Toggle Language (L)",children:(S,N)=>{var Y=fe();q(he=>ue(Y,he),[()=>(s(),Nt(()=>s().toUpperCase()))]),m(S,Y)},$$slots:{default:!0}})};V(M,b=>{r()||b(k)})}var I=T(M,2),D=T(P(I),2),L=P(D);{var Z=b=>{var S=jc();m(b,S)},C=b=>{var S=Vc();m(b,S)};V(L,b=>{a()?b(Z):b(C,!1)})}Jt(I,b=>$(u,b),()=>d(u));var O=T(I,2);{var B=b=>{var S=qc();m(b,S)};V(O,b=>{o()&&b(B)})}m(t,p),Ie(),c()}const Zs=document.getElementById("game-ui");if(!Zs)throw new Error("game-ui element not found!");to(Qc,{target:Zs});bn.set(Fs.getLanguage());_o.set(ys.getSkin());yo.set(Kn.getCurrentConfig().name);const ed={type:H.AUTO,width:800,height:600,parent:"game-container",backgroundColor:"#000000",pixelArt:!0,roundPixels:!0,scale:{mode:H.Scale.RESIZE,autoCenter:H.Scale.CENTER_BOTH},physics:{default:"arcade",arcade:{gravity:{y:1e3,x:0},debug:!1}},audio:{noAudio:!0},scene:[Ml,Gl]},Gs=new H.Game(ed);Kl(Gs);const td=Gs.device.input.touch;gs.set(td);const nd=performance.getEntriesByType("navigation")[0]&&performance.getEntriesByType("navigation")[0].type==="reload",id=sessionStorage.getItem("hasSeenControlsHint");(!id||nd)&&(sessionStorage.setItem("hasSeenControlsHint","true"),ln.set(!0));
//# sourceMappingURL=index-C1018XKK.js.map
