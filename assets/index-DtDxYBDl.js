import{r as ka,g as Oa}from"./phaser-DFK5Ua9d.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();var $a=ka();const N=Oa($a),Ni=!1;var Ji=Array.isArray,La=Array.prototype.indexOf,Qi=Array.from,or=Object.defineProperty,Dn=Object.getOwnPropertyDescriptor,lr=Object.getOwnPropertyDescriptors,Ra=Object.prototype,Ha=Array.prototype,es=Object.getPrototypeOf,xs=Object.isExtensible;const je=()=>{};function Xa(n){return n()}function si(n){for(var e=0;e<n.length;e++)n[e]()}function cr(){var n,e,t=new Promise((i,s)=>{n=i,e=s});return{promise:t,resolve:n,reject:e}}function Fa(n,e){if(Array.isArray(n))return n;if(!(Symbol.iterator in n))return Array.from(n);const t=[];for(const i of n)if(t.push(i),t.length===e)break;return t}const Ie=2,ts=4,gi=8,Na=1<<24,Tt=16,Ct=32,qt=64,pi=128,it=512,xe=1024,Xe=2048,pt=4096,Be=8192,kt=16384,ns=32768,Gt=65536,Es=1<<17,dr=1<<18,wn=1<<19,ur=1<<20,Kt=32768,Zi=1<<21,is=1<<22,Ot=1<<23,$t=Symbol("$state"),Za=Symbol(""),on=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function hr(n){return n===this.v}function fr(n,e){return n!=n?e==e:n!==e||n!==null&&typeof n=="object"||typeof n=="function"}function gr(n){return!fr(n,this.v)}function pr(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Ya(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Wa(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Ba(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function za(n){throw new Error("https://svelte.dev/e/effect_orphan")}function Ga(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Ka(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Ua(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Va(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function ja(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}let Wn=!1,qa=!1;function Ja(){Wn=!0}const mr=1,vr=2,_r=4,Qa=8,eo=16,to=1,no=2,Ce=Symbol(),io="http://www.w3.org/1999/xhtml";let oe=null;function fn(n){oe=n}function we(n,e=!1,t){oe={p:oe,i:!1,c:null,e:null,s:n,x:null,l:Wn&&!e?{s:null,u:null,$:[]}:null}}function be(n){var e=oe,t=e.e;if(t!==null){e.e=null;for(var i of t)Nr(i)}return e.i=!0,oe=e.p,{}}function Bn(){return!Wn||oe!==null&&oe.l===null}let ln=[];function so(){var n=ln;ln=[],si(n)}function bn(n){if(ln.length===0){var e=ln;queueMicrotask(()=>{e===ln&&so()})}ln.push(n)}function ro(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function ao(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function Ke(n){if(typeof n!="object"||n===null||$t in n)return n;const e=es(n);if(e!==Ra&&e!==Ha)return n;var t=new Map,i=Ji(n),s=G(0),r=Bt,a=l=>{if(Bt===r)return l();var o=U,c=Bt;$e(null),As(r);var u=l();return $e(o),As(c),u};return i&&t.set("length",G(n.length)),new Proxy(n,{defineProperty(l,o,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&Ka();var u=t.get(o);return u===void 0?u=a(()=>{var h=G(c.value);return t.set(o,h),h}):L(u,c.value,!0),!0},deleteProperty(l,o){var c=t.get(o);if(c===void 0){if(o in l){const u=a(()=>G(Ce));t.set(o,u),An(s)}}else L(c,Ce),An(s);return!0},get(l,o,c){if(o===$t)return n;var u=t.get(o),h=o in l;if(u===void 0&&(!h||Dn(l,o)?.writable)&&(u=a(()=>{var g=Ke(h?l[o]:Ce),w=G(g);return w}),t.set(o,u)),u!==void 0){var f=d(u);return f===Ce?void 0:f}return Reflect.get(l,o,c)},getOwnPropertyDescriptor(l,o){var c=Reflect.getOwnPropertyDescriptor(l,o);if(c&&"value"in c){var u=t.get(o);u&&(c.value=d(u))}else if(c===void 0){var h=t.get(o),f=h?.v;if(h!==void 0&&f!==Ce)return{enumerable:!0,configurable:!0,value:f,writable:!0}}return c},has(l,o){if(o===$t)return!0;var c=t.get(o),u=c!==void 0&&c.v!==Ce||Reflect.has(l,o);if(c!==void 0||Q!==null&&(!u||Dn(l,o)?.writable)){c===void 0&&(c=a(()=>{var f=u?Ke(l[o]):Ce,g=G(f);return g}),t.set(o,c));var h=d(c);if(h===Ce)return!1}return u},set(l,o,c,u){var h=t.get(o),f=o in l;if(i&&o==="length")for(var g=c;g<h.v;g+=1){var w=t.get(g+"");w!==void 0?L(w,Ce):g in l&&(w=a(()=>G(Ce)),t.set(g+"",w))}if(h===void 0)(!f||Dn(l,o)?.writable)&&(h=a(()=>G(void 0)),L(h,Ke(c)),t.set(o,h));else{f=h.v!==Ce;var S=a(()=>Ke(c));L(h,S)}var v=Reflect.getOwnPropertyDescriptor(l,o);if(v?.set&&v.set.call(u,c),!f){if(i&&typeof o=="string"){var m=t.get("length"),b=Number(o);Number.isInteger(b)&&b>=m.v&&L(m,b+1)}An(s)}return!0},ownKeys(l){d(s);var o=Reflect.ownKeys(l).filter(h=>{var f=t.get(h);return f===void 0||f.v!==Ce});for(var[c,u]of t)u.v!==Ce&&!(c in l)&&o.push(c);return o},setPrototypeOf(){Ua()}})}function Is(n){try{if(n!==null&&typeof n=="object"&&$t in n)return n[$t]}catch{}return n}function oo(n,e){return Object.is(Is(n),Is(e))}var Ts,yr,wr,br,Sr;function lo(){if(Ts===void 0){Ts=window,yr=document,wr=/Firefox/.test(navigator.userAgent);var n=Element.prototype,e=Node.prototype,t=Text.prototype;br=Dn(e,"firstChild").get,Sr=Dn(e,"nextSibling").get,xs(n)&&(n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__style=void 0,n.__e=void 0),xs(t)&&(t.__t=void 0)}}function It(n=""){return document.createTextNode(n)}function ri(n){return br.call(n)}function zn(n){return Sr.call(n)}function k(n,e){return ri(n)}function ge(n,e=!1){{var t=ri(n);return t instanceof Comment&&t.data===""?zn(t):t}}function M(n,e=1,t=!1){let i=n;for(;e--;)i=zn(i);return i}function co(n){n.textContent=""}function xr(){return!1}function Er(n){var e=Q;if(e===null)return U.f|=Ot,n;if((e.f&ns)===0){if((e.f&pi)===0)throw n;e.b.error(n)}else gn(n,e)}function gn(n,e){for(;e!==null;){if((e.f&pi)!==0)try{e.b.error(n);return}catch(t){n=t}e=e.parent}throw n}const Vn=new Set;let ce=null,Ue=null,dt=[],ss=null,Yi=!1;class ht{committed=!1;current=new Map;previous=new Map;#e=new Set;#t=new Set;#i=0;#n=0;#l=null;#r=[];#s=[];skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#n>0}process(e){dt=[],this.apply();var t={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const i of e)this.#a(i,t);this.is_fork||this.#d(),this.is_deferred()?(this.#o(t.effects),this.#o(t.render_effects),this.#o(t.block_effects)):(ce=null,Cs(t.render_effects),Cs(t.effects),this.#l?.resolve()),Ue=null}#a(e,t){e.f^=xe;for(var i=e.first;i!==null;){var s=i.f,r=(s&(Ct|qt))!==0,a=r&&(s&xe)!==0,l=a||(s&Be)!==0||this.skipped_effects.has(i);if((i.f&pi)!==0&&i.b?.is_pending()&&(t={parent:t,effect:i,effects:[],render_effects:[],block_effects:[]}),!l&&i.fn!==null){r?i.f^=xe:(s&ts)!==0?t.effects.push(i):xn(i)&&((i.f&Tt)!==0&&t.block_effects.push(i),mn(i));var o=i.first;if(o!==null){i=o;continue}}var c=i.parent;for(i=i.next;i===null&&c!==null;)c===t.effect&&(this.#o(t.effects),this.#o(t.render_effects),this.#o(t.block_effects),t=t.parent),i=c.next,c=c.parent}}#o(e){for(const t of e)((t.f&Xe)!==0?this.#r:this.#s).push(t),this.#c(t.deps),Ee(t,xe)}#c(e){if(e!==null)for(const t of e)(t.f&Ie)===0||(t.f&Kt)===0||(t.f^=Kt,this.#c(t.deps))}capture(e,t){this.previous.has(e)||this.previous.set(e,t),(e.f&Ot)===0&&(this.current.set(e,e.v),Ue?.set(e,e.v))}activate(){ce=this,this.apply()}deactivate(){ce===this&&(ce=null,Ue=null)}flush(){if(this.activate(),dt.length>0){if(uo(),ce!==null&&ce!==this)return}else this.#i===0&&this.process([]);this.deactivate()}discard(){for(const e of this.#t)e(this);this.#t.clear()}#d(){if(this.#n===0){for(const e of this.#e)e();this.#e.clear()}this.#i===0&&this.#u()}#u(){if(Vn.size>1){this.previous.clear();var e=Ue,t=!0,i={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const r of Vn){if(r===this){t=!1;continue}const a=[];for(const[o,c]of this.current){if(r.current.has(o))if(t&&c!==r.current.get(o))r.current.set(o,c);else continue;a.push(o)}if(a.length===0)continue;const l=[...r.current.keys()].filter(o=>!this.current.has(o));if(l.length>0){var s=dt;dt=[];const o=new Set,c=new Map;for(const u of a)Ir(u,l,o,c);if(dt.length>0){ce=r,r.apply();for(const u of dt)r.#a(u,i);r.deactivate()}dt=s}}ce=null,Ue=e}this.committed=!0,Vn.delete(this)}increment(e){this.#i+=1,e&&(this.#n+=1)}decrement(e){this.#i-=1,e&&(this.#n-=1),this.revive()}revive(){for(const e of this.#r)Ee(e,Xe),Ut(e);for(const e of this.#s)Ee(e,pt),Ut(e);this.#r=[],this.#s=[],this.flush()}oncommit(e){this.#e.add(e)}ondiscard(e){this.#t.add(e)}settled(){return(this.#l??=cr()).promise}static ensure(){if(ce===null){const e=ce=new ht;Vn.add(ce),ht.enqueue(()=>{ce===e&&e.flush()})}return ce}static enqueue(e){bn(e)}apply(){}}function uo(){var n=Ht;Yi=!0;var e=null;try{var t=0;for(oi(!0);dt.length>0;){var i=ht.ensure();if(t++>1e3){var s,r;ho()}i.process(dt),Rt.clear()}}finally{Yi=!1,oi(n),ss=null}}function ho(){try{Ga()}catch(n){gn(n,ss)}}let bt=null;function Cs(n){var e=n.length;if(e!==0){for(var t=0;t<e;){var i=n[t++];if((i.f&(kt|Be))===0&&xn(i)&&(bt=new Set,mn(i),i.deps===null&&i.first===null&&i.nodes_start===null&&(i.teardown===null&&i.ac===null?Wr(i):i.fn=null),bt?.size>0)){Rt.clear();for(const s of bt){if((s.f&(kt|Be))!==0)continue;const r=[s];let a=s.parent;for(;a!==null;)bt.has(a)&&(bt.delete(a),r.push(a)),a=a.parent;for(let l=r.length-1;l>=0;l--){const o=r[l];(o.f&(kt|Be))===0&&mn(o)}}bt.clear()}}bt=null}}function Ir(n,e,t,i){if(!t.has(n)&&(t.add(n),n.reactions!==null))for(const s of n.reactions){const r=s.f;(r&Ie)!==0?Ir(s,e,t,i):(r&(is|Tt))!==0&&(r&Xe)===0&&Tr(s,e,i)&&(Ee(s,Xe),Ut(s))}}function Tr(n,e,t){const i=t.get(n);if(i!==void 0)return i;if(n.deps!==null)for(const s of n.deps){if(e.includes(s))return!0;if((s.f&Ie)!==0&&Tr(s,e,t))return t.set(s,!0),!0}return t.set(n,!1),!1}function Ut(n){for(var e=ss=n;e.parent!==null;){e=e.parent;var t=e.f;if(Yi&&e===Q&&(t&Tt)!==0&&(t&dr)===0)return;if((t&(qt|Ct))!==0){if((t&xe)===0)return;e.f^=xe}}dt.push(e)}function fo(n){let e=0,t=Vt(0),i;return()=>{Ln()&&(d(t),_i(()=>(e===0&&(i=Xt(()=>n(()=>An(t)))),e+=1,()=>{bn(()=>{e-=1,e===0&&(i?.(),i=void 0,An(t))})})))}}var go=Gt|wn|pi;function po(n,e,t){new mo(n,e,t)}class mo{parent;#e=!1;#t;#i=null;#n;#l;#r;#s=null;#a=null;#o=null;#c=null;#d=null;#u=0;#h=0;#g=!1;#f=null;#y=fo(()=>(this.#f=Vt(this.#u),()=>{this.#f=null}));constructor(e,t,i){this.#t=e,this.#n=t,this.#l=i,this.parent=Q.b,this.#e=!!this.#n.pending,this.#r=yi(()=>{Q.b=this;{var s=this.#v();try{this.#s=Ge(()=>i(s))}catch(r){this.error(r)}this.#h>0?this.#m():this.#e=!1}return()=>{this.#d?.remove()}},go)}#w(){try{this.#s=Ge(()=>this.#l(this.#t))}catch(e){this.error(e)}this.#e=!1}#b(){const e=this.#n.pending;e&&(this.#a=Ge(()=>e(this.#t)),ht.enqueue(()=>{var t=this.#v();this.#s=this.#p(()=>(ht.ensure(),Ge(()=>this.#l(t)))),this.#h>0?this.#m():(un(this.#a,()=>{this.#a=null}),this.#e=!1)}))}#v(){var e=this.#t;return this.#e&&(this.#d=It(),this.#t.before(this.#d),e=this.#d),e}is_pending(){return this.#e||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!this.#n.pending}#p(e){var t=Q,i=U,s=oe;gt(this.#r),$e(this.#r),fn(this.#r.ctx);try{return e()}catch(r){return Er(r),null}finally{gt(t),$e(i),fn(s)}}#m(){const e=this.#n.pending;this.#s!==null&&(this.#c=document.createDocumentFragment(),this.#c.append(this.#d),Gr(this.#s,this.#c)),this.#a===null&&(this.#a=Ge(()=>e(this.#t)))}#_(e){if(!this.has_pending_snippet()){this.parent&&this.parent.#_(e);return}this.#h+=e,this.#h===0&&(this.#e=!1,this.#a&&un(this.#a,()=>{this.#a=null}),this.#c&&(this.#t.before(this.#c),this.#c=null))}update_pending_count(e){this.#_(e),this.#u+=e,this.#f&&pn(this.#f,this.#u)}get_effect_pending(){return this.#y(),d(this.#f)}error(e){var t=this.#n.onerror;let i=this.#n.failed;if(this.#g||!t&&!i)throw e;this.#s&&(He(this.#s),this.#s=null),this.#a&&(He(this.#a),this.#a=null),this.#o&&(He(this.#o),this.#o=null);var s=!1,r=!1;const a=()=>{if(s){ao();return}s=!0,r&&ja(),ht.ensure(),this.#u=0,this.#o!==null&&un(this.#o,()=>{this.#o=null}),this.#e=this.has_pending_snippet(),this.#s=this.#p(()=>(this.#g=!1,Ge(()=>this.#l(this.#t)))),this.#h>0?this.#m():this.#e=!1};var l=U;try{$e(null),r=!0,t?.(e,a),r=!1}catch(o){gn(o,this.#r&&this.#r.parent)}finally{$e(l)}i&&bn(()=>{this.#o=this.#p(()=>{ht.ensure(),this.#g=!0;try{return Ge(()=>{i(this.#t,()=>e,()=>a)})}catch(o){return gn(o,this.#r.parent),null}finally{this.#g=!1}})})}}function Lt(n,e){return e}function vo(n,e,t){for(var i=[],s=e.length,r=0;r<s;r++)ls(e[r].e,i,!0);Br(i,()=>{var a=i.length===0&&t!==null;if(a){var l=t,o=l.parentNode;co(o),o.append(l),n.items.clear(),ct(n,e[0].prev,e[s-1].next)}for(var c=0;c<s;c++){var u=e[c];a||(n.items.delete(u.k),ct(n,u.prev,u.next)),He(u.e,!a)}n.first===e[0]&&(n.first=e[0].prev)})}function St(n,e,t,i,s,r=null){var a=n,l=new Map,o=null,c=(e&_r)!==0,u=(e&mr)!==0,h=(e&vr)!==0;if(c){var f=n;a=f.appendChild(It())}var g=null,w=Cr(()=>{var y=t();return Ji(y)?y:y==null?[]:Qi(y)}),S,v=!0;function m(){_o(_,S,a,e,i),g!==null&&(S.length===0?(g.fragment?(a.before(g.fragment),g.fragment=null):cs(g.effect),b.first=g.effect):un(g.effect,()=>{g=null}))}var b=yi(()=>{S=d(w);for(var y=S.length,p=new Set,x=ce,I=null,D=xr(),O=0;O<y;O+=1){var E=S[O],A=i(E,O),C=v?null:l.get(A);C?(u&&pn(C.v,E),h?pn(C.i,O):C.i=O,D&&x.skipped_effects.delete(C.e)):(C=yo(v?a:null,I,E,A,O,s,e,t),v&&(C.o=!0,I===null?o=C:I.next=C,I=C),l.set(A,C)),p.add(A)}if(y===0&&r&&!g)if(v)g={fragment:null,effect:Ge(()=>r(a))};else{var R=document.createDocumentFragment(),X=It();R.append(X),g={fragment:R,effect:Ge(()=>r(X))}}if(!v)if(D){for(const[P,B]of l)p.has(P)||x.skipped_effects.add(B.e);x.oncommit(m),x.ondiscard(()=>{})}else m();d(w)}),_={effect:b,items:l,first:o};v=!1}function _o(n,e,t,i,s){var r=(i&Qa)!==0,a=e.length,l=n.items,o=n.first,c,u=null,h,f=[],g=[],w,S,v,m;if(r)for(m=0;m<a;m+=1)w=e[m],S=s(w,m),v=l.get(S),v.a?.measure(),(h??=new Set).add(v);for(m=0;m<a;m+=1){if(w=e[m],S=s(w,m),v=l.get(S),n.first??=v,!v.o){v.o=!0;var b=u?u.next:o;ct(n,u,v),ct(n,v,b),Di(v,b,t),u=v,f=[],g=[],o=u.next;continue}if((v.e.f&Be)!==0&&(cs(v.e),r&&(v.a?.unfix(),(h??=new Set).delete(v))),v!==o){if(c!==void 0&&c.has(v)){if(f.length<g.length){var _=g[0],y;u=_.prev;var p=f[0],x=f[f.length-1];for(y=0;y<f.length;y+=1)Di(f[y],_,t);for(y=0;y<g.length;y+=1)c.delete(g[y]);ct(n,p.prev,x.next),ct(n,u,p),ct(n,x,_),o=_,u=x,m-=1,f=[],g=[]}else c.delete(v),Di(v,o,t),ct(n,v.prev,v.next),ct(n,v,u===null?n.first:u.next),ct(n,u,v),u=v;continue}for(f=[],g=[];o!==null&&o.k!==S;)(o.e.f&Be)===0&&(c??=new Set).add(o),g.push(o),o=o.next;if(o===null)continue;v=o}f.push(v),u=v,o=v.next}if(o!==null||c!==void 0){for(var I=c===void 0?[]:Qi(c);o!==null;)(o.e.f&Be)===0&&I.push(o),o=o.next;var D=I.length;if(D>0){var O=(i&_r)!==0&&a===0?t:null;if(r){for(m=0;m<D;m+=1)I[m].a?.measure();for(m=0;m<D;m+=1)I[m].a?.fix()}vo(n,I,O)}}r&&bn(()=>{if(h!==void 0)for(v of h)v.a?.apply()})}function yo(n,e,t,i,s,r,a,l){var o=(a&mr)!==0,c=(a&eo)===0,u=o?c?as(t,!1,!1):Vt(t):t,h=(a&vr)===0?s:Vt(s),f={i:h,v:u,k:i,a:null,e:null,o:!1,prev:e,next:null};try{if(n===null){var g=document.createDocumentFragment();g.append(n=It())}return f.e=Ge(()=>r(n,u,h,l)),e!==null&&(e.next=f),f}finally{}}function Di(n,e,t){for(var i=n.next?n.next.e.nodes_start:t,s=e?e.e.nodes_start:t,r=n.e.nodes_start;r!==null&&r!==i;){var a=zn(r);s.before(r),r=a}}function ct(n,e,t){e===null?(n.first=t,n.effect.first=t&&t.e):(e.e.next&&(e.e.next.prev=null),e.next=t,e.e.next=t&&t.e),t===null?n.effect.last=e&&e.e:(t.e.prev&&(t.e.prev.next=null),t.prev=e,t.e.prev=e&&e.e)}function wo(n,e,t,i){const s=Bn()?mi:Cr;if(t.length===0&&n.length===0){i(e.map(s));return}var r=ce,a=Q,l=bo();function o(){Promise.all(t.map(c=>So(c))).then(c=>{l();try{i([...e.map(s),...c])}catch(u){(a.f&kt)===0&&gn(u,a)}r?.deactivate(),ai()}).catch(c=>{gn(c,a)})}n.length>0?Promise.all(n).then(()=>{l();try{return o()}finally{r?.deactivate(),ai()}}):o()}function bo(){var n=Q,e=U,t=oe,i=ce;return function(r=!0){gt(n),$e(e),fn(t),r&&i?.activate()}}function ai(){gt(null),$e(null),fn(null)}function mi(n){var e=Ie|Xe,t=U!==null&&(U.f&Ie)!==0?U:null;return Q!==null&&(Q.f|=wn),{ctx:oe,deps:null,effects:null,equals:hr,f:e,fn:n,reactions:null,rv:0,v:Ce,wv:0,parent:t??Q,ac:null}}function So(n,e){let t=Q;t===null&&Ya();var i=t.b,s=void 0,r=Vt(Ce),a=!U,l=new Map;return $o(()=>{var o=cr();s=o.promise;try{Promise.resolve(n()).then(o.resolve,o.reject).then(()=>{c===ce&&c.committed&&c.deactivate(),ai()})}catch(f){o.reject(f),ai()}var c=ce;if(a){var u=!i.is_pending();i.update_pending_count(1),c.increment(u),l.get(c)?.reject(on),l.delete(c),l.set(c,o)}const h=(f,g=void 0)=>{if(c.activate(),g)g!==on&&(r.f|=Ot,pn(r,g));else{(r.f&Ot)!==0&&(r.f^=Ot),pn(r,f);for(const[w,S]of l){if(l.delete(w),w===c)break;S.reject(on)}}a&&(i.update_pending_count(-1),c.decrement(u))};o.promise.then(h,f=>h(null,f||"unknown"))}),vi(()=>{for(const o of l.values())o.reject(on)}),new Promise(o=>{function c(u){function h(){u===s?o(r):c(s)}u.then(h,h)}c(s)})}function Y(n){const e=mi(n);return kr(e),e}function Cr(n){const e=mi(n);return e.equals=gr,e}function Dr(n){var e=n.effects;if(e!==null){n.effects=null;for(var t=0;t<e.length;t+=1)He(e[t])}}function xo(n){for(var e=n.parent;e!==null;){if((e.f&Ie)===0)return(e.f&kt)===0?e:null;e=e.parent}return null}function rs(n){var e,t=Q;gt(xo(n));try{n.f&=~Kt,Dr(n),e=Rr(n)}finally{gt(t)}return e}function Ar(n){var e=rs(n);if(n.equals(e)||(ce?.is_fork||(n.v=e),n.wv=$r()),!Sn)if(Ue!==null)(Ln()||ce?.is_fork)&&Ue.set(n,e);else{var t=(n.f&it)===0?pt:xe;Ee(n,t)}}let Wi=new Set;const Rt=new Map;let Pr=!1;function Vt(n,e){var t={f:0,v:n,reactions:null,equals:hr,rv:0,wv:0};return t}function G(n,e){const t=Vt(n);return kr(t),t}function as(n,e=!1,t=!0){const i=Vt(n);return e||(i.equals=gr),Wn&&t&&oe!==null&&oe.l!==null&&(oe.l.s??=[]).push(i),i}function L(n,e,t=!1){U!==null&&(!ft||(U.f&Es)!==0)&&Bn()&&(U.f&(Ie|Tt|is|Es))!==0&&!xt?.includes(n)&&Va();let i=t?Ke(e):e;return pn(n,i)}function pn(n,e){if(!n.equals(e)){var t=n.v;Sn?Rt.set(n,e):Rt.set(n,t),n.v=e;var i=ht.ensure();i.capture(n,t),(n.f&Ie)!==0&&((n.f&Xe)!==0&&rs(n),Ee(n,(n.f&it)!==0?xe:pt)),n.wv=$r(),Mr(n,Xe),Bn()&&Q!==null&&(Q.f&xe)!==0&&(Q.f&(Ct|qt))===0&&(ze===null?Io([n]):ze.push(n)),!i.is_fork&&Wi.size>0&&!Pr&&Eo()}return e}function Eo(){Pr=!1;var n=Ht;oi(!0);const e=Array.from(Wi);try{for(const t of e)(t.f&xe)!==0&&Ee(t,pt),xn(t)&&mn(t)}finally{oi(n)}Wi.clear()}function An(n){L(n,n.v+1)}function Mr(n,e){var t=n.reactions;if(t!==null)for(var i=Bn(),s=t.length,r=0;r<s;r++){var a=t[r],l=a.f;if(!(!i&&a===Q)){var o=(l&Xe)===0;if(o&&Ee(a,e),(l&Ie)!==0){var c=a;Ue?.delete(c),(l&Kt)===0&&(l&it&&(a.f|=Kt),Mr(c,pt))}else o&&((l&Tt)!==0&&bt!==null&&bt.add(a),Ut(a))}}}function os(n){var e=U,t=Q;$e(null),gt(null);try{return n()}finally{$e(e),gt(t)}}let Ht=!1;function oi(n){Ht=n}let Sn=!1;function Ds(n){Sn=n}let U=null,ft=!1;function $e(n){U=n}let Q=null;function gt(n){Q=n}let xt=null;function kr(n){U!==null&&(xt===null?xt=[n]:xt.push(n))}let Pe=null,We=0,ze=null;function Io(n){ze=n}let Or=1,$n=0,Bt=$n;function As(n){Bt=n}function $r(){return++Or}function xn(n){var e=n.f;if((e&Xe)!==0)return!0;if(e&Ie&&(n.f&=~Kt),(e&pt)!==0){var t=n.deps;if(t!==null)for(var i=t.length,s=0;s<i;s++){var r=t[s];if(xn(r)&&Ar(r),r.wv>n.wv)return!0}(e&it)!==0&&Ue===null&&Ee(n,xe)}return!1}function Lr(n,e,t=!0){var i=n.reactions;if(i!==null&&!xt?.includes(n))for(var s=0;s<i.length;s++){var r=i[s];(r.f&Ie)!==0?Lr(r,e,!1):e===r&&(t?Ee(r,Xe):(r.f&xe)!==0&&Ee(r,pt),Ut(r))}}function Rr(n){var e=Pe,t=We,i=ze,s=U,r=xt,a=oe,l=ft,o=Bt,c=n.f;Pe=null,We=0,ze=null,U=(c&(Ct|qt))===0?n:null,xt=null,fn(n.ctx),ft=!1,Bt=++$n,n.ac!==null&&(os(()=>{n.ac.abort(on)}),n.ac=null);try{n.f|=Zi;var u=n.fn,h=u(),f=n.deps;if(Pe!==null){var g;if(li(n,We),f!==null&&We>0)for(f.length=We+Pe.length,g=0;g<Pe.length;g++)f[We+g]=Pe[g];else n.deps=f=Pe;if(Ht&&Ln()&&(n.f&it)!==0)for(g=We;g<f.length;g++)(f[g].reactions??=[]).push(n)}else f!==null&&We<f.length&&(li(n,We),f.length=We);if(Bn()&&ze!==null&&!ft&&f!==null&&(n.f&(Ie|pt|Xe))===0)for(g=0;g<ze.length;g++)Lr(ze[g],n);return s!==null&&s!==n&&($n++,ze!==null&&(i===null?i=ze:i.push(...ze))),(n.f&Ot)!==0&&(n.f^=Ot),h}catch(w){return Er(w)}finally{n.f^=Zi,Pe=e,We=t,ze=i,U=s,xt=r,fn(a),ft=l,Bt=o}}function To(n,e){let t=e.reactions;if(t!==null){var i=La.call(t,n);if(i!==-1){var s=t.length-1;s===0?t=e.reactions=null:(t[i]=t[s],t.pop())}}t===null&&(e.f&Ie)!==0&&(Pe===null||!Pe.includes(e))&&(Ee(e,pt),(e.f&it)!==0&&(e.f^=it,e.f&=~Kt),Dr(e),li(e,0))}function li(n,e){var t=n.deps;if(t!==null)for(var i=e;i<t.length;i++)To(n,t[i])}function mn(n){var e=n.f;if((e&kt)===0){Ee(n,xe);var t=Q,i=Ht;Q=n,Ht=!0;try{(e&(Tt|Na))!==0?Lo(n):Yr(n),Zr(n);var s=Rr(n);n.teardown=typeof s=="function"?s:null,n.wv=Or;var r;Ni&&qa&&(n.f&Xe)!==0&&n.deps}finally{Ht=i,Q=t}}}function d(n){var e=n.f,t=(e&Ie)!==0;if(U!==null&&!ft){var i=Q!==null&&(Q.f&kt)!==0;if(!i&&!xt?.includes(n)){var s=U.deps;if((U.f&Zi)!==0)n.rv<$n&&(n.rv=$n,Pe===null&&s!==null&&s[We]===n?We++:Pe===null?Pe=[n]:Pe.includes(n)||Pe.push(n));else{(U.deps??=[]).push(n);var r=n.reactions;r===null?n.reactions=[U]:r.includes(U)||r.push(U)}}}if(Sn){if(Rt.has(n))return Rt.get(n);if(t){var a=n,l=a.v;return((a.f&xe)===0&&a.reactions!==null||Xr(a))&&(l=rs(a)),Rt.set(a,l),l}}else t&&(!Ue?.has(n)||ce?.is_fork&&!Ln())&&(a=n,xn(a)&&Ar(a),Ht&&Ln()&&(a.f&it)===0&&Hr(a));if(Ue?.has(n))return Ue.get(n);if((n.f&Ot)!==0)throw n.v;return n.v}function Hr(n){if(n.deps!==null){n.f^=it;for(const e of n.deps)(e.reactions??=[]).push(n),(e.f&Ie)!==0&&(e.f&it)===0&&Hr(e)}}function Xr(n){if(n.v===Ce)return!0;if(n.deps===null)return!1;for(const e of n.deps)if(Rt.has(e)||(e.f&Ie)!==0&&Xr(e))return!0;return!1}function Xt(n){var e=ft;try{return ft=!0,n()}finally{ft=e}}const Co=-7169;function Ee(n,e){n.f=n.f&Co|e}function Do(n){if(!(typeof n!="object"||!n||n instanceof EventTarget)){if($t in n)Bi(n);else if(!Array.isArray(n))for(let e in n){const t=n[e];typeof t=="object"&&t&&$t in t&&Bi(t)}}}function Bi(n,e=new Set){if(typeof n=="object"&&n!==null&&!(n instanceof EventTarget)&&!e.has(n)){e.add(n),n instanceof Date&&n.getTime();for(let i in n)try{Bi(n[i],e)}catch{}const t=es(n);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const i=lr(t);for(let s in i){const r=i[s].get;if(r)try{r.call(n)}catch{}}}}}function Fr(n){Q===null&&(U===null&&za(),Ba()),Sn&&Wa()}function Ao(n,e){var t=e.last;t===null?e.last=e.first=n:(t.next=n,n.prev=t,e.last=n)}function mt(n,e,t){var i=Q;i!==null&&(i.f&Be)!==0&&(n|=Be);var s={ctx:oe,deps:null,nodes_start:null,nodes_end:null,f:n|Xe|it,first:null,fn:e,last:null,next:null,parent:i,b:i&&i.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(t)try{mn(s),s.f|=ns}catch(l){throw He(s),l}else e!==null&&Ut(s);var r=s;if(t&&r.deps===null&&r.teardown===null&&r.nodes_start===null&&r.first===r.last&&(r.f&wn)===0&&(r=r.first,(n&Tt)!==0&&(n&Gt)!==0&&r!==null&&(r.f|=Gt)),r!==null&&(r.parent=i,i!==null&&Ao(r,i),U!==null&&(U.f&Ie)!==0&&(n&qt)===0)){var a=U;(a.effects??=[]).push(r)}return s}function Ln(){return U!==null&&!ft}function vi(n){const e=mt(gi,null,!1);return Ee(e,xe),e.teardown=n,e}function Re(n){Fr();var e=Q.f,t=!U&&(e&Ct)!==0&&(e&ns)===0;if(t){var i=oe;(i.e??=[]).push(n)}else return Nr(n)}function Nr(n){return mt(ts|ur,n,!1)}function Po(n){return Fr(),mt(gi|ur,n,!0)}function Mo(n){ht.ensure();const e=mt(qt|wn,n,!0);return(t={})=>new Promise(i=>{t.outro?un(e,()=>{He(e),i(void 0)}):(He(e),i(void 0))})}function ko(n){return mt(ts,n,!1)}function Ps(n,e){var t=oe,i={effect:null,ran:!1,deps:n};t.l.$.push(i),i.effect=_i(()=>{n(),!i.ran&&(i.ran=!0,Xt(e))})}function Oo(){var n=oe;_i(()=>{for(var e of n.l.$){e.deps();var t=e.effect;(t.f&xe)!==0&&Ee(t,pt),xn(t)&&mn(t),e.ran=!1}})}function $o(n){return mt(is|wn,n,!0)}function _i(n,e=0){return mt(gi|e,n,!0)}function V(n,e=[],t=[],i=[]){wo(i,e,t,s=>{mt(gi,()=>n(...s.map(d)),!0)})}function yi(n,e=0){var t=mt(Tt|e,n,!0);return t}function Ge(n){return mt(Ct|wn,n,!0)}function Zr(n){var e=n.teardown;if(e!==null){const t=Sn,i=U;Ds(!0),$e(null);try{e.call(null)}finally{Ds(t),$e(i)}}}function Yr(n,e=!1){var t=n.first;for(n.first=n.last=null;t!==null;){const s=t.ac;s!==null&&os(()=>{s.abort(on)});var i=t.next;(t.f&qt)!==0?t.parent=null:He(t,e),t=i}}function Lo(n){for(var e=n.first;e!==null;){var t=e.next;(e.f&Ct)===0&&He(e),e=t}}function He(n,e=!0){var t=!1;(e||(n.f&dr)!==0)&&n.nodes_start!==null&&n.nodes_end!==null&&(Ro(n.nodes_start,n.nodes_end),t=!0),Yr(n,e&&!t),li(n,0),Ee(n,kt);var i=n.transitions;if(i!==null)for(const r of i)r.stop();Zr(n);var s=n.parent;s!==null&&s.first!==null&&Wr(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes_start=n.nodes_end=n.ac=null}function Ro(n,e){for(;n!==null;){var t=n===e?null:zn(n);n.remove(),n=t}}function Wr(n){var e=n.parent,t=n.prev,i=n.next;t!==null&&(t.next=i),i!==null&&(i.prev=t),e!==null&&(e.first===n&&(e.first=i),e.last===n&&(e.last=t))}function un(n,e,t=!0){var i=[];ls(n,i,!0),Br(i,()=>{t&&He(n),e&&e()})}function Br(n,e){var t=n.length;if(t>0){var i=()=>--t||e();for(var s of n)s.out(i)}else e()}function ls(n,e,t){if((n.f&Be)===0){if(n.f^=Be,n.transitions!==null)for(const a of n.transitions)(a.is_global||t)&&e.push(a);for(var i=n.first;i!==null;){var s=i.next,r=(i.f&Gt)!==0||(i.f&Ct)!==0&&(n.f&Tt)!==0;ls(i,e,r?t:!1),i=s}}}function cs(n){zr(n,!0)}function zr(n,e){if((n.f&Be)!==0){n.f^=Be,(n.f&xe)===0&&(Ee(n,Xe),Ut(n));for(var t=n.first;t!==null;){var i=t.next,s=(t.f&Gt)!==0||(t.f&Ct)!==0;zr(t,s?e:!1),t=i}if(n.transitions!==null)for(const r of n.transitions)(r.is_global||e)&&r.in()}}function Gr(n,e){for(var t=n.nodes_start,i=n.nodes_end;t!==null;){var s=t===i?null:zn(t);e.append(t),t=s}}const Ho=["touchstart","touchmove"];function Xo(n){return Ho.includes(n)}const Kr=new Set,zi=new Set;function Fo(n,e,t,i={}){function s(r){if(i.capture||In.call(e,r),!r.cancelBubble)return os(()=>t?.call(this,r))}return n.startsWith("pointer")||n.startsWith("touch")||n==="wheel"?bn(()=>{e.addEventListener(n,s,i)}):e.addEventListener(n,s,i),s}function ut(n,e,t,i,s){var r={capture:i,passive:s},a=Fo(n,e,t,r);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&vi(()=>{e.removeEventListener(n,a,r)})}function Dt(n){for(var e=0;e<n.length;e++)Kr.add(n[e]);for(var t of zi)t(n)}let Ms=null;function In(n){var e=this,t=e.ownerDocument,i=n.type,s=n.composedPath?.()||[],r=s[0]||n.target;Ms=n;var a=0,l=Ms===n&&n.__root;if(l){var o=s.indexOf(l);if(o!==-1&&(e===document||e===window)){n.__root=e;return}var c=s.indexOf(e);if(c===-1)return;o<=c&&(a=o)}if(r=s[a]||n.target,r!==e){or(n,"currentTarget",{configurable:!0,get(){return r||t}});var u=U,h=Q;$e(null),gt(null);try{for(var f,g=[];r!==null;){var w=r.assignedSlot||r.parentNode||r.host||null;try{var S=r["__"+i];S!=null&&(!r.disabled||n.target===r)&&S.call(r,n)}catch(v){f?g.push(v):f=v}if(n.cancelBubble||w===e||w===null)break;r=w}if(f){for(let v of g)queueMicrotask(()=>{throw v});throw f}}finally{n.__root=e,delete n.currentTarget,$e(u),gt(h)}}}function No(n){var e=document.createElement("template");return e.innerHTML=n.replaceAll("<!>","<!---->"),e.content}function ci(n,e){var t=Q;t.nodes_start===null&&(t.nodes_start=n,t.nodes_end=e)}function Z(n,e){var t=(e&to)!==0,i=(e&no)!==0,s,r=!n.startsWith("<!>");return()=>{s===void 0&&(s=No(r?n:"<!>"+n),t||(s=ri(s)));var a=i||wr?document.importNode(s,!0):s.cloneNode(!0);if(t){var l=ri(a),o=a.lastChild;ci(l,o)}else ci(a,a);return a}}function de(n=""){{var e=It(n+"");return ci(e,e),e}}function Fe(){var n=document.createDocumentFragment(),e=document.createComment(""),t=It();return n.append(e,t),ci(e,t),n}function T(n,e){n!==null&&n.before(e)}function De(n,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(n.__t??=n.nodeValue)&&(n.__t=t,n.nodeValue=t+"")}function Zo(n,e){return Yo(n,e)}const tn=new Map;function Yo(n,{target:e,anchor:t,props:i={},events:s,context:r,intro:a=!0}){lo();var l=new Set,o=h=>{for(var f=0;f<h.length;f++){var g=h[f];if(!l.has(g)){l.add(g);var w=Xo(g);e.addEventListener(g,In,{passive:w});var S=tn.get(g);S===void 0?(document.addEventListener(g,In,{passive:w}),tn.set(g,1)):tn.set(g,S+1)}}};o(Qi(Kr)),zi.add(o);var c=void 0,u=Mo(()=>{var h=t??e.appendChild(It());return po(h,{pending:()=>{}},f=>{if(r){we({});var g=oe;g.c=r}s&&(i.$$events=s),c=n(f,i)||{},r&&be()}),()=>{for(var f of l){e.removeEventListener(f,In);var g=tn.get(f);--g===0?(document.removeEventListener(f,In),tn.delete(f)):tn.set(f,g)}zi.delete(o),h!==t&&h.parentNode?.removeChild(h)}});return Wo.set(c,u),c}let Wo=new WeakMap;class Ur{anchor;#e=new Map;#t=new Map;#i=new Map;#n=new Set;#l=!0;constructor(e,t=!0){this.anchor=e,this.#l=t}#r=()=>{var e=ce;if(this.#e.has(e)){var t=this.#e.get(e),i=this.#t.get(t);if(i)cs(i),this.#n.delete(t);else{var s=this.#i.get(t);s&&(this.#t.set(t,s.effect),this.#i.delete(t),s.fragment.lastChild.remove(),this.anchor.before(s.fragment),i=s.effect)}for(const[r,a]of this.#e){if(this.#e.delete(r),r===e)break;const l=this.#i.get(a);l&&(He(l.effect),this.#i.delete(a))}for(const[r,a]of this.#t){if(r===t||this.#n.has(r))continue;const l=()=>{if(Array.from(this.#e.values()).includes(r)){var c=document.createDocumentFragment();Gr(a,c),c.append(It()),this.#i.set(r,{effect:a,fragment:c})}else He(a);this.#n.delete(r),this.#t.delete(r)};this.#l||!i?(this.#n.add(r),un(a,l,!1)):l()}}};#s=e=>{this.#e.delete(e);const t=Array.from(this.#e.values());for(const[i,s]of this.#i)t.includes(i)||(He(s.effect),this.#i.delete(i))};ensure(e,t){var i=ce,s=xr();if(t&&!this.#t.has(e)&&!this.#i.has(e))if(s){var r=document.createDocumentFragment(),a=It();r.append(a),this.#i.set(e,{effect:Ge(()=>t(a)),fragment:r})}else this.#t.set(e,Ge(()=>t(this.anchor)));if(this.#e.set(i,e),s){for(const[l,o]of this.#t)l===e?i.skipped_effects.delete(o):i.skipped_effects.add(o);for(const[l,o]of this.#i)l===e?i.skipped_effects.delete(o.effect):i.skipped_effects.add(o.effect);i.oncommit(this.#r),i.ondiscard(this.#s)}else this.#r()}}function j(n,e,t=!1){var i=new Ur(n),s=t?Gt:0;function r(a,l){i.ensure(a,l)}yi(()=>{var a=!1;e((l,o=!0)=>{a=!0,r(o,l)}),a||r(!1,null)},s)}function vn(n,e,...t){var i=new Ur(n);yi(()=>{const s=e()??null;i.ensure(s,s&&(r=>s(r,...t)))},Gt)}const ks=[...` 	
\r\fÂ \v\uFEFF`];function Bo(n,e,t){var i=n==null?"":""+n;if(e&&(i=i?i+" "+e:e),t){for(var s in t)if(t[s])i=i?i+" "+s:s;else if(i.length)for(var r=s.length,a=0;(a=i.indexOf(s,a))>=0;){var l=a+r;(a===0||ks.includes(i[a-1]))&&(l===i.length||ks.includes(i[l]))?i=(a===0?"":i.substring(0,a))+i.substring(l+1):a=l}}return i===""?null:i}function Os(n,e=!1){var t=e?" !important;":";",i="";for(var s in n){var r=n[s];r!=null&&r!==""&&(i+=" "+s+": "+r+t)}return i}function Ai(n){return n[0]!=="-"||n[1]!=="-"?n.toLowerCase():n}function zo(n,e){if(e){var t="",i,s;if(Array.isArray(e)?(i=e[0],s=e[1]):i=e,n){n=String(n).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var r=!1,a=0,l=!1,o=[];i&&o.push(...Object.keys(i).map(Ai)),s&&o.push(...Object.keys(s).map(Ai));var c=0,u=-1;const S=n.length;for(var h=0;h<S;h++){var f=n[h];if(l?f==="/"&&n[h-1]==="*"&&(l=!1):r?r===f&&(r=!1):f==="/"&&n[h+1]==="*"?l=!0:f==='"'||f==="'"?r=f:f==="("?a++:f===")"&&a--,!l&&r===!1&&a===0){if(f===":"&&u===-1)u=h;else if(f===";"||h===S-1){if(u!==-1){var g=Ai(n.substring(c,u).trim());if(!o.includes(g)){f!==";"&&h++;var w=n.substring(c,h).trim();t+=" "+w+";"}}c=h+1,u=-1}}}}return i&&(t+=Os(i)),s&&(t+=Os(s,!0)),t=t.trim(),t===""?null:t}return n==null?null:String(n)}function Ne(n,e,t,i,s,r){var a=n.__className;if(a!==t||a===void 0){var l=Bo(t,i,r);l==null?n.removeAttribute("class"):n.className=l,n.__className=t}else if(r&&s!==r)for(var o in r){var c=!!r[o];(s==null||c!==!!s[o])&&n.classList.toggle(o,c)}return r}function Pi(n,e={},t,i){for(var s in t){var r=t[s];e[s]!==r&&(t[s]==null?n.style.removeProperty(s):n.style.setProperty(s,r,i))}}function ye(n,e,t,i){var s=n.__style;if(s!==e){var r=zo(e,i);r==null?n.removeAttribute("style"):n.style.cssText=r,n.__style=e}else i&&(Array.isArray(i)?(Pi(n,t?.[0],i[0]),Pi(n,t?.[1],i[1],"important")):Pi(n,t,i));return i}function Vr(n,e,t=!1){if(n.multiple){if(e==null)return;if(!Ji(e))return ro();for(var i of n.options)i.selected=e.includes($s(i));return}for(i of n.options){var s=$s(i);if(oo(s,e)){i.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function Go(n){var e=new MutationObserver(()=>{Vr(n,n.__value)});e.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),vi(()=>{e.disconnect()})}function $s(n){return"__value"in n?n.__value:n.value}const Ko=Symbol("is custom element"),Uo=Symbol("is html");function di(n,e){var t=jr(n);t.value===(t.value=e??void 0)||n.value===e&&(e!==0||n.nodeName!=="PROGRESS")||(n.value=e??"")}function te(n,e,t,i){var s=jr(n);s[e]!==(s[e]=t)&&(e==="loading"&&(n[Za]=t),t==null?n.removeAttribute(e):typeof t!="string"&&Vo(n).includes(e)?n[e]=t:n.setAttribute(e,t))}function jr(n){return n.__attributes??={[Ko]:n.nodeName.includes("-"),[Uo]:n.namespaceURI===io}}var Ls=new Map;function Vo(n){var e=n.getAttribute("is")||n.nodeName,t=Ls.get(e);if(t)return t;Ls.set(e,t=[]);for(var i,s=n,r=Element.prototype;r!==s;){i=lr(s);for(var a in i)i[a].set&&t.push(a);s=es(s)}return t}function Rs(n,e){return n===e||n?.[$t]===e}function Rn(n={},e,t,i){return ko(()=>{var s,r;return _i(()=>{s=r,r=[],Xt(()=>{n!==t(...r)&&(e(n,...r),s&&Rs(t(...s),n)&&e(null,...s))})}),()=>{bn(()=>{r&&Rs(t(...r),n)&&e(null,...r)})}}),n}function qr(n=!1){const e=oe,t=e.l.u;if(!t)return;let i=()=>Do(e.s);if(n){let s=0,r={};const a=mi(()=>{let l=!1;const o=e.s;for(const c in o)o[c]!==r[c]&&(r[c]=o[c],l=!0);return l&&s++,s});i=()=>d(a)}t.b.length&&Po(()=>{Hs(e,i),si(t.b)}),Re(()=>{const s=Xt(()=>t.m.map(Xa));return()=>{for(const r of s)typeof r=="function"&&r()}}),t.a.length&&Re(()=>{Hs(e,i),si(t.a)})}function Hs(n,e){if(n.l.s)for(const t of n.l.s)d(t);e()}let Gi=Symbol();function H(n,e,t){const i=t[e]??={store:null,source:as(void 0),unsubscribe:je};if(i.store!==n&&!(Gi in t))if(i.unsubscribe(),i.store=n??null,n==null)i.source.v=void 0,i.unsubscribe=je;else{var s=!0;i.unsubscribe=ds(n,r=>{s?i.source.v=r:L(i.source,r)}),s=!1}return n&&Gi in t?tt(n):d(i.source)}function Ze(){const n={};function e(){vi(()=>{for(var t in n)n[t].unsubscribe();or(n,Gi,{enumerable:!1,value:!0})})}return[n,e]}function se(n,e,t,i){var s=i,r=!0,a=()=>(r&&(r=!1,s=i),s),l;l=n[e],l===void 0&&i!==void 0&&(l=a());var o;return o=()=>{var c=n[e];return c===void 0?a():(r=!0,c)},o}function wi(n){oe===null&&pr(),Wn&&oe.l!==null?qo(oe).m.push(n):Re(()=>{const e=Xt(n);if(typeof e=="function")return e})}function jo(n){oe===null&&pr(),wi(()=>()=>Xt(n))}function qo(n){var e=n.l;return e.u??={a:[],b:[],m:[]}}function ds(n,e,t){if(n==null)return e(void 0),t&&t(void 0),je;const i=Xt(()=>n.subscribe(e,t));return i.unsubscribe?()=>i.unsubscribe():i}const nn=[];function Jo(n,e){return{subscribe:ee(n,e).subscribe}}function ee(n,e=je){let t=null;const i=new Set;function s(l){if(fr(n,l)&&(n=l,t)){const o=!nn.length;for(const c of i)c[1](),nn.push(c,n);if(o){for(let c=0;c<nn.length;c+=2)nn[c][0](nn[c+1]);nn.length=0}}}function r(l){s(l(n))}function a(l,o=je){const c=[l,o];return i.add(c),i.size===1&&(t=e(s,r)||je),l(n),()=>{i.delete(c),i.size===0&&t&&(t(),t=null)}}return{set:s,update:r,subscribe:a}}function ke(n,e,t){const i=!Array.isArray(n),s=i?[n]:n;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const r=e.length<2;return Jo(t,(a,l)=>{let o=!1;const c=[];let u=0,h=je;const f=()=>{if(u)return;h();const w=e(i?c[0]:c,a,l);r?a(w):h=typeof w=="function"?w:je},g=s.map((w,S)=>ds(w,v=>{c[S]=v,u&=~(1<<S),o&&f()},()=>{u|=1<<S}));return o=!0,f(),function(){si(g),h(),o=!1}})}function tt(n){let e;return ds(n,t=>e=t)(),e}function Qo(){return`zone_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const Ki=["#e74c3c","#e67e22","#f1c40f","#2ecc71","#1abc9c","#3498db","#9b59b6","#e91e8f"];function el(){return Ki[Math.floor(Math.random()*Ki.length)]}function tl(n,e=300){return{id:Qo(),x:n,width:e,color:el(),texts:[{language:"cs",title:"",content:""}]}}function nl(n,e){const t=n.texts.find(i=>i.language===e);return t||n.texts[0]||null}const Hn=ee("cs"),il=ee("orange"),Jr=ee("Forest"),Qr=ee(!1),Ui=ee(!1),Tn=ee(!1),ea=ee(!1),ta=ee(!1),na=ee(null),sl=ke([na,Hn],([n,e])=>n?nl(n,e):null);function Mi(n){na.set(n)}const ia=ee({x:0,y:0});function rl(n,e){ia.set({x:n,y:e})}const sa=ee({scrollX:0,scrollY:0,zoom:1});function al(n,e,t=1){sa.set({scrollX:n,scrollY:e,zoom:t})}const Vi=ee(!1);function ol(){Vi.set(!0),setTimeout(()=>Vi.set(!1),150)}const qe={BACKGROUND_BASE:-100,BACKGROUND_LAYER_START:-99,GROUND_REFERENCE:-1,ITEMS_BEHIND:5,PLAYER:10,ITEMS_FRONT:15,SELECTION_GRAPHICS:999,GRID_OVERLAY:1e3};function us(n){return n==="behind"?qe.ITEMS_BEHIND:qe.ITEMS_FRONT}const _n={FRAME_HEIGHT:48,SCALE:5,DEPTH:qe.PLAYER},ll={HALF_HEIGHT:_n.FRAME_HEIGHT*_n.SCALE/2},yn=40;function cl(n){return n-yn}function Xn(n){return cl(n)-ll.HALF_HEIGHT}function dl(n,e){const t=Xn(e);return Math.min(n,t)}function ul(n,e){const t=Xn(e);return n>t}const yt=["orange","white"];class hl{currentSkin=yt[0];currentIndex=0;setSkin(e){yt.includes(e)&&(this.currentSkin=e,this.currentIndex=yt.indexOf(e),localStorage.setItem("catSkin",e))}getSkin(){const e=localStorage.getItem("catSkin");return e&&yt.includes(e)&&(this.currentSkin=e,this.currentIndex=yt.indexOf(e)),this.currentSkin}toggleSkin(){return this.currentIndex=(this.currentIndex+1)%yt.length,this.currentSkin=yt[this.currentIndex],this.setSkin(this.currentSkin),this.currentSkin}getAllSkins(){return yt}}const ra=new hl,fl={FAST_VELOCITY_THRESHOLD:100,ROTATION_FULL:15,ROTATION_SLIGHT:8};class gl{scene;currentSkin;constructor(e,t="white"){this.scene=e,this.currentSkin=t}createAll(){ra.getAllSkins().forEach(t=>{this.createAnimationsForSkin(t)})}createAnimationsForSkin(e){const t=this.scene;t.anims.exists(`cat-idle-${e}`)||t.anims.create({key:`cat-idle-${e}`,frames:t.anims.generateFrameNumbers(`cat-idle-${e}`,{start:0,end:3}),frameRate:6,repeat:-1}),t.anims.exists(`cat-walk-${e}`)||t.anims.create({key:`cat-walk-${e}`,frames:t.anims.generateFrameNumbers(`cat-walk-${e}`,{start:0,end:5}),frameRate:12,repeat:-1}),[{key:`cat-jump-up-${e}`,frame:2},{key:`cat-jump-peak-up-${e}`,frame:3},{key:`cat-jump-peak-down-${e}`,frame:3},{key:`cat-jump-down-${e}`,frame:4}].forEach(({key:s,frame:r})=>{t.anims.exists(s)||t.anims.create({key:s,frames:[{key:`cat-walk-${e}`,frame:r}],frameRate:1,repeat:0})})}getSkin(){return this.currentSkin}setSkin(e){this.currentSkin=e}getAnimationKey(e){return`cat-${e}-${this.currentSkin}`}play(e,t){const i=this.getAnimationKey(t);e.anims.currentAnim?.key!==i&&e.play(i)}getJumpAnimationState(e){const{FAST_VELOCITY_THRESHOLD:t,ROTATION_FULL:i,ROTATION_SLIGHT:s}=fl;return e<-t?{animation:this.getAnimationKey("jump-up"),rotation:i,flipMultiplier:1}:e<-20?{animation:this.getAnimationKey("jump-peak-up"),rotation:s,flipMultiplier:1}:e<=t?{animation:this.getAnimationKey("jump-peak-down"),rotation:s,flipMultiplier:-1}:{animation:this.getAnimationKey("jump-down"),rotation:i,flipMultiplier:-1}}handleSkinChange(e,t){const i=this.currentSkin;this.currentSkin=t;const s=e.anims.currentAnim?.key;if(s){const a=`cat-${s.replace("cat-","").replace(`-${i}`,"")}-${t}`;this.scene.anims.exists(a)&&e.play(a)}}}let aa=!1,rn=!1;function jn(n){aa=n}function Xs(){return aa}function jt(){return rn}function ki(n){if(!n||n.tagName==="CANVAS")return!1;if(n.closest("[data-ui]"))return!0;const e=document.getElementById("game-ui");return!!(e&&e.contains(n)||n.closest("button"))}function pl(){document.addEventListener("pointerdown",n=>{rn=ki(n.target)},{capture:!0}),document.addEventListener("pointermove",n=>{n.buttons>0||(rn=ki(n.target))},{capture:!0}),document.addEventListener("pointerup",()=>{setTimeout(()=>{rn=!1},10)},{capture:!0}),document.addEventListener("touchstart",n=>{rn=ki(n.target)},{capture:!0,passive:!0}),document.addEventListener("touchend",()=>{setTimeout(()=>{rn=!1},10)},{capture:!0,passive:!0})}function Pn(){const n=document.activeElement;if(!n)return!1;const e=n.tagName.toUpperCase();return e==="INPUT"||e==="TEXTAREA"||n.getAttribute("contenteditable")==="true"}function cn(n,e,t){const i=(n-t.worldView.x)*t.zoom,s=(e-t.worldView.y)*t.zoom;return{screenX:i,screenY:s}}function ml(n,e,t){const i=n/t.zoom+t.worldView.x,s=e/t.zoom+t.worldView.y;return{worldX:i,worldY:s}}const Yt={THRESHOLD_X:20,LANGUAGE_BUTTON:{width:120,height:60},SKIN_BUTTON:{width:120,height:60,yOffset:60}},Fs={SPEED:350,JUMP_STRENGTH:-500};class vl{scene;getPlayerPosition;keyUp;keyLeft;keyRight;keyA;keyD;keyW;keySpace;touchLeft=!1;touchRight=!1;touchJump=!1;touchHandlers;constructor(e){this.scene=e.scene,this.getPlayerPosition=e.getPlayerPosition,this.setupKeyboardControls(),this.setupTouchControls()}setupKeyboardControls(){this.scene.input.keyboard&&(this.keyUp=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.UP,!1),this.keyLeft=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.LEFT,!1),this.keyRight=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.RIGHT,!1),this.keyA=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.A,!1),this.keyD=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.D,!1),this.keyW=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.W,!1),this.keySpace=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.SPACE,!1))}setupTouchControls(){const e=this.scene,t=a=>{if(tt(Vi)){this.touchLeft=!1,this.touchRight=!1,this.touchJump=!1;return}const l=a.x,o=a.y,c=e.scale.width;if(l>c-Yt.LANGUAGE_BUTTON.width&&o<Yt.LANGUAGE_BUTTON.height||l>c-Yt.SKIN_BUTTON.width&&o>=Yt.SKIN_BUTTON.yOffset&&o<Yt.SKIN_BUTTON.yOffset+Yt.SKIN_BUTTON.height)return;const u=e.cameras.main,h=this.getPlayerPosition(),f=h.x-u.scrollX,g=h.y-u.scrollY,w=l-f,S=o-g;w<-20?(this.touchLeft=!0,this.touchRight=!1):w>Yt.THRESHOLD_X?(this.touchRight=!0,this.touchLeft=!1):(this.touchLeft=!1,this.touchRight=!1),this.touchJump=S<-80},i=a=>{jt()||t(a)},s=a=>{jt()||a.isDown&&t(a)},r=()=>{this.touchLeft=!1,this.touchRight=!1,this.touchJump=!1};e.input.on("pointerdown",i),e.input.on("pointermove",s),e.input.on("pointerup",r),this.touchHandlers={pointerdown:i,pointermove:s,pointerup:r}}getInputState(){const e=this.keyA?.isDown||this.keyLeft?.isDown||this.touchLeft||!1,t=this.keyD?.isDown||this.keyRight?.isDown||this.touchRight||!1,i=this.keySpace?.isDown||this.keyW?.isDown||this.keyUp?.isDown||this.touchJump||!1;return{left:e,right:t,jump:i}}hasAnyInput(){const e=this.getInputState();return e.left||e.right||e.jump}destroy(){this.touchHandlers&&(this.scene.input.off("pointerdown",this.touchHandlers.pointerdown),this.scene.input.off("pointermove",this.touchHandlers.pointermove),this.scene.input.off("pointerup",this.touchHandlers.pointerup),this.touchHandlers=void 0)}}class _l extends N.Physics.Arcade.Sprite{animations;inputController;animState="idle";hasNotifiedMovement=!1;hasReceivedInput=!1;constructor(e,t,i){const s="white";super(e,t,i,`cat-idle-${s}`),e.add.existing(this),e.physics.add.existing(this),this.animations=new gl(e,s),this.animations.createAll(),this.inputController=new vl({scene:e,getPlayerPosition:()=>({x:this.x,y:this.y})}),this.setCollideWorldBounds(!0),this.setBounce(0),this.setSize(16,12),this.setOffset(16,36),this.setScale(_n.SCALE),this.setDepth(_n.DEPTH),this.animations.play(this,"idle")}changeSkin(e){this.animations.handleSkinChange(this,e)}updateJumpAnimation(e){const{animation:t,rotation:i,flipMultiplier:s}=this.animations.getJumpAnimationState(e);this.anims.currentAnim?.key!==t&&this.play(t);const r=this.flipX?i*s:-i*s;this.setAngle(r)}update(){const e=this.inputController.getInputState(),t=this.body,i=t&&(t.blocked.down||t.touching.down);switch(this.inputController.hasAnyInput()&&!this.hasReceivedInput&&(this.hasReceivedInput=!0),this.hasReceivedInput&&this.inputController.hasAnyInput()&&!this.hasNotifiedMovement&&(this.hasNotifiedMovement=!0,ta.set(!0)),e.left?(this.setVelocityX(-350),this.setFlipX(!0),i&&(this.animState="running")):e.right?(this.setVelocityX(Fs.SPEED),this.setFlipX(!1),i&&(this.animState="running")):(this.setVelocityX(0),i&&(this.animState="idle")),e.jump&&i&&(this.setVelocityY(Fs.JUMP_STRENGTH),this.animState="jumping"),!i&&t&&t.velocity.y!==0&&(this.animState="jumping"),this.animState){case"idle":this.animations.play(this,"idle"),this.setAngle(0);break;case"running":this.animations.play(this,"walk"),this.setAngle(0);break;case"jumping":this.updateJumpAnimation(t.velocity.y);break}}destroy(e){this.inputController.destroy(),super.destroy(e)}}const lt=[{name:"FOREST GREEN",folder:"forest_green",scrollFactors:[1,.8,.85,.9,.95]},{name:"FOREST BLUE",folder:"forest_blue",scrollFactors:[1,.8,.85,.9,.95,1]}];class yl{currentIndex=0;constructor(){const e=localStorage.getItem("background");if(e){const t=lt.findIndex(i=>i.folder===e);t!==-1&&(this.currentIndex=t)}}getBackground(){return lt[this.currentIndex].folder}getCurrentConfig(){return lt[this.currentIndex]}setBackground(e){const t=lt.findIndex(i=>i.folder===e);t!==-1&&(this.currentIndex=t,localStorage.setItem("background",e))}toggleBackground(){this.currentIndex=(this.currentIndex+1)%lt.length;const e=lt[this.currentIndex];return localStorage.setItem("background",e.folder),e}getAllBackgrounds(){return lt}setBackgroundByIndex(e){e>=0&&e<lt.length&&(this.currentIndex=e,localStorage.setItem("background",lt[e].folder))}getCurrentIndex(){return this.currentIndex}}const Fn=new yl;function oa(n,e){return new Promise(t=>{n.load.image(`bg0-${e.folder}`,`assets/backgrounds/${e.folder}/0.png`);for(let i=0;i<e.scrollFactors.length;i++){const s=i+1;n.load.image(`bg${s}-${e.folder}`,`assets/backgrounds/${e.folder}/${s}.png`)}n.load.once("complete",()=>{t(!0)}),n.load.once("loaderror",i=>{console.error(`Failed to load background asset: ${i.key}`),t(!1)}),n.load.start()})}function la(n,e,t,i){const s=Math.max(t,n.scale.height),r=n.add.tileSprite(0,0,e,s,`bg0-${i.folder}`);r.setOrigin(0,0),r.setScrollFactor(1),r.setDepth(qe.BACKGROUND_BASE),r.tilePositionX=0,r.tilePositionY=0;const a=[];for(let l=0;l<i.scrollFactors.length;l++){const c=`bg${l+1}-${i.folder}`;if(n.textures.exists(c)){const u=n.add.image(0,0,c);u.setOrigin(0,0),u.setScrollFactor(i.scrollFactors[l]),u.setDepth(qe.BACKGROUND_LAYER_START+l),u.setDisplaySize(e,t),a.push(u)}}return{baseLayer:r,bgLayers:a}}function ca(n,e){n&&(n.tilePositionX=e.scrollX)}function wl(n){n.bgLayers.forEach(e=>e.destroy()),n.baseLayer.destroy()}const bl=[{code:"cs",label:"CZ"},{code:"en",label:"EN"}],da="cs",Sl={isActive:!1,config:null,selectedItemId:null,itemDepthLayer:"behind",editMode:"items",selectedDialogZoneId:null,selectedFrameId:null,isPlayerSelected:!1},K=ee(Sl),ua=ke(K,n=>n.isActive),xl=ke(K,n=>n.config),ui=ee(!0);function El(){ui.update(n=>!n)}const Jt=ee(!1);function hn(n){Jt.set(n)}const ji=ee(!1);function Oi(n){ji.set(n)}const zt=ee(!1),Wt=ee(!1),bi=ee(!1);function Il(){zt.update(n=>!n)}function Tl(){Wt.update(n=>!n)}function ha(){bi.set(!0)}function Cl(){bi.set(!1)}const hs=ee(da);function Dl(n){hs.set(n)}const Si=ke(K,n=>n.selectedItemId),fa=ke(K,n=>n.itemDepthLayer),Je=ke(K,n=>n.editMode),xi=ke(K,n=>n.selectedDialogZoneId),fs=ke(K,n=>n.config?.dialogZones||[]),Nn=ke(K,n=>n.selectedFrameId),$i=ke(K,n=>n.isPlayerSelected),ga=ke(K,n=>n.config?.placedFrames||[]),gs=ee(new Map);function Al(n,e,t){gs.update(i=>{const s=new Map(i);return s.set(n,{x:e,y:t}),s})}function Pl(n){gs.update(e=>{const t=new Map(e);return t.delete(n),t})}const pa=ee(null);function Li(n){pa.set(n)}const Ml=ke(K,n=>!n.selectedFrameId||!n.config?.placedFrames?null:n.config.placedFrames.find(e=>e.id===n.selectedFrameId)??null),ma=ee(null);function Ri(n){ma.set(n)}const va=ee(null);function qn(n){va.set(n)}const ps=ee(!1);function _a(){ps.set(!0)}function Ns(){ps.set(!1)}const ms=ke(K,n=>!n.selectedItemId||!n.config?.placedItems?null:n.config.placedItems.find(e=>e.id===n.selectedItemId)??null),kl=ke(ms,n=>n?.physicsEnabled??!1),Ol=ke(ms,n=>n?.flipX??!1);function Zs(n,e){K.update(t=>t.config?{...t,config:{...t.config,playerStartX:n,playerStartY:e}}:t)}function $l(n){K.update(e=>{if(!e.config)return e;const t=e.config.placedItems||[];return{...e,config:{...e.config,placedItems:[...t,n]}}})}function Zn(n,e){K.update(t=>!t.config||!t.config.placedItems?t:{...t,config:{...t.config,placedItems:t.config.placedItems.map(i=>i.id===n?{...i,...e}:i)}})}function ya(n){K.update(e=>!e.config||!e.config.placedItems?e:{...e,config:{...e.config,placedItems:e.config.placedItems.filter(t=>t.id!==n)},selectedItemId:e.selectedItemId===n?null:e.selectedItemId})}function wa(n){K.update(e=>({...e,selectedItemId:n,isPlayerSelected:n?!1:e.isPlayerSelected}))}function Ll(n){K.update(e=>({...e,isPlayerSelected:n,selectedItemId:null}))}function vs(){K.update(n=>({...n,selectedItemId:null,selectedFrameId:null,selectedDialogZoneId:null,isPlayerSelected:!1}))}function Rl(){K.update(n=>({...n,itemDepthLayer:n.itemDepthLayer==="behind"?"front":"behind"}))}function Hl(n,e){Zn(n,{depth:e})}function Xl(n,e){e?(Zn(n,{physicsEnabled:e,depth:us("behind")}),K.update(t=>({...t,itemDepthLayer:"behind"}))):Zn(n,{physicsEnabled:e})}function Fl(n,e){Zn(n,{flipX:e})}function Nl(n){K.set({isActive:!0,config:{...n,placedItems:n.placedItems||[],dialogZones:n.dialogZones||[],placedFrames:n.placedFrames||[]},selectedItemId:null,itemDepthLayer:"behind",editMode:"items",selectedDialogZoneId:null,selectedFrameId:null,isPlayerSelected:!1}),_s.set(1)}function Zl(){K.update(n=>{const e=n.config?{...n.config,dialogZones:(n.config.dialogZones||[]).filter(t=>t.texts.some(i=>i.title.trim()!==""||i.content.trim()!==""))}:n.config;return{...n,isActive:!1,selectedItemId:null,config:e}}),_s.set(1)}function Yl(){return tt(K).config}const _s=ee(1);function Jn(n){_s.set(n)}const ys=ee({scrollX:0,scrollY:0,viewWidth:0,viewHeight:0,worldWidth:0,worldHeight:0,zoom:1,playerX:0,playerY:0});function Wl(n){ys.update(e=>({...e,...n}))}function Qn(n){K.update(e=>({...e,editMode:n,selectedItemId:null,selectedDialogZoneId:null}))}function Bl(n){K.update(e=>{if(!e.config)return e;const t=e.config.dialogZones||[];return{...e,config:{...e.config,dialogZones:[...t,n]}}})}function an(n,e){K.update(t=>!t.config||!t.config.dialogZones?t:{...t,config:{...t.config,dialogZones:t.config.dialogZones.map(i=>i.id===n?{...i,...e}:i)}})}function ba(n){K.update(e=>!e.config||!e.config.dialogZones?e:{...e,config:{...e.config,dialogZones:e.config.dialogZones.filter(t=>t.id!==n)},selectedDialogZoneId:e.selectedDialogZoneId===n?null:e.selectedDialogZoneId})}function Mn(n){K.update(e=>({...e,selectedDialogZoneId:n}))}function Ys(n,e,t){K.update(i=>!i.config||!i.config.dialogZones?i:{...i,config:{...i.config,dialogZones:i.config.dialogZones.map(s=>{if(s.id!==n)return s;const r=s.texts.findIndex(l=>l.language===e);let a;return r>=0?a=s.texts.map((l,o)=>o===r?{...l,...t}:l):a=[...s.texts,{language:e,title:"",content:"",...t}],{...s,texts:a}})}})}function zl(n){K.update(e=>{if(!e.config)return e;const t=e.config.placedFrames||[];return{...e,config:{...e.config,placedFrames:[...t,n]}}})}function wt(n,e){K.update(t=>!t.config||!t.config.placedFrames?t:{...t,config:{...t.config,placedFrames:t.config.placedFrames.map(i=>i.id===n?{...i,...e}:i)}})}function ws(n){K.update(e=>!e.config||!e.config.placedFrames?e:{...e,config:{...e.config,placedFrames:e.config.placedFrames.filter(t=>t.id!==n)},selectedFrameId:e.selectedFrameId===n?null:e.selectedFrameId})}function kn(n){bi.set(!1),K.update(e=>({...e,selectedFrameId:n,isPlayerSelected:n?!1:e.isPlayerSelected,selectedItemId:n?null:e.selectedItemId}))}const bs=[{key:"tent",name:"Tent",path:"assets/ui/tent.png",scale:6,category:"structures"},{key:"lamp",name:"Lamp",path:"assets/ui/lamp.png",scale:8,category:"props"},{key:"sign_left",name:"Sign â",path:"assets/ui/sign_left.png",scale:7,category:"signs"},{key:"sign_right",name:"Sign â",path:"assets/ui/sign_right.png",scale:7,category:"signs"},{key:"stone_0",name:"Stone 0",path:"assets/ui/stone_0.png",scale:4,category:"nature",supportsPhysics:!0},{key:"stone_1",name:"Stone 1",path:"assets/ui/stone_1.png",scale:5,category:"nature",supportsPhysics:!0},{key:"stone_2",name:"Stone 2",path:"assets/ui/stone_2.png",scale:4,category:"nature",supportsPhysics:!0}];function Sa(n){return bs.find(e=>e.key===n)}function Gl(n){return Sa(n)?.scale||1}function Kl(n){return Sa(n)?.supportsPhysics??!1}class Ws{scene;groundY;constructor(e,t){this.scene=e,this.groundY=t}static preloadAssets(e){bs.forEach(t=>{e.load.image(t.key,t.path)})}createSprite(e){const{id:t,assetKey:i,x:s,scale:r=1,depth:a=5,yOffset:l=0,flipX:o=!1}=e,c=this.groundY+l,u=this.scene.add.sprite(s,c,i);return u.setScale(r),u.setDepth(a),u.setFlipX(o),u.setData("itemId",t),u}updatePosition(e,t,i){e.x=t,e.y=this.groundY+i}updateScale(e,t){e.setScale(t)}updateDepth(e,t){e.setDepth(t)}applyUpdates(e,t){t.x!==void 0&&(e.x=t.x),t.yOffset!==void 0&&(e.y=this.groundY+t.yOffset),t.scale!==void 0&&e.setScale(t.scale),t.depth!==void 0&&e.setDepth(t.depth),t.flipX!==void 0&&e.setFlipX(t.flipX)}worldYToOffset(e){return e-this.groundY}getGroundY(){return this.groundY}}const dn=50,Ul=4871528,Vl=.4,jl=1,xa=qe.GRID_OVERLAY,Hi=16711680,ql=2,Jl=.6,Ql=.1,ec=1,tc=.2,Bs=50,nc=50,Ea=4886754;class ic{lastClickTime=0;lastClickId=null;threshold;constructor(e=300){this.threshold=e}check(e){const t=Date.now(),i=this.lastClickId===e&&t-this.lastClickTime<this.threshold;return this.lastClickTime=t,this.lastClickId=e,i}reset(){this.lastClickTime=0,this.lastClickId=null}}function ei(n,e){return Math.round(n/e)*e}function Ss(n){const{sprite:e,scene:t,callbacks:i={},constraints:s,useGridSnapping:r=!0,cursor:a="grab",hitArea:l}=n;let o=!1,c=0,u=0,h=0;l?e.setInteractive({hitArea:l,hitAreaCallback:N.Geom.Rectangle.Contains,useHandCursor:!0,cursor:a}):e.setInteractive({useHandCursor:!0,cursor:a});const f=(_,y)=>{const p=e.getBounds(),x=5;return _>=p.x-x&&_<=p.x+p.width+x&&y>=p.y-x&&y<=p.y+p.height+x},g=()=>{const _=t.data.get("lastTapTime");if(!_||_===h||Date.now()-_>100)return;h=_;const y=t.data.get("lastTapWorldX"),p=t.data.get("lastTapWorldY");f(y,p)&&i.onSelect?.()},w=_=>{if(_.wasTouch||tt(ji)||jt()||o||i.onDoubleClick?.())return;const y=i.isSelected?.()??!1;i.onSelect?.(),y&&(o=!0,t.data.set("isDraggingItem",!0),hn(!0),c=e.x-_.worldX,u=e.y-_.worldY,i.onDragStart?.())},S=_=>{if(_.wasTouch){const x=t.data.get("touchDragStarted");if(!o&&x&&i.isSelected?.()){const D=t.data.get("touchStartWorldX"),O=t.data.get("touchStartWorldY"),E=e.getBounds(),A=10;D>=E.x-A&&D<=E.x+E.width+A&&O>=E.y-A&&O<=E.y+E.height+A&&(o=!0,t.data.set("isDraggingItem",!0),t.data.set("touchDragStarted",!1),hn(!0),c=e.x-D,u=e.y-O,i.onDragStart?.())}if(o){let I=_.worldX+c,D=_.worldY+u;r&&tt(ui)&&(I=ei(I,dn),D=ei(D,dn)),s&&(s.minX!==void 0&&(I=Math.max(I,s.minX)),s.maxX!==void 0&&(I=Math.min(I,s.maxX)),s.minY!==void 0&&(D=Math.max(D,s.minY)),s.maxY!==void 0&&(D=Math.min(D,s.maxY))),e.setPosition(I,D),i.onDrag?.(I,D)}return}if(!o)return;if(tt(ji)){m();return}if(!_.isDown){m();return}let y=_.worldX+c,p=_.worldY+u;r&&tt(ui)&&(y=ei(y,dn),p=ei(p,dn)),s&&(s.minX!==void 0&&(y=Math.max(y,s.minX)),s.maxX!==void 0&&(y=Math.min(y,s.maxX)),s.minY!==void 0&&(p=Math.max(p,s.minY)),s.maxY!==void 0&&(p=Math.min(p,s.maxY))),e.setPosition(y,p),i.onDrag?.(y,p)},v=()=>{o&&m()},m=()=>{o=!1,t.data.set("isDraggingItem",!1),hn(!1),i.onDragEnd?.(e.x,e.y)};e.on("pointerdown",w),t.input.on("pointermove",S),t.input.on("pointerup",v);const b=()=>{g()};return t.events.on("update",b),()=>{e.off("pointerdown",w),t.input.off("pointermove",S),t.input.off("pointerup",v),t.events.off("update",b)}}const sc=4886754;class rc{scene;groundY;worldWidth;worldHeight;isDragging=!1;callbacks;cleanupFunctions=new Map;constructor(e,t,i,s,r={}){this.scene=e,this.groundY=t,this.worldWidth=i,this.worldHeight=s,this.callbacks=r}getIsDragging(){return this.isDragging}makeInteractive(e,t){const i=Ss({sprite:e,scene:this.scene,cursor:"pointer",constraints:{minX:0,maxX:this.worldWidth,minY:0,maxY:this.worldHeight},callbacks:{onSelect:()=>{wa(t),this.callbacks.onSelect?.(t)},isSelected:()=>tt(Si)===t,onDragStart:()=>{this.isDragging=!0,e.setTint(sc),this.callbacks.onDragStart?.(t)},onDrag:(s,r)=>{this.callbacks.onDrag?.(t,s,r)},onDragEnd:(s,r)=>{e.clearTint(),this.isDragging=!1;const a=Math.round(s),o=Math.round(r)-this.groundY;Zn(t,{x:a,yOffset:o}),this.callbacks.onDragEnd?.(t,a,o)}}});this.cleanupFunctions.set(t,i)}removeInteractivity(e){if(!e||!e.scene)return;const t=e.getData("itemId");t&&this.cleanupFunctions.has(t)&&(this.cleanupFunctions.get(t)(),this.cleanupFunctions.delete(t)),e.removeInteractive()}destroy(){this.cleanupFunctions.forEach(e=>e()),this.cleanupFunctions.clear()}}const ac={lineWidth:3,lineColor:4886754,lineAlpha:1,handleSize:8,handleColor:4886754,padding:5};class oc{scene;graphics;style;selectedId=null;constructor(e,t={}){this.scene=e,this.style={...ac,...t},this.graphics=e.add.graphics(),this.graphics.setDepth(qe.SELECTION_GRAPHICS)}setSelectedId(e){this.selectedId=e}getSelectedId(){return this.selectedId}updateVisuals(e){if(this.graphics.clear(),!e||!this.selectedId)return;const t=e.getBounds(),{lineWidth:i,lineColor:s,lineAlpha:r,handleSize:a,handleColor:l,padding:o}=this.style;this.graphics.lineStyle(i,s,r),this.graphics.strokeRect(t.x-o,t.y-o,t.width+o*2,t.height+o*2),this.graphics.fillStyle(l,1),this.graphics.fillCircle(t.x,t.y,a),this.graphics.fillCircle(t.x+t.width,t.y,a),this.graphics.fillCircle(t.x,t.y+t.height,a),this.graphics.fillCircle(t.x+t.width,t.y+t.height,a)}clearVisuals(){this.graphics.clear(),this.selectedId=null}setupBackgroundDeselect(e){this.scene.input.on("pointerdown",t=>{if(jt()||e())return;this.scene.input.hitTestPointer(t).find(r=>!!(r.type==="Sprite"&&(r.getData("itemId")||r.getData("frameId")||r.getData("isPlayer"))||r.type==="Rectangle"&&r.getData("zoneId")))||(vs(),this.clearVisuals())})}destroy(){this.graphics?.destroy()}}class hi{scene;items=new Map;isBuilderMode=!1;physicsGroup=null;renderer;dragController;selectionManager;constructor(e,t,i,s,r=!1){this.scene=e,this.isBuilderMode=r,this.renderer=new Ws(e,t),r||(this.physicsGroup=e.physics.add.staticGroup()),this.isBuilderMode&&(this.dragController=new rc(e,t,i,s,{onSelect:()=>this.updateSelectionVisuals(),onDrag:()=>this.updateSelectionVisuals()}),this.selectionManager=new oc(e))}static preloadAssets(e){Ws.preloadAssets(e)}createItems(e){e.forEach(t=>{this.createItem(t)})}createItem(e){const t=this.renderer.createSprite(e),i={sprite:t,data:e};if(!this.isBuilderMode&&e.physicsEnabled&&this.physicsGroup){const s=this.createPhysicsBody(t,e);i.physicsBody=s}this.items.set(e.id,i),this.isBuilderMode&&this.dragController&&this.dragController.makeInteractive(t,e.id)}createPhysicsBody(e,t){const i=e.getBounds(),s=i.width*.5,r=i.height*.8,a=e.x,l=e.y,o=this.scene.add.rectangle(a,l,s,r);return o.setVisible(!1),this.physicsGroup.add(o),o.setData("itemId",t.id),o}updateSelectionVisuals(){if(!this.selectionManager)return;const e=this.scene.data.get("selectedItemId");if(this.selectionManager.setSelectedId(e),!e){this.selectionManager.clearVisuals(),Li(null);return}const t=this.items.get(e);if(this.selectionManager.updateVisuals(t?.sprite??null),t?.sprite){const i=this.scene.cameras.main,s=t.sprite.getBounds(),{screenX:r,screenY:a}=cn(s.centerX,s.centerY,i),l=s.height*i.zoom;Li({screenX:r,screenY:a,itemHeight:l})}else Li(null)}updateItem(e,t){const i=this.items.get(e);i&&(this.renderer.applyUpdates(i.sprite,t),i.data={...i.data,...t})}removeItem(e){const t=this.items.get(e);t&&(this.dragController&&this.dragController.removeInteractivity(t.sprite),t.physicsBody&&t.physicsBody.destroy(),t.sprite.destroy(),this.items.delete(e))}removeAllItems(){this.items.forEach(e=>{!e.sprite||!e.sprite.scene||(this.dragController&&this.dragController.removeInteractivity(e.sprite),e.physicsBody&&e.physicsBody.destroy(),e.sprite.destroy())}),this.items.clear()}getItem(e){return this.items.get(e)?.data}getAllItems(){return Array.from(this.items.values()).map(e=>e.data)}getPhysicsGroup(){return this.physicsGroup}setInteractiveEnabled(e){!this.isBuilderMode||!this.dragController||(this.items.forEach(({sprite:t,data:i})=>{e?(this.dragController.makeInteractive(t,i.id),t.setAlpha(1)):(t.disableInteractive(),t.setAlpha(.6))}),!e&&this.selectionManager&&this.selectionManager.clearVisuals())}destroy(){this.removeAllItems(),this.selectionManager?.destroy()}setupBackgroundDeselect(){!this.isBuilderMode||!this.selectionManager||this.selectionManager.setupBackgroundDeselect(()=>this.dragController?.getIsDragging()??!1)}}function lc(){return`frame_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const cc=["#ffffff","#f8f8f8","#fffacd","#ffefd5","#ffe4e1","#e6e6fa","#f0fff0","#f5fffa","#fff0f5","#f0f8ff","#2d2d2d","#1a1a2e","#16213e","#1a1a1a","#2d132c","#1e3a3a","#3d1a1a","#1a2f1a","#3d3d1a","#2a1a3d"],dc=["#333333","#000000","#ffffff","#1a1a1a","#666666","#8b4513","#2c3e50","#c0392b","#27ae60","#2980b9","#8e44ad","#f39c12"],uc=[12,14,16,18,20,24,28,32],Ia={S:{label:"Small",scale:3},M:{label:"Medium",scale:4},L:{label:"Large",scale:5}};function hc(n){return Ia[n].scale}function fc(n){return n<=3?"S":n>=5?"L":"M"}const Et=4,Cn="#ffffff",Ta="#333333",ti=16,gc=64,pc=96,mc=.06,zs=32,fi=[{key:"base_1",name:"Frame 1",path:"assets/frames/base 1.png",scale:4},{key:"base_2",name:"Frame 2",path:"assets/frames/base 2.png",scale:4},{key:"base_3",name:"Frame 3",path:"assets/frames/base 3.png",scale:4},{key:"base_4",name:"Frame 4",path:"assets/frames/base 4.png",scale:4},{key:"base_5",name:"Frame 5",path:"assets/frames/base 5.png",scale:4},{key:"base_6",name:"Frame 6",path:"assets/frames/base 6.png",scale:4},{key:"base_7",name:"Frame 7",path:"assets/frames/base 7.png",scale:4},{key:"base_8",name:"Frame 8",path:"assets/frames/base 8.png",scale:4},{key:"base_9",name:"Frame 9",path:"assets/frames/base 9.png",scale:4},{key:"base_10",name:"Frame 10",path:"assets/frames/base 10.png",scale:4},{key:"base_11",name:"Frame 11",path:"assets/frames/base 11.png",scale:4},{key:"base_12",name:"Frame 12",path:"assets/frames/base 12.png",scale:4},{key:"base_13",name:"Frame 13",path:"assets/frames/base 13.png",scale:4},{key:"base_14",name:"Frame 14",path:"assets/frames/base 14.png",scale:4},{key:"base_15",name:"Frame 15",path:"assets/frames/base 15.png",scale:4},{key:"base_16",name:"Frame 16",path:"assets/frames/base 16.png",scale:4},{key:"base_17",name:"Frame 17",path:"assets/frames/base 17.png",scale:4},{key:"base_18",name:"Frame 18",path:"assets/frames/base 18.png",scale:4},{key:"base_19",name:"Frame 19",path:"assets/frames/base 19.png",scale:4},{key:"base_20",name:"Frame 20",path:"assets/frames/base 20.png",scale:4},{key:"base_21",name:"Frame 21",path:"assets/frames/base 21.png",scale:4},{key:"base_22",name:"Frame 22",path:"assets/frames/base 22.png",scale:4},{key:"base_23",name:"Frame 23",path:"assets/frames/base 23.png",scale:4},{key:"base_24",name:"Frame 24",path:"assets/frames/base 24.png",scale:4},{key:"base_25",name:"Frame 25",path:"assets/frames/base 25.png",scale:4}];function vc(n){return fi.find(e=>e.key===n)}function _c(n){return vc(n)?.scale??Et}function On(n=Et,e=!1){const t=gc*n,i=pc*n,s=e?i:t,r=e?t:i,a=Math.min(t,i)*mc,l=s-a*2,o=r-a*2,c=l-zs*2,u=o-zs*2;return{frameWidth:s,frameHeight:r,innerWidth:l,innerHeight:o,textWidth:c,textHeight:u}}function ni(n,e,t,i,s,r,a=4){n.clear();const l=parseInt(r.replace("#",""),16);n.fillStyle(l,1),n.fillRoundedRect(e-i/2,t-s/2,i,s,a)}class Gs{scene;frames=new Map;constructor(e){this.scene=e}static preloadAssets(e){for(let t=1;t<=25;t++)e.load.image(`frame_base_${t}`,`assets/frames/base ${t}.png`)}createFrames(e){e.forEach(t=>{this.createFrame(t)})}createFrame(e){const t=`frame_${e.frameKey}`;if(!this.scene.textures.exists(t)){console.warn(`[GameFrameManager] Frame texture not found: ${t}`);return}const i=e.scale??Et,s=e.depth??qe.ITEMS_FRONT,r=(e.rotation??0)*(Math.PI/180),a=e.rotation===90,{innerWidth:l,innerHeight:o}=On(i,a),c=this.scene.add.graphics();c.setDepth(s-.1),ni(c,e.x,e.y,l,o,e.backgroundColor||Cn);const u=this.scene.add.sprite(e.x,e.y,t);u.setScale(i),u.setDepth(s),u.setOrigin(.5,.5),u.setRotation(r);const h={sprite:u,background:c,data:e};this.frames.set(e.id,h),e.url&&this.makeClickable(h)}makeClickable(e){const{sprite:t,data:i}=e;t.setInteractive({useHandCursor:!0}),t.on("pointerover",()=>{t.setScale((i.scale??Et)*1.05)}),t.on("pointerout",()=>{t.setScale(i.scale??Et)}),t.on("pointerdown",()=>{i.url&&(ol(),window.open(i.url,"_blank","noopener,noreferrer"))})}destroy(){this.frames.forEach(({sprite:e,background:t})=>{e.destroy(),t.destroy()}),this.frames.clear()}}async function Ks(){const n=await fetch("./config/map.json");if(!n.ok)throw new Error(`Failed to load map config: ${n.status}`);const e=await n.json();if(!e.worldWidth||!e.worldHeight)throw new Error("Invalid map config structure");return e}const ii={generateId(){return`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`},create(n){const{assetKey:e,x:t,yOffset:i=0,depthLayer:s="behind",scale:r}=n;return{id:ii.generateId(),assetKey:e,x:Math.round(t),y:0,scale:r??Gl(e),depth:us(s),yOffset:Math.round(i)}},createAtWorldPosition(n,e,t,i,s="behind"){return ii.create({assetKey:n,x:e,yOffset:t-i,depthLayer:s})},clone(n,e=50){return{...n,id:ii.generateId(),x:n.x+e}}},sn={HEIGHT:yn,VISUAL:{COLOR:9139029,ALPHA:.3},PHYSICS:{COLOR:0,ALPHA:0}},Yn={getGroundY(n,e=yn){return n-e},createVisualGround(n,e){const t=e.height??sn.HEIGHT,i=Yn.getGroundY(e.worldHeight,t),s=n.add.rectangle(0,i,e.worldWidth,t,e.color??sn.VISUAL.COLOR,e.alpha??sn.VISUAL.ALPHA);return s.setOrigin(0,0),s.setDepth(e.depth??qe.GROUND_REFERENCE),{ground:s,groundY:i}},createPhysicsGround(n,e){const t=e.height??sn.HEIGHT,i=Yn.getGroundY(e.worldHeight,t),s=n.add.rectangle(0,i,e.worldWidth,t,e.color??sn.PHYSICS.COLOR,e.alpha??sn.PHYSICS.ALPHA);return s.setOrigin(0,0),n.physics.add.existing(s,!0),{ground:s,groundY:i}},addPlayerCollision(n,e,t){return n.physics.add.collider(e,t)}},nt={GAME:"GameScene",BUILDER:"BuilderScene"};class yc extends N.Scene{player;mapConfig;parallaxLayers=null;loadedBackgrounds=new Set;itemManager;frameManager;dialogZones=[];currentDialogZone=null;unsubscribers=[];initData;constructor(){super({key:nt.GAME})}init(e){this.initData=e}preload(){yt.forEach(e=>{this.load.spritesheet(`cat-idle-${e}`,`assets/sprites/${e}/Idle.png`,{frameWidth:48,frameHeight:48}),this.load.spritesheet(`cat-walk-${e}`,`assets/sprites/${e}/Walk.png`,{frameWidth:48,frameHeight:48})}),hi.preloadAssets(this),Gs.preloadAssets(this)}create(){this.initializeScene()}async initializeScene(){Ui.set(!0);try{await this.loadMapConfiguration();const e=Fn.getCurrentConfig();await this.loadBackgroundIfNeeded(e),this.createParallaxBackground();const{ground:t,groundY:i}=Yn.createPhysicsGround(this,{worldWidth:this.mapConfig.worldWidth,worldHeight:this.mapConfig.worldHeight}),s=dl(this.mapConfig.playerStartY,this.mapConfig.worldHeight);this.player=new _l(this,this.mapConfig.playerStartX,s),Yn.addPlayerCollision(this,this.player,t),this.itemManager=new hi(this,i,this.mapConfig.worldWidth,this.mapConfig.worldHeight,!1),this.mapConfig.placedItems&&this.mapConfig.placedItems.length>0&&this.itemManager.createItems(this.mapConfig.placedItems);const r=this.itemManager.getPhysicsGroup();r&&this.physics.add.collider(this.player,r),this.frameManager=new Gs(this),this.mapConfig.placedFrames&&this.mapConfig.placedFrames.length>0&&this.frameManager.createFrames(this.mapConfig.placedFrames),this.dialogZones=this.mapConfig.dialogZones||[];const a=fs.subscribe(l=>{this.dialogZones=l,this.recheckCurrentZone()});this.unsubscribers.push(a),this.cameras.main.startFollow(this.player,!0,.1,.1),this.cameras.main.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.physics.world.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.scale.on("resize",this.handleResize,this)}catch(e){console.error("[GameScene] Failed to initialize scene:",e)}finally{Ui.set(!1)}}async loadMapConfiguration(){try{if(this.initData?.useBuilderConfig){const e=Yl();this.mapConfig=e||await Ks()}else this.mapConfig=await Ks()}catch(e){console.error("[GameScene] Failed to load map configuration:",e);const t=600;this.mapConfig={worldWidth:3200,worldHeight:t,playerStartX:400,playerStartY:Xn(t),placedItems:[]}}}createParallaxBackground(){const e=Fn.getCurrentConfig();this.parallaxLayers=la(this,this.mapConfig.worldWidth,this.mapConfig.worldHeight,e)}async loadBackgroundIfNeeded(e){if(this.loadedBackgrounds.has(e.folder))return!0;const t=await oa(this,e);return t&&this.loadedBackgrounds.add(e.folder),t}handleResize(e){if(!(!this.cameras?.main||!this.mapConfig)&&(this.cameras.main.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.parallaxLayers?.baseLayer)){const t=Math.max(this.mapConfig.worldHeight,e.height);this.parallaxLayers.baseLayer.setSize(this.mapConfig.worldWidth,t)}}shutdown(){this.scale.off("resize",this.handleResize,this),Mi(null),this.currentDialogZone=null,this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.itemManager&&this.itemManager.destroy()}update(){if(!this.player)return;this.player.update();const e=this.cameras.main,t=this.player.x-e.scrollX,i=this.player.y-e.scrollY;rl(t,i),al(e.scrollX,e.scrollY,e.zoom),this.checkDialogZones(),this.parallaxLayers&&ca(this.parallaxLayers.baseLayer,this.cameras.main)}checkDialogZones(){const e=this.player.x;let t=null;for(const i of this.dialogZones)if(e>=i.x&&e<=i.x+i.width){t=i;break}t?.id!==this.currentDialogZone?.id&&(this.currentDialogZone=t,Mi(t))}recheckCurrentZone(){if(!this.currentDialogZone)return;const e=this.dialogZones.find(t=>t.id===this.currentDialogZone?.id);e&&(this.currentDialogZone=e,Mi(e))}}const Xi=1,Us=.001,wc=.15,Vs=400;class bc{scene;camera;worldWidth;worldHeight;isPanning=!1;panStartX=0;panStartY=0;cameraDragStartX=0;cameraDragStartY=0;isDraggingToScroll=!1;dragScrollStartX=0;dragScrollStartY=0;dragScrollCameraStartX=0;dragScrollCameraStartY=0;currentZoom=1;targetZoom=1;minZoom=.1;isAnimatingReset=!1;zoomTargetWorldPoint=null;pinchStartDistance=0;pinchStartZoom=1;activeTouches=new Map;pinchEndTime=0;isPinching=!1;PINCH_COOLDOWN=150;touchStartTime=0;touchStartPos=null;touchOnSelectedSprite=!1;TAP_MAX_DURATION=200;TAP_MAX_DISTANCE=10;constructor(e,t,i){this.scene=e,this.camera=e.cameras.main,this.worldWidth=t,this.worldHeight=i}setup(){this.calculateMinZoom(),this.setupCamera(),this.setupMouseControls(),this.setupKeyboardControls(),this.setupUpdateLoop()}calculateMinZoom(){const e=this.camera.width/this.worldWidth,t=this.camera.height/this.worldHeight;this.minZoom=Math.min(e,t)}setupCamera(){this.currentZoom=this.minZoom,this.targetZoom=this.minZoom,this.camera.setZoom(this.minZoom);const e=this.camera.width/this.minZoom,t=this.camera.height/this.minZoom,i=Math.min(0,(this.worldWidth-e)/2),s=Math.min(0,(this.worldHeight-t)/2),r=Math.max(this.worldWidth,e),a=Math.max(this.worldHeight,t);this.camera.setBounds(i,s,r,a),this.camera.centerOn(this.worldWidth/2,this.worldHeight/2),Jn(this.minZoom)}centerOn(e,t){this.camera.centerOn(e,t),this.clampScroll()}handleResize(){this.calculateMinZoom(),this.currentZoom<this.minZoom&&(this.currentZoom=this.minZoom,this.targetZoom=this.minZoom,this.camera.setZoom(this.minZoom)),this.targetZoom<this.minZoom&&(this.targetZoom=this.minZoom),this.updateCameraBounds(),this.clampScroll(),Jn(this.currentZoom)}updateCameraBounds(){const e=this.camera.width/this.currentZoom,t=this.camera.height/this.currentZoom,i=Math.min(0,(this.worldWidth-e)/2),s=Math.min(0,(this.worldHeight-t)/2),r=Math.max(this.worldWidth,e),a=Math.max(this.worldHeight,t);this.camera.setBounds(i,s,r,a)}getScrollBounds(e=!0){const t=this.camera.width/this.currentZoom,i=this.camera.height/this.currentZoom;let s,r,a,l;return t>this.worldWidth?e?s=r=(this.worldWidth-t)/2:(s=this.worldWidth-t,r=0):(s=0,r=this.worldWidth-t),i>this.worldHeight?e?a=l=(this.worldHeight-i)/2:(a=this.worldHeight-i,l=0):(a=0,l=this.worldHeight-i),{minX:s,maxX:r,minY:a,maxY:l}}clampScroll(){const e=this.getScrollBounds(!0);this.camera.scrollX=N.Math.Clamp(this.camera.scrollX,e.minX,e.maxX),this.camera.scrollY=N.Math.Clamp(this.camera.scrollY,e.minY,e.maxY)}softClampScroll(){const e=this.getScrollBounds(!1);this.camera.scrollX=N.Math.Clamp(this.camera.scrollX,e.minX,e.maxX),this.camera.scrollY=N.Math.Clamp(this.camera.scrollY,e.minY,e.maxY)}applyPanDelta(e,t,i,s,r,a){const l=this.getScrollBounds(),o=(e-i)/this.currentZoom,c=(t-s)/this.currentZoom;this.camera.scrollX=N.Math.Clamp(r-o,l.minX,l.maxX),this.camera.scrollY=N.Math.Clamp(a-c,l.minY,l.maxY)}zoomToPoint(e,t,i){const s=this.camera.getWorldPoint(e,t);this.zoomToWorldPoint(s.x,s.y,i)}zoomToWorldPoint(e,t,i){const s=this.camera.scrollX,r=this.camera.scrollY,a=this.currentZoom;this.currentZoom=i,this.camera.setZoom(i),this.updateCameraBounds(),this.camera.scrollX=e-(e-s)*a/i,this.camera.scrollY=t-(t-r)*a/i,this.softClampScroll(),Jn(this.currentZoom)}setupMouseControls(){this.scene.input.on("wheel",(e,t,i,s,r)=>{if(this.isAnimatingReset)return;if((e.event.ctrlKey||Math.abs(i)<5&&Math.abs(s)>0)&&!e.event.ctrlKey){const l=-s*Us*3;this.targetZoom=N.Math.Clamp(this.targetZoom+l,this.minZoom,Xi);const o=this.camera.getWorldPoint(e.x,e.y);this.zoomTargetWorldPoint={x:o.x,y:o.y}}else if(e.event.ctrlKey){const l=-s*Us,o=N.Math.Clamp(this.currentZoom+l,this.minZoom,Xi);this.targetZoom=o,this.zoomToPoint(e.x,e.y,o)}else{const l=this.getScrollBounds();this.camera.scrollX=N.Math.Clamp(this.camera.scrollX+i/this.currentZoom,l.minX,l.maxX),this.camera.scrollY=N.Math.Clamp(this.camera.scrollY+s/this.currentZoom,l.minY,l.maxY)}}),this.scene.input.on("pointerdown",e=>{if(e.wasTouch){if(this.activeTouches.set(e.id,{x:e.x,y:e.y}),this.activeTouches.size===2){this.isPinching=!0,this.startPinch(),this.touchStartPos=null,this.touchOnSelectedSprite=!1,this.scene.data.set("touchDraggingSprite",!1);return}this.activeTouches.size===1&&!this.isPinching&&(this.touchStartTime=Date.now(),this.touchStartPos={x:e.x,y:e.y},this.dragScrollStartX=e.x,this.dragScrollStartY=e.y,this.dragScrollCameraStartX=this.camera.scrollX,this.dragScrollCameraStartY=this.camera.scrollY,this.touchOnSelectedSprite=this.isTouchOnSelectedSprite(e.worldX,e.worldY),this.scene.data.set("touchDraggingSprite",!1),this.scene.data.set("touchStartOnSelectedSprite",this.touchOnSelectedSprite),this.scene.data.set("touchStartWorldX",e.worldX),this.scene.data.set("touchStartWorldY",e.worldY));return}jt()||Xs()||this.isAnimatingReset||(e.rightButtonDown()||e.middleButtonDown()?(this.isPanning=!0,this.panStartX=e.x,this.panStartY=e.y,this.cameraDragStartX=this.camera.scrollX,this.cameraDragStartY=this.camera.scrollY):e.leftButtonDown()&&!this.isDraggingObject()&&(this.scene.data.get("isDraggingItem")===!0||(this.dragScrollStartX=e.x,this.dragScrollStartY=e.y,this.dragScrollCameraStartX=this.camera.scrollX,this.dragScrollCameraStartY=this.camera.scrollY)))}),this.scene.input.on("pointermove",e=>{if(e.wasTouch){if(this.activeTouches.has(e.id)&&this.activeTouches.set(e.id,{x:e.x,y:e.y}),this.activeTouches.size>=2&&this.isPinching){this.handlePinch();return}if(this.isPinching||Date.now()-this.pinchEndTime<this.PINCH_COOLDOWN||this.scene.data.get("touchDraggingSprite"))return;if(this.touchStartPos&&!this.isDraggingToScroll){const t=Math.abs(e.x-this.touchStartPos.x),i=Math.abs(e.y-this.touchStartPos.y);if(Math.sqrt(t*t+i*i)>this.TAP_MAX_DISTANCE){if(this.touchOnSelectedSprite){this.scene.data.set("touchDragStarted",!0),this.scene.data.set("touchDraggingSprite",!0),this.touchStartPos=null;return}!jt()&&!this.isDraggingObject()&&!this.scene.data.get("isDraggingItem")&&(this.isDraggingToScroll=!0,this.touchStartPos=null)}}this.isDraggingToScroll&&this.applyPanDelta(e.x,e.y,this.dragScrollStartX,this.dragScrollStartY,this.dragScrollCameraStartX,this.dragScrollCameraStartY);return}if(!(Xs()||this.isAnimatingReset)){if(this.isPanning)this.applyPanDelta(e.x,e.y,this.panStartX,this.panStartY,this.cameraDragStartX,this.cameraDragStartY);else if(e.leftButtonDown()&&!this.isDraggingToScroll&&!this.isDraggingObject()&&!(this.scene.data.get("isDraggingItem")===!0)){const i=Math.abs(e.x-this.dragScrollStartX),s=Math.abs(e.y-this.dragScrollStartY);Math.sqrt(i*i+s*s)>10&&(this.isDraggingToScroll=!0,this.scene.input.setDefaultCursor("grabbing"))}this.isDraggingToScroll&&this.applyPanDelta(e.x,e.y,this.dragScrollStartX,this.dragScrollStartY,this.dragScrollCameraStartX,this.dragScrollCameraStartY)}}),this.scene.input.on("pointerup",e=>{if(e.wasTouch){if(this.isPinching&&(this.pinchEndTime=Date.now(),this.isPinching=!1,Oi(!1)),this.touchStartPos&&!this.isDraggingToScroll){const t=Date.now()-this.touchStartTime,i=Math.abs(e.x-this.touchStartPos.x),s=Math.abs(e.y-this.touchStartPos.y),r=Math.sqrt(i*i+s*s);t<this.TAP_MAX_DURATION&&r<this.TAP_MAX_DISTANCE&&(this.scene.data.set("lastTapTime",Date.now()),this.scene.data.set("lastTapWorldX",e.worldX),this.scene.data.set("lastTapWorldY",e.worldY))}this.touchStartPos=null,this.touchOnSelectedSprite=!1,this.activeTouches.delete(e.id),this.scene.data.set("touchDraggingSprite",!1),this.scene.data.set("touchDragStarted",!1),this.scene.data.set("touchStartOnSelectedSprite",!1),this.isDraggingToScroll&&(this.isDraggingToScroll=!1);return}!e.rightButtonDown()&&!e.middleButtonDown()&&(this.isPanning=!1),this.isDraggingToScroll&&(this.isDraggingToScroll=!1,this.scene.input.setDefaultCursor("default"))}),this.scene.input.on("pointerout",e=>{e.wasTouch&&(this.activeTouches.delete(e.id),this.touchStartPos=null,this.touchOnSelectedSprite=!1,this.isPinching&&this.activeTouches.size<2&&(this.isPinching=!1,this.pinchEndTime=Date.now(),Oi(!1)))})}isTouchOnSelectedSprite(e,t){const i=this.scene.input.activePointer,s=this.scene.input.hitTestPointer(i),r=this.scene.data.get("selectedItemId"),a=this.scene.data.get("selectedFrameId"),l=this.scene.data.get("isPlayerSelected");for(const o of s){if(!(o instanceof N.GameObjects.Sprite))continue;const c=o.getData("itemId");if(c&&c===r)return!0;const u=o.getData("frameId");if(u&&u===a)return!0;const h=this.scene.data.get("playerSprite");if(l&&o===h)return!0}return!1}startPinch(){const e=Array.from(this.activeTouches.values());if(e.length!==2)return;const[t,i]=e;this.pinchStartDistance=Math.hypot(i.x-t.x,i.y-t.y),this.pinchStartZoom=this.currentZoom,Oi(!0)}handlePinch(){const e=Array.from(this.activeTouches.values());if(e.length!==2)return;const[t,i]=e,s=Math.hypot(i.x-t.x,i.y-t.y),r=(t.x+i.x)/2,a=(t.y+i.y)/2,l=s/this.pinchStartDistance,o=N.Math.Clamp(this.pinchStartZoom*l,this.minZoom,Xi);this.targetZoom=o,this.zoomToPoint(r,a,o)}setupKeyboardControls(){const e={up:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.UP,!1),down:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.DOWN,!1),left:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.LEFT,!1),right:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.RIGHT,!1)},t={w:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.W,!1),a:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.A,!1),s:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.S,!1),d:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.D,!1)};this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.SPACE,!1).on("down",()=>{Pn()||this.centerOnPlayer()}),this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.F,!1).on("down",()=>{Pn()||this.resetToFit()}),this.scene.data.set("cameraArrowKeys",e),this.scene.data.set("cameraWasdKeys",t)}setupUpdateLoop(){const e=this.scene.data.get("cameraArrowKeys"),t=this.scene.data.get("cameraWasdKeys");this.scene.events.on("update",()=>{if(!this.isAnimatingReset&&Math.abs(this.currentZoom-this.targetZoom)>1e-4){const r=N.Math.Linear(this.currentZoom,this.targetZoom,wc);this.zoomTargetWorldPoint?this.zoomToWorldPoint(this.zoomTargetWorldPoint.x,this.zoomTargetWorldPoint.y,r):this.zoomToPoint(this.camera.width/2,this.camera.height/2,r),Math.abs(this.currentZoom-this.targetZoom)<.001&&(this.zoomTargetWorldPoint=null)}if(Pn()||this.isAnimatingReset)return;const i=10/this.currentZoom,s=this.getScrollBounds();e?.left?.isDown||t?.a?.isDown?this.camera.scrollX=N.Math.Clamp(this.camera.scrollX-i,s.minX,s.maxX):(e?.right?.isDown||t?.d?.isDown)&&(this.camera.scrollX=N.Math.Clamp(this.camera.scrollX+i,s.minX,s.maxX)),e?.up?.isDown||t?.w?.isDown?this.camera.scrollY=N.Math.Clamp(this.camera.scrollY-i,s.minY,s.maxY):(e?.down?.isDown||t?.s?.isDown)&&(this.camera.scrollY=N.Math.Clamp(this.camera.scrollY+i,s.minY,s.maxY))})}centerOnPlayer(){const e=this.scene.data.get("playerSprite");e&&(this.camera.centerOn(e.x,e.y),this.clampScroll())}isDraggingObject(){return this.scene.data.get("isDraggingObject")===!0||this.scene.data.get("isDraggingItem")===!0}resetToFit(){if(this.isAnimatingReset)return;this.isAnimatingReset=!0,this.targetZoom=this.minZoom;const e=this.camera.width/this.minZoom,t=this.camera.height/this.minZoom,i=(this.worldWidth-e)/2,s=(this.worldHeight-t)/2,r=i+e/2,a=s+t/2;this.camera.pan(r,a,Vs,"Sine.easeInOut"),this.camera.zoomTo(this.minZoom,Vs,"Sine.easeInOut",!1,(l,o)=>{o===1&&(this.currentZoom=this.minZoom,this.camera.scrollX=i,this.camera.scrollY=s,this.isAnimatingReset=!1,Jn(this.minZoom))})}destroy(){this.activeTouches.clear()}}const Sc=16729156;class xc{scene;player;worldWidth;worldHeight;unsubscribers=[];interactionCleanup=null;constructor(e,t,i){this.scene=e,this.worldWidth=t,this.worldHeight=i}create(e,t){const i=Math.min(t,Xn(this.worldHeight));return this.player=this.scene.add.sprite(e,i,"cat-idle-white",0),this.player.setScale(_n.SCALE),this.player.setDepth(_n.DEPTH),this.player.setData("isPlayer",!0),this.scene.data.set("playerSprite",this.player),this.setupInteraction(),this.setupEditModeSubscription(),this.setupSelectionSubscription(),this.player}setupInteraction(){const e=new N.Geom.Rectangle(8,4,32,40);this.interactionCleanup=Ss({sprite:this.player,scene:this.scene,useGridSnapping:!1,cursor:"grab",hitArea:e,constraints:{minX:Bs,maxX:this.worldWidth-Bs,minY:nc},callbacks:{onSelect:()=>{Ll(!0)},isSelected:()=>tt($i),onDragStart:()=>{this.player.setTint(Ea),this.scene.data.set("isDraggingObject",!0)},onDrag:(t,i)=>{Zs(Math.round(t),Math.round(i))},onDragEnd:(t,i)=>{this.updateSelectionVisual(tt($i)),this.scene.data.set("isDraggingObject",!1);let s=this.player.y;ul(this.player.y,this.worldHeight)&&(s=Xn(this.worldHeight),this.player.setY(s)),Zs(Math.round(this.player.x),Math.round(s))}}})}setupSelectionSubscription(){const e=$i.subscribe(t=>{this.updateSelectionVisual(t),this.scene.data.set("isPlayerSelected",t)});this.unsubscribers.push(e)}updateSelectionVisual(e){this.player&&(e?this.player.setTint(Sc):this.player.clearTint())}setupEditModeSubscription(){const e=Je.subscribe(t=>{t==="dialogs"?(this.interactionCleanup&&(this.interactionCleanup(),this.interactionCleanup=null),this.player.disableInteractive(),this.player.setAlpha(.6)):(this.player.setAlpha(1),this.interactionCleanup||this.setupInteraction())});this.unsubscribers.push(e)}getSprite(){return this.player}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.interactionCleanup&&(this.interactionCleanup(),this.interactionCleanup=null),this.player&&this.player.destroy()}}class Ec{scene;graphics;worldWidth;worldHeight;constructor(e,t,i){this.scene=e,this.worldWidth=t,this.worldHeight=i}create(){return this.graphics=this.scene.add.graphics(),this.graphics.setDepth(xa),this.draw(),this.graphics}draw(){this.graphics.clear(),this.graphics.lineStyle(jl,Ul,Vl);const e=Math.max(this.worldHeight,this.scene.scale.height);for(let i=0;i<=this.worldWidth;i+=dn)this.graphics.beginPath(),this.graphics.moveTo(i,0),this.graphics.lineTo(i,e),this.graphics.strokePath();for(let i=0;i<=e;i+=dn)this.graphics.beginPath(),this.graphics.moveTo(0,i),this.graphics.lineTo(this.worldWidth,i),this.graphics.strokePath();const t=this.worldHeight-yn;this.graphics.lineStyle(ql,Hi,Jl),this.graphics.beginPath(),this.graphics.moveTo(0,t),this.graphics.lineTo(this.worldWidth,t),this.graphics.strokePath(),this.graphics.lineStyle(ec,Hi,tc),this.graphics.fillStyle(Hi,Ql),this.graphics.fillRect(0,t,this.worldWidth,e-t)}getGraphics(){return this.graphics}redraw(){this.draw()}destroy(){this.graphics&&this.graphics.destroy()}}class Ic{listeners=new Map;on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set);const i=this.listeners.get(e);return i.add(t),{unsubscribe:()=>{i.delete(t),i.size===0&&this.listeners.delete(e)}}}once(e,t){const i=this.on(e,s=>{i.unsubscribe(),t(s)});return i}emit(e,t){const i=this.listeners.get(e);i&&i.forEach(s=>{try{s(t)}catch(r){console.error(`[EventBus] Error in listener for "${e}":`,r)}})}off(e){this.listeners.delete(e)}clear(){this.listeners.clear()}listenerCount(e){return this.listeners.get(e)?.size??0}}const Le=new Ic,Me={ASSET_DROPPED:"asset:dropped",FRAME_DROPPED:"frame:dropped",MINIMAP_NAVIGATE:"minimap:navigate",DIALOG_ZONE_CREATE:"dialogZone:create",DIALOG_ZONE_CREATE_AT:"dialogZone:createAt",TEMP_ZONE_BUTTON_SHOW:"tempZoneButton:show",TEMP_ZONE_BUTTON_HIDE:"tempZoneButton:hide"};class Tc{scene;groundY;worldWidth;worldHeight;itemManager;unsubscribers=[];constructor(e,t,i,s){this.scene=e,this.groundY=t,this.worldWidth=i,this.worldHeight=s}create(e){return this.itemManager=new hi(this.scene,this.groundY,this.worldWidth,this.worldHeight,!0),e&&e.length>0&&this.itemManager.createItems(e),this.setupBackgroundDeselect(),this.setupStoreSubscriptions(),this.setupAssetDropListener(),this.setupDeleteKeys(),this.itemManager}setupBackgroundDeselect(){this.itemManager.setupBackgroundDeselect()}setupStoreSubscriptions(){const e=Si.subscribe(r=>{this.scene.data.set("selectedItemId",r),this.itemManager.updateSelectionVisuals()});this.unsubscribers.push(e);const t=Je.subscribe(r=>{r==="dialogs"?(vs(),this.itemManager.setInteractiveEnabled(!1)):this.itemManager.setInteractiveEnabled(!0)});this.unsubscribers.push(t);let i=[];const s=xl.subscribe(r=>{if(!r?.placedItems)return;const a=r.placedItems;i.forEach(l=>{a.find(c=>c.id===l.id)||this.itemManager.removeItem(l.id)}),a.forEach(l=>{const o=i.find(c=>c.id===l.id);o&&JSON.stringify(o)!==JSON.stringify(l)&&this.itemManager.updateItem(l.id,l)}),i=a.map(l=>({...l}))});this.unsubscribers.push(s)}setupAssetDropListener(){const e=Le.on(Me.ASSET_DROPPED,t=>{const{assetKey:i,canvasX:s,canvasY:r}=t,l=this.scene.cameras.main.getWorldPoint(s,r),o=Math.max(0,Math.min(this.worldWidth,l.x)),c=Math.max(0,Math.min(this.worldHeight,l.y));let u="behind";fa.subscribe(g=>{u=g})();const f=ii.createAtWorldPosition(i,o,c,this.groundY,u);$l(f),this.itemManager.createItem(f),wa(f.id),zt.set(!1)});this.unsubscribers.push(()=>e.unsubscribe())}setupDeleteKeys(){const e=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.DELETE,!1),t=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.BACKSPACE,!1),i=()=>{if(Pn())return;const s=this.scene.data.get("selectedItemId");s&&ya(s)};e.on("down",i),t.on("down",i)}getManager(){return this.itemManager}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.itemManager&&this.itemManager.destroy()}}class js{scene;worldWidth;worldHeight;frames=new Map;unsubscribers=[];selectionGraphics=null;cleanupFunctions=new Map;doubleClickDetector=new ic;constructor(e,t,i){this.scene=e,this.worldWidth=t,this.worldHeight=i}static preloadAssets(e){for(let t=1;t<=25;t++)e.load.image(`frame_base_${t}`,`assets/frames/base ${t}.png`)}create(e){this.selectionGraphics=this.scene.add.graphics(),this.selectionGraphics.setDepth(qe.SELECTION_GRAPHICS),e&&e.length>0&&e.forEach(t=>this.createFrame(t)),this.setupStoreSubscriptions(),this.setupFrameDropListener(),this.setupDeleteKeys()}createFrame(e){const t=`frame_${e.frameKey}`;if(!this.scene.textures.exists(t)){console.warn(`Frame texture not found: ${t}`);return}const i=e.scale??Et,s=e.depth??qe.ITEMS_FRONT,r=(e.rotation??0)*(Math.PI/180),a=e.rotation===90,{innerWidth:l,innerHeight:o}=On(i,a),c=this.scene.add.graphics();c.setDepth(s-.1),ni(c,e.x,e.y,l,o,e.backgroundColor||Cn);const u=this.scene.add.sprite(e.x,e.y,t);u.setScale(i),u.setDepth(s),u.setOrigin(.5,.5),u.setRotation(r),u.setData("frameId",e.id);const h={sprite:u,background:c,data:e};this.frames.set(e.id,h),this.makeInteractive(h,e.id)}updateFrameVisuals(e){const{sprite:t,background:i,data:s}=e,r=`frame_${s.frameKey}`;t.texture.key!==r&&this.scene.textures.exists(r)&&t.setTexture(r);const a=s.scale??Et;t.setScale(a);const l=(s.rotation??0)*(Math.PI/180);t.setRotation(l);const o=s.rotation===90,{innerWidth:c,innerHeight:u}=On(a,o);ni(i,t.x,t.y,c,u,s.backgroundColor||Cn)}moveContainer(e,t,i){const{sprite:s,background:r,data:a}=e;s.setPosition(t,i);const l=a.scale??Et,o=a.rotation===90,{innerWidth:c,innerHeight:u}=On(l,o);ni(r,t,i,c,u,a.backgroundColor||Cn)}makeInteractive(e,t){const{sprite:i}=e,s=Ss({sprite:i,scene:this.scene,cursor:"grab",useGridSnapping:!0,constraints:{minX:0,maxX:this.worldWidth,minY:0,maxY:this.worldHeight},callbacks:{onSelect:()=>{kn(t),this.updateSelectionVisuals()},isSelected:()=>tt(Nn)===t,onDoubleClick:()=>this.doubleClickDetector.check(t)?(ha(),!0):!1,onDragStart:()=>{i.setTint(Ea)},onDrag:(r,a)=>{this.moveContainer(e,r,a),this.updateSelectionVisuals(),Al(t,r,a)},onDragEnd:(r,a)=>{i.clearTint(),Pl(t),e.data.x=Math.round(r),e.data.y=Math.round(a),wt(t,{x:e.data.x,y:e.data.y})}}});this.cleanupFunctions.set(t,s)}setupStoreSubscriptions(){const e=Nn.subscribe(r=>{this.scene.data.set("selectedFrameId",r),this.updateSelectionVisuals()});this.unsubscribers.push(e);const t=Je.subscribe(r=>{r==="dialogs"?(kn(null),this.setInteractiveEnabled(!1)):this.setInteractiveEnabled(!0)});this.unsubscribers.push(t);let i=[];const s=ga.subscribe(r=>{i.forEach(a=>{r.find(o=>o.id===a.id)||this.removeFrame(a.id)}),r.forEach(a=>{const l=i.find(c=>c.id===a.id),o=this.frames.get(a.id);if(o&&l){const c=l.backgroundColor!==a.backgroundColor,u=l.textColor!==a.textColor,h=l.textSize!==a.textSize,f=JSON.stringify(l.texts)!==JSON.stringify(a.texts),g=l.rotation!==a.rotation,w=l.scale!==a.scale,S=l.frameKey!==a.frameKey;o.data=a,(c||u||h||f||g||w||S)&&(this.updateFrameVisuals(o),this.scene.data.get("selectedFrameId")===a.id&&this.updateSelectionVisuals())}}),i=r.map(a=>({...a}))});this.unsubscribers.push(s)}setupFrameDropListener(){const e=Le.on(Me.FRAME_DROPPED,t=>{const{frameKey:i,canvasX:s,canvasY:r}=t,l=this.scene.cameras.main.getWorldPoint(s,r),o=Math.max(0,Math.min(this.worldWidth,l.x)),c=Math.max(0,Math.min(this.worldHeight,l.y)),u={id:lc(),frameKey:i,x:Math.round(o),y:Math.round(c),scale:_c(i),depth:qe.ITEMS_FRONT,rotation:90,backgroundColor:Cn,textColor:"#333333",textSize:16,texts:[{language:"cs",text:""},{language:"en",text:""}]};zl(u),this.createFrame(u),kn(u.id)});this.unsubscribers.push(()=>e.unsubscribe())}setupDeleteKeys(){const e=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.DELETE,!1),t=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.BACKSPACE,!1),i=()=>{if(Pn())return;let s="items";if(Je.subscribe(l=>s=l)(),s!=="frames")return;const a=this.scene.data.get("selectedFrameId");a&&ws(a)};e.on("down",i),t.on("down",i)}updateSelectionVisuals(){if(!this.selectionGraphics)return;this.selectionGraphics.clear();const e=this.scene.data.get("selectedFrameId");if(!e){Ri(null);return}const t=this.frames.get(e);if(!t){Ri(null);return}const i=t.sprite,s=i.getBounds(),r=this.scene.cameras.main,{screenX:a,screenY:l}=cn(i.x,i.y,r);Ri({screenX:a,screenY:l,frameHeight:s.height*r.zoom}),this.selectionGraphics.lineStyle(3,10181046,1),this.selectionGraphics.strokeRect(s.x-4,s.y-4,s.width+8,s.height+8);const o=8;this.selectionGraphics.fillStyle(10181046,1),this.selectionGraphics.fillRect(s.x-4-o/2,s.y-4-o/2,o,o),this.selectionGraphics.fillRect(s.right+4-o/2,s.y-4-o/2,o,o),this.selectionGraphics.fillRect(s.x-4-o/2,s.bottom+4-o/2,o,o),this.selectionGraphics.fillRect(s.right+4-o/2,s.bottom+4-o/2,o,o)}removeFrame(e){const t=this.frames.get(e);t&&(t.sprite.destroy(),t.background.destroy(),this.frames.delete(e)),this.updateSelectionVisuals()}setInteractiveEnabled(e){this.frames.forEach(({sprite:t,background:i})=>{e?(t.setInteractive(),t.setAlpha(1),i.setAlpha(1)):(t.disableInteractive(),t.setAlpha(.6),i.setAlpha(.6))}),!e&&this.selectionGraphics&&this.selectionGraphics.clear()}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.frames.forEach(({sprite:e,background:t})=>{e.destroy(),t.destroy()}),this.frames.clear(),this.selectionGraphics&&(this.selectionGraphics.destroy(),this.selectionGraphics=null)}}const Pt=xa-1,Mt=300,qs=150,Cc=.3,Dc=.5,Fi=40,Js=60,Qs=16777215,er=.6,tr=0,ot=60,nr=8;class Ac{scene;worldWidth;worldHeight;graphics=null;zoneAreas=new Map;leftHandles=new Map;leftHandleVisuals=new Map;rightHandles=new Map;rightHandleVisuals=new Map;arrowGraphics=new Map;dragging=null;unsubscribers=[];createZoneSubscription;currentEditMode="items";currentZones=[];currentSelectedId=null;lastClickTime=0;lastClickX=0;DOUBLE_CLICK_THRESHOLD=300;DOUBLE_CLICK_DISTANCE=20;pendingTap=null;TAP_MAX_DURATION=300;TAP_MAX_DISTANCE=15;pendingZoneSelection=null;createZoneAtSubscription;boundWindowPointerUp=()=>{};boundWindowPointerMove=()=>{};currentScreenX=0;autoScrollTimer=null;constructor(e,t,i){this.scene=e,this.worldWidth=t,this.worldHeight=i}create(){this.graphics=this.scene.add.graphics(),this.graphics.setDepth(Pt);const e=Je.subscribe(s=>{this.currentEditMode=s,this.render()});this.unsubscribers.push(e);const t=fs.subscribe(s=>{this.currentZones=s,this.render()});this.unsubscribers.push(t);const i=xi.subscribe(s=>{this.currentSelectedId=s,this.render()});this.unsubscribers.push(i),this.scene.input.on("pointermove",this.handlePointerMove,this),this.scene.input.on("pointerup",this.handlePointerUp,this),this.boundWindowPointerUp=this.handlePointerUp.bind(this),this.boundWindowPointerMove=this.handleWindowPointerMove.bind(this),window.addEventListener("pointerup",this.boundWindowPointerUp),window.addEventListener("pointermove",this.boundWindowPointerMove),this.scene.input.on("pointerdown",this.handlePointerDown,this),this.createZoneSubscription=Le.on(Me.DIALOG_ZONE_CREATE,()=>{this.createNewZone()}),this.createZoneAtSubscription=Le.on(Me.DIALOG_ZONE_CREATE_AT,s=>{this.createZoneAtPosition(s.worldX)}),this.render()}clearVisuals(){this.graphics&&this.graphics.clear(),this.zoneAreas.forEach(e=>e.destroy()),this.zoneAreas.clear(),this.leftHandles.forEach(e=>e.destroy()),this.leftHandles.clear(),this.rightHandles.forEach(e=>e.destroy()),this.rightHandles.clear(),this.leftHandleVisuals.forEach(e=>e.destroy()),this.leftHandleVisuals.clear(),this.rightHandleVisuals.forEach(e=>e.destroy()),this.rightHandleVisuals.clear(),this.arrowGraphics.forEach(e=>e.destroy()),this.arrowGraphics.clear()}render(){if(this.clearVisuals(),this.currentEditMode==="dialogs")for(const e of this.currentZones)this.renderZone(e,e.id===this.currentSelectedId)}renderZone(e,t){if(!this.graphics)return;const i=N.Display.Color.HexStringToColor(e.color).color,s=t?Dc:Cc;this.graphics.fillStyle(i,s),this.graphics.fillRect(e.x,0,e.width,this.worldHeight),this.graphics.lineStyle(2,i,.8),this.graphics.strokeRect(e.x,0,e.width,this.worldHeight);const r=this.scene.add.rectangle(e.x+e.width/2,this.worldHeight/2,e.width-Fi*2,this.worldHeight);r.setOrigin(.5,.5),r.setInteractive({cursor:t?"grab":"pointer"}),r.setDepth(Pt+.1),r.setAlpha(.001),r.setData("zoneId",e.id),r.on("pointerdown",a=>{if(this.isClickOnUIElement(a))return;const l=Date.now(),o=l-this.lastClickTime<this.DOUBLE_CLICK_THRESHOLD&&Math.abs(a.worldX-this.lastClickX)<this.DOUBLE_CLICK_DISTANCE;this.lastClickTime=l,this.lastClickX=a.worldX;const c=this.currentSelectedId===e.id;if(o&&c){_a();return}c?(this.scene.data.set("isDraggingItem",!0),hn(!0),this.startDrag(e.id,"move",a.worldX)):this.pendingZoneSelection={zoneId:e.id,worldX:a.worldX,startTime:l}}),this.zoneAreas.set(e.id,r),t&&this.createHandles(e)}createHandles(e){const t=this.scene.cameras.main.scrollY,i=this.scene.cameras.main.height,s=t+i/2,r=this.scene.add.rectangle(e.x,this.worldHeight/2,Fi,this.worldHeight);r.setOrigin(.5,.5),r.setDepth(Pt+.2),r.setFillStyle(Qs,er);const a=this.scene.add.rectangle(e.x,this.worldHeight/2,Js,this.worldHeight);a.setOrigin(.5,.5),a.setInteractive({cursor:"ew-resize"}),a.setDepth(Pt+.25),a.setAlpha(.001),a.setData("zoneId",e.id),a.setData("type","left"),a.on("pointerdown",f=>{this.isClickOnUIElement(f)||this.startDrag(e.id,"left",f.worldX)}),this.leftHandles.set(e.id,a),this.leftHandleVisuals.set(e.id,r);const l=8,o=this.scene.add.graphics();o.setDepth(Pt+.3),this.drawArrow(o,e.x-l,s,"left"),this.arrowGraphics.set(`${e.id}_left`,o);const c=this.scene.add.rectangle(e.x+e.width,this.worldHeight/2,Fi,this.worldHeight);c.setOrigin(.5,.5),c.setDepth(Pt+.2),c.setFillStyle(Qs,er);const u=this.scene.add.rectangle(e.x+e.width,this.worldHeight/2,Js,this.worldHeight);u.setOrigin(.5,.5),u.setInteractive({cursor:"ew-resize"}),u.setDepth(Pt+.25),u.setAlpha(.001),u.setData("zoneId",e.id),u.setData("type","right"),u.on("pointerdown",f=>{this.isClickOnUIElement(f)||this.startDrag(e.id,"right",f.worldX)}),this.rightHandles.set(e.id,u),this.rightHandleVisuals.set(e.id,c);const h=this.scene.add.graphics();h.setDepth(Pt+.3),this.drawArrow(h,e.x+e.width+l,s,"right"),this.arrowGraphics.set(`${e.id}_right`,h)}drawArrow(e,t,i,s){const a=s==="left"?-1:1;e.fillStyle(3355443,.8),e.beginPath(),e.moveTo(t+a*10+1,i),e.lineTo(t-a*10+1,i-10+1),e.lineTo(t-a*10+1,i+10-1),e.closePath(),e.fillPath(),e.fillStyle(16777215,.9),e.beginPath(),e.moveTo(t+a*10,i),e.lineTo(t-a*10,i-10),e.lineTo(t-a*10,i+10),e.closePath(),e.fillPath()}startDrag(e,t,i){const s=this.currentZones.find(r=>r.id===e);s&&(this.scene.data.set("isDraggingItem",!0),hn(!0),this.dragging={zoneId:e,type:t,startX:i,originalX:s.x,originalWidth:s.width})}getZoneBounds(e){let t=0,i=this.worldWidth;for(const s of this.currentZones){if(s.id===e)continue;const r=s.x+s.width,a=this.currentZones.find(l=>l.id===e);a&&(r<=a.x+a.width/2&&(t=Math.max(t,r+tr)),s.x>=a.x+a.width/2&&(i=Math.min(i,s.x-tr)))}return{minX:t,maxX:i-Mt,maxRight:i}}wouldOverlap(e,t,i){const s=t+i;for(const r of this.currentZones){if(r.id===e)continue;const a=r.x,l=r.x+r.width;if(t<l&&s>a)return!0}return!1}isClickOnUIElement(e){const t=e.downElement;return t?t.tagName?.toUpperCase()!=="CANVAS":!1}cancelPendingIfMoved(e){this.pendingTap&&Math.abs(e-this.pendingTap.worldX)>this.TAP_MAX_DISTANCE&&(this.pendingTap=null),this.pendingZoneSelection&&Math.abs(e-this.pendingZoneSelection.worldX)>this.TAP_MAX_DISTANCE&&(this.pendingZoneSelection=null)}screenToWorld(e,t){const i=this.scene.cameras.main,r=this.scene.game.canvas.getBoundingClientRect(),a=e-r.left,l=t-r.top;return ml(a,l,i)}handleWindowPointerMove(e){const t=this.screenToWorld(e.clientX,e.clientY);if(this.cancelPendingIfMoved(t.worldX),!this.dragging)return;const s=this.scene.game.canvas.getBoundingClientRect();e.clientX>=s.left&&e.clientX<=s.right&&e.clientY>=s.top&&e.clientY<=s.bottom||(this.currentScreenX=e.clientX-s.left,this.updateDrag(t.worldX),this.checkAutoScroll())}handlePointerMove(e){this.cancelPendingIfMoved(e.worldX),this.dragging&&(this.currentScreenX=e.x,e.event?.stopPropagation?.(),this.updateDrag(e.worldX),this.checkAutoScroll())}checkAutoScroll(){if(!this.dragging||this.dragging.type!=="move"){this.stopAutoScroll();return}const e=this.scene.cameras.main,t=e.width,i=this.currentZones.find(b=>b.id===this.dragging?.zoneId);if(!i)return;const s=Math.max(0,this.worldWidth-e.width/e.zoom);if(s<=0){this.stopAutoScroll();return}const{screenX:r}=cn(i.x,0,e),{screenX:a}=cn(i.x+i.width,0,e),l=r<=ot,o=a>=t-ot,c=e.scrollX>0,u=e.scrollX<s,h=i.x>0,f=i.x+i.width<this.worldWidth,g=this.currentScreenX<ot,w=this.currentScreenX>t-ot,m=l&&g&&c&&h||o&&w&&u&&f;m&&!this.autoScrollTimer?this.autoScrollTimer=this.scene.time.addEvent({delay:16,callback:this.performAutoScroll,callbackScope:this,loop:!0}):!m&&this.autoScrollTimer&&this.stopAutoScroll()}performAutoScroll(){if(!this.dragging||this.dragging.type!=="move"){this.stopAutoScroll();return}const e=this.scene.cameras.main,t=e.width,i=this.currentZones.find(v=>v.id===this.dragging?.zoneId);if(!i)return;let s=0;if(this.currentScreenX<ot){if(i.x<=0){this.stopAutoScroll();return}const m=(ot-this.currentScreenX)/ot;s=-nr*m}else if(this.currentScreenX>t-ot){if(i.x+i.width>=this.worldWidth){this.stopAutoScroll();return}const m=(this.currentScreenX-(t-ot))/ot;s=nr*m}if(s===0)return;const r=e.scrollX+s,a=0,l=Math.max(0,this.worldWidth-e.width/e.zoom),c=Math.max(a,Math.min(l,r))-e.scrollX;if(l<=0){this.stopAutoScroll();return}if(c===0){this.stopAutoScroll();return}const u=i.x+c,h=Math.max(0,Math.min(this.worldWidth-i.width,u)),f=h-i.x;if(f===0){this.stopAutoScroll();return}const g=e.scrollX+f,w=Math.max(0,Math.min(l,g));if(Math.abs(w-e.scrollX)>Math.abs(f)*2){this.stopAutoScroll();return}e.scrollX=w,this.wouldOverlap(i.id,h,i.width)||(an(i.id,{x:h}),this.dragging.originalX+=f,this.dragging.startX+=f)}stopAutoScroll(){this.autoScrollTimer&&(this.autoScrollTimer.destroy(),this.autoScrollTimer=null)}updateDrag(e){if(!this.dragging)return;const t=e-this.dragging.startX,i=this.currentZones.find(r=>r.id===this.dragging?.zoneId);if(!i)return;const s=this.getZoneBounds(i.id);if(this.dragging.type==="left"){let r=this.dragging.originalX+t,a=this.dragging.originalWidth-t;if(r<0&&(a+=r,r=0),a<Mt&&(r=this.dragging.originalX+this.dragging.originalWidth-Mt,a=Mt),r<s.minX){const l=s.minX-r;r=s.minX,a-=l}a>=Mt&&!this.wouldOverlap(i.id,r,a)&&an(i.id,{x:r,width:a})}else if(this.dragging.type==="right"){let r=this.dragging.originalWidth+t;r<Mt&&(r=Mt),i.x+r>this.worldWidth&&(r=this.worldWidth-i.x),i.x+r>s.maxRight&&(r=s.maxRight-i.x),r>=Mt&&!this.wouldOverlap(i.id,i.x,r)&&an(i.id,{width:r})}else if(this.dragging.type==="move"){let r=this.dragging.originalX+t;const a=i.width;if(r<0&&(r=0),r+a>this.worldWidth&&(r=this.worldWidth-a),!this.wouldOverlap(i.id,r,a))an(i.id,{x:r});else{const l=this.findNonOverlappingPosition(i.id,r,a);l!==null&&an(i.id,{x:l})}}}findNonOverlappingPosition(e,t,i){const s=this.currentZones.filter(u=>u.id!==e).sort((u,h)=>u.x-h.x);if(s.length===0)return Math.max(0,Math.min(t,this.worldWidth-i));let r=t,a=1/0;const l=s[0];if(l.x>=i){const u=l.x-i,h=Math.max(0,Math.min(t,u)),f=Math.abs(h-t);f<a&&(a=f,r=h)}for(let u=0;u<s.length-1;u++){const h=s[u],f=s[u+1],g=h.x+h.width,w=f.x;if(w-g>=i){const v=g,m=w-i,b=Math.max(v,Math.min(t,m)),_=Math.abs(b-t);_<a&&(a=_,r=b)}}const o=s[s.length-1],c=o.x+o.width;if(this.worldWidth-c>=i){const u=c,h=this.worldWidth-i,f=Math.max(u,Math.min(t,h)),g=Math.abs(f-t);g<a&&(a=g,r=f)}return a<1/0&&!this.wouldOverlap(e,r,i)?r:null}handlePointerUp(e){if(this.dragging&&(this.stopAutoScroll(),this.scene.data.set("isDraggingItem",!1),hn(!1),this.dragging=null),this.pendingZoneSelection){let s=Date.now()-this.pendingZoneSelection.startTime<this.TAP_MAX_DURATION;s&&e&&e.worldX!==void 0&&(s=Math.abs(e.worldX-this.pendingZoneSelection.worldX)<this.TAP_MAX_DISTANCE),s&&Mn(this.pendingZoneSelection.zoneId),this.pendingZoneSelection=null}if(this.pendingTap&&this.currentEditMode==="dialogs"){if(Date.now()-this.pendingTap.startTime<this.TAP_MAX_DURATION){let s=!0;e&&e.worldX!==void 0&&(s=Math.abs(e.worldX-this.pendingTap.worldX)<this.TAP_MAX_DISTANCE),s&&this.showTempAddButton(this.pendingTap.worldX,this.pendingTap.worldY)}this.pendingTap=null}}handlePointerDown(e){if(jt()||this.currentEditMode!=="dialogs"||this.dragging)return;const t=e.downElement;if(t&&t.tagName?.toUpperCase()!=="CANVAS")return;const i=e.worldX;for(const l of this.currentZones)if(i>=l.x&&i<=l.x+l.width)return;const s=Date.now(),r=s-this.lastClickTime,a=Math.abs(i-this.lastClickX);if(r<this.DOUBLE_CLICK_THRESHOLD&&a<this.DOUBLE_CLICK_DISTANCE){this.createZoneAtPosition(i),this.lastClickTime=0,this.hideTempAddButton();return}this.lastClickTime=s,this.lastClickX=i,this.pendingTap={worldX:i,worldY:e.worldY,startTime:s},this.currentSelectedId&&Mn(null)}showTempAddButton(e,t){const i=this.scene.cameras.main,{screenX:s,screenY:r}=cn(e,t,i);Le.emit(Me.TEMP_ZONE_BUTTON_SHOW,{screenX:s,screenY:r,worldX:e})}hideTempAddButton(){Le.emit(Me.TEMP_ZONE_BUTTON_HIDE,{})}createZoneAtPosition(e){this.createZoneAt(e)}createNewZone(){const e=this.scene.cameras.main,t=e.worldView.x+e.worldView.width/2;this.createZoneAt(t)}createZoneAt(e){let t=e-qs/2;const i=qs;if(t=Math.max(0,Math.min(this.worldWidth-i,t)),this.wouldOverlap("",t,i)){const r=this.findNonOverlappingPosition("",t,i);if(r===null){console.warn("No room for a new dialog zone");return}t=r}const s=tl(t,i);s.x=t,Bl(s),Mn(s.id)}updateSelectionVisuals(){if(this.currentEditMode!=="dialogs"){qn(null);return}if(!this.currentSelectedId){qn(null);return}const e=this.currentZones.find(a=>a.id===this.currentSelectedId);if(!e){qn(null);return}const t=this.scene.cameras.main,i=e.x+e.width/2,{screenX:s}=cn(i,0,t),r=t.height*.65;qn({screenX:s,screenY:r})}destroy(){this.hideTempAddButton();for(const e of this.unsubscribers)e();this.unsubscribers=[],this.createZoneSubscription&&this.createZoneSubscription.unsubscribe(),this.createZoneAtSubscription&&this.createZoneAtSubscription.unsubscribe(),this.stopAutoScroll(),this.scene.input.off("pointerdown",this.handlePointerDown,this),this.scene.input.off("pointermove",this.handlePointerMove,this),this.scene.input.off("pointerup",this.handlePointerUp,this),window.removeEventListener("pointerup",this.boundWindowPointerUp),window.removeEventListener("pointermove",this.boundWindowPointerMove),this.clearVisuals(),this.graphics&&(this.graphics.destroy(),this.graphics=null),this.dragging=null}}class Pc extends N.Scene{parallaxLayers=null;cameraController;playerController;gridOverlay;itemsController;framesController;dialogZoneRenderer;config;minimapSubscription;isShuttingDown=!1;get itemManager(){return this.itemsController?.getManager()}resetZoom(){this.cameraController?.resetToFit()}constructor(){super({key:nt.BUILDER})}init(e){this.config=e.config}preload(){this.load.spritesheet("cat-idle-white","assets/sprites/white/Idle.png",{frameWidth:48,frameHeight:48}),hi.preloadAssets(this),js.preloadAssets(this)}create(){this.isShuttingDown=!1,this.physics.world.setBounds(0,0,this.config.worldWidth,this.config.worldHeight);const e=this.config.worldHeight-yn;this.cameraController=new bc(this,this.config.worldWidth,this.config.worldHeight),this.playerController=new xc(this,this.config.worldWidth,this.config.worldHeight),this.gridOverlay=new Ec(this,this.config.worldWidth,this.config.worldHeight),this.itemsController=new Tc(this,e,this.config.worldWidth,this.config.worldHeight),this.framesController=new js(this,this.config.worldWidth,this.config.worldHeight),this.dialogZoneRenderer=new Ac(this,this.config.worldWidth,this.config.worldHeight),this.createBackground(),this.gridOverlay.create(),this.createGroundReference(),this.playerController.create(this.config.playerStartX,this.config.playerStartY),this.itemsController.create(this.config.placedItems||[]),this.framesController.create(this.config.placedFrames||[]),this.dialogZoneRenderer.create(),this.cameraController.setup(),this.cameraController.centerOn(this.config.playerStartX,this.config.playerStartY),this.minimapSubscription=Le.on(Me.MINIMAP_NAVIGATE,t=>{this.navigateToPosition(t.worldX,t.worldY)}),this.scale.on("resize",this.handleResize,this),this.events.on("shutdown",this.shutdown,this)}async createBackground(){const e=Fn.getCurrentConfig();try{await oa(this,e)}catch(t){console.error("Failed to load background:",t);return}this.parallaxLayers&&(wl(this.parallaxLayers),this.parallaxLayers=null),this.parallaxLayers=la(this,this.config.worldWidth,this.config.worldHeight,e)}createGroundReference(){Yn.createVisualGround(this,{worldWidth:this.config.worldWidth,worldHeight:this.config.worldHeight,height:yn})}update(){this.parallaxLayers&&ca(this.parallaxLayers.baseLayer,this.cameras.main),this.itemManager?.updateSelectionVisuals(),this.framesController?.updateSelectionVisuals(),this.dialogZoneRenderer?.updateSelectionVisuals();const e=this.cameras.main,t=this.data.get("playerSprite");Wl({scrollX:e.worldView.x,scrollY:e.worldView.y,viewWidth:e.width,viewHeight:e.height,worldWidth:this.config.worldWidth,worldHeight:this.config.worldHeight,zoom:e.zoom,playerX:t?.x??this.config.playerStartX,playerY:t?.y??this.config.playerStartY})}navigateToPosition(e,t){this.cameraController.centerOn(e,t)}handleResize(e){if(!(!this.cameras?.main||!this.config)){if(this.cameraController?.handleResize(),this.parallaxLayers?.baseLayer){const t=Math.max(this.config.worldHeight,e.height);this.parallaxLayers.baseLayer.setSize(this.config.worldWidth,t)}this.gridOverlay&&this.gridOverlay.redraw()}}shutdown(){this.isShuttingDown||(this.isShuttingDown=!0,this.scale.off("resize",this.handleResize,this),this.minimapSubscription&&this.minimapSubscription.unsubscribe(),this.cameraController&&this.cameraController.destroy(),this.playerController&&this.playerController.destroy(),this.gridOverlay&&this.gridOverlay.destroy(),this.itemsController&&this.itemsController.destroy(),this.framesController&&this.framesController.destroy(),this.dialogZoneRenderer&&this.dialogZoneRenderer.destroy())}}const Mc="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Mc);Ja();class kc{currentLanguage="cs";setLanguage(e){this.currentLanguage=e,localStorage.setItem("language",e)}getLanguage(){const e=localStorage.getItem("language");return(e==="cs"||e==="en")&&(this.currentLanguage=e),this.currentLanguage}toggleLanguage(){return this.currentLanguage=this.currentLanguage==="cs"?"en":"cs",this.setLanguage(this.currentLanguage),this.currentLanguage}}const Ca=new kc;let Ve=null;function Oc(n){Ve=n}function $c(){if(!Ve)return console.error("Scene manager not initialized"),null;try{return Ve.scene.getScene(nt.GAME)?.mapConfig||null}catch(n){return console.error("Failed to get map config:",n),null}}function Lc(n){if(!Ve)return console.error("Scene manager not initialized"),!1;try{return Ve.scene.getScene(nt.GAME)?(Ve.scene.stop(nt.GAME),Nl(n),Ve.scene.start(nt.BUILDER,{config:n}),!0):(console.error("GameScene not found"),!1)}catch(e){return console.error("Failed to switch to builder:",e),!1}}function Rc(){if(!Ve)return console.error("Scene manager not initialized"),!1;try{return Ve.scene.stop(nt.BUILDER),Zl(),Ve.scene.start(nt.GAME,{useBuilderConfig:!0}),!0}catch(n){return console.error("Failed to switch to game:",n),!1}}function Hc(){if(!Ve){console.error("Scene manager not initialized");return}try{Ve.scene.start(nt.GAME)}catch(n){console.error("Failed to start game scene:",n)}}var Xc=Z('<button class="close-btn svelte-yrmttr" title="Close">Ã</button>'),Fc=Z('<div class="resize-handle resize-handle-nw svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M9 9L1 1M5 1L1 1L1 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" fill="none"></path></svg></div>  <div class="resize-handle resize-handle-ne svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M1 9L9 1M5 1L9 1L9 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" fill="none"></path></svg></div>  <div class="resize-handle resize-handle-sw svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M9 1L1 9M1 5L1 9L5 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" fill="none"></path></svg></div>  <div class="resize-handle resize-handle-se svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M1 1L9 9M9 5L9 9L5 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" fill="none"></path></svg></div>',1),Nc=Z("<div><!></div> <!>",1),Zc=Z('<div data-ui=""><div class="panel-header svelte-yrmttr"><span class="panel-title svelte-yrmttr"> </span> <!> <div class="header-buttons svelte-yrmttr"><button class="minimize-btn svelte-yrmttr"> </button> <!></div></div> <!></div>');function Ei(n,e){we(e,!0);const t=()=>H(Jt,"$isDraggingInBuilder",i),[i,s]=Ze();let r=1e3,a=se(e,"initialRight",3,10),l=se(e,"initialTop",3,60),o=se(e,"width",3,280),c=se(e,"minWidth",3,200),u=se(e,"minHeight",3,100),h=se(e,"maxWidth",3,600),f=se(e,"maxHeight",3,800),g=se(e,"resizable",3,!1),w=se(e,"startMinimized",3,!1),S=se(e,"showClose",3,!1),v=G(Ke(w())),m=G(!1),b=G(Ke({x:0,y:0})),_=G(Ke({width:o(),height:e.height??0})),y=G(!1),p=G(!1),x=G("se"),I=G(Ke({x:0,y:0})),D=G(null),O=G(!1),E=G(Ke(r)),A=G(null),C=G("");function R(){r++,L(E,r,!0)}function X($,F,ie){let _e=$;const z=window.innerWidth-ie-10;_e>z&&(_e=Math.max(10,z)),_e<10&&(_e=10);let J=F;const ae=window.innerHeight-40;return J>ae&&(J=Math.max(10,ae)),J<10&&(J=10),{x:_e,y:J}}Re(()=>{if(typeof window>"u"||d(O))return;const $=localStorage.getItem(`panel-state-${e.panelId}`);if($)try{const F=JSON.parse($),ie=g()&&F.width?F.width:o(),re=X(F.x,F.y,ie);L(b,re,!0),g()&&F.width&&F.height&&L(_,{width:F.width,height:F.height},!0);const le=g()?{x:re.x,y:re.y,width:d(_).width,height:d(_).height}:{x:re.x,y:re.y};L(C,JSON.stringify(le),!0)}catch{L(b,{x:window.innerWidth-o()-a(),y:l()},!0)}else L(b,{x:window.innerWidth-o()-a(),y:l()},!0);L(O,!0)}),Re(()=>{if(!d(O))return;const $=g()?{x:d(b).x,y:d(b).y,width:d(_).width,height:d(_).height}:{x:d(b).x,y:d(b).y},F=JSON.stringify($);F!==d(C)&&(L(C,F,!0),localStorage.setItem(`panel-state-${e.panelId}`,F))}),Re(()=>{if(!d(O))return;function $(){if(!d(D))return;const F=g()?d(_).width:o();let ie=d(b).x,re=d(b).y,le=!1;const _e=window.innerWidth-F;d(b).x>_e&&(ie=Math.max(10,_e),le=!0);const z=window.innerHeight-40;d(b).y>z&&(re=Math.max(10,z),le=!0),d(b).x<0&&(ie=10,le=!0),d(b).y<0&&(re=10,le=!0),le&&L(b,{x:ie,y:re},!0)}return window.addEventListener("resize",$),()=>{window.removeEventListener("resize",$)}});function P(){L(v,!d(v))}function B(){e.onclose?.()}function q(){if(g())if(d(m))d(A)&&(L(b,{x:d(A).x,y:d(A).y},!0),L(_,{width:d(A).width,height:d(A).height},!0),L(A,null)),L(m,!1);else{L(A,{x:d(b).x,y:d(b).y,width:d(_).width,height:d(_).height},!0);const $=20,F=Math.min(h(),window.innerWidth-$*2),ie=Math.min(f(),window.innerHeight-$*2),re=Math.max($,(window.innerWidth-F)/2),le=Math.max($,(window.innerHeight-ie)/2);L(b,{x:re,y:le},!0),L(_,{width:F,height:ie},!0),L(m,!0)}}function pe($){$.target.closest("button")||q()}function W($){$.target.closest("button")||(L(y,!0),L(I,{x:$.clientX-d(b).x,y:$.clientY-d(b).y},!0),$.currentTarget.setPointerCapture($.pointerId),$.preventDefault())}function ne($){if(!d(y))return;const F=$.clientX-d(I).x,ie=$.clientY-d(I).y,re=window.innerWidth-(d(D)?.offsetWidth??o()),le=window.innerHeight-40;L(b,{x:Math.max(0,Math.min(F,re)),y:Math.max(0,Math.min(ie,le))},!0)}function me($){d(y)&&(L(y,!1),$.currentTarget.releasePointerCapture($.pointerId))}function he($){return F=>{g()&&(L(p,!0),L(x,$,!0),F.currentTarget.setPointerCapture(F.pointerId),F.preventDefault(),F.stopPropagation())}}function ve($){if(!d(p)||!d(D))return;const F=d(D).getBoundingClientRect();let ie,re,le=d(b).x,_e=d(b).y;const z=d(x)==="se"||d(x)==="ne",J=d(x)==="se"||d(x)==="sw";z?ie=$.clientX-F.left:(ie=F.right-$.clientX,le=$.clientX),J?re=$.clientY-F.top:(re=F.bottom-$.clientY,_e=$.clientY);const ae=Math.max(c(),Math.min(h(),ie)),fe=Math.max(u(),Math.min(f(),re));z||(le=F.right-ae,le<0&&(le=0)),J||(_e=F.bottom-fe,_e<0&&(_e=0));const Oe=z?window.innerWidth-d(b).x-10:F.right-10,Te=J?window.innerHeight-d(b).y-10:F.bottom-10,vt=Math.min(ae,Oe),_t=Math.min(fe,Te);L(_,{width:vt,height:_t},!0);let En=!1,Nt=d(b).x,Un=d(b).y;!z&&ie>=c()&&(Nt=Math.max(0,le),En=!0),!J&&re>=u()&&(Un=Math.max(0,_e),En=!0),En&&L(b,{x:Nt,y:Un},!0)}function Ye($){d(p)&&(L(p,!1),$.currentTarget.releasePointerCapture($.pointerId))}function Qe($){$.stopPropagation()}var Ae=Zc();let st;Ae.__pointerdown=$=>{R(),Qe($)},Ae.__click=Qe;var Se=k(Ae);Se.__pointerdown=W,Se.__pointermove=ne,Se.__pointerup=me,Se.__dblclick=pe;var Qt=k(Se),rt=k(Qt),et=M(Qt,2);{var At=$=>{var F=Fe(),ie=ge(F);vn(ie,()=>e.headerExtra),T($,F)};j(et,$=>{e.headerExtra&&$(At)})}var Ft=M(et,2),at=k(Ft);at.__click=P;var Ti=k(at),Gn=M(at,2);{var Kn=$=>{var F=Xc();F.__click=B,T($,F)};j(Gn,$=>{S()&&$(Kn)})}var Ci=M(Se,2);{var en=$=>{var F=Nc(),ie=ge(F);let re;var le=k(ie);vn(le,()=>e.children);var _e=M(ie,2);{var z=J=>{var ae=Fc(),fe=ge(ae),Oe=Y(()=>he("nw"));fe.__pointerdown=function(...Zt){d(Oe)?.apply(this,Zt)},fe.__pointermove=ve,fe.__pointerup=Ye;var Te=M(fe,2),vt=Y(()=>he("ne"));Te.__pointerdown=function(...Zt){d(vt)?.apply(this,Zt)},Te.__pointermove=ve,Te.__pointerup=Ye;var _t=M(Te,2),En=Y(()=>he("sw"));_t.__pointerdown=function(...Zt){d(En)?.apply(this,Zt)},_t.__pointermove=ve,_t.__pointerup=Ye;var Nt=M(_t,2),Un=Y(()=>he("se"));Nt.__pointerdown=function(...Zt){d(Un)?.apply(this,Zt)},Nt.__pointermove=ve,Nt.__pointerup=Ye,ut("pointercancel",fe,Ye),ut("pointercancel",Te,Ye),ut("pointercancel",_t,Ye),ut("pointercancel",Nt,Ye),T(J,ae)};j(_e,J=>{g()&&J(z)})}V(()=>re=Ne(ie,1,"panel-body svelte-yrmttr",null,re,{"has-fixed-height":g()&&d(_).height>0})),T($,F)};j(Ci,$=>{d(v)||$(en)})}Rn(Ae,$=>L(D,$),()=>d(D)),V(()=>{st=Ne(Ae,1,"draggable-panel svelte-yrmttr",null,st,{minimized:d(v),maximized:d(m),dragging:d(y),resizing:d(p),resizable:g()}),ye(Ae,`left: ${d(b).x??""}px; top: ${d(b).y??""}px; width: ${d(v)?"auto":`${g()?d(_).width:o()}px`}; ${g()&&d(_).height>0&&!d(v)?`height: ${d(_).height}px;`:""}${t()?" pointer-events: none;":""} z-index: ${d(E)??""};`),De(rt,e.title),te(at,"title",d(v)?"Expand":"Minimize"),De(Ti,d(v)?"â²":"â¼")}),ut("pointercancel",Se,me),T(n,Ae),be(),s()}Dt(["pointerdown","click","pointermove","pointerup","dblclick"]);const ir=10,Yc=150,Wc=`
  position: fixed;
  pointer-events: none;
  z-index: 10000;
  opacity: 0.9;
  image-rendering: pixelated;
  filter: drop-shadow(3px 3px 0 rgba(0, 0, 0, 0.5));
  background: rgba(26, 26, 46, 0.9);
`,Bc=`
  width: 100%;
  height: 100%;
  object-fit: contain;
  image-rendering: pixelated;
`;function Da(n,e,t){const{previewSize:i,borderColor:s,dataKey:r,eventName:a,onDrop:l}=n,o=i/2,c={startX:0,startY:0,hasMoved:!1,isActivated:!1,pendingKey:null,pendingTarget:null,longPressTimer:null};function u(E,A,C){Le.emit(a,{[r]:E,canvasX:A,canvasY:C}),l?.()}function h(E,A){const C=document.querySelector("canvas");if(!C)return null;const R=C.getBoundingClientRect();return E>=R.left&&E<=R.right&&A>=R.top&&A<=R.bottom?{canvasX:E-R.left,canvasY:A-R.top}:null}function f(E,A,C){const R=document.createElement("div");return R.className="touch-drag-preview",R.innerHTML=`<img src="${E}" alt="" />`,R.style.cssText=`
      ${Wc}
      top: ${C-o}px;
      left: ${A-o}px;
      width: ${i}px;
      height: ${i}px;
      border: 2px solid ${s};
    `,R.querySelector("img").style.cssText=Bc,document.body.appendChild(R),R}function g(E,A,C){E.style.top=`${C-o}px`,E.style.left=`${A-o}px`}function w(){c.longPressTimer&&(clearTimeout(c.longPressTimer),c.longPressTimer=null),c.pendingKey=null,c.pendingTarget=null,c.isActivated=!1,c.hasMoved=!1}function S(){w();const E=e();E.touchDragElement&&(E.touchDragElement.remove(),t({touchDragElement:null})),t({draggedKey:null}),jn(!1)}function v(E,A){if(!E.dataTransfer)return;t({draggedKey:A}),jn(!0),E.dataTransfer.effectAllowed="copy",E.dataTransfer.setData(r,A);const R=E.target.querySelector("img")?.cloneNode(!0);R&&(R.style.cssText="position: absolute; top: -1000px;",document.body.appendChild(R),E.dataTransfer.setDragImage(R,o,o),requestAnimationFrame(()=>R.remove()))}function m(){t({draggedKey:null}),jn(!1)}function b(E){E.preventDefault(),E.dataTransfer&&(E.dataTransfer.dropEffect="copy")}function _(E){E.preventDefault();const A=E.dataTransfer?.getData(r);if(!A)return;const C=h(E.clientX,E.clientY);C&&u(A,C.canvasX,C.canvasY)}function y(E,A){if(!c.pendingKey||!c.pendingTarget||c.isActivated)return;c.isActivated=!0,t({draggedKey:c.pendingKey}),jn(!0);const C=c.pendingTarget.querySelector("img");if(C){const R=f(C.src,E,A);t({touchDragElement:R})}}function p(E,A){if(E.touches.length!==1)return;const C=E.touches[0];c.startX=C.clientX,c.startY=C.clientY,c.hasMoved=!1,c.isActivated=!1,c.pendingKey=A,c.pendingTarget=E.currentTarget,c.longPressTimer=setTimeout(()=>{c.pendingKey&&!c.hasMoved&&y(C.clientX,C.clientY)},Yc)}function x(E){const A=E.touches[0],C=A.clientX-c.startX,R=A.clientY-c.startY;if(!c.hasMoved&&(Math.abs(C)>ir||Math.abs(R)>ir)&&(c.hasMoved=!0,!c.isActivated)){if(Math.abs(R)>Math.abs(C)){w();return}y(A.clientX,A.clientY)}const X=e();c.isActivated&&X.touchDragElement&&(g(X.touchDragElement,A.clientX,A.clientY),E.preventDefault())}function I(E){const A=e(),C=c.isActivated,R=A.draggedKey;if(C&&R&&c.hasMoved){const X=E.changedTouches[0],P=h(X.clientX,X.clientY);P&&u(R,P.canvasX,P.canvasY)}S()}function D(){const E=document.querySelector("canvas");return E?(E.addEventListener("dragover",b),E.addEventListener("drop",_),()=>{E.removeEventListener("dragover",b),E.removeEventListener("drop",_)}):()=>{}}function O(){return document.addEventListener("touchmove",x,{passive:!1}),document.addEventListener("touchend",I),document.addEventListener("touchcancel",I),()=>{document.removeEventListener("touchmove",x),document.removeEventListener("touchend",I),document.removeEventListener("touchcancel",I)}}return{onDragStart:v,onDragEnd:m,onTouchStart:p,setupCanvasListeners:D,setupTouchListeners:O}}var zc=Z('<span class="palette-hint svelte-1ahretz">Drag to place</span>'),Gc=Z('<div data-ui="" draggable="true" role="button" tabindex="0"><img class="item-preview svelte-1ahretz"/></div>'),Kc=Z('<div class="palette-content svelte-1ahretz" role="toolbar" tabindex="-1"><div class="palette-grid svelte-1ahretz"></div></div>');function Uc(n,e){we(e,!0);const t=()=>H(zt,"$isAssetPaletteOpen",s),i=()=>H(Je,"$builderEditMode",s),[s,r]=Ze(),a="#4a90e2",l=600,o=bs;function c(){return window.innerWidth<l}function u(){c()&&zt.set(!1)}let h=G(null),f=G(null);const g=Da({previewSize:48,borderColor:a,dataKey:"assetKey",eventName:Me.ASSET_DROPPED,onDrop:u},()=>({draggedKey:d(h),touchDragElement:d(f)}),y=>{"draggedKey"in y&&L(h,y.draggedKey??null,!0),"touchDragElement"in y&&L(f,y.touchDragElement??null,!0)});function w(y){y.stopPropagation()}function S(){zt.set(!1)}function v(y){const p=document.querySelector("canvas");if(!p)return;const x=p.getBoundingClientRect(),I=x.width/2,D=x.height/2;Le.emit(Me.ASSET_DROPPED,{assetKey:y,canvasX:I,canvasY:D}),u()}wi(()=>g.setupCanvasListeners()),Re(()=>g.setupTouchListeners());var m=Fe(),b=ge(m);{var _=y=>{Ei(y,{panelId:"asset-palette",title:"Assets",initialRight:10,initialTop:60,width:280,height:400,minWidth:200,minHeight:160,maxWidth:500,maxHeight:600,resizable:!0,showClose:!0,onclose:S,headerExtra:x=>{var I=zc();T(x,I)},children:(x,I)=>{var D=Kc();D.__pointerdown=w;var O=k(D);St(O,21,()=>o,Lt,(E,A)=>{var C=Gc();let R;C.__touchstart=P=>g.onTouchStart(P,d(A).key),C.__dblclick=()=>v(d(A).key),ye(C,"",{},{"--accent-color":a});var X=k(C);V(()=>{R=Ne(C,1,"palette-item svelte-1ahretz",null,R,{dragging:d(h)===d(A).key}),te(C,"title",`${d(A).name??""} (double-click to place)`),te(X,"src",d(A).path),te(X,"alt",d(A).name)}),ut("dragstart",C,P=>g.onDragStart(P,d(A).key)),ut("dragend",C,function(...P){g.onDragEnd?.apply(this,P)}),T(E,C)}),T(x,D)},$$slots:{headerExtra:!0,default:!0}})};j(b,y=>{t()&&i()==="items"&&y(_)})}T(n,m),be(),r()}Dt(["pointerdown","touchstart","dblclick"]);var Vc=Z('<span class="palette-hint svelte-jnw59q">Drag to place</span>'),jc=Z('<div data-ui="" draggable="true" role="button" tabindex="0"><img class="item-preview svelte-jnw59q"/></div>'),qc=Z('<div class="palette-content svelte-jnw59q" role="toolbar" tabindex="-1"><div class="palette-grid svelte-jnw59q"></div></div>');function Jc(n,e){we(e,!0);const t=()=>H(Wt,"$isFramePaletteOpen",s),i=()=>H(Je,"$builderEditMode",s),[s,r]=Ze(),a="#9b59b6",l=fi;let o=G(null),c=G(null);const u=Da({previewSize:64,borderColor:a,dataKey:"frameKey",eventName:Me.FRAME_DROPPED,onDrop:()=>{Wt.set(!1)}},()=>({draggedKey:d(o),touchDragElement:d(c)}),m=>{"draggedKey"in m&&L(o,m.draggedKey??null,!0),"touchDragElement"in m&&L(c,m.touchDragElement??null,!0)});function h(m){m.stopPropagation()}function f(){Wt.set(!1)}function g(m){const b=document.querySelector("canvas");if(!b)return;const _=b.getBoundingClientRect(),y=_.width/2,p=_.height/2;Le.emit(Me.FRAME_DROPPED,{frameKey:m,canvasX:y,canvasY:p}),Wt.set(!1)}wi(()=>u.setupCanvasListeners()),Re(()=>u.setupTouchListeners());var w=Fe(),S=ge(w);{var v=m=>{Ei(m,{panelId:"frame-palette",title:"Frames",initialRight:10,initialTop:60,width:320,height:400,minWidth:220,minHeight:200,maxWidth:600,maxHeight:600,resizable:!0,showClose:!0,onclose:f,headerExtra:_=>{var y=Vc();T(_,y)},children:(_,y)=>{var p=qc();p.__pointerdown=h;var x=k(p);St(x,21,()=>l,Lt,(I,D)=>{var O=jc();let E;O.__touchstart=C=>u.onTouchStart(C,d(D).key),O.__dblclick=()=>g(d(D).key),ye(O,"",{},{"--accent-color":a});var A=k(O);V(()=>{E=Ne(O,1,"palette-item svelte-jnw59q",null,E,{dragging:d(o)===d(D).key}),te(O,"title",`${d(D).name??""} (double-click to place)`),te(A,"src",d(D).path),te(A,"alt",d(D).name)}),ut("dragstart",O,C=>u.onDragStart(C,d(D).key)),ut("dragend",O,function(...C){u.onDragEnd?.apply(this,C)}),T(I,O)}),T(_,p)},$$slots:{headerExtra:!0,default:!0}})};j(S,m=>{t()&&i()==="frames"&&m(v)})}T(n,w),be(),r()}Dt(["pointerdown","touchstart","dblclick"]);var Qc=Z("<button><!></button>");function ue(n,e){let t=se(e,"variant",3,"default"),i=se(e,"disabled",3,!1),s=se(e,"title",3,"");const r={default:{base:"#4a90e2",hover:"#357abd",active:"#2a5f8f"},green:{base:"#27ae60",hover:"#229954",active:"#1e8449"},blue:{base:"#3498db",hover:"#2980b9",active:"#21618c"},orange:{base:"#ffa500",hover:"#ff8c00",active:"#e67e00"},red:{base:"#e74c3c",hover:"#c0392b",active:"#a02e22"},purple:{base:"#9b59b6",hover:"#8e44ad",active:"#7d3c98"},cyan:{base:"#17a2b8",hover:"#138496",active:"#0f6674"}},a=Y(()=>r[t()]),l=Y(()=>e.width?`--btn-width: ${e.width};`:"");var o=Qc();let c;o.__click=function(...h){e.onclick?.apply(this,h)};var u=k(o);vn(u,()=>e.children??je),V(()=>{c=Ne(o,1,"pixel-btn svelte-lwc0vq",null,c,{disabled:i()}),ye(o,`${d(l)??""} --color-base: ${d(a).base??""}; --color-hover: ${d(a).hover??""}; --color-active: ${d(a).active??""}`),o.disabled=i(),te(o,"title",s())}),T(n,o)}Dt(["click"]);var ed=Z("<button> </button>"),td=Z('<div class="language-tabs svelte-ng6pis"></div>');function Aa(n,e){we(e,!0);let t=se(e,"accentColor",3,"#88ddff");var i=td();St(i,21,()=>bl,Lt,(s,r)=>{var a=ed();let l;a.__click=()=>e.onselect(d(r).code);let o;var c=k(a);V(()=>{l=Ne(a,1,"lang-tab svelte-ng6pis",null,l,{active:e.selectedLanguage===d(r).code}),o=ye(a,"",o,{"--accent-color":t()}),De(c,d(r).label)}),T(s,a)}),T(n,i),be()}Dt(["click"]);var nd=Z("<button></button>"),id=Z('<div class="color-picker svelte-1jc3e0j"></div>'),sd=Z('<div class="color-section svelte-1jc3e0j"><span class="color-label-title svelte-1jc3e0j"> </span> <button class="color-button svelte-1jc3e0j" title="Change color"><span class="color-preview svelte-1jc3e0j"></span> <span class="color-label svelte-1jc3e0j">Change</span></button> <!></div>');function qi(n,e){we(e,!0);let t=se(e,"label",3,"Color"),i=se(e,"accentColor",3,"#88ddff"),s=G(!1),r=G(null);Re(()=>{d(s)&&d(r)&&requestAnimationFrame(()=>{d(r)?.scrollIntoView({behavior:"smooth",block:"nearest"})})});function a(m){e.onselect(m)}function l(){L(s,!d(s))}var o=sd(),c=k(o),u=k(c),h=M(c,2);h.__click=l;let f;var g=k(h);let w;var S=M(h,2);{var v=m=>{var b=id();St(b,21,()=>e.colors,Lt,(_,y)=>{var p=nd();let x;p.__click=()=>a(d(y));let I;V(()=>{x=Ne(p,1,"color-swatch svelte-1jc3e0j",null,x,{selected:e.selectedColor===d(y)}),te(p,"title",d(y)),I=ye(p,"",I,{background:d(y),"--accent-color":i()})}),T(_,p)}),Rn(b,_=>L(r,_),()=>d(r)),T(m,b)};j(S,m=>{d(s)&&m(v)})}V(()=>{De(u,t()),f=ye(h,"",f,{"--accent-color":i()}),w=ye(g,"",w,{background:e.selectedColor})}),T(n,o),be()}Dt(["click"]);const sr=50,rr=400,rd=400,ad=70;var od=Z('<div class="form-section svelte-jhtkop"><div class="form-group svelte-jhtkop"><label class="svelte-jhtkop"> </label> <input type="text" class="svelte-jhtkop"/></div> <div class="form-group svelte-jhtkop"><label class="svelte-jhtkop"> </label> <textarea rows="6" class="svelte-jhtkop"></textarea></div></div>');function ld(n,e){we(e,!0);let t=se(e,"titlePlaceholder",3,"Enter title..."),i=se(e,"contentPlaceholder",3,"Enter text..."),s=se(e,"idPrefix",3,"text-form"),r=se(e,"accentColor",3,"#88ddff");function a(b){const _=b.target;e.ontitlechange(_.value)}function l(b){const _=b.target;e.oncontentchange(_.value)}var o=od();let c;var u=k(o),h=k(u),f=k(h),g=M(h,2);g.__input=a;var w=M(u,2),S=k(w),v=k(S),m=M(S,2);m.__input=l,V(()=>{c=ye(o,"",c,{"--accent-color":r()}),te(h,"for",`${s()??""}-title`),De(f,`Title (max ${sr} chars)`),te(g,"id",`${s()??""}-title`),di(g,e.title),te(g,"placeholder",t()),te(g,"maxlength",sr),te(S,"for",`${s()??""}-content`),De(v,`Content (max ${rr} chars)`),te(m,"id",`${s()??""}-content`),di(m,e.content),te(m,"placeholder",i()),te(m,"maxlength",rr)}),T(n,o),be()}Dt(["input"]);var cd=Z('<div class="panel-content svelte-zzlycq"><!> <!> <div class="panel-extras svelte-zzlycq"><!></div> <div class="panel-footer svelte-zzlycq"><!> <!></div></div>');function dd(n,e){we(e,!0);const t=()=>H(fs,"$dialogZones",r),i=()=>H(xi,"$selectedDialogZoneId",r),s=()=>H(ps,"$isDialogZonePanelOpen",r),[r,a]=Ze(),l="#88ddff";let o=G(Ke(da)),c=Y(()=>t().find(y=>y.id===i())??null),u=Y(()=>d(c)?.texts.find(y=>y.language===d(o))??null);function h(y){i()&&Ys(i(),d(o),{title:y})}function f(y){i()&&Ys(i(),d(o),{content:y})}function g(){i()&&(ba(i()),Ns())}function w(){Ns()}function S(y){i()&&an(i(),{color:y})}function v(y){L(o,y,!0)}var m=Fe(),b=ge(m);{var _=y=>{Ei(y,{panelId:"dialog-zone-panel",title:"Dialog Zone",initialRight:10,initialTop:160,width:280,height:450,minWidth:250,minHeight:370,maxWidth:500,maxHeight:700,resizable:!0,showClose:!0,onclose:w,children:(p,x)=>{var I=cd(),D=k(I);Aa(D,{get selectedLanguage(){return d(o)},onselect:v,accentColor:l});var O=M(D,2);{let P=Y(()=>d(u)?.title??""),B=Y(()=>d(u)?.content??"");ld(O,{get title(){return d(P)},get content(){return d(B)},ontitlechange:h,oncontentchange:f,titlePlaceholder:"Enter title...",contentPlaceholder:"Enter dialog text...",idPrefix:"dialog",accentColor:l})}var E=M(O,2),A=k(E);qi(A,{get colors(){return Ki},get selectedColor(){return d(c).color},onselect:S,label:"Zone Color",accentColor:l});var C=M(E,2),R=k(C);ue(R,{variant:"cyan",onclick:w,children:(P,B)=>{var q=de("CONFIRM");T(P,q)},$$slots:{default:!0}});var X=M(R,2);ue(X,{variant:"red",onclick:g,children:(P,B)=>{var q=de("DELETE");T(P,q)},$$slots:{default:!0}}),T(p,I)},$$slots:{default:!0}})};j(b,y=>{d(c)&&s()&&y(_)})}T(n,m),be(),a()}var ud=Z("<button> </button>"),hd=Z("<option> </option>"),fd=Z('<a target="_blank" rel="noopener noreferrer" class="url-preview svelte-ds1z4d">Test link â</a>'),gd=Z('<button><img class="svelte-ds1z4d"/></button>'),pd=Z('<div class="style-picker svelte-ds1z4d"></div>'),md=Z('<div class="panel-content svelte-ds1z4d"><!> <div class="frame-size-row svelte-ds1z4d"><div class="frame-size-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Frame Size</span> <div class="size-buttons svelte-ds1z4d"></div></div> <div class="rotate-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Rotate</span> <button class="rotate-btn svelte-ds1z4d"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-ds1z4d"><path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg></button></div></div> <div class="panel-extras svelte-ds1z4d"><div class="text-section svelte-ds1z4d"><label for="frame-text" class="svelte-ds1z4d">Text</label> <textarea id="frame-text" placeholder="Enter text..." rows="3" class="svelte-ds1z4d"></textarea></div> <div class="size-rotation-row svelte-ds1z4d"><div class="size-section svelte-ds1z4d"><label for="text-size" class="svelte-ds1z4d">Text Size</label> <select id="text-size" class="svelte-ds1z4d"></select></div></div> <div class="url-section svelte-ds1z4d"><label for="frame-url" class="svelte-ds1z4d">Link URL (opens on click)</label> <input id="frame-url" type="url" placeholder="https://example.com" class="svelte-ds1z4d"/> <!></div> <!> <!> <div class="style-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Frame Style</span> <button class="style-button svelte-ds1z4d" title="Change frame style"><img alt="Current frame" class="style-preview svelte-ds1z4d"/> <span class="style-label svelte-ds1z4d">Change Style</span></button> <!></div></div> <div class="panel-footer svelte-ds1z4d"><!> <!></div></div>');function vd(n,e){we(e,!0);const t=()=>H(hs,"$builderPreviewLanguage",a),i=()=>H(Ml,"$selectedFrame",a),s=()=>H(Nn,"$selectedFrameId",a),r=()=>H(bi,"$isFramePanelOpen",a),[a,l]=Ze(),o="#9b59b6";let c=Y(t),u=Y(i),h=Y(()=>d(u)?.texts.find(P=>P.language===d(c))??null),f=Y(()=>d(u)?fc(d(u).scale??4):"M");function g(P){const B=P.target;if(!s()||!d(u))return;const q=d(u).texts.map(pe=>pe.language===d(c)?{...pe,text:B.value}:pe);q.some(pe=>pe.language===d(c))||q.push({language:d(c),text:B.value}),wt(s(),{texts:q})}function w(P){const B=P.target;s()&&wt(s(),{url:B.value||void 0})}function S(P){s()&&wt(s(),{backgroundColor:P})}function v(P){s()&&wt(s(),{textColor:P})}function m(P){const B=P.target;s()&&wt(s(),{textSize:parseInt(B.value,10)})}function b(P){s()&&wt(s(),{scale:hc(P)})}function _(){if(!s()||!d(u))return;const B=(d(u).rotation??0)===0?90:0;wt(s(),{rotation:B})}function y(){s()&&ws(s())}function p(){Cl(),kn(null)}function x(P){Dl(P)}let I=G(!1),D=G(null),O=G(null);function E(P){s()&&wt(s(),{frameKey:P})}function A(){L(I,!d(I))}Re(()=>{d(I)&&d(D)&&requestAnimationFrame(()=>{d(D)?.scrollIntoView({behavior:"smooth",block:"nearest"})})}),Re(()=>{if(!d(I))return;function P(B){const q=B.target;d(D)&&!d(D).contains(q)&&d(O)&&!d(O).contains(q)&&L(I,!1)}return document.addEventListener("click",P),()=>document.removeEventListener("click",P)});var C=Fe(),R=ge(C);{var X=P=>{Ei(P,{panelId:"frame-panel",title:"Edit Frame",initialRight:10,initialTop:160,width:280,height:520,minWidth:250,minHeight:450,maxWidth:500,maxHeight:700,resizable:!0,showClose:!0,onclose:p,children:(B,q)=>{var pe=md(),W=k(pe);Aa(W,{get selectedLanguage(){return d(c)},onselect:x,accentColor:o});var ne=M(W,2),me=k(ne),he=M(k(me),2);St(he,21,()=>Object.entries(Ia),Lt,(z,J)=>{var ae=Y(()=>Fa(d(J),2));let fe=()=>d(ae)[0],Oe=()=>d(ae)[1].label;var Te=ud();let vt;Te.__click=()=>b(fe());var _t=k(Te);V(()=>{vt=Ne(Te,1,"size-btn svelte-ds1z4d",null,vt,{active:d(f)===fe()}),te(Te,"title",Oe()),De(_t,fe())}),T(z,Te)});var ve=M(me,2),Ye=M(k(ve),2);Ye.__click=_;var Qe=M(ne,2),Ae=k(Qe),st=M(k(Ae),2);st.__input=g;var Se=M(Ae,2),Qt=k(Se),rt=M(k(Qt),2);rt.__change=m,St(rt,21,()=>uc,Lt,(z,J)=>{var ae=hd(),fe=k(ae),Oe={};V(()=>{De(fe,`${d(J)??""}px`),Oe!==(Oe=d(J))&&(ae.value=(ae.__value=d(J))??"")}),T(z,ae)});var et;Go(rt);var At=M(Se,2),Ft=M(k(At),2);Ft.__input=w;var at=M(Ft,2);{var Ti=z=>{var J=fd();V(()=>te(J,"href",d(u).url)),T(z,J)};j(at,z=>{d(u).url&&z(Ti)})}var Gn=M(At,2);{let z=Y(()=>d(u).textColor??Ta);qi(Gn,{get colors(){return dc},get selectedColor(){return d(z)},onselect:v,label:"Text Color",accentColor:o})}var Kn=M(Gn,2);qi(Kn,{get colors(){return cc},get selectedColor(){return d(u).backgroundColor},onselect:S,label:"Background Color",accentColor:o});var Ci=M(Kn,2),en=M(k(Ci),2);en.__click=A;var $=k(en);Rn(en,z=>L(O,z),()=>d(O));var F=M(en,2);{var ie=z=>{var J=pd();St(J,21,()=>fi,Lt,(ae,fe)=>{var Oe=gd();let Te;Oe.__click=()=>E(d(fe).key);var vt=k(Oe);V(()=>{Te=Ne(Oe,1,"style-item svelte-ds1z4d",null,Te,{selected:d(u).frameKey===d(fe).key}),te(Oe,"title",d(fe).name),te(vt,"src",d(fe).path),te(vt,"alt",d(fe).name)}),T(ae,Oe)}),Rn(J,ae=>L(D,ae),()=>d(D)),T(z,J)};j(F,z=>{d(I)&&z(ie)})}var re=M(Qe,2),le=k(re);ue(le,{variant:"purple",onclick:p,children:(z,J)=>{var ae=de("CONFIRM");T(z,ae)},$$slots:{default:!0}});var _e=M(le,2);ue(_e,{variant:"red",onclick:y,children:(z,J)=>{var ae=de("DELETE");T(z,ae)},$$slots:{default:!0}}),V(z=>{te(Ye,"title",d(u).rotation===90?"Portrait (click to rotate)":"Landscape (click to rotate)"),di(st,d(h)?.text??""),et!==(et=d(u).textSize??ti)&&(rt.value=(rt.__value=d(u).textSize??ti)??"",Vr(rt,d(u).textSize??ti)),di(Ft,d(u).url??""),te($,"src",z)},[()=>fi.find(z=>z.key===d(u).frameKey)?.path??""]),T(B,pe)},$$slots:{default:!0}})};j(R,P=>{r()&&d(u)&&P(X)})}T(n,C),be(),l()}Dt(["click","input","change"]);var _d=Z('<div class="frame-text svelte-1vp2oo0"> </div>'),yd=Z('<div class="frame-content-layer svelte-1vp2oo0"></div>');function Pa(n,e){we(e,!0);const t=()=>H(ga,"$placedFrames",c),i=()=>H(ua,"$isBuilderMode",c),s=()=>H(ys,"$builderCameraInfo",c),r=()=>H(sa,"$gameCameraInfo",c),a=()=>H(hs,"$builderPreviewLanguage",c),l=()=>H(Hn,"$currentLanguage",c),o=()=>H(gs,"$draggingFramePositions",c),[c,u]=Ze();let h=Y(t),f=Y(()=>i()?s().scrollX:r().scrollX),g=Y(()=>i()?s().scrollY:r().scrollY),w=Y(()=>i()?s().zoom:r().zoom),S=Y(()=>i()?a():l()),v=Y(o);function m(p){const x=d(v).get(p.id);return x||{x:p.x,y:p.y}}function b(p){const x=p.scale??Et,I=p.rotation===90,{textWidth:D,textHeight:O}=On(x,I),E=m(p),A=(E.x-d(f))*d(w),C=(E.y-d(g))*d(w);return{x:A,y:C,width:D*d(w),height:O*d(w)}}function _(p){return(p.texts.find(I=>I.language===d(S))||p.texts[0]||{text:""}).text||""}var y=yd();St(y,21,()=>d(h),p=>p.id,(p,x)=>{const I=Y(()=>b(d(x))),D=Y(()=>_(d(x))),O=Y(()=>(d(x).textSize??ti)*d(w)),E=Y(()=>d(x).textColor??Ta);var A=Fe(),C=ge(A);{var R=X=>{var P=_d(),B=k(P);V(()=>{ye(P,`
          left: ${d(I).x??""}px;
          top: ${d(I).y??""}px;
          width: ${d(I).width??""}px;
          height: ${d(I).height??""}px;
          font-size: ${d(O)??""}px;
          color: ${d(E)??""};
        `),De(B,d(D))}),T(X,P)};j(C,X=>{d(D)&&X(R)})}T(p,A)}),T(n,y),be(),u()}var wd=Z('<div class="temp-zone-button svelte-130i47e"><!></div>');function bd(n,e){we(e,!0);const t=()=>H(ys,"$builderCameraInfo",r),i=()=>H(Je,"$builderEditMode",r),s=()=>H(Jt,"$isDraggingInBuilder",r),[r,a]=Ze();let l=G(null),o=null,c=null,u=G(null);function h(m){o&&clearTimeout(o),L(l,m,!0),L(u,t()?.scrollX??null,!0),o=setTimeout(()=>{L(l,null),L(u,null)},2e3)}function f(){d(l)&&(Le.emit(Me.DIALOG_ZONE_CREATE_AT,{worldX:d(l).worldX}),L(l,null),L(u,null),o&&(clearTimeout(o),o=null))}function g(){L(l,null),L(u,null),o&&(clearTimeout(o),o=null)}wi(()=>{c=Le.on(Me.TEMP_ZONE_BUTTON_SHOW,h);const m=Le.on(Me.TEMP_ZONE_BUTTON_HIDE,g);return()=>{c?.unsubscribe(),m.unsubscribe()}}),jo(()=>{o&&clearTimeout(o)}),Re(()=>{i()!=="dialogs"&&(L(l,null),L(u,null))}),Re(()=>{const m=t()?.scrollX;d(l)&&d(u)!==null&&m!==void 0&&Math.abs(m-d(u))>10&&(L(l,null),L(u,null),o&&(clearTimeout(o),o=null))});var w=Fe(),S=ge(w);{var v=m=>{var b=wd(),_=k(b);ue(_,{variant:"cyan",width:"90px",onclick:f,children:(y,p)=>{var x=de("+ ZONE");T(y,x)},$$slots:{default:!0}}),V(()=>ye(b,`left: ${d(l).screenX??""}px; top: ${d(l).screenY-50}px;${s()?" pointer-events: none;":""}`)),T(m,b)};j(S,m=>{d(l)&&i()==="dialogs"&&m(v)})}T(n,w),be(),a()}var Sd=Z('<div class="item-controls svelte-1is3rex"><div class="controls-row svelte-1is3rex"><!> <!> <!> <!></div></div>');function xd(n,e){we(e,!0);const t=()=>H(ms,"$selectedItem",u),i=()=>H(pa,"$selectedItemScreenPosition",u),s=()=>H(Si,"$selectedItemId",u),r=()=>H(fa,"$itemDepthLayer",u),a=()=>H(kl,"$selectedItemPhysicsEnabled",u),l=()=>H(Ol,"$selectedItemFlipX",u),o=()=>H(Je,"$builderEditMode",u),c=()=>H(Jt,"$isDraggingInBuilder",u),[u,h]=Ze();let f=Y(()=>t()?Kl(t().assetKey):!1),g=Y(()=>{const p=i();if(!p)return null;const x=10,I=40,D=d(f)?380:290;let O=p.screenY-p.itemHeight/2-45;const E=x+I;O<E&&(O=p.screenY+p.itemHeight/2+10);const A=window.innerHeight-I-x;O>A&&(O=A);let C=p.screenX;const R=D/2,X=R+x,P=window.innerWidth-R-x;return C<X&&(C=X),C>P&&(C=P),{x:C,y:O}});function w(){if(!s())return;const p=r()==="behind"?"front":"behind",x=us(p);Rl(),Hl(s(),x)}function S(){s()&&Xl(s(),!a())}function v(){s()&&Fl(s(),!l())}function m(){s()&&(ya(s()),vs())}var b=Fe(),_=ge(b);{var y=p=>{var x=Sd(),I=k(x),D=k(I);{let R=Y(()=>r()==="behind"?"blue":"orange"),X=Y(()=>a()?"Solid items must be behind player":"Toggle item depth: behind or in front of player");ue(D,{get variant(){return d(R)},get title(){return d(X)},onclick:w,get disabled(){return a()},children:(P,B)=>{var q=de();V(()=>De(q,r()==="behind"?"Front":"Back")),T(P,q)},$$slots:{default:!0}})}var O=M(D,2);{let R=Y(()=>l()?"orange":"blue");ue(O,{get variant(){return d(R)},title:"Flip item horizontally",onclick:v,children:(X,P)=>{var B=de("Flip");T(X,B)},$$slots:{default:!0}})}var E=M(O,2);{var A=R=>{{let X=Y(()=>a()?"orange":"blue");ue(R,{get variant(){return d(X)},title:"Toggle physics: item will block player movement",onclick:S,children:(P,B)=>{var q=de();V(()=>De(q,a()?"Ghost":"Solid")),T(P,q)},$$slots:{default:!0}})}};j(E,R=>{d(f)&&R(A)})}var C=M(E,2);ue(C,{variant:"red",title:"Delete selected item",onclick:m,children:(R,X)=>{var P=de("DEL");T(R,P)},$$slots:{default:!0}}),V(()=>ye(x,`left: ${d(g).x??""}px; top: ${d(g).y??""}px;${c()?" pointer-events: none;":""}`)),T(p,x)};j(_,p=>{o()==="items"&&s()&&d(g)&&p(y)})}T(n,b),be(),h()}var Ed=Z('<div class="frame-controls svelte-eqt3a9"><div class="controls-row svelte-eqt3a9"><!> <!></div></div>');function Id(n,e){we(e,!0);const t=()=>H(ma,"$selectedFrameScreenPosition",a),i=()=>H(Nn,"$selectedFrameId",a),s=()=>H(Je,"$builderEditMode",a),r=()=>H(Jt,"$isDraggingInBuilder",a),[a,l]=Ze();let o=Y(()=>{const w=t();if(!w)return null;const S=10,v=40,m=190;let b=w.screenY-w.frameHeight/2-45;const _=S+v;b<_&&(b=w.screenY+w.frameHeight/2+10);const y=window.innerHeight-v-S;b>y&&(b=y);let p=w.screenX;const x=m/2,I=x+S,D=window.innerWidth-x-S;return p<I&&(p=I),p>D&&(p=D),{x:p,y:b}});function c(){ha()}function u(){i()&&(ws(i()),kn(null))}var h=Fe(),f=ge(h);{var g=w=>{var S=Ed(),v=k(S),m=k(v);ue(m,{variant:"purple",title:"Edit frame content (or double-click)",onclick:c,children:(_,y)=>{var p=de("EDIT");T(_,p)},$$slots:{default:!0}});var b=M(m,2);ue(b,{variant:"red",title:"Delete selected frame",onclick:u,children:(_,y)=>{var p=de("DEL");T(_,p)},$$slots:{default:!0}}),V(()=>ye(S,`left: ${d(o).x??""}px; top: ${d(o).y??""}px;${r()?" pointer-events: none;":""}`)),T(w,S)};j(f,w=>{(s()==="frames"||s()==="items")&&i()&&d(o)&&w(g)})}T(n,h),be(),l()}var Td=Z('<div class="zone-controls svelte-sm01rq"><div class="controls-row svelte-sm01rq"><!> <!> <!></div></div>');function Cd(n,e){we(e,!0);const t=()=>H(va,"$selectedDialogZoneScreenPosition",a),i=()=>H(xi,"$selectedDialogZoneId",a),s=()=>H(Je,"$builderEditMode",a),r=()=>H(Jt,"$isDraggingInBuilder",a),[a,l]=Ze();let o=Y(()=>{const S=t();if(!S)return null;const v=10,m=120,b=85;let _=S.screenY;const y=v+m/2,p=window.innerHeight-m/2-v;_<y&&(_=y),_>p&&(_=p);let x=S.screenX;const I=b/2,D=I+v,O=window.innerWidth-I-v;return x<D&&(x=D),x>O&&(x=O),{x,y:_}});function c(){_a()}function u(){i()&&(ba(i()),Mn(null))}function h(){Mn(null)}var f=Fe(),g=ge(f);{var w=S=>{var v=Td(),m=k(v),b=k(m);ue(b,{variant:"cyan",title:"Edit zone content (or double-click)",onclick:c,children:(p,x)=>{var I=de("EDIT");T(p,I)},$$slots:{default:!0}});var _=M(b,2);ue(_,{variant:"red",title:"Delete selected zone",onclick:u,children:(p,x)=>{var I=de("DEL");T(p,I)},$$slots:{default:!0}});var y=M(_,2);ue(y,{variant:"default",title:"Deselect zone",onclick:h,children:(p,x)=>{var I=de("DONE");T(p,I)},$$slots:{default:!0}}),V(()=>ye(v,`left: ${d(o).x??""}px; top: ${d(o).y??""}px;${r()?" pointer-events: none;":""}`)),T(S,v)};j(g,S=>{s()==="dialogs"&&i()&&d(o)&&S(w)})}T(n,f),be(),l()}var Dd=Z('<div class="hstack svelte-8vtf35"><!></div>');function Ad(n,e){let t=se(e,"gap",3,"10px"),i=se(e,"align",3,"center");var s=Dd(),r=k(s);vn(r,()=>e.children??je),V(()=>ye(s,`gap: ${t()??""}; align-items: ${(i()==="start"?"flex-start":i()==="end"?"flex-end":i())??""};`)),T(n,s)}var Pd=Z('<div class="vstack svelte-1y4dqnf"><!></div>');function Md(n,e){let t=se(e,"gap",3,"10px"),i=se(e,"align",3,"stretch");var s=Pd(),r=k(s);vn(r,()=>e.children??je),V(()=>ye(s,`gap: ${t()??""}; align-items: ${(i()==="start"?"flex-start":i()==="end"?"flex-end":i())??""};`)),T(n,s)}var kd=Z("<div><!></div>");function ar(n,e){const t=()=>H(Jt,"$isDraggingInBuilder",i),[i,s]=Ze();let r=se(e,"padding",3,"10px");var a=kd();let l;var o=k(a);vn(o,()=>e.children??je),V(()=>{l=Ne(a,1,`fixed fixed--${e.position??""}`,"svelte-vwlo0e",l,{"dragging-in-builder":t()}),ye(a,`--padding: ${r()??""};`)}),T(n,a),s()}var Od=Z("<div><!> <!></div>"),$d=Z("<!> <!>",1),Ld=Z("<!> <!> <!>",1),Rd=Z("<div><!></div>"),Hd=Z("<!> <!> <!> <!> <!> <!> <!> <!> <!> <!>",1);function Xd(n,e){we(e,!0);const t=()=>H(Si,"$selectedItemId",c),i=()=>H(Nn,"$selectedFrameId",c),s=()=>H(xi,"$selectedDialogZoneId",c),r=()=>H(Je,"$builderEditMode",c),a=()=>H(ui,"$gridSnappingEnabled",c),l=()=>H(zt,"$isAssetPaletteOpen",c),o=()=>H(Wt,"$isFramePaletteOpen",c),[c,u]=Ze(),h=600;let f=G(Ke(typeof window<"u"?window.innerWidth<h:!1)),g=Y(()=>d(f)&&(t()!==null||i()!==null||s()!==null));Re(()=>{function X(){L(f,window.innerWidth<h)}return window.addEventListener("resize",X),()=>window.removeEventListener("resize",X)});function w(){Rc()}function S(){El()}function v(){Le.emit(Me.DIALOG_ZONE_CREATE)}var m=Hd(),b=ge(m);xd(b,{});var _=M(b,2);Id(_,{});var y=M(_,2);Cd(y,{});var p=M(y,2);{var x=X=>{Uc(X,{})},I=X=>{var P=Fe(),B=ge(P);{var q=W=>{dd(W,{})},pe=W=>{var ne=Fe(),me=ge(ne);{var he=ve=>{Jc(ve,{})};j(me,ve=>{r()==="frames"&&ve(he)},!0)}T(W,ne)};j(B,W=>{r()==="dialogs"?W(q):W(pe,!1)},!0)}T(X,P)};j(p,X=>{r()==="items"?X(x):X(I,!1)})}var D=M(p,2);vd(D,{});var O=M(D,2);Pa(O,{});var E=M(O,2);bd(E,{});var A=M(E,2),C=M(A,2);ar(C,{position:"top-left",children:(X,P)=>{var B=Od();let q;var pe=k(B);ue(pe,{variant:"green",width:"100px",onclick:w,children:(ne,me)=>{var he=de("SAVE");T(ne,he)},$$slots:{default:!0}});var W=M(pe,2);{let ne=Y(()=>a()?"blue":"orange");ue(W,{get variant(){return d(ne)},width:"80px",onclick:S,title:"Toggle grid snapping",children:(me,he)=>{var ve=de();V(()=>De(ve,a()?"FREE":"SNAP")),T(me,ve)},$$slots:{default:!0}})}V(()=>q=Ne(B,1,"left-buttons svelte-1vm8op7",null,q,{"hide-left":d(g)})),T(X,B)},$$slots:{default:!0}});var R=M(C,2);ar(R,{position:"top-right",children:(X,P)=>{var B=Rd();let q;var pe=k(B);Md(pe,{align:"end",children:(W,ne)=>{var me=Ld(),he=ge(me);{let Qe=Y(()=>r()==="items"&&l()?"orange":"blue");ue(he,{get variant(){return d(Qe)},onclick:()=>{r()==="items"?Il():(Qn("items"),zt.set(!0))},title:"Edit assets/items",children:(Ae,st)=>{var Se=de("ASSETS");T(Ae,Se)},$$slots:{default:!0}})}var ve=M(he,2);{let Qe=Y(()=>r()==="frames"&&o()?"orange":"purple");ue(ve,{get variant(){return d(Qe)},onclick:()=>{r()==="frames"?Tl():(Qn("frames"),Wt.set(!0))},title:"Edit text frames",children:(Ae,st)=>{var Se=de("FRAMES");T(Ae,Se)},$$slots:{default:!0}})}var Ye=M(ve,2);Ad(Ye,{children:(Qe,Ae)=>{var st=$d(),Se=ge(st);{var Qt=et=>{ue(et,{variant:"cyan",width:"100px",onclick:v,title:"Create new dialog zone at center of view",children:(At,Ft)=>{var at=de("+ ZONE");T(At,at)},$$slots:{default:!0}})};j(Se,et=>{r()==="dialogs"&&et(Qt)})}var rt=M(Se,2);{let et=Y(()=>r()==="dialogs"?"orange":"cyan");ue(rt,{get variant(){return d(et)},onclick:()=>{r()==="dialogs"?Qn("items"):Qn("dialogs")},title:"Edit dialog zones",children:(At,Ft)=>{var at=de("DIALOGS");T(At,at)},$$slots:{default:!0}})}T(Qe,st)},$$slots:{default:!0}}),T(W,me)},$$slots:{default:!0}}),V(()=>q=Ne(B,1,"right-buttons svelte-1vm8op7",null,q,{"hide-right":d(g)})),T(X,B)},$$slots:{default:!0}}),T(n,m),be(),u()}var Fd=Z('<button class="background-card svelte-crre06" type="button"><div class="preview-container svelte-crre06"><img class="preview-image svelte-crre06"/></div> <span class="background-name svelte-crre06"> </span></button>'),Nd=Z('<div class="background-select-screen svelte-crre06"><div class="content svelte-crre06"><h1 class="title svelte-crre06">SELECT BACKGROUND</h1> <div class="backgrounds-grid svelte-crre06"></div></div></div>');function Zd(n,e){we(e,!1);const t=lt;function i(o){return`./assets/backgrounds/${o}/preview.png`}function s(o){Fn.setBackgroundByIndex(o),Jr.set(t[o].name),Qr.set(!0),Hc()}qr();var r=Nd(),a=k(r),l=M(k(a),2);St(l,5,()=>t,Lt,(o,c,u)=>{var h=Fd();h.__click=()=>s(u);var f=k(h),g=k(f),w=M(f,2),S=k(w);V(v=>{te(g,"src",v),te(g,"alt",d(c).name),De(S,d(c).name)},[()=>i(d(c).folder)]),T(o,h)}),T(n,r),be()}Dt(["click"]);var Yd=Z("<div> </div>"),Wd=Z('<div class="dialog-content svelte-1jd14ss"> </div>'),Bd=Z("<div><!> <!></div>");function zd(n,e){we(e,!0);const t=()=>H(sl,"$activeDialogText",s),i=()=>H(ia,"$playerScreenPosition",s),[s,r]=Ze();let a=Y(()=>t()?.title&&t()?.content),l=Y(()=>Math.max(10,window.innerHeight-i().y+ad)),o=Y(()=>window.innerWidth<=rd),c=Y(()=>d(o)?50:i().x),u=Y(()=>d(o)?"percent":"px");var h=Fe(),f=ge(h);{var g=w=>{var S=Bd();let v;var m=k(S);{var b=p=>{var x=Yd();let I;var D=k(x);V(()=>{I=Ne(x,1,"dialog-title svelte-1jd14ss",null,I,{"has-divider":d(a)}),De(D,t().title)}),T(p,x)};j(m,p=>{t().title&&p(b)})}var _=M(m,2);{var y=p=>{var x=Wd(),I=k(x);V(()=>De(I,t().content)),T(p,x)};j(_,p=>{t().content&&p(y)})}V(()=>{v=Ne(S,1,"dialog-bubble svelte-1jd14ss",null,v,{narrow:d(o)}),ye(S,`bottom: ${d(l)??""}px; left: ${d(c)??""}${d(u)??""};`)}),T(w,S)};j(f,w=>{t()&&w(g)})}T(n,h),be(),r()}var Gd=Z("<!> <!>",1),Kd=Z('<div class="touch-controls"><p class="touch-text">Tap and hold<br/>where you want<br/>to move</p></div>'),Ud=Z('<div class="desktop-controls"><div class="key-row"><div class="pixel-key">A</div> <div class="pixel-key">W</div> <div class="pixel-key">D</div></div> <p class="or-text">or</p> <div class="key-row"><div class="pixel-key">â</div> <div class="pixel-key">â</div> <div class="pixel-key">â</div></div></div>'),Vd=Z('<div class="loader-overlay"><div class="pixel-loader"></div></div>'),jd=Z('<div class="game-ui-wrapper svelte-13dvmla"><!> <!> <!> <dialog class="pixel-dialog"><h1>CONTROLS</h1> <div class="controls-content"><!></div></dialog> <!></div>');function qd(n,e){we(e,!1);const t=()=>H(Tn,"$showControlsDialog",c),i=()=>H(ta,"$hasPlayerMoved",c),s=()=>H(Qr,"$hasSelectedBackground",c),r=()=>H(ua,"$isBuilderMode",c),a=()=>H(Hn,"$currentLanguage",c),l=()=>H(ea,"$isTouchDevice",c),o=()=>H(Ui,"$isLoading",c),[c,u]=Ze();let h=as();function f(){const _=Ca.toggleLanguage();Hn.set(_)}function g(_){!d(h)?.open||_.target.closest(".pixel-button")||Tn.set(!1)}function w(){const _=$c();if(!_){console.error("Cannot enter builder mode: map config not found");return}Lc(_)}Ps(()=>(d(h),t()),()=>{d(h)&&(t()?d(h).showModal():d(h).close())}),Ps(()=>(i(),d(h),Tn),()=>{i()&&d(h)?.open&&Tn.set(!1)}),Oo(),qr();var S=Fe();ut("pointerdown",yr,g);var v=ge(S);{var m=_=>{Zd(_,{})},b=_=>{var y=jd(),p=k(y);{var x=W=>{Xd(W,{})},I=W=>{var ne=Gd(),me=ge(ne);zd(me,{});var he=M(me,2);Pa(he,{}),T(W,ne)};j(p,W=>{r()?W(x):W(I,!1)})}var D=M(p,2);{var O=W=>{ue(W,{position:"top-left",variant:"green",width:"120px",onclick:w,title:"Toggle Builder Mode",children:(ne,me)=>{var he=de("BUILD");T(ne,he)},$$slots:{default:!0}})};j(D,W=>{r()||W(O)})}var E=M(D,2);{var A=W=>{ue(W,{position:"top-right",variant:"default",width:"100px",onclick:f,title:"Toggle Language (L)",children:(ne,me)=>{var he=de();V(ve=>De(he,ve),[()=>(a(),Xt(()=>a().toUpperCase()))]),T(ne,he)},$$slots:{default:!0}})};j(E,W=>{r()||W(A)})}var C=M(E,2),R=M(k(C),2),X=k(R);{var P=W=>{var ne=Kd();T(W,ne)},B=W=>{var ne=Ud();T(W,ne)};j(X,W=>{l()?W(P):W(B,!1)})}Rn(C,W=>L(h,W),()=>d(h));var q=M(C,2);{var pe=W=>{var ne=Vd();T(W,ne)};j(q,W=>{o()&&W(pe)})}T(_,y)};j(v,_=>{s()?_(b,!1):_(m)})}T(n,S),be(),u()}pl();const Ma=document.getElementById("game-ui");if(!Ma)throw new Error("game-ui element not found!");Zo(qd,{target:Ma});Hn.set(Ca.getLanguage());il.set(ra.getSkin());Jr.set(Fn.getCurrentConfig().name);const Jd={type:N.AUTO,width:800,height:600,parent:"game-container",backgroundColor:"#000000",pixelArt:!0,roundPixels:!0,scale:{mode:N.Scale.RESIZE,autoCenter:N.Scale.CENTER_BOTH},input:{activePointers:3},physics:{default:"arcade",arcade:{gravity:{y:1e3,x:0},debug:!1}},audio:{noAudio:!0},scene:[]},Ii=new N.Game(Jd);Ii.scene.add(nt.GAME,yc);Ii.scene.add(nt.BUILDER,Pc);Oc(Ii);const Qd=Ii.device.input.touch;ea.set(Qd);const eu=performance.getEntriesByType("navigation")[0]&&performance.getEntriesByType("navigation")[0].type==="reload",tu=sessionStorage.getItem("hasSeenControlsHint");(!tu||eu)&&(sessionStorage.setItem("hasSeenControlsHint","true"),Tn.set(!0));
//# sourceMappingURL=index-DtDxYBDl.js.map
