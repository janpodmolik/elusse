{"version":3,"file":"builder-rX5Rsbtx.js","sources":["../../src/data/modularConfig.ts","../../src/scenes/CharacterPreviewScene.ts","../../src/ui/CharacterBuilder.svelte","../../src/builder.ts"],"sourcesContent":["/**\n * Modular Character Configuration\n * \n * Defines the structure for building custom characters from layered PNG spritesheets.\n * Each PNG is 800×448 pixels = 10 columns × 7 rows grid.\n * Each animation occupies its own row.\n * \n * Folder structure:\n * modular/{gender}/skins/\n * modular/{gender}/hair/\n * modular/{gender}/clothing/{subcategory}/  (underwear, legs, chest, feet, hats)\n */\n\nexport type Gender = 'male' | 'female';\n\n// Main categories for UI tabs\nexport type ModularCategory = 'skins' | 'hair' | 'clothing';\n\n// Subcategories within clothing (also determines layer order within clothing)\nexport type ClothingSubcategory = 'underwear' | 'legs' | 'chest' | 'feet' | 'hats';\n\nexport interface ModularAnimation {\n  name: string;\n  from: number;  // Start frame (0-indexed)\n  to: number;    // End frame (0-indexed)\n  frameCount: number;\n  frameRate: number;  // FPS\n}\n\nexport interface ModularItem {\n  id: string;\n  name: string;\n  file: string;\n  category: ModularCategory;\n  subcategory?: ClothingSubcategory;  // Only for clothing items\n  gender: Gender;\n}\n\nexport interface ModularCharacterSelection {\n  gender: Gender;\n  skin: string | null;\n  hair: string | null;\n  clothing: string[];  // Multiple clothing items can be combined\n}\n\n// Frame dimensions\nexport const MODULAR_FRAME = {\n  WIDTH: 80,\n  HEIGHT: 64,\n  COLUMNS: 10,\n  ROWS: 7,\n  TOTAL_FRAMES: 70,\n} as const;\n\n// Animations - each on its own row (row * 10 = start frame)\nexport const MODULAR_ANIMATIONS: ModularAnimation[] = [\n  { name: 'idle', from: 0, to: 4, frameCount: 5, frameRate: 8 },\n  { name: 'walk', from: 10, to: 17, frameCount: 8, frameRate: 10 },\n  { name: 'run', from: 20, to: 27, frameCount: 8, frameRate: 12 },\n  { name: 'jump', from: 30, to: 33, frameCount: 4, frameRate: 10 },\n  { name: 'fall', from: 40, to: 43, frameCount: 4, frameRate: 10 },\n  { name: 'attack', from: 50, to: 55, frameCount: 6, frameRate: 10 },\n  { name: 'death', from: 60, to: 69, frameCount: 10, frameRate: 8 },\n];\n\n// Layer rendering order (bottom to top)\n// Clothing renders between skins and hair, but hats render on top of hair\nexport const LAYER_ORDER: ModularCategory[] = ['skins', 'clothing', 'hair'];\n\n// Clothing subcategory order for RENDERING (bottom to top, excludes hats)\n// Note: hats are handled specially - they render AFTER hair\nexport const CLOTHING_LAYER_ORDER: ClothingSubcategory[] = ['underwear', 'legs', 'chest', 'feet'];\n\n// Clothing subcategory order for UI tabs (includes hats)\nexport const CLOTHING_UI_ORDER: ClothingSubcategory[] = ['underwear', 'legs', 'chest', 'feet', 'hats'];\n\nexport const HATS_RENDER_AFTER_HAIR = true;\n\n/**\n * Get asset path for a modular item\n */\nexport function getModularAssetPath(item: ModularItem): string {\n  if (item.category === 'clothing' && item.subcategory) {\n    return `assets/skins/modular/${item.gender}/clothing/${item.subcategory}/${item.file}`;\n  }\n  return `assets/skins/modular/${item.gender}/${item.category}/${item.file}`;\n}\n\n/**\n * Generate texture key for a modular item\n */\nexport function getModularTextureKey(item: ModularItem): string {\n  if (item.subcategory) {\n    return `modular-${item.gender}-${item.subcategory}-${item.id}`;\n  }\n  return `modular-${item.gender}-${item.category}-${item.id}`;\n}\n\n// ============================================================================\n// Male Items\n// ============================================================================\n\nexport const MALE_SKINS: ModularItem[] = [\n  { id: 'male-skin-1', name: 'Skin 1', file: 'Male Skin1.png', category: 'skins', gender: 'male' },\n  { id: 'male-skin-2', name: 'Skin 2', file: 'Male Skin2.png', category: 'skins', gender: 'male' },\n  { id: 'male-skin-3', name: 'Skin 3', file: 'Male Skin3.png', category: 'skins', gender: 'male' },\n  { id: 'male-skin-4', name: 'Skin 4', file: 'Male Skin4.png', category: 'skins', gender: 'male' },\n  { id: 'male-skin-5', name: 'Skin 5', file: 'Male Skin5.png', category: 'skins', gender: 'male' },\n];\n\nexport const MALE_HAIR: ModularItem[] = [\n  { id: 'male-hair-1', name: 'Hair 1', file: 'Male Hair1.png', category: 'hair', gender: 'male' },\n  { id: 'male-hair-2', name: 'Hair 2', file: 'Male Hair2.png', category: 'hair', gender: 'male' },\n  { id: 'male-hair-3', name: 'Hair 3', file: 'Male Hair3.png', category: 'hair', gender: 'male' },\n  { id: 'male-hair-4', name: 'Hair 4', file: 'Male Hair4.png', category: 'hair', gender: 'male' },\n  { id: 'male-hair-5', name: 'Hair 5', file: 'Male Hair5.png', category: 'hair', gender: 'male' },\n];\n\nexport const MALE_CLOTHING: ModularItem[] = [\n  // Underwear\n  { id: 'male-underwear-green', name: 'Green Underwear', file: 'Green Underwear.png', category: 'clothing', subcategory: 'underwear', gender: 'male' },\n  { id: 'male-underwear-orange', name: 'Orange Underwear', file: 'Orange Underwear.png', category: 'clothing', subcategory: 'underwear', gender: 'male' },\n  { id: 'male-underwear-purple', name: 'Purple Underwear', file: 'Purple Underwear.png', category: 'clothing', subcategory: 'underwear', gender: 'male' },\n  { id: 'male-underwear-red', name: 'Red Underwear', file: 'Red Underwear.png', category: 'clothing', subcategory: 'underwear', gender: 'male' },\n  { id: 'male-underwear-skyblue', name: 'Skyblue Underwear', file: 'Skyblue Underwear.png', category: 'clothing', subcategory: 'underwear', gender: 'male' },\n  // Legs (pants)\n  { id: 'male-pants', name: 'Pants', file: 'Pants.png', category: 'clothing', subcategory: 'legs', gender: 'male' },\n  { id: 'male-pants-blue', name: 'Blue Pants', file: 'Blue Pants.png', category: 'clothing', subcategory: 'legs', gender: 'male' },\n  { id: 'male-pants-green', name: 'Green Pants', file: 'Green Pants.png', category: 'clothing', subcategory: 'legs', gender: 'male' },\n  { id: 'male-pants-orange', name: 'Orange Pants', file: 'Orange Pants.png', category: 'clothing', subcategory: 'legs', gender: 'male' },\n  { id: 'male-pants-purple', name: 'Purple Pants', file: 'Purple Pants.png', category: 'clothing', subcategory: 'legs', gender: 'male' },\n  // Chest (shirts)\n  { id: 'male-shirt', name: 'Shirt', file: 'Shirt.png', category: 'clothing', subcategory: 'chest', gender: 'male' },\n  { id: 'male-shirt-v2', name: 'Shirt v2', file: 'Shirt v2.png', category: 'clothing', subcategory: 'chest', gender: 'male' },\n  { id: 'male-shirt-blue', name: 'Blue Shirt', file: 'Blue Shirt v2.png', category: 'clothing', subcategory: 'chest', gender: 'male' },\n  { id: 'male-shirt-green', name: 'Green Shirt', file: 'Green Shirt v2.png', category: 'clothing', subcategory: 'chest', gender: 'male' },\n  { id: 'male-shirt-orange', name: 'Orange Shirt', file: 'orange Shirt v2.png', category: 'clothing', subcategory: 'chest', gender: 'male' },\n  { id: 'male-shirt-purple', name: 'Purple Shirt', file: 'Purple Shirt v2.png', category: 'clothing', subcategory: 'chest', gender: 'male' },\n  // Feet (shoes/boots)\n  { id: 'male-shoes', name: 'Shoes', file: 'Shoes.png', category: 'clothing', subcategory: 'feet', gender: 'male' },\n  { id: 'male-boots', name: 'Boots', file: 'Boots.png', category: 'clothing', subcategory: 'feet', gender: 'male' },\n  // Hats\n  { id: 'male-hat-1', name: 'Hat 1', file: 'Male Hat1.png', category: 'clothing', subcategory: 'hats', gender: 'male' },\n  { id: 'male-hat-2', name: 'Hat 2', file: 'Male Hat2.png', category: 'clothing', subcategory: 'hats', gender: 'male' },\n  { id: 'male-hat-3', name: 'Hat 3', file: 'Male Hat3.png', category: 'clothing', subcategory: 'hats', gender: 'male' },\n  { id: 'male-hat-4', name: 'Hat 4', file: 'Male Hat4.png', category: 'clothing', subcategory: 'hats', gender: 'male' },\n  { id: 'male-hat-5', name: 'Hat 5', file: 'Male Hat5.png', category: 'clothing', subcategory: 'hats', gender: 'male' },\n  { id: 'male-hat-6', name: 'Hat 6', file: 'Male Hat6.png', category: 'clothing', subcategory: 'hats', gender: 'male' },\n  { id: 'male-hat-7', name: 'Hat 7', file: 'Male Hat7.png', category: 'clothing', subcategory: 'hats', gender: 'male' },\n  { id: 'male-hat-8', name: 'Hat 8', file: 'Male Hat8.png', category: 'clothing', subcategory: 'hats', gender: 'male' },\n  { id: 'male-hat-9', name: 'Hat 9', file: 'Male Hat9.png', category: 'clothing', subcategory: 'hats', gender: 'male' },\n  { id: 'male-hat-10', name: 'Hat 10', file: 'Male Hat10.png', category: 'clothing', subcategory: 'hats', gender: 'male' },\n  { id: 'male-cap-blue', name: 'Blue Cap', file: 'Male Blue cap.png', category: 'clothing', subcategory: 'hats', gender: 'male' },\n  { id: 'male-cap-green', name: 'Green Cap', file: 'Male Green cap.png', category: 'clothing', subcategory: 'hats', gender: 'male' },\n  { id: 'male-cap-orange', name: 'Orange Cap', file: 'Male Orange cap.png', category: 'clothing', subcategory: 'hats', gender: 'male' },\n  { id: 'male-cap-purple', name: 'Purple Cap', file: 'Male Purple cap.png', category: 'clothing', subcategory: 'hats', gender: 'male' },\n  { id: 'male-cap-red', name: 'Red Cap', file: 'Male Red cap.png', category: 'clothing', subcategory: 'hats', gender: 'male' },\n  { id: 'male-farming-hat', name: 'Farming Hat', file: 'Farming Hat M.png', category: 'clothing', subcategory: 'hats', gender: 'male' },\n  { id: 'male-guard-helmet', name: 'Guard Helmet', file: 'Guard Helmet.png', category: 'clothing', subcategory: 'hats', gender: 'male' },\n  { id: 'male-mining-helmet', name: 'Mining Helmet', file: 'Male Mining Helmet.png', category: 'clothing', subcategory: 'hats', gender: 'male' },\n  { id: 'male-pumpkin', name: 'Pumpkin Hat', file: 'Pumpkin hat.png', category: 'clothing', subcategory: 'hats', gender: 'male' },\n  { id: 'male-santa', name: 'Santa Hat', file: 'Male Santa hat.png', category: 'clothing', subcategory: 'hats', gender: 'male' },\n  { id: 'male-viking', name: 'Viking Helmet', file: 'Viking Helmet.png', category: 'clothing', subcategory: 'hats', gender: 'male' },\n  { id: 'male-viking-horns', name: 'Viking Helmet (Horns)', file: 'Viking Helmet with horns.png', category: 'clothing', subcategory: 'hats', gender: 'male' },\n];\n\n// ============================================================================\n// Female Items\n// ============================================================================\n\nexport const FEMALE_SKINS: ModularItem[] = [\n  { id: 'female-skin-1', name: 'Skin 1', file: 'Female Skin1.png', category: 'skins', gender: 'female' },\n  { id: 'female-skin-2', name: 'Skin 2', file: 'Female Skin2.png', category: 'skins', gender: 'female' },\n  { id: 'female-skin-3', name: 'Skin 3', file: 'Female Skin3.png', category: 'skins', gender: 'female' },\n  { id: 'female-skin-4', name: 'Skin 4', file: 'Female Skin4.png', category: 'skins', gender: 'female' },\n  { id: 'female-skin-5', name: 'Skin 5', file: 'Female Skin5.png', category: 'skins', gender: 'female' },\n];\n\nexport const FEMALE_HAIR: ModularItem[] = [\n  { id: 'female-hair-1', name: 'Hair 1', file: 'Female Hair1.png', category: 'hair', gender: 'female' },\n  { id: 'female-hair-2', name: 'Hair 2', file: 'Female Hair2.png', category: 'hair', gender: 'female' },\n  { id: 'female-hair-3', name: 'Hair 3', file: 'Female Hair3.png', category: 'hair', gender: 'female' },\n  { id: 'female-hair-4', name: 'Hair 4', file: 'Female Hair4.png', category: 'hair', gender: 'female' },\n  { id: 'female-hair-5', name: 'Hair 5', file: 'Female Hair5.png', category: 'hair', gender: 'female' },\n];\n\nexport const FEMALE_CLOTHING: ModularItem[] = [\n  // Underwear\n  { id: 'female-bra-panties', name: 'Bra & Panties', file: 'Blue Panties and Bra.png', category: 'clothing', subcategory: 'underwear', gender: 'female' },\n  { id: 'female-bra-panties-green', name: 'Green Bra & Panties', file: 'Green Panties and Bra.png', category: 'clothing', subcategory: 'underwear', gender: 'female' },\n  { id: 'female-bra-panties-orange', name: 'Orange Bra & Panties', file: 'Orange Panties and Bra.png', category: 'clothing', subcategory: 'underwear', gender: 'female' },\n  { id: 'female-bra-panties-purple', name: 'Purple Bra & Panties', file: 'Purple Panties and Bra.png', category: 'clothing', subcategory: 'underwear', gender: 'female' },\n  { id: 'female-bra-panties-red', name: 'Red Bra & Panties', file: 'Red Panties and Bra.png', category: 'clothing', subcategory: 'underwear', gender: 'female' },\n  { id: 'female-bra-panties-skyblue', name: 'Skyblue Bra & Panties', file: 'Skyblue Panties and Bra.png', category: 'clothing', subcategory: 'underwear', gender: 'female' },\n  // Legs (skirt)\n  { id: 'female-skirt', name: 'Skirt', file: 'Skirt.png', category: 'clothing', subcategory: 'legs', gender: 'female' },\n  // Chest (corsets)\n  { id: 'female-corset', name: 'Corset', file: 'Corset.png', category: 'clothing', subcategory: 'chest', gender: 'female' },\n  { id: 'female-corset-v2', name: 'Corset v2', file: 'Corset v2.png', category: 'clothing', subcategory: 'chest', gender: 'female' },\n  { id: 'female-corset-blue', name: 'Blue Corset', file: 'Blue Corset.png', category: 'clothing', subcategory: 'chest', gender: 'female' },\n  { id: 'female-corset-blue-v2', name: 'Blue Corset v2', file: 'Blue Corset v2.png', category: 'clothing', subcategory: 'chest', gender: 'female' },\n  { id: 'female-corset-green', name: 'Green Corset', file: 'Green Corset.png', category: 'clothing', subcategory: 'chest', gender: 'female' },\n  { id: 'female-corset-green-v2', name: 'Green Corset v2', file: 'Green Corset v2.png', category: 'clothing', subcategory: 'chest', gender: 'female' },\n  { id: 'female-corset-orange', name: 'Orange Corset', file: 'Orange Corset.png', category: 'clothing', subcategory: 'chest', gender: 'female' },\n  { id: 'female-corset-orange-v2', name: 'Orange Corset v2', file: 'Orange Corset v2.png', category: 'clothing', subcategory: 'chest', gender: 'female' },\n  { id: 'female-corset-purple', name: 'Purple Corset', file: 'Purple Corset.png', category: 'clothing', subcategory: 'chest', gender: 'female' },\n  { id: 'female-corset-purple-v2', name: 'Purple Corset v2', file: 'Purple Corset v2.png', category: 'clothing', subcategory: 'chest', gender: 'female' },\n  // Feet (socks/boots)\n  { id: 'female-socks', name: 'Socks', file: 'Socks.png', category: 'clothing', subcategory: 'feet', gender: 'female' },\n  { id: 'female-socks-green', name: 'Green Socks', file: 'Green Socks.png', category: 'clothing', subcategory: 'feet', gender: 'female' },\n  { id: 'female-socks-orange', name: 'Orange Socks', file: 'Orange Socks.png', category: 'clothing', subcategory: 'feet', gender: 'female' },\n  { id: 'female-socks-purple', name: 'Purple Socks', file: 'Purple Socks.png', category: 'clothing', subcategory: 'feet', gender: 'female' },\n  { id: 'female-socks-red', name: 'Red Socks', file: 'Red Socks.png', category: 'clothing', subcategory: 'feet', gender: 'female' },\n  { id: 'female-socks-skyblue', name: 'Skyblue Socks', file: 'Skyblue Socks.png', category: 'clothing', subcategory: 'feet', gender: 'female' },\n  { id: 'female-boots', name: 'Boots', file: 'Boots.png', category: 'clothing', subcategory: 'feet', gender: 'female' },\n  // Hats\n  { id: 'female-hat-1', name: 'Hat 1', file: 'Female Hat1.png', category: 'clothing', subcategory: 'hats', gender: 'female' },\n  { id: 'female-hat-2', name: 'Hat 2', file: 'Female Hat2.png', category: 'clothing', subcategory: 'hats', gender: 'female' },\n  { id: 'female-hat-3', name: 'Hat 3', file: 'Female Hat3.png', category: 'clothing', subcategory: 'hats', gender: 'female' },\n  { id: 'female-hat-4', name: 'Hat 4', file: 'Female Hat4.png', category: 'clothing', subcategory: 'hats', gender: 'female' },\n  { id: 'female-hat-5', name: 'Hat 5', file: 'Female Hat5.png', category: 'clothing', subcategory: 'hats', gender: 'female' },\n  { id: 'female-bunny-1', name: 'Bunny Ears 1', file: 'Bunny ears1.png', category: 'clothing', subcategory: 'hats', gender: 'female' },\n  { id: 'female-bunny-2', name: 'Bunny Ears 2', file: 'Bunny ears2.png', category: 'clothing', subcategory: 'hats', gender: 'female' },\n  { id: 'female-bunny-3', name: 'Bunny Ears 3', file: 'Bunny ears3.png', category: 'clothing', subcategory: 'hats', gender: 'female' },\n  { id: 'female-bunny-4', name: 'Bunny Ears 4', file: 'Bunny ears4.png', category: 'clothing', subcategory: 'hats', gender: 'female' },\n  { id: 'female-bunny-5', name: 'Bunny Ears 5', file: 'Bunny ears5.png', category: 'clothing', subcategory: 'hats', gender: 'female' },\n  { id: 'female-cap-blue', name: 'Blue Cap', file: 'Female Blue cap.png', category: 'clothing', subcategory: 'hats', gender: 'female' },\n  { id: 'female-cap-green', name: 'Green Cap', file: 'Female Green cap.png', category: 'clothing', subcategory: 'hats', gender: 'female' },\n  { id: 'female-cap-orange', name: 'Orange Cap', file: 'Female Orange cap.png', category: 'clothing', subcategory: 'hats', gender: 'female' },\n  { id: 'female-cap-purple', name: 'Purple Cap', file: 'Female Purple cap.png', category: 'clothing', subcategory: 'hats', gender: 'female' },\n  { id: 'female-cap-red', name: 'Red Cap', file: 'Female Red cap.png', category: 'clothing', subcategory: 'hats', gender: 'female' },\n  { id: 'female-farming-hat', name: 'Farming Hat', file: 'Farming Hat F.png', category: 'clothing', subcategory: 'hats', gender: 'female' },\n  { id: 'female-mining-helmet', name: 'Mining Helmet', file: 'Female Mining Helmet.png', category: 'clothing', subcategory: 'hats', gender: 'female' },\n  { id: 'female-santa', name: 'Santa Hat', file: 'Female Santa hat.png', category: 'clothing', subcategory: 'hats', gender: 'female' },\n  { id: 'female-witch', name: 'Witch Hat', file: 'Witch hat.png', category: 'clothing', subcategory: 'hats', gender: 'female' },\n];\n\n// ============================================================================\n// Helper functions\n// ============================================================================\n\n/**\n * Get all items for a gender organized by category\n */\nexport function getItemsForGender(gender: Gender): Record<ModularCategory, ModularItem[]> {\n  if (gender === 'male') {\n    return {\n      skins: MALE_SKINS,\n      hair: MALE_HAIR,\n      clothing: MALE_CLOTHING,\n    };\n  }\n  return {\n    skins: FEMALE_SKINS,\n    hair: FEMALE_HAIR,\n    clothing: FEMALE_CLOTHING,\n  };\n}\n\n/**\n * Get clothing items grouped by subcategory\n */\nexport function getClothingBySubcategory(gender: Gender): Record<ClothingSubcategory, ModularItem[]> {\n  const clothing = gender === 'male' ? MALE_CLOTHING : FEMALE_CLOTHING;\n  \n  const result: Record<ClothingSubcategory, ModularItem[]> = {\n    underwear: [],\n    legs: [],\n    chest: [],\n    feet: [],\n    hats: [],\n  };\n  \n  clothing.forEach(item => {\n    if (item.subcategory) {\n      result[item.subcategory].push(item);\n    }\n  });\n  \n  return result;\n}\n\n/**\n * Get item by ID\n */\nexport function getItemById(id: string): ModularItem | undefined {\n  const allItems = [\n    ...MALE_SKINS, ...MALE_HAIR, ...MALE_CLOTHING,\n    ...FEMALE_SKINS, ...FEMALE_HAIR, ...FEMALE_CLOTHING,\n  ];\n  return allItems.find(item => item.id === id);\n}\n\n/**\n * Get all items that need to be loaded for a character selection\n */\nexport function getItemsForSelection(selection: ModularCharacterSelection): ModularItem[] {\n  const items: ModularItem[] = [];\n  \n  if (selection.skin) {\n    const skinItem = getItemById(selection.skin);\n    if (skinItem) items.push(skinItem);\n  }\n  \n  if (selection.hair) {\n    const hairItem = getItemById(selection.hair);\n    if (hairItem) items.push(hairItem);\n  }\n  \n  selection.clothing.forEach(clothingId => {\n    const clothingItem = getItemById(clothingId);\n    if (clothingItem) items.push(clothingItem);\n  });\n  \n  return items;\n}\n\n/**\n * Sort clothing items by layer order for rendering (excludes hats)\n */\nexport function sortClothingByLayer(clothingIds: string[]): string[] {\n  // Filter out hats - they render separately after hair\n  const nonHats = clothingIds.filter(id => {\n    const item = getItemById(id);\n    return item?.subcategory !== 'hats';\n  });\n  \n  return nonHats.sort((a, b) => {\n    const itemA = getItemById(a);\n    const itemB = getItemById(b);\n    \n    if (!itemA?.subcategory || !itemB?.subcategory) return 0;\n    \n    const indexA = CLOTHING_LAYER_ORDER.indexOf(itemA.subcategory);\n    const indexB = CLOTHING_LAYER_ORDER.indexOf(itemB.subcategory);\n    \n    return indexA - indexB;\n  });\n}\n\n/**\n * Get hat items from clothing selection\n */\nexport function getHatsFromClothing(clothingIds: string[]): string[] {\n  return clothingIds.filter(id => {\n    const item = getItemById(id);\n    return item?.subcategory === 'hats';\n  });\n}\n\n/**\n * Create default character selection\n */\nexport function createDefaultSelection(gender: Gender): ModularCharacterSelection {\n  const items = getItemsForGender(gender);\n  return {\n    gender,\n    skin: items.skins[0]?.id ?? null,\n    hair: items.hair[0]?.id ?? null,\n    clothing: [],\n  };\n}\n","/**\n * CharacterPreviewScene\n * \n * Phaser scene for previewing modular character customization.\n * Renders layered sprites and synchronizes animations.\n * \n * Spritesheet layout: 10 columns × 7 rows\n * Each animation occupies its own row.\n */\n\nimport Phaser from 'phaser';\nimport {\n  type ModularCharacterSelection,\n  type ModularItem,\n  type ModularCategory,\n  MODULAR_FRAME,\n  MODULAR_ANIMATIONS,\n  LAYER_ORDER,\n  getItemsForSelection,\n  getModularAssetPath,\n  getModularTextureKey,\n  getItemById,\n  sortClothingByLayer,\n  getHatsFromClothing,\n} from '../data/modularConfig';\n\nexport default class CharacterPreviewScene extends Phaser.Scene {\n  private layerSprites: Phaser.GameObjects.Sprite[] = [];\n  private loadedTextures: Set<string> = new Set();\n  private currentAnimName: string = 'idle';\n  private currentSelection: ModularCharacterSelection | null = null;\n  \n  constructor() {\n    super({ key: 'CharacterPreviewScene' });\n  }\n  \n  create() {\n    // Listen for resize events\n    this.scale.on('resize', this.onResize, this);\n    \n    // Emit ready event for Svelte\n    this.game.events.emit('ready');\n  }\n  \n  /**\n   * Handle resize - reposition and rescale character\n   */\n  private onResize() {\n    if (this.layerSprites.length > 0) {\n      this.repositionCharacter();\n    }\n  }\n  \n  /**\n   * Calculate display scale based on canvas size\n   */\n  private getDisplayScale(): number {\n    const minDimension = Math.min(this.cameras.main.width, this.cameras.main.height);\n    // Scale to fit ~70% of the canvas height\n    return Math.max(3, Math.floor(minDimension / 64 * 0.65));\n  }\n  \n  /**\n   * Reposition and rescale all sprites\n   * Character sprite has empty space above head, so we offset Y slightly up\n   */\n  private repositionCharacter() {\n    const centerX = this.cameras.main.width / 2;\n    // Offset up by ~10% of height to account for empty space above character's head\n    const centerY = this.cameras.main.height / 2 - (this.cameras.main.height * 0.05);\n    const scale = this.getDisplayScale();\n    \n    this.layerSprites.forEach(sprite => {\n      sprite.setPosition(centerX, centerY);\n      sprite.setScale(scale);\n    });\n  }\n  \n  /**\n   * Update character with new selection (called from Svelte)\n   */\n  public updateCharacter(selection: ModularCharacterSelection) {\n    this.currentSelection = selection;\n    \n    const items = getItemsForSelection(selection);\n    this.loadTextures(items).then(() => {\n      this.rebuildCharacter();\n    });\n  }\n  \n  /**\n   * Load textures for items\n   */\n  private async loadTextures(items: ModularItem[]): Promise<void> {\n    const toLoad = items.filter(item => {\n      const key = getModularTextureKey(item);\n      return !this.loadedTextures.has(key);\n    });\n    \n    if (toLoad.length === 0) return;\n    \n    return new Promise((resolve) => {\n      toLoad.forEach(item => {\n        const key = getModularTextureKey(item);\n        const path = getModularAssetPath(item);\n        \n        this.load.spritesheet(key, path, {\n          frameWidth: MODULAR_FRAME.WIDTH,\n          frameHeight: MODULAR_FRAME.HEIGHT,\n        });\n      });\n      \n      this.load.once('complete', () => {\n        toLoad.forEach(item => {\n          const key = getModularTextureKey(item);\n          this.loadedTextures.add(key);\n          this.createAnimationsForTexture(key);\n        });\n        resolve();\n      });\n      \n      this.load.start();\n    });\n  }\n  \n  /**\n   * Create all animations for a texture\n   */\n  private createAnimationsForTexture(textureKey: string) {\n    MODULAR_ANIMATIONS.forEach(anim => {\n      const animKey = `${textureKey}-${anim.name}`;\n      \n      if (this.anims.exists(animKey)) return;\n      \n      this.anims.create({\n        key: animKey,\n        frames: this.anims.generateFrameNumbers(textureKey, {\n          start: anim.from,\n          end: anim.to,\n        }),\n        frameRate: anim.frameRate,\n        repeat: anim.name === 'death' ? 0 : -1,\n      });\n    });\n  }\n  \n  /**\n   * Rebuild character display - destroys old sprites and creates new ones\n   * Layer order: skins -> clothing (no hats) -> hair -> hats\n   */\n  private rebuildCharacter() {\n    // Destroy ALL existing layer sprites\n    this.layerSprites.forEach(sprite => {\n      if (sprite && sprite.active) {\n        sprite.destroy();\n      }\n    });\n    this.layerSprites = [];\n    \n    if (!this.currentSelection) return;\n    \n    const { width, height } = this.cameras.main;\n    const centerX = width / 2;\n    // Offset Y slightly up to account for empty space above character head\n    const centerY = height / 2 - (height * 0.05);\n    const scale = this.getDisplayScale();\n    \n    // Build layers in order: skins -> clothing (no hats) -> hair\n    LAYER_ORDER.forEach(category => {\n      const itemIds = this.getItemIdsForCategory(category);\n      \n      itemIds.forEach(itemId => {\n        const item = getItemById(itemId);\n        if (!item) return;\n        \n        const textureKey = getModularTextureKey(item);\n        if (!this.textures.exists(textureKey)) return;\n        \n        const sprite = this.add.sprite(centerX, centerY, textureKey);\n        sprite.setScale(scale);\n        sprite.setOrigin(0.5, 0.5);\n        \n        this.layerSprites.push(sprite);\n      });\n    });\n    \n    // Add hats AFTER hair (on top of everything)\n    const hatIds = getHatsFromClothing(this.currentSelection.clothing);\n    hatIds.forEach(hatId => {\n      const item = getItemById(hatId);\n      if (!item) return;\n      \n      const textureKey = getModularTextureKey(item);\n      if (!this.textures.exists(textureKey)) return;\n      \n      const sprite = this.add.sprite(centerX, centerY, textureKey);\n      sprite.setScale(scale);\n      sprite.setOrigin(0.5, 0.5);\n      \n      this.layerSprites.push(sprite);\n    });\n    \n    // Play animation on all sprites\n    this.playAnimationOnAll(this.currentAnimName);\n  }\n  \n  /**\n   * Get item IDs for a category (sorted by layer order for clothing)\n   */\n  private getItemIdsForCategory(category: ModularCategory): string[] {\n    if (!this.currentSelection) return [];\n    \n    switch (category) {\n      case 'skins':\n        return this.currentSelection.skin ? [this.currentSelection.skin] : [];\n      case 'hair':\n        return this.currentSelection.hair ? [this.currentSelection.hair] : [];\n      case 'clothing':\n        // Sort clothing by subcategory layer order (underwear -> legs -> chest -> feet -> hats)\n        return sortClothingByLayer(this.currentSelection.clothing);\n      default:\n        return [];\n    }\n  }\n  \n  /**\n   * Play animation on all layer sprites\n   */\n  private playAnimationOnAll(animName: string) {\n    this.layerSprites.forEach(sprite => {\n      const textureKey = sprite.texture.key;\n      const animKey = `${textureKey}-${animName}`;\n      \n      if (this.anims.exists(animKey)) {\n        sprite.play(animKey);\n      }\n    });\n  }\n  \n  /**\n   * Play a specific animation (called from Svelte)\n   */\n  public playAnimation(animName: string) {\n    this.currentAnimName = animName;\n    this.playAnimationOnAll(animName);\n  }\n  \n  /**\n   * Sync animations across all layers\n   */\n  update() {\n    if (this.layerSprites.length <= 1) return;\n    \n    const first = this.layerSprites[0];\n    if (!first?.anims?.currentFrame) return;\n    \n    const targetIndex = first.anims.currentFrame.index;\n    \n    for (let i = 1; i < this.layerSprites.length; i++) {\n      const sprite = this.layerSprites[i];\n      const anim = sprite.anims.currentAnim;\n      \n      if (anim && sprite.anims.currentFrame?.index !== targetIndex) {\n        const frame = anim.frames[targetIndex];\n        if (frame) {\n          sprite.anims.setCurrentFrame(frame);\n        }\n      }\n    }\n  }\n}\n","<script lang=\"ts\">\n  import { onMount, onDestroy } from 'svelte';\n  import Phaser from 'phaser';\n  import PixelButton from './PixelButton.svelte';\n  import {\n    type Gender,\n    type ModularCategory,\n    type ModularItem,\n    type ModularCharacterSelection,\n    type ClothingSubcategory,\n    LAYER_ORDER,\n    CLOTHING_UI_ORDER,\n    getItemsForGender,\n    getClothingBySubcategory,\n    createDefaultSelection,\n    getModularAssetPath,\n    getItemById,\n  } from '../data/modularConfig';\n  import CharacterPreviewScene from '../scenes/CharacterPreviewScene';\n  \n  // ============================================================================\n  // State\n  // ============================================================================\n  \n  let phaserGame: Phaser.Game | null = $state(null);\n  let gameContainer: HTMLDivElement | null = $state(null);\n  \n  // Character selection state\n  let selection: ModularCharacterSelection = $state(createDefaultSelection('male'));\n  \n  // UI state\n  let activeCategory: ModularCategory = $state('skins');\n  let activeClothingSubcategory: ClothingSubcategory = $state('chest');\n  \n  // Computed items for current gender\n  let currentItems = $derived(getItemsForGender(selection.gender));\n  let currentClothingBySubcategory = $derived(getClothingBySubcategory(selection.gender));\n  \n  // ============================================================================\n  // Lifecycle\n  // ============================================================================\n  \n  onMount(() => {\n    loadSavedSelection();\n    initPhaser();\n  });\n  \n  onDestroy(() => {\n    phaserGame?.destroy(true);\n    phaserGame = null;\n  });\n  \n  // ============================================================================\n  // Phaser initialization\n  // ============================================================================\n  \n  function initPhaser() {\n    if (!gameContainer) return;\n    \n    // Get container size for responsive canvas\n    const rect = gameContainer.getBoundingClientRect();\n    const width = Math.floor(rect.width) || 400;\n    const height = Math.floor(rect.height) || 400;\n    \n    const config: Phaser.Types.Core.GameConfig = {\n      type: Phaser.AUTO,\n      width: width,\n      height: height,\n      parent: gameContainer,\n      transparent: true,\n      pixelArt: true,\n      scale: {\n        mode: Phaser.Scale.RESIZE,\n        autoCenter: Phaser.Scale.CENTER_BOTH,\n      },\n      scene: [CharacterPreviewScene],\n    };\n    \n    phaserGame = new Phaser.Game(config);\n    \n    // Pass initial selection to scene\n    phaserGame.events.once('ready', () => {\n      updatePreview();\n    });\n  }\n  \n  // ============================================================================\n  // Selection management\n  // ============================================================================\n  \n  function setGender(gender: Gender) {\n    if (selection.gender === gender) return;\n    // Reset selection for new gender\n    selection = createDefaultSelection(gender);\n    updatePreview();\n  }\n  \n  function selectSkin(item: ModularItem) {\n    selection.skin = item.id;\n    updatePreview();\n  }\n  \n  function selectHair(item: ModularItem) {\n    // Toggle off if already selected\n    selection.hair = selection.hair === item.id ? null : item.id;\n    updatePreview();\n  }\n\n  function selectClothing(item: ModularItem) {\n    // Only one item per subcategory allowed\n    // Remove any existing item from same subcategory, then add this one (or toggle off)\n    const isCurrentlySelected = selection.clothing.includes(item.id);\n    \n    // Filter out items from the same subcategory\n    const filtered = selection.clothing.filter(id => {\n      const existing = getItemById(id);\n      return existing?.subcategory !== item.subcategory;\n    });\n    \n    if (isCurrentlySelected) {\n      // Toggle off - just use filtered list\n      selection.clothing = filtered;\n    } else {\n      // Select this item\n      selection.clothing = [...filtered, item.id];\n    }\n    updatePreview();\n  }\n  \n  function getSelectedClothingForSubcategory(subcategory: ClothingSubcategory): string | null {\n    for (const id of selection.clothing) {\n      const item = getItemById(id);\n      if (item?.subcategory === subcategory) {\n        return id;\n      }\n    }\n    return null;\n  }\n  \n  function isSelected(item: ModularItem): boolean {\n    switch (item.category) {\n      case 'skins':\n        return selection.skin === item.id;\n      case 'hair':\n        return selection.hair === item.id;\n      case 'clothing':\n        return selection.clothing.includes(item.id);\n      default:\n        return false;\n    }\n  }\n  \n  function handleItemClick(item: ModularItem) {\n    switch (item.category) {\n      case 'skins':\n        selectSkin(item);\n        break;\n      case 'hair':\n        selectHair(item);\n        break;\n      case 'clothing':\n        selectClothing(item);\n        break;\n    }\n  }\n  \n  // Get preview image path for an item (first frame)\n  function getItemPreviewPath(item: ModularItem): string {\n    return getModularAssetPath(item);\n  }  // ============================================================================\n  // Preview & Persistence\n  // ============================================================================\n  \n  function updatePreview() {\n    if (!phaserGame) return;\n    const scene = phaserGame.scene.getScene('CharacterPreviewScene') as CharacterPreviewScene;\n    if (scene && scene.updateCharacter) {\n      scene.updateCharacter(selection);\n    }\n  }\n  \n  function saveSelection() {\n    localStorage.setItem('characterSelection', JSON.stringify(selection));\n  }\n  \n  function loadSavedSelection() {\n    const saved = localStorage.getItem('characterSelection');\n    if (saved) {\n      try {\n        const parsed = JSON.parse(saved) as ModularCharacterSelection;\n        // Validate basic structure\n        if (parsed.gender && (parsed.gender === 'male' || parsed.gender === 'female')) {\n          selection = {\n            ...parsed,\n            clothing: Array.isArray(parsed.clothing) ? parsed.clothing : [],\n          };\n        }\n      } catch (e) {\n        console.warn('Failed to load saved character selection:', e);\n      }\n    }\n  }\n  \n  function handleSaveAndPlay() {\n    saveSelection();\n    // Navigate to main game\n    window.location.href = '/';\n  }\n  \n  // ============================================================================\n  // Animation controls\n  // ============================================================================\n  \n  let currentAnimation = $state('idle');\n  const animations = ['idle', 'run'];\n  \n  function playAnimation(animName: string) {\n    currentAnimation = animName;\n    if (!phaserGame) return;\n    const scene = phaserGame.scene.getScene('CharacterPreviewScene') as CharacterPreviewScene;\n    if (scene && scene.playAnimation) {\n      scene.playAnimation(animName);\n    }\n  }\n</script>\n\n<div class=\"character-builder\">\n  <!-- Header -->\n  <header class=\"header\">\n    <h1>Character Builder</h1>\n    <PixelButton variant=\"green\" onclick={handleSaveAndPlay}>\n      PLAY\n    </PixelButton>\n  </header>\n  \n  <div class=\"main-content\">\n    <!-- Preview section (always visible, on top on mobile) -->\n    <div class=\"preview-section\">\n      <div class=\"preview-container\" bind:this={gameContainer}></div>\n      \n      <!-- Animation buttons -->\n      <div class=\"animation-controls\">\n        {#each animations as anim}\n          <button \n            class=\"anim-btn\"\n            class:active={currentAnimation === anim}\n            onclick={() => playAnimation(anim)}\n          >\n            {anim}\n          </button>\n        {/each}\n      </div>\n    </div>\n    \n    <!-- Selection panel -->\n    <div class=\"selection-panel\">\n      <!-- Gender toggle -->\n        <div class=\"gender-toggle\">\n          <button \n            class=\"gender-btn\"\n            class:active={selection.gender === 'male'}\n            onclick={() => setGender('male')}\n          >\n            Male\n          </button>\n          <button \n            class=\"gender-btn\"\n            class:active={selection.gender === 'female'}\n            onclick={() => setGender('female')}\n          >\n            Female\n          </button>\n        </div>\n        \n        <!-- Category tabs -->\n        <div class=\"category-tabs\">\n          {#each LAYER_ORDER as category}\n            <button \n              class=\"category-tab\"\n              class:active={activeCategory === category}\n              onclick={() => activeCategory = category}\n            >\n              {category}\n            </button>\n          {/each}\n        </div>\n        \n        <!-- Clothing subcategory tabs (only shown when clothing is active) -->\n        {#if activeCategory === 'clothing'}\n          <div class=\"subcategory-tabs\">\n            {#each CLOTHING_UI_ORDER as subcategory}\n              <button \n                class=\"subcategory-tab\"\n                class:active={activeClothingSubcategory === subcategory}\n                onclick={() => activeClothingSubcategory = subcategory}\n              >\n                {subcategory}\n              </button>\n            {/each}\n          </div>\n        {/if}\n        \n        <!-- Items grid -->\n        <div class=\"items-grid\">\n          {#if activeCategory === 'clothing'}\n            {#each currentClothingBySubcategory[activeClothingSubcategory] as item}\n              <button \n                class=\"item-btn\"\n                class:selected={isSelected(item)}\n                onclick={() => handleItemClick(item)}\n                title={item.name}\n              >\n                <div class=\"item-preview\">\n                  <img src={getItemPreviewPath(item)} alt={item.name} class=\"preview-img\" />\n                </div>\n                <span class=\"item-name\">{item.name}</span>\n              </button>\n            {/each}\n          {:else}\n            {#each currentItems[activeCategory] as item}\n              <button \n                class=\"item-btn\"\n                class:selected={isSelected(item)}\n                onclick={() => handleItemClick(item)}\n                title={item.name}\n              >\n                <div class=\"item-preview\">\n                  <img src={getItemPreviewPath(item)} alt={item.name} class=\"preview-img\" />\n                </div>\n                <span class=\"item-name\">{item.name}</span>\n              </button>\n            {/each}\n          {/if}\n        </div>\n    </div>\n  </div>\n</div>\n\n<style>\n  .character-builder {\n    width: 100vw;\n    height: 100vh;\n    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);\n    color: white;\n    font-family: 'Press Start 2P', monospace;\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n  }\n  \n  .header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 15px 20px;\n    background: rgba(0, 0, 0, 0.3);\n    border-bottom: 3px solid #333;\n    flex-shrink: 0;\n  }\n  \n  .header h1 {\n    font-size: 16px;\n    margin: 0;\n    text-shadow: 2px 2px 0 #000;\n  }\n  \n  .main-content {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n    padding: 15px;\n    overflow-y: auto;\n    overflow-x: hidden;\n  }\n  \n  /* Selection panel (now on top) */\n  .selection-panel {\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n    flex-shrink: 0;\n  }\n  \n  .gender-toggle {\n    display: flex;\n    gap: 10px;\n  }\n  \n  .gender-btn {\n    flex: 1;\n    padding: 12px;\n    background: #2a2a4a;\n    border: 3px solid #444;\n    color: #aaa;\n    font-family: inherit;\n    font-size: 11px;\n    cursor: pointer;\n    transition: all 0.15s ease;\n  }\n  \n  .gender-btn:hover {\n    background: #3a3a5a;\n    color: white;\n  }\n  \n  .gender-btn.active {\n    background: #9b59b6;\n    border-color: #8e44ad;\n    color: white;\n  }\n  \n  .category-tabs {\n    display: flex;\n    gap: 8px;\n  }\n  \n  .category-tab {\n    flex: 1;\n    padding: 10px 8px;\n    background: #2a2a4a;\n    border: 2px solid #444;\n    color: #aaa;\n    font-family: inherit;\n    font-size: 10px;\n    text-transform: uppercase;\n    cursor: pointer;\n    transition: all 0.15s ease;\n  }\n  \n  .category-tab:hover {\n    background: #3a3a5a;\n    color: white;\n  }\n  \n  .category-tab.active {\n    background: #27ae60;\n    border-color: #229954;\n    color: white;\n  }\n  \n  .subcategory-tabs {\n    display: flex;\n    gap: 6px;\n    flex-wrap: wrap;\n  }\n  \n  .subcategory-tab {\n    flex: 1;\n    padding: 8px 6px;\n    background: #1a1a3a;\n    border: 2px solid #383858;\n    color: #888;\n    font-family: inherit;\n    font-size: 9px;\n    text-transform: uppercase;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    min-width: 55px;\n    max-width: 80px;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n  \n  .subcategory-tab:hover {\n    background: #2a2a4a;\n    color: #bbb;\n  }\n  \n  .subcategory-tab.active {\n    background: #e67e22;\n    border-color: #d35400;\n    color: white;\n  }\n\n  .items-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));\n    gap: 8px;\n    padding: 8px;\n    background: rgba(0, 0, 0, 0.2);\n    border: 2px solid #333;\n    border-radius: 4px;\n    max-height: 280px;\n    overflow-y: auto;\n    align-content: start;\n  }\n  \n  .item-btn {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 4px;\n    padding: 4px;\n    background: #2a2a4a;\n    border: 2px solid #444;\n    color: #ccc;\n    font-family: inherit;\n    font-size: 7px;\n    text-align: center;\n    cursor: pointer;\n    transition: all 0.15s ease;\n    height: fit-content;\n  }\n  \n  .item-btn:hover {\n    background: #3a3a5a;\n    border-color: #555;\n    color: white;\n  }\n  \n  .item-btn.selected {\n    background: #3498db;\n    border-color: #2980b9;\n    color: white;\n  }\n  \n  .item-preview {\n    width: 80px;\n    height: 64px;\n    overflow: hidden;\n    display: flex;\n    align-items: flex-start;\n    justify-content: flex-start;\n    image-rendering: pixelated;\n  }\n  \n  .preview-img {\n    width: 800px;\n    height: 448px;\n    object-fit: none;\n    object-position: 0 0;\n    transform: scale(1);\n    transform-origin: top left;\n    image-rendering: pixelated;\n  }\n  \n  .item-name {\n    word-break: break-word;\n    line-height: 1.3;\n    max-width: 100%;\n    display: -webkit-box;\n    -webkit-line-clamp: 2;\n    -webkit-box-orient: vertical;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: normal;\n  }\n\n  /* Preview section */\n  .preview-section {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    flex-shrink: 0;\n  }\n  \n  .preview-container {\n    height: 200px;\n    background: \n      linear-gradient(to right, #2a2a4a 1px, transparent 1px),\n      linear-gradient(to bottom, #2a2a4a 1px, transparent 1px),\n      #1a1a2e;\n    background-size: 16px 16px;\n    border: 4px solid #333;\n    border-radius: 4px;\n    overflow: hidden;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n  \n  .animation-controls {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 6px;\n  }\n  \n  .anim-btn {\n    padding: 6px 10px;\n    background: #2a2a4a;\n    border: 2px solid #444;\n    color: #aaa;\n    font-family: inherit;\n    font-size: 9px;\n    text-transform: uppercase;\n    cursor: pointer;\n    transition: all 0.15s ease;\n  }\n  \n  .anim-btn:hover {\n    background: #3a3a5a;\n    color: white;\n  }\n  \n  .anim-btn.active {\n    background: #4a90e2;\n    border-color: #357abd;\n    color: white;\n  }\n  \n  /* Scrollbar styling */\n  .items-grid::-webkit-scrollbar,\n  .main-content::-webkit-scrollbar {\n    width: 8px;\n  }\n  \n  .items-grid::-webkit-scrollbar-track,\n  .main-content::-webkit-scrollbar-track {\n    background: #1a1a2e;\n  }\n  \n  .items-grid::-webkit-scrollbar-thumb,\n  .main-content::-webkit-scrollbar-thumb {\n    background: #444;\n    border-radius: 4px;\n  }\n  \n  .items-grid::-webkit-scrollbar-thumb:hover,\n  .main-content::-webkit-scrollbar-thumb:hover {\n    background: #555;\n  }\n  \n  /* Desktop: side by side layout */\n  @media (min-width: 900px) {\n    .main-content {\n      flex-direction: row;\n      overflow: hidden;\n    }\n    \n    .selection-panel {\n      flex: 1;\n      max-width: 550px;\n      overflow-y: auto;\n    }\n    \n    .items-grid {\n      flex: 1;\n      max-height: none;\n    }\n    \n    .preview-section {\n      width: 300px;\n      flex-shrink: 0;\n    }\n    \n    .preview-container {\n      flex: 1;\n      height: auto;\n      min-height: 200px;\n    }\n    \n    .selection-toggle {\n      display: none !important;\n    }\n  }\n  \n  /* Mobile */\n  @media (max-width: 899px) {\n    .header h1 {\n      font-size: 12px;\n    }\n    \n    .items-grid {\n      max-height: 200px;\n    }\n  }\n  \n  /* Very small screens */\n  @media (max-width: 500px) {\n    .items-grid {\n      grid-template-columns: repeat(auto-fill, minmax(85px, 1fr));\n    }\n    \n    .item-preview {\n      width: 64px;\n      height: 52px;\n    }\n    \n    .preview-img {\n      transform: scale(0.8);\n    }\n    \n    .subcategory-tab {\n      min-width: 45px;\n      font-size: 8px;\n      padding: 6px 4px;\n    }\n  }\n</style>\n","/**\n * Builder Entry Point\n * \n * Separate page for the modular character builder.\n */\n\nimport { mount } from 'svelte';\nimport CharacterBuilder from './ui/CharacterBuilder.svelte';\n\n// Wait for DOM to be ready\nconst builderRoot = document.getElementById('builder-root');\n\nif (!builderRoot) {\n  throw new Error('builder-root element not found!');\n}\n\n// Mount the CharacterBuilder component\nmount(CharacterBuilder, {\n  target: builderRoot,\n});\n"],"names":["MODULAR_FRAME","MODULAR_ANIMATIONS","LAYER_ORDER","CLOTHING_LAYER_ORDER","CLOTHING_UI_ORDER","getModularAssetPath","item","getModularTextureKey","MALE_SKINS","MALE_HAIR","MALE_CLOTHING","FEMALE_SKINS","FEMALE_HAIR","FEMALE_CLOTHING","getItemsForGender","gender","getClothingBySubcategory","clothing","result","getItemById","id","getItemsForSelection","selection","items","skinItem","hairItem","clothingId","clothingItem","sortClothingByLayer","clothingIds","a","b","itemA","itemB","indexA","indexB","getHatsFromClothing","createDefaultSelection","CharacterPreviewScene","Phaser","minDimension","centerX","centerY","scale","sprite","toLoad","key","resolve","path","textureKey","anim","animKey","width","height","category","itemId","hatId","animName","first","targetIndex","i","frame","phaserGame","gameContainer","$.state","$.proxy","activeCategory","activeClothingSubcategory","currentItems","$.derived","$.get","currentClothingBySubcategory","onMount","loadSavedSelection","initPhaser","onDestroy","$.set","rect","config","updatePreview","setGender","selectSkin","selectHair","selectClothing","isCurrentlySelected","filtered","isSelected","handleItemClick","getItemPreviewPath","scene","saveSelection","saved","parsed","e","handleSaveAndPlay","currentAnimation","animations","playAnimation","$.bind_this","div_3","$$value","$.each","div_4","button","classes","$.set_class","button_1","button_2","div_7","button_3","classes_3","div_8","subcategory","button_4","$$render","consequent","$.index","$$anchor","button_5","$.set_attribute","img","$.set_text","text_4","button_6","img_1","text_5","consequent_1","alternate","builderRoot","mount","CharacterBuilder"],"mappings":"iRA8CO,MAAMA,GAAgB,CAC3B,MAAO,GACP,OAAQ,EAIV,EAGaC,GAAyC,CACpD,CAAE,KAAM,OAAQ,KAAM,EAAG,GAAI,EAAG,WAAY,EAAG,UAAW,CAAA,EAC1D,CAAE,KAAM,OAAQ,KAAM,GAAI,GAAI,GAAI,WAAY,EAAG,UAAW,EAAA,EAC5D,CAAE,KAAM,MAAO,KAAM,GAAI,GAAI,GAAI,WAAY,EAAG,UAAW,EAAA,EAC3D,CAAE,KAAM,OAAQ,KAAM,GAAI,GAAI,GAAI,WAAY,EAAG,UAAW,EAAA,EAC5D,CAAE,KAAM,OAAQ,KAAM,GAAI,GAAI,GAAI,WAAY,EAAG,UAAW,EAAA,EAC5D,CAAE,KAAM,SAAU,KAAM,GAAI,GAAI,GAAI,WAAY,EAAG,UAAW,EAAA,EAC9D,CAAE,KAAM,QAAS,KAAM,GAAI,GAAI,GAAI,WAAY,GAAI,UAAW,CAAA,CAChE,EAIaC,GAAiC,CAAC,QAAS,WAAY,MAAM,EAI7DC,GAA8C,CAAC,YAAa,OAAQ,QAAS,MAAM,EAGnFC,GAA2C,CAAC,YAAa,OAAQ,QAAS,OAAQ,MAAM,EAO9F,SAASC,GAAoBC,EAA2B,CAC7D,OAAIA,EAAK,WAAa,YAAcA,EAAK,YAChC,wBAAwBA,EAAK,MAAM,aAAaA,EAAK,WAAW,IAAIA,EAAK,IAAI,GAE/E,wBAAwBA,EAAK,MAAM,IAAIA,EAAK,QAAQ,IAAIA,EAAK,IAAI,EAC1E,CAKO,SAASC,EAAqBD,EAA2B,CAC9D,OAAIA,EAAK,YACA,WAAWA,EAAK,MAAM,IAAIA,EAAK,WAAW,IAAIA,EAAK,EAAE,GAEvD,WAAWA,EAAK,MAAM,IAAIA,EAAK,QAAQ,IAAIA,EAAK,EAAE,EAC3D,CAMO,MAAME,GAA4B,CACvC,CAAE,GAAI,cAAe,KAAM,SAAU,KAAM,iBAAkB,SAAU,QAAS,OAAQ,MAAA,EACxF,CAAE,GAAI,cAAe,KAAM,SAAU,KAAM,iBAAkB,SAAU,QAAS,OAAQ,MAAA,EACxF,CAAE,GAAI,cAAe,KAAM,SAAU,KAAM,iBAAkB,SAAU,QAAS,OAAQ,MAAA,EACxF,CAAE,GAAI,cAAe,KAAM,SAAU,KAAM,iBAAkB,SAAU,QAAS,OAAQ,MAAA,EACxF,CAAE,GAAI,cAAe,KAAM,SAAU,KAAM,iBAAkB,SAAU,QAAS,OAAQ,MAAA,CAC1F,EAEaC,GAA2B,CACtC,CAAE,GAAI,cAAe,KAAM,SAAU,KAAM,iBAAkB,SAAU,OAAQ,OAAQ,MAAA,EACvF,CAAE,GAAI,cAAe,KAAM,SAAU,KAAM,iBAAkB,SAAU,OAAQ,OAAQ,MAAA,EACvF,CAAE,GAAI,cAAe,KAAM,SAAU,KAAM,iBAAkB,SAAU,OAAQ,OAAQ,MAAA,EACvF,CAAE,GAAI,cAAe,KAAM,SAAU,KAAM,iBAAkB,SAAU,OAAQ,OAAQ,MAAA,EACvF,CAAE,GAAI,cAAe,KAAM,SAAU,KAAM,iBAAkB,SAAU,OAAQ,OAAQ,MAAA,CACzF,EAEaC,EAA+B,CAE1C,CAAE,GAAI,uBAAwB,KAAM,kBAAmB,KAAM,sBAAuB,SAAU,WAAY,YAAa,YAAa,OAAQ,MAAA,EAC5I,CAAE,GAAI,wBAAyB,KAAM,mBAAoB,KAAM,uBAAwB,SAAU,WAAY,YAAa,YAAa,OAAQ,MAAA,EAC/I,CAAE,GAAI,wBAAyB,KAAM,mBAAoB,KAAM,uBAAwB,SAAU,WAAY,YAAa,YAAa,OAAQ,MAAA,EAC/I,CAAE,GAAI,qBAAsB,KAAM,gBAAiB,KAAM,oBAAqB,SAAU,WAAY,YAAa,YAAa,OAAQ,MAAA,EACtI,CAAE,GAAI,yBAA0B,KAAM,oBAAqB,KAAM,wBAAyB,SAAU,WAAY,YAAa,YAAa,OAAQ,MAAA,EAElJ,CAAE,GAAI,aAAc,KAAM,QAAS,KAAM,YAAa,SAAU,WAAY,YAAa,OAAQ,OAAQ,MAAA,EACzG,CAAE,GAAI,kBAAmB,KAAM,aAAc,KAAM,iBAAkB,SAAU,WAAY,YAAa,OAAQ,OAAQ,MAAA,EACxH,CAAE,GAAI,mBAAoB,KAAM,cAAe,KAAM,kBAAmB,SAAU,WAAY,YAAa,OAAQ,OAAQ,MAAA,EAC3H,CAAE,GAAI,oBAAqB,KAAM,eAAgB,KAAM,mBAAoB,SAAU,WAAY,YAAa,OAAQ,OAAQ,MAAA,EAC9H,CAAE,GAAI,oBAAqB,KAAM,eAAgB,KAAM,mBAAoB,SAAU,WAAY,YAAa,OAAQ,OAAQ,MAAA,EAE9H,CAAE,GAAI,aAAc,KAAM,QAAS,KAAM,YAAa,SAAU,WAAY,YAAa,QAAS,OAAQ,MAAA,EAC1G,CAAE,GAAI,gBAAiB,KAAM,WAAY,KAAM,eAAgB,SAAU,WAAY,YAAa,QAAS,OAAQ,MAAA,EACnH,CAAE,GAAI,kBAAmB,KAAM,aAAc,KAAM,oBAAqB,SAAU,WAAY,YAAa,QAAS,OAAQ,MAAA,EAC5H,CAAE,GAAI,mBAAoB,KAAM,cAAe,KAAM,qBAAsB,SAAU,WAAY,YAAa,QAAS,OAAQ,MAAA,EAC/H,CAAE,GAAI,oBAAqB,KAAM,eAAgB,KAAM,sBAAuB,SAAU,WAAY,YAAa,QAAS,OAAQ,MAAA,EAClI,CAAE,GAAI,oBAAqB,KAAM,eAAgB,KAAM,sBAAuB,SAAU,WAAY,YAAa,QAAS,OAAQ,MAAA,EAElI,CAAE,GAAI,aAAc,KAAM,QAAS,KAAM,YAAa,SAAU,WAAY,YAAa,OAAQ,OAAQ,MAAA,EACzG,CAAE,GAAI,aAAc,KAAM,QAAS,KAAM,YAAa,SAAU,WAAY,YAAa,OAAQ,OAAQ,MAAA,EAEzG,CAAE,GAAI,aAAc,KAAM,QAAS,KAAM,gBAAiB,SAAU,WAAY,YAAa,OAAQ,OAAQ,MAAA,EAC7G,CAAE,GAAI,aAAc,KAAM,QAAS,KAAM,gBAAiB,SAAU,WAAY,YAAa,OAAQ,OAAQ,MAAA,EAC7G,CAAE,GAAI,aAAc,KAAM,QAAS,KAAM,gBAAiB,SAAU,WAAY,YAAa,OAAQ,OAAQ,MAAA,EAC7G,CAAE,GAAI,aAAc,KAAM,QAAS,KAAM,gBAAiB,SAAU,WAAY,YAAa,OAAQ,OAAQ,MAAA,EAC7G,CAAE,GAAI,aAAc,KAAM,QAAS,KAAM,gBAAiB,SAAU,WAAY,YAAa,OAAQ,OAAQ,MAAA,EAC7G,CAAE,GAAI,aAAc,KAAM,QAAS,KAAM,gBAAiB,SAAU,WAAY,YAAa,OAAQ,OAAQ,MAAA,EAC7G,CAAE,GAAI,aAAc,KAAM,QAAS,KAAM,gBAAiB,SAAU,WAAY,YAAa,OAAQ,OAAQ,MAAA,EAC7G,CAAE,GAAI,aAAc,KAAM,QAAS,KAAM,gBAAiB,SAAU,WAAY,YAAa,OAAQ,OAAQ,MAAA,EAC7G,CAAE,GAAI,aAAc,KAAM,QAAS,KAAM,gBAAiB,SAAU,WAAY,YAAa,OAAQ,OAAQ,MAAA,EAC7G,CAAE,GAAI,cAAe,KAAM,SAAU,KAAM,iBAAkB,SAAU,WAAY,YAAa,OAAQ,OAAQ,MAAA,EAChH,CAAE,GAAI,gBAAiB,KAAM,WAAY,KAAM,oBAAqB,SAAU,WAAY,YAAa,OAAQ,OAAQ,MAAA,EACvH,CAAE,GAAI,iBAAkB,KAAM,YAAa,KAAM,qBAAsB,SAAU,WAAY,YAAa,OAAQ,OAAQ,MAAA,EAC1H,CAAE,GAAI,kBAAmB,KAAM,aAAc,KAAM,sBAAuB,SAAU,WAAY,YAAa,OAAQ,OAAQ,MAAA,EAC7H,CAAE,GAAI,kBAAmB,KAAM,aAAc,KAAM,sBAAuB,SAAU,WAAY,YAAa,OAAQ,OAAQ,MAAA,EAC7H,CAAE,GAAI,eAAgB,KAAM,UAAW,KAAM,mBAAoB,SAAU,WAAY,YAAa,OAAQ,OAAQ,MAAA,EACpH,CAAE,GAAI,mBAAoB,KAAM,cAAe,KAAM,oBAAqB,SAAU,WAAY,YAAa,OAAQ,OAAQ,MAAA,EAC7H,CAAE,GAAI,oBAAqB,KAAM,eAAgB,KAAM,mBAAoB,SAAU,WAAY,YAAa,OAAQ,OAAQ,MAAA,EAC9H,CAAE,GAAI,qBAAsB,KAAM,gBAAiB,KAAM,yBAA0B,SAAU,WAAY,YAAa,OAAQ,OAAQ,MAAA,EACtI,CAAE,GAAI,eAAgB,KAAM,cAAe,KAAM,kBAAmB,SAAU,WAAY,YAAa,OAAQ,OAAQ,MAAA,EACvH,CAAE,GAAI,aAAc,KAAM,YAAa,KAAM,qBAAsB,SAAU,WAAY,YAAa,OAAQ,OAAQ,MAAA,EACtH,CAAE,GAAI,cAAe,KAAM,gBAAiB,KAAM,oBAAqB,SAAU,WAAY,YAAa,OAAQ,OAAQ,MAAA,EAC1H,CAAE,GAAI,oBAAqB,KAAM,wBAAyB,KAAM,+BAAgC,SAAU,WAAY,YAAa,OAAQ,OAAQ,MAAA,CACrJ,EAMaC,GAA8B,CACzC,CAAE,GAAI,gBAAiB,KAAM,SAAU,KAAM,mBAAoB,SAAU,QAAS,OAAQ,QAAA,EAC5F,CAAE,GAAI,gBAAiB,KAAM,SAAU,KAAM,mBAAoB,SAAU,QAAS,OAAQ,QAAA,EAC5F,CAAE,GAAI,gBAAiB,KAAM,SAAU,KAAM,mBAAoB,SAAU,QAAS,OAAQ,QAAA,EAC5F,CAAE,GAAI,gBAAiB,KAAM,SAAU,KAAM,mBAAoB,SAAU,QAAS,OAAQ,QAAA,EAC5F,CAAE,GAAI,gBAAiB,KAAM,SAAU,KAAM,mBAAoB,SAAU,QAAS,OAAQ,QAAA,CAC9F,EAEaC,GAA6B,CACxC,CAAE,GAAI,gBAAiB,KAAM,SAAU,KAAM,mBAAoB,SAAU,OAAQ,OAAQ,QAAA,EAC3F,CAAE,GAAI,gBAAiB,KAAM,SAAU,KAAM,mBAAoB,SAAU,OAAQ,OAAQ,QAAA,EAC3F,CAAE,GAAI,gBAAiB,KAAM,SAAU,KAAM,mBAAoB,SAAU,OAAQ,OAAQ,QAAA,EAC3F,CAAE,GAAI,gBAAiB,KAAM,SAAU,KAAM,mBAAoB,SAAU,OAAQ,OAAQ,QAAA,EAC3F,CAAE,GAAI,gBAAiB,KAAM,SAAU,KAAM,mBAAoB,SAAU,OAAQ,OAAQ,QAAA,CAC7F,EAEaC,EAAiC,CAE5C,CAAE,GAAI,qBAAsB,KAAM,gBAAiB,KAAM,2BAA4B,SAAU,WAAY,YAAa,YAAa,OAAQ,QAAA,EAC7I,CAAE,GAAI,2BAA4B,KAAM,sBAAuB,KAAM,4BAA6B,SAAU,WAAY,YAAa,YAAa,OAAQ,QAAA,EAC1J,CAAE,GAAI,4BAA6B,KAAM,uBAAwB,KAAM,6BAA8B,SAAU,WAAY,YAAa,YAAa,OAAQ,QAAA,EAC7J,CAAE,GAAI,4BAA6B,KAAM,uBAAwB,KAAM,6BAA8B,SAAU,WAAY,YAAa,YAAa,OAAQ,QAAA,EAC7J,CAAE,GAAI,yBAA0B,KAAM,oBAAqB,KAAM,0BAA2B,SAAU,WAAY,YAAa,YAAa,OAAQ,QAAA,EACpJ,CAAE,GAAI,6BAA8B,KAAM,wBAAyB,KAAM,8BAA+B,SAAU,WAAY,YAAa,YAAa,OAAQ,QAAA,EAEhK,CAAE,GAAI,eAAgB,KAAM,QAAS,KAAM,YAAa,SAAU,WAAY,YAAa,OAAQ,OAAQ,QAAA,EAE3G,CAAE,GAAI,gBAAiB,KAAM,SAAU,KAAM,aAAc,SAAU,WAAY,YAAa,QAAS,OAAQ,QAAA,EAC/G,CAAE,GAAI,mBAAoB,KAAM,YAAa,KAAM,gBAAiB,SAAU,WAAY,YAAa,QAAS,OAAQ,QAAA,EACxH,CAAE,GAAI,qBAAsB,KAAM,cAAe,KAAM,kBAAmB,SAAU,WAAY,YAAa,QAAS,OAAQ,QAAA,EAC9H,CAAE,GAAI,wBAAyB,KAAM,iBAAkB,KAAM,qBAAsB,SAAU,WAAY,YAAa,QAAS,OAAQ,QAAA,EACvI,CAAE,GAAI,sBAAuB,KAAM,eAAgB,KAAM,mBAAoB,SAAU,WAAY,YAAa,QAAS,OAAQ,QAAA,EACjI,CAAE,GAAI,yBAA0B,KAAM,kBAAmB,KAAM,sBAAuB,SAAU,WAAY,YAAa,QAAS,OAAQ,QAAA,EAC1I,CAAE,GAAI,uBAAwB,KAAM,gBAAiB,KAAM,oBAAqB,SAAU,WAAY,YAAa,QAAS,OAAQ,QAAA,EACpI,CAAE,GAAI,0BAA2B,KAAM,mBAAoB,KAAM,uBAAwB,SAAU,WAAY,YAAa,QAAS,OAAQ,QAAA,EAC7I,CAAE,GAAI,uBAAwB,KAAM,gBAAiB,KAAM,oBAAqB,SAAU,WAAY,YAAa,QAAS,OAAQ,QAAA,EACpI,CAAE,GAAI,0BAA2B,KAAM,mBAAoB,KAAM,uBAAwB,SAAU,WAAY,YAAa,QAAS,OAAQ,QAAA,EAE7I,CAAE,GAAI,eAAgB,KAAM,QAAS,KAAM,YAAa,SAAU,WAAY,YAAa,OAAQ,OAAQ,QAAA,EAC3G,CAAE,GAAI,qBAAsB,KAAM,cAAe,KAAM,kBAAmB,SAAU,WAAY,YAAa,OAAQ,OAAQ,QAAA,EAC7H,CAAE,GAAI,sBAAuB,KAAM,eAAgB,KAAM,mBAAoB,SAAU,WAAY,YAAa,OAAQ,OAAQ,QAAA,EAChI,CAAE,GAAI,sBAAuB,KAAM,eAAgB,KAAM,mBAAoB,SAAU,WAAY,YAAa,OAAQ,OAAQ,QAAA,EAChI,CAAE,GAAI,mBAAoB,KAAM,YAAa,KAAM,gBAAiB,SAAU,WAAY,YAAa,OAAQ,OAAQ,QAAA,EACvH,CAAE,GAAI,uBAAwB,KAAM,gBAAiB,KAAM,oBAAqB,SAAU,WAAY,YAAa,OAAQ,OAAQ,QAAA,EACnI,CAAE,GAAI,eAAgB,KAAM,QAAS,KAAM,YAAa,SAAU,WAAY,YAAa,OAAQ,OAAQ,QAAA,EAE3G,CAAE,GAAI,eAAgB,KAAM,QAAS,KAAM,kBAAmB,SAAU,WAAY,YAAa,OAAQ,OAAQ,QAAA,EACjH,CAAE,GAAI,eAAgB,KAAM,QAAS,KAAM,kBAAmB,SAAU,WAAY,YAAa,OAAQ,OAAQ,QAAA,EACjH,CAAE,GAAI,eAAgB,KAAM,QAAS,KAAM,kBAAmB,SAAU,WAAY,YAAa,OAAQ,OAAQ,QAAA,EACjH,CAAE,GAAI,eAAgB,KAAM,QAAS,KAAM,kBAAmB,SAAU,WAAY,YAAa,OAAQ,OAAQ,QAAA,EACjH,CAAE,GAAI,eAAgB,KAAM,QAAS,KAAM,kBAAmB,SAAU,WAAY,YAAa,OAAQ,OAAQ,QAAA,EACjH,CAAE,GAAI,iBAAkB,KAAM,eAAgB,KAAM,kBAAmB,SAAU,WAAY,YAAa,OAAQ,OAAQ,QAAA,EAC1H,CAAE,GAAI,iBAAkB,KAAM,eAAgB,KAAM,kBAAmB,SAAU,WAAY,YAAa,OAAQ,OAAQ,QAAA,EAC1H,CAAE,GAAI,iBAAkB,KAAM,eAAgB,KAAM,kBAAmB,SAAU,WAAY,YAAa,OAAQ,OAAQ,QAAA,EAC1H,CAAE,GAAI,iBAAkB,KAAM,eAAgB,KAAM,kBAAmB,SAAU,WAAY,YAAa,OAAQ,OAAQ,QAAA,EAC1H,CAAE,GAAI,iBAAkB,KAAM,eAAgB,KAAM,kBAAmB,SAAU,WAAY,YAAa,OAAQ,OAAQ,QAAA,EAC1H,CAAE,GAAI,kBAAmB,KAAM,WAAY,KAAM,sBAAuB,SAAU,WAAY,YAAa,OAAQ,OAAQ,QAAA,EAC3H,CAAE,GAAI,mBAAoB,KAAM,YAAa,KAAM,uBAAwB,SAAU,WAAY,YAAa,OAAQ,OAAQ,QAAA,EAC9H,CAAE,GAAI,oBAAqB,KAAM,aAAc,KAAM,wBAAyB,SAAU,WAAY,YAAa,OAAQ,OAAQ,QAAA,EACjI,CAAE,GAAI,oBAAqB,KAAM,aAAc,KAAM,wBAAyB,SAAU,WAAY,YAAa,OAAQ,OAAQ,QAAA,EACjI,CAAE,GAAI,iBAAkB,KAAM,UAAW,KAAM,qBAAsB,SAAU,WAAY,YAAa,OAAQ,OAAQ,QAAA,EACxH,CAAE,GAAI,qBAAsB,KAAM,cAAe,KAAM,oBAAqB,SAAU,WAAY,YAAa,OAAQ,OAAQ,QAAA,EAC/H,CAAE,GAAI,uBAAwB,KAAM,gBAAiB,KAAM,2BAA4B,SAAU,WAAY,YAAa,OAAQ,OAAQ,QAAA,EAC1I,CAAE,GAAI,eAAgB,KAAM,YAAa,KAAM,uBAAwB,SAAU,WAAY,YAAa,OAAQ,OAAQ,QAAA,EAC1H,CAAE,GAAI,eAAgB,KAAM,YAAa,KAAM,gBAAiB,SAAU,WAAY,YAAa,OAAQ,OAAQ,QAAA,CACrH,EASO,SAASC,GAAkBC,EAAwD,CACxF,OAAIA,IAAW,OACN,CACL,MAAOP,GACP,KAAMC,GACN,SAAUC,CAAA,EAGP,CACL,MAAOC,GACP,KAAMC,GACN,SAAUC,CAAA,CAEd,CAKO,SAASG,GAAyBD,EAA4D,CACnG,MAAME,EAAWF,IAAW,OAASL,EAAgBG,EAE/CK,EAAqD,CACzD,UAAW,CAAA,EACX,KAAM,CAAA,EACN,MAAO,CAAA,EACP,KAAM,CAAA,EACN,KAAM,CAAA,CAAC,EAGT,OAAAD,EAAS,QAAQX,GAAQ,CACnBA,EAAK,aACPY,EAAOZ,EAAK,WAAW,EAAE,KAAKA,CAAI,CAEtC,CAAC,EAEMY,CACT,CAKO,SAASC,EAAYC,EAAqC,CAK/D,MAJiB,CACf,GAAGZ,GAAY,GAAGC,GAAW,GAAGC,EAChC,GAAGC,GAAc,GAAGC,GAAa,GAAGC,CAAA,EAEtB,KAAKP,GAAQA,EAAK,KAAOc,CAAE,CAC7C,CAKO,SAASC,GAAqBC,EAAqD,CACxF,MAAMC,EAAuB,CAAA,EAE7B,GAAID,EAAU,KAAM,CAClB,MAAME,EAAWL,EAAYG,EAAU,IAAI,EACvCE,GAAUD,EAAM,KAAKC,CAAQ,CACnC,CAEA,GAAIF,EAAU,KAAM,CAClB,MAAMG,EAAWN,EAAYG,EAAU,IAAI,EACvCG,GAAUF,EAAM,KAAKE,CAAQ,CACnC,CAEA,OAAAH,EAAU,SAAS,QAAQI,GAAc,CACvC,MAAMC,EAAeR,EAAYO,CAAU,EACvCC,GAAcJ,EAAM,KAAKI,CAAY,CAC3C,CAAC,EAEMJ,CACT,CAKO,SAASK,GAAoBC,EAAiC,CAOnE,OALgBA,EAAY,OAAOT,GACpBD,EAAYC,CAAE,GACd,cAAgB,MAC9B,EAEc,KAAK,CAACU,EAAGC,IAAM,CAC5B,MAAMC,EAAQb,EAAYW,CAAC,EACrBG,EAAQd,EAAYY,CAAC,EAE3B,GAAI,CAACC,GAAO,aAAe,CAACC,GAAO,YAAa,MAAO,GAEvD,MAAMC,EAAS/B,GAAqB,QAAQ6B,EAAM,WAAW,EACvDG,EAAShC,GAAqB,QAAQ8B,EAAM,WAAW,EAE7D,OAAOC,EAASC,CAClB,CAAC,CACH,CAKO,SAASC,GAAoBP,EAAiC,CACnE,OAAOA,EAAY,OAAOT,GACXD,EAAYC,CAAE,GACd,cAAgB,MAC9B,CACH,CAKO,SAASiB,GAAuBtB,EAA2C,CAChF,MAAMQ,EAAQT,GAAkBC,CAAM,EACtC,MAAO,CACL,OAAAA,EACA,KAAMQ,EAAM,MAAM,CAAC,GAAG,IAAM,KAC5B,KAAMA,EAAM,KAAK,CAAC,GAAG,IAAM,KAC3B,SAAU,CAAA,CAAC,CAEf,CC/UA,MAAqBe,WAA8BC,EAAO,KAAM,CACtD,aAA4C,CAAA,EAC5C,mBAAkC,IAClC,gBAA0B,OAC1B,iBAAqD,KAE7D,aAAc,CACZ,MAAM,CAAE,IAAK,wBAAyB,CACxC,CAEA,QAAS,CAEP,KAAK,MAAM,GAAG,SAAU,KAAK,SAAU,IAAI,EAG3C,KAAK,KAAK,OAAO,KAAK,OAAO,CAC/B,CAKQ,UAAW,CACb,KAAK,aAAa,OAAS,GAC7B,KAAK,oBAAA,CAET,CAKQ,iBAA0B,CAChC,MAAMC,EAAe,KAAK,IAAI,KAAK,QAAQ,KAAK,MAAO,KAAK,QAAQ,KAAK,MAAM,EAE/E,OAAO,KAAK,IAAI,EAAG,KAAK,MAAMA,EAAe,GAAK,GAAI,CAAC,CACzD,CAMQ,qBAAsB,CAC5B,MAAMC,EAAU,KAAK,QAAQ,KAAK,MAAQ,EAEpCC,EAAU,KAAK,QAAQ,KAAK,OAAS,EAAK,KAAK,QAAQ,KAAK,OAAS,IACrEC,EAAQ,KAAK,gBAAA,EAEnB,KAAK,aAAa,QAAQC,GAAU,CAClCA,EAAO,YAAYH,EAASC,CAAO,EACnCE,EAAO,SAASD,CAAK,CACvB,CAAC,CACH,CAKO,gBAAgBrB,EAAsC,CAC3D,KAAK,iBAAmBA,EAExB,MAAMC,EAAQF,GAAqBC,CAAS,EAC5C,KAAK,aAAaC,CAAK,EAAE,KAAK,IAAM,CAClC,KAAK,iBAAA,CACP,CAAC,CACH,CAKA,MAAc,aAAaA,EAAqC,CAC9D,MAAMsB,EAAStB,EAAM,OAAOjB,GAAQ,CAClC,MAAMwC,EAAMvC,EAAqBD,CAAI,EACrC,MAAO,CAAC,KAAK,eAAe,IAAIwC,CAAG,CACrC,CAAC,EAED,GAAID,EAAO,SAAW,EAEtB,OAAO,IAAI,QAASE,GAAY,CAC9BF,EAAO,QAAQvC,GAAQ,CACrB,MAAMwC,EAAMvC,EAAqBD,CAAI,EAC/B0C,EAAO3C,GAAoBC,CAAI,EAErC,KAAK,KAAK,YAAYwC,EAAKE,EAAM,CAC/B,WAAYhD,GAAc,MAC1B,YAAaA,GAAc,MAAA,CAC5B,CACH,CAAC,EAED,KAAK,KAAK,KAAK,WAAY,IAAM,CAC/B6C,EAAO,QAAQvC,GAAQ,CACrB,MAAMwC,EAAMvC,EAAqBD,CAAI,EACrC,KAAK,eAAe,IAAIwC,CAAG,EAC3B,KAAK,2BAA2BA,CAAG,CACrC,CAAC,EACDC,EAAA,CACF,CAAC,EAED,KAAK,KAAK,MAAA,CACZ,CAAC,CACH,CAKQ,2BAA2BE,EAAoB,CACrDhD,GAAmB,QAAQiD,GAAQ,CACjC,MAAMC,EAAU,GAAGF,CAAU,IAAIC,EAAK,IAAI,GAEtC,KAAK,MAAM,OAAOC,CAAO,GAE7B,KAAK,MAAM,OAAO,CAChB,IAAKA,EACL,OAAQ,KAAK,MAAM,qBAAqBF,EAAY,CAClD,MAAOC,EAAK,KACZ,IAAKA,EAAK,EAAA,CACX,EACD,UAAWA,EAAK,UAChB,OAAQA,EAAK,OAAS,QAAU,EAAI,EAAA,CACrC,CACH,CAAC,CACH,CAMQ,kBAAmB,CASzB,GAPA,KAAK,aAAa,QAAQN,GAAU,CAC9BA,GAAUA,EAAO,QACnBA,EAAO,QAAA,CAEX,CAAC,EACD,KAAK,aAAe,CAAA,EAEhB,CAAC,KAAK,iBAAkB,OAE5B,KAAM,CAAE,MAAAQ,EAAO,OAAAC,CAAA,EAAW,KAAK,QAAQ,KACjCZ,EAAUW,EAAQ,EAElBV,EAAUW,EAAS,EAAKA,EAAS,IACjCV,EAAQ,KAAK,gBAAA,EAGnBzC,GAAY,QAAQoD,GAAY,CACd,KAAK,sBAAsBA,CAAQ,EAE3C,QAAQC,GAAU,CACxB,MAAMjD,EAAOa,EAAYoC,CAAM,EAC/B,GAAI,CAACjD,EAAM,OAEX,MAAM2C,EAAa1C,EAAqBD,CAAI,EAC5C,GAAI,CAAC,KAAK,SAAS,OAAO2C,CAAU,EAAG,OAEvC,MAAML,EAAS,KAAK,IAAI,OAAOH,EAASC,EAASO,CAAU,EAC3DL,EAAO,SAASD,CAAK,EACrBC,EAAO,UAAU,GAAK,EAAG,EAEzB,KAAK,aAAa,KAAKA,CAAM,CAC/B,CAAC,CACH,CAAC,EAGcR,GAAoB,KAAK,iBAAiB,QAAQ,EAC1D,QAAQoB,GAAS,CACtB,MAAMlD,EAAOa,EAAYqC,CAAK,EAC9B,GAAI,CAAClD,EAAM,OAEX,MAAM2C,EAAa1C,EAAqBD,CAAI,EAC5C,GAAI,CAAC,KAAK,SAAS,OAAO2C,CAAU,EAAG,OAEvC,MAAML,EAAS,KAAK,IAAI,OAAOH,EAASC,EAASO,CAAU,EAC3DL,EAAO,SAASD,CAAK,EACrBC,EAAO,UAAU,GAAK,EAAG,EAEzB,KAAK,aAAa,KAAKA,CAAM,CAC/B,CAAC,EAGD,KAAK,mBAAmB,KAAK,eAAe,CAC9C,CAKQ,sBAAsBU,EAAqC,CACjE,GAAI,CAAC,KAAK,iBAAkB,MAAO,CAAA,EAEnC,OAAQA,EAAA,CACN,IAAK,QACH,OAAO,KAAK,iBAAiB,KAAO,CAAC,KAAK,iBAAiB,IAAI,EAAI,CAAA,EACrE,IAAK,OACH,OAAO,KAAK,iBAAiB,KAAO,CAAC,KAAK,iBAAiB,IAAI,EAAI,CAAA,EACrE,IAAK,WAEH,OAAO1B,GAAoB,KAAK,iBAAiB,QAAQ,EAC3D,QACE,MAAO,CAAA,CAAC,CAEd,CAKQ,mBAAmB6B,EAAkB,CAC3C,KAAK,aAAa,QAAQb,GAAU,CAElC,MAAMO,EAAU,GADGP,EAAO,QAAQ,GACL,IAAIa,CAAQ,GAErC,KAAK,MAAM,OAAON,CAAO,GAC3BP,EAAO,KAAKO,CAAO,CAEvB,CAAC,CACH,CAKO,cAAcM,EAAkB,CACrC,KAAK,gBAAkBA,EACvB,KAAK,mBAAmBA,CAAQ,CAClC,CAKA,QAAS,CACP,GAAI,KAAK,aAAa,QAAU,EAAG,OAEnC,MAAMC,EAAQ,KAAK,aAAa,CAAC,EACjC,GAAI,CAACA,GAAO,OAAO,aAAc,OAEjC,MAAMC,EAAcD,EAAM,MAAM,aAAa,MAE7C,QAASE,EAAI,EAAGA,EAAI,KAAK,aAAa,OAAQA,IAAK,CACjD,MAAMhB,EAAS,KAAK,aAAagB,CAAC,EAC5BV,EAAON,EAAO,MAAM,YAE1B,GAAIM,GAAQN,EAAO,MAAM,cAAc,QAAUe,EAAa,CAC5D,MAAME,EAAQX,EAAK,OAAOS,CAAW,EACjCE,GACFjB,EAAO,MAAM,gBAAgBiB,CAAK,CAEtC,CACF,CACF,CACF,ujCC9QA,UAwBM,IAAAC,IAAwC,IAAI,EAC5CC,IAA8C,IAAI,EAGlDzC,EAAoC0C,EAAAC,GAAU5B,GAAuB,MAAM,CAAA,CAAA,EAG3E6B,IAAyC,OAAO,EAChDC,IAAwD,OAAO,EAG/DC,EAAYC,GAAA,IAAYvD,GAAiBwD,EAAChD,CAAS,EAAC,MAAM,CAAA,EAC1DiD,EAA4BF,GAAA,IAAYrD,GAAwBsD,EAAChD,CAAS,EAAC,MAAM,CAAA,EAMrFkD,GAAO,IAAO,CACZC,GAAkB,EAClBC,EAAU,CACZ,CAAC,EAEDC,GAAS,IAAO,GACdb,CAAU,GAAE,QAAQ,EAAI,EACxBc,EAAAd,EAAa,IAAI,CACnB,CAAC,EAMQ,SAAAY,GAAa,OACfX,CAAa,EAAA,aAGZc,EAAIP,EAAGP,CAAa,EAAC,sBAAqB,EAC1CX,EAAQ,KAAK,MAAMyB,EAAK,KAAK,GAAK,IAClCxB,EAAS,KAAK,MAAMwB,EAAK,MAAM,GAAK,IAEpCC,EAAoC,CACxC,KAAMvC,EAAO,KACN,MAAAa,EACC,OAAAC,EACR,SAAQU,CAAa,EACrB,YAAa,GACb,SAAU,GACV,MAAK,CACH,KAAMxB,EAAO,MAAM,OACnB,WAAYA,EAAO,MAAM,aAE3B,OAAQD,EAAqB,GAG/BsC,EAAAd,EAAU,IAAOvB,EAAO,KAAKuC,CAAM,EAAA,EAAA,EAGnCR,EAAAR,CAAU,EAAC,OAAO,KAAK,QAAO,IAAQ,CACpCiB,EAAa,CACf,CAAC,CACH,UAMSC,EAAUjE,EAAgB,GAC7BO,CAAS,EAAC,SAAWP,MAEzBO,EAAYe,GAAuBtB,CAAM,EAAA,EAAA,EACzCgE,EAAa,EACf,UAESE,EAAW3E,EAAmB,CACrCgE,EAAAhD,CAAS,EAAC,KAAOhB,EAAK,GACtByE,EAAa,CACf,UAESG,EAAW5E,EAAmB,CAErCgE,EAAAhD,CAAS,EAAC,KAAIgD,EAAGhD,CAAS,EAAC,OAAShB,EAAK,GAAK,KAAOA,EAAK,GAC1DyE,EAAa,CACf,UAESI,GAAe7E,EAAmB,OAGnC8E,EAAmBd,EAAGhD,CAAS,EAAC,SAAS,SAAShB,EAAK,EAAE,EAGzD+E,EAAQf,EAAGhD,CAAS,EAAC,SAAS,OAAOF,GACxBD,EAAYC,CAAE,GACd,cAAgBd,EAAK,WACvC,EAEG8E,IAEF9D,CAAS,EAAC,SAAW+D,EAGrBf,EAAAhD,CAAS,EAAC,SAAQ,CAAA,GAAO+D,EAAU/E,EAAK,EAAE,EAE5CyE,EAAa,CACf,UAYSO,EAAWhF,EAA4B,CACtC,OAAAA,EAAK,SAAQ,KACd,QACI,OAAAgE,EAAAhD,CAAS,EAAC,OAAShB,EAAK,OAC5B,OACI,OAAAgE,EAAAhD,CAAS,EAAC,OAAShB,EAAK,OAC5B,WACI,OAAAgE,EAAAhD,CAAS,EAAC,SAAS,SAAShB,EAAK,EAAE,gBAEnC,GAEb,UAESiF,EAAgBjF,EAAmB,CAClC,OAAAA,EAAK,SAAQ,KACd,QACH2E,EAAW3E,CAAI,YAEZ,OACH4E,EAAW5E,CAAI,YAEZ,WACH6E,GAAe7E,CAAI,QAGzB,UAGSkF,EAAmBlF,EAA2B,CAC9C,OAAAD,GAAoBC,CAAI,CACjC,CAIS,SAAAyE,GAAgB,OAClBjB,CAAU,EAAA,OACT,MAAA2B,IAAQ3B,CAAU,EAAC,MAAM,SAAS,uBAAuB,EAC3D2B,GAASA,EAAM,iBACjBA,EAAM,gBAAenB,EAAChD,CAAS,CAAA,CAEnC,CAES,SAAAoE,IAAgB,CACvB,aAAa,QAAQ,qBAAsB,KAAK,UAASpB,EAAChD,CAAS,CAAA,CAAA,CACrE,CAES,SAAAmD,IAAqB,CACtB,MAAAkB,EAAQ,aAAa,QAAQ,oBAAoB,EACnD,GAAAA,EACE,GAAA,CACI,MAAAC,EAAS,KAAK,MAAMD,CAAK,EAE3BC,EAAO,SAAWA,EAAO,SAAW,QAAUA,EAAO,SAAW,aAClEtE,MACKsE,EACH,SAAU,MAAM,QAAQA,EAAO,QAAQ,EAAIA,EAAO,SAAQ,CAAA,MAGhE,OAASC,EAAG,CACV,QAAQ,KAAK,4CAA6CA,CAAC,CAC7D,CAEJ,CAES,SAAAC,IAAoB,CAC3BJ,GAAa,EAEb,OAAO,SAAS,KAAO,GACzB,CAMI,IAAAK,IAA0B,MAAM,QAC9BC,GAAU,CAAI,OAAQ,KAAK,WAExBC,GAAcxC,EAAkB,IACvCmB,EAAAmB,EAAmBtC,EAAQ,EAAA,KACtBK,CAAU,EAAA,OACT,MAAA2B,IAAQ3B,CAAU,EAAC,MAAM,SAAS,uBAAuB,EAC3D2B,GAASA,EAAM,eACjBA,EAAM,cAAchC,CAAQ,CAEhC,+DAOwCqC,iGAQMI,GAAAC,EAAAC,GAAAxB,EAAAb,WAAAA,CAAa,CAAA,gBAI9CsC,EAAAC,GAAA,GAAA,IAAAN,QAAc9C,IAAI,kBAINqD,EAAA,QAAA,IAAAN,KAAc/C,CAAI,CAAA,oBADnBsD,EAAAC,EAAAF,EAAA,EAAA,yBAAA,KAAAC,EAAA,CAAA,OAAAlC,EAAAyB,CAAgB,MAAK7C,CAAI,CAAA,CAAA,QAGtCA,CAAI,CAAA,mDAaUwD,EAAA,QAAA,IAAA1B,EAAU,MAAM,uBAOhB2B,GAAA,QAAA,IAAA3B,EAAU,QAAQ,iBAQ5BqB,EAAAO,GAAA,GAAA,IAAA1G,QAAeoD,IAAQ,kBAIXuD,EAAA,QAAA,IAAAjC,EAAAV,IAAiBZ,CAAQ,EAAA,EAAA,oBAD1BwD,EAAAL,EAAAI,EAAA,EAAA,6BAAA,KAAAC,EAAA,CAAA,OAAAxC,EAAAJ,CAAc,MAAKZ,CAAQ,CAAA,CAAA,QAGxCA,CAAQ,CAAA,mDAQJ+C,EAAAU,EAAA,GAAA,IAAA3G,QAAqB4G,IAAW,kBAIpBC,EAAA,QAAA,IAAArC,EAAAT,IAA4B6C,CAAW,EAAA,EAAA,oEADxC,OAAA1C,EAAAH,CAAyB,MAAK6C,CAAW,UAGtDA,CAAW,CAAA,+BARf1C,EAAAJ,CAAc,IAAK,YAAUgD,EAAAC,EAAA,wEAiBvB5C,CAA4B,EAAAD,EAACH,CAAyB,CAAA,EAAAiD,EAAA,CAAAC,EAAK/G,IAAI,kBAInDgH,EAAA,QAAA,IAAA/B,IAAgBjF,CAAI,CAAA,yFAC5BiH,EAAAD,EAAA,QAAAhD,EAAAhE,CAAI,EAAC,IAAI,eAG2BiH,EAAAC,EAAA,MAAAlD,EAAAhE,CAAI,EAAC,IAAI,EAE3BmH,EAAAC,EAAApD,EAAAhE,CAAI,EAAC,IAAI,IAPlB,KAAA,CAAA,SAAAgF,IAAWhF,CAAI,CAAA,CAAA,GAKnB,IAAAkF,IAAmBlF,CAAI,CAAA,4DAMhC8D,CAAY,EAAAE,EAACJ,CAAc,CAAA,EAAAkD,EAAA,CAAAC,EAAK/G,IAAI,kBAIxBqH,EAAA,QAAA,IAAApC,IAAgBjF,CAAI,CAAA,yFAC5BiH,EAAAI,EAAA,QAAArD,EAAAhE,CAAI,EAAC,IAAI,eAG2BiH,EAAAK,EAAA,MAAAtD,EAAAhE,CAAI,EAAC,IAAI,EAE3BmH,EAAAI,EAAAvD,EAAAhE,CAAI,EAAC,IAAI,IAPlB,KAAA,CAAA,SAAAgF,IAAWhF,CAAI,CAAA,CAAA,GAKnB,IAAAkF,IAAmBlF,CAAI,CAAA,+BAvBpCgE,EAAAJ,CAAc,IAAK,WAAUgD,EAAAY,EAAA,EAAAZ,EAAAa,GAAA,EAAA,iEA5ClBzG,CAAS,EAAC,SAAW,MAAM,CAAA,yDAO3BA,CAAS,EAAC,SAAW,QAAQ,CAAA,eA3CvD,eCtNA,MAAM0G,GAAc,SAAS,eAAe,cAAc,EAE1D,GAAI,CAACA,GACH,MAAM,IAAI,MAAM,iCAAiC,EAInDC,GAAMC,GAAkB,CACtB,OAAQF,EACV,CAAC"}