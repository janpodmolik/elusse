import{r as to,g as no}from"./phaser-DFK5Ua9d.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();var io=to();const N=no(io),es=!1;var hs=Array.isArray,so=Array.prototype.indexOf,fs=Array.from,Ir=Object.defineProperty,Wn=Object.getOwnPropertyDescriptor,Cr=Object.getOwnPropertyDescriptors,ro=Object.prototype,ao=Array.prototype,gs=Object.getPrototypeOf,Xs=Object.isExtensible;const pt=()=>{};function oo(n){return n()}function yi(n){for(var e=0;e<n.length;e++)n[e]()}function Tr(){var n,e,t=new Promise((i,s)=>{n=i,e=s});return{promise:t,resolve:n,reject:e}}function Dr(n,e){if(Array.isArray(n))return n;if(!(Symbol.iterator in n))return Array.from(n);const t=[];for(const i of n)if(t.push(i),t.length===e)break;return t}const Ye=2,ps=4,Ai=8,lo=1<<24,Lt=16,Rt=32,dn=64,ki=128,vt=512,Xe=1024,tt=2048,Dt=4096,rt=8192,Nt=16384,ms=32768,sn=65536,Ns=1<<17,Ar=1<<18,Mn=1<<19,kr=1<<20,rn=32768,ts=1<<21,vs=1<<22,Zt=1<<23,Yt=Symbol("$state"),co=Symbol(""),_n=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Pr(n){return n===this.v}function Mr(n,e){return n!=n?e==e:n!==e||n!==null&&typeof n=="object"||typeof n=="function"}function $r(n){return!Mr(n,this.v)}function Or(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function uo(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function ho(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function fo(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function go(n){throw new Error("https://svelte.dev/e/effect_orphan")}function po(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function mo(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function vo(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function _o(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function yo(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}let ai=!1,bo=!1;function wo(){ai=!0}const Lr=1,Rr=2,Hr=4,So=8,Eo=16,xo=1,Io=2,ze=Symbol(),Co="http://www.w3.org/1999/xhtml";let pe=null;function In(n){pe=n}function Ie(n,e=!1,t){pe={p:pe,i:!1,c:null,e:null,s:n,x:null,l:ai&&!e?{s:null,u:null,$:[]}:null}}function Ce(n){var e=pe,t=e.e;if(t!==null){e.e=null;for(var i of t)ra(i)}return e.i=!0,pe=e.p,{}}function oi(){return!ai||pe!==null&&pe.l===null}let yn=[];function To(){var n=yn;yn=[],yi(n)}function $n(n){if(yn.length===0){var e=yn;queueMicrotask(()=>{e===yn&&To()})}yn.push(n)}function Do(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Ao(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function ct(n){if(typeof n!="object"||n===null||Yt in n)return n;const e=gs(n);if(e!==ro&&e!==ao)return n;var t=new Map,i=hs(n),s=K(0),r=tn,a=l=>{if(tn===r)return l();var o=J,d=tn;Qe(null),zs(r);var u=l();return Qe(o),zs(d),u};return i&&t.set("length",K(n.length)),new Proxy(n,{defineProperty(l,o,d){(!("value"in d)||d.configurable===!1||d.enumerable===!1||d.writable===!1)&&mo();var u=t.get(o);return u===void 0?u=a(()=>{var h=K(d.value);return t.set(o,h),h}):$(u,d.value,!0),!0},deleteProperty(l,o){var d=t.get(o);if(d===void 0){if(o in l){const u=a(()=>K(ze));t.set(o,u),Bn(s)}}else $(d,ze),Bn(s);return!0},get(l,o,d){if(o===Yt)return n;var u=t.get(o),h=o in l;if(u===void 0&&(!h||Wn(l,o)?.writable)&&(u=a(()=>{var g=ct(h?l[o]:ze),v=K(g);return v}),t.set(o,u)),u!==void 0){var f=c(u);return f===ze?void 0:f}return Reflect.get(l,o,d)},getOwnPropertyDescriptor(l,o){var d=Reflect.getOwnPropertyDescriptor(l,o);if(d&&"value"in d){var u=t.get(o);u&&(d.value=c(u))}else if(d===void 0){var h=t.get(o),f=h?.v;if(h!==void 0&&f!==ze)return{enumerable:!0,configurable:!0,value:f,writable:!0}}return d},has(l,o){if(o===Yt)return!0;var d=t.get(o),u=d!==void 0&&d.v!==ze||Reflect.has(l,o);if(d!==void 0||ie!==null&&(!u||Wn(l,o)?.writable)){d===void 0&&(d=a(()=>{var f=u?ct(l[o]):ze,g=K(f);return g}),t.set(o,d));var h=c(d);if(h===ze)return!1}return u},set(l,o,d,u){var h=t.get(o),f=o in l;if(i&&o==="length")for(var g=d;g<h.v;g+=1){var v=t.get(g+"");v!==void 0?$(v,ze):g in l&&(v=a(()=>K(ze)),t.set(g+"",v))}if(h===void 0)(!f||Wn(l,o)?.writable)&&(h=a(()=>K(void 0)),$(h,ct(d)),t.set(o,h));else{f=h.v!==ze;var S=a(()=>ct(d));$(h,S)}var _=Reflect.getOwnPropertyDescriptor(l,o);if(_?.set&&_.set.call(u,d),!f){if(i&&typeof o=="string"){var p=t.get("length"),w=Number(o);Number.isInteger(w)&&w>=p.v&&$(p,w+1)}Bn(s)}return!0},ownKeys(l){c(s);var o=Reflect.ownKeys(l).filter(h=>{var f=t.get(h);return f===void 0||f.v!==ze});for(var[d,u]of t)u.v!==ze&&!(d in l)&&o.push(d);return o},setPrototypeOf(){vo()}})}function Zs(n){try{if(n!==null&&typeof n=="object"&&Yt in n)return n[Yt]}catch{}return n}function ko(n,e){return Object.is(Zs(n),Zs(e))}var Ys,Fr,Xr,Nr,Zr;function Po(){if(Ys===void 0){Ys=window,Fr=document,Xr=/Firefox/.test(navigator.userAgent);var n=Element.prototype,e=Node.prototype,t=Text.prototype;Nr=Wn(e,"firstChild").get,Zr=Wn(e,"nextSibling").get,Xs(n)&&(n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__style=void 0,n.__e=void 0),Xs(t)&&(t.__t=void 0)}}function Ot(n=""){return document.createTextNode(n)}function bi(n){return Nr.call(n)}function li(n){return Zr.call(n)}function P(n,e){return bi(n)}function ge(n,e=!1){{var t=bi(n);return t instanceof Comment&&t.data===""?li(t):t}}function k(n,e=1,t=!1){let i=n;for(;e--;)i=li(i);return i}function Mo(n){n.textContent=""}function Yr(){return!1}function Wr(n){var e=ie;if(e===null)return J.f|=Zt,n;if((e.f&ms)===0){if((e.f&ki)===0)throw n;e.b.error(n)}else Cn(n,e)}function Cn(n,e){for(;e!==null;){if((e.f&ki)!==0)try{e.b.error(n);return}catch(t){n=t}e=e.parent}throw n}const di=new Set;let ve=null,dt=null,xt=[],_s=null,ns=!1;class It{committed=!1;current=new Map;previous=new Map;#e=new Set;#t=new Set;#i=0;#n=0;#l=null;#r=[];#s=[];skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#n>0}process(e){xt=[],this.apply();var t={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const i of e)this.#a(i,t);this.is_fork||this.#d(),this.is_deferred()?(this.#o(t.effects),this.#o(t.render_effects),this.#o(t.block_effects)):(ve=null,Ws(t.render_effects),Ws(t.effects),this.#l?.resolve()),dt=null}#a(e,t){e.f^=Xe;for(var i=e.first;i!==null;){var s=i.f,r=(s&(Rt|dn))!==0,a=r&&(s&Xe)!==0,l=a||(s&rt)!==0||this.skipped_effects.has(i);if((i.f&ki)!==0&&i.b?.is_pending()&&(t={parent:t,effect:i,effects:[],render_effects:[],block_effects:[]}),!l&&i.fn!==null){r?i.f^=Xe:(s&ps)!==0?t.effects.push(i):Ln(i)&&((i.f&Lt)!==0&&t.block_effects.push(i),Dn(i));var o=i.first;if(o!==null){i=o;continue}}var d=i.parent;for(i=i.next;i===null&&d!==null;)d===t.effect&&(this.#o(t.effects),this.#o(t.render_effects),this.#o(t.block_effects),t=t.parent),i=d.next,d=d.parent}}#o(e){for(const t of e)((t.f&tt)!==0?this.#r:this.#s).push(t),this.#c(t.deps),Ne(t,Xe)}#c(e){if(e!==null)for(const t of e)(t.f&Ye)===0||(t.f&rn)===0||(t.f^=rn,this.#c(t.deps))}capture(e,t){this.previous.has(e)||this.previous.set(e,t),(e.f&Zt)===0&&(this.current.set(e,e.v),dt?.set(e,e.v))}activate(){ve=this,this.apply()}deactivate(){ve===this&&(ve=null,dt=null)}flush(){if(this.activate(),xt.length>0){if($o(),ve!==null&&ve!==this)return}else this.#i===0&&this.process([]);this.deactivate()}discard(){for(const e of this.#t)e(this);this.#t.clear()}#d(){if(this.#n===0){for(const e of this.#e)e();this.#e.clear()}this.#i===0&&this.#u()}#u(){if(di.size>1){this.previous.clear();var e=dt,t=!0,i={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const r of di){if(r===this){t=!1;continue}const a=[];for(const[o,d]of this.current){if(r.current.has(o))if(t&&d!==r.current.get(o))r.current.set(o,d);else continue;a.push(o)}if(a.length===0)continue;const l=[...r.current.keys()].filter(o=>!this.current.has(o));if(l.length>0){var s=xt;xt=[];const o=new Set,d=new Map;for(const u of a)Br(u,l,o,d);if(xt.length>0){ve=r,r.apply();for(const u of xt)r.#a(u,i);r.deactivate()}xt=s}}ve=null,dt=e}this.committed=!0,di.delete(this)}increment(e){this.#i+=1,e&&(this.#n+=1)}decrement(e){this.#i-=1,e&&(this.#n-=1),this.revive()}revive(){for(const e of this.#r)Ne(e,tt),an(e);for(const e of this.#s)Ne(e,Dt),an(e);this.#r=[],this.#s=[],this.flush()}oncommit(e){this.#e.add(e)}ondiscard(e){this.#t.add(e)}settled(){return(this.#l??=Tr()).promise}static ensure(){if(ve===null){const e=ve=new It;di.add(ve),It.enqueue(()=>{ve===e&&e.flush()})}return ve}static enqueue(e){$n(e)}apply(){}}function $o(){var n=Bt;ns=!0;var e=null;try{var t=0;for(Si(!0);xt.length>0;){var i=It.ensure();if(t++>1e3){var s,r;Oo()}i.process(xt),Wt.clear()}}finally{ns=!1,Si(n),_s=null}}function Oo(){try{po()}catch(n){Cn(n,_s)}}let Pt=null;function Ws(n){var e=n.length;if(e!==0){for(var t=0;t<e;){var i=n[t++];if((i.f&(Nt|rt))===0&&Ln(i)&&(Pt=new Set,Dn(i),i.deps===null&&i.first===null&&i.nodes_start===null&&(i.teardown===null&&i.ac===null?la(i):i.fn=null),Pt?.size>0)){Wt.clear();for(const s of Pt){if((s.f&(Nt|rt))!==0)continue;const r=[s];let a=s.parent;for(;a!==null;)Pt.has(a)&&(Pt.delete(a),r.push(a)),a=a.parent;for(let l=r.length-1;l>=0;l--){const o=r[l];(o.f&(Nt|rt))===0&&Dn(o)}}Pt.clear()}}Pt=null}}function Br(n,e,t,i){if(!t.has(n)&&(t.add(n),n.reactions!==null))for(const s of n.reactions){const r=s.f;(r&Ye)!==0?Br(s,e,t,i):(r&(vs|Lt))!==0&&(r&tt)===0&&zr(s,e,i)&&(Ne(s,tt),an(s))}}function zr(n,e,t){const i=t.get(n);if(i!==void 0)return i;if(n.deps!==null)for(const s of n.deps){if(e.includes(s))return!0;if((s.f&Ye)!==0&&zr(s,e,t))return t.set(s,!0),!0}return t.set(n,!1),!1}function an(n){for(var e=_s=n;e.parent!==null;){e=e.parent;var t=e.f;if(ns&&e===ie&&(t&Lt)!==0&&(t&Ar)===0)return;if((t&(dn|Rt))!==0){if((t&Xe)===0)return;e.f^=Xe}}xt.push(e)}function Lo(n){let e=0,t=on(0),i;return()=>{jn()&&(c(t),$i(()=>(e===0&&(i=zt(()=>n(()=>Bn(t)))),e+=1,()=>{$n(()=>{e-=1,e===0&&(i?.(),i=void 0,Bn(t))})})))}}var Ro=sn|Mn|ki;function Ho(n,e,t){new Fo(n,e,t)}class Fo{parent;#e=!1;#t;#i=null;#n;#l;#r;#s=null;#a=null;#o=null;#c=null;#d=null;#u=0;#h=0;#g=!1;#f=null;#y=Lo(()=>(this.#f=on(this.#u),()=>{this.#f=null}));constructor(e,t,i){this.#t=e,this.#n=t,this.#l=i,this.parent=ie.b,this.#e=!!this.#n.pending,this.#r=Oi(()=>{ie.b=this;{var s=this.#v();try{this.#s=lt(()=>i(s))}catch(r){this.error(r)}this.#h>0?this.#m():this.#e=!1}return()=>{this.#d?.remove()}},Ro)}#b(){try{this.#s=lt(()=>this.#l(this.#t))}catch(e){this.error(e)}this.#e=!1}#w(){const e=this.#n.pending;e&&(this.#a=lt(()=>e(this.#t)),It.enqueue(()=>{var t=this.#v();this.#s=this.#p(()=>(It.ensure(),lt(()=>this.#l(t)))),this.#h>0?this.#m():(wn(this.#a,()=>{this.#a=null}),this.#e=!1)}))}#v(){var e=this.#t;return this.#e&&(this.#d=Ot(),this.#t.before(this.#d),e=this.#d),e}is_pending(){return this.#e||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!this.#n.pending}#p(e){var t=ie,i=J,s=pe;Tt(this.#r),Qe(this.#r),In(this.#r.ctx);try{return e()}catch(r){return Wr(r),null}finally{Tt(t),Qe(i),In(s)}}#m(){const e=this.#n.pending;this.#s!==null&&(this.#c=document.createDocumentFragment(),this.#c.append(this.#d),ua(this.#s,this.#c)),this.#a===null&&(this.#a=lt(()=>e(this.#t)))}#_(e){if(!this.has_pending_snippet()){this.parent&&this.parent.#_(e);return}this.#h+=e,this.#h===0&&(this.#e=!1,this.#a&&wn(this.#a,()=>{this.#a=null}),this.#c&&(this.#t.before(this.#c),this.#c=null))}update_pending_count(e){this.#_(e),this.#u+=e,this.#f&&Tn(this.#f,this.#u)}get_effect_pending(){return this.#y(),c(this.#f)}error(e){var t=this.#n.onerror;let i=this.#n.failed;if(this.#g||!t&&!i)throw e;this.#s&&(et(this.#s),this.#s=null),this.#a&&(et(this.#a),this.#a=null),this.#o&&(et(this.#o),this.#o=null);var s=!1,r=!1;const a=()=>{if(s){Ao();return}s=!0,r&&yo(),It.ensure(),this.#u=0,this.#o!==null&&wn(this.#o,()=>{this.#o=null}),this.#e=this.has_pending_snippet(),this.#s=this.#p(()=>(this.#g=!1,lt(()=>this.#l(this.#t)))),this.#h>0?this.#m():this.#e=!1};var l=J;try{Qe(null),r=!0,t?.(e,a),r=!1}catch(o){Cn(o,this.#r&&this.#r.parent)}finally{Qe(l)}i&&$n(()=>{this.#o=this.#p(()=>{It.ensure(),this.#g=!0;try{return lt(()=>{i(this.#t,()=>e,()=>a)})}catch(o){return Cn(o,this.#r.parent),null}finally{this.#g=!1}})})}}function ht(n,e){return e}function Xo(n,e,t){for(var i=[],s=e.length,r=0;r<s;r++)Ss(e[r].e,i,!0);ca(i,()=>{var a=i.length===0&&t!==null;if(a){var l=t,o=l.parentNode;Mo(o),o.append(l),n.items.clear(),Et(n,e[0].prev,e[s-1].next)}for(var d=0;d<s;d++){var u=e[d];a||(n.items.delete(u.k),Et(n,u.prev,u.next)),et(u.e,!a)}n.first===e[0]&&(n.first=e[0].prev)})}function st(n,e,t,i,s,r=null){var a=n,l=new Map,o=null,d=(e&Hr)!==0,u=(e&Lr)!==0,h=(e&Rr)!==0;if(d){var f=n;a=f.appendChild(Ot())}var g=null,v=Kr(()=>{var b=t();return hs(b)?b:b==null?[]:fs(b)}),S,_=!0;function p(){No(y,S,a,e,i),g!==null&&(S.length===0?(g.fragment?(a.before(g.fragment),g.fragment=null):Es(g.effect),w.first=g.effect):wn(g.effect,()=>{g=null}))}var w=Oi(()=>{S=c(v);for(var b=S.length,m=new Set,I=ve,x=null,C=Yr(),M=0;M<b;M+=1){var T=S[M],A=i(T,M),D=_?null:l.get(A);D?(u&&Tn(D.v,T),h?Tn(D.i,M):D.i=M,C&&I.skipped_effects.delete(D.e)):(D=Zo(_?a:null,x,T,A,M,s,e,t),_&&(D.o=!0,x===null?o=D:x.next=D,x=D),l.set(A,D)),m.add(A)}if(b===0&&r&&!g)if(_)g={fragment:null,effect:lt(()=>r(a))};else{var L=document.createDocumentFragment(),z=Ot();L.append(z),g={fragment:L,effect:lt(()=>r(z))}}if(!_)if(C){for(const[Z,F]of l)m.has(Z)||I.skipped_effects.add(F.e);I.oncommit(p),I.ondiscard(()=>{})}else p();c(v)}),y={effect:w,items:l,first:o};_=!1}function No(n,e,t,i,s){var r=(i&So)!==0,a=e.length,l=n.items,o=n.first,d,u=null,h,f=[],g=[],v,S,_,p;if(r)for(p=0;p<a;p+=1)v=e[p],S=s(v,p),_=l.get(S),_.a?.measure(),(h??=new Set).add(_);for(p=0;p<a;p+=1){if(v=e[p],S=s(v,p),_=l.get(S),n.first??=_,!_.o){_.o=!0;var w=u?u.next:o;Et(n,u,_),Et(n,_,w),Zi(_,w,t),u=_,f=[],g=[],o=u.next;continue}if((_.e.f&rt)!==0&&(Es(_.e),r&&(_.a?.unfix(),(h??=new Set).delete(_))),_!==o){if(d!==void 0&&d.has(_)){if(f.length<g.length){var y=g[0],b;u=y.prev;var m=f[0],I=f[f.length-1];for(b=0;b<f.length;b+=1)Zi(f[b],y,t);for(b=0;b<g.length;b+=1)d.delete(g[b]);Et(n,m.prev,I.next),Et(n,u,m),Et(n,I,y),o=y,u=I,p-=1,f=[],g=[]}else d.delete(_),Zi(_,o,t),Et(n,_.prev,_.next),Et(n,_,u===null?n.first:u.next),Et(n,u,_),u=_;continue}for(f=[],g=[];o!==null&&o.k!==S;)(o.e.f&rt)===0&&(d??=new Set).add(o),g.push(o),o=o.next;if(o===null)continue;_=o}f.push(_),u=_,o=_.next}if(o!==null||d!==void 0){for(var x=d===void 0?[]:fs(d);o!==null;)(o.e.f&rt)===0&&x.push(o),o=o.next;var C=x.length;if(C>0){var M=(i&Hr)!==0&&a===0?t:null;if(r){for(p=0;p<C;p+=1)x[p].a?.measure();for(p=0;p<C;p+=1)x[p].a?.fix()}Xo(n,x,M)}}r&&$n(()=>{if(h!==void 0)for(_ of h)_.a?.apply()})}function Zo(n,e,t,i,s,r,a,l){var o=(a&Lr)!==0,d=(a&Eo)===0,u=o?d?bs(t,!1,!1):on(t):t,h=(a&Rr)===0?s:on(s),f={i:h,v:u,k:i,a:null,e:null,o:!1,prev:e,next:null};try{if(n===null){var g=document.createDocumentFragment();g.append(n=Ot())}return f.e=lt(()=>r(n,u,h,l)),e!==null&&(e.next=f),f}finally{}}function Zi(n,e,t){for(var i=n.next?n.next.e.nodes_start:t,s=e?e.e.nodes_start:t,r=n.e.nodes_start;r!==null&&r!==i;){var a=li(r);s.before(r),r=a}}function Et(n,e,t){e===null?(n.first=t,n.effect.first=t&&t.e):(e.e.next&&(e.e.next.prev=null),e.next=t,e.e.next=t&&t.e),t===null?n.effect.last=e&&e.e:(t.e.prev&&(t.e.prev.next=null),t.prev=e,t.e.prev=e&&e.e)}function Yo(n,e,t,i){const s=oi()?Pi:Kr;if(t.length===0&&n.length===0){i(e.map(s));return}var r=ve,a=ie,l=Wo();function o(){Promise.all(t.map(d=>Bo(d))).then(d=>{l();try{i([...e.map(s),...d])}catch(u){(a.f&Nt)===0&&Cn(u,a)}r?.deactivate(),wi()}).catch(d=>{Cn(d,a)})}n.length>0?Promise.all(n).then(()=>{l();try{return o()}finally{r?.deactivate(),wi()}}):o()}function Wo(){var n=ie,e=J,t=pe,i=ve;return function(r=!0){Tt(n),Qe(e),In(t),r&&i?.activate()}}function wi(){Tt(null),Qe(null),In(null)}function Pi(n){var e=Ye|tt,t=J!==null&&(J.f&Ye)!==0?J:null;return ie!==null&&(ie.f|=Mn),{ctx:pe,deps:null,effects:null,equals:Pr,f:e,fn:n,reactions:null,rv:0,v:ze,wv:0,parent:t??ie,ac:null}}function Bo(n,e){let t=ie;t===null&&uo();var i=t.b,s=void 0,r=on(ze),a=!J,l=new Map;return nl(()=>{var o=Tr();s=o.promise;try{Promise.resolve(n()).then(o.resolve,o.reject).then(()=>{d===ve&&d.committed&&d.deactivate(),wi()})}catch(f){o.reject(f),wi()}var d=ve;if(a){var u=!i.is_pending();i.update_pending_count(1),d.increment(u),l.get(d)?.reject(_n),l.delete(d),l.set(d,o)}const h=(f,g=void 0)=>{if(d.activate(),g)g!==_n&&(r.f|=Zt,Tn(r,g));else{(r.f&Zt)!==0&&(r.f^=Zt),Tn(r,f);for(const[v,S]of l){if(l.delete(v),v===d)break;S.reject(_n)}}a&&(i.update_pending_count(-1),d.decrement(u))};o.promise.then(h,f=>h(null,f||"unknown"))}),Mi(()=>{for(const o of l.values())o.reject(_n)}),new Promise(o=>{function d(u){function h(){u===s?o(r):d(s)}u.then(h,h)}d(s)})}function X(n){const e=Pi(n);return qr(e),e}function Kr(n){const e=Pi(n);return e.equals=$r,e}function Gr(n){var e=n.effects;if(e!==null){n.effects=null;for(var t=0;t<e.length;t+=1)et(e[t])}}function zo(n){for(var e=n.parent;e!==null;){if((e.f&Ye)===0)return(e.f&Nt)===0?e:null;e=e.parent}return null}function ys(n){var e,t=ie;Tt(zo(n));try{n.f&=~rn,Gr(n),e=ta(n)}finally{Tt(t)}return e}function Ur(n){var e=ys(n);if(n.equals(e)||(ve?.is_fork||(n.v=e),n.wv=Qr()),!On)if(dt!==null)(jn()||ve?.is_fork)&&dt.set(n,e);else{var t=(n.f&vt)===0?Dt:Xe;Ne(n,t)}}let is=new Set;const Wt=new Map;let Vr=!1;function on(n,e){var t={f:0,v:n,reactions:null,equals:Pr,rv:0,wv:0};return t}function K(n,e){const t=on(n);return qr(t),t}function bs(n,e=!1,t=!0){const i=on(n);return e||(i.equals=$r),ai&&t&&pe!==null&&pe.l!==null&&(pe.l.s??=[]).push(i),i}function $(n,e,t=!1){J!==null&&(!Ct||(J.f&Ns)!==0)&&oi()&&(J.f&(Ye|Lt|vs|Ns))!==0&&!Mt?.includes(n)&&_o();let i=t?ct(e):e;return Tn(n,i)}function Tn(n,e){if(!n.equals(e)){var t=n.v;On?Wt.set(n,e):Wt.set(n,t),n.v=e;var i=It.ensure();i.capture(n,t),(n.f&Ye)!==0&&((n.f&tt)!==0&&ys(n),Ne(n,(n.f&vt)!==0?Xe:Dt)),n.wv=Qr(),jr(n,tt),oi()&&ie!==null&&(ie.f&Xe)!==0&&(ie.f&(Rt|dn))===0&&(ot===null?Go([n]):ot.push(n)),!i.is_fork&&is.size>0&&!Vr&&Ko()}return e}function Ko(){Vr=!1;var n=Bt;Si(!0);const e=Array.from(is);try{for(const t of e)(t.f&Xe)!==0&&Ne(t,Dt),Ln(t)&&Dn(t)}finally{Si(n)}is.clear()}function Bn(n){$(n,n.v+1)}function jr(n,e){var t=n.reactions;if(t!==null)for(var i=oi(),s=t.length,r=0;r<s;r++){var a=t[r],l=a.f;if(!(!i&&a===ie)){var o=(l&tt)===0;if(o&&Ne(a,e),(l&Ye)!==0){var d=a;dt?.delete(d),(l&rn)===0&&(l&vt&&(a.f|=rn),jr(d,Dt))}else o&&((l&Lt)!==0&&Pt!==null&&Pt.add(a),an(a))}}}function ws(n){var e=J,t=ie;Qe(null),Tt(null);try{return n()}finally{Qe(e),Tt(t)}}let Bt=!1;function Si(n){Bt=n}let On=!1;function Bs(n){On=n}let J=null,Ct=!1;function Qe(n){J=n}let ie=null;function Tt(n){ie=n}let Mt=null;function qr(n){J!==null&&(Mt===null?Mt=[n]:Mt.push(n))}let qe=null,it=0,ot=null;function Go(n){ot=n}let Jr=1,Vn=0,tn=Vn;function zs(n){tn=n}function Qr(){return++Jr}function Ln(n){var e=n.f;if((e&tt)!==0)return!0;if(e&Ye&&(n.f&=~rn),(e&Dt)!==0){var t=n.deps;if(t!==null)for(var i=t.length,s=0;s<i;s++){var r=t[s];if(Ln(r)&&Ur(r),r.wv>n.wv)return!0}(e&vt)!==0&&dt===null&&Ne(n,Xe)}return!1}function ea(n,e,t=!0){var i=n.reactions;if(i!==null&&!Mt?.includes(n))for(var s=0;s<i.length;s++){var r=i[s];(r.f&Ye)!==0?ea(r,e,!1):e===r&&(t?Ne(r,tt):(r.f&Xe)!==0&&Ne(r,Dt),an(r))}}function ta(n){var e=qe,t=it,i=ot,s=J,r=Mt,a=pe,l=Ct,o=tn,d=n.f;qe=null,it=0,ot=null,J=(d&(Rt|dn))===0?n:null,Mt=null,In(n.ctx),Ct=!1,tn=++Vn,n.ac!==null&&(ws(()=>{n.ac.abort(_n)}),n.ac=null);try{n.f|=ts;var u=n.fn,h=u(),f=n.deps;if(qe!==null){var g;if(Ei(n,it),f!==null&&it>0)for(f.length=it+qe.length,g=0;g<qe.length;g++)f[it+g]=qe[g];else n.deps=f=qe;if(Bt&&jn()&&(n.f&vt)!==0)for(g=it;g<f.length;g++)(f[g].reactions??=[]).push(n)}else f!==null&&it<f.length&&(Ei(n,it),f.length=it);if(oi()&&ot!==null&&!Ct&&f!==null&&(n.f&(Ye|Dt|tt))===0)for(g=0;g<ot.length;g++)ea(ot[g],n);return s!==null&&s!==n&&(Vn++,ot!==null&&(i===null?i=ot:i.push(...ot))),(n.f&Zt)!==0&&(n.f^=Zt),h}catch(v){return Wr(v)}finally{n.f^=ts,qe=e,it=t,ot=i,J=s,Mt=r,In(a),Ct=l,tn=o}}function Uo(n,e){let t=e.reactions;if(t!==null){var i=so.call(t,n);if(i!==-1){var s=t.length-1;s===0?t=e.reactions=null:(t[i]=t[s],t.pop())}}t===null&&(e.f&Ye)!==0&&(qe===null||!qe.includes(e))&&(Ne(e,Dt),(e.f&vt)!==0&&(e.f^=vt,e.f&=~rn),Gr(e),Ei(e,0))}function Ei(n,e){var t=n.deps;if(t!==null)for(var i=e;i<t.length;i++)Uo(n,t[i])}function Dn(n){var e=n.f;if((e&Nt)===0){Ne(n,Xe);var t=ie,i=Bt;ie=n,Bt=!0;try{(e&(Lt|lo))!==0?il(n):oa(n),aa(n);var s=ta(n);n.teardown=typeof s=="function"?s:null,n.wv=Jr;var r;es&&bo&&(n.f&tt)!==0&&n.deps}finally{Bt=i,ie=t}}}function c(n){var e=n.f,t=(e&Ye)!==0;if(J!==null&&!Ct){var i=ie!==null&&(ie.f&Nt)!==0;if(!i&&!Mt?.includes(n)){var s=J.deps;if((J.f&ts)!==0)n.rv<Vn&&(n.rv=Vn,qe===null&&s!==null&&s[it]===n?it++:qe===null?qe=[n]:qe.includes(n)||qe.push(n));else{(J.deps??=[]).push(n);var r=n.reactions;r===null?n.reactions=[J]:r.includes(J)||r.push(J)}}}if(On){if(Wt.has(n))return Wt.get(n);if(t){var a=n,l=a.v;return((a.f&Xe)===0&&a.reactions!==null||ia(a))&&(l=ys(a)),Wt.set(a,l),l}}else t&&(!dt?.has(n)||ve?.is_fork&&!jn())&&(a=n,Ln(a)&&Ur(a),Bt&&jn()&&(a.f&vt)===0&&na(a));if(dt?.has(n))return dt.get(n);if((n.f&Zt)!==0)throw n.v;return n.v}function na(n){if(n.deps!==null){n.f^=vt;for(const e of n.deps)(e.reactions??=[]).push(n),(e.f&Ye)!==0&&(e.f&vt)===0&&na(e)}}function ia(n){if(n.v===ze)return!0;if(n.deps===null)return!1;for(const e of n.deps)if(Wt.has(e)||(e.f&Ye)!==0&&ia(e))return!0;return!1}function zt(n){var e=Ct;try{return Ct=!0,n()}finally{Ct=e}}const Vo=-7169;function Ne(n,e){n.f=n.f&Vo|e}function jo(n){if(!(typeof n!="object"||!n||n instanceof EventTarget)){if(Yt in n)ss(n);else if(!Array.isArray(n))for(let e in n){const t=n[e];typeof t=="object"&&t&&Yt in t&&ss(t)}}}function ss(n,e=new Set){if(typeof n=="object"&&n!==null&&!(n instanceof EventTarget)&&!e.has(n)){e.add(n),n instanceof Date&&n.getTime();for(let i in n)try{ss(n[i],e)}catch{}const t=gs(n);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const i=Cr(t);for(let s in i){const r=i[s].get;if(r)try{r.call(n)}catch{}}}}}function sa(n){ie===null&&(J===null&&go(),fo()),On&&ho()}function qo(n,e){var t=e.last;t===null?e.last=e.first=n:(t.next=n,n.prev=t,e.last=n)}function At(n,e,t){var i=ie;i!==null&&(i.f&rt)!==0&&(n|=rt);var s={ctx:pe,deps:null,nodes_start:null,nodes_end:null,f:n|tt|vt,first:null,fn:e,last:null,next:null,parent:i,b:i&&i.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(t)try{Dn(s),s.f|=ms}catch(l){throw et(s),l}else e!==null&&an(s);var r=s;if(t&&r.deps===null&&r.teardown===null&&r.nodes_start===null&&r.first===r.last&&(r.f&Mn)===0&&(r=r.first,(n&Lt)!==0&&(n&sn)!==0&&r!==null&&(r.f|=sn)),r!==null&&(r.parent=i,i!==null&&qo(r,i),J!==null&&(J.f&Ye)!==0&&(n&dn)===0)){var a=J;(a.effects??=[]).push(r)}return s}function jn(){return J!==null&&!Ct}function Mi(n){const e=At(Ai,null,!1);return Ne(e,Xe),e.teardown=n,e}function Ze(n){sa();var e=ie.f,t=!J&&(e&Rt)!==0&&(e&ms)===0;if(t){var i=pe;(i.e??=[]).push(n)}else return ra(n)}function ra(n){return At(ps|kr,n,!1)}function Jo(n){return sa(),At(Ai|kr,n,!0)}function Qo(n){It.ensure();const e=At(dn|Mn,n,!0);return(t={})=>new Promise(i=>{t.outro?wn(e,()=>{et(e),i(void 0)}):(et(e),i(void 0))})}function el(n){return At(ps,n,!1)}function Ks(n,e){var t=pe,i={effect:null,ran:!1,deps:n};t.l.$.push(i),i.effect=$i(()=>{n(),!i.ran&&(i.ran=!0,zt(e))})}function tl(){var n=pe;$i(()=>{for(var e of n.l.$){e.deps();var t=e.effect;(t.f&Xe)!==0&&Ne(t,Dt),Ln(t)&&Dn(t),e.ran=!1}})}function nl(n){return At(vs|Mn,n,!0)}function $i(n,e=0){return At(Ai|e,n,!0)}function G(n,e=[],t=[],i=[]){Yo(i,e,t,s=>{At(Ai,()=>n(...s.map(c)),!0)})}function Oi(n,e=0){var t=At(Lt|e,n,!0);return t}function lt(n){return At(Rt|Mn,n,!0)}function aa(n){var e=n.teardown;if(e!==null){const t=On,i=J;Bs(!0),Qe(null);try{e.call(null)}finally{Bs(t),Qe(i)}}}function oa(n,e=!1){var t=n.first;for(n.first=n.last=null;t!==null;){const s=t.ac;s!==null&&ws(()=>{s.abort(_n)});var i=t.next;(t.f&dn)!==0?t.parent=null:et(t,e),t=i}}function il(n){for(var e=n.first;e!==null;){var t=e.next;(e.f&Rt)===0&&et(e),e=t}}function et(n,e=!0){var t=!1;(e||(n.f&Ar)!==0)&&n.nodes_start!==null&&n.nodes_end!==null&&(sl(n.nodes_start,n.nodes_end),t=!0),oa(n,e&&!t),Ei(n,0),Ne(n,Nt);var i=n.transitions;if(i!==null)for(const r of i)r.stop();aa(n);var s=n.parent;s!==null&&s.first!==null&&la(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes_start=n.nodes_end=n.ac=null}function sl(n,e){for(;n!==null;){var t=n===e?null:li(n);n.remove(),n=t}}function la(n){var e=n.parent,t=n.prev,i=n.next;t!==null&&(t.next=i),i!==null&&(i.prev=t),e!==null&&(e.first===n&&(e.first=i),e.last===n&&(e.last=t))}function wn(n,e,t=!0){var i=[];Ss(n,i,!0),ca(i,()=>{t&&et(n),e&&e()})}function ca(n,e){var t=n.length;if(t>0){var i=()=>--t||e();for(var s of n)s.out(i)}else e()}function Ss(n,e,t){if((n.f&rt)===0){if(n.f^=rt,n.transitions!==null)for(const a of n.transitions)(a.is_global||t)&&e.push(a);for(var i=n.first;i!==null;){var s=i.next,r=(i.f&sn)!==0||(i.f&Rt)!==0&&(n.f&Lt)!==0;Ss(i,e,r?t:!1),i=s}}}function Es(n){da(n,!0)}function da(n,e){if((n.f&rt)!==0){n.f^=rt,(n.f&Xe)===0&&(Ne(n,tt),an(n));for(var t=n.first;t!==null;){var i=t.next,s=(t.f&sn)!==0||(t.f&Rt)!==0;da(t,s?e:!1),t=i}if(n.transitions!==null)for(const r of n.transitions)(r.is_global||e)&&r.in()}}function ua(n,e){for(var t=n.nodes_start,i=n.nodes_end;t!==null;){var s=t===i?null:li(t);e.append(t),t=s}}const rl=["touchstart","touchmove"];function al(n){return rl.includes(n)}const ha=new Set,rs=new Set;function ol(n,e,t,i={}){function s(r){if(i.capture||Nn.call(e,r),!r.cancelBubble)return ws(()=>t?.call(this,r))}return n.startsWith("pointer")||n.startsWith("touch")||n==="wheel"?$n(()=>{e.addEventListener(n,s,i)}):e.addEventListener(n,s,i),s}function ut(n,e,t,i,s){var r={capture:i,passive:s},a=ol(n,e,t,r);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&Mi(()=>{e.removeEventListener(n,a,r)})}function _t(n){for(var e=0;e<n.length;e++)ha.add(n[e]);for(var t of rs)t(n)}let Gs=null;function Nn(n){var e=this,t=e.ownerDocument,i=n.type,s=n.composedPath?.()||[],r=s[0]||n.target;Gs=n;var a=0,l=Gs===n&&n.__root;if(l){var o=s.indexOf(l);if(o!==-1&&(e===document||e===window)){n.__root=e;return}var d=s.indexOf(e);if(d===-1)return;o<=d&&(a=o)}if(r=s[a]||n.target,r!==e){Ir(n,"currentTarget",{configurable:!0,get(){return r||t}});var u=J,h=ie;Qe(null),Tt(null);try{for(var f,g=[];r!==null;){var v=r.assignedSlot||r.parentNode||r.host||null;try{var S=r["__"+i];S!=null&&(!r.disabled||n.target===r)&&S.call(r,n)}catch(_){f?g.push(_):f=_}if(n.cancelBubble||v===e||v===null)break;r=v}if(f){for(let _ of g)queueMicrotask(()=>{throw _});throw f}}finally{n.__root=e,delete n.currentTarget,Qe(u),Tt(h)}}}function ll(n){var e=document.createElement("template");return e.innerHTML=n.replaceAll("<!>","<!---->"),e.content}function xi(n,e){var t=ie;t.nodes_start===null&&(t.nodes_start=n,t.nodes_end=e)}function H(n,e){var t=(e&xo)!==0,i=(e&Io)!==0,s,r=!n.startsWith("<!>");return()=>{s===void 0&&(s=ll(r?n:"<!>"+n),t||(s=bi(s)));var a=i||Xr?document.importNode(s,!0):s.cloneNode(!0);if(t){var l=bi(a),o=a.lastChild;xi(l,o)}else xi(a,a);return a}}function re(n=""){{var e=Ot(n+"");return xi(e,e),e}}function Oe(){var n=document.createDocumentFragment(),e=document.createComment(""),t=Ot();return n.append(e,t),xi(e,t),n}function E(n,e){n!==null&&n.before(e)}function Ae(n,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(n.__t??=n.nodeValue)&&(n.__t=t,n.nodeValue=t+"")}function cl(n,e){return dl(n,e)}const hn=new Map;function dl(n,{target:e,anchor:t,props:i={},events:s,context:r,intro:a=!0}){Po();var l=new Set,o=h=>{for(var f=0;f<h.length;f++){var g=h[f];if(!l.has(g)){l.add(g);var v=al(g);e.addEventListener(g,Nn,{passive:v});var S=hn.get(g);S===void 0?(document.addEventListener(g,Nn,{passive:v}),hn.set(g,1)):hn.set(g,S+1)}}};o(fs(ha)),rs.add(o);var d=void 0,u=Qo(()=>{var h=t??e.appendChild(Ot());return Ho(h,{pending:()=>{}},f=>{if(r){Ie({});var g=pe;g.c=r}s&&(i.$$events=s),d=n(f,i)||{},r&&Ce()}),()=>{for(var f of l){e.removeEventListener(f,Nn);var g=hn.get(f);--g===0?(document.removeEventListener(f,Nn),hn.delete(f)):hn.set(f,g)}rs.delete(o),h!==t&&h.parentNode?.removeChild(h)}});return ul.set(d,u),d}let ul=new WeakMap;class fa{anchor;#e=new Map;#t=new Map;#i=new Map;#n=new Set;#l=!0;constructor(e,t=!0){this.anchor=e,this.#l=t}#r=()=>{var e=ve;if(this.#e.has(e)){var t=this.#e.get(e),i=this.#t.get(t);if(i)Es(i),this.#n.delete(t);else{var s=this.#i.get(t);s&&(this.#t.set(t,s.effect),this.#i.delete(t),s.fragment.lastChild.remove(),this.anchor.before(s.fragment),i=s.effect)}for(const[r,a]of this.#e){if(this.#e.delete(r),r===e)break;const l=this.#i.get(a);l&&(et(l.effect),this.#i.delete(a))}for(const[r,a]of this.#t){if(r===t||this.#n.has(r))continue;const l=()=>{if(Array.from(this.#e.values()).includes(r)){var d=document.createDocumentFragment();ua(a,d),d.append(Ot()),this.#i.set(r,{effect:a,fragment:d})}else et(a);this.#n.delete(r),this.#t.delete(r)};this.#l||!i?(this.#n.add(r),wn(a,l,!1)):l()}}};#s=e=>{this.#e.delete(e);const t=Array.from(this.#e.values());for(const[i,s]of this.#i)t.includes(i)||(et(s.effect),this.#i.delete(i))};ensure(e,t){var i=ve,s=Yr();if(t&&!this.#t.has(e)&&!this.#i.has(e))if(s){var r=document.createDocumentFragment(),a=Ot();r.append(a),this.#i.set(e,{effect:lt(()=>t(a)),fragment:r})}else this.#t.set(e,lt(()=>t(this.anchor)));if(this.#e.set(i,e),s){for(const[l,o]of this.#t)l===e?i.skipped_effects.delete(o):i.skipped_effects.add(o);for(const[l,o]of this.#i)l===e?i.skipped_effects.delete(o.effect):i.skipped_effects.add(o.effect);i.oncommit(this.#r),i.ondiscard(this.#s)}else this.#r()}}function V(n,e,t=!1){var i=new fa(n),s=t?sn:0;function r(a,l){i.ensure(a,l)}Oi(()=>{var a=!1;e((l,o=!0)=>{a=!0,r(o,l)}),a||r(!1,null)},s)}function An(n,e,...t){var i=new fa(n);Oi(()=>{const s=e()??null;i.ensure(s,s&&(r=>s(r,...t)))},sn)}const Us=[...` 	
\r\fÂ \v\uFEFF`];function hl(n,e,t){var i=n==null?"":""+n;if(e&&(i=i?i+" "+e:e),t){for(var s in t)if(t[s])i=i?i+" "+s:s;else if(i.length)for(var r=s.length,a=0;(a=i.indexOf(s,a))>=0;){var l=a+r;(a===0||Us.includes(i[a-1]))&&(l===i.length||Us.includes(i[l]))?i=(a===0?"":i.substring(0,a))+i.substring(l+1):a=l}}return i===""?null:i}function Vs(n,e=!1){var t=e?" !important;":";",i="";for(var s in n){var r=n[s];r!=null&&r!==""&&(i+=" "+s+": "+r+t)}return i}function Yi(n){return n[0]!=="-"||n[1]!=="-"?n.toLowerCase():n}function fl(n,e){if(e){var t="",i,s;if(Array.isArray(e)?(i=e[0],s=e[1]):i=e,n){n=String(n).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var r=!1,a=0,l=!1,o=[];i&&o.push(...Object.keys(i).map(Yi)),s&&o.push(...Object.keys(s).map(Yi));var d=0,u=-1;const S=n.length;for(var h=0;h<S;h++){var f=n[h];if(l?f==="/"&&n[h-1]==="*"&&(l=!1):r?r===f&&(r=!1):f==="/"&&n[h+1]==="*"?l=!0:f==='"'||f==="'"?r=f:f==="("?a++:f===")"&&a--,!l&&r===!1&&a===0){if(f===":"&&u===-1)u=h;else if(f===";"||h===S-1){if(u!==-1){var g=Yi(n.substring(d,u).trim());if(!o.includes(g)){f!==";"&&h++;var v=n.substring(d,h).trim();t+=" "+v+";"}}d=h+1,u=-1}}}}return i&&(t+=Vs(i)),s&&(t+=Vs(s,!0)),t=t.trim(),t===""?null:t}return n==null?null:String(n)}function ke(n,e,t,i,s,r){var a=n.__className;if(a!==t||a===void 0){var l=hl(t,i,r);l==null?n.removeAttribute("class"):n.className=l,n.__className=t}else if(r&&s!==r)for(var o in r){var d=!!r[o];(s==null||d!==!!s[o])&&n.classList.toggle(o,d)}return r}function Wi(n,e={},t,i){for(var s in t){var r=t[s];e[s]!==r&&(t[s]==null?n.style.removeProperty(s):n.style.setProperty(s,r,i))}}function xe(n,e,t,i){var s=n.__style;if(s!==e){var r=fl(e,i);r==null?n.removeAttribute("style"):n.style.cssText=r,n.__style=e}else i&&(Array.isArray(i)?(Wi(n,t?.[0],i[0]),Wi(n,t?.[1],i[1],"important")):Wi(n,t,i));return i}function ga(n,e,t=!1){if(n.multiple){if(e==null)return;if(!hs(e))return Do();for(var i of n.options)i.selected=e.includes(js(i));return}for(i of n.options){var s=js(i);if(ko(s,e)){i.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function gl(n){var e=new MutationObserver(()=>{ga(n,n.__value)});e.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Mi(()=>{e.disconnect()})}function js(n){return"__value"in n?n.__value:n.value}const pl=Symbol("is custom element"),ml=Symbol("is html");function qn(n,e){var t=pa(n);t.value===(t.value=e??void 0)||n.value===e&&(e!==0||n.nodeName!=="PROGRESS")||(n.value=e??"")}function U(n,e,t,i){var s=pa(n);s[e]!==(s[e]=t)&&(e==="loading"&&(n[co]=t),t==null?n.removeAttribute(e):typeof t!="string"&&vl(n).includes(e)?n[e]=t:n.setAttribute(e,t))}function pa(n){return n.__attributes??={[pl]:n.nodeName.includes("-"),[ml]:n.namespaceURI===Co}}var qs=new Map;function vl(n){var e=n.getAttribute("is")||n.nodeName,t=qs.get(e);if(t)return t;qs.set(e,t=[]);for(var i,s=n,r=Element.prototype;r!==s;){i=Cr(s);for(var a in i)i[a].set&&t.push(a);s=gs(s)}return t}function Js(n,e){return n===e||n?.[Yt]===e}function ln(n={},e,t,i){return el(()=>{var s,r;return $i(()=>{s=r,r=[],zt(()=>{n!==t(...r)&&(e(n,...r),s&&Js(t(...s),n)&&e(null,...s))})}),()=>{$n(()=>{r&&Js(t(...r),n)&&e(null,...r)})}}),n}function ma(n=!1){const e=pe,t=e.l.u;if(!t)return;let i=()=>jo(e.s);if(n){let s=0,r={};const a=Pi(()=>{let l=!1;const o=e.s;for(const d in o)o[d]!==r[d]&&(r[d]=o[d],l=!0);return l&&s++,s});i=()=>c(a)}t.b.length&&Jo(()=>{Qs(e,i),yi(t.b)}),Ze(()=>{const s=zt(()=>t.m.map(oo));return()=>{for(const r of s)typeof r=="function"&&r()}}),t.a.length&&Ze(()=>{Qs(e,i),yi(t.a)})}function Qs(n,e){if(n.l.s)for(const t of n.l.s)c(t);e()}let as=Symbol();function O(n,e,t){const i=t[e]??={store:null,source:bs(void 0),unsubscribe:pt};if(i.store!==n&&!(as in t))if(i.unsubscribe(),i.store=n??null,n==null)i.source.v=void 0,i.unsubscribe=pt;else{var s=!0;i.unsubscribe=xs(n,r=>{s?i.source.v=r:$(i.source,r)}),s=!1}return n&&as in t?ft(n):c(i.source)}function We(){const n={};function e(){Mi(()=>{for(var t in n)n[t].unsubscribe();Ir(n,as,{enumerable:!1,value:!0})})}return[n,e]}function ce(n,e,t,i){var s=i,r=!0,a=()=>(r&&(r=!1,s=i),s),l;l=n[e],l===void 0&&i!==void 0&&(l=a());var o;return o=()=>{var d=n[e];return d===void 0?a():(r=!0,d)},o}function ci(n){pe===null&&Or(),ai&&pe.l!==null?yl(pe).m.push(n):Ze(()=>{const e=zt(n);if(typeof e=="function")return e})}function _l(n){pe===null&&Or(),ci(()=>()=>zt(n))}function yl(n){var e=n.l;return e.u??={a:[],b:[],m:[]}}function xs(n,e,t){if(n==null)return e(void 0),t&&t(void 0),pt;const i=zt(()=>n.subscribe(e,t));return i.unsubscribe?()=>i.unsubscribe():i}const fn=[];function bl(n,e){return{subscribe:ee(n,e).subscribe}}function ee(n,e=pt){let t=null;const i=new Set;function s(l){if(Mr(n,l)&&(n=l,t)){const o=!fn.length;for(const d of i)d[1](),fn.push(d,n);if(o){for(let d=0;d<fn.length;d+=2)fn[d][0](fn[d+1]);fn.length=0}}}function r(l){s(l(n))}function a(l,o=pt){const d=[l,o];return i.add(d),i.size===1&&(t=e(s,r)||pt),l(n),()=>{i.delete(d),i.size===0&&t&&(t(),t=null)}}return{set:s,update:r,subscribe:a}}function Le(n,e,t){const i=!Array.isArray(n),s=i?[n]:n;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const r=e.length<2;return bl(t,(a,l)=>{let o=!1;const d=[];let u=0,h=pt;const f=()=>{if(u)return;h();const v=e(i?d[0]:d,a,l);r?a(v):h=typeof v=="function"?v:pt},g=s.map((v,S)=>xs(v,_=>{d[S]=_,u&=~(1<<S),o&&f()},()=>{u|=1<<S}));return o=!0,f(),function(){yi(g),h(),o=!1}})}function ft(n){let e;return xs(n,t=>e=t)(),e}function wl(){return`zone_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const os=["#e74c3c","#e67e22","#f1c40f","#2ecc71","#1abc9c","#3498db","#9b59b6","#e91e8f"];function Sl(){return os[Math.floor(Math.random()*os.length)]}function El(n,e=300){return{id:wl(),x:n,width:e,color:Sl(),texts:[{language:"cs",title:"",content:""}]}}function xl(n,e){const t=n.texts.find(i=>i.language===e);return t||n.texts[0]||null}const Jn=ee("cs"),Il=ee("orange"),va=ee("Forest"),_a=ee(!1),ls=ee(!1),Zn=ee(!1),ya=ee(!1),ba=ee(!1),wa=ee(null),Cl=Le([wa,Jn],([n,e])=>n?xl(n,e):null);function Bi(n){wa.set(n)}const Sa=ee({x:0,y:0});function Tl(n,e){Sa.set({x:n,y:e})}const Ea=ee({scrollX:0,scrollY:0,zoom:1});function Dl(n,e,t=1){Ea.set({scrollX:n,scrollY:e,zoom:t})}const cs=ee(!1);function xa(){cs.set(!0),setTimeout(()=>cs.set(!1),150)}const Ge={BACKGROUND_BASE:-100,BACKGROUND_LAYER_START:-99,GROUND_REFERENCE:-1,ITEMS_BEHIND:5,PLAYER:10,ITEMS_FRONT:15,SELECTION_GRAPHICS:999,GRID_OVERLAY:1e3};function Is(n){return n==="behind"?Ge.ITEMS_BEHIND:Ge.ITEMS_FRONT}const kn={FRAME_HEIGHT:48,SCALE:5,DEPTH:Ge.PLAYER},Al={HALF_HEIGHT:kn.FRAME_HEIGHT*kn.SCALE/2},Pn=40;function kl(n){return n-Pn}function Qn(n){return kl(n)-Al.HALF_HEIGHT}function Pl(n,e){const t=Qn(e);return Math.min(n,t)}function Ml(n,e){const t=Qn(e);return n>t}const kt=["orange","white"];class $l{currentSkin=kt[0];currentIndex=0;setSkin(e){kt.includes(e)&&(this.currentSkin=e,this.currentIndex=kt.indexOf(e),localStorage.setItem("catSkin",e))}getSkin(){const e=localStorage.getItem("catSkin");return e&&kt.includes(e)&&(this.currentSkin=e,this.currentIndex=kt.indexOf(e)),this.currentSkin}toggleSkin(){return this.currentIndex=(this.currentIndex+1)%kt.length,this.currentSkin=kt[this.currentIndex],this.setSkin(this.currentSkin),this.currentSkin}getAllSkins(){return kt}}const Ia=new $l,Ol={FAST_VELOCITY_THRESHOLD:100,ROTATION_FULL:15,ROTATION_SLIGHT:8};class Ll{scene;currentSkin;constructor(e,t="white"){this.scene=e,this.currentSkin=t}createAll(){Ia.getAllSkins().forEach(t=>{this.createAnimationsForSkin(t)})}createAnimationsForSkin(e){const t=this.scene;t.anims.exists(`cat-idle-${e}`)||t.anims.create({key:`cat-idle-${e}`,frames:t.anims.generateFrameNumbers(`cat-idle-${e}`,{start:0,end:3}),frameRate:6,repeat:-1}),t.anims.exists(`cat-walk-${e}`)||t.anims.create({key:`cat-walk-${e}`,frames:t.anims.generateFrameNumbers(`cat-walk-${e}`,{start:0,end:5}),frameRate:12,repeat:-1}),[{key:`cat-jump-up-${e}`,frame:2},{key:`cat-jump-peak-up-${e}`,frame:3},{key:`cat-jump-peak-down-${e}`,frame:3},{key:`cat-jump-down-${e}`,frame:4}].forEach(({key:s,frame:r})=>{t.anims.exists(s)||t.anims.create({key:s,frames:[{key:`cat-walk-${e}`,frame:r}],frameRate:1,repeat:0})})}getSkin(){return this.currentSkin}setSkin(e){this.currentSkin=e}getAnimationKey(e){return`cat-${e}-${this.currentSkin}`}play(e,t){const i=this.getAnimationKey(t);e.anims.currentAnim?.key!==i&&e.play(i)}getJumpAnimationState(e){const{FAST_VELOCITY_THRESHOLD:t,ROTATION_FULL:i,ROTATION_SLIGHT:s}=Ol;return e<-t?{animation:this.getAnimationKey("jump-up"),rotation:i,flipMultiplier:1}:e<-20?{animation:this.getAnimationKey("jump-peak-up"),rotation:s,flipMultiplier:1}:e<=t?{animation:this.getAnimationKey("jump-peak-down"),rotation:s,flipMultiplier:-1}:{animation:this.getAnimationKey("jump-down"),rotation:i,flipMultiplier:-1}}handleSkinChange(e,t){const i=this.currentSkin;this.currentSkin=t;const s=e.anims.currentAnim?.key;if(s){const a=`cat-${s.replace("cat-","").replace(`-${i}`,"")}-${t}`;this.scene.anims.exists(a)&&e.play(a)}}}let Ca=!1,pn=!1;function ui(n){Ca=n}function er(){return Ca}function cn(){return pn}function zi(n){if(!n||n.tagName==="CANVAS")return!1;if(n.closest("[data-ui]"))return!0;const e=document.getElementById("game-ui");return!!(e&&e.contains(n)||n.closest("button"))}function Rl(){document.addEventListener("pointerdown",n=>{pn=zi(n.target)},{capture:!0}),document.addEventListener("pointermove",n=>{n.buttons>0||(pn=zi(n.target))},{capture:!0}),document.addEventListener("pointerup",()=>{setTimeout(()=>{pn=!1},10)},{capture:!0}),document.addEventListener("touchstart",n=>{pn=zi(n.target)},{capture:!0,passive:!0}),document.addEventListener("touchend",()=>{setTimeout(()=>{pn=!1},10)},{capture:!0,passive:!0})}function Sn(){const n=document.activeElement;if(!n)return!1;const e=n.tagName.toUpperCase();return e==="INPUT"||e==="TEXTAREA"||n.getAttribute("contenteditable")==="true"}function qt(n,e,t){const i=(n-t.worldView.x)*t.zoom,s=(e-t.worldView.y)*t.zoom;return{screenX:i,screenY:s}}function Hl(n,e,t){const i=n/t.zoom+t.worldView.x,s=e/t.zoom+t.worldView.y;return{worldX:i,worldY:s}}const Vt={THRESHOLD_X:20,LANGUAGE_BUTTON:{width:120,height:60},SKIN_BUTTON:{width:120,height:60,yOffset:60}},tr={SPEED:350,JUMP_STRENGTH:-500};class Fl{scene;getPlayerPosition;keyUp;keyLeft;keyRight;keyA;keyD;keyW;keySpace;touchLeft=!1;touchRight=!1;touchJump=!1;touchHandlers;constructor(e){this.scene=e.scene,this.getPlayerPosition=e.getPlayerPosition,this.setupKeyboardControls(),this.setupTouchControls()}setupKeyboardControls(){this.scene.input.keyboard&&(this.keyUp=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.UP,!1),this.keyLeft=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.LEFT,!1),this.keyRight=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.RIGHT,!1),this.keyA=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.A,!1),this.keyD=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.D,!1),this.keyW=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.W,!1),this.keySpace=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.SPACE,!1))}setupTouchControls(){const e=this.scene,t=a=>{if(ft(cs)){this.touchLeft=!1,this.touchRight=!1,this.touchJump=!1;return}const l=a.x,o=a.y,d=e.scale.width;if(l>d-Vt.LANGUAGE_BUTTON.width&&o<Vt.LANGUAGE_BUTTON.height||l>d-Vt.SKIN_BUTTON.width&&o>=Vt.SKIN_BUTTON.yOffset&&o<Vt.SKIN_BUTTON.yOffset+Vt.SKIN_BUTTON.height)return;const u=e.cameras.main,h=this.getPlayerPosition(),f=h.x-u.scrollX,g=h.y-u.scrollY,v=l-f,S=o-g;v<-20?(this.touchLeft=!0,this.touchRight=!1):v>Vt.THRESHOLD_X?(this.touchRight=!0,this.touchLeft=!1):(this.touchLeft=!1,this.touchRight=!1),this.touchJump=S<-80},i=a=>{cn()||t(a)},s=a=>{cn()||a.isDown&&t(a)},r=()=>{this.touchLeft=!1,this.touchRight=!1,this.touchJump=!1};e.input.on("pointerdown",i),e.input.on("pointermove",s),e.input.on("pointerup",r),this.touchHandlers={pointerdown:i,pointermove:s,pointerup:r}}getInputState(){const e=this.keyA?.isDown||this.keyLeft?.isDown||this.touchLeft||!1,t=this.keyD?.isDown||this.keyRight?.isDown||this.touchRight||!1,i=this.keySpace?.isDown||this.keyW?.isDown||this.keyUp?.isDown||this.touchJump||!1;return{left:e,right:t,jump:i}}hasAnyInput(){const e=this.getInputState();return e.left||e.right||e.jump}destroy(){this.touchHandlers&&(this.scene.input.off("pointerdown",this.touchHandlers.pointerdown),this.scene.input.off("pointermove",this.touchHandlers.pointermove),this.scene.input.off("pointerup",this.touchHandlers.pointerup),this.touchHandlers=void 0)}}class Xl extends N.Physics.Arcade.Sprite{animations;inputController;animState="idle";hasNotifiedMovement=!1;hasReceivedInput=!1;constructor(e,t,i){const s="white";super(e,t,i,`cat-idle-${s}`),e.add.existing(this),e.physics.add.existing(this),this.animations=new Ll(e,s),this.animations.createAll(),this.inputController=new Fl({scene:e,getPlayerPosition:()=>({x:this.x,y:this.y})}),this.setCollideWorldBounds(!0),this.setBounce(0),this.setSize(16,12),this.setOffset(16,36),this.setScale(kn.SCALE),this.setDepth(kn.DEPTH),this.animations.play(this,"idle")}changeSkin(e){this.animations.handleSkinChange(this,e)}updateJumpAnimation(e){const{animation:t,rotation:i,flipMultiplier:s}=this.animations.getJumpAnimationState(e);this.anims.currentAnim?.key!==t&&this.play(t);const r=this.flipX?i*s:-i*s;this.setAngle(r)}update(){const e=this.inputController.getInputState(),t=this.body,i=t&&(t.blocked.down||t.touching.down);switch(this.inputController.hasAnyInput()&&!this.hasReceivedInput&&(this.hasReceivedInput=!0),this.hasReceivedInput&&this.inputController.hasAnyInput()&&!this.hasNotifiedMovement&&(this.hasNotifiedMovement=!0,ba.set(!0)),e.left?(this.setVelocityX(-350),this.setFlipX(!0),i&&(this.animState="running")):e.right?(this.setVelocityX(tr.SPEED),this.setFlipX(!1),i&&(this.animState="running")):(this.setVelocityX(0),i&&(this.animState="idle")),e.jump&&i&&(this.setVelocityY(tr.JUMP_STRENGTH),this.animState="jumping"),!i&&t&&t.velocity.y!==0&&(this.animState="jumping"),this.animState){case"idle":this.animations.play(this,"idle"),this.setAngle(0);break;case"running":this.animations.play(this,"walk"),this.setAngle(0);break;case"jumping":this.updateJumpAnimation(t.velocity.y);break}}destroy(e){this.inputController.destroy(),super.destroy(e)}}const wt=[{name:"FOREST GREEN",folder:"forest_green",scrollFactors:[1,.8,.85,.9,.95]},{name:"FOREST BLUE",folder:"forest_blue",scrollFactors:[1,.8,.85,.9,.95,1]}];class Nl{currentIndex=0;constructor(){const e=localStorage.getItem("background");if(e){const t=wt.findIndex(i=>i.folder===e);t!==-1&&(this.currentIndex=t)}}getBackground(){return wt[this.currentIndex].folder}getCurrentConfig(){return wt[this.currentIndex]}setBackground(e){const t=wt.findIndex(i=>i.folder===e);t!==-1&&(this.currentIndex=t,localStorage.setItem("background",e))}toggleBackground(){this.currentIndex=(this.currentIndex+1)%wt.length;const e=wt[this.currentIndex];return localStorage.setItem("background",e.folder),e}getAllBackgrounds(){return wt}setBackgroundByIndex(e){e>=0&&e<wt.length&&(this.currentIndex=e,localStorage.setItem("background",wt[e].folder))}getCurrentIndex(){return this.currentIndex}}const ei=new Nl;function Ta(n,e){return new Promise(t=>{n.load.image(`bg0-${e.folder}`,`assets/backgrounds/${e.folder}/0.png`);for(let i=0;i<e.scrollFactors.length;i++){const s=i+1;n.load.image(`bg${s}-${e.folder}`,`assets/backgrounds/${e.folder}/${s}.png`)}n.load.once("complete",()=>{t(!0)}),n.load.once("loaderror",i=>{console.error(`Failed to load background asset: ${i.key}`),t(!1)}),n.load.start()})}function Da(n,e,t,i){const s=Math.max(t,n.scale.height),r=n.add.tileSprite(0,0,e,s,`bg0-${i.folder}`);r.setOrigin(0,0),r.setScrollFactor(1),r.setDepth(Ge.BACKGROUND_BASE),r.tilePositionX=0,r.tilePositionY=0;const a=[];for(let l=0;l<i.scrollFactors.length;l++){const d=`bg${l+1}-${i.folder}`;if(n.textures.exists(d)){const u=n.add.image(0,0,d);u.setOrigin(0,0),u.setScrollFactor(i.scrollFactors[l]),u.setDepth(Ge.BACKGROUND_LAYER_START+l),u.setDisplaySize(e,t),a.push(u)}}return{baseLayer:r,bgLayers:a}}function Aa(n,e){n&&(n.tilePositionX=e.scrollX)}function Zl(n){n.bgLayers.forEach(e=>e.destroy()),n.baseLayer.destroy()}const Yl=[{code:"cs",label:"CZ"},{code:"en",label:"EN"}],ka="cs",Wl={isActive:!1,config:null,selectedItemId:null,itemDepthLayer:"behind",editMode:"items",selectedDialogZoneId:null,selectedFrameId:null,selectedSocialId:null,isPlayerSelected:!1},B=ee(Wl),Pa=Le(B,n=>n.isActive),Bl=Le(B,n=>n.config),Ii=ee(!0);function zl(){Ii.update(n=>!n)}const Kt=ee(!1);function En(n){Kt.set(n)}const ds=ee(!1);function Ki(n){ds.set(n)}const nn=ee(!1),Jt=ee(!1),Li=ee(!1),Qt=ee(!1),Ri=ee(!1);function Kl(){nn.update(n=>!n)}function Gl(){Jt.update(n=>!n)}function Ma(){Li.set(!0)}function Ul(){Li.set(!1)}function Vl(){Qt.update(n=>!n)}function $a(){Ri.set(!0)}function jl(){Ri.set(!1)}const Cs=ee(ka);function ql(n){Cs.set(n)}const Hi=Le(B,n=>n.selectedItemId),Oa=Le(B,n=>n.itemDepthLayer),Ue=Le(B,n=>n.editMode),Fi=Le(B,n=>n.selectedDialogZoneId),Ts=Le(B,n=>n.config?.dialogZones||[]),ti=Le(B,n=>n.selectedFrameId),Gi=Le(B,n=>n.isPlayerSelected),La=Le(B,n=>n.config?.placedFrames||[]),ni=Le(B,n=>n.selectedSocialId),Jl=Le(B,n=>n.config?.placedSocials||[]),Ql=Le(B,n=>!n.selectedSocialId||!n.config?.placedSocials?null:n.config.placedSocials.find(e=>e.id===n.selectedSocialId)??null),Ra=ee(null);function Ui(n){Ra.set(n)}const Ds=ee(new Map);function ec(n,e,t){Ds.update(i=>{const s=new Map(i);return s.set(n,{x:e,y:t}),s})}function tc(n){Ds.update(e=>{const t=new Map(e);return t.delete(n),t})}const Ha=ee(null);function Vi(n){Ha.set(n)}const nc=Le(B,n=>!n.selectedFrameId||!n.config?.placedFrames?null:n.config.placedFrames.find(e=>e.id===n.selectedFrameId)??null),Fa=ee(null);function ji(n){Fa.set(n)}const Xa=ee(null);function hi(n){Xa.set(n)}const As=ee(!1);function Na(){As.set(!0)}function nr(){As.set(!1)}const ks=Le(B,n=>!n.selectedItemId||!n.config?.placedItems?null:n.config.placedItems.find(e=>e.id===n.selectedItemId)??null),ic=Le(ks,n=>n?.physicsEnabled??!1),sc=Le(ks,n=>n?.flipX??!1);function ir(n,e){B.update(t=>t.config?{...t,config:{...t.config,playerStartX:n,playerStartY:e}}:t)}function rc(n){B.update(e=>{if(!e.config)return e;const t=e.config.placedItems||[];return{...e,config:{...e.config,placedItems:[...t,n]}}})}function ii(n,e){B.update(t=>!t.config||!t.config.placedItems?t:{...t,config:{...t.config,placedItems:t.config.placedItems.map(i=>i.id===n?{...i,...e}:i)}})}function Za(n){B.update(e=>!e.config||!e.config.placedItems?e:{...e,config:{...e.config,placedItems:e.config.placedItems.filter(t=>t.id!==n)},selectedItemId:e.selectedItemId===n?null:e.selectedItemId})}function Ya(n){B.update(e=>({...e,selectedItemId:n,isPlayerSelected:n?!1:e.isPlayerSelected}))}function ac(n){B.update(e=>({...e,isPlayerSelected:n,selectedItemId:null}))}function Ps(){B.update(n=>({...n,selectedItemId:null,selectedFrameId:null,selectedDialogZoneId:null,selectedSocialId:null,isPlayerSelected:!1}))}function oc(){B.update(n=>({...n,itemDepthLayer:n.itemDepthLayer==="behind"?"front":"behind"}))}function lc(n,e){ii(n,{depth:e})}function cc(n,e){e?(ii(n,{physicsEnabled:e,depth:Is("behind")}),B.update(t=>({...t,itemDepthLayer:"behind"}))):ii(n,{physicsEnabled:e})}function dc(n,e){ii(n,{flipX:e})}function uc(n){B.set({isActive:!0,config:{...n,placedItems:n.placedItems||[],dialogZones:n.dialogZones||[],placedFrames:n.placedFrames||[],placedSocials:n.placedSocials||[]},selectedItemId:null,itemDepthLayer:"behind",editMode:"items",selectedDialogZoneId:null,selectedFrameId:null,selectedSocialId:null,isPlayerSelected:!1}),Ms.set(1)}function hc(){B.update(n=>{const e=n.config?{...n.config,dialogZones:(n.config.dialogZones||[]).filter(t=>t.texts.some(i=>i.title.trim()!==""||i.content.trim()!==""))}:n.config;return{...n,isActive:!1,selectedItemId:null,config:e}}),Ms.set(1)}function fc(){return ft(B).config}const Ms=ee(1);function fi(n){Ms.set(n)}const $s=ee({scrollX:0,scrollY:0,viewWidth:0,viewHeight:0,worldWidth:0,worldHeight:0,zoom:1,playerX:0,playerY:0});function gc(n){$s.update(e=>({...e,...n}))}function Xn(n){B.update(e=>({...e,editMode:n,selectedItemId:null,selectedDialogZoneId:null}))}function pc(n){B.update(e=>{if(!e.config)return e;const t=e.config.dialogZones||[];return{...e,config:{...e.config,dialogZones:[...t,n]}}})}function mn(n,e){B.update(t=>!t.config||!t.config.dialogZones?t:{...t,config:{...t.config,dialogZones:t.config.dialogZones.map(i=>i.id===n?{...i,...e}:i)}})}function Wa(n){B.update(e=>!e.config||!e.config.dialogZones?e:{...e,config:{...e.config,dialogZones:e.config.dialogZones.filter(t=>t.id!==n)},selectedDialogZoneId:e.selectedDialogZoneId===n?null:e.selectedDialogZoneId})}function zn(n){B.update(e=>({...e,selectedDialogZoneId:n}))}function sr(n,e,t){B.update(i=>!i.config||!i.config.dialogZones?i:{...i,config:{...i.config,dialogZones:i.config.dialogZones.map(s=>{if(s.id!==n)return s;const r=s.texts.findIndex(l=>l.language===e);let a;return r>=0?a=s.texts.map((l,o)=>o===r?{...l,...t}:l):a=[...s.texts,{language:e,title:"",content:"",...t}],{...s,texts:a}})}})}function mc(n){B.update(e=>{if(!e.config)return e;const t=e.config.placedFrames||[];return{...e,config:{...e.config,placedFrames:[...t,n]}}})}function St(n,e){B.update(t=>!t.config||!t.config.placedFrames?t:{...t,config:{...t.config,placedFrames:t.config.placedFrames.map(i=>i.id===n?{...i,...e}:i)}})}function Os(n){B.update(e=>!e.config||!e.config.placedFrames?e:{...e,config:{...e.config,placedFrames:e.config.placedFrames.filter(t=>t.id!==n)},selectedFrameId:e.selectedFrameId===n?null:e.selectedFrameId})}function Kn(n){Li.set(!1),B.update(e=>({...e,selectedFrameId:n,isPlayerSelected:n?!1:e.isPlayerSelected,selectedItemId:n?null:e.selectedItemId}))}function vc(n){B.update(e=>{if(!e.config)return e;const t=e.config.placedSocials||[];return{...e,config:{...e.config,placedSocials:[...t,n]}}})}function pi(n,e){B.update(t=>!t.config||!t.config.placedSocials?t:{...t,config:{...t.config,placedSocials:t.config.placedSocials.map(i=>i.id===n?{...i,...e}:i)}})}function Ls(n){B.update(e=>!e.config||!e.config.placedSocials?e:{...e,config:{...e.config,placedSocials:e.config.placedSocials.filter(t=>t.id!==n)},selectedSocialId:e.selectedSocialId===n?null:e.selectedSocialId})}function Gn(n){Ri.set(!1),B.update(e=>({...e,selectedSocialId:n,isPlayerSelected:n?!1:e.isPlayerSelected,selectedItemId:n?null:e.selectedItemId,selectedFrameId:n?null:e.selectedFrameId}))}const Rs=[{key:"tent",name:"Tent",path:"assets/ui/tent.png",scale:6,category:"structures"},{key:"lamp",name:"Lamp",path:"assets/ui/lamp.png",scale:8,category:"props"},{key:"sign_left",name:"Sign â",path:"assets/ui/sign_left.png",scale:7,category:"signs"},{key:"sign_right",name:"Sign â",path:"assets/ui/sign_right.png",scale:7,category:"signs"},{key:"stone_0",name:"Stone 0",path:"assets/ui/stone_0.png",scale:4,category:"nature",supportsPhysics:!0},{key:"stone_1",name:"Stone 1",path:"assets/ui/stone_1.png",scale:5,category:"nature",supportsPhysics:!0},{key:"stone_2",name:"Stone 2",path:"assets/ui/stone_2.png",scale:4,category:"nature",supportsPhysics:!0}];function Ba(n){return Rs.find(e=>e.key===n)}function _c(n){return Ba(n)?.scale||1}function yc(n){return Ba(n)?.supportsPhysics??!1}class rr{scene;groundY;constructor(e,t){this.scene=e,this.groundY=t}static preloadAssets(e){Rs.forEach(t=>{e.load.image(t.key,t.path)})}createSprite(e){const{id:t,assetKey:i,x:s,scale:r=1,depth:a=5,yOffset:l=0,flipX:o=!1}=e,d=this.groundY+l,u=this.scene.add.sprite(s,d,i);return u.setScale(r),u.setDepth(a),u.setFlipX(o),u.setData("itemId",t),u}updatePosition(e,t,i){e.x=t,e.y=this.groundY+i}updateScale(e,t){e.setScale(t)}updateDepth(e,t){e.setDepth(t)}applyUpdates(e,t){t.x!==void 0&&(e.x=t.x),t.yOffset!==void 0&&(e.y=this.groundY+t.yOffset),t.scale!==void 0&&e.setScale(t.scale),t.depth!==void 0&&e.setDepth(t.depth),t.flipX!==void 0&&e.setFlipX(t.flipX)}worldYToOffset(e){return e-this.groundY}getGroundY(){return this.groundY}}function vn(n){return parseInt(n.replace("#",""),16)}const jt={BLUE:"#4a90e2",GREEN:"#27ae60",PURPLE:"#9b59b6",TEAL:"#1abc9c",PINK:"#e91e8f"},Rn={ITEM:{hex:vn(jt.BLUE)},FRAME:{hex:vn(jt.PURPLE)},SOCIAL:{css:jt.PINK,hex:vn(jt.PINK)},DIALOG_ZONE:{hex:vn(jt.TEAL)},PLAYER:{hex:vn(jt.GREEN)}},za=vn(jt.BLUE),bn=50,bc=4871528,wc=.4,Sc=1,Ka=Ge.GRID_OVERLAY,qi=16711680,Ec=2,xc=.6,Ic=.1,Cc=1,Tc=.2,ar=50,Dc=50,Hs=za;class Ga{lastClickTime=0;lastClickId=null;threshold;constructor(e=300){this.threshold=e}check(e){const t=Date.now(),i=this.lastClickId===e&&t-this.lastClickTime<this.threshold;return this.lastClickTime=t,this.lastClickId=e,i}reset(){this.lastClickTime=0,this.lastClickId=null}}function gi(n,e){return Math.round(n/e)*e}function Xi(n){const{sprite:e,scene:t,callbacks:i={},constraints:s,useGridSnapping:r=!0,cursor:a="grab",hitArea:l}=n;let o=!1,d=0,u=0,h=0;l?e.setInteractive({hitArea:l,hitAreaCallback:N.Geom.Rectangle.Contains,useHandCursor:!0,cursor:a}):e.setInteractive({useHandCursor:!0,cursor:a});const f=(y,b)=>{const m=e.getBounds(),I=5;return y>=m.x-I&&y<=m.x+m.width+I&&b>=m.y-I&&b<=m.y+m.height+I},g=()=>{const y=t.data.get("lastTapTime");if(!y||y===h||Date.now()-y>100)return;h=y;const b=t.data.get("lastTapWorldX"),m=t.data.get("lastTapWorldY");f(b,m)&&i.onSelect?.()},v=y=>{if(y.wasTouch||ft(ds)||cn()||o||i.onDoubleClick?.())return;const b=i.isSelected?.()??!1;i.onSelect?.(),b&&(o=!0,t.data.set("isDraggingItem",!0),En(!0),d=e.x-y.worldX,u=e.y-y.worldY,i.onDragStart?.())},S=y=>{if(y.wasTouch){const I=t.data.get("touchDragStarted");if(!o&&I&&i.isSelected?.()){const C=t.data.get("touchStartWorldX"),M=t.data.get("touchStartWorldY"),T=e.getBounds(),A=10;C>=T.x-A&&C<=T.x+T.width+A&&M>=T.y-A&&M<=T.y+T.height+A&&(o=!0,t.data.set("isDraggingItem",!0),t.data.set("touchDragStarted",!1),En(!0),d=e.x-C,u=e.y-M,i.onDragStart?.())}if(o){let x=y.worldX+d,C=y.worldY+u;r&&ft(Ii)&&(x=gi(x,bn),C=gi(C,bn)),s&&(s.minX!==void 0&&(x=Math.max(x,s.minX)),s.maxX!==void 0&&(x=Math.min(x,s.maxX)),s.minY!==void 0&&(C=Math.max(C,s.minY)),s.maxY!==void 0&&(C=Math.min(C,s.maxY))),e.setPosition(x,C),i.onDrag?.(x,C)}return}if(!o)return;if(ft(ds)){p();return}if(!y.isDown){p();return}let b=y.worldX+d,m=y.worldY+u;r&&ft(Ii)&&(b=gi(b,bn),m=gi(m,bn)),s&&(s.minX!==void 0&&(b=Math.max(b,s.minX)),s.maxX!==void 0&&(b=Math.min(b,s.maxX)),s.minY!==void 0&&(m=Math.max(m,s.minY)),s.maxY!==void 0&&(m=Math.min(m,s.maxY))),e.setPosition(b,m),i.onDrag?.(b,m)},_=()=>{o&&p()},p=()=>{o=!1,t.data.set("isDraggingItem",!1),En(!1),i.onDragEnd?.(e.x,e.y)};e.on("pointerdown",v),t.input.on("pointermove",S),t.input.on("pointerup",_);const w=()=>{g()};return t.events.on("update",w),()=>{e.off("pointerdown",v),t.input.off("pointermove",S),t.input.off("pointerup",_),t.events.off("update",w)}}class Ac{scene;groundY;worldWidth;worldHeight;isDragging=!1;callbacks;cleanupFunctions=new Map;constructor(e,t,i,s,r={}){this.scene=e,this.groundY=t,this.worldWidth=i,this.worldHeight=s,this.callbacks=r}getIsDragging(){return this.isDragging}makeInteractive(e,t){const i=Xi({sprite:e,scene:this.scene,cursor:"pointer",constraints:{minX:0,maxX:this.worldWidth,minY:0,maxY:this.worldHeight},callbacks:{onSelect:()=>{Ya(t),this.callbacks.onSelect?.(t)},isSelected:()=>ft(Hi)===t,onDragStart:()=>{this.isDragging=!0,e.setTint(za),this.callbacks.onDragStart?.(t)},onDrag:(s,r)=>{this.callbacks.onDrag?.(t,s,r)},onDragEnd:(s,r)=>{e.clearTint(),this.isDragging=!1;const a=Math.round(s),o=Math.round(r)-this.groundY;ii(t,{x:a,yOffset:o}),this.callbacks.onDragEnd?.(t,a,o)}}});this.cleanupFunctions.set(t,i)}removeInteractivity(e){if(!e||!e.scene)return;const t=e.getData("itemId");t&&this.cleanupFunctions.has(t)&&(this.cleanupFunctions.get(t)(),this.cleanupFunctions.delete(t)),e.removeInteractive()}destroy(){this.cleanupFunctions.forEach(e=>e()),this.cleanupFunctions.clear()}}const en={ITEM:"itemId",FRAME:"frameId",SOCIAL:"socialId",PLAYER:"isPlayer",ZONE:"zoneId"},kc={[en.ITEM]:"selectedItemId",[en.FRAME]:"selectedFrameId",[en.SOCIAL]:"selectedSocialId",[en.PLAYER]:"isPlayerSelected"};function Pc(n,e){if(!(n instanceof N.GameObjects.Sprite))return!1;for(const[t,i]of Object.entries(kc)){const s=n.getData(t);if(s)if(t===en.PLAYER){const r=e.data.get(i),a=e.data.get("playerSprite");if(r&&n===a)return!0}else{const r=e.data.get(i);if(s===r)return!0}}return!1}function Mc(n,e){const t=n.input.hitTestPointer(e);for(const i of t)if(Pc(i,n))return!0;return!1}const $c={lineWidth:3,lineColor:Rn.ITEM.hex,lineAlpha:1,padding:5};class Oc{scene;graphics;style;selectedId=null;constructor(e,t={}){this.scene=e,this.style={...$c,...t},this.graphics=e.add.graphics(),this.graphics.setDepth(Ge.SELECTION_GRAPHICS)}setSelectedId(e){this.selectedId=e}getSelectedId(){return this.selectedId}updateVisuals(e){if(this.graphics.clear(),!e||!this.selectedId)return;const t=e.getBounds(),{lineWidth:i,lineColor:s,lineAlpha:r,padding:a}=this.style;this.graphics.lineStyle(i,s,r),this.graphics.strokeRect(t.x-a,t.y-a,t.width+a*2,t.height+a*2)}clearVisuals(){this.graphics.clear(),this.selectedId=null}setupBackgroundDeselect(e){this.scene.input.on("pointerdown",t=>{if(cn()||e())return;this.scene.input.hitTestPointer(t).find(r=>r.type==="Sprite"?Object.values(en).some(a=>r.getData(a)):r.type==="Rectangle"?r.getData(en.ZONE):!1)||(Ps(),this.clearVisuals())})}destroy(){this.graphics?.destroy()}}class Ci{scene;items=new Map;isBuilderMode=!1;physicsGroup=null;renderer;dragController;selectionManager;constructor(e,t,i,s,r=!1){this.scene=e,this.isBuilderMode=r,this.renderer=new rr(e,t),r||(this.physicsGroup=e.physics.add.staticGroup()),this.isBuilderMode&&(this.dragController=new Ac(e,t,i,s,{onSelect:()=>this.updateSelectionVisuals(),onDrag:()=>this.updateSelectionVisuals()}),this.selectionManager=new Oc(e))}static preloadAssets(e){rr.preloadAssets(e)}createItems(e){e.forEach(t=>{this.createItem(t)})}createItem(e){const t=this.renderer.createSprite(e),i={sprite:t,data:e};if(!this.isBuilderMode&&e.physicsEnabled&&this.physicsGroup){const s=this.createPhysicsBody(t,e);i.physicsBody=s}this.items.set(e.id,i),this.isBuilderMode&&this.dragController&&this.dragController.makeInteractive(t,e.id)}createPhysicsBody(e,t){const i=e.getBounds(),s=i.width*.5,r=i.height*.8,a=e.x,l=e.y,o=this.scene.add.rectangle(a,l,s,r);return o.setVisible(!1),this.physicsGroup.add(o),o.setData("itemId",t.id),o}updateSelectionVisuals(){if(!this.selectionManager)return;const e=this.scene.data.get("selectedItemId");if(this.selectionManager.setSelectedId(e),!e){this.selectionManager.clearVisuals(),Vi(null);return}const t=this.items.get(e);if(this.selectionManager.updateVisuals(t?.sprite??null),t?.sprite){const i=this.scene.cameras.main,s=t.sprite.getBounds(),{screenX:r,screenY:a}=qt(s.centerX,s.centerY,i),l=s.height*i.zoom;Vi({screenX:r,screenY:a,itemHeight:l})}else Vi(null)}updateItem(e,t){const i=this.items.get(e);i&&(this.renderer.applyUpdates(i.sprite,t),i.data={...i.data,...t})}removeItem(e){const t=this.items.get(e);t&&(this.dragController&&this.dragController.removeInteractivity(t.sprite),t.physicsBody&&t.physicsBody.destroy(),t.sprite.destroy(),this.items.delete(e))}removeAllItems(){this.items.forEach(e=>{!e.sprite||!e.sprite.scene||(this.dragController&&this.dragController.removeInteractivity(e.sprite),e.physicsBody&&e.physicsBody.destroy(),e.sprite.destroy())}),this.items.clear()}getItem(e){return this.items.get(e)?.data}getAllItems(){return Array.from(this.items.values()).map(e=>e.data)}getPhysicsGroup(){return this.physicsGroup}setInteractiveEnabled(e){!this.isBuilderMode||!this.dragController||(this.items.forEach(({sprite:t,data:i})=>{e?(this.dragController.makeInteractive(t,i.id),t.setAlpha(1)):(t.disableInteractive(),t.setAlpha(.6))}),!e&&this.selectionManager&&this.selectionManager.clearVisuals())}destroy(){this.removeAllItems(),this.selectionManager?.destroy()}setupBackgroundDeselect(){!this.isBuilderMode||!this.selectionManager||this.selectionManager.setupBackgroundDeselect(()=>this.dragController?.getIsDragging()??!1)}}function Lc(){return`frame_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const Rc=["#ffffff","#f8f8f8","#fffacd","#ffefd5","#ffe4e1","#e6e6fa","#f0fff0","#f5fffa","#fff0f5","#f0f8ff","#2d2d2d","#1a1a2e","#16213e","#1a1a1a","#2d132c","#1e3a3a","#3d1a1a","#1a2f1a","#3d3d1a","#2a1a3d"],Hc=["#333333","#000000","#ffffff","#1a1a1a","#666666","#8b4513","#2c3e50","#c0392b","#27ae60","#2980b9","#8e44ad","#f39c12"],Fc=[12,14,16,18,20,24,28,32],Xc=[{value:"top",label:"Top",icon:"â"},{value:"center",label:"Center",icon:"â¬"},{value:"bottom",label:"Bottom",icon:"â"}],Ua={S:{label:"Small",scale:3},M:{label:"Medium",scale:4},L:{label:"Large",scale:5}};function Nc(n){return Ua[n].scale}function Zc(n){return n<=3?"S":n>=5?"L":"M"}const $t=4,Yn="#ffffff",Va="#333333",mi=16,ja="center",Yc=64,Wc=96,Bc=.06,or=32,Ti=[{key:"base_1",name:"Frame 1",path:"assets/frames/base 1.png",scale:4},{key:"base_2",name:"Frame 2",path:"assets/frames/base 2.png",scale:4},{key:"base_3",name:"Frame 3",path:"assets/frames/base 3.png",scale:4},{key:"base_4",name:"Frame 4",path:"assets/frames/base 4.png",scale:4},{key:"base_5",name:"Frame 5",path:"assets/frames/base 5.png",scale:4},{key:"base_6",name:"Frame 6",path:"assets/frames/base 6.png",scale:4},{key:"base_7",name:"Frame 7",path:"assets/frames/base 7.png",scale:4},{key:"base_8",name:"Frame 8",path:"assets/frames/base 8.png",scale:4},{key:"base_9",name:"Frame 9",path:"assets/frames/base 9.png",scale:4},{key:"base_10",name:"Frame 10",path:"assets/frames/base 10.png",scale:4},{key:"base_11",name:"Frame 11",path:"assets/frames/base 11.png",scale:4},{key:"base_12",name:"Frame 12",path:"assets/frames/base 12.png",scale:4},{key:"base_13",name:"Frame 13",path:"assets/frames/base 13.png",scale:4},{key:"base_14",name:"Frame 14",path:"assets/frames/base 14.png",scale:4},{key:"base_15",name:"Frame 15",path:"assets/frames/base 15.png",scale:4},{key:"base_16",name:"Frame 16",path:"assets/frames/base 16.png",scale:4},{key:"base_17",name:"Frame 17",path:"assets/frames/base 17.png",scale:4},{key:"base_18",name:"Frame 18",path:"assets/frames/base 18.png",scale:4},{key:"base_19",name:"Frame 19",path:"assets/frames/base 19.png",scale:4},{key:"base_20",name:"Frame 20",path:"assets/frames/base 20.png",scale:4},{key:"base_21",name:"Frame 21",path:"assets/frames/base 21.png",scale:4},{key:"base_22",name:"Frame 22",path:"assets/frames/base 22.png",scale:4},{key:"base_23",name:"Frame 23",path:"assets/frames/base 23.png",scale:4},{key:"base_24",name:"Frame 24",path:"assets/frames/base 24.png",scale:4},{key:"base_25",name:"Frame 25",path:"assets/frames/base 25.png",scale:4}];function zc(n){return Ti.find(e=>e.key===n)}function Kc(n){return zc(n)?.scale??$t}function Un(n=$t,e=!1){const t=Yc*n,i=Wc*n,s=e?i:t,r=e?t:i,a=Math.min(t,i)*Bc,l=s-a*2,o=r-a*2,d=l-or*2,u=o-or*2;return{frameWidth:s,frameHeight:r,innerWidth:l,innerHeight:o,textWidth:d,textHeight:u}}function vi(n,e,t,i,s,r,a=4){n.clear();const l=parseInt(r.replace("#",""),16);n.fillStyle(l,1),n.fillRoundedRect(e-i/2,t-s/2,i,s,a)}class lr{scene;frames=new Map;constructor(e){this.scene=e}static preloadAssets(e){for(let t=1;t<=25;t++)e.load.image(`frame_base_${t}`,`assets/frames/base ${t}.png`)}createFrames(e){e.forEach(t=>{this.createFrame(t)})}createFrame(e){const t=`frame_${e.frameKey}`;if(!this.scene.textures.exists(t)){console.warn(`[GameFrameManager] Frame texture not found: ${t}`);return}const i=e.scale??$t,s=e.depth??Ge.ITEMS_FRONT,r=(e.rotation??0)*(Math.PI/180),a=e.rotation===90,{innerWidth:l,innerHeight:o}=Un(i,a),d=this.scene.add.graphics();d.setDepth(s-.1),vi(d,e.x,e.y,l,o,e.backgroundColor||Yn);const u=this.scene.add.sprite(e.x,e.y,t);u.setScale(i),u.setDepth(s),u.setOrigin(.5,.5),u.setRotation(r);const h={sprite:u,background:d,data:e};this.frames.set(e.id,h),e.url&&this.makeClickable(h)}makeClickable(e){const{sprite:t,data:i}=e;t.setInteractive({useHandCursor:!0}),t.on("pointerover",()=>{t.setScale((i.scale??$t)*1.05)}),t.on("pointerout",()=>{t.setScale(i.scale??$t)}),t.on("pointerdown",()=>{i.url&&(xa(),window.open(i.url,"_blank","noopener,noreferrer"))})}destroy(){this.frames.forEach(({sprite:e,background:t})=>{e.destroy(),t.destroy()}),this.frames.clear()}}function Gc(){return`social_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const si={S:{label:"Small",scale:1.5},M:{label:"Medium",scale:2},L:{label:"Large",scale:2.5}},xn=si.M.scale;function Uc(n){return si[n].scale}function Vc(n){return n<=si.S.scale?"S":n>=si.L.scale?"L":"M"}const Di=[{key:"discord",name:"Discord",path:"assets/socials/Discord.png",scale:1},{key:"facebook",name:"Facebook",path:"assets/socials/Facebook.png",scale:1},{key:"instagram",name:"Instagram",path:"assets/socials/Instagram.png",scale:1},{key:"kofi",name:"Ko-Fi",path:"assets/socials/Ko Fi.png",scale:1},{key:"linkedin",name:"LinkedIn",path:"assets/socials/LinkedIn.png",scale:1},{key:"patreon",name:"Patreon",path:"assets/socials/Patreon.png",scale:1},{key:"tiktok",name:"TikTok",path:"assets/socials/TikTok.png",scale:1},{key:"twitch",name:"Twitch",path:"assets/socials/Twitch.png",scale:1},{key:"twitter",name:"Twitter",path:"assets/socials/Twitter.png",scale:1},{key:"whatsapp",name:"WhatsApp",path:"assets/socials/Whatsapp.png",scale:1},{key:"youtube",name:"YouTube",path:"assets/socials/Youtube.png",scale:1}];class cr{scene;socials=new Map;constructor(e){this.scene=e}static preloadAssets(e){Di.forEach(t=>{e.load.image(`social_${t.key}`,t.path)})}createSocials(e){e.forEach(t=>{this.createSocial(t)})}createSocial(e){const t=`social_${e.socialKey}`;if(!this.scene.textures.exists(t)){console.warn(`[GameSocialManager] Social texture not found: ${t}`);return}const i=e.scale??xn,s=e.depth??Ge.ITEMS_FRONT,r=this.scene.add.sprite(e.x,e.y,t);r.setScale(i),r.setDepth(s),r.setOrigin(.5,.5),this.socials.set(e.id,r),e.url&&this.makeClickable(r,e)}makeClickable(e,t){const i=t.scale??xn;e.setInteractive({useHandCursor:!0}),e.on("pointerover",()=>{e.setScale(i*1.1)}),e.on("pointerout",()=>{e.setScale(i)}),e.on("pointerdown",()=>{t.url&&(xa(),window.open(t.url,"_blank","noopener,noreferrer"))})}destroy(){this.socials.forEach(e=>{e.destroy()}),this.socials.clear()}}async function dr(){const n=await fetch("./config/map.json");if(!n.ok)throw new Error(`Failed to load map config: ${n.status}`);const e=await n.json();if(!e.worldWidth||!e.worldHeight)throw new Error("Invalid map config structure");return e}const _i={generateId(){return`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`},create(n){const{assetKey:e,x:t,yOffset:i=0,depthLayer:s="behind",scale:r}=n;return{id:_i.generateId(),assetKey:e,x:Math.round(t),y:0,scale:r??_c(e),depth:Is(s),yOffset:Math.round(i)}},createAtWorldPosition(n,e,t,i,s="behind"){return _i.create({assetKey:n,x:e,yOffset:t-i,depthLayer:s})},clone(n,e=50){return{...n,id:_i.generateId(),x:n.x+e}}},gn={HEIGHT:Pn,VISUAL:{COLOR:9139029,ALPHA:.3},PHYSICS:{COLOR:0,ALPHA:0}},ri={getGroundY(n,e=Pn){return n-e},createVisualGround(n,e){const t=e.height??gn.HEIGHT,i=ri.getGroundY(e.worldHeight,t),s=n.add.rectangle(0,i,e.worldWidth,t,e.color??gn.VISUAL.COLOR,e.alpha??gn.VISUAL.ALPHA);return s.setOrigin(0,0),s.setDepth(e.depth??Ge.GROUND_REFERENCE),{ground:s,groundY:i}},createPhysicsGround(n,e){const t=e.height??gn.HEIGHT,i=ri.getGroundY(e.worldHeight,t),s=n.add.rectangle(0,i,e.worldWidth,t,e.color??gn.PHYSICS.COLOR,e.alpha??gn.PHYSICS.ALPHA);return s.setOrigin(0,0),n.physics.add.existing(s,!0),{ground:s,groundY:i}},addPlayerCollision(n,e,t){return n.physics.add.collider(e,t)}},mt={GAME:"GameScene",BUILDER:"BuilderScene"};class jc extends N.Scene{player;mapConfig;parallaxLayers=null;loadedBackgrounds=new Set;itemManager;frameManager;socialManager;dialogZones=[];currentDialogZone=null;unsubscribers=[];initData;constructor(){super({key:mt.GAME})}init(e){this.initData=e}preload(){kt.forEach(e=>{this.load.spritesheet(`cat-idle-${e}`,`assets/sprites/${e}/Idle.png`,{frameWidth:48,frameHeight:48}),this.load.spritesheet(`cat-walk-${e}`,`assets/sprites/${e}/Walk.png`,{frameWidth:48,frameHeight:48})}),Ci.preloadAssets(this),lr.preloadAssets(this),cr.preloadAssets(this)}create(){this.initializeScene()}async initializeScene(){ls.set(!0);try{await this.loadMapConfiguration();const e=ei.getCurrentConfig();await this.loadBackgroundIfNeeded(e),this.createParallaxBackground();const{ground:t,groundY:i}=ri.createPhysicsGround(this,{worldWidth:this.mapConfig.worldWidth,worldHeight:this.mapConfig.worldHeight}),s=Pl(this.mapConfig.playerStartY,this.mapConfig.worldHeight);this.player=new Xl(this,this.mapConfig.playerStartX,s),ri.addPlayerCollision(this,this.player,t),this.itemManager=new Ci(this,i,this.mapConfig.worldWidth,this.mapConfig.worldHeight,!1),this.mapConfig.placedItems&&this.mapConfig.placedItems.length>0&&this.itemManager.createItems(this.mapConfig.placedItems);const r=this.itemManager.getPhysicsGroup();r&&this.physics.add.collider(this.player,r),this.frameManager=new lr(this),this.mapConfig.placedFrames&&this.mapConfig.placedFrames.length>0&&this.frameManager.createFrames(this.mapConfig.placedFrames),this.socialManager=new cr(this),this.mapConfig.placedSocials&&this.mapConfig.placedSocials.length>0&&this.socialManager.createSocials(this.mapConfig.placedSocials),this.dialogZones=this.mapConfig.dialogZones||[];const a=Ts.subscribe(l=>{this.dialogZones=l,this.recheckCurrentZone()});this.unsubscribers.push(a),this.cameras.main.startFollow(this.player,!0,.1,.1),this.cameras.main.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.physics.world.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.scale.on("resize",this.handleResize,this)}catch(e){console.error("[GameScene] Failed to initialize scene:",e)}finally{ls.set(!1)}}async loadMapConfiguration(){try{if(this.initData?.useBuilderConfig){const e=fc();this.mapConfig=e||await dr()}else this.mapConfig=await dr()}catch(e){console.error("[GameScene] Failed to load map configuration:",e);const t=600;this.mapConfig={worldWidth:3200,worldHeight:t,playerStartX:400,playerStartY:Qn(t),placedItems:[]}}}createParallaxBackground(){const e=ei.getCurrentConfig();this.parallaxLayers=Da(this,this.mapConfig.worldWidth,this.mapConfig.worldHeight,e)}async loadBackgroundIfNeeded(e){if(this.loadedBackgrounds.has(e.folder))return!0;const t=await Ta(this,e);return t&&this.loadedBackgrounds.add(e.folder),t}handleResize(e){if(!(!this.cameras?.main||!this.mapConfig)&&(this.cameras.main.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.parallaxLayers?.baseLayer)){const t=Math.max(this.mapConfig.worldHeight,e.height);this.parallaxLayers.baseLayer.setSize(this.mapConfig.worldWidth,t)}}shutdown(){this.scale.off("resize",this.handleResize,this),Bi(null),this.currentDialogZone=null,this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.itemManager&&this.itemManager.destroy(),this.frameManager&&this.frameManager.destroy(),this.socialManager&&this.socialManager.destroy()}update(){if(!this.player)return;this.player.update();const e=this.cameras.main,t=this.player.x-e.scrollX,i=this.player.y-e.scrollY;Tl(t,i),Dl(e.scrollX,e.scrollY,e.zoom),this.checkDialogZones(),this.parallaxLayers&&Aa(this.parallaxLayers.baseLayer,this.cameras.main)}checkDialogZones(){const e=this.player.x;let t=null;for(const i of this.dialogZones)if(e>=i.x&&e<=i.x+i.width){t=i;break}t?.id!==this.currentDialogZone?.id&&(this.currentDialogZone=t,Bi(t))}recheckCurrentZone(){if(!this.currentDialogZone)return;const e=this.dialogZones.find(t=>t.id===this.currentDialogZone?.id);e&&(this.currentDialogZone=e,Bi(e))}}const Ji=1,ur=.001,qc=.15,hr=400;class Jc{scene;camera;worldWidth;worldHeight;isPanning=!1;panStartX=0;panStartY=0;cameraDragStartX=0;cameraDragStartY=0;isDraggingToScroll=!1;dragScrollStartX=0;dragScrollStartY=0;dragScrollCameraStartX=0;dragScrollCameraStartY=0;currentZoom=1;targetZoom=1;minZoom=.1;isAnimatingReset=!1;zoomTargetWorldPoint=null;pinchStartDistance=0;pinchStartZoom=1;activeTouches=new Map;pinchEndTime=0;isPinching=!1;PINCH_COOLDOWN=150;touchStartTime=0;touchStartPos=null;touchOnSelectedSprite=!1;TAP_MAX_DURATION=200;TAP_MAX_DISTANCE=10;constructor(e,t,i){this.scene=e,this.camera=e.cameras.main,this.worldWidth=t,this.worldHeight=i}setup(){this.calculateMinZoom(),this.setupCamera(),this.setupMouseControls(),this.setupKeyboardControls(),this.setupUpdateLoop()}calculateMinZoom(){const e=this.camera.width/this.worldWidth,t=this.camera.height/this.worldHeight;this.minZoom=Math.min(e,t)}setupCamera(){this.currentZoom=this.minZoom,this.targetZoom=this.minZoom,this.camera.setZoom(this.minZoom);const e=this.camera.width/this.minZoom,t=this.camera.height/this.minZoom,i=Math.min(0,(this.worldWidth-e)/2),s=Math.min(0,(this.worldHeight-t)/2),r=Math.max(this.worldWidth,e),a=Math.max(this.worldHeight,t);this.camera.setBounds(i,s,r,a),this.camera.centerOn(this.worldWidth/2,this.worldHeight/2),fi(this.minZoom)}centerOn(e,t){this.camera.centerOn(e,t),this.clampScroll()}handleResize(){this.calculateMinZoom(),this.currentZoom<this.minZoom&&(this.currentZoom=this.minZoom,this.targetZoom=this.minZoom,this.camera.setZoom(this.minZoom)),this.targetZoom<this.minZoom&&(this.targetZoom=this.minZoom),this.updateCameraBounds(),this.clampScroll(),fi(this.currentZoom)}updateCameraBounds(){const e=this.camera.width/this.currentZoom,t=this.camera.height/this.currentZoom,i=Math.min(0,(this.worldWidth-e)/2),s=Math.min(0,(this.worldHeight-t)/2),r=Math.max(this.worldWidth,e),a=Math.max(this.worldHeight,t);this.camera.setBounds(i,s,r,a)}getScrollBounds(e=!0){const t=this.camera.width/this.currentZoom,i=this.camera.height/this.currentZoom;let s,r,a,l;return t>this.worldWidth?e?s=r=(this.worldWidth-t)/2:(s=this.worldWidth-t,r=0):(s=0,r=this.worldWidth-t),i>this.worldHeight?e?a=l=(this.worldHeight-i)/2:(a=this.worldHeight-i,l=0):(a=0,l=this.worldHeight-i),{minX:s,maxX:r,minY:a,maxY:l}}clampScroll(){const e=this.getScrollBounds(!0);this.camera.scrollX=N.Math.Clamp(this.camera.scrollX,e.minX,e.maxX),this.camera.scrollY=N.Math.Clamp(this.camera.scrollY,e.minY,e.maxY)}softClampScroll(){const e=this.getScrollBounds(!1);this.camera.scrollX=N.Math.Clamp(this.camera.scrollX,e.minX,e.maxX),this.camera.scrollY=N.Math.Clamp(this.camera.scrollY,e.minY,e.maxY)}applyPanDelta(e,t,i,s,r,a){const l=this.getScrollBounds(),o=(e-i)/this.currentZoom,d=(t-s)/this.currentZoom;this.camera.scrollX=N.Math.Clamp(r-o,l.minX,l.maxX),this.camera.scrollY=N.Math.Clamp(a-d,l.minY,l.maxY)}zoomToPoint(e,t,i){const s=this.camera.getWorldPoint(e,t);this.zoomToWorldPoint(s.x,s.y,i)}zoomToWorldPoint(e,t,i){const s=this.camera.scrollX,r=this.camera.scrollY,a=this.currentZoom;this.currentZoom=i,this.camera.setZoom(i),this.updateCameraBounds(),this.camera.scrollX=e-(e-s)*a/i,this.camera.scrollY=t-(t-r)*a/i,this.softClampScroll(),fi(this.currentZoom)}setupMouseControls(){this.scene.input.on("wheel",(e,t,i,s,r)=>{if(this.isAnimatingReset)return;if((e.event.ctrlKey||Math.abs(i)<5&&Math.abs(s)>0)&&!e.event.ctrlKey){const l=-s*ur*3;this.targetZoom=N.Math.Clamp(this.targetZoom+l,this.minZoom,Ji);const o=this.camera.getWorldPoint(e.x,e.y);this.zoomTargetWorldPoint={x:o.x,y:o.y}}else if(e.event.ctrlKey){const l=-s*ur,o=N.Math.Clamp(this.currentZoom+l,this.minZoom,Ji);this.targetZoom=o,this.zoomToPoint(e.x,e.y,o)}else{const l=this.getScrollBounds();this.camera.scrollX=N.Math.Clamp(this.camera.scrollX+i/this.currentZoom,l.minX,l.maxX),this.camera.scrollY=N.Math.Clamp(this.camera.scrollY+s/this.currentZoom,l.minY,l.maxY)}}),this.scene.input.on("pointerdown",e=>{if(e.wasTouch){if(this.activeTouches.set(e.id,{x:e.x,y:e.y}),this.activeTouches.size===2){this.isPinching=!0,this.startPinch(),this.touchStartPos=null,this.touchOnSelectedSprite=!1,this.scene.data.set("touchDraggingSprite",!1);return}this.activeTouches.size===1&&!this.isPinching&&(this.touchStartTime=Date.now(),this.touchStartPos={x:e.x,y:e.y},this.dragScrollStartX=e.x,this.dragScrollStartY=e.y,this.dragScrollCameraStartX=this.camera.scrollX,this.dragScrollCameraStartY=this.camera.scrollY,this.touchOnSelectedSprite=Mc(this.scene,e),this.scene.data.set("touchDraggingSprite",!1),this.scene.data.set("touchStartOnSelectedSprite",this.touchOnSelectedSprite),this.scene.data.set("touchStartWorldX",e.worldX),this.scene.data.set("touchStartWorldY",e.worldY));return}cn()||er()||this.isAnimatingReset||(e.rightButtonDown()||e.middleButtonDown()?(this.isPanning=!0,this.panStartX=e.x,this.panStartY=e.y,this.cameraDragStartX=this.camera.scrollX,this.cameraDragStartY=this.camera.scrollY):e.leftButtonDown()&&!this.isDraggingObject()&&(this.scene.data.get("isDraggingItem")===!0||(this.dragScrollStartX=e.x,this.dragScrollStartY=e.y,this.dragScrollCameraStartX=this.camera.scrollX,this.dragScrollCameraStartY=this.camera.scrollY)))}),this.scene.input.on("pointermove",e=>{if(e.wasTouch){if(this.activeTouches.has(e.id)&&this.activeTouches.set(e.id,{x:e.x,y:e.y}),this.activeTouches.size>=2&&this.isPinching){this.handlePinch();return}if(this.isPinching||Date.now()-this.pinchEndTime<this.PINCH_COOLDOWN||this.scene.data.get("touchDraggingSprite"))return;if(this.touchStartPos&&!this.isDraggingToScroll){const t=Math.abs(e.x-this.touchStartPos.x),i=Math.abs(e.y-this.touchStartPos.y);if(Math.sqrt(t*t+i*i)>this.TAP_MAX_DISTANCE){if(this.touchOnSelectedSprite){this.scene.data.set("touchDragStarted",!0),this.scene.data.set("touchDraggingSprite",!0),this.touchStartPos=null;return}!cn()&&!this.isDraggingObject()&&!this.scene.data.get("isDraggingItem")&&(this.isDraggingToScroll=!0,this.touchStartPos=null)}}this.isDraggingToScroll&&this.applyPanDelta(e.x,e.y,this.dragScrollStartX,this.dragScrollStartY,this.dragScrollCameraStartX,this.dragScrollCameraStartY);return}if(!(er()||this.isAnimatingReset)){if(this.isPanning)this.applyPanDelta(e.x,e.y,this.panStartX,this.panStartY,this.cameraDragStartX,this.cameraDragStartY);else if(e.leftButtonDown()&&!this.isDraggingToScroll&&!this.isDraggingObject()&&!(this.scene.data.get("isDraggingItem")===!0)){const i=Math.abs(e.x-this.dragScrollStartX),s=Math.abs(e.y-this.dragScrollStartY);Math.sqrt(i*i+s*s)>10&&(this.isDraggingToScroll=!0,this.scene.input.setDefaultCursor("grabbing"))}this.isDraggingToScroll&&this.applyPanDelta(e.x,e.y,this.dragScrollStartX,this.dragScrollStartY,this.dragScrollCameraStartX,this.dragScrollCameraStartY)}}),this.scene.input.on("pointerup",e=>{if(e.wasTouch){if(this.isPinching&&(this.pinchEndTime=Date.now(),this.isPinching=!1,Ki(!1)),this.touchStartPos&&!this.isDraggingToScroll){const t=Date.now()-this.touchStartTime,i=Math.abs(e.x-this.touchStartPos.x),s=Math.abs(e.y-this.touchStartPos.y),r=Math.sqrt(i*i+s*s);t<this.TAP_MAX_DURATION&&r<this.TAP_MAX_DISTANCE&&(this.scene.data.set("lastTapTime",Date.now()),this.scene.data.set("lastTapWorldX",e.worldX),this.scene.data.set("lastTapWorldY",e.worldY))}this.touchStartPos=null,this.touchOnSelectedSprite=!1,this.activeTouches.delete(e.id),this.scene.data.set("touchDraggingSprite",!1),this.scene.data.set("touchDragStarted",!1),this.scene.data.set("touchStartOnSelectedSprite",!1),this.isDraggingToScroll&&(this.isDraggingToScroll=!1);return}!e.rightButtonDown()&&!e.middleButtonDown()&&(this.isPanning=!1),this.isDraggingToScroll&&(this.isDraggingToScroll=!1,this.scene.input.setDefaultCursor("default"))}),this.scene.input.on("pointerout",e=>{e.wasTouch&&(this.activeTouches.delete(e.id),this.touchStartPos=null,this.touchOnSelectedSprite=!1,this.isPinching&&this.activeTouches.size<2&&(this.isPinching=!1,this.pinchEndTime=Date.now(),Ki(!1)))})}startPinch(){const e=Array.from(this.activeTouches.values());if(e.length!==2)return;const[t,i]=e;this.pinchStartDistance=Math.hypot(i.x-t.x,i.y-t.y),this.pinchStartZoom=this.currentZoom,Ki(!0)}handlePinch(){const e=Array.from(this.activeTouches.values());if(e.length!==2)return;const[t,i]=e,s=Math.hypot(i.x-t.x,i.y-t.y),r=(t.x+i.x)/2,a=(t.y+i.y)/2,l=s/this.pinchStartDistance,o=N.Math.Clamp(this.pinchStartZoom*l,this.minZoom,Ji);this.targetZoom=o,this.zoomToPoint(r,a,o)}setupKeyboardControls(){const e={up:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.UP,!1),down:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.DOWN,!1),left:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.LEFT,!1),right:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.RIGHT,!1)},t={w:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.W,!1),a:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.A,!1),s:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.S,!1),d:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.D,!1)};this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.SPACE,!1).on("down",()=>{Sn()||this.centerOnPlayer()}),this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.F,!1).on("down",()=>{Sn()||this.resetToFit()}),this.scene.data.set("cameraArrowKeys",e),this.scene.data.set("cameraWasdKeys",t)}setupUpdateLoop(){const e=this.scene.data.get("cameraArrowKeys"),t=this.scene.data.get("cameraWasdKeys");this.scene.events.on("update",()=>{if(!this.isAnimatingReset&&Math.abs(this.currentZoom-this.targetZoom)>1e-4){const r=N.Math.Linear(this.currentZoom,this.targetZoom,qc);this.zoomTargetWorldPoint?this.zoomToWorldPoint(this.zoomTargetWorldPoint.x,this.zoomTargetWorldPoint.y,r):this.zoomToPoint(this.camera.width/2,this.camera.height/2,r),Math.abs(this.currentZoom-this.targetZoom)<.001&&(this.zoomTargetWorldPoint=null)}if(Sn()||this.isAnimatingReset)return;const i=10/this.currentZoom,s=this.getScrollBounds();e?.left?.isDown||t?.a?.isDown?this.camera.scrollX=N.Math.Clamp(this.camera.scrollX-i,s.minX,s.maxX):(e?.right?.isDown||t?.d?.isDown)&&(this.camera.scrollX=N.Math.Clamp(this.camera.scrollX+i,s.minX,s.maxX)),e?.up?.isDown||t?.w?.isDown?this.camera.scrollY=N.Math.Clamp(this.camera.scrollY-i,s.minY,s.maxY):(e?.down?.isDown||t?.s?.isDown)&&(this.camera.scrollY=N.Math.Clamp(this.camera.scrollY+i,s.minY,s.maxY))})}centerOnPlayer(){const e=this.scene.data.get("playerSprite");e&&(this.camera.centerOn(e.x,e.y),this.clampScroll())}isDraggingObject(){return this.scene.data.get("isDraggingObject")===!0||this.scene.data.get("isDraggingItem")===!0}resetToFit(){if(this.isAnimatingReset)return;this.isAnimatingReset=!0,this.targetZoom=this.minZoom;const e=this.camera.width/this.minZoom,t=this.camera.height/this.minZoom,i=(this.worldWidth-e)/2,s=(this.worldHeight-t)/2,r=i+e/2,a=s+t/2;this.camera.pan(r,a,hr,"Sine.easeInOut"),this.camera.zoomTo(this.minZoom,hr,"Sine.easeInOut",!1,(l,o)=>{o===1&&(this.currentZoom=this.minZoom,this.camera.scrollX=i,this.camera.scrollY=s,this.isAnimatingReset=!1,fi(this.minZoom))})}destroy(){this.activeTouches.clear()}}const Qc=Rn.PLAYER.hex;class ed{scene;player;worldWidth;worldHeight;unsubscribers=[];interactionCleanup=null;constructor(e,t,i){this.scene=e,this.worldWidth=t,this.worldHeight=i}create(e,t){const i=Math.min(t,Qn(this.worldHeight));return this.player=this.scene.add.sprite(e,i,"cat-idle-white",0),this.player.setScale(kn.SCALE),this.player.setDepth(kn.DEPTH),this.player.setData("isPlayer",!0),this.scene.data.set("playerSprite",this.player),this.setupInteraction(),this.setupEditModeSubscription(),this.setupSelectionSubscription(),this.player}setupInteraction(){const e=new N.Geom.Rectangle(8,4,32,40);this.interactionCleanup=Xi({sprite:this.player,scene:this.scene,useGridSnapping:!1,cursor:"grab",hitArea:e,constraints:{minX:ar,maxX:this.worldWidth-ar,minY:Dc},callbacks:{onSelect:()=>{ac(!0)},isSelected:()=>ft(Gi),onDragStart:()=>{this.player.setTint(Hs),this.scene.data.set("isDraggingObject",!0)},onDrag:(t,i)=>{ir(Math.round(t),Math.round(i))},onDragEnd:(t,i)=>{this.updateSelectionVisual(ft(Gi)),this.scene.data.set("isDraggingObject",!1);let s=this.player.y;Ml(this.player.y,this.worldHeight)&&(s=Qn(this.worldHeight),this.player.setY(s)),ir(Math.round(this.player.x),Math.round(s))}}})}setupSelectionSubscription(){const e=Gi.subscribe(t=>{this.updateSelectionVisual(t),this.scene.data.set("isPlayerSelected",t)});this.unsubscribers.push(e)}updateSelectionVisual(e){this.player&&(e?this.player.setTint(Qc):this.player.clearTint())}setupEditModeSubscription(){const e=Ue.subscribe(t=>{t==="dialogs"?(this.interactionCleanup&&(this.interactionCleanup(),this.interactionCleanup=null),this.player.disableInteractive(),this.player.setAlpha(.6)):(this.player.setAlpha(1),this.interactionCleanup||this.setupInteraction())});this.unsubscribers.push(e)}getSprite(){return this.player}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.interactionCleanup&&(this.interactionCleanup(),this.interactionCleanup=null),this.player&&this.player.destroy()}}class td{scene;graphics;worldWidth;worldHeight;constructor(e,t,i){this.scene=e,this.worldWidth=t,this.worldHeight=i}create(){return this.graphics=this.scene.add.graphics(),this.graphics.setDepth(Ka),this.draw(),this.graphics}draw(){this.graphics.clear(),this.graphics.lineStyle(Sc,bc,wc);const e=Math.max(this.worldHeight,this.scene.scale.height);for(let i=0;i<=this.worldWidth;i+=bn)this.graphics.beginPath(),this.graphics.moveTo(i,0),this.graphics.lineTo(i,e),this.graphics.strokePath();for(let i=0;i<=e;i+=bn)this.graphics.beginPath(),this.graphics.moveTo(0,i),this.graphics.lineTo(this.worldWidth,i),this.graphics.strokePath();const t=this.worldHeight-Pn;this.graphics.lineStyle(Ec,qi,xc),this.graphics.beginPath(),this.graphics.moveTo(0,t),this.graphics.lineTo(this.worldWidth,t),this.graphics.strokePath(),this.graphics.lineStyle(Cc,qi,Tc),this.graphics.fillStyle(qi,Ic),this.graphics.fillRect(0,t,this.worldWidth,e-t)}getGraphics(){return this.graphics}redraw(){this.draw()}destroy(){this.graphics&&this.graphics.destroy()}}class nd{listeners=new Map;on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set);const i=this.listeners.get(e);return i.add(t),{unsubscribe:()=>{i.delete(t),i.size===0&&this.listeners.delete(e)}}}once(e,t){const i=this.on(e,s=>{i.unsubscribe(),t(s)});return i}emit(e,t){const i=this.listeners.get(e);i&&i.forEach(s=>{try{s(t)}catch(r){console.error(`[EventBus] Error in listener for "${e}":`,r)}})}off(e){this.listeners.delete(e)}clear(){this.listeners.clear()}listenerCount(e){return this.listeners.get(e)?.size??0}}const Ke=new nd,$e={ASSET_DROPPED:"asset:dropped",FRAME_DROPPED:"frame:dropped",SOCIAL_DROPPED:"social:dropped",MINIMAP_NAVIGATE:"minimap:navigate",DIALOG_ZONE_CREATE:"dialogZone:create",DIALOG_ZONE_CREATE_AT:"dialogZone:createAt",TEMP_ZONE_BUTTON_SHOW:"tempZoneButton:show",TEMP_ZONE_BUTTON_HIDE:"tempZoneButton:hide"};class id{scene;groundY;worldWidth;worldHeight;itemManager;unsubscribers=[];constructor(e,t,i,s){this.scene=e,this.groundY=t,this.worldWidth=i,this.worldHeight=s}create(e){return this.itemManager=new Ci(this.scene,this.groundY,this.worldWidth,this.worldHeight,!0),e&&e.length>0&&this.itemManager.createItems(e),this.setupBackgroundDeselect(),this.setupStoreSubscriptions(),this.setupAssetDropListener(),this.setupDeleteKeys(),this.itemManager}setupBackgroundDeselect(){this.itemManager.setupBackgroundDeselect()}setupStoreSubscriptions(){const e=Hi.subscribe(r=>{this.scene.data.set("selectedItemId",r),this.itemManager.updateSelectionVisuals()});this.unsubscribers.push(e);const t=Ue.subscribe(r=>{r==="dialogs"?(Ps(),this.itemManager.setInteractiveEnabled(!1)):this.itemManager.setInteractiveEnabled(!0)});this.unsubscribers.push(t);let i=[];const s=Bl.subscribe(r=>{if(!r?.placedItems)return;const a=r.placedItems;i.forEach(l=>{a.find(d=>d.id===l.id)||this.itemManager.removeItem(l.id)}),a.forEach(l=>{const o=i.find(d=>d.id===l.id);o&&JSON.stringify(o)!==JSON.stringify(l)&&this.itemManager.updateItem(l.id,l)}),i=a.map(l=>({...l}))});this.unsubscribers.push(s)}setupAssetDropListener(){const e=Ke.on($e.ASSET_DROPPED,t=>{const{assetKey:i,canvasX:s,canvasY:r}=t,l=this.scene.cameras.main.getWorldPoint(s,r),o=Math.max(0,Math.min(this.worldWidth,l.x)),d=Math.max(0,Math.min(this.worldHeight,l.y));let u="behind";Oa.subscribe(g=>{u=g})();const f=_i.createAtWorldPosition(i,o,d,this.groundY,u);rc(f),this.itemManager.createItem(f),Ya(f.id),nn.set(!1)});this.unsubscribers.push(()=>e.unsubscribe())}setupDeleteKeys(){const e=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.DELETE,!1),t=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.BACKSPACE,!1),i=()=>{if(Sn())return;const s=this.scene.data.get("selectedItemId");s&&Za(s)};e.on("down",i),t.on("down",i)}getManager(){return this.itemManager}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.itemManager&&this.itemManager.destroy()}}class fr{scene;worldWidth;worldHeight;frames=new Map;unsubscribers=[];selectionGraphics=null;cleanupFunctions=new Map;doubleClickDetector=new Ga;constructor(e,t,i){this.scene=e,this.worldWidth=t,this.worldHeight=i}static preloadAssets(e){for(let t=1;t<=25;t++)e.load.image(`frame_base_${t}`,`assets/frames/base ${t}.png`)}create(e){this.selectionGraphics=this.scene.add.graphics(),this.selectionGraphics.setDepth(Ge.SELECTION_GRAPHICS),e&&e.length>0&&e.forEach(t=>this.createFrame(t)),this.setupStoreSubscriptions(),this.setupFrameDropListener(),this.setupDeleteKeys()}createFrame(e){const t=`frame_${e.frameKey}`;if(!this.scene.textures.exists(t)){console.warn(`Frame texture not found: ${t}`);return}const i=e.scale??$t,s=e.depth??Ge.ITEMS_FRONT,r=(e.rotation??0)*(Math.PI/180),a=e.rotation===90,{innerWidth:l,innerHeight:o}=Un(i,a),d=this.scene.add.graphics();d.setDepth(s-.1),vi(d,e.x,e.y,l,o,e.backgroundColor||Yn);const u=this.scene.add.sprite(e.x,e.y,t);u.setScale(i),u.setDepth(s),u.setOrigin(.5,.5),u.setRotation(r),u.setData("frameId",e.id);const h={sprite:u,background:d,data:e};this.frames.set(e.id,h),this.makeInteractive(h,e.id)}updateFrameVisuals(e){const{sprite:t,background:i,data:s}=e,r=`frame_${s.frameKey}`;t.texture.key!==r&&this.scene.textures.exists(r)&&t.setTexture(r);const a=s.scale??$t;t.setScale(a);const l=(s.rotation??0)*(Math.PI/180);t.setRotation(l);const o=s.rotation===90,{innerWidth:d,innerHeight:u}=Un(a,o);vi(i,t.x,t.y,d,u,s.backgroundColor||Yn)}moveContainer(e,t,i){const{sprite:s,background:r,data:a}=e;s.setPosition(t,i);const l=a.scale??$t,o=a.rotation===90,{innerWidth:d,innerHeight:u}=Un(l,o);vi(r,t,i,d,u,a.backgroundColor||Yn)}makeInteractive(e,t){const{sprite:i}=e,s=Xi({sprite:i,scene:this.scene,cursor:"grab",useGridSnapping:!0,constraints:{minX:0,maxX:this.worldWidth,minY:0,maxY:this.worldHeight},callbacks:{onSelect:()=>{Kn(t),this.updateSelectionVisuals()},isSelected:()=>ft(ti)===t,onDoubleClick:()=>this.doubleClickDetector.check(t)?(Ma(),!0):!1,onDragStart:()=>{i.setTint(Hs)},onDrag:(r,a)=>{this.moveContainer(e,r,a),this.updateSelectionVisuals(),ec(t,r,a)},onDragEnd:(r,a)=>{i.clearTint(),tc(t),e.data.x=Math.round(r),e.data.y=Math.round(a),St(t,{x:e.data.x,y:e.data.y})}}});this.cleanupFunctions.set(t,s)}setupStoreSubscriptions(){const e=ti.subscribe(r=>{this.scene.data.set("selectedFrameId",r),this.updateSelectionVisuals()});this.unsubscribers.push(e);const t=Ue.subscribe(r=>{r==="dialogs"?(Kn(null),this.setInteractiveEnabled(!1)):this.setInteractiveEnabled(!0)});this.unsubscribers.push(t);let i=[];const s=La.subscribe(r=>{i.forEach(a=>{r.find(o=>o.id===a.id)||this.removeFrame(a.id)}),r.forEach(a=>{const l=i.find(d=>d.id===a.id),o=this.frames.get(a.id);if(o&&l){const d=l.backgroundColor!==a.backgroundColor,u=l.textColor!==a.textColor,h=l.textSize!==a.textSize,f=JSON.stringify(l.texts)!==JSON.stringify(a.texts),g=l.rotation!==a.rotation,v=l.scale!==a.scale,S=l.frameKey!==a.frameKey;o.data=a,(d||u||h||f||g||v||S)&&(this.updateFrameVisuals(o),this.scene.data.get("selectedFrameId")===a.id&&this.updateSelectionVisuals())}}),i=r.map(a=>({...a}))});this.unsubscribers.push(s)}setupFrameDropListener(){const e=Ke.on($e.FRAME_DROPPED,t=>{const{frameKey:i,canvasX:s,canvasY:r}=t,l=this.scene.cameras.main.getWorldPoint(s,r),o=Math.max(0,Math.min(this.worldWidth,l.x)),d=Math.max(0,Math.min(this.worldHeight,l.y)),u={id:Lc(),frameKey:i,x:Math.round(o),y:Math.round(d),scale:Kc(i),depth:Ge.ITEMS_FRONT,rotation:90,backgroundColor:Yn,textColor:"#333333",textSize:16,texts:[{language:"cs",text:""},{language:"en",text:""}]};mc(u),this.createFrame(u),Kn(u.id)});this.unsubscribers.push(()=>e.unsubscribe())}setupDeleteKeys(){const e=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.DELETE,!1),t=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.BACKSPACE,!1),i=()=>{if(Sn())return;let s="items";if(Ue.subscribe(l=>s=l)(),s!=="frames")return;const a=this.scene.data.get("selectedFrameId");a&&Os(a)};e.on("down",i),t.on("down",i)}updateSelectionVisuals(){if(!this.selectionGraphics)return;this.selectionGraphics.clear();const e=this.scene.data.get("selectedFrameId");if(!e){ji(null);return}const t=this.frames.get(e);if(!t){ji(null);return}const i=t.sprite,s=i.getBounds(),r=this.scene.cameras.main,{screenX:a,screenY:l}=qt(i.x,i.y,r);ji({screenX:a,screenY:l,frameHeight:s.height*r.zoom}),this.selectionGraphics.lineStyle(3,Rn.FRAME.hex,1),this.selectionGraphics.strokeRect(s.x-4,s.y-4,s.width+8,s.height+8)}removeFrame(e){const t=this.frames.get(e);t&&(t.sprite.destroy(),t.background.destroy(),this.frames.delete(e)),this.updateSelectionVisuals()}setInteractiveEnabled(e){this.frames.forEach(({sprite:t,background:i})=>{e?(t.setInteractive(),t.setAlpha(1),i.setAlpha(1)):(t.disableInteractive(),t.setAlpha(.6),i.setAlpha(.6))}),!e&&this.selectionGraphics&&this.selectionGraphics.clear()}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.frames.forEach(({sprite:e,background:t})=>{e.destroy(),t.destroy()}),this.frames.clear(),this.selectionGraphics&&(this.selectionGraphics.destroy(),this.selectionGraphics=null)}}class gr{scene;worldWidth;worldHeight;socials=new Map;unsubscribers=[];selectionGraphics=null;cleanupFunctions=new Map;doubleClickDetector=new Ga;constructor(e,t,i){this.scene=e,this.worldWidth=t,this.worldHeight=i}static preloadAssets(e){e.load.image("social_discord","assets/socials/Discord.png"),e.load.image("social_facebook","assets/socials/Facebook.png"),e.load.image("social_instagram","assets/socials/Instagram.png"),e.load.image("social_kofi","assets/socials/Ko Fi.png"),e.load.image("social_linkedin","assets/socials/LinkedIn.png"),e.load.image("social_patreon","assets/socials/Patreon.png"),e.load.image("social_tiktok","assets/socials/TikTok.png"),e.load.image("social_twitch","assets/socials/Twitch.png"),e.load.image("social_twitter","assets/socials/Twitter.png"),e.load.image("social_whatsapp","assets/socials/Whatsapp.png"),e.load.image("social_youtube","assets/socials/Youtube.png")}create(e){this.selectionGraphics=this.scene.add.graphics(),this.selectionGraphics.setDepth(Ge.SELECTION_GRAPHICS),e&&e.length>0&&e.forEach(t=>this.createSocial(t)),this.setupStoreSubscriptions(),this.setupSocialDropListener(),this.setupDeleteKeys()}createSocial(e){const t=`social_${e.socialKey}`;if(!this.scene.textures.exists(t)){console.warn(`Social texture not found: ${t}`);return}const i=e.scale??xn,s=e.depth??Ge.ITEMS_FRONT,r=this.scene.add.sprite(e.x,e.y,t);r.setScale(i),r.setDepth(s),r.setOrigin(.5,.5),r.setData("socialId",e.id),this.socials.set(e.id,{sprite:r,data:e}),this.makeInteractive(e.id)}updateSocialVisuals(e){const t=this.socials.get(e);if(!t)return;const{sprite:i,data:s}=t,r=`social_${s.socialKey}`;i.texture.key!==r&&this.scene.textures.exists(r)&&i.setTexture(r);const a=s.scale??xn;i.setScale(a)}makeInteractive(e){const t=this.socials.get(e);if(!t)return;const{sprite:i}=t,s=Xi({sprite:i,scene:this.scene,cursor:"grab",useGridSnapping:!0,constraints:{minX:0,maxX:this.worldWidth,minY:0,maxY:this.worldHeight},callbacks:{onSelect:()=>{Gn(e),this.updateSelectionVisuals()},isSelected:()=>ft(ni)===e,onDoubleClick:()=>this.doubleClickDetector.check(e)?($a(),!0):!1,onDragStart:()=>{i.setTint(Hs)},onDrag:()=>{this.updateSelectionVisuals()},onDragEnd:(r,a)=>{i.clearTint();const l=this.socials.get(e);l&&(l.data.x=Math.round(r),l.data.y=Math.round(a),pi(e,{x:l.data.x,y:l.data.y}))}}});this.cleanupFunctions.set(e,s)}setupStoreSubscriptions(){const e=ni.subscribe(r=>{this.scene.data.set("selectedSocialId",r),this.updateSelectionVisuals()});this.unsubscribers.push(e);const t=Ue.subscribe(r=>{r==="dialogs"?(Gn(null),this.setInteractiveEnabled(!1)):this.setInteractiveEnabled(!0)});this.unsubscribers.push(t);let i=[];const s=Jl.subscribe(r=>{i.forEach(a=>{r.find(o=>o.id===a.id)||this.removeSocial(a.id)}),r.forEach(a=>{const l=i.find(d=>d.id===a.id),o=this.socials.get(a.id);if(o&&l){const d=l.scale!==a.scale,u=l.socialKey!==a.socialKey;o.data=a,(d||u)&&(this.updateSocialVisuals(a.id),this.scene.data.get("selectedSocialId")===a.id&&this.updateSelectionVisuals())}}),i=r.map(a=>({...a}))});this.unsubscribers.push(s)}setupSocialDropListener(){const e=Ke.on($e.SOCIAL_DROPPED,t=>{const{socialKey:i,canvasX:s,canvasY:r}=t,l=this.scene.cameras.main.getWorldPoint(s,r),o=Math.max(0,Math.min(this.worldWidth,l.x)),d=Math.max(0,Math.min(this.worldHeight,l.y)),u={id:Gc(),socialKey:i,x:Math.round(o),y:Math.round(d),scale:xn,depth:Ge.ITEMS_FRONT};vc(u),this.createSocial(u),Gn(u.id)});this.unsubscribers.push(()=>e.unsubscribe())}setupDeleteKeys(){const e=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.DELETE,!1),t=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.BACKSPACE,!1),i=()=>{if(Sn())return;let s="items";if(Ue.subscribe(l=>s=l)(),s!=="socials")return;const a=this.scene.data.get("selectedSocialId");a&&Ls(a)};e.on("down",i),t.on("down",i)}updateSelectionVisuals(){if(!this.selectionGraphics)return;this.selectionGraphics.clear();const e=this.scene.data.get("selectedSocialId");if(!e){Ui(null);return}const t=this.socials.get(e);if(!t){Ui(null);return}const i=t.sprite,s=i.getBounds(),r=this.scene.cameras.main,{screenX:a,screenY:l}=qt(i.x,i.y,r);Ui({screenX:a,screenY:l,socialHeight:s.height*r.zoom}),this.selectionGraphics.lineStyle(3,Rn.SOCIAL.hex,1),this.selectionGraphics.strokeRect(s.x-4,s.y-4,s.width+8,s.height+8)}removeSocial(e){const t=this.socials.get(e);t&&(t.sprite.destroy(),this.socials.delete(e));const i=this.cleanupFunctions.get(e);i&&(i(),this.cleanupFunctions.delete(e)),this.updateSelectionVisuals()}setInteractiveEnabled(e){this.socials.forEach(({sprite:t})=>{e?(t.setInteractive(),t.setAlpha(1)):(t.disableInteractive(),t.setAlpha(.6))}),!e&&this.selectionGraphics&&this.selectionGraphics.clear()}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.cleanupFunctions.forEach(e=>e()),this.cleanupFunctions.clear(),this.socials.forEach(({sprite:e})=>{e.destroy()}),this.socials.clear(),this.selectionGraphics&&(this.selectionGraphics.destroy(),this.selectionGraphics=null)}}const Ft=Ka-1,Xt=300,pr=150,sd=.3,rd=.5,Qi=40,mr=60,vr=16777215,_r=.6,yr=0,bt=60,br=8;class ad{scene;worldWidth;worldHeight;graphics=null;zoneAreas=new Map;leftHandles=new Map;leftHandleVisuals=new Map;rightHandles=new Map;rightHandleVisuals=new Map;arrowGraphics=new Map;dragging=null;unsubscribers=[];createZoneSubscription;currentEditMode="items";currentZones=[];currentSelectedId=null;lastClickTime=0;lastClickX=0;DOUBLE_CLICK_THRESHOLD=300;DOUBLE_CLICK_DISTANCE=20;pendingTap=null;TAP_MAX_DURATION=300;TAP_MAX_DISTANCE=15;pendingZoneSelection=null;createZoneAtSubscription;boundWindowPointerUp=()=>{};boundWindowPointerMove=()=>{};currentScreenX=0;autoScrollTimer=null;constructor(e,t,i){this.scene=e,this.worldWidth=t,this.worldHeight=i}create(){this.graphics=this.scene.add.graphics(),this.graphics.setDepth(Ft);const e=Ue.subscribe(s=>{this.currentEditMode=s,this.render()});this.unsubscribers.push(e);const t=Ts.subscribe(s=>{this.currentZones=s,this.render()});this.unsubscribers.push(t);const i=Fi.subscribe(s=>{this.currentSelectedId=s,this.render()});this.unsubscribers.push(i),this.scene.input.on("pointermove",this.handlePointerMove,this),this.scene.input.on("pointerup",this.handlePointerUp,this),this.boundWindowPointerUp=this.handlePointerUp.bind(this),this.boundWindowPointerMove=this.handleWindowPointerMove.bind(this),window.addEventListener("pointerup",this.boundWindowPointerUp),window.addEventListener("pointermove",this.boundWindowPointerMove),this.scene.input.on("pointerdown",this.handlePointerDown,this),this.createZoneSubscription=Ke.on($e.DIALOG_ZONE_CREATE,()=>{this.createNewZone()}),this.createZoneAtSubscription=Ke.on($e.DIALOG_ZONE_CREATE_AT,s=>{this.createZoneAtPosition(s.worldX)}),this.render()}clearVisuals(){this.graphics&&this.graphics.clear(),this.zoneAreas.forEach(e=>e.destroy()),this.zoneAreas.clear(),this.leftHandles.forEach(e=>e.destroy()),this.leftHandles.clear(),this.rightHandles.forEach(e=>e.destroy()),this.rightHandles.clear(),this.leftHandleVisuals.forEach(e=>e.destroy()),this.leftHandleVisuals.clear(),this.rightHandleVisuals.forEach(e=>e.destroy()),this.rightHandleVisuals.clear(),this.arrowGraphics.forEach(e=>e.destroy()),this.arrowGraphics.clear()}render(){if(this.clearVisuals(),this.currentEditMode==="dialogs")for(const e of this.currentZones)this.renderZone(e,e.id===this.currentSelectedId)}renderZone(e,t){if(!this.graphics)return;const i=N.Display.Color.HexStringToColor(e.color).color,s=t?rd:sd;this.graphics.fillStyle(i,s),this.graphics.fillRect(e.x,0,e.width,this.worldHeight),this.graphics.lineStyle(2,i,.8),this.graphics.strokeRect(e.x,0,e.width,this.worldHeight);const r=this.scene.add.rectangle(e.x+e.width/2,this.worldHeight/2,e.width-Qi*2,this.worldHeight);r.setOrigin(.5,.5),r.setInteractive({cursor:t?"grab":"pointer"}),r.setDepth(Ft+.1),r.setAlpha(.001),r.setData("zoneId",e.id),r.on("pointerdown",a=>{if(this.isClickOnUIElement(a))return;const l=Date.now(),o=l-this.lastClickTime<this.DOUBLE_CLICK_THRESHOLD&&Math.abs(a.worldX-this.lastClickX)<this.DOUBLE_CLICK_DISTANCE;this.lastClickTime=l,this.lastClickX=a.worldX;const d=this.currentSelectedId===e.id;if(o&&d){Na();return}d?(this.scene.data.set("isDraggingItem",!0),En(!0),this.startDrag(e.id,"move",a.worldX)):this.pendingZoneSelection={zoneId:e.id,worldX:a.worldX,startTime:l}}),this.zoneAreas.set(e.id,r),t&&this.createHandles(e)}createHandles(e){const t=this.scene.cameras.main.scrollY,i=this.scene.cameras.main.height,s=t+i/2,r=this.scene.add.rectangle(e.x,this.worldHeight/2,Qi,this.worldHeight);r.setOrigin(.5,.5),r.setDepth(Ft+.2),r.setFillStyle(vr,_r);const a=this.scene.add.rectangle(e.x,this.worldHeight/2,mr,this.worldHeight);a.setOrigin(.5,.5),a.setInteractive({cursor:"ew-resize"}),a.setDepth(Ft+.25),a.setAlpha(.001),a.setData("zoneId",e.id),a.setData("type","left"),a.on("pointerdown",f=>{this.isClickOnUIElement(f)||this.startDrag(e.id,"left",f.worldX)}),this.leftHandles.set(e.id,a),this.leftHandleVisuals.set(e.id,r);const l=8,o=this.scene.add.graphics();o.setDepth(Ft+.3),this.drawArrow(o,e.x-l,s,"left"),this.arrowGraphics.set(`${e.id}_left`,o);const d=this.scene.add.rectangle(e.x+e.width,this.worldHeight/2,Qi,this.worldHeight);d.setOrigin(.5,.5),d.setDepth(Ft+.2),d.setFillStyle(vr,_r);const u=this.scene.add.rectangle(e.x+e.width,this.worldHeight/2,mr,this.worldHeight);u.setOrigin(.5,.5),u.setInteractive({cursor:"ew-resize"}),u.setDepth(Ft+.25),u.setAlpha(.001),u.setData("zoneId",e.id),u.setData("type","right"),u.on("pointerdown",f=>{this.isClickOnUIElement(f)||this.startDrag(e.id,"right",f.worldX)}),this.rightHandles.set(e.id,u),this.rightHandleVisuals.set(e.id,d);const h=this.scene.add.graphics();h.setDepth(Ft+.3),this.drawArrow(h,e.x+e.width+l,s,"right"),this.arrowGraphics.set(`${e.id}_right`,h)}drawArrow(e,t,i,s){const a=s==="left"?-1:1;e.fillStyle(3355443,.8),e.beginPath(),e.moveTo(t+a*10+1,i),e.lineTo(t-a*10+1,i-10+1),e.lineTo(t-a*10+1,i+10-1),e.closePath(),e.fillPath(),e.fillStyle(16777215,.9),e.beginPath(),e.moveTo(t+a*10,i),e.lineTo(t-a*10,i-10),e.lineTo(t-a*10,i+10),e.closePath(),e.fillPath()}startDrag(e,t,i){const s=this.currentZones.find(r=>r.id===e);s&&(this.scene.data.set("isDraggingItem",!0),En(!0),this.dragging={zoneId:e,type:t,startX:i,originalX:s.x,originalWidth:s.width})}getZoneBounds(e){let t=0,i=this.worldWidth;for(const s of this.currentZones){if(s.id===e)continue;const r=s.x+s.width,a=this.currentZones.find(l=>l.id===e);a&&(r<=a.x+a.width/2&&(t=Math.max(t,r+yr)),s.x>=a.x+a.width/2&&(i=Math.min(i,s.x-yr)))}return{minX:t,maxX:i-Xt,maxRight:i}}wouldOverlap(e,t,i){const s=t+i;for(const r of this.currentZones){if(r.id===e)continue;const a=r.x,l=r.x+r.width;if(t<l&&s>a)return!0}return!1}isClickOnUIElement(e){const t=e.downElement;return t?t.tagName?.toUpperCase()!=="CANVAS":!1}cancelPendingIfMoved(e){this.pendingTap&&Math.abs(e-this.pendingTap.worldX)>this.TAP_MAX_DISTANCE&&(this.pendingTap=null),this.pendingZoneSelection&&Math.abs(e-this.pendingZoneSelection.worldX)>this.TAP_MAX_DISTANCE&&(this.pendingZoneSelection=null)}screenToWorld(e,t){const i=this.scene.cameras.main,r=this.scene.game.canvas.getBoundingClientRect(),a=e-r.left,l=t-r.top;return Hl(a,l,i)}handleWindowPointerMove(e){const t=this.screenToWorld(e.clientX,e.clientY);if(this.cancelPendingIfMoved(t.worldX),!this.dragging)return;const s=this.scene.game.canvas.getBoundingClientRect();e.clientX>=s.left&&e.clientX<=s.right&&e.clientY>=s.top&&e.clientY<=s.bottom||(this.currentScreenX=e.clientX-s.left,this.updateDrag(t.worldX),this.checkAutoScroll())}handlePointerMove(e){this.cancelPendingIfMoved(e.worldX),this.dragging&&(this.currentScreenX=e.x,e.event?.stopPropagation?.(),this.updateDrag(e.worldX),this.checkAutoScroll())}checkAutoScroll(){if(!this.dragging||this.dragging.type!=="move"){this.stopAutoScroll();return}const e=this.scene.cameras.main,t=e.width,i=this.currentZones.find(w=>w.id===this.dragging?.zoneId);if(!i)return;const s=Math.max(0,this.worldWidth-e.width/e.zoom);if(s<=0){this.stopAutoScroll();return}const{screenX:r}=qt(i.x,0,e),{screenX:a}=qt(i.x+i.width,0,e),l=r<=bt,o=a>=t-bt,d=e.scrollX>0,u=e.scrollX<s,h=i.x>0,f=i.x+i.width<this.worldWidth,g=this.currentScreenX<bt,v=this.currentScreenX>t-bt,p=l&&g&&d&&h||o&&v&&u&&f;p&&!this.autoScrollTimer?this.autoScrollTimer=this.scene.time.addEvent({delay:16,callback:this.performAutoScroll,callbackScope:this,loop:!0}):!p&&this.autoScrollTimer&&this.stopAutoScroll()}performAutoScroll(){if(!this.dragging||this.dragging.type!=="move"){this.stopAutoScroll();return}const e=this.scene.cameras.main,t=e.width,i=this.currentZones.find(_=>_.id===this.dragging?.zoneId);if(!i)return;let s=0;if(this.currentScreenX<bt){if(i.x<=0){this.stopAutoScroll();return}const p=(bt-this.currentScreenX)/bt;s=-br*p}else if(this.currentScreenX>t-bt){if(i.x+i.width>=this.worldWidth){this.stopAutoScroll();return}const p=(this.currentScreenX-(t-bt))/bt;s=br*p}if(s===0)return;const r=e.scrollX+s,a=0,l=Math.max(0,this.worldWidth-e.width/e.zoom),d=Math.max(a,Math.min(l,r))-e.scrollX;if(l<=0){this.stopAutoScroll();return}if(d===0){this.stopAutoScroll();return}const u=i.x+d,h=Math.max(0,Math.min(this.worldWidth-i.width,u)),f=h-i.x;if(f===0){this.stopAutoScroll();return}const g=e.scrollX+f,v=Math.max(0,Math.min(l,g));if(Math.abs(v-e.scrollX)>Math.abs(f)*2){this.stopAutoScroll();return}e.scrollX=v,this.wouldOverlap(i.id,h,i.width)||(mn(i.id,{x:h}),this.dragging.originalX+=f,this.dragging.startX+=f)}stopAutoScroll(){this.autoScrollTimer&&(this.autoScrollTimer.destroy(),this.autoScrollTimer=null)}updateDrag(e){if(!this.dragging)return;const t=e-this.dragging.startX,i=this.currentZones.find(r=>r.id===this.dragging?.zoneId);if(!i)return;const s=this.getZoneBounds(i.id);if(this.dragging.type==="left"){let r=this.dragging.originalX+t,a=this.dragging.originalWidth-t;if(r<0&&(a+=r,r=0),a<Xt&&(r=this.dragging.originalX+this.dragging.originalWidth-Xt,a=Xt),r<s.minX){const l=s.minX-r;r=s.minX,a-=l}a>=Xt&&!this.wouldOverlap(i.id,r,a)&&mn(i.id,{x:r,width:a})}else if(this.dragging.type==="right"){let r=this.dragging.originalWidth+t;r<Xt&&(r=Xt),i.x+r>this.worldWidth&&(r=this.worldWidth-i.x),i.x+r>s.maxRight&&(r=s.maxRight-i.x),r>=Xt&&!this.wouldOverlap(i.id,i.x,r)&&mn(i.id,{width:r})}else if(this.dragging.type==="move"){let r=this.dragging.originalX+t;const a=i.width;if(r<0&&(r=0),r+a>this.worldWidth&&(r=this.worldWidth-a),!this.wouldOverlap(i.id,r,a))mn(i.id,{x:r});else{const l=this.findNonOverlappingPosition(i.id,r,a);l!==null&&mn(i.id,{x:l})}}}findNonOverlappingPosition(e,t,i){const s=this.currentZones.filter(u=>u.id!==e).sort((u,h)=>u.x-h.x);if(s.length===0)return Math.max(0,Math.min(t,this.worldWidth-i));let r=t,a=1/0;const l=s[0];if(l.x>=i){const u=l.x-i,h=Math.max(0,Math.min(t,u)),f=Math.abs(h-t);f<a&&(a=f,r=h)}for(let u=0;u<s.length-1;u++){const h=s[u],f=s[u+1],g=h.x+h.width,v=f.x;if(v-g>=i){const _=g,p=v-i,w=Math.max(_,Math.min(t,p)),y=Math.abs(w-t);y<a&&(a=y,r=w)}}const o=s[s.length-1],d=o.x+o.width;if(this.worldWidth-d>=i){const u=d,h=this.worldWidth-i,f=Math.max(u,Math.min(t,h)),g=Math.abs(f-t);g<a&&(a=g,r=f)}return a<1/0&&!this.wouldOverlap(e,r,i)?r:null}handlePointerUp(e){if(this.dragging&&(this.stopAutoScroll(),this.scene.data.set("isDraggingItem",!1),En(!1),this.dragging=null),this.pendingZoneSelection){let s=Date.now()-this.pendingZoneSelection.startTime<this.TAP_MAX_DURATION;s&&e&&e.worldX!==void 0&&(s=Math.abs(e.worldX-this.pendingZoneSelection.worldX)<this.TAP_MAX_DISTANCE),s&&zn(this.pendingZoneSelection.zoneId),this.pendingZoneSelection=null}if(this.pendingTap&&this.currentEditMode==="dialogs"){if(Date.now()-this.pendingTap.startTime<this.TAP_MAX_DURATION){let s=!0;e&&e.worldX!==void 0&&(s=Math.abs(e.worldX-this.pendingTap.worldX)<this.TAP_MAX_DISTANCE),s&&this.showTempAddButton(this.pendingTap.worldX,this.pendingTap.worldY)}this.pendingTap=null}}handlePointerDown(e){if(cn()||this.currentEditMode!=="dialogs"||this.dragging)return;const t=e.downElement;if(t&&t.tagName?.toUpperCase()!=="CANVAS")return;const i=e.worldX;for(const l of this.currentZones)if(i>=l.x&&i<=l.x+l.width)return;const s=Date.now(),r=s-this.lastClickTime,a=Math.abs(i-this.lastClickX);if(r<this.DOUBLE_CLICK_THRESHOLD&&a<this.DOUBLE_CLICK_DISTANCE){this.createZoneAtPosition(i),this.lastClickTime=0,this.hideTempAddButton();return}this.lastClickTime=s,this.lastClickX=i,this.pendingTap={worldX:i,worldY:e.worldY,startTime:s},this.currentSelectedId&&zn(null)}showTempAddButton(e,t){const i=this.scene.cameras.main,{screenX:s,screenY:r}=qt(e,t,i);Ke.emit($e.TEMP_ZONE_BUTTON_SHOW,{screenX:s,screenY:r,worldX:e})}hideTempAddButton(){Ke.emit($e.TEMP_ZONE_BUTTON_HIDE,{})}createZoneAtPosition(e){this.createZoneAt(e)}createNewZone(){const e=this.scene.cameras.main,t=e.worldView.x+e.worldView.width/2;this.createZoneAt(t)}createZoneAt(e){let t=e-pr/2;const i=pr;if(t=Math.max(0,Math.min(this.worldWidth-i,t)),this.wouldOverlap("",t,i)){const r=this.findNonOverlappingPosition("",t,i);if(r===null){console.warn("No room for a new dialog zone");return}t=r}const s=El(t,i);s.x=t,pc(s),zn(s.id)}updateSelectionVisuals(){if(this.currentEditMode!=="dialogs"){hi(null);return}if(!this.currentSelectedId){hi(null);return}const e=this.currentZones.find(a=>a.id===this.currentSelectedId);if(!e){hi(null);return}const t=this.scene.cameras.main,i=e.x+e.width/2,{screenX:s}=qt(i,0,t),r=t.height*.65;hi({screenX:s,screenY:r})}destroy(){this.hideTempAddButton();for(const e of this.unsubscribers)e();this.unsubscribers=[],this.createZoneSubscription&&this.createZoneSubscription.unsubscribe(),this.createZoneAtSubscription&&this.createZoneAtSubscription.unsubscribe(),this.stopAutoScroll(),this.scene.input.off("pointerdown",this.handlePointerDown,this),this.scene.input.off("pointermove",this.handlePointerMove,this),this.scene.input.off("pointerup",this.handlePointerUp,this),window.removeEventListener("pointerup",this.boundWindowPointerUp),window.removeEventListener("pointermove",this.boundWindowPointerMove),this.clearVisuals(),this.graphics&&(this.graphics.destroy(),this.graphics=null),this.dragging=null}}class od extends N.Scene{parallaxLayers=null;cameraController;playerController;gridOverlay;itemsController;framesController;socialsController;dialogZoneRenderer;config;minimapSubscription;isShuttingDown=!1;get itemManager(){return this.itemsController?.getManager()}resetZoom(){this.cameraController?.resetToFit()}constructor(){super({key:mt.BUILDER})}init(e){this.config=e.config}preload(){this.load.spritesheet("cat-idle-white","assets/sprites/white/Idle.png",{frameWidth:48,frameHeight:48}),Ci.preloadAssets(this),fr.preloadAssets(this),gr.preloadAssets(this)}create(){this.isShuttingDown=!1,this.physics.world.setBounds(0,0,this.config.worldWidth,this.config.worldHeight);const e=this.config.worldHeight-Pn;this.cameraController=new Jc(this,this.config.worldWidth,this.config.worldHeight),this.playerController=new ed(this,this.config.worldWidth,this.config.worldHeight),this.gridOverlay=new td(this,this.config.worldWidth,this.config.worldHeight),this.itemsController=new id(this,e,this.config.worldWidth,this.config.worldHeight),this.framesController=new fr(this,this.config.worldWidth,this.config.worldHeight),this.socialsController=new gr(this,this.config.worldWidth,this.config.worldHeight),this.dialogZoneRenderer=new ad(this,this.config.worldWidth,this.config.worldHeight),this.createBackground(),this.gridOverlay.create(),this.createGroundReference(),this.playerController.create(this.config.playerStartX,this.config.playerStartY),this.itemsController.create(this.config.placedItems||[]),this.framesController.create(this.config.placedFrames||[]),this.socialsController.create(this.config.placedSocials||[]),this.dialogZoneRenderer.create(),this.cameraController.setup(),this.cameraController.centerOn(this.config.playerStartX,this.config.playerStartY),this.minimapSubscription=Ke.on($e.MINIMAP_NAVIGATE,t=>{this.navigateToPosition(t.worldX,t.worldY)}),this.scale.on("resize",this.handleResize,this),this.events.on("shutdown",this.shutdown,this)}async createBackground(){const e=ei.getCurrentConfig();try{await Ta(this,e)}catch(t){console.error("Failed to load background:",t);return}this.parallaxLayers&&(Zl(this.parallaxLayers),this.parallaxLayers=null),this.parallaxLayers=Da(this,this.config.worldWidth,this.config.worldHeight,e)}createGroundReference(){ri.createVisualGround(this,{worldWidth:this.config.worldWidth,worldHeight:this.config.worldHeight,height:Pn})}update(){this.parallaxLayers&&Aa(this.parallaxLayers.baseLayer,this.cameras.main),this.itemManager?.updateSelectionVisuals(),this.framesController?.updateSelectionVisuals(),this.socialsController?.updateSelectionVisuals(),this.dialogZoneRenderer?.updateSelectionVisuals();const e=this.cameras.main,t=this.data.get("playerSprite");gc({scrollX:e.worldView.x,scrollY:e.worldView.y,viewWidth:e.width,viewHeight:e.height,worldWidth:this.config.worldWidth,worldHeight:this.config.worldHeight,zoom:e.zoom,playerX:t?.x??this.config.playerStartX,playerY:t?.y??this.config.playerStartY})}navigateToPosition(e,t){this.cameraController.centerOn(e,t)}handleResize(e){if(!(!this.cameras?.main||!this.config)){if(this.cameraController?.handleResize(),this.parallaxLayers?.baseLayer){const t=Math.max(this.config.worldHeight,e.height);this.parallaxLayers.baseLayer.setSize(this.config.worldWidth,t)}this.gridOverlay&&this.gridOverlay.redraw()}}shutdown(){this.isShuttingDown||(this.isShuttingDown=!0,this.scale.off("resize",this.handleResize,this),this.minimapSubscription&&this.minimapSubscription.unsubscribe(),this.cameraController&&this.cameraController.destroy(),this.playerController&&this.playerController.destroy(),this.gridOverlay&&this.gridOverlay.destroy(),this.itemsController&&this.itemsController.destroy(),this.framesController&&this.framesController.destroy(),this.socialsController&&this.socialsController.destroy(),this.dialogZoneRenderer&&this.dialogZoneRenderer.destroy())}}const ld="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(ld);wo();class cd{currentLanguage="cs";setLanguage(e){this.currentLanguage=e,localStorage.setItem("language",e)}getLanguage(){const e=localStorage.getItem("language");return(e==="cs"||e==="en")&&(this.currentLanguage=e),this.currentLanguage}toggleLanguage(){return this.currentLanguage=this.currentLanguage==="cs"?"en":"cs",this.setLanguage(this.currentLanguage),this.currentLanguage}}const qa=new cd;let gt=null;function dd(n){gt=n}function ud(){if(!gt)return console.error("Scene manager not initialized"),null;try{return gt.scene.getScene(mt.GAME)?.mapConfig||null}catch(n){return console.error("Failed to get map config:",n),null}}function hd(n){if(!gt)return console.error("Scene manager not initialized"),!1;try{return gt.scene.getScene(mt.GAME)?(gt.scene.stop(mt.GAME),uc(n),gt.scene.start(mt.BUILDER,{config:n}),!0):(console.error("GameScene not found"),!1)}catch(e){return console.error("Failed to switch to builder:",e),!1}}function fd(){if(!gt)return console.error("Scene manager not initialized"),!1;try{return gt.scene.stop(mt.BUILDER),hc(),gt.scene.start(mt.GAME,{useBuilderConfig:!0}),!0}catch(n){return console.error("Failed to switch to game:",n),!1}}function gd(){if(!gt){console.error("Scene manager not initialized");return}try{gt.scene.start(mt.GAME)}catch(n){console.error("Failed to start game scene:",n)}}var pd=H('<button class="close-btn svelte-yrmttr" title="Close">Ã</button>'),md=H('<div class="resize-handle resize-handle-nw svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M9 9L1 1M5 1L1 1L1 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" fill="none"></path></svg></div>  <div class="resize-handle resize-handle-ne svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M1 9L9 1M5 1L9 1L9 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" fill="none"></path></svg></div>  <div class="resize-handle resize-handle-sw svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M9 1L1 9M1 5L1 9L5 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" fill="none"></path></svg></div>  <div class="resize-handle resize-handle-se svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M1 1L9 9M9 5L9 9L5 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" fill="none"></path></svg></div>',1),vd=H("<div><!></div> <!>",1),_d=H('<div data-ui=""><div class="panel-header svelte-yrmttr"><span class="panel-title svelte-yrmttr"> </span> <!> <div class="header-buttons svelte-yrmttr"><button class="minimize-btn svelte-yrmttr"> </button> <!></div></div> <!></div>');function Hn(n,e){Ie(e,!0);const t=()=>O(Kt,"$isDraggingInBuilder",i),[i,s]=We();let r=1e3,a=ce(e,"initialRight",3,10),l=ce(e,"initialTop",3,60),o=ce(e,"width",3,280),d=ce(e,"minWidth",3,200),u=ce(e,"minHeight",3,100),h=ce(e,"maxWidth",3,600),f=ce(e,"maxHeight",3,800),g=ce(e,"resizable",3,!1),v=ce(e,"startMinimized",3,!1),S=ce(e,"showClose",3,!1),_=K(ct(v())),p=K(!1),w=K(ct({x:0,y:0})),y=K(ct({width:o(),height:e.height??0})),b=K(!1),m=K(!1),I=K("se"),x=K(ct({x:0,y:0})),C=K(null),M=K(!1),T=K(ct(r)),A=K(null),D=K("");function L(){r++,$(T,r,!0)}function z(R,Y,se){let Pe=R;const Je=window.innerWidth-se-10;Pe>Je&&(Pe=Math.max(10,Je)),Pe<10&&(Pe=10);let He=Y;const yt=window.innerHeight-40;return He>yt&&(He=Math.max(10,yt)),He<10&&(He=10),{x:Pe,y:He}}Ze(()=>{if(typeof window>"u"||c(M))return;const R=localStorage.getItem(`panel-state-${e.panelId}`);if(R)try{const Y=JSON.parse(R),se=g()&&Y.width?Y.width:o(),he=z(Y.x,Y.y,se);$(w,he,!0),g()&&Y.width&&Y.height&&$(y,{width:Y.width,height:Y.height},!0);const ye=g()?{x:he.x,y:he.y,width:c(y).width,height:c(y).height}:{x:he.x,y:he.y};$(D,JSON.stringify(ye),!0)}catch{$(w,{x:window.innerWidth-o()-a(),y:l()},!0)}else $(w,{x:window.innerWidth-o()-a(),y:l()},!0);$(M,!0)}),Ze(()=>{if(!c(M))return;const R=g()?{x:c(w).x,y:c(w).y,width:c(y).width,height:c(y).height}:{x:c(w).x,y:c(w).y},Y=JSON.stringify(R);Y!==c(D)&&($(D,Y,!0),localStorage.setItem(`panel-state-${e.panelId}`,Y))}),Ze(()=>{if(!c(M))return;function R(){if(!c(C))return;const Y=g()?c(y).width:o();let se=c(w).x,he=c(w).y,ye=!1;const Pe=window.innerWidth-Y;c(w).x>Pe&&(se=Math.max(10,Pe),ye=!0);const Je=window.innerHeight-40;c(w).y>Je&&(he=Math.max(10,Je),ye=!0),c(w).x<0&&(se=10,ye=!0),c(w).y<0&&(he=10,ye=!0),ye&&$(w,{x:se,y:he},!0)}return window.addEventListener("resize",R),()=>{window.removeEventListener("resize",R)}});function Z(){$(_,!c(_))}function F(){e.onclose?.()}function q(){if(g())if(c(p))c(A)&&($(w,{x:c(A).x,y:c(A).y},!0),$(y,{width:c(A).width,height:c(A).height},!0),$(A,null)),$(p,!1);else{$(A,{x:c(w).x,y:c(w).y,width:c(y).width,height:c(y).height},!0);const R=20,Y=Math.min(h(),window.innerWidth-R*2),se=Math.min(f(),window.innerHeight-R*2),he=Math.max(R,(window.innerWidth-Y)/2),ye=Math.max(R,(window.innerHeight-se)/2);$(w,{x:he,y:ye},!0),$(y,{width:Y,height:se},!0),$(p,!0)}}function te(R){R.target.closest("button")||q()}function W(R){R.target.closest("button")||($(b,!0),$(x,{x:R.clientX-c(w).x,y:R.clientY-c(w).y},!0),R.currentTarget.setPointerCapture(R.pointerId),R.preventDefault())}function Q(R){if(!c(b))return;const Y=R.clientX-c(x).x,se=R.clientY-c(x).y,he=window.innerWidth-(c(C)?.offsetWidth??o()),ye=window.innerHeight-40;$(w,{x:Math.max(0,Math.min(Y,he)),y:Math.max(0,Math.min(se,ye))},!0)}function be(R){c(b)&&($(b,!1),R.currentTarget.releasePointerCapture(R.pointerId))}function me(R){return Y=>{g()&&($(m,!0),$(I,R,!0),Y.currentTarget.setPointerCapture(Y.pointerId),Y.preventDefault(),Y.stopPropagation())}}function we(R){if(!c(m)||!c(C))return;const Y=c(C).getBoundingClientRect();let se,he,ye=c(w).x,Pe=c(w).y;const Je=c(I)==="se"||c(I)==="ne",He=c(I)==="se"||c(I)==="sw";Je?se=R.clientX-Y.left:(se=Y.right-R.clientX,ye=R.clientX),He?he=R.clientY-Y.top:(he=Y.bottom-R.clientY,Pe=R.clientY);const yt=Math.max(d(),Math.min(h(),se)),j=Math.max(u(),Math.min(f(),he));Je||(ye=Y.right-yt,ye<0&&(ye=0)),He||(Pe=Y.bottom-j,Pe<0&&(Pe=0));const Ee=Je?window.innerWidth-c(w).x-10:Y.right-10,le=He?window.innerHeight-c(w).y-10:Y.bottom-10,Me=Math.min(yt,Ee),fe=Math.min(j,le);$(y,{width:Me,height:fe},!0);let Fe=!1,je=c(w).x,un=c(w).y;!Je&&se>=d()&&(je=Math.max(0,ye),Fe=!0),!He&&he>=u()&&(un=Math.max(0,Pe),Fe=!0),Fe&&$(w,{x:je,y:un},!0)}function Te(R){c(m)&&($(m,!1),R.currentTarget.releasePointerCapture(R.pointerId))}function Ve(R){R.stopPropagation()}var De=_d();let Be;De.__pointerdown=R=>{L(),Ve(R)},De.__click=Ve;var _e=P(De);_e.__pointerdown=W,_e.__pointermove=Q,_e.__pointerup=be,_e.__dblclick=te;var oe=P(_e),de=P(oe),ne=k(oe,2);{var ue=R=>{var Y=Oe(),se=ge(Y);An(se,()=>e.headerExtra),E(R,Y)};V(ne,R=>{e.headerExtra&&R(ue)})}var Se=k(ne,2),Re=P(Se);Re.__click=Z;var at=P(Re),nt=k(Re,2);{var Gt=R=>{var Y=pd();Y.__click=F,E(R,Y)};V(nt,R=>{S()&&R(Gt)})}var Fn=k(_e,2);{var Ht=R=>{var Y=vd(),se=ge(Y);let he;var ye=P(se);An(ye,()=>e.children);var Pe=k(se,2);{var Je=He=>{var yt=md(),j=ge(yt),Ee=X(()=>me("nw"));j.__pointerdown=function(...Ut){c(Ee)?.apply(this,Ut)},j.__pointermove=we,j.__pointerup=Te;var le=k(j,2),Me=X(()=>me("ne"));le.__pointerdown=function(...Ut){c(Me)?.apply(this,Ut)},le.__pointermove=we,le.__pointerup=Te;var fe=k(le,2),Fe=X(()=>me("sw"));fe.__pointerdown=function(...Ut){c(Fe)?.apply(this,Ut)},fe.__pointermove=we,fe.__pointerup=Te;var je=k(fe,2),un=X(()=>me("se"));je.__pointerdown=function(...Ut){c(un)?.apply(this,Ut)},je.__pointermove=we,je.__pointerup=Te,ut("pointercancel",j,Te),ut("pointercancel",le,Te),ut("pointercancel",fe,Te),ut("pointercancel",je,Te),E(He,yt)};V(Pe,He=>{g()&&He(Je)})}G(()=>he=ke(se,1,"panel-body svelte-yrmttr",null,he,{"has-fixed-height":g()&&c(y).height>0})),E(R,Y)};V(Fn,R=>{c(_)||R(Ht)})}ln(De,R=>$(C,R),()=>c(C)),G(()=>{Be=ke(De,1,"draggable-panel svelte-yrmttr",null,Be,{minimized:c(_),maximized:c(p),dragging:c(b),resizing:c(m),resizable:g()}),xe(De,`left: ${c(w).x??""}px; top: ${c(w).y??""}px; width: ${c(_)?"auto":`${g()?c(y).width:o()}px`}; ${g()&&c(y).height>0&&!c(_)?`height: ${c(y).height}px;`:""}${t()?" pointer-events: none;":""} z-index: ${c(T)??""};`),Ae(de,e.title),U(Re,"title",c(_)?"Expand":"Minimize"),Ae(at,c(_)?"â²":"â¼")}),ut("pointercancel",_e,be),E(n,De),Ce(),s()}_t(["pointerdown","click","pointermove","pointerup","dblclick"]);const wr=10,yd=150,bd=`
  position: fixed;
  pointer-events: none;
  z-index: 10000;
  opacity: 0.9;
  image-rendering: pixelated;
  filter: drop-shadow(3px 3px 0 rgba(0, 0, 0, 0.5));
  background: rgba(26, 26, 46, 0.9);
`,wd=`
  width: 100%;
  height: 100%;
  object-fit: contain;
  image-rendering: pixelated;
`;function Fs(n,e,t){const{previewSize:i,borderColor:s,dataKey:r,eventName:a,onDrop:l}=n,o=i/2,d={startX:0,startY:0,hasMoved:!1,isActivated:!1,pendingKey:null,pendingTarget:null,longPressTimer:null};function u(T,A,D){Ke.emit(a,{[r]:T,canvasX:A,canvasY:D}),l?.()}function h(T,A){const D=document.querySelector("canvas");if(!D)return null;const L=D.getBoundingClientRect();return T>=L.left&&T<=L.right&&A>=L.top&&A<=L.bottom?{canvasX:T-L.left,canvasY:A-L.top}:null}function f(T,A,D){const L=document.createElement("div");return L.className="touch-drag-preview",L.innerHTML=`<img src="${T}" alt="" />`,L.style.cssText=`
      ${bd}
      top: ${D-o}px;
      left: ${A-o}px;
      width: ${i}px;
      height: ${i}px;
      border: 2px solid ${s};
    `,L.querySelector("img").style.cssText=wd,document.body.appendChild(L),L}function g(T,A,D){T.style.top=`${D-o}px`,T.style.left=`${A-o}px`}function v(){d.longPressTimer&&(clearTimeout(d.longPressTimer),d.longPressTimer=null),d.pendingKey=null,d.pendingTarget=null,d.isActivated=!1,d.hasMoved=!1}function S(){v();const T=e();T.touchDragElement&&(T.touchDragElement.remove(),t({touchDragElement:null})),t({draggedKey:null}),ui(!1)}function _(T,A){if(!T.dataTransfer)return;t({draggedKey:A}),ui(!0),T.dataTransfer.effectAllowed="copy",T.dataTransfer.setData(r,A);const L=T.target.querySelector("img")?.cloneNode(!0);L&&(L.style.cssText="position: absolute; top: -1000px;",document.body.appendChild(L),T.dataTransfer.setDragImage(L,o,o),requestAnimationFrame(()=>L.remove()))}function p(){t({draggedKey:null}),ui(!1)}function w(T){T.preventDefault(),T.dataTransfer&&(T.dataTransfer.dropEffect="copy")}function y(T){T.preventDefault();const A=T.dataTransfer?.getData(r);if(!A)return;const D=h(T.clientX,T.clientY);D&&u(A,D.canvasX,D.canvasY)}function b(T,A){if(!d.pendingKey||!d.pendingTarget||d.isActivated)return;d.isActivated=!0,t({draggedKey:d.pendingKey}),ui(!0);const D=d.pendingTarget.querySelector("img");if(D){const L=f(D.src,T,A);t({touchDragElement:L})}}function m(T,A){if(T.touches.length!==1)return;const D=T.touches[0];d.startX=D.clientX,d.startY=D.clientY,d.hasMoved=!1,d.isActivated=!1,d.pendingKey=A,d.pendingTarget=T.currentTarget,d.longPressTimer=setTimeout(()=>{d.pendingKey&&!d.hasMoved&&b(D.clientX,D.clientY)},yd)}function I(T){const A=T.touches[0],D=A.clientX-d.startX,L=A.clientY-d.startY;if(!d.hasMoved&&(Math.abs(D)>wr||Math.abs(L)>wr)&&(d.hasMoved=!0,!d.isActivated)){if(Math.abs(L)>Math.abs(D)){v();return}b(A.clientX,A.clientY)}const z=e();d.isActivated&&z.touchDragElement&&(g(z.touchDragElement,A.clientX,A.clientY),T.preventDefault())}function x(T){const A=e(),D=d.isActivated,L=A.draggedKey;if(D&&L&&d.hasMoved){const z=T.changedTouches[0],Z=h(z.clientX,z.clientY);Z&&u(L,Z.canvasX,Z.canvasY)}S()}function C(){const T=document.querySelector("canvas");return T?(T.addEventListener("dragover",w),T.addEventListener("drop",y),()=>{T.removeEventListener("dragover",w),T.removeEventListener("drop",y)}):()=>{}}function M(){return document.addEventListener("touchmove",I,{passive:!1}),document.addEventListener("touchend",x),document.addEventListener("touchcancel",x),()=>{document.removeEventListener("touchmove",I),document.removeEventListener("touchend",x),document.removeEventListener("touchcancel",x)}}return{onDragStart:_,onDragEnd:p,onTouchStart:m,setupCanvasListeners:C,setupTouchListeners:M}}var Sd=H('<span class="palette-hint svelte-1ahretz">Drag to place</span>'),Ed=H('<div data-ui="" draggable="true" role="button" tabindex="0"><img class="item-preview svelte-1ahretz"/></div>'),xd=H('<div class="palette-content svelte-1ahretz" role="toolbar" tabindex="-1"><div class="palette-grid svelte-1ahretz"></div></div>');function Id(n,e){Ie(e,!0);const t=()=>O(nn,"$isAssetPaletteOpen",s),i=()=>O(Ue,"$builderEditMode",s),[s,r]=We(),a="#4a90e2",l=600,o=Rs;function d(){return window.innerWidth<l}function u(){d()&&nn.set(!1)}let h=K(null),f=K(null);const g=Fs({previewSize:48,borderColor:a,dataKey:"assetKey",eventName:$e.ASSET_DROPPED,onDrop:u},()=>({draggedKey:c(h),touchDragElement:c(f)}),b=>{"draggedKey"in b&&$(h,b.draggedKey??null,!0),"touchDragElement"in b&&$(f,b.touchDragElement??null,!0)});function v(b){b.stopPropagation()}function S(){nn.set(!1)}function _(b){const m=document.querySelector("canvas");if(!m)return;const I=m.getBoundingClientRect(),x=I.width/2,C=I.height/2;Ke.emit($e.ASSET_DROPPED,{assetKey:b,canvasX:x,canvasY:C}),u()}ci(()=>g.setupCanvasListeners()),Ze(()=>g.setupTouchListeners());var p=Oe(),w=ge(p);{var y=b=>{Hn(b,{panelId:"asset-palette",title:"Assets",initialRight:10,initialTop:60,width:280,height:400,minWidth:200,minHeight:160,maxWidth:500,maxHeight:600,resizable:!0,showClose:!0,onclose:S,headerExtra:I=>{var x=Sd();E(I,x)},children:(I,x)=>{var C=xd();C.__pointerdown=v;var M=P(C);st(M,21,()=>o,ht,(T,A)=>{var D=Ed();let L;D.__touchstart=Z=>g.onTouchStart(Z,c(A).key),D.__dblclick=()=>_(c(A).key),xe(D,"",{},{"--accent-color":a});var z=P(D);G(()=>{L=ke(D,1,"palette-item svelte-1ahretz",null,L,{dragging:c(h)===c(A).key}),U(D,"title",`${c(A).name??""} (double-click to place)`),U(z,"src",c(A).path),U(z,"alt",c(A).name)}),ut("dragstart",D,Z=>g.onDragStart(Z,c(A).key)),ut("dragend",D,function(...Z){g.onDragEnd?.apply(this,Z)}),E(T,D)}),E(I,C)},$$slots:{headerExtra:!0,default:!0}})};V(w,b=>{t()&&i()==="items"&&b(y)})}E(n,p),Ce(),r()}_t(["pointerdown","touchstart","dblclick"]);var Cd=H('<span class="palette-hint svelte-jnw59q">Drag to place</span>'),Td=H('<div data-ui="" draggable="true" role="button" tabindex="0"><img class="item-preview svelte-jnw59q"/></div>'),Dd=H('<div class="palette-content svelte-jnw59q" role="toolbar" tabindex="-1"><div class="palette-grid svelte-jnw59q"></div></div>');function Ad(n,e){Ie(e,!0);const t=()=>O(Jt,"$isFramePaletteOpen",s),i=()=>O(Ue,"$builderEditMode",s),[s,r]=We(),a="#9b59b6",l=Ti;let o=K(null),d=K(null);const u=Fs({previewSize:64,borderColor:a,dataKey:"frameKey",eventName:$e.FRAME_DROPPED,onDrop:()=>{Jt.set(!1)}},()=>({draggedKey:c(o),touchDragElement:c(d)}),p=>{"draggedKey"in p&&$(o,p.draggedKey??null,!0),"touchDragElement"in p&&$(d,p.touchDragElement??null,!0)});function h(p){p.stopPropagation()}function f(){Jt.set(!1)}function g(p){const w=document.querySelector("canvas");if(!w)return;const y=w.getBoundingClientRect(),b=y.width/2,m=y.height/2;Ke.emit($e.FRAME_DROPPED,{frameKey:p,canvasX:b,canvasY:m}),Jt.set(!1)}ci(()=>u.setupCanvasListeners()),Ze(()=>u.setupTouchListeners());var v=Oe(),S=ge(v);{var _=p=>{Hn(p,{panelId:"frame-palette",title:"Frames",initialRight:10,initialTop:60,width:320,height:400,minWidth:220,minHeight:200,maxWidth:600,maxHeight:600,resizable:!0,showClose:!0,onclose:f,headerExtra:y=>{var b=Cd();E(y,b)},children:(y,b)=>{var m=Dd();m.__pointerdown=h;var I=P(m);st(I,21,()=>l,ht,(x,C)=>{var M=Td();let T;M.__touchstart=D=>u.onTouchStart(D,c(C).key),M.__dblclick=()=>g(c(C).key),xe(M,"",{},{"--accent-color":a});var A=P(M);G(()=>{T=ke(M,1,"palette-item svelte-jnw59q",null,T,{dragging:c(o)===c(C).key}),U(M,"title",`${c(C).name??""} (double-click to place)`),U(A,"src",c(C).path),U(A,"alt",c(C).name)}),ut("dragstart",M,D=>u.onDragStart(D,c(C).key)),ut("dragend",M,function(...D){u.onDragEnd?.apply(this,D)}),E(x,M)}),E(y,m)},$$slots:{headerExtra:!0,default:!0}})};V(S,p=>{t()&&i()==="frames"&&p(_)})}E(n,v),Ce(),r()}_t(["pointerdown","touchstart","dblclick"]);var kd=H('<span class="palette-hint svelte-whpd9j">Drag to place</span>'),Pd=H('<div data-ui="" draggable="true" role="button" tabindex="0"><img class="item-preview svelte-whpd9j"/> <span class="item-name svelte-whpd9j"> </span></div>'),Md=H('<div class="palette-content svelte-whpd9j" role="toolbar" tabindex="-1"><div class="palette-grid svelte-whpd9j"></div></div>');function $d(n,e){Ie(e,!0);const t=()=>O(Qt,"$isSocialPaletteOpen",s),i=()=>O(Ue,"$builderEditMode",s),[s,r]=We(),a=Rn.SOCIAL.css,l=Di;let o=K(null),d=K(null);const u=Fs({previewSize:64,borderColor:a,dataKey:"socialKey",eventName:$e.SOCIAL_DROPPED,onDrop:()=>{Qt.set(!1)}},()=>({draggedKey:c(o),touchDragElement:c(d)}),p=>{"draggedKey"in p&&$(o,p.draggedKey??null,!0),"touchDragElement"in p&&$(d,p.touchDragElement??null,!0)});function h(p){p.stopPropagation()}function f(){Qt.set(!1)}function g(p){const w=document.querySelector("canvas");if(!w)return;const y=w.getBoundingClientRect(),b=y.width/2,m=y.height/2;Ke.emit($e.SOCIAL_DROPPED,{socialKey:p,canvasX:b,canvasY:m}),Qt.set(!1)}ci(()=>u.setupCanvasListeners()),Ze(()=>u.setupTouchListeners());var v=Oe(),S=ge(v);{var _=p=>{Hn(p,{panelId:"social-palette",title:"Socials",initialRight:10,initialTop:60,width:280,height:350,minWidth:200,minHeight:200,maxWidth:500,maxHeight:500,resizable:!0,showClose:!0,onclose:f,headerExtra:y=>{var b=kd();E(y,b)},children:(y,b)=>{var m=Md();m.__pointerdown=h;var I=P(m);st(I,21,()=>l,ht,(x,C)=>{var M=Pd();let T;M.__touchstart=Z=>u.onTouchStart(Z,c(C).key),M.__dblclick=()=>g(c(C).key);let A;var D=P(M),L=k(D,2),z=P(L);G(()=>{T=ke(M,1,"palette-item svelte-whpd9j",null,T,{dragging:c(o)===c(C).key}),U(M,"title",`${c(C).name??""} (double-click to place)`),A=xe(M,"",A,{"--accent-color":a}),U(D,"src",c(C).path),U(D,"alt",c(C).name),Ae(z,c(C).name)}),ut("dragstart",M,Z=>u.onDragStart(Z,c(C).key)),ut("dragend",M,function(...Z){u.onDragEnd?.apply(this,Z)}),E(x,M)}),E(y,m)},$$slots:{headerExtra:!0,default:!0}})};V(S,p=>{t()&&i()==="socials"&&p(_)})}E(n,v),Ce(),r()}_t(["pointerdown","touchstart","dblclick"]);var Od=H("<button><!></button>");function ae(n,e){let t=ce(e,"variant",3,"default"),i=ce(e,"disabled",3,!1),s=ce(e,"title",3,"");const r={default:{base:"#4a90e2",hover:"#357abd",active:"#2a5f8f"},green:{base:"#27ae60",hover:"#229954",active:"#1e8449"},blue:{base:"#3498db",hover:"#2980b9",active:"#21618c"},orange:{base:"#ffa500",hover:"#ff8c00",active:"#e67e00"},red:{base:"#e74c3c",hover:"#c0392b",active:"#a02e22"},purple:{base:"#9b59b6",hover:"#8e44ad",active:"#7d3c98"},cyan:{base:"#17a2b8",hover:"#138496",active:"#0f6674"},pink:{base:"#e91e8f",hover:"#c9177a",active:"#a31265"}},a=X(()=>r[t()]),l=X(()=>e.width?`--btn-width: ${e.width};`:"");var o=Od();let d;o.__click=function(...h){e.onclick?.apply(this,h)};var u=P(o);An(u,()=>e.children??pt),G(()=>{d=ke(o,1,"pixel-btn svelte-lwc0vq",null,d,{disabled:i()}),xe(o,`${c(l)??""} --color-base: ${c(a).base??""}; --color-hover: ${c(a).hover??""}; --color-active: ${c(a).active??""}`),o.disabled=i(),U(o,"title",s())}),E(n,o)}_t(["click"]);var Ld=H("<button> </button>"),Rd=H('<div class="language-tabs svelte-ng6pis"></div>');function Ja(n,e){Ie(e,!0);let t=ce(e,"accentColor",3,"#88ddff");var i=Rd();st(i,21,()=>Yl,ht,(s,r)=>{var a=Ld();let l;a.__click=()=>e.onselect(c(r).code);let o;var d=P(a);G(()=>{l=ke(a,1,"lang-tab svelte-ng6pis",null,l,{active:e.selectedLanguage===c(r).code}),o=xe(a,"",o,{"--accent-color":t()}),Ae(d,c(r).label)}),E(s,a)}),E(n,i),Ce()}_t(["click"]);var Hd=H("<button></button>"),Fd=H('<div class="color-picker svelte-1jc3e0j"></div>'),Xd=H('<div class="color-section svelte-1jc3e0j"><span class="color-label-title svelte-1jc3e0j"> </span> <button class="color-button svelte-1jc3e0j" title="Change color"><span class="color-preview svelte-1jc3e0j"></span> <span class="color-label svelte-1jc3e0j">Change</span></button> <!></div>');function us(n,e){Ie(e,!0);let t=ce(e,"label",3,"Color"),i=ce(e,"accentColor",3,"#88ddff"),s=K(!1),r=K(null);Ze(()=>{c(s)&&c(r)&&requestAnimationFrame(()=>{c(r)?.scrollIntoView({behavior:"smooth",block:"nearest"})})});function a(p){e.onselect(p)}function l(){$(s,!c(s))}var o=Xd(),d=P(o),u=P(d),h=k(d,2);h.__click=l;let f;var g=P(h);let v;var S=k(h,2);{var _=p=>{var w=Fd();st(w,21,()=>e.colors,ht,(y,b)=>{var m=Hd();let I;m.__click=()=>a(c(b));let x;G(()=>{I=ke(m,1,"color-swatch svelte-1jc3e0j",null,I,{selected:e.selectedColor===c(b)}),U(m,"title",c(b)),x=xe(m,"",x,{background:c(b),"--accent-color":i()})}),E(y,m)}),ln(w,y=>$(r,y),()=>c(r)),E(p,w)};V(S,p=>{c(s)&&p(_)})}G(()=>{Ae(u,t()),f=xe(h,"",f,{"--accent-color":i()}),v=xe(g,"",v,{background:e.selectedColor})}),E(n,o),Ce()}_t(["click"]);const Sr=50,Er=400,Nd=400,Zd=70;var Yd=H('<div class="form-section svelte-jhtkop"><div class="form-group svelte-jhtkop"><label class="svelte-jhtkop"> </label> <input type="text" class="svelte-jhtkop"/></div> <div class="form-group svelte-jhtkop"><label class="svelte-jhtkop"> </label> <textarea rows="6" class="svelte-jhtkop"></textarea></div></div>');function Wd(n,e){Ie(e,!0);let t=ce(e,"titlePlaceholder",3,"Enter title..."),i=ce(e,"contentPlaceholder",3,"Enter text..."),s=ce(e,"idPrefix",3,"text-form"),r=ce(e,"accentColor",3,"#88ddff");function a(w){const y=w.target;e.ontitlechange(y.value)}function l(w){const y=w.target;e.oncontentchange(y.value)}var o=Yd();let d;var u=P(o),h=P(u),f=P(h),g=k(h,2);g.__input=a;var v=k(u,2),S=P(v),_=P(S),p=k(S,2);p.__input=l,G(()=>{d=xe(o,"",d,{"--accent-color":r()}),U(h,"for",`${s()??""}-title`),Ae(f,`Title (max ${Sr} chars)`),U(g,"id",`${s()??""}-title`),qn(g,e.title),U(g,"placeholder",t()),U(g,"maxlength",Sr),U(S,"for",`${s()??""}-content`),Ae(_,`Content (max ${Er} chars)`),U(p,"id",`${s()??""}-content`),qn(p,e.content),U(p,"placeholder",i()),U(p,"maxlength",Er)}),E(n,o),Ce()}_t(["input"]);var Bd=H('<div class="panel-content svelte-zzlycq"><!> <!> <div class="panel-extras svelte-zzlycq"><!></div> <div class="panel-footer svelte-zzlycq"><!> <!></div></div>');function zd(n,e){Ie(e,!0);const t=()=>O(Ts,"$dialogZones",r),i=()=>O(Fi,"$selectedDialogZoneId",r),s=()=>O(As,"$isDialogZonePanelOpen",r),[r,a]=We(),l="#88ddff";let o=K(ct(ka)),d=X(()=>t().find(b=>b.id===i())??null),u=X(()=>c(d)?.texts.find(b=>b.language===c(o))??null);function h(b){i()&&sr(i(),c(o),{title:b})}function f(b){i()&&sr(i(),c(o),{content:b})}function g(){i()&&(Wa(i()),nr())}function v(){nr()}function S(b){i()&&mn(i(),{color:b})}function _(b){$(o,b,!0)}var p=Oe(),w=ge(p);{var y=b=>{Hn(b,{panelId:"dialog-zone-panel",title:"Dialog Zone",initialRight:10,initialTop:160,width:280,height:450,minWidth:250,minHeight:370,maxWidth:500,maxHeight:700,resizable:!0,showClose:!0,onclose:v,children:(m,I)=>{var x=Bd(),C=P(x);Ja(C,{get selectedLanguage(){return c(o)},onselect:_,accentColor:l});var M=k(C,2);{let Z=X(()=>c(u)?.title??""),F=X(()=>c(u)?.content??"");Wd(M,{get title(){return c(Z)},get content(){return c(F)},ontitlechange:h,oncontentchange:f,titlePlaceholder:"Enter title...",contentPlaceholder:"Enter dialog text...",idPrefix:"dialog",accentColor:l})}var T=k(M,2),A=P(T);us(A,{get colors(){return os},get selectedColor(){return c(d).color},onselect:S,label:"Zone Color",accentColor:l});var D=k(T,2),L=P(D);ae(L,{variant:"cyan",onclick:v,children:(Z,F)=>{var q=re("CONFIRM");E(Z,q)},$$slots:{default:!0}});var z=k(L,2);ae(z,{variant:"red",onclick:g,children:(Z,F)=>{var q=re("DELETE");E(Z,q)},$$slots:{default:!0}}),E(m,x)},$$slots:{default:!0}})};V(w,b=>{c(d)&&s()&&b(y)})}E(n,p),Ce(),a()}var Kd=H("<button> </button>"),Gd=H("<option> </option>"),Ud=H("<button> </button>"),Vd=H('<a target="_blank" rel="noopener noreferrer" class="url-preview svelte-ds1z4d">Test link â</a>'),jd=H('<button><img class="svelte-ds1z4d"/></button>'),qd=H('<div class="style-picker svelte-ds1z4d"></div>'),Jd=H('<div class="panel-content svelte-ds1z4d"><!> <div class="frame-size-row svelte-ds1z4d"><div class="frame-size-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Frame Size</span> <div class="size-buttons svelte-ds1z4d"></div></div> <div class="rotate-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Rotate</span> <button class="rotate-btn svelte-ds1z4d"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-ds1z4d"><path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg></button></div></div> <div class="panel-extras svelte-ds1z4d"><div class="text-section svelte-ds1z4d"><label for="frame-text" class="svelte-ds1z4d">Text</label> <textarea id="frame-text" placeholder="Enter text..." rows="3" class="svelte-ds1z4d"></textarea></div> <div class="size-rotation-row svelte-ds1z4d"><div class="size-section svelte-ds1z4d"><label for="text-size" class="svelte-ds1z4d">Text Size</label> <select id="text-size" class="svelte-ds1z4d"></select></div></div> <div class="text-align-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Text Alignment</span> <div class="align-buttons svelte-ds1z4d"></div></div> <div class="url-section svelte-ds1z4d"><label for="frame-url" class="svelte-ds1z4d">Link URL (opens on click)</label> <input id="frame-url" type="url" placeholder="https://example.com" class="svelte-ds1z4d"/> <!></div> <!> <!> <div class="style-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Frame Style</span> <button class="style-button svelte-ds1z4d" title="Change frame style"><img alt="Current frame" class="style-preview svelte-ds1z4d"/> <span class="style-label svelte-ds1z4d">Change Style</span></button> <!></div></div> <div class="panel-footer svelte-ds1z4d"><!> <!></div></div>');function Qd(n,e){Ie(e,!0);const t=()=>O(Cs,"$builderPreviewLanguage",a),i=()=>O(nc,"$selectedFrame",a),s=()=>O(ti,"$selectedFrameId",a),r=()=>O(Li,"$isFramePanelOpen",a),[a,l]=We(),o="#9b59b6";let d=X(t),u=X(i),h=X(()=>c(u)?.texts.find(F=>F.language===c(d))??null),f=X(()=>c(u)?Zc(c(u).scale??4):"M");function g(F){const q=F.target;if(!s()||!c(u))return;const te=c(u).texts.map(W=>W.language===c(d)?{...W,text:q.value}:W);te.some(W=>W.language===c(d))||te.push({language:c(d),text:q.value}),St(s(),{texts:te})}function v(F){const q=F.target;s()&&St(s(),{url:q.value||void 0})}function S(F){s()&&St(s(),{backgroundColor:F})}function _(F){s()&&St(s(),{textColor:F})}function p(F){const q=F.target;s()&&St(s(),{textSize:parseInt(q.value,10)})}function w(F){s()&&St(s(),{scale:Nc(F)})}function y(F){s()&&St(s(),{textAlign:F})}function b(){if(!s()||!c(u))return;const q=(c(u).rotation??0)===0?90:0;St(s(),{rotation:q})}function m(){s()&&Os(s())}function I(){Ul(),Kn(null)}function x(F){ql(F)}let C=K(!1),M=K(null),T=K(null);function A(F){s()&&St(s(),{frameKey:F})}function D(){$(C,!c(C))}Ze(()=>{c(C)&&c(M)&&requestAnimationFrame(()=>{c(M)?.scrollIntoView({behavior:"smooth",block:"nearest"})})}),Ze(()=>{if(!c(C))return;function F(q){const te=q.target;c(M)&&!c(M).contains(te)&&c(T)&&!c(T).contains(te)&&$(C,!1)}return document.addEventListener("click",F),()=>document.removeEventListener("click",F)});var L=Oe(),z=ge(L);{var Z=F=>{Hn(F,{panelId:"frame-panel",title:"Edit Frame",initialRight:10,initialTop:160,width:280,height:520,minWidth:250,minHeight:450,maxWidth:500,maxHeight:700,resizable:!0,showClose:!0,onclose:I,children:(q,te)=>{var W=Jd(),Q=P(W);Ja(Q,{get selectedLanguage(){return c(d)},onselect:x,accentColor:o});var be=k(Q,2),me=P(be),we=k(P(me),2);st(we,21,()=>Object.entries(Ua),ht,(j,Ee)=>{var le=X(()=>Dr(c(Ee),2));let Me=()=>c(le)[0],fe=()=>c(le)[1].label;var Fe=Kd();let je;Fe.__click=()=>w(Me());var un=P(Fe);G(()=>{je=ke(Fe,1,"size-btn svelte-ds1z4d",null,je,{active:c(f)===Me()}),U(Fe,"title",fe()),Ae(un,Me())}),E(j,Fe)});var Te=k(me,2),Ve=k(P(Te),2);Ve.__click=b;var De=k(be,2),Be=P(De),_e=k(P(Be),2);_e.__input=g;var oe=k(Be,2),de=P(oe),ne=k(P(de),2);ne.__change=p,st(ne,21,()=>Fc,ht,(j,Ee)=>{var le=Gd(),Me=P(le),fe={};G(()=>{Ae(Me,`${c(Ee)??""}px`),fe!==(fe=c(Ee))&&(le.value=(le.__value=c(Ee))??"")}),E(j,le)});var ue;gl(ne);var Se=k(oe,2),Re=k(P(Se),2);st(Re,21,()=>Xc,ht,(j,Ee)=>{let le=()=>c(Ee).value,Me=()=>c(Ee).label;var fe=Ud();let Fe;fe.__click=()=>y(le());var je=P(fe);G(()=>{Fe=ke(fe,1,"align-btn svelte-ds1z4d",null,Fe,{active:(c(u).textAlign??ja)===le()}),U(fe,"title",Me()),Ae(je,Me())}),E(j,fe)});var at=k(Se,2),nt=k(P(at),2);nt.__input=v;var Gt=k(nt,2);{var Fn=j=>{var Ee=Vd();G(()=>U(Ee,"href",c(u).url)),E(j,Ee)};V(Gt,j=>{c(u).url&&j(Fn)})}var Ht=k(at,2);{let j=X(()=>c(u).textColor??Va);us(Ht,{get colors(){return Hc},get selectedColor(){return c(j)},onselect:_,label:"Text Color",accentColor:o})}var R=k(Ht,2);us(R,{get colors(){return Rc},get selectedColor(){return c(u).backgroundColor},onselect:S,label:"Background Color",accentColor:o});var Y=k(R,2),se=k(P(Y),2);se.__click=D;var he=P(se);ln(se,j=>$(T,j),()=>c(T));var ye=k(se,2);{var Pe=j=>{var Ee=qd();st(Ee,21,()=>Ti,ht,(le,Me)=>{var fe=jd();let Fe;fe.__click=()=>A(c(Me).key);var je=P(fe);G(()=>{Fe=ke(fe,1,"style-item svelte-ds1z4d",null,Fe,{selected:c(u).frameKey===c(Me).key}),U(fe,"title",c(Me).name),U(je,"src",c(Me).path),U(je,"alt",c(Me).name)}),E(le,fe)}),ln(Ee,le=>$(M,le),()=>c(M)),E(j,Ee)};V(ye,j=>{c(C)&&j(Pe)})}var Je=k(De,2),He=P(Je);ae(He,{variant:"purple",onclick:I,children:(j,Ee)=>{var le=re("CONFIRM");E(j,le)},$$slots:{default:!0}});var yt=k(He,2);ae(yt,{variant:"red",onclick:m,children:(j,Ee)=>{var le=re("DELETE");E(j,le)},$$slots:{default:!0}}),G(j=>{U(Ve,"title",c(u).rotation===90?"Portrait (click to rotate)":"Landscape (click to rotate)"),qn(_e,c(h)?.text??""),ue!==(ue=c(u).textSize??mi)&&(ne.value=(ne.__value=c(u).textSize??mi)??"",ga(ne,c(u).textSize??mi)),qn(nt,c(u).url??""),U(he,"src",j)},[()=>Ti.find(j=>j.key===c(u).frameKey)?.path??""]),E(q,W)},$$slots:{default:!0}})};V(z,F=>{r()&&c(u)&&F(Z)})}E(n,L),Ce(),l()}_t(["click","input","change"]);var eu=H("<button> </button>"),tu=H('<a target="_blank" rel="noopener noreferrer" class="url-preview svelte-1v3ae2c">Test link â</a>'),nu=H('<button><img class="svelte-1v3ae2c"/></button>'),iu=H('<div class="style-picker svelte-1v3ae2c"></div>'),su=H('<div class="panel-content svelte-1v3ae2c"><div class="social-size-row svelte-1v3ae2c"><div class="social-size-section svelte-1v3ae2c"><span class="section-label svelte-1v3ae2c">Size</span> <div class="size-buttons svelte-1v3ae2c"></div></div></div> <div class="panel-extras svelte-1v3ae2c"><div class="url-section svelte-1v3ae2c"><label for="social-url" class="svelte-1v3ae2c">Link URL (opens on click)</label> <input id="social-url" type="url" placeholder="https://example.com" class="svelte-1v3ae2c"/> <!></div> <div class="style-section svelte-1v3ae2c"><span class="section-label svelte-1v3ae2c">Social Icon</span> <button class="style-button svelte-1v3ae2c" title="Change social icon"><img alt="Current social" class="style-preview svelte-1v3ae2c"/> <span class="style-label svelte-1v3ae2c"> </span></button> <!></div></div> <div class="panel-footer svelte-1v3ae2c"><!> <!></div></div>');function ru(n,e){Ie(e,!0);const t=()=>O(Ql,"$selectedSocial",r),i=()=>O(ni,"$selectedSocialId",r),s=()=>O(Ri,"$isSocialPanelOpen",r),[r,a]=We(),l=Rn.SOCIAL.css;let o=X(t),d=X(()=>c(o)?Vc(c(o).scale??xn):"M"),u=X(()=>c(o)?Di.find(x=>x.key===c(o).socialKey):null);function h(x){const C=x.target;i()&&pi(i(),{url:C.value||void 0})}function f(x){i()&&pi(i(),{scale:Uc(x)})}function g(){i()&&Ls(i())}function v(){jl(),Gn(null)}let S=K(!1),_=K(null),p=K(null);function w(x){i()&&pi(i(),{socialKey:x})}function y(){$(S,!c(S))}Ze(()=>{c(S)&&c(_)&&requestAnimationFrame(()=>{c(_)?.scrollIntoView({behavior:"smooth",block:"nearest"})})}),Ze(()=>{if(!c(S))return;function x(C){const M=C.target;c(_)&&!c(_).contains(M)&&c(p)&&!c(p).contains(M)&&$(S,!1)}return document.addEventListener("click",x),()=>document.removeEventListener("click",x)});var b=Oe(),m=ge(b);{var I=x=>{Hn(x,{panelId:"social-panel",title:"Edit Social",initialRight:10,initialTop:160,width:280,height:350,minWidth:250,minHeight:300,maxWidth:400,maxHeight:500,resizable:!0,showClose:!0,onclose:v,children:(C,M)=>{var T=su(),A=P(T),D=P(A),L=k(P(D),2);st(L,21,()=>Object.entries(si),ht,(oe,de)=>{var ne=X(()=>Dr(c(de),2));let ue=()=>c(ne)[0],Se=()=>c(ne)[1].label;var Re=eu();let at;Re.__click=()=>f(ue());var nt=P(Re);G(()=>{at=ke(Re,1,"size-btn svelte-1v3ae2c",null,at,{active:c(d)===ue()}),U(Re,"title",Se()),Ae(nt,ue())}),E(oe,Re)});var z=k(A,2),Z=P(z),F=k(P(Z),2);F.__input=h;var q=k(F,2);{var te=oe=>{var de=tu();G(()=>U(de,"href",c(o).url)),E(oe,de)};V(q,oe=>{c(o).url&&oe(te)})}var W=k(Z,2),Q=k(P(W),2);Q.__click=y;var be=P(Q),me=k(be,2),we=P(me);ln(Q,oe=>$(p,oe),()=>c(p));var Te=k(Q,2);{var Ve=oe=>{var de=iu();st(de,21,()=>Di,ht,(ne,ue)=>{var Se=nu();let Re;Se.__click=()=>w(c(ue).key);var at=P(Se);G(()=>{Re=ke(Se,1,"style-item svelte-1v3ae2c",null,Re,{selected:c(o).socialKey===c(ue).key}),U(Se,"title",c(ue).name),U(at,"src",c(ue).path),U(at,"alt",c(ue).name)}),E(ne,Se)}),ln(de,ne=>$(_,ne),()=>c(_)),E(oe,de)};V(Te,oe=>{c(S)&&oe(Ve)})}var De=k(z,2),Be=P(De);ae(Be,{variant:"pink",onclick:v,children:(oe,de)=>{var ne=re("CONFIRM");E(oe,ne)},$$slots:{default:!0}});var _e=k(Be,2);ae(_e,{variant:"red",onclick:g,children:(oe,de)=>{var ne=re("DELETE");E(oe,ne)},$$slots:{default:!0}}),G(()=>{xe(T,`--accent-color: ${l}`),qn(F,c(o).url??""),U(be,"src",c(u)?.path??""),Ae(we,c(u)?.name??"Select")}),E(C,T)},$$slots:{default:!0}})};V(m,x=>{s()&&c(o)&&x(I)})}E(n,b),Ce(),a()}_t(["click","input"]);var au=H("<div> </div>"),ou=H('<div class="frame-content-layer svelte-1vp2oo0"></div>');function Qa(n,e){Ie(e,!0);const t=()=>O(La,"$placedFrames",d),i=()=>O(Pa,"$isBuilderMode",d),s=()=>O($s,"$builderCameraInfo",d),r=()=>O(Ea,"$gameCameraInfo",d),a=()=>O(Cs,"$builderPreviewLanguage",d),l=()=>O(Jn,"$currentLanguage",d),o=()=>O(Ds,"$draggingFramePositions",d),[d,u]=We();let h=X(t),f=X(()=>i()?s().scrollX:r().scrollX),g=X(()=>i()?s().scrollY:r().scrollY),v=X(()=>i()?s().zoom:r().zoom),S=X(()=>i()?a():l()),_=X(o);function p(m){const I=c(_).get(m.id);return I||{x:m.x,y:m.y}}function w(m){const I=m.scale??$t,x=m.rotation===90,{textWidth:C,textHeight:M}=Un(I,x),T=p(m),A=(T.x-c(f))*c(v),D=(T.y-c(g))*c(v);return{x:A,y:D,width:C*c(v),height:M*c(v)}}function y(m){return(m.texts.find(x=>x.language===c(S))||m.texts[0]||{text:""}).text||""}var b=ou();st(b,21,()=>c(h),m=>m.id,(m,I)=>{const x=X(()=>w(c(I))),C=X(()=>y(c(I))),M=X(()=>(c(I).textSize??mi)*c(v)),T=X(()=>c(I).textColor??Va),A=X(()=>c(I).textAlign??ja);var D=Oe(),L=ge(D);{var z=Z=>{var F=au();let q;var te=P(F);G(()=>{q=ke(F,1,"frame-text svelte-1vp2oo0",null,q,{"align-top":c(A)==="top","align-center":c(A)==="center","align-bottom":c(A)==="bottom"}),xe(F,`
          left: ${c(x).x??""}px;
          top: ${c(x).y??""}px;
          width: ${c(x).width??""}px;
          height: ${c(x).height??""}px;
          font-size: ${c(M)??""}px;
          color: ${c(T)??""};
        `),Ae(te,c(C))}),E(Z,F)};V(L,Z=>{c(C)&&Z(z)})}E(m,D)}),E(n,b),Ce(),u()}var lu=H('<div class="temp-zone-button svelte-130i47e"><!></div>');function cu(n,e){Ie(e,!0);const t=()=>O($s,"$builderCameraInfo",r),i=()=>O(Ue,"$builderEditMode",r),s=()=>O(Kt,"$isDraggingInBuilder",r),[r,a]=We();let l=K(null),o=null,d=null,u=K(null);function h(p){o&&clearTimeout(o),$(l,p,!0),$(u,t()?.scrollX??null,!0),o=setTimeout(()=>{$(l,null),$(u,null)},2e3)}function f(){c(l)&&(Ke.emit($e.DIALOG_ZONE_CREATE_AT,{worldX:c(l).worldX}),$(l,null),$(u,null),o&&(clearTimeout(o),o=null))}function g(){$(l,null),$(u,null),o&&(clearTimeout(o),o=null)}ci(()=>{d=Ke.on($e.TEMP_ZONE_BUTTON_SHOW,h);const p=Ke.on($e.TEMP_ZONE_BUTTON_HIDE,g);return()=>{d?.unsubscribe(),p.unsubscribe()}}),_l(()=>{o&&clearTimeout(o)}),Ze(()=>{i()!=="dialogs"&&($(l,null),$(u,null))}),Ze(()=>{const p=t()?.scrollX;c(l)&&c(u)!==null&&p!==void 0&&Math.abs(p-c(u))>10&&($(l,null),$(u,null),o&&(clearTimeout(o),o=null))});var v=Oe(),S=ge(v);{var _=p=>{var w=lu(),y=P(w);ae(y,{variant:"cyan",width:"90px",onclick:f,children:(b,m)=>{var I=re("+ ZONE");E(b,I)},$$slots:{default:!0}}),G(()=>xe(w,`left: ${c(l).screenX??""}px; top: ${c(l).screenY-50}px;${s()?" pointer-events: none;":""}`)),E(p,w)};V(S,p=>{c(l)&&i()==="dialogs"&&p(_)})}E(n,v),Ce(),a()}var du=H('<div class="item-controls svelte-1is3rex"><div class="controls-row svelte-1is3rex"><!> <!> <!> <!></div></div>');function uu(n,e){Ie(e,!0);const t=()=>O(ks,"$selectedItem",u),i=()=>O(Ha,"$selectedItemScreenPosition",u),s=()=>O(Hi,"$selectedItemId",u),r=()=>O(Oa,"$itemDepthLayer",u),a=()=>O(ic,"$selectedItemPhysicsEnabled",u),l=()=>O(sc,"$selectedItemFlipX",u),o=()=>O(Ue,"$builderEditMode",u),d=()=>O(Kt,"$isDraggingInBuilder",u),[u,h]=We();let f=X(()=>t()?yc(t().assetKey):!1),g=X(()=>{const m=i();if(!m)return null;const I=10,x=40,C=c(f)?380:290;let M=m.screenY-m.itemHeight/2-45;const T=I+x;M<T&&(M=m.screenY+m.itemHeight/2+10);const A=window.innerHeight-x-I;M>A&&(M=A);let D=m.screenX;const L=C/2,z=L+I,Z=window.innerWidth-L-I;return D<z&&(D=z),D>Z&&(D=Z),{x:D,y:M}});function v(){if(!s())return;const m=r()==="behind"?"front":"behind",I=Is(m);oc(),lc(s(),I)}function S(){s()&&cc(s(),!a())}function _(){s()&&dc(s(),!l())}function p(){s()&&(Za(s()),Ps())}var w=Oe(),y=ge(w);{var b=m=>{var I=du(),x=P(I),C=P(x);{let L=X(()=>r()==="behind"?"blue":"orange"),z=X(()=>a()?"Solid items must be behind player":"Toggle item depth: behind or in front of player");ae(C,{get variant(){return c(L)},get title(){return c(z)},onclick:v,get disabled(){return a()},children:(Z,F)=>{var q=re();G(()=>Ae(q,r()==="behind"?"Front":"Back")),E(Z,q)},$$slots:{default:!0}})}var M=k(C,2);{let L=X(()=>l()?"orange":"blue");ae(M,{get variant(){return c(L)},title:"Flip item horizontally",onclick:_,children:(z,Z)=>{var F=re("Flip");E(z,F)},$$slots:{default:!0}})}var T=k(M,2);{var A=L=>{{let z=X(()=>a()?"orange":"blue");ae(L,{get variant(){return c(z)},title:"Toggle physics: item will block player movement",onclick:S,children:(Z,F)=>{var q=re();G(()=>Ae(q,a()?"Ghost":"Solid")),E(Z,q)},$$slots:{default:!0}})}};V(T,L=>{c(f)&&L(A)})}var D=k(T,2);ae(D,{variant:"red",title:"Delete selected item",onclick:p,children:(L,z)=>{var Z=re("DEL");E(L,Z)},$$slots:{default:!0}}),G(()=>xe(I,`left: ${c(g).x??""}px; top: ${c(g).y??""}px;${d()?" pointer-events: none;":""}`)),E(m,I)};V(y,m=>{o()!=="dialogs"&&s()&&c(g)&&m(b)})}E(n,w),Ce(),h()}var hu=H('<div class="frame-controls svelte-eqt3a9"><div class="controls-row svelte-eqt3a9"><!> <!></div></div>');function fu(n,e){Ie(e,!0);const t=()=>O(Fa,"$selectedFrameScreenPosition",a),i=()=>O(ti,"$selectedFrameId",a),s=()=>O(Ue,"$builderEditMode",a),r=()=>O(Kt,"$isDraggingInBuilder",a),[a,l]=We();let o=X(()=>{const v=t();if(!v)return null;const S=10,_=40,p=190;let w=v.screenY-v.frameHeight/2-45;const y=S+_;w<y&&(w=v.screenY+v.frameHeight/2+10);const b=window.innerHeight-_-S;w>b&&(w=b);let m=v.screenX;const I=p/2,x=I+S,C=window.innerWidth-I-S;return m<x&&(m=x),m>C&&(m=C),{x:m,y:w}});function d(){Ma()}function u(){i()&&(Os(i()),Kn(null))}var h=Oe(),f=ge(h);{var g=v=>{var S=hu(),_=P(S),p=P(_);ae(p,{variant:"purple",title:"Edit frame content (or double-click)",onclick:d,children:(y,b)=>{var m=re("EDIT");E(y,m)},$$slots:{default:!0}});var w=k(p,2);ae(w,{variant:"red",title:"Delete selected frame",onclick:u,children:(y,b)=>{var m=re("DEL");E(y,m)},$$slots:{default:!0}}),G(()=>xe(S,`left: ${c(o).x??""}px; top: ${c(o).y??""}px;${r()?" pointer-events: none;":""}`)),E(v,S)};V(f,v=>{s()!=="dialogs"&&i()&&c(o)&&v(g)})}E(n,h),Ce(),l()}var gu=H('<div class="zone-controls svelte-sm01rq"><div class="controls-row svelte-sm01rq"><!> <!> <!></div></div>');function pu(n,e){Ie(e,!0);const t=()=>O(Xa,"$selectedDialogZoneScreenPosition",a),i=()=>O(Fi,"$selectedDialogZoneId",a),s=()=>O(Ue,"$builderEditMode",a),r=()=>O(Kt,"$isDraggingInBuilder",a),[a,l]=We();let o=X(()=>{const S=t();if(!S)return null;const _=10,p=120,w=85;let y=S.screenY;const b=_+p/2,m=window.innerHeight-p/2-_;y<b&&(y=b),y>m&&(y=m);let I=S.screenX;const x=w/2,C=x+_,M=window.innerWidth-x-_;return I<C&&(I=C),I>M&&(I=M),{x:I,y}});function d(){Na()}function u(){i()&&(Wa(i()),zn(null))}function h(){zn(null)}var f=Oe(),g=ge(f);{var v=S=>{var _=gu(),p=P(_),w=P(p);ae(w,{variant:"cyan",title:"Edit zone content (or double-click)",onclick:d,children:(m,I)=>{var x=re("EDIT");E(m,x)},$$slots:{default:!0}});var y=k(w,2);ae(y,{variant:"red",title:"Delete selected zone",onclick:u,children:(m,I)=>{var x=re("DEL");E(m,x)},$$slots:{default:!0}});var b=k(y,2);ae(b,{variant:"default",title:"Deselect zone",onclick:h,children:(m,I)=>{var x=re("DONE");E(m,x)},$$slots:{default:!0}}),G(()=>xe(_,`left: ${c(o).x??""}px; top: ${c(o).y??""}px;${r()?" pointer-events: none;":""}`)),E(S,_)};V(g,S=>{s()==="dialogs"&&i()&&c(o)&&S(v)})}E(n,f),Ce(),l()}var mu=H('<div class="social-controls svelte-1v4dckp"><div class="controls-row svelte-1v4dckp"><!> <!></div></div>');function vu(n,e){Ie(e,!0);const t=()=>O(Ra,"$selectedSocialScreenPosition",a),i=()=>O(ni,"$selectedSocialId",a),s=()=>O(Ue,"$builderEditMode",a),r=()=>O(Kt,"$isDraggingInBuilder",a),[a,l]=We();let o=X(()=>{const v=t();if(!v)return null;const S=10,_=40,p=190;let w=v.screenY-v.socialHeight/2-45;const y=S+_;w<y&&(w=v.screenY+v.socialHeight/2+10);const b=window.innerHeight-_-S;w>b&&(w=b);let m=v.screenX;const I=p/2,x=I+S,C=window.innerWidth-I-S;return m<x&&(m=x),m>C&&(m=C),{x:m,y:w}});function d(){$a()}function u(){i()&&(Ls(i()),Gn(null))}var h=Oe(),f=ge(h);{var g=v=>{var S=mu(),_=P(S),p=P(_);ae(p,{variant:"pink",title:"Edit social settings (or double-click)",onclick:d,children:(y,b)=>{var m=re("EDIT");E(y,m)},$$slots:{default:!0}});var w=k(p,2);ae(w,{variant:"red",title:"Delete selected social",onclick:u,children:(y,b)=>{var m=re("DEL");E(y,m)},$$slots:{default:!0}}),G(()=>xe(S,`left: ${c(o).x??""}px; top: ${c(o).y??""}px;${r()?" pointer-events: none;":""}`)),E(v,S)};V(f,v=>{s()!=="dialogs"&&i()&&c(o)&&v(g)})}E(n,h),Ce(),l()}var _u=H('<div class="hstack svelte-8vtf35"><!></div>');function yu(n,e){let t=ce(e,"gap",3,"10px"),i=ce(e,"align",3,"center");var s=_u(),r=P(s);An(r,()=>e.children??pt),G(()=>xe(s,`gap: ${t()??""}; align-items: ${(i()==="start"?"flex-start":i()==="end"?"flex-end":i())??""};`)),E(n,s)}var bu=H('<div class="vstack svelte-1y4dqnf"><!></div>');function wu(n,e){let t=ce(e,"gap",3,"10px"),i=ce(e,"align",3,"stretch");var s=bu(),r=P(s);An(r,()=>e.children??pt),G(()=>xe(s,`gap: ${t()??""}; align-items: ${(i()==="start"?"flex-start":i()==="end"?"flex-end":i())??""};`)),E(n,s)}var Su=H("<div><!></div>");function xr(n,e){const t=()=>O(Kt,"$isDraggingInBuilder",i),[i,s]=We();let r=ce(e,"padding",3,"10px");var a=Su();let l;var o=P(a);An(o,()=>e.children??pt),G(()=>{l=ke(a,1,`fixed fixed--${e.position??""}`,"svelte-vwlo0e",l,{"dragging-in-builder":t()}),xe(a,`--padding: ${r()??""};`)}),E(n,a),s()}var Eu=H("<div><!> <!></div>"),xu=H("<!> <!>",1),Iu=H("<!> <!> <!> <!>",1),Cu=H("<div><!></div>"),Tu=H("<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!>",1);function Du(n,e){Ie(e,!0);const t=()=>O(Hi,"$selectedItemId",h),i=()=>O(ti,"$selectedFrameId",h),s=()=>O(Fi,"$selectedDialogZoneId",h),r=()=>O(ni,"$selectedSocialId",h),a=()=>O(Ue,"$builderEditMode",h),l=()=>O(Ii,"$gridSnappingEnabled",h),o=()=>O(nn,"$isAssetPaletteOpen",h),d=()=>O(Jt,"$isFramePaletteOpen",h),u=()=>O(Qt,"$isSocialPaletteOpen",h),[h,f]=We(),g=600;let v=K(ct(typeof window<"u"?window.innerWidth<g:!1)),S=X(()=>c(v)&&(t()!==null||i()!==null||s()!==null||r()!==null));Ze(()=>{function te(){$(v,window.innerWidth<g)}return window.addEventListener("resize",te),()=>window.removeEventListener("resize",te)});function _(){fd()}function p(){zl()}function w(){Ke.emit($e.DIALOG_ZONE_CREATE)}var y=Tu(),b=ge(y);uu(b,{});var m=k(b,2);fu(m,{});var I=k(m,2);pu(I,{});var x=k(I,2);vu(x,{});var C=k(x,2);{var M=te=>{Id(te,{})},T=te=>{var W=Oe(),Q=ge(W);{var be=we=>{zd(we,{})},me=we=>{var Te=Oe(),Ve=ge(Te);{var De=_e=>{Ad(_e,{})},Be=_e=>{var oe=Oe(),de=ge(oe);{var ne=ue=>{$d(ue,{})};V(de,ue=>{a()==="socials"&&ue(ne)},!0)}E(_e,oe)};V(Ve,_e=>{a()==="frames"?_e(De):_e(Be,!1)},!0)}E(we,Te)};V(Q,we=>{a()==="dialogs"?we(be):we(me,!1)},!0)}E(te,W)};V(C,te=>{a()==="items"?te(M):te(T,!1)})}var A=k(C,2);Qd(A,{});var D=k(A,2);ru(D,{});var L=k(D,2);Qa(L,{});var z=k(L,2);cu(z,{});var Z=k(z,2),F=k(Z,2);xr(F,{position:"top-left",children:(te,W)=>{var Q=Eu();let be;var me=P(Q);ae(me,{variant:"green",width:"100px",onclick:_,children:(Te,Ve)=>{var De=re("SAVE");E(Te,De)},$$slots:{default:!0}});var we=k(me,2);{let Te=X(()=>l()?"blue":"orange");ae(we,{get variant(){return c(Te)},width:"80px",onclick:p,title:"Toggle grid snapping",children:(Ve,De)=>{var Be=re();G(()=>Ae(Be,l()?"FREE":"SNAP")),E(Ve,Be)},$$slots:{default:!0}})}G(()=>be=ke(Q,1,"left-buttons svelte-1vm8op7",null,be,{"hide-left":c(S)})),E(te,Q)},$$slots:{default:!0}});var q=k(F,2);xr(q,{position:"top-right",children:(te,W)=>{var Q=Cu();let be;var me=P(Q);wu(me,{align:"end",children:(we,Te)=>{var Ve=Iu(),De=ge(Ve);{let de=X(()=>a()==="items"&&o()?"orange":"blue");ae(De,{get variant(){return c(de)},onclick:()=>{a()==="items"?Kl():(Xn("items"),nn.set(!0))},title:"Edit assets/items",children:(ne,ue)=>{var Se=re("ASSETS");E(ne,Se)},$$slots:{default:!0}})}var Be=k(De,2);{let de=X(()=>a()==="frames"&&d()?"orange":"purple");ae(Be,{get variant(){return c(de)},onclick:()=>{a()==="frames"?Gl():(Xn("frames"),Jt.set(!0))},title:"Edit text frames",children:(ne,ue)=>{var Se=re("FRAMES");E(ne,Se)},$$slots:{default:!0}})}var _e=k(Be,2);{let de=X(()=>a()==="socials"&&u()?"orange":"pink");ae(_e,{get variant(){return c(de)},onclick:()=>{a()==="socials"?Vl():(Xn("socials"),Qt.set(!0))},title:"Edit social icons",children:(ne,ue)=>{var Se=re("SOCIALS");E(ne,Se)},$$slots:{default:!0}})}var oe=k(_e,2);yu(oe,{children:(de,ne)=>{var ue=xu(),Se=ge(ue);{var Re=nt=>{ae(nt,{variant:"cyan",width:"100px",onclick:w,title:"Create new dialog zone at center of view",children:(Gt,Fn)=>{var Ht=re("+ ZONE");E(Gt,Ht)},$$slots:{default:!0}})};V(Se,nt=>{a()==="dialogs"&&nt(Re)})}var at=k(Se,2);{let nt=X(()=>a()==="dialogs"?"orange":"cyan");ae(at,{get variant(){return c(nt)},onclick:()=>{a()==="dialogs"?Xn("items"):Xn("dialogs")},title:"Edit dialog zones",children:(Gt,Fn)=>{var Ht=re("DIALOGS");E(Gt,Ht)},$$slots:{default:!0}})}E(de,ue)},$$slots:{default:!0}}),E(we,Ve)},$$slots:{default:!0}}),G(()=>be=ke(Q,1,"right-buttons svelte-1vm8op7",null,be,{"hide-right":c(S)})),E(te,Q)},$$slots:{default:!0}}),E(n,y),Ce(),f()}var Au=H('<button class="background-card svelte-crre06" type="button"><div class="preview-container svelte-crre06"><img class="preview-image svelte-crre06"/></div> <span class="background-name svelte-crre06"> </span></button>'),ku=H('<div class="background-select-screen svelte-crre06"><div class="content svelte-crre06"><h1 class="title svelte-crre06">SELECT BACKGROUND</h1> <div class="backgrounds-grid svelte-crre06"></div></div></div>');function Pu(n,e){Ie(e,!1);const t=wt;function i(o){return`./assets/backgrounds/${o}/preview.png`}function s(o){ei.setBackgroundByIndex(o),va.set(t[o].name),_a.set(!0),gd()}ma();var r=ku(),a=P(r),l=k(P(a),2);st(l,5,()=>t,ht,(o,d,u)=>{var h=Au();h.__click=()=>s(u);var f=P(h),g=P(f),v=k(f,2),S=P(v);G(_=>{U(g,"src",_),U(g,"alt",c(d).name),Ae(S,c(d).name)},[()=>i(c(d).folder)]),E(o,h)}),E(n,r),Ce()}_t(["click"]);var Mu=H("<div> </div>"),$u=H('<div class="dialog-content svelte-1jd14ss"> </div>'),Ou=H("<div><!> <!></div>");function Lu(n,e){Ie(e,!0);const t=()=>O(Cl,"$activeDialogText",s),i=()=>O(Sa,"$playerScreenPosition",s),[s,r]=We();let a=X(()=>t()?.title&&t()?.content),l=X(()=>Math.max(10,window.innerHeight-i().y+Zd)),o=X(()=>window.innerWidth<=Nd),d=X(()=>c(o)?50:i().x),u=X(()=>c(o)?"percent":"px");var h=Oe(),f=ge(h);{var g=v=>{var S=Ou();let _;var p=P(S);{var w=m=>{var I=Mu();let x;var C=P(I);G(()=>{x=ke(I,1,"dialog-title svelte-1jd14ss",null,x,{"has-divider":c(a)}),Ae(C,t().title)}),E(m,I)};V(p,m=>{t().title&&m(w)})}var y=k(p,2);{var b=m=>{var I=$u(),x=P(I);G(()=>Ae(x,t().content)),E(m,I)};V(y,m=>{t().content&&m(b)})}G(()=>{_=ke(S,1,"dialog-bubble svelte-1jd14ss",null,_,{narrow:c(o)}),xe(S,`bottom: ${c(l)??""}px; left: ${c(d)??""}${c(u)??""};`)}),E(v,S)};V(f,v=>{t()&&v(g)})}E(n,h),Ce(),r()}var Ru=H("<!> <!>",1),Hu=H('<div class="touch-controls"><p class="touch-text">Tap and hold<br/>where you want<br/>to move</p></div>'),Fu=H('<div class="desktop-controls"><div class="key-row"><div class="pixel-key">A</div> <div class="pixel-key">W</div> <div class="pixel-key">D</div></div> <p class="or-text">or</p> <div class="key-row"><div class="pixel-key">â</div> <div class="pixel-key">â</div> <div class="pixel-key">â</div></div></div>'),Xu=H('<div class="loader-overlay"><div class="pixel-loader"></div></div>'),Nu=H('<div class="game-ui-wrapper svelte-13dvmla"><!> <!> <!> <dialog class="pixel-dialog"><h1>CONTROLS</h1> <div class="controls-content"><!></div></dialog> <!></div>');function Zu(n,e){Ie(e,!1);const t=()=>O(Zn,"$showControlsDialog",d),i=()=>O(ba,"$hasPlayerMoved",d),s=()=>O(_a,"$hasSelectedBackground",d),r=()=>O(Pa,"$isBuilderMode",d),a=()=>O(Jn,"$currentLanguage",d),l=()=>O(ya,"$isTouchDevice",d),o=()=>O(ls,"$isLoading",d),[d,u]=We();let h=bs();function f(){const y=qa.toggleLanguage();Jn.set(y)}function g(y){!c(h)?.open||y.target.closest(".pixel-button")||Zn.set(!1)}function v(){const y=ud();if(!y){console.error("Cannot enter builder mode: map config not found");return}hd(y)}Ks(()=>(c(h),t()),()=>{c(h)&&(t()?c(h).showModal():c(h).close())}),Ks(()=>(i(),c(h),Zn),()=>{i()&&c(h)?.open&&Zn.set(!1)}),tl(),ma();var S=Oe();ut("pointerdown",Fr,g);var _=ge(S);{var p=y=>{Pu(y,{})},w=y=>{var b=Nu(),m=P(b);{var I=W=>{Du(W,{})},x=W=>{var Q=Ru(),be=ge(Q);Lu(be,{});var me=k(be,2);Qa(me,{}),E(W,Q)};V(m,W=>{r()?W(I):W(x,!1)})}var C=k(m,2);{var M=W=>{ae(W,{position:"top-left",variant:"green",width:"120px",onclick:v,title:"Toggle Builder Mode",children:(Q,be)=>{var me=re("BUILD");E(Q,me)},$$slots:{default:!0}})};V(C,W=>{r()||W(M)})}var T=k(C,2);{var A=W=>{ae(W,{position:"top-right",variant:"default",width:"100px",onclick:f,title:"Toggle Language (L)",children:(Q,be)=>{var me=re();G(we=>Ae(me,we),[()=>(a(),zt(()=>a().toUpperCase()))]),E(Q,me)},$$slots:{default:!0}})};V(T,W=>{r()||W(A)})}var D=k(T,2),L=k(P(D),2),z=P(L);{var Z=W=>{var Q=Hu();E(W,Q)},F=W=>{var Q=Fu();E(W,Q)};V(z,W=>{l()?W(Z):W(F,!1)})}ln(D,W=>$(h,W),()=>c(h));var q=k(D,2);{var te=W=>{var Q=Xu();E(W,Q)};V(q,W=>{o()&&W(te)})}E(y,b)};V(_,y=>{s()?y(w,!1):y(p)})}E(n,S),Ce(),u()}Rl();const eo=document.getElementById("game-ui");if(!eo)throw new Error("game-ui element not found!");cl(Zu,{target:eo});Jn.set(qa.getLanguage());Il.set(Ia.getSkin());va.set(ei.getCurrentConfig().name);const Yu={type:N.AUTO,width:800,height:600,parent:"game-container",backgroundColor:"#000000",pixelArt:!0,roundPixels:!0,scale:{mode:N.Scale.RESIZE,autoCenter:N.Scale.CENTER_BOTH},input:{activePointers:3},physics:{default:"arcade",arcade:{gravity:{y:1e3,x:0},debug:!1}},audio:{noAudio:!0},scene:[]},Ni=new N.Game(Yu);Ni.scene.add(mt.GAME,jc);Ni.scene.add(mt.BUILDER,od);dd(Ni);const Wu=Ni.device.input.touch;ya.set(Wu);const Bu=performance.getEntriesByType("navigation")[0]&&performance.getEntriesByType("navigation")[0].type==="reload",zu=sessionStorage.getItem("hasSeenControlsHint");(!zu||Bu)&&(sessionStorage.setItem("hasSeenControlsHint","true"),Zn.set(!0));
//# sourceMappingURL=index-CJnK9AWb.js.map
