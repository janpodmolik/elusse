import{r as qa,g as Ja}from"./phaser-DFK5Ua9d.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();var Qa=qa();const N=Ja(Qa),jn=!1;var ls=Array.isArray,eo=Array.prototype.indexOf,cs=Array.from,Sr=Object.defineProperty,Xi=Object.getOwnPropertyDescriptor,xr=Object.getOwnPropertyDescriptors,to=Object.prototype,io=Array.prototype,ds=Object.getPrototypeOf,Ls=Object.isExtensible;const ft=()=>{};function no(i){return i()}function pn(i){for(var e=0;e<i.length;e++)i[e]()}function Er(){var i,e,t=new Promise((n,s)=>{i=n,e=s});return{promise:t,resolve:i,reject:e}}function Ir(i,e){if(Array.isArray(i))return i;if(!(Symbol.iterator in i))return Array.from(i);const t=[];for(const n of i)if(t.push(n),t.length===e)break;return t}const Ze=2,us=4,In=8,so=1<<24,Ot=16,Lt=32,oi=64,Cn=128,mt=512,Xe=1024,tt=2048,Tt=4096,st=8192,Nt=16384,hs=32768,ti=65536,Rs=1<<17,Cr=1<<18,Di=1<<19,Tr=1<<20,ii=32768,qn=1<<21,fs=1<<22,Zt=1<<23,Yt=Symbol("$state"),ro=Symbol(""),gi=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Dr(i){return i===this.v}function kr(i,e){return i!=i?e==e:i!==e||i!==null&&typeof i=="object"||typeof i=="function"}function Pr(i){return!kr(i,this.v)}function Ar(i){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function ao(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function oo(i){throw new Error("https://svelte.dev/e/effect_in_teardown")}function lo(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function co(i){throw new Error("https://svelte.dev/e/effect_orphan")}function uo(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function ho(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function fo(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function go(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function po(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}let tn=!1,mo=!1;function vo(){tn=!0}const Mr=1,$r=2,Or=4,_o=8,yo=16,bo=1,wo=2,We=Symbol(),So="http://www.w3.org/1999/xhtml";let ge=null;function wi(i){ge=i}function Ee(i,e=!1,t){ge={p:ge,i:!1,c:null,e:null,s:i,x:null,l:tn&&!e?{s:null,u:null,$:[]}:null}}function Ie(i){var e=ge,t=e.e;if(t!==null){e.e=null;for(var n of t)ia(n)}return e.i=!0,ge=e.p,{}}function nn(){return!tn||ge!==null&&ge.l===null}let pi=[];function xo(){var i=pi;pi=[],pn(i)}function ki(i){if(pi.length===0){var e=pi;queueMicrotask(()=>{e===pi&&xo()})}pi.push(i)}function Eo(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Io(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function ot(i){if(typeof i!="object"||i===null||Yt in i)return i;const e=ds(i);if(e!==to&&e!==io)return i;var t=new Map,n=ls(i),s=K(0),r=Qt,a=l=>{if(Qt===r)return l();var o=Q,d=Qt;Qe(null),Zs(r);var u=l();return Qe(o),Zs(d),u};return n&&t.set("length",K(i.length)),new Proxy(i,{defineProperty(l,o,d){(!("value"in d)||d.configurable===!1||d.enumerable===!1||d.writable===!1)&&ho();var u=t.get(o);return u===void 0?u=a(()=>{var h=K(d.value);return t.set(o,h),h}):$(u,d.value,!0),!0},deleteProperty(l,o){var d=t.get(o);if(d===void 0){if(o in l){const u=a(()=>K(We));t.set(o,u),Fi(s)}}else $(d,We),Fi(s);return!0},get(l,o,d){if(o===Yt)return i;var u=t.get(o),h=o in l;if(u===void 0&&(!h||Xi(l,o)?.writable)&&(u=a(()=>{var g=ot(h?l[o]:We),v=K(g);return v}),t.set(o,u)),u!==void 0){var f=c(u);return f===We?void 0:f}return Reflect.get(l,o,d)},getOwnPropertyDescriptor(l,o){var d=Reflect.getOwnPropertyDescriptor(l,o);if(d&&"value"in d){var u=t.get(o);u&&(d.value=c(u))}else if(d===void 0){var h=t.get(o),f=h?.v;if(h!==void 0&&f!==We)return{enumerable:!0,configurable:!0,value:f,writable:!0}}return d},has(l,o){if(o===Yt)return!0;var d=t.get(o),u=d!==void 0&&d.v!==We||Reflect.has(l,o);if(d!==void 0||ne!==null&&(!u||Xi(l,o)?.writable)){d===void 0&&(d=a(()=>{var f=u?ot(l[o]):We,g=K(f);return g}),t.set(o,d));var h=c(d);if(h===We)return!1}return u},set(l,o,d,u){var h=t.get(o),f=o in l;if(n&&o==="length")for(var g=d;g<h.v;g+=1){var v=t.get(g+"");v!==void 0?$(v,We):g in l&&(v=a(()=>K(We)),t.set(g+"",v))}if(h===void 0)(!f||Xi(l,o)?.writable)&&(h=a(()=>K(void 0)),$(h,ot(d)),t.set(o,h));else{f=h.v!==We;var S=a(()=>ot(d));$(h,S)}var y=Reflect.getOwnPropertyDescriptor(l,o);if(y?.set&&y.set.call(u,d),!f){if(n&&typeof o=="string"){var m=t.get("length"),w=Number(o);Number.isInteger(w)&&w>=m.v&&$(m,w+1)}Fi(s)}return!0},ownKeys(l){c(s);var o=Reflect.ownKeys(l).filter(h=>{var f=t.get(h);return f===void 0||f.v!==We});for(var[d,u]of t)u.v!==We&&!(d in l)&&o.push(d);return o},setPrototypeOf(){fo()}})}function Hs(i){try{if(i!==null&&typeof i=="object"&&Yt in i)return i[Yt]}catch{}return i}function Co(i,e){return Object.is(Hs(i),Hs(e))}var Xs,Lr,Rr,Hr,Xr;function To(){if(Xs===void 0){Xs=window,Lr=document,Rr=/Firefox/.test(navigator.userAgent);var i=Element.prototype,e=Node.prototype,t=Text.prototype;Hr=Xi(e,"firstChild").get,Xr=Xi(e,"nextSibling").get,Ls(i)&&(i.__click=void 0,i.__className=void 0,i.__attributes=null,i.__style=void 0,i.__e=void 0),Ls(t)&&(t.__t=void 0)}}function $t(i=""){return document.createTextNode(i)}function mn(i){return Hr.call(i)}function sn(i){return Xr.call(i)}function A(i,e){return mn(i)}function fe(i,e=!1){{var t=mn(i);return t instanceof Comment&&t.data===""?sn(t):t}}function P(i,e=1,t=!1){let n=i;for(;e--;)n=sn(n);return n}function Do(i){i.textContent=""}function Fr(){return!1}function Nr(i){var e=ne;if(e===null)return Q.f|=Zt,i;if((e.f&hs)===0){if((e.f&Cn)===0)throw i;e.b.error(i)}else Si(i,e)}function Si(i,e){for(;e!==null;){if((e.f&Cn)!==0)try{e.b.error(i);return}catch(t){i=t}e=e.parent}throw i}const an=new Set;let me=null,lt=null,xt=[],gs=null,Jn=!1;class Et{committed=!1;current=new Map;previous=new Map;#e=new Set;#t=new Set;#n=0;#i=0;#l=null;#r=[];#s=[];skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#i>0}process(e){xt=[],this.apply();var t={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const n of e)this.#a(n,t);this.is_fork||this.#d(),this.is_deferred()?(this.#o(t.effects),this.#o(t.render_effects),this.#o(t.block_effects)):(me=null,Fs(t.render_effects),Fs(t.effects),this.#l?.resolve()),lt=null}#a(e,t){e.f^=Xe;for(var n=e.first;n!==null;){var s=n.f,r=(s&(Lt|oi))!==0,a=r&&(s&Xe)!==0,l=a||(s&st)!==0||this.skipped_effects.has(n);if((n.f&Cn)!==0&&n.b?.is_pending()&&(t={parent:t,effect:n,effects:[],render_effects:[],block_effects:[]}),!l&&n.fn!==null){r?n.f^=Xe:(s&us)!==0?t.effects.push(n):Ai(n)&&((n.f&Ot)!==0&&t.block_effects.push(n),Ei(n));var o=n.first;if(o!==null){n=o;continue}}var d=n.parent;for(n=n.next;n===null&&d!==null;)d===t.effect&&(this.#o(t.effects),this.#o(t.render_effects),this.#o(t.block_effects),t=t.parent),n=d.next,d=d.parent}}#o(e){for(const t of e)((t.f&tt)!==0?this.#r:this.#s).push(t),this.#c(t.deps),Fe(t,Xe)}#c(e){if(e!==null)for(const t of e)(t.f&Ze)===0||(t.f&ii)===0||(t.f^=ii,this.#c(t.deps))}capture(e,t){this.previous.has(e)||this.previous.set(e,t),(e.f&Zt)===0&&(this.current.set(e,e.v),lt?.set(e,e.v))}activate(){me=this,this.apply()}deactivate(){me===this&&(me=null,lt=null)}flush(){if(this.activate(),xt.length>0){if(ko(),me!==null&&me!==this)return}else this.#n===0&&this.process([]);this.deactivate()}discard(){for(const e of this.#t)e(this);this.#t.clear()}#d(){if(this.#i===0){for(const e of this.#e)e();this.#e.clear()}this.#n===0&&this.#u()}#u(){if(an.size>1){this.previous.clear();var e=lt,t=!0,n={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const r of an){if(r===this){t=!1;continue}const a=[];for(const[o,d]of this.current){if(r.current.has(o))if(t&&d!==r.current.get(o))r.current.set(o,d);else continue;a.push(o)}if(a.length===0)continue;const l=[...r.current.keys()].filter(o=>!this.current.has(o));if(l.length>0){var s=xt;xt=[];const o=new Set,d=new Map;for(const u of a)Zr(u,l,o,d);if(xt.length>0){me=r,r.apply();for(const u of xt)r.#a(u,n);r.deactivate()}xt=s}}me=null,lt=e}this.committed=!0,an.delete(this)}increment(e){this.#n+=1,e&&(this.#i+=1)}decrement(e){this.#n-=1,e&&(this.#i-=1),this.revive()}revive(){for(const e of this.#r)Fe(e,tt),ni(e);for(const e of this.#s)Fe(e,Tt),ni(e);this.#r=[],this.#s=[],this.flush()}oncommit(e){this.#e.add(e)}ondiscard(e){this.#t.add(e)}settled(){return(this.#l??=Er()).promise}static ensure(){if(me===null){const e=me=new Et;an.add(me),Et.enqueue(()=>{me===e&&e.flush()})}return me}static enqueue(e){ki(e)}apply(){}}function ko(){var i=Bt;Jn=!0;var e=null;try{var t=0;for(_n(!0);xt.length>0;){var n=Et.ensure();if(t++>1e3){var s,r;Po()}n.process(xt),Wt.clear()}}finally{Jn=!1,_n(i),gs=null}}function Po(){try{uo()}catch(i){Si(i,gs)}}let Pt=null;function Fs(i){var e=i.length;if(e!==0){for(var t=0;t<e;){var n=i[t++];if((n.f&(Nt|st))===0&&Ai(n)&&(Pt=new Set,Ei(n),n.deps===null&&n.first===null&&n.nodes_start===null&&(n.teardown===null&&n.ac===null?ra(n):n.fn=null),Pt?.size>0)){Wt.clear();for(const s of Pt){if((s.f&(Nt|st))!==0)continue;const r=[s];let a=s.parent;for(;a!==null;)Pt.has(a)&&(Pt.delete(a),r.push(a)),a=a.parent;for(let l=r.length-1;l>=0;l--){const o=r[l];(o.f&(Nt|st))===0&&Ei(o)}}Pt.clear()}}Pt=null}}function Zr(i,e,t,n){if(!t.has(i)&&(t.add(i),i.reactions!==null))for(const s of i.reactions){const r=s.f;(r&Ze)!==0?Zr(s,e,t,n):(r&(fs|Ot))!==0&&(r&tt)===0&&Yr(s,e,n)&&(Fe(s,tt),ni(s))}}function Yr(i,e,t){const n=t.get(i);if(n!==void 0)return n;if(i.deps!==null)for(const s of i.deps){if(e.includes(s))return!0;if((s.f&Ze)!==0&&Yr(s,e,t))return t.set(s,!0),!0}return t.set(i,!1),!1}function ni(i){for(var e=gs=i;e.parent!==null;){e=e.parent;var t=e.f;if(Jn&&e===ne&&(t&Ot)!==0&&(t&Cr)===0)return;if((t&(oi|Lt))!==0){if((t&Xe)===0)return;e.f^=Xe}}xt.push(e)}function Ao(i){let e=0,t=si(0),n;return()=>{zi()&&(c(t),kn(()=>(e===0&&(n=zt(()=>i(()=>Fi(t)))),e+=1,()=>{ki(()=>{e-=1,e===0&&(n?.(),n=void 0,Fi(t))})})))}}var Mo=ti|Di|Cn;function $o(i,e,t){new Oo(i,e,t)}class Oo{parent;#e=!1;#t;#n=null;#i;#l;#r;#s=null;#a=null;#o=null;#c=null;#d=null;#u=0;#h=0;#g=!1;#f=null;#y=Ao(()=>(this.#f=si(this.#u),()=>{this.#f=null}));constructor(e,t,n){this.#t=e,this.#i=t,this.#l=n,this.parent=ne.b,this.#e=!!this.#i.pending,this.#r=Pn(()=>{ne.b=this;{var s=this.#v();try{this.#s=at(()=>n(s))}catch(r){this.error(r)}this.#h>0?this.#m():this.#e=!1}return()=>{this.#d?.remove()}},Mo)}#b(){try{this.#s=at(()=>this.#l(this.#t))}catch(e){this.error(e)}this.#e=!1}#w(){const e=this.#i.pending;e&&(this.#a=at(()=>e(this.#t)),Et.enqueue(()=>{var t=this.#v();this.#s=this.#p(()=>(Et.ensure(),at(()=>this.#l(t)))),this.#h>0?this.#m():(vi(this.#a,()=>{this.#a=null}),this.#e=!1)}))}#v(){var e=this.#t;return this.#e&&(this.#d=$t(),this.#t.before(this.#d),e=this.#d),e}is_pending(){return this.#e||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!this.#i.pending}#p(e){var t=ne,n=Q,s=ge;Ct(this.#r),Qe(this.#r),wi(this.#r.ctx);try{return e()}catch(r){return Nr(r),null}finally{Ct(t),Qe(n),wi(s)}}#m(){const e=this.#i.pending;this.#s!==null&&(this.#c=document.createDocumentFragment(),this.#c.append(this.#d),la(this.#s,this.#c)),this.#a===null&&(this.#a=at(()=>e(this.#t)))}#_(e){if(!this.has_pending_snippet()){this.parent&&this.parent.#_(e);return}this.#h+=e,this.#h===0&&(this.#e=!1,this.#a&&vi(this.#a,()=>{this.#a=null}),this.#c&&(this.#t.before(this.#c),this.#c=null))}update_pending_count(e){this.#_(e),this.#u+=e,this.#f&&xi(this.#f,this.#u)}get_effect_pending(){return this.#y(),c(this.#f)}error(e){var t=this.#i.onerror;let n=this.#i.failed;if(this.#g||!t&&!n)throw e;this.#s&&(et(this.#s),this.#s=null),this.#a&&(et(this.#a),this.#a=null),this.#o&&(et(this.#o),this.#o=null);var s=!1,r=!1;const a=()=>{if(s){Io();return}s=!0,r&&po(),Et.ensure(),this.#u=0,this.#o!==null&&vi(this.#o,()=>{this.#o=null}),this.#e=this.has_pending_snippet(),this.#s=this.#p(()=>(this.#g=!1,at(()=>this.#l(this.#t)))),this.#h>0?this.#m():this.#e=!1};var l=Q;try{Qe(null),r=!0,t?.(e,a),r=!1}catch(o){Si(o,this.#r&&this.#r.parent)}finally{Qe(l)}n&&ki(()=>{this.#o=this.#p(()=>{Et.ensure(),this.#g=!0;try{return at(()=>{n(this.#t,()=>e,()=>a)})}catch(o){return Si(o,this.#r.parent),null}finally{this.#g=!1}})})}}function dt(i,e){return e}function Lo(i,e,t){for(var n=[],s=e.length,r=0;r<s;r++)_s(e[r].e,n,!0);aa(n,()=>{var a=n.length===0&&t!==null;if(a){var l=t,o=l.parentNode;Do(o),o.append(l),i.items.clear(),St(i,e[0].prev,e[s-1].next)}for(var d=0;d<s;d++){var u=e[d];a||(i.items.delete(u.k),St(i,u.prev,u.next)),et(u.e,!a)}i.first===e[0]&&(i.first=e[0].prev)})}function nt(i,e,t,n,s,r=null){var a=i,l=new Map,o=null,d=(e&Or)!==0,u=(e&Mr)!==0,h=(e&$r)!==0;if(d){var f=i;a=f.appendChild($t())}var g=null,v=Wr(()=>{var b=t();return ls(b)?b:b==null?[]:cs(b)}),S,y=!0;function m(){Ro(_,S,a,e,n),g!==null&&(S.length===0?(g.fragment?(a.before(g.fragment),g.fragment=null):ys(g.effect),w.first=g.effect):vi(g.effect,()=>{g=null}))}var w=Pn(()=>{S=c(v);for(var b=S.length,p=new Set,x=me,T=null,C=Fr(),M=0;M<b;M+=1){var I=S[M],k=n(I,M),D=y?null:l.get(k);D?(u&&xi(D.v,I),h?xi(D.i,M):D.i=M,C&&x.skipped_effects.delete(D.e)):(D=Ho(y?a:null,T,I,k,M,s,e,t),y&&(D.o=!0,T===null?o=D:T.next=D,T=D),l.set(k,D)),p.add(k)}if(b===0&&r&&!g)if(y)g={fragment:null,effect:at(()=>r(a))};else{var O=document.createDocumentFragment(),W=$t();O.append(W),g={fragment:O,effect:at(()=>r(W))}}if(!y)if(C){for(const[B,X]of l)p.has(B)||x.skipped_effects.add(X.e);x.oncommit(m),x.ondiscard(()=>{})}else m();c(v)}),_={effect:w,items:l,first:o};y=!1}function Ro(i,e,t,n,s){var r=(n&_o)!==0,a=e.length,l=i.items,o=i.first,d,u=null,h,f=[],g=[],v,S,y,m;if(r)for(m=0;m<a;m+=1)v=e[m],S=s(v,m),y=l.get(S),y.a?.measure(),(h??=new Set).add(y);for(m=0;m<a;m+=1){if(v=e[m],S=s(v,m),y=l.get(S),i.first??=y,!y.o){y.o=!0;var w=u?u.next:o;St(i,u,y),St(i,y,w),Hn(y,w,t),u=y,f=[],g=[],o=u.next;continue}if((y.e.f&st)!==0&&(ys(y.e),r&&(y.a?.unfix(),(h??=new Set).delete(y))),y!==o){if(d!==void 0&&d.has(y)){if(f.length<g.length){var _=g[0],b;u=_.prev;var p=f[0],x=f[f.length-1];for(b=0;b<f.length;b+=1)Hn(f[b],_,t);for(b=0;b<g.length;b+=1)d.delete(g[b]);St(i,p.prev,x.next),St(i,u,p),St(i,x,_),o=_,u=x,m-=1,f=[],g=[]}else d.delete(y),Hn(y,o,t),St(i,y.prev,y.next),St(i,y,u===null?i.first:u.next),St(i,u,y),u=y;continue}for(f=[],g=[];o!==null&&o.k!==S;)(o.e.f&st)===0&&(d??=new Set).add(o),g.push(o),o=o.next;if(o===null)continue;y=o}f.push(y),u=y,o=y.next}if(o!==null||d!==void 0){for(var T=d===void 0?[]:cs(d);o!==null;)(o.e.f&st)===0&&T.push(o),o=o.next;var C=T.length;if(C>0){var M=(n&Or)!==0&&a===0?t:null;if(r){for(m=0;m<C;m+=1)T[m].a?.measure();for(m=0;m<C;m+=1)T[m].a?.fix()}Lo(i,T,M)}}r&&ki(()=>{if(h!==void 0)for(y of h)y.a?.apply()})}function Ho(i,e,t,n,s,r,a,l){var o=(a&Mr)!==0,d=(a&yo)===0,u=o?d?ms(t,!1,!1):si(t):t,h=(a&$r)===0?s:si(s),f={i:h,v:u,k:n,a:null,e:null,o:!1,prev:e,next:null};try{if(i===null){var g=document.createDocumentFragment();g.append(i=$t())}return f.e=at(()=>r(i,u,h,l)),e!==null&&(e.next=f),f}finally{}}function Hn(i,e,t){for(var n=i.next?i.next.e.nodes_start:t,s=e?e.e.nodes_start:t,r=i.e.nodes_start;r!==null&&r!==n;){var a=sn(r);s.before(r),r=a}}function St(i,e,t){e===null?(i.first=t,i.effect.first=t&&t.e):(e.e.next&&(e.e.next.prev=null),e.next=t,e.e.next=t&&t.e),t===null?i.effect.last=e&&e.e:(t.e.prev&&(t.e.prev.next=null),t.prev=e,t.e.prev=e&&e.e)}function Xo(i,e,t,n){const s=nn()?Tn:Wr;if(t.length===0&&i.length===0){n(e.map(s));return}var r=me,a=ne,l=Fo();function o(){Promise.all(t.map(d=>No(d))).then(d=>{l();try{n([...e.map(s),...d])}catch(u){(a.f&Nt)===0&&Si(u,a)}r?.deactivate(),vn()}).catch(d=>{Si(d,a)})}i.length>0?Promise.all(i).then(()=>{l();try{return o()}finally{r?.deactivate(),vn()}}):o()}function Fo(){var i=ne,e=Q,t=ge,n=me;return function(r=!0){Ct(i),Qe(e),wi(t),r&&n?.activate()}}function vn(){Ct(null),Qe(null),wi(null)}function Tn(i){var e=Ze|tt,t=Q!==null&&(Q.f&Ze)!==0?Q:null;return ne!==null&&(ne.f|=Di),{ctx:ge,deps:null,effects:null,equals:Dr,f:e,fn:i,reactions:null,rv:0,v:We,wv:0,parent:t??ne,ac:null}}function No(i,e){let t=ne;t===null&&ao();var n=t.b,s=void 0,r=si(We),a=!Q,l=new Map;return Jo(()=>{var o=Er();s=o.promise;try{Promise.resolve(i()).then(o.resolve,o.reject).then(()=>{d===me&&d.committed&&d.deactivate(),vn()})}catch(f){o.reject(f),vn()}var d=me;if(a){var u=!n.is_pending();n.update_pending_count(1),d.increment(u),l.get(d)?.reject(gi),l.delete(d),l.set(d,o)}const h=(f,g=void 0)=>{if(d.activate(),g)g!==gi&&(r.f|=Zt,xi(r,g));else{(r.f&Zt)!==0&&(r.f^=Zt),xi(r,f);for(const[v,S]of l){if(l.delete(v),v===d)break;S.reject(gi)}}a&&(n.update_pending_count(-1),d.decrement(u))};o.promise.then(h,f=>h(null,f||"unknown"))}),Dn(()=>{for(const o of l.values())o.reject(gi)}),new Promise(o=>{function d(u){function h(){u===s?o(r):d(s)}u.then(h,h)}d(s)})}function F(i){const e=Tn(i);return Ur(e),e}function Wr(i){const e=Tn(i);return e.equals=Pr,e}function Br(i){var e=i.effects;if(e!==null){i.effects=null;for(var t=0;t<e.length;t+=1)et(e[t])}}function Zo(i){for(var e=i.parent;e!==null;){if((e.f&Ze)===0)return(e.f&Nt)===0?e:null;e=e.parent}return null}function ps(i){var e,t=ne;Ct(Zo(i));try{i.f&=~ii,Br(i),e=Jr(i)}finally{Ct(t)}return e}function zr(i){var e=ps(i);if(i.equals(e)||(me?.is_fork||(i.v=e),i.wv=jr()),!Pi)if(lt!==null)(zi()||me?.is_fork)&&lt.set(i,e);else{var t=(i.f&mt)===0?Tt:Xe;Fe(i,t)}}let Qn=new Set;const Wt=new Map;let Kr=!1;function si(i,e){var t={f:0,v:i,reactions:null,equals:Dr,rv:0,wv:0};return t}function K(i,e){const t=si(i);return Ur(t),t}function ms(i,e=!1,t=!0){const n=si(i);return e||(n.equals=Pr),tn&&t&&ge!==null&&ge.l!==null&&(ge.l.s??=[]).push(n),n}function $(i,e,t=!1){Q!==null&&(!It||(Q.f&Rs)!==0)&&nn()&&(Q.f&(Ze|Ot|fs|Rs))!==0&&!At?.includes(i)&&go();let n=t?ot(e):e;return xi(i,n)}function xi(i,e){if(!i.equals(e)){var t=i.v;Pi?Wt.set(i,e):Wt.set(i,t),i.v=e;var n=Et.ensure();n.capture(i,t),(i.f&Ze)!==0&&((i.f&tt)!==0&&ps(i),Fe(i,(i.f&mt)!==0?Xe:Tt)),i.wv=jr(),Gr(i,tt),nn()&&ne!==null&&(ne.f&Xe)!==0&&(ne.f&(Lt|oi))===0&&(rt===null?Wo([i]):rt.push(i)),!n.is_fork&&Qn.size>0&&!Kr&&Yo()}return e}function Yo(){Kr=!1;var i=Bt;_n(!0);const e=Array.from(Qn);try{for(const t of e)(t.f&Xe)!==0&&Fe(t,Tt),Ai(t)&&Ei(t)}finally{_n(i)}Qn.clear()}function Fi(i){$(i,i.v+1)}function Gr(i,e){var t=i.reactions;if(t!==null)for(var n=nn(),s=t.length,r=0;r<s;r++){var a=t[r],l=a.f;if(!(!n&&a===ne)){var o=(l&tt)===0;if(o&&Fe(a,e),(l&Ze)!==0){var d=a;lt?.delete(d),(l&ii)===0&&(l&mt&&(a.f|=ii),Gr(d,Tt))}else o&&((l&Ot)!==0&&Pt!==null&&Pt.add(a),ni(a))}}}function vs(i){var e=Q,t=ne;Qe(null),Ct(null);try{return i()}finally{Qe(e),Ct(t)}}let Bt=!1;function _n(i){Bt=i}let Pi=!1;function Ns(i){Pi=i}let Q=null,It=!1;function Qe(i){Q=i}let ne=null;function Ct(i){ne=i}let At=null;function Ur(i){Q!==null&&(At===null?At=[i]:At.push(i))}let je=null,it=0,rt=null;function Wo(i){rt=i}let Vr=1,Bi=0,Qt=Bi;function Zs(i){Qt=i}function jr(){return++Vr}function Ai(i){var e=i.f;if((e&tt)!==0)return!0;if(e&Ze&&(i.f&=~ii),(e&Tt)!==0){var t=i.deps;if(t!==null)for(var n=t.length,s=0;s<n;s++){var r=t[s];if(Ai(r)&&zr(r),r.wv>i.wv)return!0}(e&mt)!==0&&lt===null&&Fe(i,Xe)}return!1}function qr(i,e,t=!0){var n=i.reactions;if(n!==null&&!At?.includes(i))for(var s=0;s<n.length;s++){var r=n[s];(r.f&Ze)!==0?qr(r,e,!1):e===r&&(t?Fe(r,tt):(r.f&Xe)!==0&&Fe(r,Tt),ni(r))}}function Jr(i){var e=je,t=it,n=rt,s=Q,r=At,a=ge,l=It,o=Qt,d=i.f;je=null,it=0,rt=null,Q=(d&(Lt|oi))===0?i:null,At=null,wi(i.ctx),It=!1,Qt=++Bi,i.ac!==null&&(vs(()=>{i.ac.abort(gi)}),i.ac=null);try{i.f|=qn;var u=i.fn,h=u(),f=i.deps;if(je!==null){var g;if(yn(i,it),f!==null&&it>0)for(f.length=it+je.length,g=0;g<je.length;g++)f[it+g]=je[g];else i.deps=f=je;if(Bt&&zi()&&(i.f&mt)!==0)for(g=it;g<f.length;g++)(f[g].reactions??=[]).push(i)}else f!==null&&it<f.length&&(yn(i,it),f.length=it);if(nn()&&rt!==null&&!It&&f!==null&&(i.f&(Ze|Tt|tt))===0)for(g=0;g<rt.length;g++)qr(rt[g],i);return s!==null&&s!==i&&(Bi++,rt!==null&&(n===null?n=rt:n.push(...rt))),(i.f&Zt)!==0&&(i.f^=Zt),h}catch(v){return Nr(v)}finally{i.f^=qn,je=e,it=t,rt=n,Q=s,At=r,wi(a),It=l,Qt=o}}function Bo(i,e){let t=e.reactions;if(t!==null){var n=eo.call(t,i);if(n!==-1){var s=t.length-1;s===0?t=e.reactions=null:(t[n]=t[s],t.pop())}}t===null&&(e.f&Ze)!==0&&(je===null||!je.includes(e))&&(Fe(e,Tt),(e.f&mt)!==0&&(e.f^=mt,e.f&=~ii),Br(e),yn(e,0))}function yn(i,e){var t=i.deps;if(t!==null)for(var n=e;n<t.length;n++)Bo(i,t[n])}function Ei(i){var e=i.f;if((e&Nt)===0){Fe(i,Xe);var t=ne,n=Bt;ne=i,Bt=!0;try{(e&(Ot|so))!==0?Qo(i):sa(i),na(i);var s=Jr(i);i.teardown=typeof s=="function"?s:null,i.wv=Vr;var r;jn&&mo&&(i.f&tt)!==0&&i.deps}finally{Bt=n,ne=t}}}function c(i){var e=i.f,t=(e&Ze)!==0;if(Q!==null&&!It){var n=ne!==null&&(ne.f&Nt)!==0;if(!n&&!At?.includes(i)){var s=Q.deps;if((Q.f&qn)!==0)i.rv<Bi&&(i.rv=Bi,je===null&&s!==null&&s[it]===i?it++:je===null?je=[i]:je.includes(i)||je.push(i));else{(Q.deps??=[]).push(i);var r=i.reactions;r===null?i.reactions=[Q]:r.includes(Q)||r.push(Q)}}}if(Pi){if(Wt.has(i))return Wt.get(i);if(t){var a=i,l=a.v;return((a.f&Xe)===0&&a.reactions!==null||ea(a))&&(l=ps(a)),Wt.set(a,l),l}}else t&&(!lt?.has(i)||me?.is_fork&&!zi())&&(a=i,Ai(a)&&zr(a),Bt&&zi()&&(a.f&mt)===0&&Qr(a));if(lt?.has(i))return lt.get(i);if((i.f&Zt)!==0)throw i.v;return i.v}function Qr(i){if(i.deps!==null){i.f^=mt;for(const e of i.deps)(e.reactions??=[]).push(i),(e.f&Ze)!==0&&(e.f&mt)===0&&Qr(e)}}function ea(i){if(i.v===We)return!0;if(i.deps===null)return!1;for(const e of i.deps)if(Wt.has(e)||(e.f&Ze)!==0&&ea(e))return!0;return!1}function zt(i){var e=It;try{return It=!0,i()}finally{It=e}}const zo=-7169;function Fe(i,e){i.f=i.f&zo|e}function Ko(i){if(!(typeof i!="object"||!i||i instanceof EventTarget)){if(Yt in i)es(i);else if(!Array.isArray(i))for(let e in i){const t=i[e];typeof t=="object"&&t&&Yt in t&&es(t)}}}function es(i,e=new Set){if(typeof i=="object"&&i!==null&&!(i instanceof EventTarget)&&!e.has(i)){e.add(i),i instanceof Date&&i.getTime();for(let n in i)try{es(i[n],e)}catch{}const t=ds(i);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const n=xr(t);for(let s in n){const r=n[s].get;if(r)try{r.call(i)}catch{}}}}}function ta(i){ne===null&&(Q===null&&co(),lo()),Pi&&oo()}function Go(i,e){var t=e.last;t===null?e.last=e.first=i:(t.next=i,i.prev=t,e.last=i)}function Dt(i,e,t){var n=ne;n!==null&&(n.f&st)!==0&&(i|=st);var s={ctx:ge,deps:null,nodes_start:null,nodes_end:null,f:i|tt|mt,first:null,fn:e,last:null,next:null,parent:n,b:n&&n.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(t)try{Ei(s),s.f|=hs}catch(l){throw et(s),l}else e!==null&&ni(s);var r=s;if(t&&r.deps===null&&r.teardown===null&&r.nodes_start===null&&r.first===r.last&&(r.f&Di)===0&&(r=r.first,(i&Ot)!==0&&(i&ti)!==0&&r!==null&&(r.f|=ti)),r!==null&&(r.parent=n,n!==null&&Go(r,n),Q!==null&&(Q.f&Ze)!==0&&(i&oi)===0)){var a=Q;(a.effects??=[]).push(r)}return s}function zi(){return Q!==null&&!It}function Dn(i){const e=Dt(In,null,!1);return Fe(e,Xe),e.teardown=i,e}function Ne(i){ta();var e=ne.f,t=!Q&&(e&Lt)!==0&&(e&hs)===0;if(t){var n=ge;(n.e??=[]).push(i)}else return ia(i)}function ia(i){return Dt(us|Tr,i,!1)}function Uo(i){return ta(),Dt(In|Tr,i,!0)}function Vo(i){Et.ensure();const e=Dt(oi|Di,i,!0);return(t={})=>new Promise(n=>{t.outro?vi(e,()=>{et(e),n(void 0)}):(et(e),n(void 0))})}function jo(i){return Dt(us,i,!1)}function Ys(i,e){var t=ge,n={effect:null,ran:!1,deps:i};t.l.$.push(n),n.effect=kn(()=>{i(),!n.ran&&(n.ran=!0,zt(e))})}function qo(){var i=ge;kn(()=>{for(var e of i.l.$){e.deps();var t=e.effect;(t.f&Xe)!==0&&Fe(t,Tt),Ai(t)&&Ei(t),e.ran=!1}})}function Jo(i){return Dt(fs|Di,i,!0)}function kn(i,e=0){return Dt(In|e,i,!0)}function G(i,e=[],t=[],n=[]){Xo(n,e,t,s=>{Dt(In,()=>i(...s.map(c)),!0)})}function Pn(i,e=0){var t=Dt(Ot|e,i,!0);return t}function at(i){return Dt(Lt|Di,i,!0)}function na(i){var e=i.teardown;if(e!==null){const t=Pi,n=Q;Ns(!0),Qe(null);try{e.call(null)}finally{Ns(t),Qe(n)}}}function sa(i,e=!1){var t=i.first;for(i.first=i.last=null;t!==null;){const s=t.ac;s!==null&&vs(()=>{s.abort(gi)});var n=t.next;(t.f&oi)!==0?t.parent=null:et(t,e),t=n}}function Qo(i){for(var e=i.first;e!==null;){var t=e.next;(e.f&Lt)===0&&et(e),e=t}}function et(i,e=!0){var t=!1;(e||(i.f&Cr)!==0)&&i.nodes_start!==null&&i.nodes_end!==null&&(el(i.nodes_start,i.nodes_end),t=!0),sa(i,e&&!t),yn(i,0),Fe(i,Nt);var n=i.transitions;if(n!==null)for(const r of n)r.stop();na(i);var s=i.parent;s!==null&&s.first!==null&&ra(i),i.next=i.prev=i.teardown=i.ctx=i.deps=i.fn=i.nodes_start=i.nodes_end=i.ac=null}function el(i,e){for(;i!==null;){var t=i===e?null:sn(i);i.remove(),i=t}}function ra(i){var e=i.parent,t=i.prev,n=i.next;t!==null&&(t.next=n),n!==null&&(n.prev=t),e!==null&&(e.first===i&&(e.first=n),e.last===i&&(e.last=t))}function vi(i,e,t=!0){var n=[];_s(i,n,!0),aa(n,()=>{t&&et(i),e&&e()})}function aa(i,e){var t=i.length;if(t>0){var n=()=>--t||e();for(var s of i)s.out(n)}else e()}function _s(i,e,t){if((i.f&st)===0){if(i.f^=st,i.transitions!==null)for(const a of i.transitions)(a.is_global||t)&&e.push(a);for(var n=i.first;n!==null;){var s=n.next,r=(n.f&ti)!==0||(n.f&Lt)!==0&&(i.f&Ot)!==0;_s(n,e,r?t:!1),n=s}}}function ys(i){oa(i,!0)}function oa(i,e){if((i.f&st)!==0){i.f^=st,(i.f&Xe)===0&&(Fe(i,tt),ni(i));for(var t=i.first;t!==null;){var n=t.next,s=(t.f&ti)!==0||(t.f&Lt)!==0;oa(t,s?e:!1),t=n}if(i.transitions!==null)for(const r of i.transitions)(r.is_global||e)&&r.in()}}function la(i,e){for(var t=i.nodes_start,n=i.nodes_end;t!==null;){var s=t===n?null:sn(t);e.append(t),t=s}}const tl=["touchstart","touchmove"];function il(i){return tl.includes(i)}const ca=new Set,ts=new Set;function nl(i,e,t,n={}){function s(r){if(n.capture||Li.call(e,r),!r.cancelBubble)return vs(()=>t?.call(this,r))}return i.startsWith("pointer")||i.startsWith("touch")||i==="wheel"?ki(()=>{e.addEventListener(i,s,n)}):e.addEventListener(i,s,n),s}function ct(i,e,t,n,s){var r={capture:n,passive:s},a=nl(i,e,t,r);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&Dn(()=>{e.removeEventListener(i,a,r)})}function vt(i){for(var e=0;e<i.length;e++)ca.add(i[e]);for(var t of ts)t(i)}let Ws=null;function Li(i){var e=this,t=e.ownerDocument,n=i.type,s=i.composedPath?.()||[],r=s[0]||i.target;Ws=i;var a=0,l=Ws===i&&i.__root;if(l){var o=s.indexOf(l);if(o!==-1&&(e===document||e===window)){i.__root=e;return}var d=s.indexOf(e);if(d===-1)return;o<=d&&(a=o)}if(r=s[a]||i.target,r!==e){Sr(i,"currentTarget",{configurable:!0,get(){return r||t}});var u=Q,h=ne;Qe(null),Ct(null);try{for(var f,g=[];r!==null;){var v=r.assignedSlot||r.parentNode||r.host||null;try{var S=r["__"+n];S!=null&&(!r.disabled||i.target===r)&&S.call(r,i)}catch(y){f?g.push(y):f=y}if(i.cancelBubble||v===e||v===null)break;r=v}if(f){for(let y of g)queueMicrotask(()=>{throw y});throw f}}finally{i.__root=e,delete i.currentTarget,Qe(u),Ct(h)}}}function sl(i){var e=document.createElement("template");return e.innerHTML=i.replaceAll("<!>","<!---->"),e.content}function bn(i,e){var t=ne;t.nodes_start===null&&(t.nodes_start=i,t.nodes_end=e)}function H(i,e){var t=(e&bo)!==0,n=(e&wo)!==0,s,r=!i.startsWith("<!>");return()=>{s===void 0&&(s=sl(r?i:"<!>"+i),t||(s=mn(s)));var a=n||Rr?document.importNode(s,!0):s.cloneNode(!0);if(t){var l=mn(a),o=a.lastChild;bn(l,o)}else bn(a,a);return a}}function ae(i=""){{var e=$t(i+"");return bn(e,e),e}}function Oe(){var i=document.createDocumentFragment(),e=document.createComment(""),t=$t();return i.append(e,t),bn(e,t),i}function E(i,e){i!==null&&i.before(e)}function De(i,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(i.__t??=i.nodeValue)&&(i.__t=t,i.nodeValue=t+"")}function rl(i,e){return al(i,e)}const ci=new Map;function al(i,{target:e,anchor:t,props:n={},events:s,context:r,intro:a=!0}){To();var l=new Set,o=h=>{for(var f=0;f<h.length;f++){var g=h[f];if(!l.has(g)){l.add(g);var v=il(g);e.addEventListener(g,Li,{passive:v});var S=ci.get(g);S===void 0?(document.addEventListener(g,Li,{passive:v}),ci.set(g,1)):ci.set(g,S+1)}}};o(cs(ca)),ts.add(o);var d=void 0,u=Vo(()=>{var h=t??e.appendChild($t());return $o(h,{pending:()=>{}},f=>{if(r){Ee({});var g=ge;g.c=r}s&&(n.$$events=s),d=i(f,n)||{},r&&Ie()}),()=>{for(var f of l){e.removeEventListener(f,Li);var g=ci.get(f);--g===0?(document.removeEventListener(f,Li),ci.delete(f)):ci.set(f,g)}ts.delete(o),h!==t&&h.parentNode?.removeChild(h)}});return ol.set(d,u),d}let ol=new WeakMap;class da{anchor;#e=new Map;#t=new Map;#n=new Map;#i=new Set;#l=!0;constructor(e,t=!0){this.anchor=e,this.#l=t}#r=()=>{var e=me;if(this.#e.has(e)){var t=this.#e.get(e),n=this.#t.get(t);if(n)ys(n),this.#i.delete(t);else{var s=this.#n.get(t);s&&(this.#t.set(t,s.effect),this.#n.delete(t),s.fragment.lastChild.remove(),this.anchor.before(s.fragment),n=s.effect)}for(const[r,a]of this.#e){if(this.#e.delete(r),r===e)break;const l=this.#n.get(a);l&&(et(l.effect),this.#n.delete(a))}for(const[r,a]of this.#t){if(r===t||this.#i.has(r))continue;const l=()=>{if(Array.from(this.#e.values()).includes(r)){var d=document.createDocumentFragment();la(a,d),d.append($t()),this.#n.set(r,{effect:a,fragment:d})}else et(a);this.#i.delete(r),this.#t.delete(r)};this.#l||!n?(this.#i.add(r),vi(a,l,!1)):l()}}};#s=e=>{this.#e.delete(e);const t=Array.from(this.#e.values());for(const[n,s]of this.#n)t.includes(n)||(et(s.effect),this.#n.delete(n))};ensure(e,t){var n=me,s=Fr();if(t&&!this.#t.has(e)&&!this.#n.has(e))if(s){var r=document.createDocumentFragment(),a=$t();r.append(a),this.#n.set(e,{effect:at(()=>t(a)),fragment:r})}else this.#t.set(e,at(()=>t(this.anchor)));if(this.#e.set(n,e),s){for(const[l,o]of this.#t)l===e?n.skipped_effects.delete(o):n.skipped_effects.add(o);for(const[l,o]of this.#n)l===e?n.skipped_effects.delete(o.effect):n.skipped_effects.add(o.effect);n.oncommit(this.#r),n.ondiscard(this.#s)}else this.#r()}}function j(i,e,t=!1){var n=new da(i),s=t?ti:0;function r(a,l){n.ensure(a,l)}Pn(()=>{var a=!1;e((l,o=!0)=>{a=!0,r(o,l)}),a||r(!1,null)},s)}function Ii(i,e,...t){var n=new da(i);Pn(()=>{const s=e()??null;n.ensure(s,s&&(r=>s(r,...t)))},ti)}const Bs=[...` 	
\r\fÂ \v\uFEFF`];function ll(i,e,t){var n=i==null?"":""+i;if(e&&(n=n?n+" "+e:e),t){for(var s in t)if(t[s])n=n?n+" "+s:s;else if(n.length)for(var r=s.length,a=0;(a=n.indexOf(s,a))>=0;){var l=a+r;(a===0||Bs.includes(n[a-1]))&&(l===n.length||Bs.includes(n[l]))?n=(a===0?"":n.substring(0,a))+n.substring(l+1):a=l}}return n===""?null:n}function zs(i,e=!1){var t=e?" !important;":";",n="";for(var s in i){var r=i[s];r!=null&&r!==""&&(n+=" "+s+": "+r+t)}return n}function Xn(i){return i[0]!=="-"||i[1]!=="-"?i.toLowerCase():i}function cl(i,e){if(e){var t="",n,s;if(Array.isArray(e)?(n=e[0],s=e[1]):n=e,i){i=String(i).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var r=!1,a=0,l=!1,o=[];n&&o.push(...Object.keys(n).map(Xn)),s&&o.push(...Object.keys(s).map(Xn));var d=0,u=-1;const S=i.length;for(var h=0;h<S;h++){var f=i[h];if(l?f==="/"&&i[h-1]==="*"&&(l=!1):r?r===f&&(r=!1):f==="/"&&i[h+1]==="*"?l=!0:f==='"'||f==="'"?r=f:f==="("?a++:f===")"&&a--,!l&&r===!1&&a===0){if(f===":"&&u===-1)u=h;else if(f===";"||h===S-1){if(u!==-1){var g=Xn(i.substring(d,u).trim());if(!o.includes(g)){f!==";"&&h++;var v=i.substring(d,h).trim();t+=" "+v+";"}}d=h+1,u=-1}}}}return n&&(t+=zs(n)),s&&(t+=zs(s,!0)),t=t.trim(),t===""?null:t}return i==null?null:String(i)}function Pe(i,e,t,n,s,r){var a=i.__className;if(a!==t||a===void 0){var l=ll(t,n,r);l==null?i.removeAttribute("class"):i.className=l,i.__className=t}else if(r&&s!==r)for(var o in r){var d=!!r[o];(s==null||d!==!!s[o])&&i.classList.toggle(o,d)}return r}function Fn(i,e={},t,n){for(var s in t){var r=t[s];e[s]!==r&&(t[s]==null?i.style.removeProperty(s):i.style.setProperty(s,r,n))}}function ke(i,e,t,n){var s=i.__style;if(s!==e){var r=cl(e,n);r==null?i.removeAttribute("style"):i.style.cssText=r,i.__style=e}else n&&(Array.isArray(n)?(Fn(i,t?.[0],n[0]),Fn(i,t?.[1],n[1],"important")):Fn(i,t,n));return n}function ua(i,e,t=!1){if(i.multiple){if(e==null)return;if(!ls(e))return Eo();for(var n of i.options)n.selected=e.includes(Ks(n));return}for(n of i.options){var s=Ks(n);if(Co(s,e)){n.selected=!0;return}}(!t||e!==void 0)&&(i.selectedIndex=-1)}function dl(i){var e=new MutationObserver(()=>{ua(i,i.__value)});e.observe(i,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Dn(()=>{e.disconnect()})}function Ks(i){return"__value"in i?i.__value:i.value}const ul=Symbol("is custom element"),hl=Symbol("is html");function Ki(i,e){var t=ha(i);t.value===(t.value=e??void 0)||i.value===e&&(e!==0||i.nodeName!=="PROGRESS")||(i.value=e??"")}function V(i,e,t,n){var s=ha(i);s[e]!==(s[e]=t)&&(e==="loading"&&(i[ro]=t),t==null?i.removeAttribute(e):typeof t!="string"&&fl(i).includes(e)?i[e]=t:i.setAttribute(e,t))}function ha(i){return i.__attributes??={[ul]:i.nodeName.includes("-"),[hl]:i.namespaceURI===So}}var Gs=new Map;function fl(i){var e=i.getAttribute("is")||i.nodeName,t=Gs.get(e);if(t)return t;Gs.set(e,t=[]);for(var n,s=i,r=Element.prototype;r!==s;){n=xr(s);for(var a in n)n[a].set&&t.push(a);s=ds(s)}return t}function Us(i,e){return i===e||i?.[Yt]===e}function ri(i={},e,t,n){return jo(()=>{var s,r;return kn(()=>{s=r,r=[],zt(()=>{i!==t(...r)&&(e(i,...r),s&&Us(t(...s),i)&&e(null,...s))})}),()=>{ki(()=>{r&&Us(t(...r),i)&&e(null,...r)})}}),i}function fa(i=!1){const e=ge,t=e.l.u;if(!t)return;let n=()=>Ko(e.s);if(i){let s=0,r={};const a=Tn(()=>{let l=!1;const o=e.s;for(const d in o)o[d]!==r[d]&&(r[d]=o[d],l=!0);return l&&s++,s});n=()=>c(a)}t.b.length&&Uo(()=>{Vs(e,n),pn(t.b)}),Ne(()=>{const s=zt(()=>t.m.map(no));return()=>{for(const r of s)typeof r=="function"&&r()}}),t.a.length&&Ne(()=>{Vs(e,n),pn(t.a)})}function Vs(i,e){if(i.l.s)for(const t of i.l.s)c(t);e()}let is=Symbol();function L(i,e,t){const n=t[e]??={store:null,source:ms(void 0),unsubscribe:ft};if(n.store!==i&&!(is in t))if(n.unsubscribe(),n.store=i??null,i==null)n.source.v=void 0,n.unsubscribe=ft;else{var s=!0;n.unsubscribe=bs(i,r=>{s?n.source.v=r:$(n.source,r)}),s=!1}return i&&is in t?ut(i):c(n.source)}function Ye(){const i={};function e(){Dn(()=>{for(var t in i)i[t].unsubscribe();Sr(i,is,{enumerable:!1,value:!0})})}return[i,e]}function ce(i,e,t,n){var s=n,r=!0,a=()=>(r&&(r=!1,s=n),s),l;l=i[e],l===void 0&&n!==void 0&&(l=a());var o;return o=()=>{var d=i[e];return d===void 0?a():(r=!0,d)},o}function rn(i){ge===null&&Ar(),tn&&ge.l!==null?pl(ge).m.push(i):Ne(()=>{const e=zt(i);if(typeof e=="function")return e})}function gl(i){ge===null&&Ar(),rn(()=>()=>zt(i))}function pl(i){var e=i.l;return e.u??={a:[],b:[],m:[]}}function bs(i,e,t){if(i==null)return e(void 0),t&&t(void 0),ft;const n=zt(()=>i.subscribe(e,t));return n.unsubscribe?()=>n.unsubscribe():n}const di=[];function ml(i,e){return{subscribe:ee(i,e).subscribe}}function ee(i,e=ft){let t=null;const n=new Set;function s(l){if(kr(i,l)&&(i=l,t)){const o=!di.length;for(const d of n)d[1](),di.push(d,i);if(o){for(let d=0;d<di.length;d+=2)di[d][0](di[d+1]);di.length=0}}}function r(l){s(l(i))}function a(l,o=ft){const d=[l,o];return n.add(d),n.size===1&&(t=e(s,r)||ft),l(i),()=>{n.delete(d),n.size===0&&t&&(t(),t=null)}}return{set:s,update:r,subscribe:a}}function Le(i,e,t){const n=!Array.isArray(i),s=n?[i]:i;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const r=e.length<2;return ml(t,(a,l)=>{let o=!1;const d=[];let u=0,h=ft;const f=()=>{if(u)return;h();const v=e(n?d[0]:d,a,l);r?a(v):h=typeof v=="function"?v:ft},g=s.map((v,S)=>bs(v,y=>{d[S]=y,u&=~(1<<S),o&&f()},()=>{u|=1<<S}));return o=!0,f(),function(){pn(g),h(),o=!1}})}function ut(i){let e;return bs(i,t=>e=t)(),e}function vl(){return`zone_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const ns=["#e74c3c","#e67e22","#f1c40f","#2ecc71","#1abc9c","#3498db","#9b59b6","#e91e8f"];function _l(){return ns[Math.floor(Math.random()*ns.length)]}function yl(i,e=300){return{id:vl(),x:i,width:e,color:_l(),texts:[{language:"cs",title:"",content:""}]}}function bl(i,e){const t=i.texts.find(n=>n.language===e);return t||i.texts[0]||null}const Gi=ee("cs"),wl=ee("orange"),ga=ee("Forest"),pa=ee(!1),ss=ee(!1),Ri=ee(!1),ma=ee(!1),va=ee(!1),_a=ee(null),Sl=Le([_a,Gi],([i,e])=>i?bl(i,e):null);function Nn(i){_a.set(i)}const ya=ee({x:0,y:0});function xl(i,e){ya.set({x:i,y:e})}const ba=ee({scrollX:0,scrollY:0,zoom:1});function El(i,e,t=1){ba.set({scrollX:i,scrollY:e,zoom:t})}const rs=ee(!1);function wa(){rs.set(!0),setTimeout(()=>rs.set(!1),150)}const ze={BACKGROUND_BASE:-100,BACKGROUND_LAYER_START:-99,GROUND_REFERENCE:-1,ITEMS_BEHIND:5,PLAYER:10,ITEMS_FRONT:15,SELECTION_GRAPHICS:999,GRID_OVERLAY:1e3};function ws(i){return i==="behind"?ze.ITEMS_BEHIND:ze.ITEMS_FRONT}const Ci={FRAME_HEIGHT:48,SCALE:5,DEPTH:ze.PLAYER},Il={HALF_HEIGHT:Ci.FRAME_HEIGHT*Ci.SCALE/2},Ti=40;function Cl(i){return i-Ti}function Ui(i){return Cl(i)-Il.HALF_HEIGHT}function Tl(i,e){const t=Ui(e);return Math.min(i,t)}function Dl(i,e){const t=Ui(e);return i>t}const kt=["orange","white"];class kl{currentSkin=kt[0];currentIndex=0;setSkin(e){kt.includes(e)&&(this.currentSkin=e,this.currentIndex=kt.indexOf(e),localStorage.setItem("catSkin",e))}getSkin(){const e=localStorage.getItem("catSkin");return e&&kt.includes(e)&&(this.currentSkin=e,this.currentIndex=kt.indexOf(e)),this.currentSkin}toggleSkin(){return this.currentIndex=(this.currentIndex+1)%kt.length,this.currentSkin=kt[this.currentIndex],this.setSkin(this.currentSkin),this.currentSkin}getAllSkins(){return kt}}const Sa=new kl,Pl={FAST_VELOCITY_THRESHOLD:100,ROTATION_FULL:15,ROTATION_SLIGHT:8};class Al{scene;currentSkin;constructor(e,t="white"){this.scene=e,this.currentSkin=t}createAll(){Sa.getAllSkins().forEach(t=>{this.createAnimationsForSkin(t)})}createAnimationsForSkin(e){const t=this.scene;t.anims.exists(`cat-idle-${e}`)||t.anims.create({key:`cat-idle-${e}`,frames:t.anims.generateFrameNumbers(`cat-idle-${e}`,{start:0,end:3}),frameRate:6,repeat:-1}),t.anims.exists(`cat-walk-${e}`)||t.anims.create({key:`cat-walk-${e}`,frames:t.anims.generateFrameNumbers(`cat-walk-${e}`,{start:0,end:5}),frameRate:12,repeat:-1}),[{key:`cat-jump-up-${e}`,frame:2},{key:`cat-jump-peak-up-${e}`,frame:3},{key:`cat-jump-peak-down-${e}`,frame:3},{key:`cat-jump-down-${e}`,frame:4}].forEach(({key:s,frame:r})=>{t.anims.exists(s)||t.anims.create({key:s,frames:[{key:`cat-walk-${e}`,frame:r}],frameRate:1,repeat:0})})}getSkin(){return this.currentSkin}setSkin(e){this.currentSkin=e}getAnimationKey(e){return`cat-${e}-${this.currentSkin}`}play(e,t){const n=this.getAnimationKey(t);e.anims.currentAnim?.key!==n&&e.play(n)}getJumpAnimationState(e){const{FAST_VELOCITY_THRESHOLD:t,ROTATION_FULL:n,ROTATION_SLIGHT:s}=Pl;return e<-t?{animation:this.getAnimationKey("jump-up"),rotation:n,flipMultiplier:1}:e<-20?{animation:this.getAnimationKey("jump-peak-up"),rotation:s,flipMultiplier:1}:e<=t?{animation:this.getAnimationKey("jump-peak-down"),rotation:s,flipMultiplier:-1}:{animation:this.getAnimationKey("jump-down"),rotation:n,flipMultiplier:-1}}handleSkinChange(e,t){const n=this.currentSkin;this.currentSkin=t;const s=e.anims.currentAnim?.key;if(s){const a=`cat-${s.replace("cat-","").replace(`-${n}`,"")}-${t}`;this.scene.anims.exists(a)&&e.play(a)}}}let xa=!1,hi=!1;function on(i){xa=i}function js(){return xa}function ai(){return hi}function Zn(i){if(!i||i.tagName==="CANVAS")return!1;if(i.closest("[data-ui]"))return!0;const e=document.getElementById("game-ui");return!!(e&&e.contains(i)||i.closest("button"))}function Ml(){document.addEventListener("pointerdown",i=>{hi=Zn(i.target)},{capture:!0}),document.addEventListener("pointermove",i=>{i.buttons>0||(hi=Zn(i.target))},{capture:!0}),document.addEventListener("pointerup",()=>{setTimeout(()=>{hi=!1},10)},{capture:!0}),document.addEventListener("touchstart",i=>{hi=Zn(i.target)},{capture:!0,passive:!0}),document.addEventListener("touchend",()=>{setTimeout(()=>{hi=!1},10)},{capture:!0,passive:!0})}function _i(){const i=document.activeElement;if(!i)return!1;const e=i.tagName.toUpperCase();return e==="INPUT"||e==="TEXTAREA"||i.getAttribute("contenteditable")==="true"}function jt(i,e,t){const n=(i-t.worldView.x)*t.zoom,s=(e-t.worldView.y)*t.zoom;return{screenX:n,screenY:s}}function $l(i,e,t){const n=i/t.zoom+t.worldView.x,s=e/t.zoom+t.worldView.y;return{worldX:n,worldY:s}}const Vt={THRESHOLD_X:20,LANGUAGE_BUTTON:{width:120,height:60},SKIN_BUTTON:{width:120,height:60,yOffset:60}},qs={SPEED:350,JUMP_STRENGTH:-500};class Ol{scene;getPlayerPosition;keyUp;keyLeft;keyRight;keyA;keyD;keyW;keySpace;touchLeft=!1;touchRight=!1;touchJump=!1;touchHandlers;constructor(e){this.scene=e.scene,this.getPlayerPosition=e.getPlayerPosition,this.setupKeyboardControls(),this.setupTouchControls()}setupKeyboardControls(){this.scene.input.keyboard&&(this.keyUp=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.UP,!1),this.keyLeft=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.LEFT,!1),this.keyRight=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.RIGHT,!1),this.keyA=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.A,!1),this.keyD=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.D,!1),this.keyW=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.W,!1),this.keySpace=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.SPACE,!1))}setupTouchControls(){const e=this.scene,t=a=>{if(ut(rs)){this.touchLeft=!1,this.touchRight=!1,this.touchJump=!1;return}const l=a.x,o=a.y,d=e.scale.width;if(l>d-Vt.LANGUAGE_BUTTON.width&&o<Vt.LANGUAGE_BUTTON.height||l>d-Vt.SKIN_BUTTON.width&&o>=Vt.SKIN_BUTTON.yOffset&&o<Vt.SKIN_BUTTON.yOffset+Vt.SKIN_BUTTON.height)return;const u=e.cameras.main,h=this.getPlayerPosition(),f=h.x-u.scrollX,g=h.y-u.scrollY,v=l-f,S=o-g;v<-20?(this.touchLeft=!0,this.touchRight=!1):v>Vt.THRESHOLD_X?(this.touchRight=!0,this.touchLeft=!1):(this.touchLeft=!1,this.touchRight=!1),this.touchJump=S<-80},n=a=>{ai()||t(a)},s=a=>{ai()||a.isDown&&t(a)},r=()=>{this.touchLeft=!1,this.touchRight=!1,this.touchJump=!1};e.input.on("pointerdown",n),e.input.on("pointermove",s),e.input.on("pointerup",r),this.touchHandlers={pointerdown:n,pointermove:s,pointerup:r}}getInputState(){const e=this.keyA?.isDown||this.keyLeft?.isDown||this.touchLeft||!1,t=this.keyD?.isDown||this.keyRight?.isDown||this.touchRight||!1,n=this.keySpace?.isDown||this.keyW?.isDown||this.keyUp?.isDown||this.touchJump||!1;return{left:e,right:t,jump:n}}hasAnyInput(){const e=this.getInputState();return e.left||e.right||e.jump}destroy(){this.touchHandlers&&(this.scene.input.off("pointerdown",this.touchHandlers.pointerdown),this.scene.input.off("pointermove",this.touchHandlers.pointermove),this.scene.input.off("pointerup",this.touchHandlers.pointerup),this.touchHandlers=void 0)}}class Ll extends N.Physics.Arcade.Sprite{animations;inputController;animState="idle";hasNotifiedMovement=!1;hasReceivedInput=!1;constructor(e,t,n){const s="white";super(e,t,n,`cat-idle-${s}`),e.add.existing(this),e.physics.add.existing(this),this.animations=new Al(e,s),this.animations.createAll(),this.inputController=new Ol({scene:e,getPlayerPosition:()=>({x:this.x,y:this.y})}),this.setCollideWorldBounds(!0),this.setBounce(0),this.setSize(16,12),this.setOffset(16,36),this.setScale(Ci.SCALE),this.setDepth(Ci.DEPTH),this.animations.play(this,"idle")}changeSkin(e){this.animations.handleSkinChange(this,e)}updateJumpAnimation(e){const{animation:t,rotation:n,flipMultiplier:s}=this.animations.getJumpAnimationState(e);this.anims.currentAnim?.key!==t&&this.play(t);const r=this.flipX?n*s:-n*s;this.setAngle(r)}update(){const e=this.inputController.getInputState(),t=this.body,n=t&&(t.blocked.down||t.touching.down);switch(this.inputController.hasAnyInput()&&!this.hasReceivedInput&&(this.hasReceivedInput=!0),this.hasReceivedInput&&this.inputController.hasAnyInput()&&!this.hasNotifiedMovement&&(this.hasNotifiedMovement=!0,va.set(!0)),e.left?(this.setVelocityX(-350),this.setFlipX(!0),n&&(this.animState="running")):e.right?(this.setVelocityX(qs.SPEED),this.setFlipX(!1),n&&(this.animState="running")):(this.setVelocityX(0),n&&(this.animState="idle")),e.jump&&n&&(this.setVelocityY(qs.JUMP_STRENGTH),this.animState="jumping"),!n&&t&&t.velocity.y!==0&&(this.animState="jumping"),this.animState){case"idle":this.animations.play(this,"idle"),this.setAngle(0);break;case"running":this.animations.play(this,"walk"),this.setAngle(0);break;case"jumping":this.updateJumpAnimation(t.velocity.y);break}}destroy(e){this.inputController.destroy(),super.destroy(e)}}const bt=[{name:"FOREST GREEN",folder:"forest_green",scrollFactors:[1,.8,.85,.9,.95]},{name:"FOREST BLUE",folder:"forest_blue",scrollFactors:[1,.8,.85,.9,.95,1]}];class Rl{currentIndex=0;constructor(){const e=localStorage.getItem("background");if(e){const t=bt.findIndex(n=>n.folder===e);t!==-1&&(this.currentIndex=t)}}getBackground(){return bt[this.currentIndex].folder}getCurrentConfig(){return bt[this.currentIndex]}setBackground(e){const t=bt.findIndex(n=>n.folder===e);t!==-1&&(this.currentIndex=t,localStorage.setItem("background",e))}toggleBackground(){this.currentIndex=(this.currentIndex+1)%bt.length;const e=bt[this.currentIndex];return localStorage.setItem("background",e.folder),e}getAllBackgrounds(){return bt}setBackgroundByIndex(e){e>=0&&e<bt.length&&(this.currentIndex=e,localStorage.setItem("background",bt[e].folder))}getCurrentIndex(){return this.currentIndex}}const Vi=new Rl;function Ea(i,e){return new Promise(t=>{i.load.image(`bg0-${e.folder}`,`assets/backgrounds/${e.folder}/0.png`);for(let n=0;n<e.scrollFactors.length;n++){const s=n+1;i.load.image(`bg${s}-${e.folder}`,`assets/backgrounds/${e.folder}/${s}.png`)}i.load.once("complete",()=>{t(!0)}),i.load.once("loaderror",n=>{console.error(`Failed to load background asset: ${n.key}`),t(!1)}),i.load.start()})}function Ia(i,e,t,n){const s=Math.max(t,i.scale.height),r=i.add.tileSprite(0,0,e,s,`bg0-${n.folder}`);r.setOrigin(0,0),r.setScrollFactor(1),r.setDepth(ze.BACKGROUND_BASE),r.tilePositionX=0,r.tilePositionY=0;const a=[];for(let l=0;l<n.scrollFactors.length;l++){const d=`bg${l+1}-${n.folder}`;if(i.textures.exists(d)){const u=i.add.image(0,0,d);u.setOrigin(0,0),u.setScrollFactor(n.scrollFactors[l]),u.setDepth(ze.BACKGROUND_LAYER_START+l),u.setDisplaySize(e,t),a.push(u)}}return{baseLayer:r,bgLayers:a}}function Ca(i,e){i&&(i.tilePositionX=e.scrollX)}function Hl(i){i.bgLayers.forEach(e=>e.destroy()),i.baseLayer.destroy()}const Xl=[{code:"cs",label:"CZ"},{code:"en",label:"EN"}],Ta="cs",Fl={isActive:!1,config:null,selectedItemId:null,itemDepthLayer:"behind",editMode:"items",selectedDialogZoneId:null,selectedFrameId:null,selectedSocialId:null,isPlayerSelected:!1},z=ee(Fl),Da=Le(z,i=>i.isActive),Nl=Le(z,i=>i.config),wn=ee(!0);function Zl(){wn.update(i=>!i)}const Kt=ee(!1);function yi(i){Kt.set(i)}const as=ee(!1);function Yn(i){as.set(i)}const ei=ee(!1),qt=ee(!1),An=ee(!1),Jt=ee(!1),Mn=ee(!1);function Yl(){ei.update(i=>!i)}function Wl(){qt.update(i=>!i)}function ka(){An.set(!0)}function Bl(){An.set(!1)}function zl(){Jt.update(i=>!i)}function Pa(){Mn.set(!0)}function Kl(){Mn.set(!1)}const Ss=ee(Ta);function Gl(i){Ss.set(i)}const $n=Le(z,i=>i.selectedItemId),Aa=Le(z,i=>i.itemDepthLayer),Ke=Le(z,i=>i.editMode),On=Le(z,i=>i.selectedDialogZoneId),xs=Le(z,i=>i.config?.dialogZones||[]),ji=Le(z,i=>i.selectedFrameId),Wn=Le(z,i=>i.isPlayerSelected),Ma=Le(z,i=>i.config?.placedFrames||[]),qi=Le(z,i=>i.selectedSocialId),Ul=Le(z,i=>i.config?.placedSocials||[]),Vl=Le(z,i=>!i.selectedSocialId||!i.config?.placedSocials?null:i.config.placedSocials.find(e=>e.id===i.selectedSocialId)??null),$a=ee(null);function Bn(i){$a.set(i)}const Es=ee(new Map);function jl(i,e,t){Es.update(n=>{const s=new Map(n);return s.set(i,{x:e,y:t}),s})}function ql(i){Es.update(e=>{const t=new Map(e);return t.delete(i),t})}const Oa=ee(null);function zn(i){Oa.set(i)}const Jl=Le(z,i=>!i.selectedFrameId||!i.config?.placedFrames?null:i.config.placedFrames.find(e=>e.id===i.selectedFrameId)??null),La=ee(null);function Kn(i){La.set(i)}const Ra=ee(null);function ln(i){Ra.set(i)}const Is=ee(!1);function Ha(){Is.set(!0)}function Js(){Is.set(!1)}const Cs=Le(z,i=>!i.selectedItemId||!i.config?.placedItems?null:i.config.placedItems.find(e=>e.id===i.selectedItemId)??null),Ql=Le(Cs,i=>i?.physicsEnabled??!1),ec=Le(Cs,i=>i?.flipX??!1);function Qs(i,e){z.update(t=>t.config?{...t,config:{...t.config,playerStartX:i,playerStartY:e}}:t)}function tc(i){z.update(e=>{if(!e.config)return e;const t=e.config.placedItems||[];return{...e,config:{...e.config,placedItems:[...t,i]}}})}function Ji(i,e){z.update(t=>!t.config||!t.config.placedItems?t:{...t,config:{...t.config,placedItems:t.config.placedItems.map(n=>n.id===i?{...n,...e}:n)}})}function Xa(i){z.update(e=>!e.config||!e.config.placedItems?e:{...e,config:{...e.config,placedItems:e.config.placedItems.filter(t=>t.id!==i)},selectedItemId:e.selectedItemId===i?null:e.selectedItemId})}function Fa(i){z.update(e=>({...e,selectedItemId:i,isPlayerSelected:i?!1:e.isPlayerSelected}))}function ic(i){z.update(e=>({...e,isPlayerSelected:i,selectedItemId:null}))}function Ts(){z.update(i=>({...i,selectedItemId:null,selectedFrameId:null,selectedDialogZoneId:null,selectedSocialId:null,isPlayerSelected:!1}))}function nc(){z.update(i=>({...i,itemDepthLayer:i.itemDepthLayer==="behind"?"front":"behind"}))}function sc(i,e){Ji(i,{depth:e})}function rc(i,e){e?(Ji(i,{physicsEnabled:e,depth:ws("behind")}),z.update(t=>({...t,itemDepthLayer:"behind"}))):Ji(i,{physicsEnabled:e})}function ac(i,e){Ji(i,{flipX:e})}function oc(i){z.set({isActive:!0,config:{...i,placedItems:i.placedItems||[],dialogZones:i.dialogZones||[],placedFrames:i.placedFrames||[],placedSocials:i.placedSocials||[]},selectedItemId:null,itemDepthLayer:"behind",editMode:"items",selectedDialogZoneId:null,selectedFrameId:null,selectedSocialId:null,isPlayerSelected:!1}),Ds.set(1)}function lc(){z.update(i=>{const e=i.config?{...i.config,dialogZones:(i.config.dialogZones||[]).filter(t=>t.texts.some(n=>n.title.trim()!==""||n.content.trim()!==""))}:i.config;return{...i,isActive:!1,selectedItemId:null,config:e}}),Ds.set(1)}function cc(){return ut(z).config}const Ds=ee(1);function cn(i){Ds.set(i)}const ks=ee({scrollX:0,scrollY:0,viewWidth:0,viewHeight:0,worldWidth:0,worldHeight:0,zoom:1,playerX:0,playerY:0});function dc(i){ks.update(e=>({...e,...i}))}function Oi(i){z.update(e=>({...e,editMode:i,selectedItemId:null,selectedDialogZoneId:null}))}function uc(i){z.update(e=>{if(!e.config)return e;const t=e.config.dialogZones||[];return{...e,config:{...e.config,dialogZones:[...t,i]}}})}function fi(i,e){z.update(t=>!t.config||!t.config.dialogZones?t:{...t,config:{...t.config,dialogZones:t.config.dialogZones.map(n=>n.id===i?{...n,...e}:n)}})}function Na(i){z.update(e=>!e.config||!e.config.dialogZones?e:{...e,config:{...e.config,dialogZones:e.config.dialogZones.filter(t=>t.id!==i)},selectedDialogZoneId:e.selectedDialogZoneId===i?null:e.selectedDialogZoneId})}function Ni(i){z.update(e=>({...e,selectedDialogZoneId:i}))}function er(i,e,t){z.update(n=>!n.config||!n.config.dialogZones?n:{...n,config:{...n.config,dialogZones:n.config.dialogZones.map(s=>{if(s.id!==i)return s;const r=s.texts.findIndex(l=>l.language===e);let a;return r>=0?a=s.texts.map((l,o)=>o===r?{...l,...t}:l):a=[...s.texts,{language:e,title:"",content:"",...t}],{...s,texts:a}})}})}function hc(i){z.update(e=>{if(!e.config)return e;const t=e.config.placedFrames||[];return{...e,config:{...e.config,placedFrames:[...t,i]}}})}function wt(i,e){z.update(t=>!t.config||!t.config.placedFrames?t:{...t,config:{...t.config,placedFrames:t.config.placedFrames.map(n=>n.id===i?{...n,...e}:n)}})}function Ps(i){z.update(e=>!e.config||!e.config.placedFrames?e:{...e,config:{...e.config,placedFrames:e.config.placedFrames.filter(t=>t.id!==i)},selectedFrameId:e.selectedFrameId===i?null:e.selectedFrameId})}function Zi(i){An.set(!1),z.update(e=>({...e,selectedFrameId:i,isPlayerSelected:i?!1:e.isPlayerSelected,selectedItemId:i?null:e.selectedItemId}))}function fc(i){z.update(e=>{if(!e.config)return e;const t=e.config.placedSocials||[];return{...e,config:{...e.config,placedSocials:[...t,i]}}})}function un(i,e){z.update(t=>!t.config||!t.config.placedSocials?t:{...t,config:{...t.config,placedSocials:t.config.placedSocials.map(n=>n.id===i?{...n,...e}:n)}})}function As(i){z.update(e=>!e.config||!e.config.placedSocials?e:{...e,config:{...e.config,placedSocials:e.config.placedSocials.filter(t=>t.id!==i)},selectedSocialId:e.selectedSocialId===i?null:e.selectedSocialId})}function Yi(i){Mn.set(!1),z.update(e=>({...e,selectedSocialId:i,isPlayerSelected:i?!1:e.isPlayerSelected,selectedItemId:i?null:e.selectedItemId,selectedFrameId:i?null:e.selectedFrameId}))}const Ms=[{key:"tent",name:"Tent",path:"assets/ui/tent.png",scale:6,category:"structures"},{key:"lamp",name:"Lamp",path:"assets/ui/lamp.png",scale:8,category:"props"},{key:"sign_left",name:"Sign â",path:"assets/ui/sign_left.png",scale:7,category:"signs"},{key:"sign_right",name:"Sign â",path:"assets/ui/sign_right.png",scale:7,category:"signs"},{key:"stone_0",name:"Stone 0",path:"assets/ui/stone_0.png",scale:4,category:"nature",supportsPhysics:!0},{key:"stone_1",name:"Stone 1",path:"assets/ui/stone_1.png",scale:5,category:"nature",supportsPhysics:!0},{key:"stone_2",name:"Stone 2",path:"assets/ui/stone_2.png",scale:4,category:"nature",supportsPhysics:!0}];function Za(i){return Ms.find(e=>e.key===i)}function gc(i){return Za(i)?.scale||1}function pc(i){return Za(i)?.supportsPhysics??!1}class tr{scene;groundY;constructor(e,t){this.scene=e,this.groundY=t}static preloadAssets(e){Ms.forEach(t=>{e.load.image(t.key,t.path)})}createSprite(e){const{id:t,assetKey:n,x:s,scale:r=1,depth:a=5,yOffset:l=0,flipX:o=!1}=e,d=this.groundY+l,u=this.scene.add.sprite(s,d,n);return u.setScale(r),u.setDepth(a),u.setFlipX(o),u.setData("itemId",t),u}updatePosition(e,t,n){e.x=t,e.y=this.groundY+n}updateScale(e,t){e.setScale(t)}updateDepth(e,t){e.setDepth(t)}applyUpdates(e,t){t.x!==void 0&&(e.x=t.x),t.yOffset!==void 0&&(e.y=this.groundY+t.yOffset),t.scale!==void 0&&e.setScale(t.scale),t.depth!==void 0&&e.setDepth(t.depth),t.flipX!==void 0&&e.setFlipX(t.flipX)}worldYToOffset(e){return e-this.groundY}getGroundY(){return this.groundY}}const mi=50,mc=4871528,vc=.4,_c=1,Ya=ze.GRID_OVERLAY,Gn=16711680,yc=2,bc=.6,wc=.1,Sc=1,xc=.2,ir=50,Ec=50,$s=4886754;class Wa{lastClickTime=0;lastClickId=null;threshold;constructor(e=300){this.threshold=e}check(e){const t=Date.now(),n=this.lastClickId===e&&t-this.lastClickTime<this.threshold;return this.lastClickTime=t,this.lastClickId=e,n}reset(){this.lastClickTime=0,this.lastClickId=null}}function dn(i,e){return Math.round(i/e)*e}function Ln(i){const{sprite:e,scene:t,callbacks:n={},constraints:s,useGridSnapping:r=!0,cursor:a="grab",hitArea:l}=i;let o=!1,d=0,u=0,h=0;l?e.setInteractive({hitArea:l,hitAreaCallback:N.Geom.Rectangle.Contains,useHandCursor:!0,cursor:a}):e.setInteractive({useHandCursor:!0,cursor:a});const f=(_,b)=>{const p=e.getBounds(),x=5;return _>=p.x-x&&_<=p.x+p.width+x&&b>=p.y-x&&b<=p.y+p.height+x},g=()=>{const _=t.data.get("lastTapTime");if(!_||_===h||Date.now()-_>100)return;h=_;const b=t.data.get("lastTapWorldX"),p=t.data.get("lastTapWorldY");f(b,p)&&n.onSelect?.()},v=_=>{if(_.wasTouch||ut(as)||ai()||o||n.onDoubleClick?.())return;const b=n.isSelected?.()??!1;n.onSelect?.(),b&&(o=!0,t.data.set("isDraggingItem",!0),yi(!0),d=e.x-_.worldX,u=e.y-_.worldY,n.onDragStart?.())},S=_=>{if(_.wasTouch){const x=t.data.get("touchDragStarted");if(!o&&x&&n.isSelected?.()){const C=t.data.get("touchStartWorldX"),M=t.data.get("touchStartWorldY"),I=e.getBounds(),k=10;C>=I.x-k&&C<=I.x+I.width+k&&M>=I.y-k&&M<=I.y+I.height+k&&(o=!0,t.data.set("isDraggingItem",!0),t.data.set("touchDragStarted",!1),yi(!0),d=e.x-C,u=e.y-M,n.onDragStart?.())}if(o){let T=_.worldX+d,C=_.worldY+u;r&&ut(wn)&&(T=dn(T,mi),C=dn(C,mi)),s&&(s.minX!==void 0&&(T=Math.max(T,s.minX)),s.maxX!==void 0&&(T=Math.min(T,s.maxX)),s.minY!==void 0&&(C=Math.max(C,s.minY)),s.maxY!==void 0&&(C=Math.min(C,s.maxY))),e.setPosition(T,C),n.onDrag?.(T,C)}return}if(!o)return;if(ut(as)){m();return}if(!_.isDown){m();return}let b=_.worldX+d,p=_.worldY+u;r&&ut(wn)&&(b=dn(b,mi),p=dn(p,mi)),s&&(s.minX!==void 0&&(b=Math.max(b,s.minX)),s.maxX!==void 0&&(b=Math.min(b,s.maxX)),s.minY!==void 0&&(p=Math.max(p,s.minY)),s.maxY!==void 0&&(p=Math.min(p,s.maxY))),e.setPosition(b,p),n.onDrag?.(b,p)},y=()=>{o&&m()},m=()=>{o=!1,t.data.set("isDraggingItem",!1),yi(!1),n.onDragEnd?.(e.x,e.y)};e.on("pointerdown",v),t.input.on("pointermove",S),t.input.on("pointerup",y);const w=()=>{g()};return t.events.on("update",w),()=>{e.off("pointerdown",v),t.input.off("pointermove",S),t.input.off("pointerup",y),t.events.off("update",w)}}const Ic=4886754;class Cc{scene;groundY;worldWidth;worldHeight;isDragging=!1;callbacks;cleanupFunctions=new Map;constructor(e,t,n,s,r={}){this.scene=e,this.groundY=t,this.worldWidth=n,this.worldHeight=s,this.callbacks=r}getIsDragging(){return this.isDragging}makeInteractive(e,t){const n=Ln({sprite:e,scene:this.scene,cursor:"pointer",constraints:{minX:0,maxX:this.worldWidth,minY:0,maxY:this.worldHeight},callbacks:{onSelect:()=>{Fa(t),this.callbacks.onSelect?.(t)},isSelected:()=>ut($n)===t,onDragStart:()=>{this.isDragging=!0,e.setTint(Ic),this.callbacks.onDragStart?.(t)},onDrag:(s,r)=>{this.callbacks.onDrag?.(t,s,r)},onDragEnd:(s,r)=>{e.clearTint(),this.isDragging=!1;const a=Math.round(s),o=Math.round(r)-this.groundY;Ji(t,{x:a,yOffset:o}),this.callbacks.onDragEnd?.(t,a,o)}}});this.cleanupFunctions.set(t,n)}removeInteractivity(e){if(!e||!e.scene)return;const t=e.getData("itemId");t&&this.cleanupFunctions.has(t)&&(this.cleanupFunctions.get(t)(),this.cleanupFunctions.delete(t)),e.removeInteractive()}destroy(){this.cleanupFunctions.forEach(e=>e()),this.cleanupFunctions.clear()}}const nr={ITEM:"itemId",FRAME:"frameId",SOCIAL:"socialId",PLAYER:"isPlayer",ZONE:"zoneId"},Tc={lineWidth:3,lineColor:4886754,lineAlpha:1,handleSize:8,handleColor:4886754,padding:5};class Dc{scene;graphics;style;selectedId=null;constructor(e,t={}){this.scene=e,this.style={...Tc,...t},this.graphics=e.add.graphics(),this.graphics.setDepth(ze.SELECTION_GRAPHICS)}setSelectedId(e){this.selectedId=e}getSelectedId(){return this.selectedId}updateVisuals(e){if(this.graphics.clear(),!e||!this.selectedId)return;const t=e.getBounds(),{lineWidth:n,lineColor:s,lineAlpha:r,handleSize:a,handleColor:l,padding:o}=this.style;this.graphics.lineStyle(n,s,r),this.graphics.strokeRect(t.x-o,t.y-o,t.width+o*2,t.height+o*2),this.graphics.fillStyle(l,1),this.graphics.fillCircle(t.x,t.y,a),this.graphics.fillCircle(t.x+t.width,t.y,a),this.graphics.fillCircle(t.x,t.y+t.height,a),this.graphics.fillCircle(t.x+t.width,t.y+t.height,a)}clearVisuals(){this.graphics.clear(),this.selectedId=null}setupBackgroundDeselect(e){this.scene.input.on("pointerdown",t=>{if(ai()||e())return;this.scene.input.hitTestPointer(t).find(r=>r.type==="Sprite"?Object.values(nr).some(a=>r.getData(a)):r.type==="Rectangle"?r.getData(nr.ZONE):!1)||(Ts(),this.clearVisuals())})}destroy(){this.graphics?.destroy()}}class Sn{scene;items=new Map;isBuilderMode=!1;physicsGroup=null;renderer;dragController;selectionManager;constructor(e,t,n,s,r=!1){this.scene=e,this.isBuilderMode=r,this.renderer=new tr(e,t),r||(this.physicsGroup=e.physics.add.staticGroup()),this.isBuilderMode&&(this.dragController=new Cc(e,t,n,s,{onSelect:()=>this.updateSelectionVisuals(),onDrag:()=>this.updateSelectionVisuals()}),this.selectionManager=new Dc(e))}static preloadAssets(e){tr.preloadAssets(e)}createItems(e){e.forEach(t=>{this.createItem(t)})}createItem(e){const t=this.renderer.createSprite(e),n={sprite:t,data:e};if(!this.isBuilderMode&&e.physicsEnabled&&this.physicsGroup){const s=this.createPhysicsBody(t,e);n.physicsBody=s}this.items.set(e.id,n),this.isBuilderMode&&this.dragController&&this.dragController.makeInteractive(t,e.id)}createPhysicsBody(e,t){const n=e.getBounds(),s=n.width*.5,r=n.height*.8,a=e.x,l=e.y,o=this.scene.add.rectangle(a,l,s,r);return o.setVisible(!1),this.physicsGroup.add(o),o.setData("itemId",t.id),o}updateSelectionVisuals(){if(!this.selectionManager)return;const e=this.scene.data.get("selectedItemId");if(this.selectionManager.setSelectedId(e),!e){this.selectionManager.clearVisuals(),zn(null);return}const t=this.items.get(e);if(this.selectionManager.updateVisuals(t?.sprite??null),t?.sprite){const n=this.scene.cameras.main,s=t.sprite.getBounds(),{screenX:r,screenY:a}=jt(s.centerX,s.centerY,n),l=s.height*n.zoom;zn({screenX:r,screenY:a,itemHeight:l})}else zn(null)}updateItem(e,t){const n=this.items.get(e);n&&(this.renderer.applyUpdates(n.sprite,t),n.data={...n.data,...t})}removeItem(e){const t=this.items.get(e);t&&(this.dragController&&this.dragController.removeInteractivity(t.sprite),t.physicsBody&&t.physicsBody.destroy(),t.sprite.destroy(),this.items.delete(e))}removeAllItems(){this.items.forEach(e=>{!e.sprite||!e.sprite.scene||(this.dragController&&this.dragController.removeInteractivity(e.sprite),e.physicsBody&&e.physicsBody.destroy(),e.sprite.destroy())}),this.items.clear()}getItem(e){return this.items.get(e)?.data}getAllItems(){return Array.from(this.items.values()).map(e=>e.data)}getPhysicsGroup(){return this.physicsGroup}setInteractiveEnabled(e){!this.isBuilderMode||!this.dragController||(this.items.forEach(({sprite:t,data:n})=>{e?(this.dragController.makeInteractive(t,n.id),t.setAlpha(1)):(t.disableInteractive(),t.setAlpha(.6))}),!e&&this.selectionManager&&this.selectionManager.clearVisuals())}destroy(){this.removeAllItems(),this.selectionManager?.destroy()}setupBackgroundDeselect(){!this.isBuilderMode||!this.selectionManager||this.selectionManager.setupBackgroundDeselect(()=>this.dragController?.getIsDragging()??!1)}}function kc(){return`frame_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const Pc=["#ffffff","#f8f8f8","#fffacd","#ffefd5","#ffe4e1","#e6e6fa","#f0fff0","#f5fffa","#fff0f5","#f0f8ff","#2d2d2d","#1a1a2e","#16213e","#1a1a1a","#2d132c","#1e3a3a","#3d1a1a","#1a2f1a","#3d3d1a","#2a1a3d"],Ac=["#333333","#000000","#ffffff","#1a1a1a","#666666","#8b4513","#2c3e50","#c0392b","#27ae60","#2980b9","#8e44ad","#f39c12"],Mc=[12,14,16,18,20,24,28,32],$c=[{value:"top",label:"Top",icon:"â"},{value:"center",label:"Center",icon:"â¬"},{value:"bottom",label:"Bottom",icon:"â"}],Ba={S:{label:"Small",scale:3},M:{label:"Medium",scale:4},L:{label:"Large",scale:5}};function Oc(i){return Ba[i].scale}function Lc(i){return i<=3?"S":i>=5?"L":"M"}const Mt=4,Hi="#ffffff",za="#333333",hn=16,Ka="center",Rc=64,Hc=96,Xc=.06,sr=32,xn=[{key:"base_1",name:"Frame 1",path:"assets/frames/base 1.png",scale:4},{key:"base_2",name:"Frame 2",path:"assets/frames/base 2.png",scale:4},{key:"base_3",name:"Frame 3",path:"assets/frames/base 3.png",scale:4},{key:"base_4",name:"Frame 4",path:"assets/frames/base 4.png",scale:4},{key:"base_5",name:"Frame 5",path:"assets/frames/base 5.png",scale:4},{key:"base_6",name:"Frame 6",path:"assets/frames/base 6.png",scale:4},{key:"base_7",name:"Frame 7",path:"assets/frames/base 7.png",scale:4},{key:"base_8",name:"Frame 8",path:"assets/frames/base 8.png",scale:4},{key:"base_9",name:"Frame 9",path:"assets/frames/base 9.png",scale:4},{key:"base_10",name:"Frame 10",path:"assets/frames/base 10.png",scale:4},{key:"base_11",name:"Frame 11",path:"assets/frames/base 11.png",scale:4},{key:"base_12",name:"Frame 12",path:"assets/frames/base 12.png",scale:4},{key:"base_13",name:"Frame 13",path:"assets/frames/base 13.png",scale:4},{key:"base_14",name:"Frame 14",path:"assets/frames/base 14.png",scale:4},{key:"base_15",name:"Frame 15",path:"assets/frames/base 15.png",scale:4},{key:"base_16",name:"Frame 16",path:"assets/frames/base 16.png",scale:4},{key:"base_17",name:"Frame 17",path:"assets/frames/base 17.png",scale:4},{key:"base_18",name:"Frame 18",path:"assets/frames/base 18.png",scale:4},{key:"base_19",name:"Frame 19",path:"assets/frames/base 19.png",scale:4},{key:"base_20",name:"Frame 20",path:"assets/frames/base 20.png",scale:4},{key:"base_21",name:"Frame 21",path:"assets/frames/base 21.png",scale:4},{key:"base_22",name:"Frame 22",path:"assets/frames/base 22.png",scale:4},{key:"base_23",name:"Frame 23",path:"assets/frames/base 23.png",scale:4},{key:"base_24",name:"Frame 24",path:"assets/frames/base 24.png",scale:4},{key:"base_25",name:"Frame 25",path:"assets/frames/base 25.png",scale:4}];function Fc(i){return xn.find(e=>e.key===i)}function Nc(i){return Fc(i)?.scale??Mt}function Wi(i=Mt,e=!1){const t=Rc*i,n=Hc*i,s=e?n:t,r=e?t:n,a=Math.min(t,n)*Xc,l=s-a*2,o=r-a*2,d=l-sr*2,u=o-sr*2;return{frameWidth:s,frameHeight:r,innerWidth:l,innerHeight:o,textWidth:d,textHeight:u}}function fn(i,e,t,n,s,r,a=4){i.clear();const l=parseInt(r.replace("#",""),16);i.fillStyle(l,1),i.fillRoundedRect(e-n/2,t-s/2,n,s,a)}class rr{scene;frames=new Map;constructor(e){this.scene=e}static preloadAssets(e){for(let t=1;t<=25;t++)e.load.image(`frame_base_${t}`,`assets/frames/base ${t}.png`)}createFrames(e){e.forEach(t=>{this.createFrame(t)})}createFrame(e){const t=`frame_${e.frameKey}`;if(!this.scene.textures.exists(t)){console.warn(`[GameFrameManager] Frame texture not found: ${t}`);return}const n=e.scale??Mt,s=e.depth??ze.ITEMS_FRONT,r=(e.rotation??0)*(Math.PI/180),a=e.rotation===90,{innerWidth:l,innerHeight:o}=Wi(n,a),d=this.scene.add.graphics();d.setDepth(s-.1),fn(d,e.x,e.y,l,o,e.backgroundColor||Hi);const u=this.scene.add.sprite(e.x,e.y,t);u.setScale(n),u.setDepth(s),u.setOrigin(.5,.5),u.setRotation(r);const h={sprite:u,background:d,data:e};this.frames.set(e.id,h),e.url&&this.makeClickable(h)}makeClickable(e){const{sprite:t,data:n}=e;t.setInteractive({useHandCursor:!0}),t.on("pointerover",()=>{t.setScale((n.scale??Mt)*1.05)}),t.on("pointerout",()=>{t.setScale(n.scale??Mt)}),t.on("pointerdown",()=>{n.url&&(wa(),window.open(n.url,"_blank","noopener,noreferrer"))})}destroy(){this.frames.forEach(({sprite:e,background:t})=>{e.destroy(),t.destroy()}),this.frames.clear()}}function Zc(){return`social_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const Qi={S:{label:"Small",scale:1.5},M:{label:"Medium",scale:2},L:{label:"Large",scale:2.5}},bi=Qi.M.scale;function Yc(i){return Qi[i].scale}function Wc(i){return i<=Qi.S.scale?"S":i>=Qi.L.scale?"L":"M"}const En=[{key:"discord",name:"Discord",path:"assets/socials/Discord.png",scale:1},{key:"facebook",name:"Facebook",path:"assets/socials/Facebook.png",scale:1},{key:"instagram",name:"Instagram",path:"assets/socials/Instagram.png",scale:1},{key:"kofi",name:"Ko-Fi",path:"assets/socials/Ko Fi.png",scale:1},{key:"linkedin",name:"LinkedIn",path:"assets/socials/LinkedIn.png",scale:1},{key:"patreon",name:"Patreon",path:"assets/socials/Patreon.png",scale:1},{key:"tiktok",name:"TikTok",path:"assets/socials/TikTok.png",scale:1},{key:"twitch",name:"Twitch",path:"assets/socials/Twitch.png",scale:1},{key:"twitter",name:"Twitter",path:"assets/socials/Twitter.png",scale:1},{key:"whatsapp",name:"WhatsApp",path:"assets/socials/Whatsapp.png",scale:1},{key:"youtube",name:"YouTube",path:"assets/socials/Youtube.png",scale:1}];class ar{scene;socials=new Map;constructor(e){this.scene=e}static preloadAssets(e){En.forEach(t=>{e.load.image(`social_${t.key}`,t.path)})}createSocials(e){e.forEach(t=>{this.createSocial(t)})}createSocial(e){const t=`social_${e.socialKey}`;if(!this.scene.textures.exists(t)){console.warn(`[GameSocialManager] Social texture not found: ${t}`);return}const n=e.scale??bi,s=e.depth??ze.ITEMS_FRONT,r=this.scene.add.sprite(e.x,e.y,t);r.setScale(n),r.setDepth(s),r.setOrigin(.5,.5),this.socials.set(e.id,r),e.url&&this.makeClickable(r,e)}makeClickable(e,t){const n=t.scale??bi;e.setInteractive({useHandCursor:!0}),e.on("pointerover",()=>{e.setScale(n*1.1)}),e.on("pointerout",()=>{e.setScale(n)}),e.on("pointerdown",()=>{t.url&&(wa(),window.open(t.url,"_blank","noopener,noreferrer"))})}destroy(){this.socials.forEach(e=>{e.destroy()}),this.socials.clear()}}async function or(){const i=await fetch("./config/map.json");if(!i.ok)throw new Error(`Failed to load map config: ${i.status}`);const e=await i.json();if(!e.worldWidth||!e.worldHeight)throw new Error("Invalid map config structure");return e}const gn={generateId(){return`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`},create(i){const{assetKey:e,x:t,yOffset:n=0,depthLayer:s="behind",scale:r}=i;return{id:gn.generateId(),assetKey:e,x:Math.round(t),y:0,scale:r??gc(e),depth:ws(s),yOffset:Math.round(n)}},createAtWorldPosition(i,e,t,n,s="behind"){return gn.create({assetKey:i,x:e,yOffset:t-n,depthLayer:s})},clone(i,e=50){return{...i,id:gn.generateId(),x:i.x+e}}},ui={HEIGHT:Ti,VISUAL:{COLOR:9139029,ALPHA:.3},PHYSICS:{COLOR:0,ALPHA:0}},en={getGroundY(i,e=Ti){return i-e},createVisualGround(i,e){const t=e.height??ui.HEIGHT,n=en.getGroundY(e.worldHeight,t),s=i.add.rectangle(0,n,e.worldWidth,t,e.color??ui.VISUAL.COLOR,e.alpha??ui.VISUAL.ALPHA);return s.setOrigin(0,0),s.setDepth(e.depth??ze.GROUND_REFERENCE),{ground:s,groundY:n}},createPhysicsGround(i,e){const t=e.height??ui.HEIGHT,n=en.getGroundY(e.worldHeight,t),s=i.add.rectangle(0,n,e.worldWidth,t,e.color??ui.PHYSICS.COLOR,e.alpha??ui.PHYSICS.ALPHA);return s.setOrigin(0,0),i.physics.add.existing(s,!0),{ground:s,groundY:n}},addPlayerCollision(i,e,t){return i.physics.add.collider(e,t)}},pt={GAME:"GameScene",BUILDER:"BuilderScene"};class Bc extends N.Scene{player;mapConfig;parallaxLayers=null;loadedBackgrounds=new Set;itemManager;frameManager;socialManager;dialogZones=[];currentDialogZone=null;unsubscribers=[];initData;constructor(){super({key:pt.GAME})}init(e){this.initData=e}preload(){kt.forEach(e=>{this.load.spritesheet(`cat-idle-${e}`,`assets/sprites/${e}/Idle.png`,{frameWidth:48,frameHeight:48}),this.load.spritesheet(`cat-walk-${e}`,`assets/sprites/${e}/Walk.png`,{frameWidth:48,frameHeight:48})}),Sn.preloadAssets(this),rr.preloadAssets(this),ar.preloadAssets(this)}create(){this.initializeScene()}async initializeScene(){ss.set(!0);try{await this.loadMapConfiguration();const e=Vi.getCurrentConfig();await this.loadBackgroundIfNeeded(e),this.createParallaxBackground();const{ground:t,groundY:n}=en.createPhysicsGround(this,{worldWidth:this.mapConfig.worldWidth,worldHeight:this.mapConfig.worldHeight}),s=Tl(this.mapConfig.playerStartY,this.mapConfig.worldHeight);this.player=new Ll(this,this.mapConfig.playerStartX,s),en.addPlayerCollision(this,this.player,t),this.itemManager=new Sn(this,n,this.mapConfig.worldWidth,this.mapConfig.worldHeight,!1),this.mapConfig.placedItems&&this.mapConfig.placedItems.length>0&&this.itemManager.createItems(this.mapConfig.placedItems);const r=this.itemManager.getPhysicsGroup();r&&this.physics.add.collider(this.player,r),this.frameManager=new rr(this),this.mapConfig.placedFrames&&this.mapConfig.placedFrames.length>0&&this.frameManager.createFrames(this.mapConfig.placedFrames),this.socialManager=new ar(this),this.mapConfig.placedSocials&&this.mapConfig.placedSocials.length>0&&this.socialManager.createSocials(this.mapConfig.placedSocials),this.dialogZones=this.mapConfig.dialogZones||[];const a=xs.subscribe(l=>{this.dialogZones=l,this.recheckCurrentZone()});this.unsubscribers.push(a),this.cameras.main.startFollow(this.player,!0,.1,.1),this.cameras.main.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.physics.world.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.scale.on("resize",this.handleResize,this)}catch(e){console.error("[GameScene] Failed to initialize scene:",e)}finally{ss.set(!1)}}async loadMapConfiguration(){try{if(this.initData?.useBuilderConfig){const e=cc();this.mapConfig=e||await or()}else this.mapConfig=await or()}catch(e){console.error("[GameScene] Failed to load map configuration:",e);const t=600;this.mapConfig={worldWidth:3200,worldHeight:t,playerStartX:400,playerStartY:Ui(t),placedItems:[]}}}createParallaxBackground(){const e=Vi.getCurrentConfig();this.parallaxLayers=Ia(this,this.mapConfig.worldWidth,this.mapConfig.worldHeight,e)}async loadBackgroundIfNeeded(e){if(this.loadedBackgrounds.has(e.folder))return!0;const t=await Ea(this,e);return t&&this.loadedBackgrounds.add(e.folder),t}handleResize(e){if(!(!this.cameras?.main||!this.mapConfig)&&(this.cameras.main.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.parallaxLayers?.baseLayer)){const t=Math.max(this.mapConfig.worldHeight,e.height);this.parallaxLayers.baseLayer.setSize(this.mapConfig.worldWidth,t)}}shutdown(){this.scale.off("resize",this.handleResize,this),Nn(null),this.currentDialogZone=null,this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.itemManager&&this.itemManager.destroy(),this.frameManager&&this.frameManager.destroy(),this.socialManager&&this.socialManager.destroy()}update(){if(!this.player)return;this.player.update();const e=this.cameras.main,t=this.player.x-e.scrollX,n=this.player.y-e.scrollY;xl(t,n),El(e.scrollX,e.scrollY,e.zoom),this.checkDialogZones(),this.parallaxLayers&&Ca(this.parallaxLayers.baseLayer,this.cameras.main)}checkDialogZones(){const e=this.player.x;let t=null;for(const n of this.dialogZones)if(e>=n.x&&e<=n.x+n.width){t=n;break}t?.id!==this.currentDialogZone?.id&&(this.currentDialogZone=t,Nn(t))}recheckCurrentZone(){if(!this.currentDialogZone)return;const e=this.dialogZones.find(t=>t.id===this.currentDialogZone?.id);e&&(this.currentDialogZone=e,Nn(e))}}const Un=1,lr=.001,zc=.15,cr=400;class Kc{scene;camera;worldWidth;worldHeight;isPanning=!1;panStartX=0;panStartY=0;cameraDragStartX=0;cameraDragStartY=0;isDraggingToScroll=!1;dragScrollStartX=0;dragScrollStartY=0;dragScrollCameraStartX=0;dragScrollCameraStartY=0;currentZoom=1;targetZoom=1;minZoom=.1;isAnimatingReset=!1;zoomTargetWorldPoint=null;pinchStartDistance=0;pinchStartZoom=1;activeTouches=new Map;pinchEndTime=0;isPinching=!1;PINCH_COOLDOWN=150;touchStartTime=0;touchStartPos=null;touchOnSelectedSprite=!1;TAP_MAX_DURATION=200;TAP_MAX_DISTANCE=10;constructor(e,t,n){this.scene=e,this.camera=e.cameras.main,this.worldWidth=t,this.worldHeight=n}setup(){this.calculateMinZoom(),this.setupCamera(),this.setupMouseControls(),this.setupKeyboardControls(),this.setupUpdateLoop()}calculateMinZoom(){const e=this.camera.width/this.worldWidth,t=this.camera.height/this.worldHeight;this.minZoom=Math.min(e,t)}setupCamera(){this.currentZoom=this.minZoom,this.targetZoom=this.minZoom,this.camera.setZoom(this.minZoom);const e=this.camera.width/this.minZoom,t=this.camera.height/this.minZoom,n=Math.min(0,(this.worldWidth-e)/2),s=Math.min(0,(this.worldHeight-t)/2),r=Math.max(this.worldWidth,e),a=Math.max(this.worldHeight,t);this.camera.setBounds(n,s,r,a),this.camera.centerOn(this.worldWidth/2,this.worldHeight/2),cn(this.minZoom)}centerOn(e,t){this.camera.centerOn(e,t),this.clampScroll()}handleResize(){this.calculateMinZoom(),this.currentZoom<this.minZoom&&(this.currentZoom=this.minZoom,this.targetZoom=this.minZoom,this.camera.setZoom(this.minZoom)),this.targetZoom<this.minZoom&&(this.targetZoom=this.minZoom),this.updateCameraBounds(),this.clampScroll(),cn(this.currentZoom)}updateCameraBounds(){const e=this.camera.width/this.currentZoom,t=this.camera.height/this.currentZoom,n=Math.min(0,(this.worldWidth-e)/2),s=Math.min(0,(this.worldHeight-t)/2),r=Math.max(this.worldWidth,e),a=Math.max(this.worldHeight,t);this.camera.setBounds(n,s,r,a)}getScrollBounds(e=!0){const t=this.camera.width/this.currentZoom,n=this.camera.height/this.currentZoom;let s,r,a,l;return t>this.worldWidth?e?s=r=(this.worldWidth-t)/2:(s=this.worldWidth-t,r=0):(s=0,r=this.worldWidth-t),n>this.worldHeight?e?a=l=(this.worldHeight-n)/2:(a=this.worldHeight-n,l=0):(a=0,l=this.worldHeight-n),{minX:s,maxX:r,minY:a,maxY:l}}clampScroll(){const e=this.getScrollBounds(!0);this.camera.scrollX=N.Math.Clamp(this.camera.scrollX,e.minX,e.maxX),this.camera.scrollY=N.Math.Clamp(this.camera.scrollY,e.minY,e.maxY)}softClampScroll(){const e=this.getScrollBounds(!1);this.camera.scrollX=N.Math.Clamp(this.camera.scrollX,e.minX,e.maxX),this.camera.scrollY=N.Math.Clamp(this.camera.scrollY,e.minY,e.maxY)}applyPanDelta(e,t,n,s,r,a){const l=this.getScrollBounds(),o=(e-n)/this.currentZoom,d=(t-s)/this.currentZoom;this.camera.scrollX=N.Math.Clamp(r-o,l.minX,l.maxX),this.camera.scrollY=N.Math.Clamp(a-d,l.minY,l.maxY)}zoomToPoint(e,t,n){const s=this.camera.getWorldPoint(e,t);this.zoomToWorldPoint(s.x,s.y,n)}zoomToWorldPoint(e,t,n){const s=this.camera.scrollX,r=this.camera.scrollY,a=this.currentZoom;this.currentZoom=n,this.camera.setZoom(n),this.updateCameraBounds(),this.camera.scrollX=e-(e-s)*a/n,this.camera.scrollY=t-(t-r)*a/n,this.softClampScroll(),cn(this.currentZoom)}setupMouseControls(){this.scene.input.on("wheel",(e,t,n,s,r)=>{if(this.isAnimatingReset)return;if((e.event.ctrlKey||Math.abs(n)<5&&Math.abs(s)>0)&&!e.event.ctrlKey){const l=-s*lr*3;this.targetZoom=N.Math.Clamp(this.targetZoom+l,this.minZoom,Un);const o=this.camera.getWorldPoint(e.x,e.y);this.zoomTargetWorldPoint={x:o.x,y:o.y}}else if(e.event.ctrlKey){const l=-s*lr,o=N.Math.Clamp(this.currentZoom+l,this.minZoom,Un);this.targetZoom=o,this.zoomToPoint(e.x,e.y,o)}else{const l=this.getScrollBounds();this.camera.scrollX=N.Math.Clamp(this.camera.scrollX+n/this.currentZoom,l.minX,l.maxX),this.camera.scrollY=N.Math.Clamp(this.camera.scrollY+s/this.currentZoom,l.minY,l.maxY)}}),this.scene.input.on("pointerdown",e=>{if(e.wasTouch){if(this.activeTouches.set(e.id,{x:e.x,y:e.y}),this.activeTouches.size===2){this.isPinching=!0,this.startPinch(),this.touchStartPos=null,this.touchOnSelectedSprite=!1,this.scene.data.set("touchDraggingSprite",!1);return}this.activeTouches.size===1&&!this.isPinching&&(this.touchStartTime=Date.now(),this.touchStartPos={x:e.x,y:e.y},this.dragScrollStartX=e.x,this.dragScrollStartY=e.y,this.dragScrollCameraStartX=this.camera.scrollX,this.dragScrollCameraStartY=this.camera.scrollY,this.touchOnSelectedSprite=this.isTouchOnSelectedSprite(e.worldX,e.worldY),this.scene.data.set("touchDraggingSprite",!1),this.scene.data.set("touchStartOnSelectedSprite",this.touchOnSelectedSprite),this.scene.data.set("touchStartWorldX",e.worldX),this.scene.data.set("touchStartWorldY",e.worldY));return}ai()||js()||this.isAnimatingReset||(e.rightButtonDown()||e.middleButtonDown()?(this.isPanning=!0,this.panStartX=e.x,this.panStartY=e.y,this.cameraDragStartX=this.camera.scrollX,this.cameraDragStartY=this.camera.scrollY):e.leftButtonDown()&&!this.isDraggingObject()&&(this.scene.data.get("isDraggingItem")===!0||(this.dragScrollStartX=e.x,this.dragScrollStartY=e.y,this.dragScrollCameraStartX=this.camera.scrollX,this.dragScrollCameraStartY=this.camera.scrollY)))}),this.scene.input.on("pointermove",e=>{if(e.wasTouch){if(this.activeTouches.has(e.id)&&this.activeTouches.set(e.id,{x:e.x,y:e.y}),this.activeTouches.size>=2&&this.isPinching){this.handlePinch();return}if(this.isPinching||Date.now()-this.pinchEndTime<this.PINCH_COOLDOWN||this.scene.data.get("touchDraggingSprite"))return;if(this.touchStartPos&&!this.isDraggingToScroll){const t=Math.abs(e.x-this.touchStartPos.x),n=Math.abs(e.y-this.touchStartPos.y);if(Math.sqrt(t*t+n*n)>this.TAP_MAX_DISTANCE){if(this.touchOnSelectedSprite){this.scene.data.set("touchDragStarted",!0),this.scene.data.set("touchDraggingSprite",!0),this.touchStartPos=null;return}!ai()&&!this.isDraggingObject()&&!this.scene.data.get("isDraggingItem")&&(this.isDraggingToScroll=!0,this.touchStartPos=null)}}this.isDraggingToScroll&&this.applyPanDelta(e.x,e.y,this.dragScrollStartX,this.dragScrollStartY,this.dragScrollCameraStartX,this.dragScrollCameraStartY);return}if(!(js()||this.isAnimatingReset)){if(this.isPanning)this.applyPanDelta(e.x,e.y,this.panStartX,this.panStartY,this.cameraDragStartX,this.cameraDragStartY);else if(e.leftButtonDown()&&!this.isDraggingToScroll&&!this.isDraggingObject()&&!(this.scene.data.get("isDraggingItem")===!0)){const n=Math.abs(e.x-this.dragScrollStartX),s=Math.abs(e.y-this.dragScrollStartY);Math.sqrt(n*n+s*s)>10&&(this.isDraggingToScroll=!0,this.scene.input.setDefaultCursor("grabbing"))}this.isDraggingToScroll&&this.applyPanDelta(e.x,e.y,this.dragScrollStartX,this.dragScrollStartY,this.dragScrollCameraStartX,this.dragScrollCameraStartY)}}),this.scene.input.on("pointerup",e=>{if(e.wasTouch){if(this.isPinching&&(this.pinchEndTime=Date.now(),this.isPinching=!1,Yn(!1)),this.touchStartPos&&!this.isDraggingToScroll){const t=Date.now()-this.touchStartTime,n=Math.abs(e.x-this.touchStartPos.x),s=Math.abs(e.y-this.touchStartPos.y),r=Math.sqrt(n*n+s*s);t<this.TAP_MAX_DURATION&&r<this.TAP_MAX_DISTANCE&&(this.scene.data.set("lastTapTime",Date.now()),this.scene.data.set("lastTapWorldX",e.worldX),this.scene.data.set("lastTapWorldY",e.worldY))}this.touchStartPos=null,this.touchOnSelectedSprite=!1,this.activeTouches.delete(e.id),this.scene.data.set("touchDraggingSprite",!1),this.scene.data.set("touchDragStarted",!1),this.scene.data.set("touchStartOnSelectedSprite",!1),this.isDraggingToScroll&&(this.isDraggingToScroll=!1);return}!e.rightButtonDown()&&!e.middleButtonDown()&&(this.isPanning=!1),this.isDraggingToScroll&&(this.isDraggingToScroll=!1,this.scene.input.setDefaultCursor("default"))}),this.scene.input.on("pointerout",e=>{e.wasTouch&&(this.activeTouches.delete(e.id),this.touchStartPos=null,this.touchOnSelectedSprite=!1,this.isPinching&&this.activeTouches.size<2&&(this.isPinching=!1,this.pinchEndTime=Date.now(),Yn(!1)))})}isTouchOnSelectedSprite(e,t){const n=this.scene.input.activePointer,s=this.scene.input.hitTestPointer(n),r=this.scene.data.get("selectedItemId"),a=this.scene.data.get("selectedFrameId"),l=this.scene.data.get("isPlayerSelected");for(const o of s){if(!(o instanceof N.GameObjects.Sprite))continue;const d=o.getData("itemId");if(d&&d===r)return!0;const u=o.getData("frameId");if(u&&u===a)return!0;const h=this.scene.data.get("playerSprite");if(l&&o===h)return!0}return!1}startPinch(){const e=Array.from(this.activeTouches.values());if(e.length!==2)return;const[t,n]=e;this.pinchStartDistance=Math.hypot(n.x-t.x,n.y-t.y),this.pinchStartZoom=this.currentZoom,Yn(!0)}handlePinch(){const e=Array.from(this.activeTouches.values());if(e.length!==2)return;const[t,n]=e,s=Math.hypot(n.x-t.x,n.y-t.y),r=(t.x+n.x)/2,a=(t.y+n.y)/2,l=s/this.pinchStartDistance,o=N.Math.Clamp(this.pinchStartZoom*l,this.minZoom,Un);this.targetZoom=o,this.zoomToPoint(r,a,o)}setupKeyboardControls(){const e={up:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.UP,!1),down:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.DOWN,!1),left:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.LEFT,!1),right:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.RIGHT,!1)},t={w:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.W,!1),a:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.A,!1),s:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.S,!1),d:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.D,!1)};this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.SPACE,!1).on("down",()=>{_i()||this.centerOnPlayer()}),this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.F,!1).on("down",()=>{_i()||this.resetToFit()}),this.scene.data.set("cameraArrowKeys",e),this.scene.data.set("cameraWasdKeys",t)}setupUpdateLoop(){const e=this.scene.data.get("cameraArrowKeys"),t=this.scene.data.get("cameraWasdKeys");this.scene.events.on("update",()=>{if(!this.isAnimatingReset&&Math.abs(this.currentZoom-this.targetZoom)>1e-4){const r=N.Math.Linear(this.currentZoom,this.targetZoom,zc);this.zoomTargetWorldPoint?this.zoomToWorldPoint(this.zoomTargetWorldPoint.x,this.zoomTargetWorldPoint.y,r):this.zoomToPoint(this.camera.width/2,this.camera.height/2,r),Math.abs(this.currentZoom-this.targetZoom)<.001&&(this.zoomTargetWorldPoint=null)}if(_i()||this.isAnimatingReset)return;const n=10/this.currentZoom,s=this.getScrollBounds();e?.left?.isDown||t?.a?.isDown?this.camera.scrollX=N.Math.Clamp(this.camera.scrollX-n,s.minX,s.maxX):(e?.right?.isDown||t?.d?.isDown)&&(this.camera.scrollX=N.Math.Clamp(this.camera.scrollX+n,s.minX,s.maxX)),e?.up?.isDown||t?.w?.isDown?this.camera.scrollY=N.Math.Clamp(this.camera.scrollY-n,s.minY,s.maxY):(e?.down?.isDown||t?.s?.isDown)&&(this.camera.scrollY=N.Math.Clamp(this.camera.scrollY+n,s.minY,s.maxY))})}centerOnPlayer(){const e=this.scene.data.get("playerSprite");e&&(this.camera.centerOn(e.x,e.y),this.clampScroll())}isDraggingObject(){return this.scene.data.get("isDraggingObject")===!0||this.scene.data.get("isDraggingItem")===!0}resetToFit(){if(this.isAnimatingReset)return;this.isAnimatingReset=!0,this.targetZoom=this.minZoom;const e=this.camera.width/this.minZoom,t=this.camera.height/this.minZoom,n=(this.worldWidth-e)/2,s=(this.worldHeight-t)/2,r=n+e/2,a=s+t/2;this.camera.pan(r,a,cr,"Sine.easeInOut"),this.camera.zoomTo(this.minZoom,cr,"Sine.easeInOut",!1,(l,o)=>{o===1&&(this.currentZoom=this.minZoom,this.camera.scrollX=n,this.camera.scrollY=s,this.isAnimatingReset=!1,cn(this.minZoom))})}destroy(){this.activeTouches.clear()}}const Gc=16729156;class Uc{scene;player;worldWidth;worldHeight;unsubscribers=[];interactionCleanup=null;constructor(e,t,n){this.scene=e,this.worldWidth=t,this.worldHeight=n}create(e,t){const n=Math.min(t,Ui(this.worldHeight));return this.player=this.scene.add.sprite(e,n,"cat-idle-white",0),this.player.setScale(Ci.SCALE),this.player.setDepth(Ci.DEPTH),this.player.setData("isPlayer",!0),this.scene.data.set("playerSprite",this.player),this.setupInteraction(),this.setupEditModeSubscription(),this.setupSelectionSubscription(),this.player}setupInteraction(){const e=new N.Geom.Rectangle(8,4,32,40);this.interactionCleanup=Ln({sprite:this.player,scene:this.scene,useGridSnapping:!1,cursor:"grab",hitArea:e,constraints:{minX:ir,maxX:this.worldWidth-ir,minY:Ec},callbacks:{onSelect:()=>{ic(!0)},isSelected:()=>ut(Wn),onDragStart:()=>{this.player.setTint($s),this.scene.data.set("isDraggingObject",!0)},onDrag:(t,n)=>{Qs(Math.round(t),Math.round(n))},onDragEnd:(t,n)=>{this.updateSelectionVisual(ut(Wn)),this.scene.data.set("isDraggingObject",!1);let s=this.player.y;Dl(this.player.y,this.worldHeight)&&(s=Ui(this.worldHeight),this.player.setY(s)),Qs(Math.round(this.player.x),Math.round(s))}}})}setupSelectionSubscription(){const e=Wn.subscribe(t=>{this.updateSelectionVisual(t),this.scene.data.set("isPlayerSelected",t)});this.unsubscribers.push(e)}updateSelectionVisual(e){this.player&&(e?this.player.setTint(Gc):this.player.clearTint())}setupEditModeSubscription(){const e=Ke.subscribe(t=>{t==="dialogs"?(this.interactionCleanup&&(this.interactionCleanup(),this.interactionCleanup=null),this.player.disableInteractive(),this.player.setAlpha(.6)):(this.player.setAlpha(1),this.interactionCleanup||this.setupInteraction())});this.unsubscribers.push(e)}getSprite(){return this.player}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.interactionCleanup&&(this.interactionCleanup(),this.interactionCleanup=null),this.player&&this.player.destroy()}}class Vc{scene;graphics;worldWidth;worldHeight;constructor(e,t,n){this.scene=e,this.worldWidth=t,this.worldHeight=n}create(){return this.graphics=this.scene.add.graphics(),this.graphics.setDepth(Ya),this.draw(),this.graphics}draw(){this.graphics.clear(),this.graphics.lineStyle(_c,mc,vc);const e=Math.max(this.worldHeight,this.scene.scale.height);for(let n=0;n<=this.worldWidth;n+=mi)this.graphics.beginPath(),this.graphics.moveTo(n,0),this.graphics.lineTo(n,e),this.graphics.strokePath();for(let n=0;n<=e;n+=mi)this.graphics.beginPath(),this.graphics.moveTo(0,n),this.graphics.lineTo(this.worldWidth,n),this.graphics.strokePath();const t=this.worldHeight-Ti;this.graphics.lineStyle(yc,Gn,bc),this.graphics.beginPath(),this.graphics.moveTo(0,t),this.graphics.lineTo(this.worldWidth,t),this.graphics.strokePath(),this.graphics.lineStyle(Sc,Gn,xc),this.graphics.fillStyle(Gn,wc),this.graphics.fillRect(0,t,this.worldWidth,e-t)}getGraphics(){return this.graphics}redraw(){this.draw()}destroy(){this.graphics&&this.graphics.destroy()}}class jc{listeners=new Map;on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set);const n=this.listeners.get(e);return n.add(t),{unsubscribe:()=>{n.delete(t),n.size===0&&this.listeners.delete(e)}}}once(e,t){const n=this.on(e,s=>{n.unsubscribe(),t(s)});return n}emit(e,t){const n=this.listeners.get(e);n&&n.forEach(s=>{try{s(t)}catch(r){console.error(`[EventBus] Error in listener for "${e}":`,r)}})}off(e){this.listeners.delete(e)}clear(){this.listeners.clear()}listenerCount(e){return this.listeners.get(e)?.size??0}}const Be=new jc,$e={ASSET_DROPPED:"asset:dropped",FRAME_DROPPED:"frame:dropped",SOCIAL_DROPPED:"social:dropped",MINIMAP_NAVIGATE:"minimap:navigate",DIALOG_ZONE_CREATE:"dialogZone:create",DIALOG_ZONE_CREATE_AT:"dialogZone:createAt",TEMP_ZONE_BUTTON_SHOW:"tempZoneButton:show",TEMP_ZONE_BUTTON_HIDE:"tempZoneButton:hide"};class qc{scene;groundY;worldWidth;worldHeight;itemManager;unsubscribers=[];constructor(e,t,n,s){this.scene=e,this.groundY=t,this.worldWidth=n,this.worldHeight=s}create(e){return this.itemManager=new Sn(this.scene,this.groundY,this.worldWidth,this.worldHeight,!0),e&&e.length>0&&this.itemManager.createItems(e),this.setupBackgroundDeselect(),this.setupStoreSubscriptions(),this.setupAssetDropListener(),this.setupDeleteKeys(),this.itemManager}setupBackgroundDeselect(){this.itemManager.setupBackgroundDeselect()}setupStoreSubscriptions(){const e=$n.subscribe(r=>{this.scene.data.set("selectedItemId",r),this.itemManager.updateSelectionVisuals()});this.unsubscribers.push(e);const t=Ke.subscribe(r=>{r==="dialogs"?(Ts(),this.itemManager.setInteractiveEnabled(!1)):this.itemManager.setInteractiveEnabled(!0)});this.unsubscribers.push(t);let n=[];const s=Nl.subscribe(r=>{if(!r?.placedItems)return;const a=r.placedItems;n.forEach(l=>{a.find(d=>d.id===l.id)||this.itemManager.removeItem(l.id)}),a.forEach(l=>{const o=n.find(d=>d.id===l.id);o&&JSON.stringify(o)!==JSON.stringify(l)&&this.itemManager.updateItem(l.id,l)}),n=a.map(l=>({...l}))});this.unsubscribers.push(s)}setupAssetDropListener(){const e=Be.on($e.ASSET_DROPPED,t=>{const{assetKey:n,canvasX:s,canvasY:r}=t,l=this.scene.cameras.main.getWorldPoint(s,r),o=Math.max(0,Math.min(this.worldWidth,l.x)),d=Math.max(0,Math.min(this.worldHeight,l.y));let u="behind";Aa.subscribe(g=>{u=g})();const f=gn.createAtWorldPosition(n,o,d,this.groundY,u);tc(f),this.itemManager.createItem(f),Fa(f.id),ei.set(!1)});this.unsubscribers.push(()=>e.unsubscribe())}setupDeleteKeys(){const e=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.DELETE,!1),t=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.BACKSPACE,!1),n=()=>{if(_i())return;const s=this.scene.data.get("selectedItemId");s&&Xa(s)};e.on("down",n),t.on("down",n)}getManager(){return this.itemManager}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.itemManager&&this.itemManager.destroy()}}class dr{scene;worldWidth;worldHeight;frames=new Map;unsubscribers=[];selectionGraphics=null;cleanupFunctions=new Map;doubleClickDetector=new Wa;constructor(e,t,n){this.scene=e,this.worldWidth=t,this.worldHeight=n}static preloadAssets(e){for(let t=1;t<=25;t++)e.load.image(`frame_base_${t}`,`assets/frames/base ${t}.png`)}create(e){this.selectionGraphics=this.scene.add.graphics(),this.selectionGraphics.setDepth(ze.SELECTION_GRAPHICS),e&&e.length>0&&e.forEach(t=>this.createFrame(t)),this.setupStoreSubscriptions(),this.setupFrameDropListener(),this.setupDeleteKeys()}createFrame(e){const t=`frame_${e.frameKey}`;if(!this.scene.textures.exists(t)){console.warn(`Frame texture not found: ${t}`);return}const n=e.scale??Mt,s=e.depth??ze.ITEMS_FRONT,r=(e.rotation??0)*(Math.PI/180),a=e.rotation===90,{innerWidth:l,innerHeight:o}=Wi(n,a),d=this.scene.add.graphics();d.setDepth(s-.1),fn(d,e.x,e.y,l,o,e.backgroundColor||Hi);const u=this.scene.add.sprite(e.x,e.y,t);u.setScale(n),u.setDepth(s),u.setOrigin(.5,.5),u.setRotation(r),u.setData("frameId",e.id);const h={sprite:u,background:d,data:e};this.frames.set(e.id,h),this.makeInteractive(h,e.id)}updateFrameVisuals(e){const{sprite:t,background:n,data:s}=e,r=`frame_${s.frameKey}`;t.texture.key!==r&&this.scene.textures.exists(r)&&t.setTexture(r);const a=s.scale??Mt;t.setScale(a);const l=(s.rotation??0)*(Math.PI/180);t.setRotation(l);const o=s.rotation===90,{innerWidth:d,innerHeight:u}=Wi(a,o);fn(n,t.x,t.y,d,u,s.backgroundColor||Hi)}moveContainer(e,t,n){const{sprite:s,background:r,data:a}=e;s.setPosition(t,n);const l=a.scale??Mt,o=a.rotation===90,{innerWidth:d,innerHeight:u}=Wi(l,o);fn(r,t,n,d,u,a.backgroundColor||Hi)}makeInteractive(e,t){const{sprite:n}=e,s=Ln({sprite:n,scene:this.scene,cursor:"grab",useGridSnapping:!0,constraints:{minX:0,maxX:this.worldWidth,minY:0,maxY:this.worldHeight},callbacks:{onSelect:()=>{Zi(t),this.updateSelectionVisuals()},isSelected:()=>ut(ji)===t,onDoubleClick:()=>this.doubleClickDetector.check(t)?(ka(),!0):!1,onDragStart:()=>{n.setTint($s)},onDrag:(r,a)=>{this.moveContainer(e,r,a),this.updateSelectionVisuals(),jl(t,r,a)},onDragEnd:(r,a)=>{n.clearTint(),ql(t),e.data.x=Math.round(r),e.data.y=Math.round(a),wt(t,{x:e.data.x,y:e.data.y})}}});this.cleanupFunctions.set(t,s)}setupStoreSubscriptions(){const e=ji.subscribe(r=>{this.scene.data.set("selectedFrameId",r),this.updateSelectionVisuals()});this.unsubscribers.push(e);const t=Ke.subscribe(r=>{r==="dialogs"?(Zi(null),this.setInteractiveEnabled(!1)):this.setInteractiveEnabled(!0)});this.unsubscribers.push(t);let n=[];const s=Ma.subscribe(r=>{n.forEach(a=>{r.find(o=>o.id===a.id)||this.removeFrame(a.id)}),r.forEach(a=>{const l=n.find(d=>d.id===a.id),o=this.frames.get(a.id);if(o&&l){const d=l.backgroundColor!==a.backgroundColor,u=l.textColor!==a.textColor,h=l.textSize!==a.textSize,f=JSON.stringify(l.texts)!==JSON.stringify(a.texts),g=l.rotation!==a.rotation,v=l.scale!==a.scale,S=l.frameKey!==a.frameKey;o.data=a,(d||u||h||f||g||v||S)&&(this.updateFrameVisuals(o),this.scene.data.get("selectedFrameId")===a.id&&this.updateSelectionVisuals())}}),n=r.map(a=>({...a}))});this.unsubscribers.push(s)}setupFrameDropListener(){const e=Be.on($e.FRAME_DROPPED,t=>{const{frameKey:n,canvasX:s,canvasY:r}=t,l=this.scene.cameras.main.getWorldPoint(s,r),o=Math.max(0,Math.min(this.worldWidth,l.x)),d=Math.max(0,Math.min(this.worldHeight,l.y)),u={id:kc(),frameKey:n,x:Math.round(o),y:Math.round(d),scale:Nc(n),depth:ze.ITEMS_FRONT,rotation:90,backgroundColor:Hi,textColor:"#333333",textSize:16,texts:[{language:"cs",text:""},{language:"en",text:""}]};hc(u),this.createFrame(u),Zi(u.id)});this.unsubscribers.push(()=>e.unsubscribe())}setupDeleteKeys(){const e=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.DELETE,!1),t=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.BACKSPACE,!1),n=()=>{if(_i())return;let s="items";if(Ke.subscribe(l=>s=l)(),s!=="frames")return;const a=this.scene.data.get("selectedFrameId");a&&Ps(a)};e.on("down",n),t.on("down",n)}updateSelectionVisuals(){if(!this.selectionGraphics)return;this.selectionGraphics.clear();const e=this.scene.data.get("selectedFrameId");if(!e){Kn(null);return}const t=this.frames.get(e);if(!t){Kn(null);return}const n=t.sprite,s=n.getBounds(),r=this.scene.cameras.main,{screenX:a,screenY:l}=jt(n.x,n.y,r);Kn({screenX:a,screenY:l,frameHeight:s.height*r.zoom}),this.selectionGraphics.lineStyle(3,10181046,1),this.selectionGraphics.strokeRect(s.x-4,s.y-4,s.width+8,s.height+8);const o=8;this.selectionGraphics.fillStyle(10181046,1),this.selectionGraphics.fillRect(s.x-4-o/2,s.y-4-o/2,o,o),this.selectionGraphics.fillRect(s.right+4-o/2,s.y-4-o/2,o,o),this.selectionGraphics.fillRect(s.x-4-o/2,s.bottom+4-o/2,o,o),this.selectionGraphics.fillRect(s.right+4-o/2,s.bottom+4-o/2,o,o)}removeFrame(e){const t=this.frames.get(e);t&&(t.sprite.destroy(),t.background.destroy(),this.frames.delete(e)),this.updateSelectionVisuals()}setInteractiveEnabled(e){this.frames.forEach(({sprite:t,background:n})=>{e?(t.setInteractive(),t.setAlpha(1),n.setAlpha(1)):(t.disableInteractive(),t.setAlpha(.6),n.setAlpha(.6))}),!e&&this.selectionGraphics&&this.selectionGraphics.clear()}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.frames.forEach(({sprite:e,background:t})=>{e.destroy(),t.destroy()}),this.frames.clear(),this.selectionGraphics&&(this.selectionGraphics.destroy(),this.selectionGraphics=null)}}class ur{scene;worldWidth;worldHeight;socials=new Map;unsubscribers=[];selectionGraphics=null;cleanupFunctions=new Map;doubleClickDetector=new Wa;constructor(e,t,n){this.scene=e,this.worldWidth=t,this.worldHeight=n}static preloadAssets(e){e.load.image("social_discord","assets/socials/Discord.png"),e.load.image("social_facebook","assets/socials/Facebook.png"),e.load.image("social_instagram","assets/socials/Instagram.png"),e.load.image("social_kofi","assets/socials/Ko Fi.png"),e.load.image("social_linkedin","assets/socials/LinkedIn.png"),e.load.image("social_patreon","assets/socials/Patreon.png"),e.load.image("social_tiktok","assets/socials/TikTok.png"),e.load.image("social_twitch","assets/socials/Twitch.png"),e.load.image("social_twitter","assets/socials/Twitter.png"),e.load.image("social_whatsapp","assets/socials/Whatsapp.png"),e.load.image("social_youtube","assets/socials/Youtube.png")}create(e){this.selectionGraphics=this.scene.add.graphics(),this.selectionGraphics.setDepth(ze.SELECTION_GRAPHICS),e&&e.length>0&&e.forEach(t=>this.createSocial(t)),this.setupStoreSubscriptions(),this.setupSocialDropListener(),this.setupDeleteKeys()}createSocial(e){const t=`social_${e.socialKey}`;if(!this.scene.textures.exists(t)){console.warn(`Social texture not found: ${t}`);return}const n=e.scale??bi,s=e.depth??ze.ITEMS_FRONT,r=this.scene.add.sprite(e.x,e.y,t);r.setScale(n),r.setDepth(s),r.setOrigin(.5,.5),r.setData("socialId",e.id),this.socials.set(e.id,{sprite:r,data:e}),this.makeInteractive(e.id)}updateSocialVisuals(e){const t=this.socials.get(e);if(!t)return;const{sprite:n,data:s}=t,r=`social_${s.socialKey}`;n.texture.key!==r&&this.scene.textures.exists(r)&&n.setTexture(r);const a=s.scale??bi;n.setScale(a)}makeInteractive(e){const t=this.socials.get(e);if(!t)return;const{sprite:n}=t,s=Ln({sprite:n,scene:this.scene,cursor:"grab",useGridSnapping:!0,constraints:{minX:0,maxX:this.worldWidth,minY:0,maxY:this.worldHeight},callbacks:{onSelect:()=>{Yi(e),this.updateSelectionVisuals()},isSelected:()=>ut(qi)===e,onDoubleClick:()=>this.doubleClickDetector.check(e)?(Pa(),!0):!1,onDragStart:()=>{n.setTint($s)},onDrag:()=>{this.updateSelectionVisuals()},onDragEnd:(r,a)=>{n.clearTint();const l=this.socials.get(e);l&&(l.data.x=Math.round(r),l.data.y=Math.round(a),un(e,{x:l.data.x,y:l.data.y}))}}});this.cleanupFunctions.set(e,s)}setupStoreSubscriptions(){const e=qi.subscribe(r=>{this.scene.data.set("selectedSocialId",r),this.updateSelectionVisuals()});this.unsubscribers.push(e);const t=Ke.subscribe(r=>{r==="dialogs"?(Yi(null),this.setInteractiveEnabled(!1)):this.setInteractiveEnabled(!0)});this.unsubscribers.push(t);let n=[];const s=Ul.subscribe(r=>{n.forEach(a=>{r.find(o=>o.id===a.id)||this.removeSocial(a.id)}),r.forEach(a=>{const l=n.find(d=>d.id===a.id),o=this.socials.get(a.id);if(o&&l){const d=l.scale!==a.scale,u=l.socialKey!==a.socialKey;o.data=a,(d||u)&&(this.updateSocialVisuals(a.id),this.scene.data.get("selectedSocialId")===a.id&&this.updateSelectionVisuals())}}),n=r.map(a=>({...a}))});this.unsubscribers.push(s)}setupSocialDropListener(){const e=Be.on($e.SOCIAL_DROPPED,t=>{const{socialKey:n,canvasX:s,canvasY:r}=t,l=this.scene.cameras.main.getWorldPoint(s,r),o=Math.max(0,Math.min(this.worldWidth,l.x)),d=Math.max(0,Math.min(this.worldHeight,l.y)),u={id:Zc(),socialKey:n,x:Math.round(o),y:Math.round(d),scale:bi,depth:ze.ITEMS_FRONT};fc(u),this.createSocial(u),Yi(u.id)});this.unsubscribers.push(()=>e.unsubscribe())}setupDeleteKeys(){const e=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.DELETE,!1),t=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.BACKSPACE,!1),n=()=>{if(_i())return;let s="items";if(Ke.subscribe(l=>s=l)(),s!=="socials")return;const a=this.scene.data.get("selectedSocialId");a&&As(a)};e.on("down",n),t.on("down",n)}updateSelectionVisuals(){if(!this.selectionGraphics)return;this.selectionGraphics.clear();const e=this.scene.data.get("selectedSocialId");if(!e){Bn(null);return}const t=this.socials.get(e);if(!t){Bn(null);return}const n=t.sprite,s=n.getBounds(),r=this.scene.cameras.main,{screenX:a,screenY:l}=jt(n.x,n.y,r);Bn({screenX:a,screenY:l,socialHeight:s.height*r.zoom}),this.selectionGraphics.lineStyle(3,15105570,1),this.selectionGraphics.strokeRect(s.x-4,s.y-4,s.width+8,s.height+8);const o=8;this.selectionGraphics.fillStyle(15105570,1),this.selectionGraphics.fillRect(s.x-4-o/2,s.y-4-o/2,o,o),this.selectionGraphics.fillRect(s.right+4-o/2,s.y-4-o/2,o,o),this.selectionGraphics.fillRect(s.x-4-o/2,s.bottom+4-o/2,o,o),this.selectionGraphics.fillRect(s.right+4-o/2,s.bottom+4-o/2,o,o)}removeSocial(e){const t=this.socials.get(e);t&&(t.sprite.destroy(),this.socials.delete(e));const n=this.cleanupFunctions.get(e);n&&(n(),this.cleanupFunctions.delete(e)),this.updateSelectionVisuals()}setInteractiveEnabled(e){this.socials.forEach(({sprite:t})=>{e?(t.setInteractive(),t.setAlpha(1)):(t.disableInteractive(),t.setAlpha(.6))}),!e&&this.selectionGraphics&&this.selectionGraphics.clear()}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.cleanupFunctions.forEach(e=>e()),this.cleanupFunctions.clear(),this.socials.forEach(({sprite:e})=>{e.destroy()}),this.socials.clear(),this.selectionGraphics&&(this.selectionGraphics.destroy(),this.selectionGraphics=null)}}const Xt=Ya-1,Ft=300,hr=150,Jc=.3,Qc=.5,Vn=40,fr=60,gr=16777215,pr=.6,mr=0,yt=60,vr=8;class ed{scene;worldWidth;worldHeight;graphics=null;zoneAreas=new Map;leftHandles=new Map;leftHandleVisuals=new Map;rightHandles=new Map;rightHandleVisuals=new Map;arrowGraphics=new Map;dragging=null;unsubscribers=[];createZoneSubscription;currentEditMode="items";currentZones=[];currentSelectedId=null;lastClickTime=0;lastClickX=0;DOUBLE_CLICK_THRESHOLD=300;DOUBLE_CLICK_DISTANCE=20;pendingTap=null;TAP_MAX_DURATION=300;TAP_MAX_DISTANCE=15;pendingZoneSelection=null;createZoneAtSubscription;boundWindowPointerUp=()=>{};boundWindowPointerMove=()=>{};currentScreenX=0;autoScrollTimer=null;constructor(e,t,n){this.scene=e,this.worldWidth=t,this.worldHeight=n}create(){this.graphics=this.scene.add.graphics(),this.graphics.setDepth(Xt);const e=Ke.subscribe(s=>{this.currentEditMode=s,this.render()});this.unsubscribers.push(e);const t=xs.subscribe(s=>{this.currentZones=s,this.render()});this.unsubscribers.push(t);const n=On.subscribe(s=>{this.currentSelectedId=s,this.render()});this.unsubscribers.push(n),this.scene.input.on("pointermove",this.handlePointerMove,this),this.scene.input.on("pointerup",this.handlePointerUp,this),this.boundWindowPointerUp=this.handlePointerUp.bind(this),this.boundWindowPointerMove=this.handleWindowPointerMove.bind(this),window.addEventListener("pointerup",this.boundWindowPointerUp),window.addEventListener("pointermove",this.boundWindowPointerMove),this.scene.input.on("pointerdown",this.handlePointerDown,this),this.createZoneSubscription=Be.on($e.DIALOG_ZONE_CREATE,()=>{this.createNewZone()}),this.createZoneAtSubscription=Be.on($e.DIALOG_ZONE_CREATE_AT,s=>{this.createZoneAtPosition(s.worldX)}),this.render()}clearVisuals(){this.graphics&&this.graphics.clear(),this.zoneAreas.forEach(e=>e.destroy()),this.zoneAreas.clear(),this.leftHandles.forEach(e=>e.destroy()),this.leftHandles.clear(),this.rightHandles.forEach(e=>e.destroy()),this.rightHandles.clear(),this.leftHandleVisuals.forEach(e=>e.destroy()),this.leftHandleVisuals.clear(),this.rightHandleVisuals.forEach(e=>e.destroy()),this.rightHandleVisuals.clear(),this.arrowGraphics.forEach(e=>e.destroy()),this.arrowGraphics.clear()}render(){if(this.clearVisuals(),this.currentEditMode==="dialogs")for(const e of this.currentZones)this.renderZone(e,e.id===this.currentSelectedId)}renderZone(e,t){if(!this.graphics)return;const n=N.Display.Color.HexStringToColor(e.color).color,s=t?Qc:Jc;this.graphics.fillStyle(n,s),this.graphics.fillRect(e.x,0,e.width,this.worldHeight),this.graphics.lineStyle(2,n,.8),this.graphics.strokeRect(e.x,0,e.width,this.worldHeight);const r=this.scene.add.rectangle(e.x+e.width/2,this.worldHeight/2,e.width-Vn*2,this.worldHeight);r.setOrigin(.5,.5),r.setInteractive({cursor:t?"grab":"pointer"}),r.setDepth(Xt+.1),r.setAlpha(.001),r.setData("zoneId",e.id),r.on("pointerdown",a=>{if(this.isClickOnUIElement(a))return;const l=Date.now(),o=l-this.lastClickTime<this.DOUBLE_CLICK_THRESHOLD&&Math.abs(a.worldX-this.lastClickX)<this.DOUBLE_CLICK_DISTANCE;this.lastClickTime=l,this.lastClickX=a.worldX;const d=this.currentSelectedId===e.id;if(o&&d){Ha();return}d?(this.scene.data.set("isDraggingItem",!0),yi(!0),this.startDrag(e.id,"move",a.worldX)):this.pendingZoneSelection={zoneId:e.id,worldX:a.worldX,startTime:l}}),this.zoneAreas.set(e.id,r),t&&this.createHandles(e)}createHandles(e){const t=this.scene.cameras.main.scrollY,n=this.scene.cameras.main.height,s=t+n/2,r=this.scene.add.rectangle(e.x,this.worldHeight/2,Vn,this.worldHeight);r.setOrigin(.5,.5),r.setDepth(Xt+.2),r.setFillStyle(gr,pr);const a=this.scene.add.rectangle(e.x,this.worldHeight/2,fr,this.worldHeight);a.setOrigin(.5,.5),a.setInteractive({cursor:"ew-resize"}),a.setDepth(Xt+.25),a.setAlpha(.001),a.setData("zoneId",e.id),a.setData("type","left"),a.on("pointerdown",f=>{this.isClickOnUIElement(f)||this.startDrag(e.id,"left",f.worldX)}),this.leftHandles.set(e.id,a),this.leftHandleVisuals.set(e.id,r);const l=8,o=this.scene.add.graphics();o.setDepth(Xt+.3),this.drawArrow(o,e.x-l,s,"left"),this.arrowGraphics.set(`${e.id}_left`,o);const d=this.scene.add.rectangle(e.x+e.width,this.worldHeight/2,Vn,this.worldHeight);d.setOrigin(.5,.5),d.setDepth(Xt+.2),d.setFillStyle(gr,pr);const u=this.scene.add.rectangle(e.x+e.width,this.worldHeight/2,fr,this.worldHeight);u.setOrigin(.5,.5),u.setInteractive({cursor:"ew-resize"}),u.setDepth(Xt+.25),u.setAlpha(.001),u.setData("zoneId",e.id),u.setData("type","right"),u.on("pointerdown",f=>{this.isClickOnUIElement(f)||this.startDrag(e.id,"right",f.worldX)}),this.rightHandles.set(e.id,u),this.rightHandleVisuals.set(e.id,d);const h=this.scene.add.graphics();h.setDepth(Xt+.3),this.drawArrow(h,e.x+e.width+l,s,"right"),this.arrowGraphics.set(`${e.id}_right`,h)}drawArrow(e,t,n,s){const a=s==="left"?-1:1;e.fillStyle(3355443,.8),e.beginPath(),e.moveTo(t+a*10+1,n),e.lineTo(t-a*10+1,n-10+1),e.lineTo(t-a*10+1,n+10-1),e.closePath(),e.fillPath(),e.fillStyle(16777215,.9),e.beginPath(),e.moveTo(t+a*10,n),e.lineTo(t-a*10,n-10),e.lineTo(t-a*10,n+10),e.closePath(),e.fillPath()}startDrag(e,t,n){const s=this.currentZones.find(r=>r.id===e);s&&(this.scene.data.set("isDraggingItem",!0),yi(!0),this.dragging={zoneId:e,type:t,startX:n,originalX:s.x,originalWidth:s.width})}getZoneBounds(e){let t=0,n=this.worldWidth;for(const s of this.currentZones){if(s.id===e)continue;const r=s.x+s.width,a=this.currentZones.find(l=>l.id===e);a&&(r<=a.x+a.width/2&&(t=Math.max(t,r+mr)),s.x>=a.x+a.width/2&&(n=Math.min(n,s.x-mr)))}return{minX:t,maxX:n-Ft,maxRight:n}}wouldOverlap(e,t,n){const s=t+n;for(const r of this.currentZones){if(r.id===e)continue;const a=r.x,l=r.x+r.width;if(t<l&&s>a)return!0}return!1}isClickOnUIElement(e){const t=e.downElement;return t?t.tagName?.toUpperCase()!=="CANVAS":!1}cancelPendingIfMoved(e){this.pendingTap&&Math.abs(e-this.pendingTap.worldX)>this.TAP_MAX_DISTANCE&&(this.pendingTap=null),this.pendingZoneSelection&&Math.abs(e-this.pendingZoneSelection.worldX)>this.TAP_MAX_DISTANCE&&(this.pendingZoneSelection=null)}screenToWorld(e,t){const n=this.scene.cameras.main,r=this.scene.game.canvas.getBoundingClientRect(),a=e-r.left,l=t-r.top;return $l(a,l,n)}handleWindowPointerMove(e){const t=this.screenToWorld(e.clientX,e.clientY);if(this.cancelPendingIfMoved(t.worldX),!this.dragging)return;const s=this.scene.game.canvas.getBoundingClientRect();e.clientX>=s.left&&e.clientX<=s.right&&e.clientY>=s.top&&e.clientY<=s.bottom||(this.currentScreenX=e.clientX-s.left,this.updateDrag(t.worldX),this.checkAutoScroll())}handlePointerMove(e){this.cancelPendingIfMoved(e.worldX),this.dragging&&(this.currentScreenX=e.x,e.event?.stopPropagation?.(),this.updateDrag(e.worldX),this.checkAutoScroll())}checkAutoScroll(){if(!this.dragging||this.dragging.type!=="move"){this.stopAutoScroll();return}const e=this.scene.cameras.main,t=e.width,n=this.currentZones.find(w=>w.id===this.dragging?.zoneId);if(!n)return;const s=Math.max(0,this.worldWidth-e.width/e.zoom);if(s<=0){this.stopAutoScroll();return}const{screenX:r}=jt(n.x,0,e),{screenX:a}=jt(n.x+n.width,0,e),l=r<=yt,o=a>=t-yt,d=e.scrollX>0,u=e.scrollX<s,h=n.x>0,f=n.x+n.width<this.worldWidth,g=this.currentScreenX<yt,v=this.currentScreenX>t-yt,m=l&&g&&d&&h||o&&v&&u&&f;m&&!this.autoScrollTimer?this.autoScrollTimer=this.scene.time.addEvent({delay:16,callback:this.performAutoScroll,callbackScope:this,loop:!0}):!m&&this.autoScrollTimer&&this.stopAutoScroll()}performAutoScroll(){if(!this.dragging||this.dragging.type!=="move"){this.stopAutoScroll();return}const e=this.scene.cameras.main,t=e.width,n=this.currentZones.find(y=>y.id===this.dragging?.zoneId);if(!n)return;let s=0;if(this.currentScreenX<yt){if(n.x<=0){this.stopAutoScroll();return}const m=(yt-this.currentScreenX)/yt;s=-vr*m}else if(this.currentScreenX>t-yt){if(n.x+n.width>=this.worldWidth){this.stopAutoScroll();return}const m=(this.currentScreenX-(t-yt))/yt;s=vr*m}if(s===0)return;const r=e.scrollX+s,a=0,l=Math.max(0,this.worldWidth-e.width/e.zoom),d=Math.max(a,Math.min(l,r))-e.scrollX;if(l<=0){this.stopAutoScroll();return}if(d===0){this.stopAutoScroll();return}const u=n.x+d,h=Math.max(0,Math.min(this.worldWidth-n.width,u)),f=h-n.x;if(f===0){this.stopAutoScroll();return}const g=e.scrollX+f,v=Math.max(0,Math.min(l,g));if(Math.abs(v-e.scrollX)>Math.abs(f)*2){this.stopAutoScroll();return}e.scrollX=v,this.wouldOverlap(n.id,h,n.width)||(fi(n.id,{x:h}),this.dragging.originalX+=f,this.dragging.startX+=f)}stopAutoScroll(){this.autoScrollTimer&&(this.autoScrollTimer.destroy(),this.autoScrollTimer=null)}updateDrag(e){if(!this.dragging)return;const t=e-this.dragging.startX,n=this.currentZones.find(r=>r.id===this.dragging?.zoneId);if(!n)return;const s=this.getZoneBounds(n.id);if(this.dragging.type==="left"){let r=this.dragging.originalX+t,a=this.dragging.originalWidth-t;if(r<0&&(a+=r,r=0),a<Ft&&(r=this.dragging.originalX+this.dragging.originalWidth-Ft,a=Ft),r<s.minX){const l=s.minX-r;r=s.minX,a-=l}a>=Ft&&!this.wouldOverlap(n.id,r,a)&&fi(n.id,{x:r,width:a})}else if(this.dragging.type==="right"){let r=this.dragging.originalWidth+t;r<Ft&&(r=Ft),n.x+r>this.worldWidth&&(r=this.worldWidth-n.x),n.x+r>s.maxRight&&(r=s.maxRight-n.x),r>=Ft&&!this.wouldOverlap(n.id,n.x,r)&&fi(n.id,{width:r})}else if(this.dragging.type==="move"){let r=this.dragging.originalX+t;const a=n.width;if(r<0&&(r=0),r+a>this.worldWidth&&(r=this.worldWidth-a),!this.wouldOverlap(n.id,r,a))fi(n.id,{x:r});else{const l=this.findNonOverlappingPosition(n.id,r,a);l!==null&&fi(n.id,{x:l})}}}findNonOverlappingPosition(e,t,n){const s=this.currentZones.filter(u=>u.id!==e).sort((u,h)=>u.x-h.x);if(s.length===0)return Math.max(0,Math.min(t,this.worldWidth-n));let r=t,a=1/0;const l=s[0];if(l.x>=n){const u=l.x-n,h=Math.max(0,Math.min(t,u)),f=Math.abs(h-t);f<a&&(a=f,r=h)}for(let u=0;u<s.length-1;u++){const h=s[u],f=s[u+1],g=h.x+h.width,v=f.x;if(v-g>=n){const y=g,m=v-n,w=Math.max(y,Math.min(t,m)),_=Math.abs(w-t);_<a&&(a=_,r=w)}}const o=s[s.length-1],d=o.x+o.width;if(this.worldWidth-d>=n){const u=d,h=this.worldWidth-n,f=Math.max(u,Math.min(t,h)),g=Math.abs(f-t);g<a&&(a=g,r=f)}return a<1/0&&!this.wouldOverlap(e,r,n)?r:null}handlePointerUp(e){if(this.dragging&&(this.stopAutoScroll(),this.scene.data.set("isDraggingItem",!1),yi(!1),this.dragging=null),this.pendingZoneSelection){let s=Date.now()-this.pendingZoneSelection.startTime<this.TAP_MAX_DURATION;s&&e&&e.worldX!==void 0&&(s=Math.abs(e.worldX-this.pendingZoneSelection.worldX)<this.TAP_MAX_DISTANCE),s&&Ni(this.pendingZoneSelection.zoneId),this.pendingZoneSelection=null}if(this.pendingTap&&this.currentEditMode==="dialogs"){if(Date.now()-this.pendingTap.startTime<this.TAP_MAX_DURATION){let s=!0;e&&e.worldX!==void 0&&(s=Math.abs(e.worldX-this.pendingTap.worldX)<this.TAP_MAX_DISTANCE),s&&this.showTempAddButton(this.pendingTap.worldX,this.pendingTap.worldY)}this.pendingTap=null}}handlePointerDown(e){if(ai()||this.currentEditMode!=="dialogs"||this.dragging)return;const t=e.downElement;if(t&&t.tagName?.toUpperCase()!=="CANVAS")return;const n=e.worldX;for(const l of this.currentZones)if(n>=l.x&&n<=l.x+l.width)return;const s=Date.now(),r=s-this.lastClickTime,a=Math.abs(n-this.lastClickX);if(r<this.DOUBLE_CLICK_THRESHOLD&&a<this.DOUBLE_CLICK_DISTANCE){this.createZoneAtPosition(n),this.lastClickTime=0,this.hideTempAddButton();return}this.lastClickTime=s,this.lastClickX=n,this.pendingTap={worldX:n,worldY:e.worldY,startTime:s},this.currentSelectedId&&Ni(null)}showTempAddButton(e,t){const n=this.scene.cameras.main,{screenX:s,screenY:r}=jt(e,t,n);Be.emit($e.TEMP_ZONE_BUTTON_SHOW,{screenX:s,screenY:r,worldX:e})}hideTempAddButton(){Be.emit($e.TEMP_ZONE_BUTTON_HIDE,{})}createZoneAtPosition(e){this.createZoneAt(e)}createNewZone(){const e=this.scene.cameras.main,t=e.worldView.x+e.worldView.width/2;this.createZoneAt(t)}createZoneAt(e){let t=e-hr/2;const n=hr;if(t=Math.max(0,Math.min(this.worldWidth-n,t)),this.wouldOverlap("",t,n)){const r=this.findNonOverlappingPosition("",t,n);if(r===null){console.warn("No room for a new dialog zone");return}t=r}const s=yl(t,n);s.x=t,uc(s),Ni(s.id)}updateSelectionVisuals(){if(this.currentEditMode!=="dialogs"){ln(null);return}if(!this.currentSelectedId){ln(null);return}const e=this.currentZones.find(a=>a.id===this.currentSelectedId);if(!e){ln(null);return}const t=this.scene.cameras.main,n=e.x+e.width/2,{screenX:s}=jt(n,0,t),r=t.height*.65;ln({screenX:s,screenY:r})}destroy(){this.hideTempAddButton();for(const e of this.unsubscribers)e();this.unsubscribers=[],this.createZoneSubscription&&this.createZoneSubscription.unsubscribe(),this.createZoneAtSubscription&&this.createZoneAtSubscription.unsubscribe(),this.stopAutoScroll(),this.scene.input.off("pointerdown",this.handlePointerDown,this),this.scene.input.off("pointermove",this.handlePointerMove,this),this.scene.input.off("pointerup",this.handlePointerUp,this),window.removeEventListener("pointerup",this.boundWindowPointerUp),window.removeEventListener("pointermove",this.boundWindowPointerMove),this.clearVisuals(),this.graphics&&(this.graphics.destroy(),this.graphics=null),this.dragging=null}}class td extends N.Scene{parallaxLayers=null;cameraController;playerController;gridOverlay;itemsController;framesController;socialsController;dialogZoneRenderer;config;minimapSubscription;isShuttingDown=!1;get itemManager(){return this.itemsController?.getManager()}resetZoom(){this.cameraController?.resetToFit()}constructor(){super({key:pt.BUILDER})}init(e){this.config=e.config}preload(){this.load.spritesheet("cat-idle-white","assets/sprites/white/Idle.png",{frameWidth:48,frameHeight:48}),Sn.preloadAssets(this),dr.preloadAssets(this),ur.preloadAssets(this)}create(){this.isShuttingDown=!1,this.physics.world.setBounds(0,0,this.config.worldWidth,this.config.worldHeight);const e=this.config.worldHeight-Ti;this.cameraController=new Kc(this,this.config.worldWidth,this.config.worldHeight),this.playerController=new Uc(this,this.config.worldWidth,this.config.worldHeight),this.gridOverlay=new Vc(this,this.config.worldWidth,this.config.worldHeight),this.itemsController=new qc(this,e,this.config.worldWidth,this.config.worldHeight),this.framesController=new dr(this,this.config.worldWidth,this.config.worldHeight),this.socialsController=new ur(this,this.config.worldWidth,this.config.worldHeight),this.dialogZoneRenderer=new ed(this,this.config.worldWidth,this.config.worldHeight),this.createBackground(),this.gridOverlay.create(),this.createGroundReference(),this.playerController.create(this.config.playerStartX,this.config.playerStartY),this.itemsController.create(this.config.placedItems||[]),this.framesController.create(this.config.placedFrames||[]),this.socialsController.create(this.config.placedSocials||[]),this.dialogZoneRenderer.create(),this.cameraController.setup(),this.cameraController.centerOn(this.config.playerStartX,this.config.playerStartY),this.minimapSubscription=Be.on($e.MINIMAP_NAVIGATE,t=>{this.navigateToPosition(t.worldX,t.worldY)}),this.scale.on("resize",this.handleResize,this),this.events.on("shutdown",this.shutdown,this)}async createBackground(){const e=Vi.getCurrentConfig();try{await Ea(this,e)}catch(t){console.error("Failed to load background:",t);return}this.parallaxLayers&&(Hl(this.parallaxLayers),this.parallaxLayers=null),this.parallaxLayers=Ia(this,this.config.worldWidth,this.config.worldHeight,e)}createGroundReference(){en.createVisualGround(this,{worldWidth:this.config.worldWidth,worldHeight:this.config.worldHeight,height:Ti})}update(){this.parallaxLayers&&Ca(this.parallaxLayers.baseLayer,this.cameras.main),this.itemManager?.updateSelectionVisuals(),this.framesController?.updateSelectionVisuals(),this.socialsController?.updateSelectionVisuals(),this.dialogZoneRenderer?.updateSelectionVisuals();const e=this.cameras.main,t=this.data.get("playerSprite");dc({scrollX:e.worldView.x,scrollY:e.worldView.y,viewWidth:e.width,viewHeight:e.height,worldWidth:this.config.worldWidth,worldHeight:this.config.worldHeight,zoom:e.zoom,playerX:t?.x??this.config.playerStartX,playerY:t?.y??this.config.playerStartY})}navigateToPosition(e,t){this.cameraController.centerOn(e,t)}handleResize(e){if(!(!this.cameras?.main||!this.config)){if(this.cameraController?.handleResize(),this.parallaxLayers?.baseLayer){const t=Math.max(this.config.worldHeight,e.height);this.parallaxLayers.baseLayer.setSize(this.config.worldWidth,t)}this.gridOverlay&&this.gridOverlay.redraw()}}shutdown(){this.isShuttingDown||(this.isShuttingDown=!0,this.scale.off("resize",this.handleResize,this),this.minimapSubscription&&this.minimapSubscription.unsubscribe(),this.cameraController&&this.cameraController.destroy(),this.playerController&&this.playerController.destroy(),this.gridOverlay&&this.gridOverlay.destroy(),this.itemsController&&this.itemsController.destroy(),this.framesController&&this.framesController.destroy(),this.socialsController&&this.socialsController.destroy(),this.dialogZoneRenderer&&this.dialogZoneRenderer.destroy())}}const id="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(id);vo();class nd{currentLanguage="cs";setLanguage(e){this.currentLanguage=e,localStorage.setItem("language",e)}getLanguage(){const e=localStorage.getItem("language");return(e==="cs"||e==="en")&&(this.currentLanguage=e),this.currentLanguage}toggleLanguage(){return this.currentLanguage=this.currentLanguage==="cs"?"en":"cs",this.setLanguage(this.currentLanguage),this.currentLanguage}}const Ga=new nd;let ht=null;function sd(i){ht=i}function rd(){if(!ht)return console.error("Scene manager not initialized"),null;try{return ht.scene.getScene(pt.GAME)?.mapConfig||null}catch(i){return console.error("Failed to get map config:",i),null}}function ad(i){if(!ht)return console.error("Scene manager not initialized"),!1;try{return ht.scene.getScene(pt.GAME)?(ht.scene.stop(pt.GAME),oc(i),ht.scene.start(pt.BUILDER,{config:i}),!0):(console.error("GameScene not found"),!1)}catch(e){return console.error("Failed to switch to builder:",e),!1}}function od(){if(!ht)return console.error("Scene manager not initialized"),!1;try{return ht.scene.stop(pt.BUILDER),lc(),ht.scene.start(pt.GAME,{useBuilderConfig:!0}),!0}catch(i){return console.error("Failed to switch to game:",i),!1}}function ld(){if(!ht){console.error("Scene manager not initialized");return}try{ht.scene.start(pt.GAME)}catch(i){console.error("Failed to start game scene:",i)}}var cd=H('<button class="close-btn svelte-yrmttr" title="Close">Ã</button>'),dd=H('<div class="resize-handle resize-handle-nw svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M9 9L1 1M5 1L1 1L1 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" fill="none"></path></svg></div>  <div class="resize-handle resize-handle-ne svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M1 9L9 1M5 1L9 1L9 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" fill="none"></path></svg></div>  <div class="resize-handle resize-handle-sw svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M9 1L1 9M1 5L1 9L5 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" fill="none"></path></svg></div>  <div class="resize-handle resize-handle-se svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M1 1L9 9M9 5L9 9L5 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" fill="none"></path></svg></div>',1),ud=H("<div><!></div> <!>",1),hd=H('<div data-ui=""><div class="panel-header svelte-yrmttr"><span class="panel-title svelte-yrmttr"> </span> <!> <div class="header-buttons svelte-yrmttr"><button class="minimize-btn svelte-yrmttr"> </button> <!></div></div> <!></div>');function Mi(i,e){Ee(e,!0);const t=()=>L(Kt,"$isDraggingInBuilder",n),[n,s]=Ye();let r=1e3,a=ce(e,"initialRight",3,10),l=ce(e,"initialTop",3,60),o=ce(e,"width",3,280),d=ce(e,"minWidth",3,200),u=ce(e,"minHeight",3,100),h=ce(e,"maxWidth",3,600),f=ce(e,"maxHeight",3,800),g=ce(e,"resizable",3,!1),v=ce(e,"startMinimized",3,!1),S=ce(e,"showClose",3,!1),y=K(ot(v())),m=K(!1),w=K(ot({x:0,y:0})),_=K(ot({width:o(),height:e.height??0})),b=K(!1),p=K(!1),x=K("se"),T=K(ot({x:0,y:0})),C=K(null),M=K(!1),I=K(ot(r)),k=K(null),D=K("");function O(){r++,$(I,r,!0)}function W(R,Y,re){let Ae=R;const Je=window.innerWidth-re-10;Ae>Je&&(Ae=Math.max(10,Je)),Ae<10&&(Ae=10);let Re=Y;const _t=window.innerHeight-40;return Re>_t&&(Re=Math.max(10,_t)),Re<10&&(Re=10),{x:Ae,y:Re}}Ne(()=>{if(typeof window>"u"||c(M))return;const R=localStorage.getItem(`panel-state-${e.panelId}`);if(R)try{const Y=JSON.parse(R),re=g()&&Y.width?Y.width:o(),ue=W(Y.x,Y.y,re);$(w,ue,!0),g()&&Y.width&&Y.height&&$(_,{width:Y.width,height:Y.height},!0);const ye=g()?{x:ue.x,y:ue.y,width:c(_).width,height:c(_).height}:{x:ue.x,y:ue.y};$(D,JSON.stringify(ye),!0)}catch{$(w,{x:window.innerWidth-o()-a(),y:l()},!0)}else $(w,{x:window.innerWidth-o()-a(),y:l()},!0);$(M,!0)}),Ne(()=>{if(!c(M))return;const R=g()?{x:c(w).x,y:c(w).y,width:c(_).width,height:c(_).height}:{x:c(w).x,y:c(w).y},Y=JSON.stringify(R);Y!==c(D)&&($(D,Y,!0),localStorage.setItem(`panel-state-${e.panelId}`,Y))}),Ne(()=>{if(!c(M))return;function R(){if(!c(C))return;const Y=g()?c(_).width:o();let re=c(w).x,ue=c(w).y,ye=!1;const Ae=window.innerWidth-Y;c(w).x>Ae&&(re=Math.max(10,Ae),ye=!0);const Je=window.innerHeight-40;c(w).y>Je&&(ue=Math.max(10,Je),ye=!0),c(w).x<0&&(re=10,ye=!0),c(w).y<0&&(ue=10,ye=!0),ye&&$(w,{x:re,y:ue},!0)}return window.addEventListener("resize",R),()=>{window.removeEventListener("resize",R)}});function B(){$(y,!c(y))}function X(){e.onclose?.()}function J(){if(g())if(c(m))c(k)&&($(w,{x:c(k).x,y:c(k).y},!0),$(_,{width:c(k).width,height:c(k).height},!0),$(k,null)),$(m,!1);else{$(k,{x:c(w).x,y:c(w).y,width:c(_).width,height:c(_).height},!0);const R=20,Y=Math.min(h(),window.innerWidth-R*2),re=Math.min(f(),window.innerHeight-R*2),ue=Math.max(R,(window.innerWidth-Y)/2),ye=Math.max(R,(window.innerHeight-re)/2);$(w,{x:ue,y:ye},!0),$(_,{width:Y,height:re},!0),$(m,!0)}}function ie(R){R.target.closest("button")||J()}function Z(R){R.target.closest("button")||($(b,!0),$(T,{x:R.clientX-c(w).x,y:R.clientY-c(w).y},!0),R.currentTarget.setPointerCapture(R.pointerId),R.preventDefault())}function te(R){if(!c(b))return;const Y=R.clientX-c(T).x,re=R.clientY-c(T).y,ue=window.innerWidth-(c(C)?.offsetWidth??o()),ye=window.innerHeight-40;$(w,{x:Math.max(0,Math.min(Y,ue)),y:Math.max(0,Math.min(re,ye))},!0)}function Ce(R){c(b)&&($(b,!1),R.currentTarget.releasePointerCapture(R.pointerId))}function pe(R){return Y=>{g()&&($(p,!0),$(x,R,!0),Y.currentTarget.setPointerCapture(Y.pointerId),Y.preventDefault(),Y.stopPropagation())}}function be(R){if(!c(p)||!c(C))return;const Y=c(C).getBoundingClientRect();let re,ue,ye=c(w).x,Ae=c(w).y;const Je=c(x)==="se"||c(x)==="ne",Re=c(x)==="se"||c(x)==="sw";Je?re=R.clientX-Y.left:(re=Y.right-R.clientX,ye=R.clientX),Re?ue=R.clientY-Y.top:(ue=Y.bottom-R.clientY,Ae=R.clientY);const _t=Math.max(d(),Math.min(h(),re)),q=Math.max(u(),Math.min(f(),ue));Je||(ye=Y.right-_t,ye<0&&(ye=0)),Re||(Ae=Y.bottom-q,Ae<0&&(Ae=0));const xe=Je?window.innerWidth-c(w).x-10:Y.right-10,le=Re?window.innerHeight-c(w).y-10:Y.bottom-10,Me=Math.min(_t,xe),he=Math.min(q,le);$(_,{width:Me,height:he},!0);let He=!1,Ve=c(w).x,li=c(w).y;!Je&&re>=d()&&(Ve=Math.max(0,ye),He=!0),!Re&&ue>=u()&&(li=Math.max(0,Ae),He=!0),He&&$(w,{x:Ve,y:li},!0)}function Te(R){c(p)&&($(p,!1),R.currentTarget.releasePointerCapture(R.pointerId))}function Ge(R){R.stopPropagation()}var we=hd();let Ue;we.__pointerdown=R=>{O(),Ge(R)},we.__click=Ge;var U=A(we);U.__pointerdown=Z,U.__pointermove=te,U.__pointerup=Ce,U.__dblclick=ie;var Se=A(U),de=A(Se),se=P(Se,2);{var ve=R=>{var Y=Oe(),re=fe(Y);Ii(re,()=>e.headerExtra),E(R,Y)};j(se,R=>{e.headerExtra&&R(ve)})}var _e=P(se,2),qe=A(_e);qe.__click=B;var Rt=A(qe),gt=P(qe,2);{var Gt=R=>{var Y=cd();Y.__click=X,E(R,Y)};j(gt,R=>{S()&&R(Gt)})}var $i=P(U,2);{var Ht=R=>{var Y=ud(),re=fe(Y);let ue;var ye=A(re);Ii(ye,()=>e.children);var Ae=P(re,2);{var Je=Re=>{var _t=dd(),q=fe(_t),xe=F(()=>pe("nw"));q.__pointerdown=function(...Ut){c(xe)?.apply(this,Ut)},q.__pointermove=be,q.__pointerup=Te;var le=P(q,2),Me=F(()=>pe("ne"));le.__pointerdown=function(...Ut){c(Me)?.apply(this,Ut)},le.__pointermove=be,le.__pointerup=Te;var he=P(le,2),He=F(()=>pe("sw"));he.__pointerdown=function(...Ut){c(He)?.apply(this,Ut)},he.__pointermove=be,he.__pointerup=Te;var Ve=P(he,2),li=F(()=>pe("se"));Ve.__pointerdown=function(...Ut){c(li)?.apply(this,Ut)},Ve.__pointermove=be,Ve.__pointerup=Te,ct("pointercancel",q,Te),ct("pointercancel",le,Te),ct("pointercancel",he,Te),ct("pointercancel",Ve,Te),E(Re,_t)};j(Ae,Re=>{g()&&Re(Je)})}G(()=>ue=Pe(re,1,"panel-body svelte-yrmttr",null,ue,{"has-fixed-height":g()&&c(_).height>0})),E(R,Y)};j($i,R=>{c(y)||R(Ht)})}ri(we,R=>$(C,R),()=>c(C)),G(()=>{Ue=Pe(we,1,"draggable-panel svelte-yrmttr",null,Ue,{minimized:c(y),maximized:c(m),dragging:c(b),resizing:c(p),resizable:g()}),ke(we,`left: ${c(w).x??""}px; top: ${c(w).y??""}px; width: ${c(y)?"auto":`${g()?c(_).width:o()}px`}; ${g()&&c(_).height>0&&!c(y)?`height: ${c(_).height}px;`:""}${t()?" pointer-events: none;":""} z-index: ${c(I)??""};`),De(de,e.title),V(qe,"title",c(y)?"Expand":"Minimize"),De(Rt,c(y)?"â²":"â¼")}),ct("pointercancel",U,Ce),E(i,we),Ie(),s()}vt(["pointerdown","click","pointermove","pointerup","dblclick"]);const _r=10,fd=150,gd=`
  position: fixed;
  pointer-events: none;
  z-index: 10000;
  opacity: 0.9;
  image-rendering: pixelated;
  filter: drop-shadow(3px 3px 0 rgba(0, 0, 0, 0.5));
  background: rgba(26, 26, 46, 0.9);
`,pd=`
  width: 100%;
  height: 100%;
  object-fit: contain;
  image-rendering: pixelated;
`;function Os(i,e,t){const{previewSize:n,borderColor:s,dataKey:r,eventName:a,onDrop:l}=i,o=n/2,d={startX:0,startY:0,hasMoved:!1,isActivated:!1,pendingKey:null,pendingTarget:null,longPressTimer:null};function u(I,k,D){Be.emit(a,{[r]:I,canvasX:k,canvasY:D}),l?.()}function h(I,k){const D=document.querySelector("canvas");if(!D)return null;const O=D.getBoundingClientRect();return I>=O.left&&I<=O.right&&k>=O.top&&k<=O.bottom?{canvasX:I-O.left,canvasY:k-O.top}:null}function f(I,k,D){const O=document.createElement("div");return O.className="touch-drag-preview",O.innerHTML=`<img src="${I}" alt="" />`,O.style.cssText=`
      ${gd}
      top: ${D-o}px;
      left: ${k-o}px;
      width: ${n}px;
      height: ${n}px;
      border: 2px solid ${s};
    `,O.querySelector("img").style.cssText=pd,document.body.appendChild(O),O}function g(I,k,D){I.style.top=`${D-o}px`,I.style.left=`${k-o}px`}function v(){d.longPressTimer&&(clearTimeout(d.longPressTimer),d.longPressTimer=null),d.pendingKey=null,d.pendingTarget=null,d.isActivated=!1,d.hasMoved=!1}function S(){v();const I=e();I.touchDragElement&&(I.touchDragElement.remove(),t({touchDragElement:null})),t({draggedKey:null}),on(!1)}function y(I,k){if(!I.dataTransfer)return;t({draggedKey:k}),on(!0),I.dataTransfer.effectAllowed="copy",I.dataTransfer.setData(r,k);const O=I.target.querySelector("img")?.cloneNode(!0);O&&(O.style.cssText="position: absolute; top: -1000px;",document.body.appendChild(O),I.dataTransfer.setDragImage(O,o,o),requestAnimationFrame(()=>O.remove()))}function m(){t({draggedKey:null}),on(!1)}function w(I){I.preventDefault(),I.dataTransfer&&(I.dataTransfer.dropEffect="copy")}function _(I){I.preventDefault();const k=I.dataTransfer?.getData(r);if(!k)return;const D=h(I.clientX,I.clientY);D&&u(k,D.canvasX,D.canvasY)}function b(I,k){if(!d.pendingKey||!d.pendingTarget||d.isActivated)return;d.isActivated=!0,t({draggedKey:d.pendingKey}),on(!0);const D=d.pendingTarget.querySelector("img");if(D){const O=f(D.src,I,k);t({touchDragElement:O})}}function p(I,k){if(I.touches.length!==1)return;const D=I.touches[0];d.startX=D.clientX,d.startY=D.clientY,d.hasMoved=!1,d.isActivated=!1,d.pendingKey=k,d.pendingTarget=I.currentTarget,d.longPressTimer=setTimeout(()=>{d.pendingKey&&!d.hasMoved&&b(D.clientX,D.clientY)},fd)}function x(I){const k=I.touches[0],D=k.clientX-d.startX,O=k.clientY-d.startY;if(!d.hasMoved&&(Math.abs(D)>_r||Math.abs(O)>_r)&&(d.hasMoved=!0,!d.isActivated)){if(Math.abs(O)>Math.abs(D)){v();return}b(k.clientX,k.clientY)}const W=e();d.isActivated&&W.touchDragElement&&(g(W.touchDragElement,k.clientX,k.clientY),I.preventDefault())}function T(I){const k=e(),D=d.isActivated,O=k.draggedKey;if(D&&O&&d.hasMoved){const W=I.changedTouches[0],B=h(W.clientX,W.clientY);B&&u(O,B.canvasX,B.canvasY)}S()}function C(){const I=document.querySelector("canvas");return I?(I.addEventListener("dragover",w),I.addEventListener("drop",_),()=>{I.removeEventListener("dragover",w),I.removeEventListener("drop",_)}):()=>{}}function M(){return document.addEventListener("touchmove",x,{passive:!1}),document.addEventListener("touchend",T),document.addEventListener("touchcancel",T),()=>{document.removeEventListener("touchmove",x),document.removeEventListener("touchend",T),document.removeEventListener("touchcancel",T)}}return{onDragStart:y,onDragEnd:m,onTouchStart:p,setupCanvasListeners:C,setupTouchListeners:M}}var md=H('<span class="palette-hint svelte-1ahretz">Drag to place</span>'),vd=H('<div data-ui="" draggable="true" role="button" tabindex="0"><img class="item-preview svelte-1ahretz"/></div>'),_d=H('<div class="palette-content svelte-1ahretz" role="toolbar" tabindex="-1"><div class="palette-grid svelte-1ahretz"></div></div>');function yd(i,e){Ee(e,!0);const t=()=>L(ei,"$isAssetPaletteOpen",s),n=()=>L(Ke,"$builderEditMode",s),[s,r]=Ye(),a="#4a90e2",l=600,o=Ms;function d(){return window.innerWidth<l}function u(){d()&&ei.set(!1)}let h=K(null),f=K(null);const g=Os({previewSize:48,borderColor:a,dataKey:"assetKey",eventName:$e.ASSET_DROPPED,onDrop:u},()=>({draggedKey:c(h),touchDragElement:c(f)}),b=>{"draggedKey"in b&&$(h,b.draggedKey??null,!0),"touchDragElement"in b&&$(f,b.touchDragElement??null,!0)});function v(b){b.stopPropagation()}function S(){ei.set(!1)}function y(b){const p=document.querySelector("canvas");if(!p)return;const x=p.getBoundingClientRect(),T=x.width/2,C=x.height/2;Be.emit($e.ASSET_DROPPED,{assetKey:b,canvasX:T,canvasY:C}),u()}rn(()=>g.setupCanvasListeners()),Ne(()=>g.setupTouchListeners());var m=Oe(),w=fe(m);{var _=b=>{Mi(b,{panelId:"asset-palette",title:"Assets",initialRight:10,initialTop:60,width:280,height:400,minWidth:200,minHeight:160,maxWidth:500,maxHeight:600,resizable:!0,showClose:!0,onclose:S,headerExtra:x=>{var T=md();E(x,T)},children:(x,T)=>{var C=_d();C.__pointerdown=v;var M=A(C);nt(M,21,()=>o,dt,(I,k)=>{var D=vd();let O;D.__touchstart=B=>g.onTouchStart(B,c(k).key),D.__dblclick=()=>y(c(k).key),ke(D,"",{},{"--accent-color":a});var W=A(D);G(()=>{O=Pe(D,1,"palette-item svelte-1ahretz",null,O,{dragging:c(h)===c(k).key}),V(D,"title",`${c(k).name??""} (double-click to place)`),V(W,"src",c(k).path),V(W,"alt",c(k).name)}),ct("dragstart",D,B=>g.onDragStart(B,c(k).key)),ct("dragend",D,function(...B){g.onDragEnd?.apply(this,B)}),E(I,D)}),E(x,C)},$$slots:{headerExtra:!0,default:!0}})};j(w,b=>{t()&&n()==="items"&&b(_)})}E(i,m),Ie(),r()}vt(["pointerdown","touchstart","dblclick"]);var bd=H('<span class="palette-hint svelte-jnw59q">Drag to place</span>'),wd=H('<div data-ui="" draggable="true" role="button" tabindex="0"><img class="item-preview svelte-jnw59q"/></div>'),Sd=H('<div class="palette-content svelte-jnw59q" role="toolbar" tabindex="-1"><div class="palette-grid svelte-jnw59q"></div></div>');function xd(i,e){Ee(e,!0);const t=()=>L(qt,"$isFramePaletteOpen",s),n=()=>L(Ke,"$builderEditMode",s),[s,r]=Ye(),a="#9b59b6",l=xn;let o=K(null),d=K(null);const u=Os({previewSize:64,borderColor:a,dataKey:"frameKey",eventName:$e.FRAME_DROPPED,onDrop:()=>{qt.set(!1)}},()=>({draggedKey:c(o),touchDragElement:c(d)}),m=>{"draggedKey"in m&&$(o,m.draggedKey??null,!0),"touchDragElement"in m&&$(d,m.touchDragElement??null,!0)});function h(m){m.stopPropagation()}function f(){qt.set(!1)}function g(m){const w=document.querySelector("canvas");if(!w)return;const _=w.getBoundingClientRect(),b=_.width/2,p=_.height/2;Be.emit($e.FRAME_DROPPED,{frameKey:m,canvasX:b,canvasY:p}),qt.set(!1)}rn(()=>u.setupCanvasListeners()),Ne(()=>u.setupTouchListeners());var v=Oe(),S=fe(v);{var y=m=>{Mi(m,{panelId:"frame-palette",title:"Frames",initialRight:10,initialTop:60,width:320,height:400,minWidth:220,minHeight:200,maxWidth:600,maxHeight:600,resizable:!0,showClose:!0,onclose:f,headerExtra:_=>{var b=bd();E(_,b)},children:(_,b)=>{var p=Sd();p.__pointerdown=h;var x=A(p);nt(x,21,()=>l,dt,(T,C)=>{var M=wd();let I;M.__touchstart=D=>u.onTouchStart(D,c(C).key),M.__dblclick=()=>g(c(C).key),ke(M,"",{},{"--accent-color":a});var k=A(M);G(()=>{I=Pe(M,1,"palette-item svelte-jnw59q",null,I,{dragging:c(o)===c(C).key}),V(M,"title",`${c(C).name??""} (double-click to place)`),V(k,"src",c(C).path),V(k,"alt",c(C).name)}),ct("dragstart",M,D=>u.onDragStart(D,c(C).key)),ct("dragend",M,function(...D){u.onDragEnd?.apply(this,D)}),E(T,M)}),E(_,p)},$$slots:{headerExtra:!0,default:!0}})};j(S,m=>{t()&&n()==="frames"&&m(y)})}E(i,v),Ie(),r()}vt(["pointerdown","touchstart","dblclick"]);var Ed=H('<span class="palette-hint svelte-whpd9j">Drag to place</span>'),Id=H('<div data-ui="" draggable="true" role="button" tabindex="0"><img class="item-preview svelte-whpd9j"/> <span class="item-name svelte-whpd9j"> </span></div>'),Cd=H('<div class="palette-content svelte-whpd9j" role="toolbar" tabindex="-1"><div class="palette-grid svelte-whpd9j"></div></div>');function Td(i,e){Ee(e,!0);const t=()=>L(Jt,"$isSocialPaletteOpen",s),n=()=>L(Ke,"$builderEditMode",s),[s,r]=Ye(),a="#e67e22",l=En;let o=K(null),d=K(null);const u=Os({previewSize:64,borderColor:a,dataKey:"socialKey",eventName:$e.SOCIAL_DROPPED,onDrop:()=>{Jt.set(!1)}},()=>({draggedKey:c(o),touchDragElement:c(d)}),m=>{"draggedKey"in m&&$(o,m.draggedKey??null,!0),"touchDragElement"in m&&$(d,m.touchDragElement??null,!0)});function h(m){m.stopPropagation()}function f(){Jt.set(!1)}function g(m){const w=document.querySelector("canvas");if(!w)return;const _=w.getBoundingClientRect(),b=_.width/2,p=_.height/2;Be.emit($e.SOCIAL_DROPPED,{socialKey:m,canvasX:b,canvasY:p}),Jt.set(!1)}rn(()=>u.setupCanvasListeners()),Ne(()=>u.setupTouchListeners());var v=Oe(),S=fe(v);{var y=m=>{Mi(m,{panelId:"social-palette",title:"Socials",initialRight:10,initialTop:60,width:280,height:350,minWidth:200,minHeight:200,maxWidth:500,maxHeight:500,resizable:!0,showClose:!0,onclose:f,headerExtra:_=>{var b=Ed();E(_,b)},children:(_,b)=>{var p=Cd();p.__pointerdown=h;var x=A(p);nt(x,21,()=>l,dt,(T,C)=>{var M=Id();let I;M.__touchstart=W=>u.onTouchStart(W,c(C).key),M.__dblclick=()=>g(c(C).key),ke(M,"",{},{"--accent-color":a});var k=A(M),D=P(k,2),O=A(D);G(()=>{I=Pe(M,1,"palette-item svelte-whpd9j",null,I,{dragging:c(o)===c(C).key}),V(M,"title",`${c(C).name??""} (double-click to place)`),V(k,"src",c(C).path),V(k,"alt",c(C).name),De(O,c(C).name)}),ct("dragstart",M,W=>u.onDragStart(W,c(C).key)),ct("dragend",M,function(...W){u.onDragEnd?.apply(this,W)}),E(T,M)}),E(_,p)},$$slots:{headerExtra:!0,default:!0}})};j(S,m=>{t()&&n()==="socials"&&m(y)})}E(i,v),Ie(),r()}vt(["pointerdown","touchstart","dblclick"]);var Dd=H("<button><!></button>");function oe(i,e){let t=ce(e,"variant",3,"default"),n=ce(e,"disabled",3,!1),s=ce(e,"title",3,"");const r={default:{base:"#4a90e2",hover:"#357abd",active:"#2a5f8f"},green:{base:"#27ae60",hover:"#229954",active:"#1e8449"},blue:{base:"#3498db",hover:"#2980b9",active:"#21618c"},orange:{base:"#ffa500",hover:"#ff8c00",active:"#e67e00"},red:{base:"#e74c3c",hover:"#c0392b",active:"#a02e22"},purple:{base:"#9b59b6",hover:"#8e44ad",active:"#7d3c98"},cyan:{base:"#17a2b8",hover:"#138496",active:"#0f6674"}},a=F(()=>r[t()]),l=F(()=>e.width?`--btn-width: ${e.width};`:"");var o=Dd();let d;o.__click=function(...h){e.onclick?.apply(this,h)};var u=A(o);Ii(u,()=>e.children??ft),G(()=>{d=Pe(o,1,"pixel-btn svelte-lwc0vq",null,d,{disabled:n()}),ke(o,`${c(l)??""} --color-base: ${c(a).base??""}; --color-hover: ${c(a).hover??""}; --color-active: ${c(a).active??""}`),o.disabled=n(),V(o,"title",s())}),E(i,o)}vt(["click"]);var kd=H("<button> </button>"),Pd=H('<div class="language-tabs svelte-ng6pis"></div>');function Ua(i,e){Ee(e,!0);let t=ce(e,"accentColor",3,"#88ddff");var n=Pd();nt(n,21,()=>Xl,dt,(s,r)=>{var a=kd();let l;a.__click=()=>e.onselect(c(r).code);let o;var d=A(a);G(()=>{l=Pe(a,1,"lang-tab svelte-ng6pis",null,l,{active:e.selectedLanguage===c(r).code}),o=ke(a,"",o,{"--accent-color":t()}),De(d,c(r).label)}),E(s,a)}),E(i,n),Ie()}vt(["click"]);var Ad=H("<button></button>"),Md=H('<div class="color-picker svelte-1jc3e0j"></div>'),$d=H('<div class="color-section svelte-1jc3e0j"><span class="color-label-title svelte-1jc3e0j"> </span> <button class="color-button svelte-1jc3e0j" title="Change color"><span class="color-preview svelte-1jc3e0j"></span> <span class="color-label svelte-1jc3e0j">Change</span></button> <!></div>');function os(i,e){Ee(e,!0);let t=ce(e,"label",3,"Color"),n=ce(e,"accentColor",3,"#88ddff"),s=K(!1),r=K(null);Ne(()=>{c(s)&&c(r)&&requestAnimationFrame(()=>{c(r)?.scrollIntoView({behavior:"smooth",block:"nearest"})})});function a(m){e.onselect(m)}function l(){$(s,!c(s))}var o=$d(),d=A(o),u=A(d),h=P(d,2);h.__click=l;let f;var g=A(h);let v;var S=P(h,2);{var y=m=>{var w=Md();nt(w,21,()=>e.colors,dt,(_,b)=>{var p=Ad();let x;p.__click=()=>a(c(b));let T;G(()=>{x=Pe(p,1,"color-swatch svelte-1jc3e0j",null,x,{selected:e.selectedColor===c(b)}),V(p,"title",c(b)),T=ke(p,"",T,{background:c(b),"--accent-color":n()})}),E(_,p)}),ri(w,_=>$(r,_),()=>c(r)),E(m,w)};j(S,m=>{c(s)&&m(y)})}G(()=>{De(u,t()),f=ke(h,"",f,{"--accent-color":n()}),v=ke(g,"",v,{background:e.selectedColor})}),E(i,o),Ie()}vt(["click"]);const yr=50,br=400,Od=400,Ld=70;var Rd=H('<div class="form-section svelte-jhtkop"><div class="form-group svelte-jhtkop"><label class="svelte-jhtkop"> </label> <input type="text" class="svelte-jhtkop"/></div> <div class="form-group svelte-jhtkop"><label class="svelte-jhtkop"> </label> <textarea rows="6" class="svelte-jhtkop"></textarea></div></div>');function Hd(i,e){Ee(e,!0);let t=ce(e,"titlePlaceholder",3,"Enter title..."),n=ce(e,"contentPlaceholder",3,"Enter text..."),s=ce(e,"idPrefix",3,"text-form"),r=ce(e,"accentColor",3,"#88ddff");function a(w){const _=w.target;e.ontitlechange(_.value)}function l(w){const _=w.target;e.oncontentchange(_.value)}var o=Rd();let d;var u=A(o),h=A(u),f=A(h),g=P(h,2);g.__input=a;var v=P(u,2),S=A(v),y=A(S),m=P(S,2);m.__input=l,G(()=>{d=ke(o,"",d,{"--accent-color":r()}),V(h,"for",`${s()??""}-title`),De(f,`Title (max ${yr} chars)`),V(g,"id",`${s()??""}-title`),Ki(g,e.title),V(g,"placeholder",t()),V(g,"maxlength",yr),V(S,"for",`${s()??""}-content`),De(y,`Content (max ${br} chars)`),V(m,"id",`${s()??""}-content`),Ki(m,e.content),V(m,"placeholder",n()),V(m,"maxlength",br)}),E(i,o),Ie()}vt(["input"]);var Xd=H('<div class="panel-content svelte-zzlycq"><!> <!> <div class="panel-extras svelte-zzlycq"><!></div> <div class="panel-footer svelte-zzlycq"><!> <!></div></div>');function Fd(i,e){Ee(e,!0);const t=()=>L(xs,"$dialogZones",r),n=()=>L(On,"$selectedDialogZoneId",r),s=()=>L(Is,"$isDialogZonePanelOpen",r),[r,a]=Ye(),l="#88ddff";let o=K(ot(Ta)),d=F(()=>t().find(b=>b.id===n())??null),u=F(()=>c(d)?.texts.find(b=>b.language===c(o))??null);function h(b){n()&&er(n(),c(o),{title:b})}function f(b){n()&&er(n(),c(o),{content:b})}function g(){n()&&(Na(n()),Js())}function v(){Js()}function S(b){n()&&fi(n(),{color:b})}function y(b){$(o,b,!0)}var m=Oe(),w=fe(m);{var _=b=>{Mi(b,{panelId:"dialog-zone-panel",title:"Dialog Zone",initialRight:10,initialTop:160,width:280,height:450,minWidth:250,minHeight:370,maxWidth:500,maxHeight:700,resizable:!0,showClose:!0,onclose:v,children:(p,x)=>{var T=Xd(),C=A(T);Ua(C,{get selectedLanguage(){return c(o)},onselect:y,accentColor:l});var M=P(C,2);{let B=F(()=>c(u)?.title??""),X=F(()=>c(u)?.content??"");Hd(M,{get title(){return c(B)},get content(){return c(X)},ontitlechange:h,oncontentchange:f,titlePlaceholder:"Enter title...",contentPlaceholder:"Enter dialog text...",idPrefix:"dialog",accentColor:l})}var I=P(M,2),k=A(I);os(k,{get colors(){return ns},get selectedColor(){return c(d).color},onselect:S,label:"Zone Color",accentColor:l});var D=P(I,2),O=A(D);oe(O,{variant:"cyan",onclick:v,children:(B,X)=>{var J=ae("CONFIRM");E(B,J)},$$slots:{default:!0}});var W=P(O,2);oe(W,{variant:"red",onclick:g,children:(B,X)=>{var J=ae("DELETE");E(B,J)},$$slots:{default:!0}}),E(p,T)},$$slots:{default:!0}})};j(w,b=>{c(d)&&s()&&b(_)})}E(i,m),Ie(),a()}var Nd=H("<button> </button>"),Zd=H("<option> </option>"),Yd=H("<button> </button>"),Wd=H('<a target="_blank" rel="noopener noreferrer" class="url-preview svelte-ds1z4d">Test link â</a>'),Bd=H('<button><img class="svelte-ds1z4d"/></button>'),zd=H('<div class="style-picker svelte-ds1z4d"></div>'),Kd=H('<div class="panel-content svelte-ds1z4d"><!> <div class="frame-size-row svelte-ds1z4d"><div class="frame-size-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Frame Size</span> <div class="size-buttons svelte-ds1z4d"></div></div> <div class="rotate-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Rotate</span> <button class="rotate-btn svelte-ds1z4d"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-ds1z4d"><path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg></button></div></div> <div class="panel-extras svelte-ds1z4d"><div class="text-section svelte-ds1z4d"><label for="frame-text" class="svelte-ds1z4d">Text</label> <textarea id="frame-text" placeholder="Enter text..." rows="3" class="svelte-ds1z4d"></textarea></div> <div class="size-rotation-row svelte-ds1z4d"><div class="size-section svelte-ds1z4d"><label for="text-size" class="svelte-ds1z4d">Text Size</label> <select id="text-size" class="svelte-ds1z4d"></select></div></div> <div class="text-align-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Text Alignment</span> <div class="align-buttons svelte-ds1z4d"></div></div> <div class="url-section svelte-ds1z4d"><label for="frame-url" class="svelte-ds1z4d">Link URL (opens on click)</label> <input id="frame-url" type="url" placeholder="https://example.com" class="svelte-ds1z4d"/> <!></div> <!> <!> <div class="style-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Frame Style</span> <button class="style-button svelte-ds1z4d" title="Change frame style"><img alt="Current frame" class="style-preview svelte-ds1z4d"/> <span class="style-label svelte-ds1z4d">Change Style</span></button> <!></div></div> <div class="panel-footer svelte-ds1z4d"><!> <!></div></div>');function Gd(i,e){Ee(e,!0);const t=()=>L(Ss,"$builderPreviewLanguage",a),n=()=>L(Jl,"$selectedFrame",a),s=()=>L(ji,"$selectedFrameId",a),r=()=>L(An,"$isFramePanelOpen",a),[a,l]=Ye(),o="#9b59b6";let d=F(t),u=F(n),h=F(()=>c(u)?.texts.find(X=>X.language===c(d))??null),f=F(()=>c(u)?Lc(c(u).scale??4):"M");function g(X){const J=X.target;if(!s()||!c(u))return;const ie=c(u).texts.map(Z=>Z.language===c(d)?{...Z,text:J.value}:Z);ie.some(Z=>Z.language===c(d))||ie.push({language:c(d),text:J.value}),wt(s(),{texts:ie})}function v(X){const J=X.target;s()&&wt(s(),{url:J.value||void 0})}function S(X){s()&&wt(s(),{backgroundColor:X})}function y(X){s()&&wt(s(),{textColor:X})}function m(X){const J=X.target;s()&&wt(s(),{textSize:parseInt(J.value,10)})}function w(X){s()&&wt(s(),{scale:Oc(X)})}function _(X){s()&&wt(s(),{textAlign:X})}function b(){if(!s()||!c(u))return;const J=(c(u).rotation??0)===0?90:0;wt(s(),{rotation:J})}function p(){s()&&Ps(s())}function x(){Bl(),Zi(null)}function T(X){Gl(X)}let C=K(!1),M=K(null),I=K(null);function k(X){s()&&wt(s(),{frameKey:X})}function D(){$(C,!c(C))}Ne(()=>{c(C)&&c(M)&&requestAnimationFrame(()=>{c(M)?.scrollIntoView({behavior:"smooth",block:"nearest"})})}),Ne(()=>{if(!c(C))return;function X(J){const ie=J.target;c(M)&&!c(M).contains(ie)&&c(I)&&!c(I).contains(ie)&&$(C,!1)}return document.addEventListener("click",X),()=>document.removeEventListener("click",X)});var O=Oe(),W=fe(O);{var B=X=>{Mi(X,{panelId:"frame-panel",title:"Edit Frame",initialRight:10,initialTop:160,width:280,height:520,minWidth:250,minHeight:450,maxWidth:500,maxHeight:700,resizable:!0,showClose:!0,onclose:x,children:(J,ie)=>{var Z=Kd(),te=A(Z);Ua(te,{get selectedLanguage(){return c(d)},onselect:T,accentColor:o});var Ce=P(te,2),pe=A(Ce),be=P(A(pe),2);nt(be,21,()=>Object.entries(Ba),dt,(q,xe)=>{var le=F(()=>Ir(c(xe),2));let Me=()=>c(le)[0],he=()=>c(le)[1].label;var He=Nd();let Ve;He.__click=()=>w(Me());var li=A(He);G(()=>{Ve=Pe(He,1,"size-btn svelte-ds1z4d",null,Ve,{active:c(f)===Me()}),V(He,"title",he()),De(li,Me())}),E(q,He)});var Te=P(pe,2),Ge=P(A(Te),2);Ge.__click=b;var we=P(Ce,2),Ue=A(we),U=P(A(Ue),2);U.__input=g;var Se=P(Ue,2),de=A(Se),se=P(A(de),2);se.__change=m,nt(se,21,()=>Mc,dt,(q,xe)=>{var le=Zd(),Me=A(le),he={};G(()=>{De(Me,`${c(xe)??""}px`),he!==(he=c(xe))&&(le.value=(le.__value=c(xe))??"")}),E(q,le)});var ve;dl(se);var _e=P(Se,2),qe=P(A(_e),2);nt(qe,21,()=>$c,dt,(q,xe)=>{let le=()=>c(xe).value,Me=()=>c(xe).label;var he=Yd();let He;he.__click=()=>_(le());var Ve=A(he);G(()=>{He=Pe(he,1,"align-btn svelte-ds1z4d",null,He,{active:(c(u).textAlign??Ka)===le()}),V(he,"title",Me()),De(Ve,Me())}),E(q,he)});var Rt=P(_e,2),gt=P(A(Rt),2);gt.__input=v;var Gt=P(gt,2);{var $i=q=>{var xe=Wd();G(()=>V(xe,"href",c(u).url)),E(q,xe)};j(Gt,q=>{c(u).url&&q($i)})}var Ht=P(Rt,2);{let q=F(()=>c(u).textColor??za);os(Ht,{get colors(){return Ac},get selectedColor(){return c(q)},onselect:y,label:"Text Color",accentColor:o})}var R=P(Ht,2);os(R,{get colors(){return Pc},get selectedColor(){return c(u).backgroundColor},onselect:S,label:"Background Color",accentColor:o});var Y=P(R,2),re=P(A(Y),2);re.__click=D;var ue=A(re);ri(re,q=>$(I,q),()=>c(I));var ye=P(re,2);{var Ae=q=>{var xe=zd();nt(xe,21,()=>xn,dt,(le,Me)=>{var he=Bd();let He;he.__click=()=>k(c(Me).key);var Ve=A(he);G(()=>{He=Pe(he,1,"style-item svelte-ds1z4d",null,He,{selected:c(u).frameKey===c(Me).key}),V(he,"title",c(Me).name),V(Ve,"src",c(Me).path),V(Ve,"alt",c(Me).name)}),E(le,he)}),ri(xe,le=>$(M,le),()=>c(M)),E(q,xe)};j(ye,q=>{c(C)&&q(Ae)})}var Je=P(we,2),Re=A(Je);oe(Re,{variant:"purple",onclick:x,children:(q,xe)=>{var le=ae("CONFIRM");E(q,le)},$$slots:{default:!0}});var _t=P(Re,2);oe(_t,{variant:"red",onclick:p,children:(q,xe)=>{var le=ae("DELETE");E(q,le)},$$slots:{default:!0}}),G(q=>{V(Ge,"title",c(u).rotation===90?"Portrait (click to rotate)":"Landscape (click to rotate)"),Ki(U,c(h)?.text??""),ve!==(ve=c(u).textSize??hn)&&(se.value=(se.__value=c(u).textSize??hn)??"",ua(se,c(u).textSize??hn)),Ki(gt,c(u).url??""),V(ue,"src",q)},[()=>xn.find(q=>q.key===c(u).frameKey)?.path??""]),E(J,Z)},$$slots:{default:!0}})};j(W,X=>{r()&&c(u)&&X(B)})}E(i,O),Ie(),l()}vt(["click","input","change"]);var Ud=H("<button> </button>"),Vd=H('<a target="_blank" rel="noopener noreferrer" class="url-preview svelte-1v3ae2c">Test link â</a>'),jd=H('<button><img class="svelte-1v3ae2c"/></button>'),qd=H('<div class="style-picker svelte-1v3ae2c"></div>'),Jd=H('<div class="panel-content svelte-1v3ae2c"><div class="social-size-row svelte-1v3ae2c"><div class="social-size-section svelte-1v3ae2c"><span class="section-label svelte-1v3ae2c">Size</span> <div class="size-buttons svelte-1v3ae2c"></div></div></div> <div class="panel-extras svelte-1v3ae2c"><div class="url-section svelte-1v3ae2c"><label for="social-url" class="svelte-1v3ae2c">Link URL (opens on click)</label> <input id="social-url" type="url" placeholder="https://example.com" class="svelte-1v3ae2c"/> <!></div> <div class="style-section svelte-1v3ae2c"><span class="section-label svelte-1v3ae2c">Social Icon</span> <button class="style-button svelte-1v3ae2c" title="Change social icon"><img alt="Current social" class="style-preview svelte-1v3ae2c"/> <span class="style-label svelte-1v3ae2c"> </span></button> <!></div></div> <div class="panel-footer svelte-1v3ae2c"><!> <!></div></div>');function Qd(i,e){Ee(e,!0);const t=()=>L(Vl,"$selectedSocial",r),n=()=>L(qi,"$selectedSocialId",r),s=()=>L(Mn,"$isSocialPanelOpen",r),[r,a]=Ye();let l=F(t),o=F(()=>c(l)?Wc(c(l).scale??bi):"M"),d=F(()=>c(l)?En.find(x=>x.key===c(l).socialKey):null);function u(x){const T=x.target;n()&&un(n(),{url:T.value||void 0})}function h(x){n()&&un(n(),{scale:Yc(x)})}function f(){n()&&As(n())}function g(){Kl(),Yi(null)}let v=K(!1),S=K(null),y=K(null);function m(x){n()&&un(n(),{socialKey:x})}function w(){$(v,!c(v))}Ne(()=>{c(v)&&c(S)&&requestAnimationFrame(()=>{c(S)?.scrollIntoView({behavior:"smooth",block:"nearest"})})}),Ne(()=>{if(!c(v))return;function x(T){const C=T.target;c(S)&&!c(S).contains(C)&&c(y)&&!c(y).contains(C)&&$(v,!1)}return document.addEventListener("click",x),()=>document.removeEventListener("click",x)});var _=Oe(),b=fe(_);{var p=x=>{Mi(x,{panelId:"social-panel",title:"Edit Social",initialRight:10,initialTop:160,width:280,height:350,minWidth:250,minHeight:300,maxWidth:400,maxHeight:500,resizable:!0,showClose:!0,onclose:g,children:(T,C)=>{var M=Jd(),I=A(M),k=A(I),D=P(A(k),2);nt(D,21,()=>Object.entries(Qi),dt,(U,Se)=>{var de=F(()=>Ir(c(Se),2));let se=()=>c(de)[0],ve=()=>c(de)[1].label;var _e=Ud();let qe;_e.__click=()=>h(se());var Rt=A(_e);G(()=>{qe=Pe(_e,1,"size-btn svelte-1v3ae2c",null,qe,{active:c(o)===se()}),V(_e,"title",ve()),De(Rt,se())}),E(U,_e)});var O=P(I,2),W=A(O),B=P(A(W),2);B.__input=u;var X=P(B,2);{var J=U=>{var Se=Vd();G(()=>V(Se,"href",c(l).url)),E(U,Se)};j(X,U=>{c(l).url&&U(J)})}var ie=P(W,2),Z=P(A(ie),2);Z.__click=w;var te=A(Z),Ce=P(te,2),pe=A(Ce);ri(Z,U=>$(y,U),()=>c(y));var be=P(Z,2);{var Te=U=>{var Se=qd();nt(Se,21,()=>En,dt,(de,se)=>{var ve=jd();let _e;ve.__click=()=>m(c(se).key);var qe=A(ve);G(()=>{_e=Pe(ve,1,"style-item svelte-1v3ae2c",null,_e,{selected:c(l).socialKey===c(se).key}),V(ve,"title",c(se).name),V(qe,"src",c(se).path),V(qe,"alt",c(se).name)}),E(de,ve)}),ri(Se,de=>$(S,de),()=>c(S)),E(U,Se)};j(be,U=>{c(v)&&U(Te)})}var Ge=P(O,2),we=A(Ge);oe(we,{variant:"orange",onclick:g,children:(U,Se)=>{var de=ae("CONFIRM");E(U,de)},$$slots:{default:!0}});var Ue=P(we,2);oe(Ue,{variant:"red",onclick:f,children:(U,Se)=>{var de=ae("DELETE");E(U,de)},$$slots:{default:!0}}),G(()=>{Ki(B,c(l).url??""),V(te,"src",c(d)?.path??""),De(pe,c(d)?.name??"Select")}),E(T,M)},$$slots:{default:!0}})};j(b,x=>{s()&&c(l)&&x(p)})}E(i,_),Ie(),a()}vt(["click","input"]);var eu=H("<div> </div>"),tu=H('<div class="frame-content-layer svelte-1vp2oo0"></div>');function Va(i,e){Ee(e,!0);const t=()=>L(Ma,"$placedFrames",d),n=()=>L(Da,"$isBuilderMode",d),s=()=>L(ks,"$builderCameraInfo",d),r=()=>L(ba,"$gameCameraInfo",d),a=()=>L(Ss,"$builderPreviewLanguage",d),l=()=>L(Gi,"$currentLanguage",d),o=()=>L(Es,"$draggingFramePositions",d),[d,u]=Ye();let h=F(t),f=F(()=>n()?s().scrollX:r().scrollX),g=F(()=>n()?s().scrollY:r().scrollY),v=F(()=>n()?s().zoom:r().zoom),S=F(()=>n()?a():l()),y=F(o);function m(p){const x=c(y).get(p.id);return x||{x:p.x,y:p.y}}function w(p){const x=p.scale??Mt,T=p.rotation===90,{textWidth:C,textHeight:M}=Wi(x,T),I=m(p),k=(I.x-c(f))*c(v),D=(I.y-c(g))*c(v);return{x:k,y:D,width:C*c(v),height:M*c(v)}}function _(p){return(p.texts.find(T=>T.language===c(S))||p.texts[0]||{text:""}).text||""}var b=tu();nt(b,21,()=>c(h),p=>p.id,(p,x)=>{const T=F(()=>w(c(x))),C=F(()=>_(c(x))),M=F(()=>(c(x).textSize??hn)*c(v)),I=F(()=>c(x).textColor??za),k=F(()=>c(x).textAlign??Ka);var D=Oe(),O=fe(D);{var W=B=>{var X=eu();let J;var ie=A(X);G(()=>{J=Pe(X,1,"frame-text svelte-1vp2oo0",null,J,{"align-top":c(k)==="top","align-center":c(k)==="center","align-bottom":c(k)==="bottom"}),ke(X,`
          left: ${c(T).x??""}px;
          top: ${c(T).y??""}px;
          width: ${c(T).width??""}px;
          height: ${c(T).height??""}px;
          font-size: ${c(M)??""}px;
          color: ${c(I)??""};
        `),De(ie,c(C))}),E(B,X)};j(O,B=>{c(C)&&B(W)})}E(p,D)}),E(i,b),Ie(),u()}var iu=H('<div class="temp-zone-button svelte-130i47e"><!></div>');function nu(i,e){Ee(e,!0);const t=()=>L(ks,"$builderCameraInfo",r),n=()=>L(Ke,"$builderEditMode",r),s=()=>L(Kt,"$isDraggingInBuilder",r),[r,a]=Ye();let l=K(null),o=null,d=null,u=K(null);function h(m){o&&clearTimeout(o),$(l,m,!0),$(u,t()?.scrollX??null,!0),o=setTimeout(()=>{$(l,null),$(u,null)},2e3)}function f(){c(l)&&(Be.emit($e.DIALOG_ZONE_CREATE_AT,{worldX:c(l).worldX}),$(l,null),$(u,null),o&&(clearTimeout(o),o=null))}function g(){$(l,null),$(u,null),o&&(clearTimeout(o),o=null)}rn(()=>{d=Be.on($e.TEMP_ZONE_BUTTON_SHOW,h);const m=Be.on($e.TEMP_ZONE_BUTTON_HIDE,g);return()=>{d?.unsubscribe(),m.unsubscribe()}}),gl(()=>{o&&clearTimeout(o)}),Ne(()=>{n()!=="dialogs"&&($(l,null),$(u,null))}),Ne(()=>{const m=t()?.scrollX;c(l)&&c(u)!==null&&m!==void 0&&Math.abs(m-c(u))>10&&($(l,null),$(u,null),o&&(clearTimeout(o),o=null))});var v=Oe(),S=fe(v);{var y=m=>{var w=iu(),_=A(w);oe(_,{variant:"cyan",width:"90px",onclick:f,children:(b,p)=>{var x=ae("+ ZONE");E(b,x)},$$slots:{default:!0}}),G(()=>ke(w,`left: ${c(l).screenX??""}px; top: ${c(l).screenY-50}px;${s()?" pointer-events: none;":""}`)),E(m,w)};j(S,m=>{c(l)&&n()==="dialogs"&&m(y)})}E(i,v),Ie(),a()}var su=H('<div class="item-controls svelte-1is3rex"><div class="controls-row svelte-1is3rex"><!> <!> <!> <!></div></div>');function ru(i,e){Ee(e,!0);const t=()=>L(Cs,"$selectedItem",u),n=()=>L(Oa,"$selectedItemScreenPosition",u),s=()=>L($n,"$selectedItemId",u),r=()=>L(Aa,"$itemDepthLayer",u),a=()=>L(Ql,"$selectedItemPhysicsEnabled",u),l=()=>L(ec,"$selectedItemFlipX",u),o=()=>L(Ke,"$builderEditMode",u),d=()=>L(Kt,"$isDraggingInBuilder",u),[u,h]=Ye();let f=F(()=>t()?pc(t().assetKey):!1),g=F(()=>{const p=n();if(!p)return null;const x=10,T=40,C=c(f)?380:290;let M=p.screenY-p.itemHeight/2-45;const I=x+T;M<I&&(M=p.screenY+p.itemHeight/2+10);const k=window.innerHeight-T-x;M>k&&(M=k);let D=p.screenX;const O=C/2,W=O+x,B=window.innerWidth-O-x;return D<W&&(D=W),D>B&&(D=B),{x:D,y:M}});function v(){if(!s())return;const p=r()==="behind"?"front":"behind",x=ws(p);nc(),sc(s(),x)}function S(){s()&&rc(s(),!a())}function y(){s()&&ac(s(),!l())}function m(){s()&&(Xa(s()),Ts())}var w=Oe(),_=fe(w);{var b=p=>{var x=su(),T=A(x),C=A(T);{let O=F(()=>r()==="behind"?"blue":"orange"),W=F(()=>a()?"Solid items must be behind player":"Toggle item depth: behind or in front of player");oe(C,{get variant(){return c(O)},get title(){return c(W)},onclick:v,get disabled(){return a()},children:(B,X)=>{var J=ae();G(()=>De(J,r()==="behind"?"Front":"Back")),E(B,J)},$$slots:{default:!0}})}var M=P(C,2);{let O=F(()=>l()?"orange":"blue");oe(M,{get variant(){return c(O)},title:"Flip item horizontally",onclick:y,children:(W,B)=>{var X=ae("Flip");E(W,X)},$$slots:{default:!0}})}var I=P(M,2);{var k=O=>{{let W=F(()=>a()?"orange":"blue");oe(O,{get variant(){return c(W)},title:"Toggle physics: item will block player movement",onclick:S,children:(B,X)=>{var J=ae();G(()=>De(J,a()?"Ghost":"Solid")),E(B,J)},$$slots:{default:!0}})}};j(I,O=>{c(f)&&O(k)})}var D=P(I,2);oe(D,{variant:"red",title:"Delete selected item",onclick:m,children:(O,W)=>{var B=ae("DEL");E(O,B)},$$slots:{default:!0}}),G(()=>ke(x,`left: ${c(g).x??""}px; top: ${c(g).y??""}px;${d()?" pointer-events: none;":""}`)),E(p,x)};j(_,p=>{o()!=="dialogs"&&s()&&c(g)&&p(b)})}E(i,w),Ie(),h()}var au=H('<div class="frame-controls svelte-eqt3a9"><div class="controls-row svelte-eqt3a9"><!> <!></div></div>');function ou(i,e){Ee(e,!0);const t=()=>L(La,"$selectedFrameScreenPosition",a),n=()=>L(ji,"$selectedFrameId",a),s=()=>L(Ke,"$builderEditMode",a),r=()=>L(Kt,"$isDraggingInBuilder",a),[a,l]=Ye();let o=F(()=>{const v=t();if(!v)return null;const S=10,y=40,m=190;let w=v.screenY-v.frameHeight/2-45;const _=S+y;w<_&&(w=v.screenY+v.frameHeight/2+10);const b=window.innerHeight-y-S;w>b&&(w=b);let p=v.screenX;const x=m/2,T=x+S,C=window.innerWidth-x-S;return p<T&&(p=T),p>C&&(p=C),{x:p,y:w}});function d(){ka()}function u(){n()&&(Ps(n()),Zi(null))}var h=Oe(),f=fe(h);{var g=v=>{var S=au(),y=A(S),m=A(y);oe(m,{variant:"purple",title:"Edit frame content (or double-click)",onclick:d,children:(_,b)=>{var p=ae("EDIT");E(_,p)},$$slots:{default:!0}});var w=P(m,2);oe(w,{variant:"red",title:"Delete selected frame",onclick:u,children:(_,b)=>{var p=ae("DEL");E(_,p)},$$slots:{default:!0}}),G(()=>ke(S,`left: ${c(o).x??""}px; top: ${c(o).y??""}px;${r()?" pointer-events: none;":""}`)),E(v,S)};j(f,v=>{s()!=="dialogs"&&n()&&c(o)&&v(g)})}E(i,h),Ie(),l()}var lu=H('<div class="zone-controls svelte-sm01rq"><div class="controls-row svelte-sm01rq"><!> <!> <!></div></div>');function cu(i,e){Ee(e,!0);const t=()=>L(Ra,"$selectedDialogZoneScreenPosition",a),n=()=>L(On,"$selectedDialogZoneId",a),s=()=>L(Ke,"$builderEditMode",a),r=()=>L(Kt,"$isDraggingInBuilder",a),[a,l]=Ye();let o=F(()=>{const S=t();if(!S)return null;const y=10,m=120,w=85;let _=S.screenY;const b=y+m/2,p=window.innerHeight-m/2-y;_<b&&(_=b),_>p&&(_=p);let x=S.screenX;const T=w/2,C=T+y,M=window.innerWidth-T-y;return x<C&&(x=C),x>M&&(x=M),{x,y:_}});function d(){Ha()}function u(){n()&&(Na(n()),Ni(null))}function h(){Ni(null)}var f=Oe(),g=fe(f);{var v=S=>{var y=lu(),m=A(y),w=A(m);oe(w,{variant:"cyan",title:"Edit zone content (or double-click)",onclick:d,children:(p,x)=>{var T=ae("EDIT");E(p,T)},$$slots:{default:!0}});var _=P(w,2);oe(_,{variant:"red",title:"Delete selected zone",onclick:u,children:(p,x)=>{var T=ae("DEL");E(p,T)},$$slots:{default:!0}});var b=P(_,2);oe(b,{variant:"default",title:"Deselect zone",onclick:h,children:(p,x)=>{var T=ae("DONE");E(p,T)},$$slots:{default:!0}}),G(()=>ke(y,`left: ${c(o).x??""}px; top: ${c(o).y??""}px;${r()?" pointer-events: none;":""}`)),E(S,y)};j(g,S=>{s()==="dialogs"&&n()&&c(o)&&S(v)})}E(i,f),Ie(),l()}var du=H('<div class="social-controls svelte-1v4dckp"><div class="controls-row svelte-1v4dckp"><!> <!></div></div>');function uu(i,e){Ee(e,!0);const t=()=>L($a,"$selectedSocialScreenPosition",a),n=()=>L(qi,"$selectedSocialId",a),s=()=>L(Ke,"$builderEditMode",a),r=()=>L(Kt,"$isDraggingInBuilder",a),[a,l]=Ye();let o=F(()=>{const v=t();if(!v)return null;const S=10,y=40,m=190;let w=v.screenY-v.socialHeight/2-45;const _=S+y;w<_&&(w=v.screenY+v.socialHeight/2+10);const b=window.innerHeight-y-S;w>b&&(w=b);let p=v.screenX;const x=m/2,T=x+S,C=window.innerWidth-x-S;return p<T&&(p=T),p>C&&(p=C),{x:p,y:w}});function d(){Pa()}function u(){n()&&(As(n()),Yi(null))}var h=Oe(),f=fe(h);{var g=v=>{var S=du(),y=A(S),m=A(y);oe(m,{variant:"orange",title:"Edit social settings (or double-click)",onclick:d,children:(_,b)=>{var p=ae("EDIT");E(_,p)},$$slots:{default:!0}});var w=P(m,2);oe(w,{variant:"red",title:"Delete selected social",onclick:u,children:(_,b)=>{var p=ae("DEL");E(_,p)},$$slots:{default:!0}}),G(()=>ke(S,`left: ${c(o).x??""}px; top: ${c(o).y??""}px;${r()?" pointer-events: none;":""}`)),E(v,S)};j(f,v=>{s()!=="dialogs"&&n()&&c(o)&&v(g)})}E(i,h),Ie(),l()}var hu=H('<div class="hstack svelte-8vtf35"><!></div>');function fu(i,e){let t=ce(e,"gap",3,"10px"),n=ce(e,"align",3,"center");var s=hu(),r=A(s);Ii(r,()=>e.children??ft),G(()=>ke(s,`gap: ${t()??""}; align-items: ${(n()==="start"?"flex-start":n()==="end"?"flex-end":n())??""};`)),E(i,s)}var gu=H('<div class="vstack svelte-1y4dqnf"><!></div>');function pu(i,e){let t=ce(e,"gap",3,"10px"),n=ce(e,"align",3,"stretch");var s=gu(),r=A(s);Ii(r,()=>e.children??ft),G(()=>ke(s,`gap: ${t()??""}; align-items: ${(n()==="start"?"flex-start":n()==="end"?"flex-end":n())??""};`)),E(i,s)}var mu=H("<div><!></div>");function wr(i,e){const t=()=>L(Kt,"$isDraggingInBuilder",n),[n,s]=Ye();let r=ce(e,"padding",3,"10px");var a=mu();let l;var o=A(a);Ii(o,()=>e.children??ft),G(()=>{l=Pe(a,1,`fixed fixed--${e.position??""}`,"svelte-vwlo0e",l,{"dragging-in-builder":t()}),ke(a,`--padding: ${r()??""};`)}),E(i,a),s()}var vu=H("<div><!> <!></div>"),_u=H("<!> <!>",1),yu=H("<!> <!> <!> <!>",1),bu=H("<div><!></div>"),wu=H("<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!>",1);function Su(i,e){Ee(e,!0);const t=()=>L($n,"$selectedItemId",h),n=()=>L(ji,"$selectedFrameId",h),s=()=>L(On,"$selectedDialogZoneId",h),r=()=>L(qi,"$selectedSocialId",h),a=()=>L(Ke,"$builderEditMode",h),l=()=>L(wn,"$gridSnappingEnabled",h),o=()=>L(ei,"$isAssetPaletteOpen",h),d=()=>L(qt,"$isFramePaletteOpen",h),u=()=>L(Jt,"$isSocialPaletteOpen",h),[h,f]=Ye(),g=600;let v=K(ot(typeof window<"u"?window.innerWidth<g:!1)),S=F(()=>c(v)&&(t()!==null||n()!==null||s()!==null||r()!==null));Ne(()=>{function ie(){$(v,window.innerWidth<g)}return window.addEventListener("resize",ie),()=>window.removeEventListener("resize",ie)});function y(){od()}function m(){Zl()}function w(){Be.emit($e.DIALOG_ZONE_CREATE)}var _=wu(),b=fe(_);ru(b,{});var p=P(b,2);ou(p,{});var x=P(p,2);cu(x,{});var T=P(x,2);uu(T,{});var C=P(T,2);{var M=ie=>{yd(ie,{})},I=ie=>{var Z=Oe(),te=fe(Z);{var Ce=be=>{Fd(be,{})},pe=be=>{var Te=Oe(),Ge=fe(Te);{var we=U=>{xd(U,{})},Ue=U=>{var Se=Oe(),de=fe(Se);{var se=ve=>{Td(ve,{})};j(de,ve=>{a()==="socials"&&ve(se)},!0)}E(U,Se)};j(Ge,U=>{a()==="frames"?U(we):U(Ue,!1)},!0)}E(be,Te)};j(te,be=>{a()==="dialogs"?be(Ce):be(pe,!1)},!0)}E(ie,Z)};j(C,ie=>{a()==="items"?ie(M):ie(I,!1)})}var k=P(C,2);Gd(k,{});var D=P(k,2);Qd(D,{});var O=P(D,2);Va(O,{});var W=P(O,2);nu(W,{});var B=P(W,2),X=P(B,2);wr(X,{position:"top-left",children:(ie,Z)=>{var te=vu();let Ce;var pe=A(te);oe(pe,{variant:"green",width:"100px",onclick:y,children:(Te,Ge)=>{var we=ae("SAVE");E(Te,we)},$$slots:{default:!0}});var be=P(pe,2);{let Te=F(()=>l()?"blue":"orange");oe(be,{get variant(){return c(Te)},width:"80px",onclick:m,title:"Toggle grid snapping",children:(Ge,we)=>{var Ue=ae();G(()=>De(Ue,l()?"FREE":"SNAP")),E(Ge,Ue)},$$slots:{default:!0}})}G(()=>Ce=Pe(te,1,"left-buttons svelte-1vm8op7",null,Ce,{"hide-left":c(S)})),E(ie,te)},$$slots:{default:!0}});var J=P(X,2);wr(J,{position:"top-right",children:(ie,Z)=>{var te=bu();let Ce;var pe=A(te);pu(pe,{align:"end",children:(be,Te)=>{var Ge=yu(),we=fe(Ge);{let de=F(()=>a()==="items"&&o()?"orange":"blue");oe(we,{get variant(){return c(de)},onclick:()=>{a()==="items"?Yl():(Oi("items"),ei.set(!0))},title:"Edit assets/items",children:(se,ve)=>{var _e=ae("ASSETS");E(se,_e)},$$slots:{default:!0}})}var Ue=P(we,2);{let de=F(()=>a()==="frames"&&d()?"orange":"purple");oe(Ue,{get variant(){return c(de)},onclick:()=>{a()==="frames"?Wl():(Oi("frames"),qt.set(!0))},title:"Edit text frames",children:(se,ve)=>{var _e=ae("FRAMES");E(se,_e)},$$slots:{default:!0}})}var U=P(Ue,2);{let de=F(()=>(a()==="socials"&&u(),"orange"));oe(U,{get variant(){return c(de)},onclick:()=>{a()==="socials"?zl():(Oi("socials"),Jt.set(!0))},title:"Edit social icons",children:(se,ve)=>{var _e=ae("SOCIALS");E(se,_e)},$$slots:{default:!0}})}var Se=P(U,2);fu(Se,{children:(de,se)=>{var ve=_u(),_e=fe(ve);{var qe=gt=>{oe(gt,{variant:"cyan",width:"100px",onclick:w,title:"Create new dialog zone at center of view",children:(Gt,$i)=>{var Ht=ae("+ ZONE");E(Gt,Ht)},$$slots:{default:!0}})};j(_e,gt=>{a()==="dialogs"&&gt(qe)})}var Rt=P(_e,2);{let gt=F(()=>a()==="dialogs"?"orange":"cyan");oe(Rt,{get variant(){return c(gt)},onclick:()=>{a()==="dialogs"?Oi("items"):Oi("dialogs")},title:"Edit dialog zones",children:(Gt,$i)=>{var Ht=ae("DIALOGS");E(Gt,Ht)},$$slots:{default:!0}})}E(de,ve)},$$slots:{default:!0}}),E(be,Ge)},$$slots:{default:!0}}),G(()=>Ce=Pe(te,1,"right-buttons svelte-1vm8op7",null,Ce,{"hide-right":c(S)})),E(ie,te)},$$slots:{default:!0}}),E(i,_),Ie(),f()}var xu=H('<button class="background-card svelte-crre06" type="button"><div class="preview-container svelte-crre06"><img class="preview-image svelte-crre06"/></div> <span class="background-name svelte-crre06"> </span></button>'),Eu=H('<div class="background-select-screen svelte-crre06"><div class="content svelte-crre06"><h1 class="title svelte-crre06">SELECT BACKGROUND</h1> <div class="backgrounds-grid svelte-crre06"></div></div></div>');function Iu(i,e){Ee(e,!1);const t=bt;function n(o){return`./assets/backgrounds/${o}/preview.png`}function s(o){Vi.setBackgroundByIndex(o),ga.set(t[o].name),pa.set(!0),ld()}fa();var r=Eu(),a=A(r),l=P(A(a),2);nt(l,5,()=>t,dt,(o,d,u)=>{var h=xu();h.__click=()=>s(u);var f=A(h),g=A(f),v=P(f,2),S=A(v);G(y=>{V(g,"src",y),V(g,"alt",c(d).name),De(S,c(d).name)},[()=>n(c(d).folder)]),E(o,h)}),E(i,r),Ie()}vt(["click"]);var Cu=H("<div> </div>"),Tu=H('<div class="dialog-content svelte-1jd14ss"> </div>'),Du=H("<div><!> <!></div>");function ku(i,e){Ee(e,!0);const t=()=>L(Sl,"$activeDialogText",s),n=()=>L(ya,"$playerScreenPosition",s),[s,r]=Ye();let a=F(()=>t()?.title&&t()?.content),l=F(()=>Math.max(10,window.innerHeight-n().y+Ld)),o=F(()=>window.innerWidth<=Od),d=F(()=>c(o)?50:n().x),u=F(()=>c(o)?"percent":"px");var h=Oe(),f=fe(h);{var g=v=>{var S=Du();let y;var m=A(S);{var w=p=>{var x=Cu();let T;var C=A(x);G(()=>{T=Pe(x,1,"dialog-title svelte-1jd14ss",null,T,{"has-divider":c(a)}),De(C,t().title)}),E(p,x)};j(m,p=>{t().title&&p(w)})}var _=P(m,2);{var b=p=>{var x=Tu(),T=A(x);G(()=>De(T,t().content)),E(p,x)};j(_,p=>{t().content&&p(b)})}G(()=>{y=Pe(S,1,"dialog-bubble svelte-1jd14ss",null,y,{narrow:c(o)}),ke(S,`bottom: ${c(l)??""}px; left: ${c(d)??""}${c(u)??""};`)}),E(v,S)};j(f,v=>{t()&&v(g)})}E(i,h),Ie(),r()}var Pu=H("<!> <!>",1),Au=H('<div class="touch-controls"><p class="touch-text">Tap and hold<br/>where you want<br/>to move</p></div>'),Mu=H('<div class="desktop-controls"><div class="key-row"><div class="pixel-key">A</div> <div class="pixel-key">W</div> <div class="pixel-key">D</div></div> <p class="or-text">or</p> <div class="key-row"><div class="pixel-key">â</div> <div class="pixel-key">â</div> <div class="pixel-key">â</div></div></div>'),$u=H('<div class="loader-overlay"><div class="pixel-loader"></div></div>'),Ou=H('<div class="game-ui-wrapper svelte-13dvmla"><!> <!> <!> <dialog class="pixel-dialog"><h1>CONTROLS</h1> <div class="controls-content"><!></div></dialog> <!></div>');function Lu(i,e){Ee(e,!1);const t=()=>L(Ri,"$showControlsDialog",d),n=()=>L(va,"$hasPlayerMoved",d),s=()=>L(pa,"$hasSelectedBackground",d),r=()=>L(Da,"$isBuilderMode",d),a=()=>L(Gi,"$currentLanguage",d),l=()=>L(ma,"$isTouchDevice",d),o=()=>L(ss,"$isLoading",d),[d,u]=Ye();let h=ms();function f(){const _=Ga.toggleLanguage();Gi.set(_)}function g(_){!c(h)?.open||_.target.closest(".pixel-button")||Ri.set(!1)}function v(){const _=rd();if(!_){console.error("Cannot enter builder mode: map config not found");return}ad(_)}Ys(()=>(c(h),t()),()=>{c(h)&&(t()?c(h).showModal():c(h).close())}),Ys(()=>(n(),c(h),Ri),()=>{n()&&c(h)?.open&&Ri.set(!1)}),qo(),fa();var S=Oe();ct("pointerdown",Lr,g);var y=fe(S);{var m=_=>{Iu(_,{})},w=_=>{var b=Ou(),p=A(b);{var x=Z=>{Su(Z,{})},T=Z=>{var te=Pu(),Ce=fe(te);ku(Ce,{});var pe=P(Ce,2);Va(pe,{}),E(Z,te)};j(p,Z=>{r()?Z(x):Z(T,!1)})}var C=P(p,2);{var M=Z=>{oe(Z,{position:"top-left",variant:"green",width:"120px",onclick:v,title:"Toggle Builder Mode",children:(te,Ce)=>{var pe=ae("BUILD");E(te,pe)},$$slots:{default:!0}})};j(C,Z=>{r()||Z(M)})}var I=P(C,2);{var k=Z=>{oe(Z,{position:"top-right",variant:"default",width:"100px",onclick:f,title:"Toggle Language (L)",children:(te,Ce)=>{var pe=ae();G(be=>De(pe,be),[()=>(a(),zt(()=>a().toUpperCase()))]),E(te,pe)},$$slots:{default:!0}})};j(I,Z=>{r()||Z(k)})}var D=P(I,2),O=P(A(D),2),W=A(O);{var B=Z=>{var te=Au();E(Z,te)},X=Z=>{var te=Mu();E(Z,te)};j(W,Z=>{l()?Z(B):Z(X,!1)})}ri(D,Z=>$(h,Z),()=>c(h));var J=P(D,2);{var ie=Z=>{var te=$u();E(Z,te)};j(J,Z=>{o()&&Z(ie)})}E(_,b)};j(y,_=>{s()?_(w,!1):_(m)})}E(i,S),Ie(),u()}Ml();const ja=document.getElementById("game-ui");if(!ja)throw new Error("game-ui element not found!");rl(Lu,{target:ja});Gi.set(Ga.getLanguage());wl.set(Sa.getSkin());ga.set(Vi.getCurrentConfig().name);const Ru={type:N.AUTO,width:800,height:600,parent:"game-container",backgroundColor:"#000000",pixelArt:!0,roundPixels:!0,scale:{mode:N.Scale.RESIZE,autoCenter:N.Scale.CENTER_BOTH},input:{activePointers:3},physics:{default:"arcade",arcade:{gravity:{y:1e3,x:0},debug:!1}},audio:{noAudio:!0},scene:[]},Rn=new N.Game(Ru);Rn.scene.add(pt.GAME,Bc);Rn.scene.add(pt.BUILDER,td);sd(Rn);const Hu=Rn.device.input.touch;ma.set(Hu);const Xu=performance.getEntriesByType("navigation")[0]&&performance.getEntriesByType("navigation")[0].type==="reload",Fu=sessionStorage.getItem("hasSeenControlsHint");(!Fu||Xu)&&(sessionStorage.setItem("hasSeenControlsHint","true"),Ri.set(!0));
//# sourceMappingURL=index-GLY7mL-N.js.map
