import{t as Di,i as xn,s as In,a as En,c as Cn,u as Tn,b as Xe,r as As,d as zt,e as Dn,g as a,f as Pn,h as kn,j as $n,n as Je,m as rt,k as O,l as Mn,P as N,o as An,p as at,q as we,v as me,w as Q,x as nt,y as R,z as k,A as T,B as G,C as ut,D as z,E as Ee,F as ce,G as be,H as U,I as Ve,J as y,K as _e,L as Me,M as le,N as Kt,O as Z,Q as ms,R as ze,S as Ge,T as Gt,U as ie,V as ne,W as Pi,X as Ln,Y as ot,Z as ki,$ as On,_ as Hn}from"./PixelButton-ypFl9ESv.js";import"./phaser-DFK5Ua9d.js";const $i=240,Rn=48;function os(i){const e=`assets/skins/static/${i.folder}`;return i.variant?`${e}/${i.variant}`:e}function Ls(i){const e=i.frameHeight??Rn;return $i/e}const Ne=[{id:"succubus",name:"SUCCUBUS",folder:"succubus",variant:"basic",character:"human",frameWidth:156,frameHeight:72,facingLeft:!0,frameRates:{idle:8,run:12}}],Mi="succubus";class Xn{currentSkinId=Mi;constructor(){this.loadFromStorage()}loadFromStorage(){const e=localStorage.getItem("playerSkin");e&&this.isValidSkinId(e)&&(this.currentSkinId=e)}isValidSkinId(e){return Ne.some(t=>t.id===e)}setSkin(e){this.isValidSkinId(e)&&(this.currentSkinId=e,localStorage.setItem("playerSkin",e))}getSkinId(){return this.currentSkinId}getSkinConfig(){return Ne.find(e=>e.id===this.currentSkinId)||Ne[0]}getSkinById(e){return Ne.find(t=>t.id===e)}getAllSkins(){return Ne}getAnimationPrefix(){const e=this.getSkinConfig();return`${e.character}-${e.id}`}}const Ut=new Xn;function Ai(i,e,t=!1){if(i.multiple){if(e==null)return;if(!xn(e))return In();for(var s of i.options)s.selected=e.includes(si(s));return}for(s of i.options){var n=si(s);if(En(n,e)){s.selected=!0;return}}(!t||e!==void 0)&&(i.selectedIndex=-1)}function Fn(i){var e=new MutationObserver(()=>{Ai(i,i.__value)});e.observe(i,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Di(()=>{e.disconnect()})}function si(i){return"__value"in i?i.__value:i.value}function Wn(i=!1){const e=Cn,t=e.l.u;if(!t)return;let s=()=>Pn(e.s);if(i){let n=0,r={};const o=kn(()=>{let l=!1;const c=e.s;for(const d in c)c[d]!==r[d]&&(r[d]=c[d],l=!0);return l&&n++,n});s=()=>a(o)}t.b.length&&Tn(()=>{ii(e,s),As(t.b)}),Xe(()=>{const n=zt(()=>t.m.map(Dn));return()=>{for(const r of n)typeof r=="function"&&r()}}),t.a.length&&Xe(()=>{ii(e,s),As(t.a)})}function ii(i,e){if(i.l.s)for(const t of i.l.s)a(t);e()}let Os=Symbol();function L(i,e,t){const s=t[e]??={store:null,source:rt(void 0),unsubscribe:Je};if(s.store!==i&&!(Os in t))if(s.unsubscribe(),s.store=i??null,i==null)s.source.v=void 0,s.unsubscribe=Je;else{var n=!0;s.unsubscribe=Zs(i,r=>{n?s.source.v=r:O(s.source,r)}),n=!1}return i&&Os in t?je(i):a(s.source)}function Ae(){const i={};function e(){Di(()=>{for(var t in i)i[t].unsubscribe();$n(i,Os,{enumerable:!1,value:!0})})}return[i,e]}function Zs(i,e,t){if(i==null)return e(void 0),t&&t(void 0),Je;const s=zt(()=>i.subscribe(e,t));return s.unsubscribe?()=>s.unsubscribe():s}const Et=[];function Zn(i,e){return{subscribe:j(i,e).subscribe}}function j(i,e=Je){let t=null;const s=new Set;function n(l){if(Mn(i,l)&&(i=l,t)){const c=!Et.length;for(const d of s)d[1](),Et.push(d,i);if(c){for(let d=0;d<Et.length;d+=2)Et[d][0](Et[d+1]);Et.length=0}}}function r(l){n(l(i))}function o(l,c=Je){const d=[l,c];return s.add(d),s.size===1&&(t=e(n,r)||Je),l(i),()=>{s.delete(d),s.size===0&&t&&(t(),t=null)}}return{set:n,update:r,subscribe:o}}function Le(i,e,t){const s=!Array.isArray(i),n=s?[i]:i;if(!n.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const r=e.length<2;return Zn(t,(o,l)=>{let c=!1;const d=[];let h=0,m=Je;const x=()=>{if(h)return;m();const w=e(s?d[0]:d,o,l);r?o(w):m=typeof w=="function"?w:Je},E=n.map((w,C)=>Zs(w,D=>{d[C]=D,h&=~(1<<C),c&&x()},()=>{h|=1<<C}));return c=!0,x(),function(){As(E),m(),c=!1}})}function je(i){let e;return Zs(i,t=>e=t)(),e}function Yn(){return`zone_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const Hs=["#e74c3c","#e67e22","#f1c40f","#2ecc71","#1abc9c","#3498db","#9b59b6","#e91e8f"];function Bn(){return Hs[Math.floor(Math.random()*Hs.length)]}function Nn(i,e=300){return{id:Yn(),x:i,width:e,color:Bn(),texts:[{language:"cs",title:"",content:""}]}}function zn(i,e){const t=i.texts.find(s=>s.language===e);return t||i.texts[0]||null}const Vt=j("cs"),Li=j("cat_orange"),Oi=j("Forest"),Hi=j(!1),Rs=j(!1),Ft=j(!1),Ri=j(!1),Xi=j(!1),Kn=j("#2a1a0a"),Gn=j(!0),Fi=j(null),Un=Le([Fi,Vt],([i,e])=>i?zn(i,e):null);function xs(i){Fi.set(i)}const Wi=j({x:0,y:0});function Vn(i,e){Wi.set({x:i,y:e})}const Zi=j({scrollX:0,scrollY:0,zoom:1});function jn(i,e,t=1){Zi.set({scrollX:i,scrollY:e,zoom:t})}const Yi=j({worldWidth:640,worldHeight:640,offsetX:0,offsetY:0});function qn(i,e,t,s,n=1){const r=i*n,o=e*n,l=Math.max(0,(t-r)/2),c=Math.max(0,(s-o)/2);Yi.set({worldWidth:r,worldHeight:o,offsetX:l,offsetY:c})}const Xs=j(!1);function Bi(){Xs.set(!0),setTimeout(()=>Xs.set(!1),150)}const We={BACKGROUND_LAYER_START:-99,GROUND_REFERENCE:-1,ITEMS_BEHIND:5,PLAYER:10,ITEMS_FRONT:15,FOREGROUND_LAYER_START:50,SELECTION_GRAPHICS:999,GRID_OVERLAY:1e3};function Ys(i){return i==="behind"?We.ITEMS_BEHIND:We.ITEMS_FRONT}const Ni={DEPTH:We.PLAYER},Jn={HALF_HEIGHT:$i/2},Lt=40;function Qn(i){return i-Lt}function jt(i){return Qn(i)-Jn.HALF_HEIGHT}function ea(i,e){const t=jt(e);return Math.min(i,t)}function ta(i,e){const t=jt(e);return i>t}class sa{scene;currentSkinId;constructor(e,t=Mi){this.scene=e,this.currentSkinId=t}createAll(){console.log("PlayerAnimations.createAll() is deprecated - animations created by skinLoader")}getSkinId(){return this.currentSkinId}setSkinId(e){this.currentSkinId=e}getAnimationKey(e){return`${this.currentSkinId}-${e}`}play(e,t){const s=this.getAnimationKey(t);if(e.anims.currentAnim?.key!==s){if(!this.scene.anims.exists(s)){console.warn(`[PlayerAnimations] Animation not found: ${s}`);return}e.play(s)}}handleSkinChange(e,t){const s=this.currentSkinId;this.currentSkinId=t;const n=e.anims.currentAnim?.key;if(n){const r=n.replace(`${s}-`,""),o=`${t}-${r}`;if(this.scene.anims.exists(o))e.play(o);else{const l=`${t}-idle`;this.scene.anims.exists(l)&&e.play(l)}}}}let zi=!1,Tt=!1;function is(i){zi=i}function ni(){return zi}function xt(){return Tt}function Is(i){if(!i||i.tagName==="CANVAS")return!1;if(i.closest("[data-ui]"))return!0;const e=document.getElementById("game-ui");return!!(e&&e.contains(i)||i.closest("button"))}function ia(){document.addEventListener("pointerdown",i=>{Tt=Is(i.target)},{capture:!0}),document.addEventListener("pointermove",i=>{i.buttons>0||(Tt=Is(i.target))},{capture:!0}),document.addEventListener("pointerup",()=>{setTimeout(()=>{Tt=!1},10)},{capture:!0}),document.addEventListener("touchstart",i=>{Tt=Is(i.target)},{capture:!0,passive:!0}),document.addEventListener("touchend",()=>{setTimeout(()=>{Tt=!1},10)},{capture:!0,passive:!0})}function $t(){const i=document.activeElement;if(!i)return!1;const e=i.tagName.toUpperCase();return e==="INPUT"||e==="TEXTAREA"||i.getAttribute("contenteditable")==="true"}function yt(i,e,t){const s=(i-t.worldView.x)*t.zoom,n=(e-t.worldView.y)*t.zoom;return{screenX:s,screenY:n}}function na(i,e,t){const s=i/t.zoom+t.worldView.x,n=e/t.zoom+t.worldView.y;return{worldX:s,worldY:n}}const mt={THRESHOLD_X:20,LANGUAGE_BUTTON:{width:120,height:60},SKIN_BUTTON:{width:120,height:60,yOffset:60}},aa={SPEED:350};class ra{scene;getPlayerPosition;keyLeft;keyRight;keyA;keyD;touchLeft=!1;touchRight=!1;touchHandlers;constructor(e){this.scene=e.scene,this.getPlayerPosition=e.getPlayerPosition,this.setupKeyboardControls(),this.setupTouchControls()}setupKeyboardControls(){this.scene.input.keyboard&&(this.keyLeft=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.LEFT,!1),this.keyRight=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.RIGHT,!1),this.keyA=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.A,!1),this.keyD=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.D,!1))}setupTouchControls(){const e=this.scene,t=o=>{if(je(Xs)){this.touchLeft=!1,this.touchRight=!1;return}const l=o.x,c=o.y,d=e.scale.width;if(l>d-mt.LANGUAGE_BUTTON.width&&c<mt.LANGUAGE_BUTTON.height||l>d-mt.SKIN_BUTTON.width&&c>=mt.SKIN_BUTTON.yOffset&&c<mt.SKIN_BUTTON.yOffset+mt.SKIN_BUTTON.height)return;const h=e.cameras.main,x=this.getPlayerPosition().x-h.scrollX,E=l-x;E<-20?(this.touchLeft=!0,this.touchRight=!1):E>mt.THRESHOLD_X?(this.touchRight=!0,this.touchLeft=!1):(this.touchLeft=!1,this.touchRight=!1)},s=o=>{xt()||t(o)},n=o=>{xt()||o.isDown&&t(o)},r=()=>{this.touchLeft=!1,this.touchRight=!1};e.input.on("pointerdown",s),e.input.on("pointermove",n),e.input.on("pointerup",r),this.touchHandlers={pointerdown:s,pointermove:n,pointerup:r}}getInputState(){const e=this.keyA?.isDown||this.keyLeft?.isDown||this.touchLeft||!1,t=this.keyD?.isDown||this.keyRight?.isDown||this.touchRight||!1;return{left:e,right:t}}hasAnyInput(){const e=this.getInputState();return e.left||e.right}destroy(){this.touchHandlers&&(this.scene.input.off("pointerdown",this.touchHandlers.pointerdown),this.scene.input.off("pointermove",this.touchHandlers.pointermove),this.scene.input.off("pointerup",this.touchHandlers.pointerup),this.touchHandlers=void 0)}}class oa extends N.Physics.Arcade.Sprite{animations;inputController;animState="idle";hasNotifiedMovement=!1;hasReceivedInput=!1;currentSkin;constructor(e,t,s){const n=Ut.getSkinId();super(e,t,s,`${n}-idle`),e.add.existing(this),e.physics.add.existing(this),this.animations=new sa(e,n),this.inputController=new ra({scene:e,getPlayerPosition:()=>({x:this.x,y:this.y})}),this.setCollideWorldBounds(!0),this.setBounce(0),this.currentSkin=Ne.find(x=>x.id===n)??Ne[0];const r=Ls(this.currentSkin),o=this.currentSkin.frameWidth??48,l=this.currentSkin.frameHeight??48,c=Math.round(o*.33),d=Math.round(l*.25),h=Math.round((o-c)/2),m=Math.round(l*.75);this.setSize(c,d),this.setOffset(h,m),this.setScale(r),this.setDepth(Ni.DEPTH),this.animations.play(this,"idle")}changeSkin(e){this.currentSkin=Ne.find(d=>d.id===e)??Ne[0];const t=Ls(this.currentSkin),s=this.currentSkin.frameWidth??48,n=this.currentSkin.frameHeight??48,r=Math.round(s*.33),o=Math.round(n*.25),l=Math.round((s-r)/2),c=Math.round(n*.75);this.setSize(r,o),this.setOffset(l,c),this.setScale(t),this.animations.handleSkinChange(this,e)}update(){const e=this.inputController.getInputState();this.inputController.hasAnyInput()&&!this.hasReceivedInput&&(this.hasReceivedInput=!0),this.hasReceivedInput&&this.inputController.hasAnyInput()&&!this.hasNotifiedMovement&&(this.hasNotifiedMovement=!0,Xi.set(!0));const t=this.currentSkin.facingLeft??!1;switch(e.left?(this.setVelocityX(-350),this.setFlipX(!t),this.animState="running"):e.right?(this.setVelocityX(aa.SPEED),this.setFlipX(t),this.animState="running"):(this.setVelocityX(0),this.animState="idle"),this.animState){case"idle":this.animations.play(this,"idle");break;case"running":this.animations.play(this,"run");break}}destroy(e){this.inputController.destroy(),super.destroy(e)}}const la=48,ca=48;function Ki(i){Ne.forEach(e=>{const t=e.frameWidth??la,s=e.frameHeight??ca,n=os(e);i.load.spritesheet(`${e.id}-idle`,`${n}/idle.png`,{frameWidth:t,frameHeight:s}),i.load.spritesheet(`${e.id}-run`,`${n}/run.png`,{frameWidth:t,frameHeight:s})})}function da(i,e){const t=e.id;i.anims.exists(`${t}-idle`)&&i.anims.remove(`${t}-idle`),i.anims.exists(`${t}-run`)&&i.anims.remove(`${t}-run`);const s=i.textures.get(`${t}-idle`),n=i.textures.get(`${t}-run`),r=s.frameTotal-1,o=n.frameTotal-1,l=e.frameRates?.idle??6,c=e.frameRates?.run??12;i.anims.create({key:`${t}-idle`,frames:i.anims.generateFrameNumbers(`${t}-idle`,{start:0,end:r-1}),frameRate:l,repeat:-1}),i.anims.create({key:`${t}-run`,frames:i.anims.generateFrameNumbers(`${t}-run`,{start:0,end:o-1}),frameRate:c,repeat:-1})}function Gi(i){Ne.forEach(e=>{da(i,e)})}const st=[{name:"FOREST GREEN",folder:"forest_green",scrollFactors:[.75,.8,.85,.9,1,1],foregroundLayers:1},{name:"FOREST BLUE",folder:"forest_blue",scrollFactors:[.75,.8,.85,.9,.95,1]},{name:"FOREST BIRCH",folder:"forest_birch",scrollFactors:[.75,.8,.85,.95,1],foregroundLayers:1},{name:"FOREST FANTASY",folder:"forest_fantasy",scrollFactors:[.75,.8,.85,.9,1,1,1],foregroundLayers:2},{name:"FOREST GOLD",folder:"forest_gold",scrollFactors:[.75,.8,.85,1,1,1],foregroundLayers:2},{name:"FOREST JUNGLE",folder:"forest_jungle",scrollFactors:[.75,.8,.95,1],foregroundLayers:1},{name:"FOREST SUMMER",folder:"forest_summer",scrollFactors:[.75,.8,.85,1,1],foregroundLayers:1},{name:"CAVE DARK",folder:"cave_dark",scrollFactors:[.7,.75,.8,.85,.9,1,1],foregroundLayers:2},{name:"FOREST DEAD",folder:"forest_dead",scrollFactors:[.75,.8,.85,.9,.95,1],foregroundLayers:1}];class ha{currentIndex=0;constructor(){const e=localStorage.getItem("background");if(e){const t=st.findIndex(s=>s.folder===e);t!==-1&&(this.currentIndex=t)}}getBackground(){return st[this.currentIndex].folder}getCurrentConfig(){return st[this.currentIndex]}setBackground(e){const t=st.findIndex(s=>s.folder===e);t!==-1&&(this.currentIndex=t,localStorage.setItem("background",e))}toggleBackground(){this.currentIndex=(this.currentIndex+1)%st.length;const e=st[this.currentIndex];return localStorage.setItem("background",e.folder),e}getAllBackgrounds(){return st}setBackgroundByIndex(e){e>=0&&e<st.length&&(this.currentIndex=e,localStorage.setItem("background",st[e].folder))}getCurrentIndex(){return this.currentIndex}}const qt=new ha;function Ui(i,e){return new Promise(t=>{for(let s=0;s<e.scrollFactors.length;s++){const n=s+1;i.load.image(`bg${n}-${e.folder}`,`assets/backgrounds/${e.folder}/${n}.png`)}i.load.once("complete",()=>{t(!0)}),i.load.once("loaderror",s=>{console.error(`Failed to load background asset: ${s.key}`),t(!1)}),i.load.start()})}function Vi(i,e,t,s){const n=[],r=[],o=s.foregroundLayers??0,c=s.scrollFactors.length-o;for(let d=0;d<s.scrollFactors.length;d++){const m=`bg${d+1}-${s.folder}`,x=s.scrollFactors[d];if(i.textures.exists(m)){const E=i.textures.getFrame(m),w=E.width,C=E.height,D=t/C,p=w*D,v=e*3,f=Math.ceil(v/p)*w+w,u=i.add.tileSprite(0,0,f,C,m);u.setOrigin(0,0),u.setScale(D),u.setScrollFactor(1),u.setData("scrollFactor",x),u.setData("scale",D),d>=c?(u.setDepth(We.FOREGROUND_LAYER_START+(d-c)),r.push(u)):(u.setDepth(We.BACKGROUND_LAYER_START+d),n.push(u))}}return{bgLayers:n,fgLayers:r}}function ji(i,e){if(!i)return;const t=e.width/e.zoom,s=e.getBounds().width,n=Math.max(0,s-t),r=Math.max(0,Math.min(e.scrollX,n)),o=[...i.bgLayers,...i.fgLayers];for(const l of o){const c=l.getData("scrollFactor"),d=l.getData("scale");l.tilePositionX=r*(1-c)/d}}function ua(i){i.bgLayers.forEach(e=>e.destroy()),i.fgLayers.forEach(e=>e.destroy())}const ga=[{code:"cs",label:"CZ"},{code:"en",label:"EN"}],qi="cs",fa={isActive:!1,config:null,selectedItemId:null,itemDepthLayer:"behind",editMode:"items",selectedDialogZoneId:null,selectedFrameId:null,selectedSocialId:null,isPlayerSelected:!1},K=j(fa),Ji=Le(K,i=>i.isActive),pa=Le(K,i=>i.config),us=j(!0);function ma(){us.update(i=>!i)}const gt=j(!1);function Mt(i){gt.set(i)}const Fs=j(!1);function Es(i){Fs.set(i)}const _t=j(!1),St=j(!1),vs=j(!1),bt=j(!1),ys=j(!1);function va(){_t.update(i=>!i)}function ya(){St.update(i=>!i)}function Qi(){vs.set(!0)}function Sa(){vs.set(!1)}function ba(){bt.update(i=>!i)}function en(){ys.set(!0)}function wa(){ys.set(!1)}const Bs=j(qi);function _a(i){Bs.set(i)}const Ss=Le(K,i=>i.selectedItemId),tn=Le(K,i=>i.itemDepthLayer),Ze=Le(K,i=>i.editMode),bs=Le(K,i=>i.selectedDialogZoneId),Ns=Le(K,i=>i.config?.dialogZones||[]),Jt=Le(K,i=>i.selectedFrameId),Cs=Le(K,i=>i.isPlayerSelected),sn=Le(K,i=>i.config?.placedFrames||[]),Qt=Le(K,i=>i.selectedSocialId),xa=Le(K,i=>i.config?.placedSocials||[]),Ia=Le(K,i=>!i.selectedSocialId||!i.config?.placedSocials?null:i.config.placedSocials.find(e=>e.id===i.selectedSocialId)??null),nn=j(null);function Ts(i){nn.set(i)}const zs=j(new Map);function Ea(i,e,t){zs.update(s=>{const n=new Map(s);return n.set(i,{x:e,y:t}),n})}function Ca(i){zs.update(e=>{const t=new Map(e);return t.delete(i),t})}const an=j(null);function Ds(i){an.set(i)}const Ta=Le(K,i=>!i.selectedFrameId||!i.config?.placedFrames?null:i.config.placedFrames.find(e=>e.id===i.selectedFrameId)??null),rn=j(null);function Ps(i){rn.set(i)}const on=j(null);function ns(i){on.set(i)}const Ks=j(!1);function ln(){Ks.set(!0)}function ai(){Ks.set(!1)}const Gs=Le(K,i=>!i.selectedItemId||!i.config?.placedItems?null:i.config.placedItems.find(e=>e.id===i.selectedItemId)??null),Da=Le(Gs,i=>i?.physicsEnabled??!1),Pa=Le(Gs,i=>i?.flipX??!1);function ri(i,e){K.update(t=>t.config?{...t,config:{...t.config,playerStartX:i,playerStartY:e}}:t)}function ka(i){K.update(e=>{if(!e.config)return e;const t=e.config.placedItems||[];return{...e,config:{...e.config,placedItems:[...t,i]}}})}function es(i,e){K.update(t=>!t.config||!t.config.placedItems?t:{...t,config:{...t.config,placedItems:t.config.placedItems.map(s=>s.id===i?{...s,...e}:s)}})}function cn(i){K.update(e=>!e.config||!e.config.placedItems?e:{...e,config:{...e.config,placedItems:e.config.placedItems.filter(t=>t.id!==i)},selectedItemId:e.selectedItemId===i?null:e.selectedItemId})}function dn(i){K.update(e=>({...e,selectedItemId:i,isPlayerSelected:i?!1:e.isPlayerSelected}))}function $a(i){K.update(e=>({...e,isPlayerSelected:i,selectedItemId:null}))}function Us(){K.update(i=>({...i,selectedItemId:null,selectedFrameId:null,selectedDialogZoneId:null,selectedSocialId:null,isPlayerSelected:!1}))}function Ma(){K.update(i=>({...i,itemDepthLayer:i.itemDepthLayer==="behind"?"front":"behind"}))}function Aa(i,e){es(i,{depth:e})}function La(i,e){e?(es(i,{physicsEnabled:e,depth:Ys("behind")}),K.update(t=>({...t,itemDepthLayer:"behind"}))):es(i,{physicsEnabled:e})}function Oa(i,e){es(i,{flipX:e})}function Ha(i){K.set({isActive:!0,config:{...i,placedItems:i.placedItems||[],dialogZones:i.dialogZones||[],placedFrames:i.placedFrames||[],placedSocials:i.placedSocials||[]},selectedItemId:null,itemDepthLayer:"behind",editMode:"items",selectedDialogZoneId:null,selectedFrameId:null,selectedSocialId:null,isPlayerSelected:!1}),Vs.set(1)}function Ra(){K.update(i=>{const e=i.config?{...i.config,dialogZones:(i.config.dialogZones||[]).filter(t=>t.texts.some(s=>s.title.trim()!==""||s.content.trim()!==""))}:i.config;return{...i,isActive:!1,selectedItemId:null,config:e}}),Vs.set(1)}function Xa(){return je(K).config}const Vs=j(1);function as(i){Vs.set(i)}const js=j({scrollX:0,scrollY:0,viewWidth:0,viewHeight:0,worldWidth:0,worldHeight:0,zoom:1,playerX:0,playerY:0});function Fa(i){js.update(e=>({...e,...i}))}function Xt(i){K.update(e=>({...e,editMode:i,selectedItemId:null,selectedDialogZoneId:null}))}function Wa(i){K.update(e=>{if(!e.config)return e;const t=e.config.dialogZones||[];return{...e,config:{...e.config,dialogZones:[...t,i]}}})}function Dt(i,e){K.update(t=>!t.config||!t.config.dialogZones?t:{...t,config:{...t.config,dialogZones:t.config.dialogZones.map(s=>s.id===i?{...s,...e}:s)}})}function hn(i){K.update(e=>!e.config||!e.config.dialogZones?e:{...e,config:{...e.config,dialogZones:e.config.dialogZones.filter(t=>t.id!==i)},selectedDialogZoneId:e.selectedDialogZoneId===i?null:e.selectedDialogZoneId})}function Zt(i){K.update(e=>({...e,selectedDialogZoneId:i}))}function oi(i,e,t){K.update(s=>!s.config||!s.config.dialogZones?s:{...s,config:{...s.config,dialogZones:s.config.dialogZones.map(n=>{if(n.id!==i)return n;const r=n.texts.findIndex(l=>l.language===e);let o;return r>=0?o=n.texts.map((l,c)=>c===r?{...l,...t}:l):o=[...n.texts,{language:e,title:"",content:"",...t}],{...n,texts:o}})}})}function Za(i){K.update(e=>{if(!e.config)return e;const t=e.config.placedFrames||[];return{...e,config:{...e.config,placedFrames:[...t,i]}}})}function it(i,e){K.update(t=>!t.config||!t.config.placedFrames?t:{...t,config:{...t.config,placedFrames:t.config.placedFrames.map(s=>s.id===i?{...s,...e}:s)}})}function qs(i){K.update(e=>!e.config||!e.config.placedFrames?e:{...e,config:{...e.config,placedFrames:e.config.placedFrames.filter(t=>t.id!==i)},selectedFrameId:e.selectedFrameId===i?null:e.selectedFrameId})}function Yt(i){vs.set(!1),K.update(e=>({...e,selectedFrameId:i,isPlayerSelected:i?!1:e.isPlayerSelected,selectedItemId:i?null:e.selectedItemId}))}function Ya(i){K.update(e=>{if(!e.config)return e;const t=e.config.placedSocials||[];return{...e,config:{...e.config,placedSocials:[...t,i]}}})}function ls(i,e){K.update(t=>!t.config||!t.config.placedSocials?t:{...t,config:{...t.config,placedSocials:t.config.placedSocials.map(s=>s.id===i?{...s,...e}:s)}})}function Js(i){K.update(e=>!e.config||!e.config.placedSocials?e:{...e,config:{...e.config,placedSocials:e.config.placedSocials.filter(t=>t.id!==i)},selectedSocialId:e.selectedSocialId===i?null:e.selectedSocialId})}function Bt(i){ys.set(!1),K.update(e=>({...e,selectedSocialId:i,isPlayerSelected:i?!1:e.isPlayerSelected,selectedItemId:i?null:e.selectedItemId,selectedFrameId:i?null:e.selectedFrameId}))}const Qs=[{key:"tent",name:"Tent",path:"assets/ui/tent.png",scale:6,category:"structures"},{key:"lamp",name:"Lamp",path:"assets/ui/lamp.png",scale:8,category:"props"},{key:"sign_left",name:"Sign ←",path:"assets/ui/sign_left.png",scale:7,category:"signs"},{key:"sign_right",name:"Sign →",path:"assets/ui/sign_right.png",scale:7,category:"signs"},{key:"stone_0",name:"Stone 0",path:"assets/ui/stone_0.png",scale:4,category:"nature",supportsPhysics:!0},{key:"stone_1",name:"Stone 1",path:"assets/ui/stone_1.png",scale:5,category:"nature",supportsPhysics:!0},{key:"stone_2",name:"Stone 2",path:"assets/ui/stone_2.png",scale:4,category:"nature",supportsPhysics:!0}];function un(i){return Qs.find(e=>e.key===i)}function Ba(i){return un(i)?.scale||1}function Na(i){return un(i)?.supportsPhysics??!1}class li{scene;groundY;constructor(e,t){this.scene=e,this.groundY=t}static preloadAssets(e){Qs.forEach(t=>{e.load.image(t.key,t.path)})}createSprite(e){const{id:t,assetKey:s,x:n,scale:r=1,depth:o=5,yOffset:l=0,flipX:c=!1}=e,d=this.groundY+l,h=this.scene.add.sprite(n,d,s);return h.setScale(r),h.setDepth(o),h.setFlipX(c),h.setData("itemId",t),h}updatePosition(e,t,s){e.x=t,e.y=this.groundY+s}updateScale(e,t){e.setScale(t)}updateDepth(e,t){e.setDepth(t)}applyUpdates(e,t){t.x!==void 0&&(e.x=t.x),t.yOffset!==void 0&&(e.y=this.groundY+t.yOffset),t.scale!==void 0&&e.setScale(t.scale),t.depth!==void 0&&e.setDepth(t.depth),t.flipX!==void 0&&e.setFlipX(t.flipX)}worldYToOffset(e){return e-this.groundY}getGroundY(){return this.groundY}}function Pt(i){return parseInt(i.replace("#",""),16)}const vt={BLUE:"#4a90e2",GREEN:"#27ae60",PURPLE:"#9b59b6",TEAL:"#1abc9c",PINK:"#e91e8f"},Ot={ITEM:{hex:Pt(vt.BLUE)},FRAME:{hex:Pt(vt.PURPLE)},SOCIAL:{css:vt.PINK,hex:Pt(vt.PINK)},DIALOG_ZONE:{hex:Pt(vt.TEAL)},PLAYER:{hex:Pt(vt.GREEN)}},gn=Pt(vt.BLUE),kt=50,za=4871528,Ka=.4,Ga=1,fn=We.GRID_OVERLAY,ks=16711680,Ua=2,Va=.6,ja=.1,qa=1,Ja=.2,ci=50,Qa=50,ei=gn;class pn{lastClickTime=0;lastClickId=null;threshold;constructor(e=300){this.threshold=e}check(e){const t=Date.now(),s=this.lastClickId===e&&t-this.lastClickTime<this.threshold;return this.lastClickTime=t,this.lastClickId=e,s}reset(){this.lastClickTime=0,this.lastClickId=null}}function rs(i,e){return Math.round(i/e)*e}function ws(i){const{sprite:e,scene:t,callbacks:s={},constraints:n,useGridSnapping:r=!0,cursor:o="grab",hitArea:l}=i;let c=!1,d=0,h=0,m=0;l?e.setInteractive({hitArea:l,hitAreaCallback:N.Geom.Rectangle.Contains,useHandCursor:!0,cursor:o}):e.setInteractive({useHandCursor:!0,cursor:o});const x=(f,u)=>{const g=e.getBounds(),S=5;return f>=g.x-S&&f<=g.x+g.width+S&&u>=g.y-S&&u<=g.y+g.height+S},E=()=>{const f=t.data.get("lastTapTime");if(!f||f===m||Date.now()-f>100)return;m=f;const u=t.data.get("lastTapWorldX"),g=t.data.get("lastTapWorldY");x(u,g)&&s.onSelect?.()},w=f=>{if(f.wasTouch||je(Fs)||xt()||c||s.onDoubleClick?.())return;const u=s.isSelected?.()??!1;s.onSelect?.(),u&&(c=!0,t.data.set("isDraggingItem",!0),Mt(!0),d=e.x-f.worldX,h=e.y-f.worldY,s.onDragStart?.())},C=f=>{if(f.wasTouch){const S=t.data.get("touchDragStarted");if(!c&&S&&s.isSelected?.()){const I=t.data.get("touchStartWorldX"),M=t.data.get("touchStartWorldY"),_=e.getBounds(),P=10;I>=_.x-P&&I<=_.x+_.width+P&&M>=_.y-P&&M<=_.y+_.height+P&&(c=!0,t.data.set("isDraggingItem",!0),t.data.set("touchDragStarted",!1),Mt(!0),d=e.x-I,h=e.y-M,s.onDragStart?.())}if(c){let b=f.worldX+d,I=f.worldY+h;r&&je(us)&&(b=rs(b,kt),I=rs(I,kt)),n&&(n.minX!==void 0&&(b=Math.max(b,n.minX)),n.maxX!==void 0&&(b=Math.min(b,n.maxX)),n.minY!==void 0&&(I=Math.max(I,n.minY)),n.maxY!==void 0&&(I=Math.min(I,n.maxY))),e.setPosition(b,I),s.onDrag?.(b,I)}return}if(!c)return;if(je(Fs)){p();return}if(!f.isDown){p();return}let u=f.worldX+d,g=f.worldY+h;r&&je(us)&&(u=rs(u,kt),g=rs(g,kt)),n&&(n.minX!==void 0&&(u=Math.max(u,n.minX)),n.maxX!==void 0&&(u=Math.min(u,n.maxX)),n.minY!==void 0&&(g=Math.max(g,n.minY)),n.maxY!==void 0&&(g=Math.min(g,n.maxY))),e.setPosition(u,g),s.onDrag?.(u,g)},D=()=>{c&&p()},p=()=>{c=!1,t.data.set("isDraggingItem",!1),Mt(!1),s.onDragEnd?.(e.x,e.y)};e.on("pointerdown",w),t.input.on("pointermove",C),t.input.on("pointerup",D);const v=()=>{E()};return t.events.on("update",v),()=>{e.off("pointerdown",w),t.input.off("pointermove",C),t.input.off("pointerup",D),t.events.off("update",v)}}class er{scene;groundY;worldWidth;worldHeight;isDragging=!1;callbacks;cleanupFunctions=new Map;constructor(e,t,s,n,r={}){this.scene=e,this.groundY=t,this.worldWidth=s,this.worldHeight=n,this.callbacks=r}getIsDragging(){return this.isDragging}makeInteractive(e,t){const s=ws({sprite:e,scene:this.scene,cursor:"pointer",constraints:{minX:0,maxX:this.worldWidth,minY:0,maxY:this.worldHeight},callbacks:{onSelect:()=>{dn(t),this.callbacks.onSelect?.(t)},isSelected:()=>je(Ss)===t,onDragStart:()=>{this.isDragging=!0,e.setTint(gn),this.callbacks.onDragStart?.(t)},onDrag:(n,r)=>{this.callbacks.onDrag?.(t,n,r)},onDragEnd:(n,r)=>{e.clearTint(),this.isDragging=!1;const o=Math.round(n),c=Math.round(r)-this.groundY;es(t,{x:o,yOffset:c}),this.callbacks.onDragEnd?.(t,o,c)}}});this.cleanupFunctions.set(t,s)}removeInteractivity(e){if(!e||!e.scene)return;const t=e.getData("itemId");t&&this.cleanupFunctions.has(t)&&(this.cleanupFunctions.get(t)(),this.cleanupFunctions.delete(t)),e.removeInteractive()}destroy(){this.cleanupFunctions.forEach(e=>e()),this.cleanupFunctions.clear()}}const wt={ITEM:"itemId",FRAME:"frameId",SOCIAL:"socialId",PLAYER:"isPlayer",ZONE:"zoneId"},tr={[wt.ITEM]:"selectedItemId",[wt.FRAME]:"selectedFrameId",[wt.SOCIAL]:"selectedSocialId",[wt.PLAYER]:"isPlayerSelected"};function sr(i,e){if(!(i instanceof N.GameObjects.Sprite))return!1;for(const[t,s]of Object.entries(tr)){const n=i.getData(t);if(n)if(t===wt.PLAYER){const r=e.data.get(s),o=e.data.get("playerSprite");if(r&&i===o)return!0}else{const r=e.data.get(s);if(n===r)return!0}}return!1}function ir(i,e){const t=i.input.hitTestPointer(e);for(const s of t)if(sr(s,i))return!0;return!1}const nr={lineWidth:3,lineColor:Ot.ITEM.hex,lineAlpha:1,padding:5};class ar{scene;graphics;style;selectedId=null;constructor(e,t={}){this.scene=e,this.style={...nr,...t},this.graphics=e.add.graphics(),this.graphics.setDepth(We.SELECTION_GRAPHICS)}setSelectedId(e){this.selectedId=e}getSelectedId(){return this.selectedId}updateVisuals(e){if(this.graphics.clear(),!e||!this.selectedId)return;const t=e.getBounds(),{lineWidth:s,lineColor:n,lineAlpha:r,padding:o}=this.style;this.graphics.lineStyle(s,n,r),this.graphics.strokeRect(t.x-o,t.y-o,t.width+o*2,t.height+o*2)}clearVisuals(){this.graphics.clear(),this.selectedId=null}setupBackgroundDeselect(e){this.scene.input.on("pointerdown",t=>{if(xt()||e())return;this.scene.input.hitTestPointer(t).find(r=>r.type==="Sprite"?Object.values(wt).some(o=>r.getData(o)):r.type==="Rectangle"?r.getData(wt.ZONE):!1)||(Us(),this.clearVisuals())})}destroy(){this.graphics?.destroy()}}class gs{scene;items=new Map;isBuilderMode=!1;physicsGroup=null;renderer;dragController;selectionManager;constructor(e,t,s,n,r=!1){this.scene=e,this.isBuilderMode=r,this.renderer=new li(e,t),r||(this.physicsGroup=e.physics.add.staticGroup()),this.isBuilderMode&&(this.dragController=new er(e,t,s,n,{onSelect:()=>this.updateSelectionVisuals(),onDrag:()=>this.updateSelectionVisuals()}),this.selectionManager=new ar(e))}static preloadAssets(e){li.preloadAssets(e)}createItems(e){e.forEach(t=>{this.createItem(t)})}createItem(e){const t=this.renderer.createSprite(e),s={sprite:t,data:e};if(!this.isBuilderMode&&e.physicsEnabled&&this.physicsGroup){const n=this.createPhysicsBody(t,e);s.physicsBody=n}this.items.set(e.id,s),this.isBuilderMode&&this.dragController&&this.dragController.makeInteractive(t,e.id)}createPhysicsBody(e,t){const s=e.getBounds(),n=s.width*.5,r=s.height*.8,o=e.x,l=e.y,c=this.scene.add.rectangle(o,l,n,r);return c.setVisible(!1),this.physicsGroup.add(c),c.setData("itemId",t.id),c}updateSelectionVisuals(){if(!this.selectionManager)return;const e=this.scene.data.get("selectedItemId");if(this.selectionManager.setSelectedId(e),!e){this.selectionManager.clearVisuals(),Ds(null);return}const t=this.items.get(e);if(this.selectionManager.updateVisuals(t?.sprite??null),t?.sprite){const s=this.scene.cameras.main,n=t.sprite.getBounds(),{screenX:r,screenY:o}=yt(n.centerX,n.centerY,s),l=n.height*s.zoom;Ds({screenX:r,screenY:o,itemHeight:l})}else Ds(null)}updateItem(e,t){const s=this.items.get(e);s&&(this.renderer.applyUpdates(s.sprite,t),s.data={...s.data,...t})}removeItem(e){const t=this.items.get(e);t&&(this.dragController&&this.dragController.removeInteractivity(t.sprite),t.physicsBody&&t.physicsBody.destroy(),t.sprite.destroy(),this.items.delete(e))}removeAllItems(){this.items.forEach(e=>{!e.sprite||!e.sprite.scene||(this.dragController&&this.dragController.removeInteractivity(e.sprite),e.physicsBody&&e.physicsBody.destroy(),e.sprite.destroy())}),this.items.clear()}getItem(e){return this.items.get(e)?.data}getAllItems(){return Array.from(this.items.values()).map(e=>e.data)}getPhysicsGroup(){return this.physicsGroup}setInteractiveEnabled(e){!this.isBuilderMode||!this.dragController||(this.items.forEach(({sprite:t,data:s})=>{e?(this.dragController.makeInteractive(t,s.id),t.setAlpha(1)):(t.disableInteractive(),t.setAlpha(.6))}),!e&&this.selectionManager&&this.selectionManager.clearVisuals())}destroy(){this.removeAllItems(),this.selectionManager?.destroy()}setupBackgroundDeselect(){!this.isBuilderMode||!this.selectionManager||this.selectionManager.setupBackgroundDeselect(()=>this.dragController?.getIsDragging()??!1)}}function rr(){return`frame_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const or=["#ffffff","#f8f8f8","#fffacd","#ffefd5","#ffe4e1","#e6e6fa","#f0fff0","#f5fffa","#fff0f5","#f0f8ff","#2d2d2d","#1a1a2e","#16213e","#1a1a1a","#2d132c","#1e3a3a","#3d1a1a","#1a2f1a","#3d3d1a","#2a1a3d"],lr=["#333333","#000000","#ffffff","#1a1a1a","#666666","#8b4513","#2c3e50","#c0392b","#27ae60","#2980b9","#8e44ad","#f39c12"],cr=[12,14,16,18,20,24,28,32],dr=[{value:"top",label:"Top",icon:"↑"},{value:"center",label:"Center",icon:"⬌"},{value:"bottom",label:"Bottom",icon:"↓"}],mn={S:{label:"Small",scale:3},M:{label:"Medium",scale:4},L:{label:"Large",scale:5}};function hr(i){return mn[i].scale}function ur(i){return i<=3?"S":i>=5?"L":"M"}const lt=4,Wt="#ffffff",vn="#333333",cs=16,yn="center",gr=64,fr=96,pr=.06,di=32,fs=[{key:"base_1",name:"Frame 1",path:"assets/frames/base 1.png",scale:4},{key:"base_2",name:"Frame 2",path:"assets/frames/base 2.png",scale:4},{key:"base_3",name:"Frame 3",path:"assets/frames/base 3.png",scale:4},{key:"base_4",name:"Frame 4",path:"assets/frames/base 4.png",scale:4},{key:"base_5",name:"Frame 5",path:"assets/frames/base 5.png",scale:4},{key:"base_6",name:"Frame 6",path:"assets/frames/base 6.png",scale:4},{key:"base_7",name:"Frame 7",path:"assets/frames/base 7.png",scale:4},{key:"base_8",name:"Frame 8",path:"assets/frames/base 8.png",scale:4},{key:"base_9",name:"Frame 9",path:"assets/frames/base 9.png",scale:4},{key:"base_10",name:"Frame 10",path:"assets/frames/base 10.png",scale:4},{key:"base_11",name:"Frame 11",path:"assets/frames/base 11.png",scale:4},{key:"base_12",name:"Frame 12",path:"assets/frames/base 12.png",scale:4},{key:"base_13",name:"Frame 13",path:"assets/frames/base 13.png",scale:4},{key:"base_14",name:"Frame 14",path:"assets/frames/base 14.png",scale:4},{key:"base_15",name:"Frame 15",path:"assets/frames/base 15.png",scale:4},{key:"base_16",name:"Frame 16",path:"assets/frames/base 16.png",scale:4},{key:"base_17",name:"Frame 17",path:"assets/frames/base 17.png",scale:4},{key:"base_18",name:"Frame 18",path:"assets/frames/base 18.png",scale:4},{key:"base_19",name:"Frame 19",path:"assets/frames/base 19.png",scale:4},{key:"base_20",name:"Frame 20",path:"assets/frames/base 20.png",scale:4},{key:"base_21",name:"Frame 21",path:"assets/frames/base 21.png",scale:4},{key:"base_22",name:"Frame 22",path:"assets/frames/base 22.png",scale:4},{key:"base_23",name:"Frame 23",path:"assets/frames/base 23.png",scale:4},{key:"base_24",name:"Frame 24",path:"assets/frames/base 24.png",scale:4},{key:"base_25",name:"Frame 25",path:"assets/frames/base 25.png",scale:4}];function mr(i){return fs.find(e=>e.key===i)}function vr(i){return mr(i)?.scale??lt}function Nt(i=lt,e=!1){const t=gr*i,s=fr*i,n=e?s:t,r=e?t:s,o=Math.min(t,s)*pr,l=n-o*2,c=r-o*2,d=l-di*2,h=c-di*2;return{frameWidth:n,frameHeight:r,innerWidth:l,innerHeight:c,textWidth:d,textHeight:h}}function ds(i,e,t,s,n,r,o=4){i.clear();const l=parseInt(r.replace("#",""),16);i.fillStyle(l,1),i.fillRoundedRect(e-s/2,t-n/2,s,n,o)}class hi{scene;frames=new Map;constructor(e){this.scene=e}static preloadAssets(e){for(let t=1;t<=25;t++)e.load.image(`frame_base_${t}`,`assets/frames/base ${t}.png`)}createFrames(e){e.forEach(t=>{this.createFrame(t)})}createFrame(e){const t=`frame_${e.frameKey}`;if(!this.scene.textures.exists(t)){console.warn(`[GameFrameManager] Frame texture not found: ${t}`);return}const s=e.scale??lt,n=e.depth??We.ITEMS_FRONT,r=(e.rotation??0)*(Math.PI/180),o=e.rotation===90,{innerWidth:l,innerHeight:c}=Nt(s,o),d=this.scene.add.graphics();d.setDepth(n-.1),ds(d,e.x,e.y,l,c,e.backgroundColor||Wt);const h=this.scene.add.sprite(e.x,e.y,t);h.setScale(s),h.setDepth(n),h.setOrigin(.5,.5),h.setRotation(r);const m={sprite:h,background:d,data:e};this.frames.set(e.id,m),e.url&&this.makeClickable(m)}makeClickable(e){const{sprite:t,data:s}=e;t.setInteractive({useHandCursor:!0}),t.on("pointerover",()=>{t.setScale((s.scale??lt)*1.05)}),t.on("pointerout",()=>{t.setScale(s.scale??lt)}),t.on("pointerdown",()=>{s.url&&(Bi(),window.open(s.url,"_blank","noopener,noreferrer"))})}destroy(){this.frames.forEach(({sprite:e,background:t})=>{e.destroy(),t.destroy()}),this.frames.clear()}}function yr(){return`social_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const ts={S:{label:"Small",scale:1.5},M:{label:"Medium",scale:2},L:{label:"Large",scale:2.5}},At=ts.M.scale;function Sr(i){return ts[i].scale}function br(i){return i<=ts.S.scale?"S":i>=ts.L.scale?"L":"M"}const ps=[{key:"discord",name:"Discord",path:"assets/socials/Discord.png",scale:1},{key:"facebook",name:"Facebook",path:"assets/socials/Facebook.png",scale:1},{key:"instagram",name:"Instagram",path:"assets/socials/Instagram.png",scale:1},{key:"kofi",name:"Ko-Fi",path:"assets/socials/Ko Fi.png",scale:1},{key:"linkedin",name:"LinkedIn",path:"assets/socials/LinkedIn.png",scale:1},{key:"patreon",name:"Patreon",path:"assets/socials/Patreon.png",scale:1},{key:"tiktok",name:"TikTok",path:"assets/socials/TikTok.png",scale:1},{key:"twitch",name:"Twitch",path:"assets/socials/Twitch.png",scale:1},{key:"twitter",name:"Twitter",path:"assets/socials/Twitter.png",scale:1},{key:"whatsapp",name:"WhatsApp",path:"assets/socials/Whatsapp.png",scale:1},{key:"youtube",name:"YouTube",path:"assets/socials/Youtube.png",scale:1}];class ui{scene;socials=new Map;constructor(e){this.scene=e}static preloadAssets(e){ps.forEach(t=>{e.load.image(`social_${t.key}`,t.path)})}createSocials(e){e.forEach(t=>{this.createSocial(t)})}createSocial(e){const t=`social_${e.socialKey}`;if(!this.scene.textures.exists(t)){console.warn(`[GameSocialManager] Social texture not found: ${t}`);return}const s=e.scale??At,n=e.depth??We.ITEMS_FRONT,r=this.scene.add.sprite(e.x,e.y,t);r.setScale(s),r.setDepth(n),r.setOrigin(.5,.5),this.socials.set(e.id,r),e.url&&this.makeClickable(r,e)}makeClickable(e,t){const s=t.scale??At;e.setInteractive({useHandCursor:!0}),e.on("pointerover",()=>{e.setScale(s*1.1)}),e.on("pointerout",()=>{e.setScale(s)}),e.on("pointerdown",()=>{t.url&&(Bi(),window.open(t.url,"_blank","noopener,noreferrer"))})}destroy(){this.socials.forEach(e=>{e.destroy()}),this.socials.clear()}}async function gi(){const i=await fetch("./config/map.json");if(!i.ok)throw new Error(`Failed to load map config: ${i.status}`);const e=await i.json();if(!e.worldWidth||!e.worldHeight)throw new Error("Invalid map config structure");return e}const hs={generateId(){return`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`},create(i){const{assetKey:e,x:t,yOffset:s=0,depthLayer:n="behind",scale:r}=i;return{id:hs.generateId(),assetKey:e,x:Math.round(t),y:0,scale:r??Ba(e),depth:Ys(n),yOffset:Math.round(s)}},createAtWorldPosition(i,e,t,s,n="behind"){return hs.create({assetKey:i,x:e,yOffset:t-s,depthLayer:n})},clone(i,e=50){return{...i,id:hs.generateId(),x:i.x+e}}},Ct={HEIGHT:Lt,VISUAL:{COLOR:9139029,ALPHA:.3},PHYSICS:{COLOR:0,ALPHA:0}},ss={getGroundY(i,e=Lt){return i-e},createVisualGround(i,e){const t=e.height??Ct.HEIGHT,s=ss.getGroundY(e.worldHeight,t),n=i.add.rectangle(0,s,e.worldWidth,t,e.color??Ct.VISUAL.COLOR,e.alpha??Ct.VISUAL.ALPHA);return n.setOrigin(0,0),n.setDepth(e.depth??We.GROUND_REFERENCE),{ground:n,groundY:s}},createPhysicsGround(i,e){const t=e.height??Ct.HEIGHT,s=ss.getGroundY(e.worldHeight,t),n=i.add.rectangle(0,s,e.worldWidth,t,e.color??Ct.PHYSICS.COLOR,e.alpha??Ct.PHYSICS.ALPHA);return n.setOrigin(0,0),i.physics.add.existing(n,!0),{ground:n,groundY:s}},addPlayerCollision(i,e,t){return i.physics.add.collider(e,t)}},Qe={GAME:"GameScene",BUILDER:"BuilderScene"};class wr extends N.Scene{player;mapConfig;parallaxLayers=null;loadedBackgrounds=new Set;itemManager;frameManager;socialManager;dialogZones=[];currentDialogZone=null;unsubscribers=[];initData;isInitialized=!1;constructor(){super({key:Qe.GAME})}init(e){this.initData=e,this.isInitialized=!1}preload(){Ki(this),gs.preloadAssets(this),hi.preloadAssets(this),ui.preloadAssets(this)}create(){this.events.on("shutdown",this.shutdown,this),this.initializeScene()}async initializeScene(){Rs.set(!0);try{Gi(this),await this.loadMapConfiguration();const e=qt.getCurrentConfig();await this.loadBackgroundIfNeeded(e),this.createParallaxBackground();const{ground:t,groundY:s}=ss.createPhysicsGround(this,{worldWidth:this.mapConfig.worldWidth,worldHeight:this.mapConfig.worldHeight}),n=ea(this.mapConfig.playerStartY,this.mapConfig.worldHeight);this.player=new oa(this,this.mapConfig.playerStartX,n),ss.addPlayerCollision(this,this.player,t),this.itemManager=new gs(this,s,this.mapConfig.worldWidth,this.mapConfig.worldHeight,!1),this.mapConfig.placedItems&&this.mapConfig.placedItems.length>0&&this.itemManager.createItems(this.mapConfig.placedItems);const r=this.itemManager.getPhysicsGroup();r&&this.physics.add.collider(this.player,r),this.frameManager=new hi(this),this.mapConfig.placedFrames&&this.mapConfig.placedFrames.length>0&&this.frameManager.createFrames(this.mapConfig.placedFrames),this.socialManager=new ui(this),this.mapConfig.placedSocials&&this.mapConfig.placedSocials.length>0&&this.socialManager.createSocials(this.mapConfig.placedSocials),this.dialogZones=this.mapConfig.dialogZones||[];const o=Ns.subscribe(l=>{this.dialogZones=l,this.recheckCurrentZone()});this.unsubscribers.push(o),this.cameras.main.startFollow(this.player,!0,.1,.1),this.setupCameraBounds(),this.physics.world.setBounds(0,0,this.mapConfig.worldWidth,this.mapConfig.worldHeight),this.scale.on("resize",this.handleResize,this),this.isInitialized=!0}catch(e){console.error("[GameScene] Failed to initialize scene:",e)}finally{Rs.set(!1)}}async loadMapConfiguration(){try{if(this.initData?.useBuilderConfig){const e=Xa();this.mapConfig=e||await gi()}else this.mapConfig=await gi()}catch(e){console.error("[GameScene] Failed to load map configuration:",e);const t=600;this.mapConfig={worldWidth:3200,worldHeight:t,playerStartX:400,playerStartY:jt(t),placedItems:[]}}}createParallaxBackground(){const e=qt.getCurrentConfig();this.parallaxLayers=Vi(this,this.mapConfig.worldWidth,this.mapConfig.worldHeight,e)}async loadBackgroundIfNeeded(e){if(this.loadedBackgrounds.has(e.folder))return!0;const t=await Ui(this,e);return t&&this.loadedBackgrounds.add(e.folder),t}setupCameraBounds(){const e=this.cameras.main,t=e.height,s=e.width,n=t/this.mapConfig.worldHeight,r=Math.min(1,n);e.setZoom(r);const o=t/r,l=s/r;let c=0,d=this.mapConfig.worldHeight;o>this.mapConfig.worldHeight&&(c=(this.mapConfig.worldHeight-o)/2,d=o);let h=0,m=this.mapConfig.worldWidth;l>this.mapConfig.worldWidth&&(h=(this.mapConfig.worldWidth-l)/2,m=l),e.setBounds(h,c,m,d),qn(this.mapConfig.worldWidth,this.mapConfig.worldHeight,s,t,r)}handleResize(e){!this.cameras?.main||!this.mapConfig||this.setupCameraBounds()}shutdown(){this.isInitialized=!1,this.scale.off("resize",this.handleResize,this),xs(null),this.currentDialogZone=null,this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.itemManager&&this.itemManager.destroy(),this.frameManager&&this.frameManager.destroy(),this.socialManager&&this.socialManager.destroy()}update(){if(!this.isInitialized||!this.player)return;this.player.update();const e=this.cameras.main,t=this.player.x-e.scrollX,s=this.player.y-e.scrollY;Vn(t,s),jn(e.scrollX,e.scrollY,e.zoom),this.checkDialogZones(),this.parallaxLayers&&ji(this.parallaxLayers,this.cameras.main)}checkDialogZones(){const e=this.player.x;let t=null;for(const s of this.dialogZones)if(e>=s.x&&e<=s.x+s.width){t=s;break}t?.id!==this.currentDialogZone?.id&&(this.currentDialogZone=t,xs(t))}recheckCurrentZone(){if(!this.currentDialogZone)return;const e=this.dialogZones.find(t=>t.id===this.currentDialogZone?.id);e&&(this.currentDialogZone=e,xs(e))}}const $s=1,fi=.001,_r=.15,pi=400;class xr{scene;camera;worldWidth;worldHeight;isPanning=!1;panStartX=0;panStartY=0;cameraDragStartX=0;cameraDragStartY=0;isDraggingToScroll=!1;dragScrollStartX=0;dragScrollStartY=0;dragScrollCameraStartX=0;dragScrollCameraStartY=0;currentZoom=1;targetZoom=1;minZoom=.1;isAnimatingReset=!1;zoomTargetWorldPoint=null;pinchStartDistance=0;pinchStartZoom=1;activeTouches=new Map;pinchEndTime=0;isPinching=!1;PINCH_COOLDOWN=150;touchStartTime=0;touchStartPos=null;touchOnSelectedSprite=!1;TAP_MAX_DURATION=200;TAP_MAX_DISTANCE=10;constructor(e,t,s){this.scene=e,this.camera=e.cameras.main,this.worldWidth=t,this.worldHeight=s}setup(){this.calculateMinZoom(),this.setupCamera(),this.setupMouseControls(),this.setupKeyboardControls(),this.setupUpdateLoop()}calculateMinZoom(){const e=this.camera.width/this.worldWidth,t=this.camera.height/this.worldHeight;this.minZoom=Math.min(e,t)}setupCamera(){this.currentZoom=this.minZoom,this.targetZoom=this.minZoom,this.camera.setZoom(this.minZoom);const e=this.camera.width/this.minZoom,t=this.camera.height/this.minZoom,s=Math.min(0,(this.worldWidth-e)/2),n=Math.min(0,(this.worldHeight-t)/2),r=Math.max(this.worldWidth,e),o=Math.max(this.worldHeight,t);this.camera.setBounds(s,n,r,o),this.camera.centerOn(this.worldWidth/2,this.worldHeight/2),as(this.minZoom)}centerOn(e,t){this.camera.centerOn(e,t),this.clampScroll()}handleResize(){this.calculateMinZoom(),this.currentZoom<this.minZoom&&(this.currentZoom=this.minZoom,this.targetZoom=this.minZoom,this.camera.setZoom(this.minZoom)),this.targetZoom<this.minZoom&&(this.targetZoom=this.minZoom),this.updateCameraBounds(),this.clampScroll(),as(this.currentZoom)}updateCameraBounds(){const e=this.camera.width/this.currentZoom,t=this.camera.height/this.currentZoom,s=Math.min(0,(this.worldWidth-e)/2),n=Math.min(0,(this.worldHeight-t)/2),r=Math.max(this.worldWidth,e),o=Math.max(this.worldHeight,t);this.camera.setBounds(s,n,r,o)}getScrollBounds(e=!0){const t=this.camera.width/this.currentZoom,s=this.camera.height/this.currentZoom;let n,r,o,l;return t>this.worldWidth?e?n=r=(this.worldWidth-t)/2:(n=this.worldWidth-t,r=0):(n=0,r=this.worldWidth-t),s>this.worldHeight?e?o=l=(this.worldHeight-s)/2:(o=this.worldHeight-s,l=0):(o=0,l=this.worldHeight-s),{minX:n,maxX:r,minY:o,maxY:l}}clampScroll(){const e=this.getScrollBounds(!0);this.camera.scrollX=N.Math.Clamp(this.camera.scrollX,e.minX,e.maxX),this.camera.scrollY=N.Math.Clamp(this.camera.scrollY,e.minY,e.maxY)}softClampScroll(){const e=this.getScrollBounds(!1);this.camera.scrollX=N.Math.Clamp(this.camera.scrollX,e.minX,e.maxX),this.camera.scrollY=N.Math.Clamp(this.camera.scrollY,e.minY,e.maxY)}applyPanDelta(e,t,s,n,r,o){const l=this.getScrollBounds(),c=(e-s)/this.currentZoom,d=(t-n)/this.currentZoom;this.camera.scrollX=N.Math.Clamp(r-c,l.minX,l.maxX),this.camera.scrollY=N.Math.Clamp(o-d,l.minY,l.maxY)}zoomToPoint(e,t,s){const n=this.camera.getWorldPoint(e,t);this.zoomToWorldPoint(n.x,n.y,s)}zoomToWorldPoint(e,t,s){const n=this.camera.scrollX,r=this.camera.scrollY,o=this.currentZoom;this.currentZoom=s,this.camera.setZoom(s),this.updateCameraBounds(),this.camera.scrollX=e-(e-n)*o/s,this.camera.scrollY=t-(t-r)*o/s,this.softClampScroll(),as(this.currentZoom)}setupMouseControls(){this.scene.input.on("wheel",(e,t,s,n,r)=>{if(this.isAnimatingReset)return;if((e.event.ctrlKey||Math.abs(s)<5&&Math.abs(n)>0)&&!e.event.ctrlKey){const l=-n*fi*3;this.targetZoom=N.Math.Clamp(this.targetZoom+l,this.minZoom,$s);const c=this.camera.getWorldPoint(e.x,e.y);this.zoomTargetWorldPoint={x:c.x,y:c.y}}else if(e.event.ctrlKey){const l=-n*fi,c=N.Math.Clamp(this.currentZoom+l,this.minZoom,$s);this.targetZoom=c,this.zoomToPoint(e.x,e.y,c)}else{const l=this.getScrollBounds();this.camera.scrollX=N.Math.Clamp(this.camera.scrollX+s/this.currentZoom,l.minX,l.maxX),this.camera.scrollY=N.Math.Clamp(this.camera.scrollY+n/this.currentZoom,l.minY,l.maxY)}}),this.scene.input.on("pointerdown",e=>{if(e.wasTouch){if(this.activeTouches.set(e.id,{x:e.x,y:e.y}),this.activeTouches.size===2){this.isPinching=!0,this.startPinch(),this.touchStartPos=null,this.touchOnSelectedSprite=!1,this.scene.data.set("touchDraggingSprite",!1);return}this.activeTouches.size===1&&!this.isPinching&&(this.touchStartTime=Date.now(),this.touchStartPos={x:e.x,y:e.y},this.dragScrollStartX=e.x,this.dragScrollStartY=e.y,this.dragScrollCameraStartX=this.camera.scrollX,this.dragScrollCameraStartY=this.camera.scrollY,this.touchOnSelectedSprite=ir(this.scene,e),this.scene.data.set("touchDraggingSprite",!1),this.scene.data.set("touchStartOnSelectedSprite",this.touchOnSelectedSprite),this.scene.data.set("touchStartWorldX",e.worldX),this.scene.data.set("touchStartWorldY",e.worldY));return}xt()||ni()||this.isAnimatingReset||(e.rightButtonDown()||e.middleButtonDown()?(this.isPanning=!0,this.panStartX=e.x,this.panStartY=e.y,this.cameraDragStartX=this.camera.scrollX,this.cameraDragStartY=this.camera.scrollY):e.leftButtonDown()&&!this.isDraggingObject()&&(this.scene.data.get("isDraggingItem")===!0||(this.dragScrollStartX=e.x,this.dragScrollStartY=e.y,this.dragScrollCameraStartX=this.camera.scrollX,this.dragScrollCameraStartY=this.camera.scrollY)))}),this.scene.input.on("pointermove",e=>{if(e.wasTouch){if(this.activeTouches.has(e.id)&&this.activeTouches.set(e.id,{x:e.x,y:e.y}),this.activeTouches.size>=2&&this.isPinching){this.handlePinch();return}if(this.isPinching||Date.now()-this.pinchEndTime<this.PINCH_COOLDOWN||this.scene.data.get("touchDraggingSprite"))return;if(this.touchStartPos&&!this.isDraggingToScroll){const t=Math.abs(e.x-this.touchStartPos.x),s=Math.abs(e.y-this.touchStartPos.y);if(Math.sqrt(t*t+s*s)>this.TAP_MAX_DISTANCE){if(this.touchOnSelectedSprite){this.scene.data.set("touchDragStarted",!0),this.scene.data.set("touchDraggingSprite",!0),this.touchStartPos=null;return}!xt()&&!this.isDraggingObject()&&!this.scene.data.get("isDraggingItem")&&(this.isDraggingToScroll=!0,this.touchStartPos=null)}}this.isDraggingToScroll&&this.applyPanDelta(e.x,e.y,this.dragScrollStartX,this.dragScrollStartY,this.dragScrollCameraStartX,this.dragScrollCameraStartY);return}if(!(ni()||this.isAnimatingReset)){if(this.isPanning)this.applyPanDelta(e.x,e.y,this.panStartX,this.panStartY,this.cameraDragStartX,this.cameraDragStartY);else if(e.leftButtonDown()&&!this.isDraggingToScroll&&!this.isDraggingObject()&&!(this.scene.data.get("isDraggingItem")===!0)){const s=Math.abs(e.x-this.dragScrollStartX),n=Math.abs(e.y-this.dragScrollStartY);Math.sqrt(s*s+n*n)>10&&(this.isDraggingToScroll=!0,this.scene.input.setDefaultCursor("grabbing"))}this.isDraggingToScroll&&this.applyPanDelta(e.x,e.y,this.dragScrollStartX,this.dragScrollStartY,this.dragScrollCameraStartX,this.dragScrollCameraStartY)}}),this.scene.input.on("pointerup",e=>{if(e.wasTouch){if(this.isPinching&&(this.pinchEndTime=Date.now(),this.isPinching=!1,Es(!1)),this.touchStartPos&&!this.isDraggingToScroll){const t=Date.now()-this.touchStartTime,s=Math.abs(e.x-this.touchStartPos.x),n=Math.abs(e.y-this.touchStartPos.y),r=Math.sqrt(s*s+n*n);t<this.TAP_MAX_DURATION&&r<this.TAP_MAX_DISTANCE&&(this.scene.data.set("lastTapTime",Date.now()),this.scene.data.set("lastTapWorldX",e.worldX),this.scene.data.set("lastTapWorldY",e.worldY))}this.touchStartPos=null,this.touchOnSelectedSprite=!1,this.activeTouches.delete(e.id),this.scene.data.set("touchDraggingSprite",!1),this.scene.data.set("touchDragStarted",!1),this.scene.data.set("touchStartOnSelectedSprite",!1),this.isDraggingToScroll&&(this.isDraggingToScroll=!1);return}!e.rightButtonDown()&&!e.middleButtonDown()&&(this.isPanning=!1),this.isDraggingToScroll&&(this.isDraggingToScroll=!1,this.scene.input.setDefaultCursor("default"))}),this.scene.input.on("pointerout",e=>{e.wasTouch&&(this.activeTouches.delete(e.id),this.touchStartPos=null,this.touchOnSelectedSprite=!1,this.isPinching&&this.activeTouches.size<2&&(this.isPinching=!1,this.pinchEndTime=Date.now(),Es(!1)))})}startPinch(){const e=Array.from(this.activeTouches.values());if(e.length!==2)return;const[t,s]=e;this.pinchStartDistance=Math.hypot(s.x-t.x,s.y-t.y),this.pinchStartZoom=this.currentZoom,Es(!0)}handlePinch(){const e=Array.from(this.activeTouches.values());if(e.length!==2)return;const[t,s]=e,n=Math.hypot(s.x-t.x,s.y-t.y),r=(t.x+s.x)/2,o=(t.y+s.y)/2,l=n/this.pinchStartDistance,c=N.Math.Clamp(this.pinchStartZoom*l,this.minZoom,$s);this.targetZoom=c,this.zoomToPoint(r,o,c)}setupKeyboardControls(){const e={up:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.UP,!1),down:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.DOWN,!1),left:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.LEFT,!1),right:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.RIGHT,!1)},t={w:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.W,!1),a:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.A,!1),s:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.S,!1),d:this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.D,!1)};this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.SPACE,!1).on("down",()=>{$t()||this.centerOnPlayer()}),this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.F,!1).on("down",()=>{$t()||this.resetToFit()}),this.scene.data.set("cameraArrowKeys",e),this.scene.data.set("cameraWasdKeys",t)}setupUpdateLoop(){const e=this.scene.data.get("cameraArrowKeys"),t=this.scene.data.get("cameraWasdKeys");this.scene.events.on("update",()=>{if(!this.isAnimatingReset&&Math.abs(this.currentZoom-this.targetZoom)>1e-4){const r=N.Math.Linear(this.currentZoom,this.targetZoom,_r);this.zoomTargetWorldPoint?this.zoomToWorldPoint(this.zoomTargetWorldPoint.x,this.zoomTargetWorldPoint.y,r):this.zoomToPoint(this.camera.width/2,this.camera.height/2,r),Math.abs(this.currentZoom-this.targetZoom)<.001&&(this.zoomTargetWorldPoint=null)}if($t()||this.isAnimatingReset)return;const s=10/this.currentZoom,n=this.getScrollBounds();e?.left?.isDown||t?.a?.isDown?this.camera.scrollX=N.Math.Clamp(this.camera.scrollX-s,n.minX,n.maxX):(e?.right?.isDown||t?.d?.isDown)&&(this.camera.scrollX=N.Math.Clamp(this.camera.scrollX+s,n.minX,n.maxX)),e?.up?.isDown||t?.w?.isDown?this.camera.scrollY=N.Math.Clamp(this.camera.scrollY-s,n.minY,n.maxY):(e?.down?.isDown||t?.s?.isDown)&&(this.camera.scrollY=N.Math.Clamp(this.camera.scrollY+s,n.minY,n.maxY))})}centerOnPlayer(){const e=this.scene.data.get("playerSprite");e&&(this.camera.centerOn(e.x,e.y),this.clampScroll())}isDraggingObject(){return this.scene.data.get("isDraggingObject")===!0||this.scene.data.get("isDraggingItem")===!0}resetToFit(){if(this.isAnimatingReset)return;this.isAnimatingReset=!0,this.targetZoom=this.minZoom;const e=this.camera.width/this.minZoom,t=this.camera.height/this.minZoom,s=(this.worldWidth-e)/2,n=(this.worldHeight-t)/2,r=s+e/2,o=n+t/2;this.camera.pan(r,o,pi,"Sine.easeInOut"),this.camera.zoomTo(this.minZoom,pi,"Sine.easeInOut",!1,(l,c)=>{c===1&&(this.currentZoom=this.minZoom,this.camera.scrollX=s,this.camera.scrollY=n,this.isAnimatingReset=!1,as(this.minZoom))})}destroy(){this.activeTouches.clear()}}const Ir=Ot.PLAYER.hex;class Er{scene;player;worldWidth;worldHeight;unsubscribers=[];interactionCleanup=null;constructor(e,t,s){this.scene=e,this.worldWidth=t,this.worldHeight=s}create(e,t){const s=Math.min(t,jt(this.worldHeight)),n=Ut.getSkinId(),r=Ne.find(l=>l.id===n)??Ne[0],o=Ls(r);return this.player=this.scene.add.sprite(e,s,`${n}-idle`,0),this.player.setScale(o),this.player.setDepth(Ni.DEPTH),this.player.setData("isPlayer",!0),this.scene.data.set("playerSprite",this.player),this.setupInteraction(),this.setupEditModeSubscription(),this.setupSelectionSubscription(),this.player}setupInteraction(){const e=new N.Geom.Rectangle(8,4,32,40);this.interactionCleanup=ws({sprite:this.player,scene:this.scene,useGridSnapping:!1,cursor:"grab",hitArea:e,constraints:{minX:ci,maxX:this.worldWidth-ci,minY:Qa},callbacks:{onSelect:()=>{$a(!0)},isSelected:()=>je(Cs),onDragStart:()=>{this.player.setTint(ei),this.scene.data.set("isDraggingObject",!0)},onDrag:(t,s)=>{ri(Math.round(t),Math.round(s))},onDragEnd:(t,s)=>{this.updateSelectionVisual(je(Cs)),this.scene.data.set("isDraggingObject",!1);let n=this.player.y;ta(this.player.y,this.worldHeight)&&(n=jt(this.worldHeight),this.player.setY(n)),ri(Math.round(this.player.x),Math.round(n))}}})}setupSelectionSubscription(){const e=Cs.subscribe(t=>{this.updateSelectionVisual(t),this.scene.data.set("isPlayerSelected",t)});this.unsubscribers.push(e)}updateSelectionVisual(e){this.player&&(e?this.player.setTint(Ir):this.player.clearTint())}setupEditModeSubscription(){const e=Ze.subscribe(t=>{t==="dialogs"?(this.interactionCleanup&&(this.interactionCleanup(),this.interactionCleanup=null),this.player.disableInteractive(),this.player.setAlpha(.6)):(this.player.setAlpha(1),this.interactionCleanup||this.setupInteraction())});this.unsubscribers.push(e)}getSprite(){return this.player}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.interactionCleanup&&(this.interactionCleanup(),this.interactionCleanup=null),this.player&&this.player.destroy()}}class Cr{scene;graphics;worldWidth;worldHeight;constructor(e,t,s){this.scene=e,this.worldWidth=t,this.worldHeight=s}create(){return this.graphics=this.scene.add.graphics(),this.graphics.setDepth(fn),this.draw(),this.graphics}draw(){this.graphics.clear(),this.graphics.lineStyle(Ga,za,Ka);const e=Math.max(this.worldHeight,this.scene.scale.height);for(let s=0;s<=this.worldWidth;s+=kt)this.graphics.beginPath(),this.graphics.moveTo(s,0),this.graphics.lineTo(s,e),this.graphics.strokePath();for(let s=0;s<=e;s+=kt)this.graphics.beginPath(),this.graphics.moveTo(0,s),this.graphics.lineTo(this.worldWidth,s),this.graphics.strokePath();const t=this.worldHeight-Lt;this.graphics.lineStyle(Ua,ks,Va),this.graphics.beginPath(),this.graphics.moveTo(0,t),this.graphics.lineTo(this.worldWidth,t),this.graphics.strokePath(),this.graphics.lineStyle(qa,ks,Ja),this.graphics.fillStyle(ks,ja),this.graphics.fillRect(0,t,this.worldWidth,e-t)}getGraphics(){return this.graphics}redraw(){this.draw()}destroy(){this.graphics&&this.graphics.destroy()}}class Tr{listeners=new Map;on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set);const s=this.listeners.get(e);return s.add(t),{unsubscribe:()=>{s.delete(t),s.size===0&&this.listeners.delete(e)}}}once(e,t){const s=this.on(e,n=>{s.unsubscribe(),t(n)});return s}emit(e,t){const s=this.listeners.get(e);s&&s.forEach(n=>{try{n(t)}catch(r){console.error(`[EventBus] Error in listener for "${e}":`,r)}})}off(e){this.listeners.delete(e)}clear(){this.listeners.clear()}listenerCount(e){return this.listeners.get(e)?.size??0}}const Fe=new Tr,$e={ASSET_DROPPED:"asset:dropped",FRAME_DROPPED:"frame:dropped",SOCIAL_DROPPED:"social:dropped",MINIMAP_NAVIGATE:"minimap:navigate",DIALOG_ZONE_CREATE:"dialogZone:create",DIALOG_ZONE_CREATE_AT:"dialogZone:createAt",TEMP_ZONE_BUTTON_SHOW:"tempZoneButton:show",TEMP_ZONE_BUTTON_HIDE:"tempZoneButton:hide"};class Dr{scene;groundY;worldWidth;worldHeight;itemManager;unsubscribers=[];constructor(e,t,s,n){this.scene=e,this.groundY=t,this.worldWidth=s,this.worldHeight=n}create(e){return this.itemManager=new gs(this.scene,this.groundY,this.worldWidth,this.worldHeight,!0),e&&e.length>0&&this.itemManager.createItems(e),this.setupBackgroundDeselect(),this.setupStoreSubscriptions(),this.setupAssetDropListener(),this.setupDeleteKeys(),this.itemManager}setupBackgroundDeselect(){this.itemManager.setupBackgroundDeselect()}setupStoreSubscriptions(){const e=Ss.subscribe(r=>{this.scene.data.set("selectedItemId",r),this.itemManager.updateSelectionVisuals()});this.unsubscribers.push(e);const t=Ze.subscribe(r=>{r==="dialogs"?(Us(),this.itemManager.setInteractiveEnabled(!1)):this.itemManager.setInteractiveEnabled(!0)});this.unsubscribers.push(t);let s=[];const n=pa.subscribe(r=>{if(!r?.placedItems)return;const o=r.placedItems;s.forEach(l=>{o.find(d=>d.id===l.id)||this.itemManager.removeItem(l.id)}),o.forEach(l=>{const c=s.find(d=>d.id===l.id);c&&JSON.stringify(c)!==JSON.stringify(l)&&this.itemManager.updateItem(l.id,l)}),s=o.map(l=>({...l}))});this.unsubscribers.push(n)}setupAssetDropListener(){const e=Fe.on($e.ASSET_DROPPED,t=>{const{assetKey:s,canvasX:n,canvasY:r}=t,l=this.scene.cameras.main.getWorldPoint(n,r),c=Math.max(0,Math.min(this.worldWidth,l.x)),d=Math.max(0,Math.min(this.worldHeight,l.y));let h="behind";tn.subscribe(E=>{h=E})();const x=hs.createAtWorldPosition(s,c,d,this.groundY,h);ka(x),this.itemManager.createItem(x),dn(x.id),_t.set(!1)});this.unsubscribers.push(()=>e.unsubscribe())}setupDeleteKeys(){const e=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.DELETE,!1),t=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.BACKSPACE,!1),s=()=>{if($t())return;const n=this.scene.data.get("selectedItemId");n&&cn(n)};e.on("down",s),t.on("down",s)}getManager(){return this.itemManager}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.itemManager&&this.itemManager.destroy()}}class mi{scene;worldWidth;worldHeight;frames=new Map;unsubscribers=[];selectionGraphics=null;cleanupFunctions=new Map;doubleClickDetector=new pn;constructor(e,t,s){this.scene=e,this.worldWidth=t,this.worldHeight=s}static preloadAssets(e){for(let t=1;t<=25;t++)e.load.image(`frame_base_${t}`,`assets/frames/base ${t}.png`)}create(e){this.selectionGraphics=this.scene.add.graphics(),this.selectionGraphics.setDepth(We.SELECTION_GRAPHICS),e&&e.length>0&&e.forEach(t=>this.createFrame(t)),this.setupStoreSubscriptions(),this.setupFrameDropListener(),this.setupDeleteKeys()}createFrame(e){const t=`frame_${e.frameKey}`;if(!this.scene.textures.exists(t)){console.warn(`Frame texture not found: ${t}`);return}const s=e.scale??lt,n=e.depth??We.ITEMS_FRONT,r=(e.rotation??0)*(Math.PI/180),o=e.rotation===90,{innerWidth:l,innerHeight:c}=Nt(s,o),d=this.scene.add.graphics();d.setDepth(n-.1),ds(d,e.x,e.y,l,c,e.backgroundColor||Wt);const h=this.scene.add.sprite(e.x,e.y,t);h.setScale(s),h.setDepth(n),h.setOrigin(.5,.5),h.setRotation(r),h.setData("frameId",e.id);const m={sprite:h,background:d,data:e};this.frames.set(e.id,m),this.makeInteractive(m,e.id)}updateFrameVisuals(e){const{sprite:t,background:s,data:n}=e,r=`frame_${n.frameKey}`;t.texture.key!==r&&this.scene.textures.exists(r)&&t.setTexture(r);const o=n.scale??lt;t.setScale(o);const l=(n.rotation??0)*(Math.PI/180);t.setRotation(l);const c=n.rotation===90,{innerWidth:d,innerHeight:h}=Nt(o,c);ds(s,t.x,t.y,d,h,n.backgroundColor||Wt)}moveContainer(e,t,s){const{sprite:n,background:r,data:o}=e;n.setPosition(t,s);const l=o.scale??lt,c=o.rotation===90,{innerWidth:d,innerHeight:h}=Nt(l,c);ds(r,t,s,d,h,o.backgroundColor||Wt)}makeInteractive(e,t){const{sprite:s}=e,n=ws({sprite:s,scene:this.scene,cursor:"grab",useGridSnapping:!0,constraints:{minX:0,maxX:this.worldWidth,minY:0,maxY:this.worldHeight},callbacks:{onSelect:()=>{Yt(t),this.updateSelectionVisuals()},isSelected:()=>je(Jt)===t,onDoubleClick:()=>this.doubleClickDetector.check(t)?(Qi(),!0):!1,onDragStart:()=>{s.setTint(ei)},onDrag:(r,o)=>{this.moveContainer(e,r,o),this.updateSelectionVisuals(),Ea(t,r,o)},onDragEnd:(r,o)=>{s.clearTint(),Ca(t),e.data.x=Math.round(r),e.data.y=Math.round(o),it(t,{x:e.data.x,y:e.data.y})}}});this.cleanupFunctions.set(t,n)}setupStoreSubscriptions(){const e=Jt.subscribe(r=>{this.scene.data.set("selectedFrameId",r),this.updateSelectionVisuals()});this.unsubscribers.push(e);const t=Ze.subscribe(r=>{r==="dialogs"?(Yt(null),this.setInteractiveEnabled(!1)):this.setInteractiveEnabled(!0)});this.unsubscribers.push(t);let s=[];const n=sn.subscribe(r=>{s.forEach(o=>{r.find(c=>c.id===o.id)||this.removeFrame(o.id)}),r.forEach(o=>{const l=s.find(d=>d.id===o.id),c=this.frames.get(o.id);if(c&&l){const d=l.backgroundColor!==o.backgroundColor,h=l.textColor!==o.textColor,m=l.textSize!==o.textSize,x=JSON.stringify(l.texts)!==JSON.stringify(o.texts),E=l.rotation!==o.rotation,w=l.scale!==o.scale,C=l.frameKey!==o.frameKey;c.data=o,(d||h||m||x||E||w||C)&&(this.updateFrameVisuals(c),this.scene.data.get("selectedFrameId")===o.id&&this.updateSelectionVisuals())}}),s=r.map(o=>({...o}))});this.unsubscribers.push(n)}setupFrameDropListener(){const e=Fe.on($e.FRAME_DROPPED,t=>{const{frameKey:s,canvasX:n,canvasY:r}=t,l=this.scene.cameras.main.getWorldPoint(n,r),c=Math.max(0,Math.min(this.worldWidth,l.x)),d=Math.max(0,Math.min(this.worldHeight,l.y)),h={id:rr(),frameKey:s,x:Math.round(c),y:Math.round(d),scale:vr(s),depth:We.ITEMS_FRONT,rotation:90,backgroundColor:Wt,textColor:"#333333",textSize:16,texts:[{language:"cs",text:""},{language:"en",text:""}]};Za(h),this.createFrame(h),Yt(h.id)});this.unsubscribers.push(()=>e.unsubscribe())}setupDeleteKeys(){const e=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.DELETE,!1),t=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.BACKSPACE,!1),s=()=>{if($t())return;let n="items";if(Ze.subscribe(l=>n=l)(),n!=="frames")return;const o=this.scene.data.get("selectedFrameId");o&&qs(o)};e.on("down",s),t.on("down",s)}updateSelectionVisuals(){if(!this.selectionGraphics)return;this.selectionGraphics.clear();const e=this.scene.data.get("selectedFrameId");if(!e){Ps(null);return}const t=this.frames.get(e);if(!t){Ps(null);return}const s=t.sprite,n=s.getBounds(),r=this.scene.cameras.main,{screenX:o,screenY:l}=yt(s.x,s.y,r);Ps({screenX:o,screenY:l,frameHeight:n.height*r.zoom}),this.selectionGraphics.lineStyle(3,Ot.FRAME.hex,1),this.selectionGraphics.strokeRect(n.x-4,n.y-4,n.width+8,n.height+8)}removeFrame(e){const t=this.frames.get(e);t&&(t.sprite.destroy(),t.background.destroy(),this.frames.delete(e)),this.updateSelectionVisuals()}setInteractiveEnabled(e){this.frames.forEach(({sprite:t,background:s})=>{e?(t.setInteractive(),t.setAlpha(1),s.setAlpha(1)):(t.disableInteractive(),t.setAlpha(.6),s.setAlpha(.6))}),!e&&this.selectionGraphics&&this.selectionGraphics.clear()}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.frames.forEach(({sprite:e,background:t})=>{e.destroy(),t.destroy()}),this.frames.clear(),this.selectionGraphics&&(this.selectionGraphics.destroy(),this.selectionGraphics=null)}}class vi{scene;worldWidth;worldHeight;socials=new Map;unsubscribers=[];selectionGraphics=null;cleanupFunctions=new Map;doubleClickDetector=new pn;constructor(e,t,s){this.scene=e,this.worldWidth=t,this.worldHeight=s}static preloadAssets(e){e.load.image("social_discord","assets/socials/Discord.png"),e.load.image("social_facebook","assets/socials/Facebook.png"),e.load.image("social_instagram","assets/socials/Instagram.png"),e.load.image("social_kofi","assets/socials/Ko Fi.png"),e.load.image("social_linkedin","assets/socials/LinkedIn.png"),e.load.image("social_patreon","assets/socials/Patreon.png"),e.load.image("social_tiktok","assets/socials/TikTok.png"),e.load.image("social_twitch","assets/socials/Twitch.png"),e.load.image("social_twitter","assets/socials/Twitter.png"),e.load.image("social_whatsapp","assets/socials/Whatsapp.png"),e.load.image("social_youtube","assets/socials/Youtube.png")}create(e){this.selectionGraphics=this.scene.add.graphics(),this.selectionGraphics.setDepth(We.SELECTION_GRAPHICS),e&&e.length>0&&e.forEach(t=>this.createSocial(t)),this.setupStoreSubscriptions(),this.setupSocialDropListener(),this.setupDeleteKeys()}createSocial(e){const t=`social_${e.socialKey}`;if(!this.scene.textures.exists(t)){console.warn(`Social texture not found: ${t}`);return}const s=e.scale??At,n=e.depth??We.ITEMS_FRONT,r=this.scene.add.sprite(e.x,e.y,t);r.setScale(s),r.setDepth(n),r.setOrigin(.5,.5),r.setData("socialId",e.id),this.socials.set(e.id,{sprite:r,data:e}),this.makeInteractive(e.id)}updateSocialVisuals(e){const t=this.socials.get(e);if(!t)return;const{sprite:s,data:n}=t,r=`social_${n.socialKey}`;s.texture.key!==r&&this.scene.textures.exists(r)&&s.setTexture(r);const o=n.scale??At;s.setScale(o)}makeInteractive(e){const t=this.socials.get(e);if(!t)return;const{sprite:s}=t,n=ws({sprite:s,scene:this.scene,cursor:"grab",useGridSnapping:!0,constraints:{minX:0,maxX:this.worldWidth,minY:0,maxY:this.worldHeight},callbacks:{onSelect:()=>{Bt(e),this.updateSelectionVisuals()},isSelected:()=>je(Qt)===e,onDoubleClick:()=>this.doubleClickDetector.check(e)?(en(),!0):!1,onDragStart:()=>{s.setTint(ei)},onDrag:()=>{this.updateSelectionVisuals()},onDragEnd:(r,o)=>{s.clearTint();const l=this.socials.get(e);l&&(l.data.x=Math.round(r),l.data.y=Math.round(o),ls(e,{x:l.data.x,y:l.data.y}))}}});this.cleanupFunctions.set(e,n)}setupStoreSubscriptions(){const e=Qt.subscribe(r=>{this.scene.data.set("selectedSocialId",r),this.updateSelectionVisuals()});this.unsubscribers.push(e);const t=Ze.subscribe(r=>{r==="dialogs"?(Bt(null),this.setInteractiveEnabled(!1)):this.setInteractiveEnabled(!0)});this.unsubscribers.push(t);let s=[];const n=xa.subscribe(r=>{s.forEach(o=>{r.find(c=>c.id===o.id)||this.removeSocial(o.id)}),r.forEach(o=>{const l=s.find(d=>d.id===o.id),c=this.socials.get(o.id);if(c&&l){const d=l.scale!==o.scale,h=l.socialKey!==o.socialKey;c.data=o,(d||h)&&(this.updateSocialVisuals(o.id),this.scene.data.get("selectedSocialId")===o.id&&this.updateSelectionVisuals())}}),s=r.map(o=>({...o}))});this.unsubscribers.push(n)}setupSocialDropListener(){const e=Fe.on($e.SOCIAL_DROPPED,t=>{const{socialKey:s,canvasX:n,canvasY:r}=t,l=this.scene.cameras.main.getWorldPoint(n,r),c=Math.max(0,Math.min(this.worldWidth,l.x)),d=Math.max(0,Math.min(this.worldHeight,l.y)),h={id:yr(),socialKey:s,x:Math.round(c),y:Math.round(d),scale:At,depth:We.ITEMS_FRONT};Ya(h),this.createSocial(h),Bt(h.id)});this.unsubscribers.push(()=>e.unsubscribe())}setupDeleteKeys(){const e=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.DELETE,!1),t=this.scene.input.keyboard.addKey(N.Input.Keyboard.KeyCodes.BACKSPACE,!1),s=()=>{if($t())return;let n="items";if(Ze.subscribe(l=>n=l)(),n!=="socials")return;const o=this.scene.data.get("selectedSocialId");o&&Js(o)};e.on("down",s),t.on("down",s)}updateSelectionVisuals(){if(!this.selectionGraphics)return;this.selectionGraphics.clear();const e=this.scene.data.get("selectedSocialId");if(!e){Ts(null);return}const t=this.socials.get(e);if(!t){Ts(null);return}const s=t.sprite,n=s.getBounds(),r=this.scene.cameras.main,{screenX:o,screenY:l}=yt(s.x,s.y,r);Ts({screenX:o,screenY:l,socialHeight:n.height*r.zoom}),this.selectionGraphics.lineStyle(3,Ot.SOCIAL.hex,1),this.selectionGraphics.strokeRect(n.x-4,n.y-4,n.width+8,n.height+8)}removeSocial(e){const t=this.socials.get(e);t&&(t.sprite.destroy(),this.socials.delete(e));const s=this.cleanupFunctions.get(e);s&&(s(),this.cleanupFunctions.delete(e)),this.updateSelectionVisuals()}setInteractiveEnabled(e){this.socials.forEach(({sprite:t})=>{e?(t.setInteractive(),t.setAlpha(1)):(t.disableInteractive(),t.setAlpha(.6))}),!e&&this.selectionGraphics&&this.selectionGraphics.clear()}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[],this.cleanupFunctions.forEach(e=>e()),this.cleanupFunctions.clear(),this.socials.forEach(({sprite:e})=>{e.destroy()}),this.socials.clear(),this.selectionGraphics&&(this.selectionGraphics.destroy(),this.selectionGraphics=null)}}const dt=fn-1,ht=300,yi=150,Pr=.3,kr=.5,Ms=40,Si=60,bi=16777215,wi=.6,_i=0,tt=60,xi=8;class $r{scene;worldWidth;worldHeight;graphics=null;zoneAreas=new Map;leftHandles=new Map;leftHandleVisuals=new Map;rightHandles=new Map;rightHandleVisuals=new Map;arrowGraphics=new Map;dragging=null;unsubscribers=[];createZoneSubscription;currentEditMode="items";currentZones=[];currentSelectedId=null;lastClickTime=0;lastClickX=0;DOUBLE_CLICK_THRESHOLD=300;DOUBLE_CLICK_DISTANCE=20;pendingTap=null;TAP_MAX_DURATION=300;TAP_MAX_DISTANCE=15;pendingZoneSelection=null;createZoneAtSubscription;boundWindowPointerUp=()=>{};boundWindowPointerMove=()=>{};currentScreenX=0;autoScrollTimer=null;constructor(e,t,s){this.scene=e,this.worldWidth=t,this.worldHeight=s}create(){this.graphics=this.scene.add.graphics(),this.graphics.setDepth(dt);const e=Ze.subscribe(n=>{this.currentEditMode=n,this.render()});this.unsubscribers.push(e);const t=Ns.subscribe(n=>{this.currentZones=n,this.render()});this.unsubscribers.push(t);const s=bs.subscribe(n=>{this.currentSelectedId=n,this.render()});this.unsubscribers.push(s),this.scene.input.on("pointermove",this.handlePointerMove,this),this.scene.input.on("pointerup",this.handlePointerUp,this),this.boundWindowPointerUp=this.handlePointerUp.bind(this),this.boundWindowPointerMove=this.handleWindowPointerMove.bind(this),window.addEventListener("pointerup",this.boundWindowPointerUp),window.addEventListener("pointermove",this.boundWindowPointerMove),this.scene.input.on("pointerdown",this.handlePointerDown,this),this.createZoneSubscription=Fe.on($e.DIALOG_ZONE_CREATE,()=>{this.createNewZone()}),this.createZoneAtSubscription=Fe.on($e.DIALOG_ZONE_CREATE_AT,n=>{this.createZoneAtPosition(n.worldX)}),this.render()}clearVisuals(){this.graphics&&this.graphics.clear(),this.zoneAreas.forEach(e=>e.destroy()),this.zoneAreas.clear(),this.leftHandles.forEach(e=>e.destroy()),this.leftHandles.clear(),this.rightHandles.forEach(e=>e.destroy()),this.rightHandles.clear(),this.leftHandleVisuals.forEach(e=>e.destroy()),this.leftHandleVisuals.clear(),this.rightHandleVisuals.forEach(e=>e.destroy()),this.rightHandleVisuals.clear(),this.arrowGraphics.forEach(e=>e.destroy()),this.arrowGraphics.clear()}render(){if(this.clearVisuals(),this.currentEditMode==="dialogs")for(const e of this.currentZones)this.renderZone(e,e.id===this.currentSelectedId)}renderZone(e,t){if(!this.graphics)return;const s=N.Display.Color.HexStringToColor(e.color).color,n=t?kr:Pr;this.graphics.fillStyle(s,n),this.graphics.fillRect(e.x,0,e.width,this.worldHeight),this.graphics.lineStyle(2,s,.8),this.graphics.strokeRect(e.x,0,e.width,this.worldHeight);const r=this.scene.add.rectangle(e.x+e.width/2,this.worldHeight/2,e.width-Ms*2,this.worldHeight);r.setOrigin(.5,.5),r.setInteractive({cursor:t?"grab":"pointer"}),r.setDepth(dt+.1),r.setAlpha(.001),r.setData("zoneId",e.id),r.on("pointerdown",o=>{if(this.isClickOnUIElement(o))return;const l=Date.now(),c=l-this.lastClickTime<this.DOUBLE_CLICK_THRESHOLD&&Math.abs(o.worldX-this.lastClickX)<this.DOUBLE_CLICK_DISTANCE;this.lastClickTime=l,this.lastClickX=o.worldX;const d=this.currentSelectedId===e.id;if(c&&d){ln();return}d?(this.scene.data.set("isDraggingItem",!0),Mt(!0),this.startDrag(e.id,"move",o.worldX)):this.pendingZoneSelection={zoneId:e.id,worldX:o.worldX,startTime:l}}),this.zoneAreas.set(e.id,r),t&&this.createHandles(e)}createHandles(e){const t=this.scene.cameras.main.scrollY,s=this.scene.cameras.main.height,n=t+s/2,r=this.scene.add.rectangle(e.x,this.worldHeight/2,Ms,this.worldHeight);r.setOrigin(.5,.5),r.setDepth(dt+.2),r.setFillStyle(bi,wi);const o=this.scene.add.rectangle(e.x,this.worldHeight/2,Si,this.worldHeight);o.setOrigin(.5,.5),o.setInteractive({cursor:"ew-resize"}),o.setDepth(dt+.25),o.setAlpha(.001),o.setData("zoneId",e.id),o.setData("type","left"),o.on("pointerdown",x=>{this.isClickOnUIElement(x)||this.startDrag(e.id,"left",x.worldX)}),this.leftHandles.set(e.id,o),this.leftHandleVisuals.set(e.id,r);const l=8,c=this.scene.add.graphics();c.setDepth(dt+.3),this.drawArrow(c,e.x-l,n,"left"),this.arrowGraphics.set(`${e.id}_left`,c);const d=this.scene.add.rectangle(e.x+e.width,this.worldHeight/2,Ms,this.worldHeight);d.setOrigin(.5,.5),d.setDepth(dt+.2),d.setFillStyle(bi,wi);const h=this.scene.add.rectangle(e.x+e.width,this.worldHeight/2,Si,this.worldHeight);h.setOrigin(.5,.5),h.setInteractive({cursor:"ew-resize"}),h.setDepth(dt+.25),h.setAlpha(.001),h.setData("zoneId",e.id),h.setData("type","right"),h.on("pointerdown",x=>{this.isClickOnUIElement(x)||this.startDrag(e.id,"right",x.worldX)}),this.rightHandles.set(e.id,h),this.rightHandleVisuals.set(e.id,d);const m=this.scene.add.graphics();m.setDepth(dt+.3),this.drawArrow(m,e.x+e.width+l,n,"right"),this.arrowGraphics.set(`${e.id}_right`,m)}drawArrow(e,t,s,n){const o=n==="left"?-1:1;e.fillStyle(3355443,.8),e.beginPath(),e.moveTo(t+o*10+1,s),e.lineTo(t-o*10+1,s-10+1),e.lineTo(t-o*10+1,s+10-1),e.closePath(),e.fillPath(),e.fillStyle(16777215,.9),e.beginPath(),e.moveTo(t+o*10,s),e.lineTo(t-o*10,s-10),e.lineTo(t-o*10,s+10),e.closePath(),e.fillPath()}startDrag(e,t,s){const n=this.currentZones.find(r=>r.id===e);n&&(this.scene.data.set("isDraggingItem",!0),Mt(!0),this.dragging={zoneId:e,type:t,startX:s,originalX:n.x,originalWidth:n.width})}getZoneBounds(e){let t=0,s=this.worldWidth;for(const n of this.currentZones){if(n.id===e)continue;const r=n.x+n.width,o=this.currentZones.find(l=>l.id===e);o&&(r<=o.x+o.width/2&&(t=Math.max(t,r+_i)),n.x>=o.x+o.width/2&&(s=Math.min(s,n.x-_i)))}return{minX:t,maxX:s-ht,maxRight:s}}wouldOverlap(e,t,s){const n=t+s;for(const r of this.currentZones){if(r.id===e)continue;const o=r.x,l=r.x+r.width;if(t<l&&n>o)return!0}return!1}isClickOnUIElement(e){const t=e.downElement;return t?t.tagName?.toUpperCase()!=="CANVAS":!1}cancelPendingIfMoved(e){this.pendingTap&&Math.abs(e-this.pendingTap.worldX)>this.TAP_MAX_DISTANCE&&(this.pendingTap=null),this.pendingZoneSelection&&Math.abs(e-this.pendingZoneSelection.worldX)>this.TAP_MAX_DISTANCE&&(this.pendingZoneSelection=null)}screenToWorld(e,t){const s=this.scene.cameras.main,r=this.scene.game.canvas.getBoundingClientRect(),o=e-r.left,l=t-r.top;return na(o,l,s)}handleWindowPointerMove(e){const t=this.screenToWorld(e.clientX,e.clientY);if(this.cancelPendingIfMoved(t.worldX),!this.dragging)return;const n=this.scene.game.canvas.getBoundingClientRect();e.clientX>=n.left&&e.clientX<=n.right&&e.clientY>=n.top&&e.clientY<=n.bottom||(this.currentScreenX=e.clientX-n.left,this.updateDrag(t.worldX),this.checkAutoScroll())}handlePointerMove(e){this.cancelPendingIfMoved(e.worldX),this.dragging&&(this.currentScreenX=e.x,e.event?.stopPropagation?.(),this.updateDrag(e.worldX),this.checkAutoScroll())}checkAutoScroll(){if(!this.dragging||this.dragging.type!=="move"){this.stopAutoScroll();return}const e=this.scene.cameras.main,t=e.width,s=this.currentZones.find(v=>v.id===this.dragging?.zoneId);if(!s)return;const n=Math.max(0,this.worldWidth-e.width/e.zoom);if(n<=0){this.stopAutoScroll();return}const{screenX:r}=yt(s.x,0,e),{screenX:o}=yt(s.x+s.width,0,e),l=r<=tt,c=o>=t-tt,d=e.scrollX>0,h=e.scrollX<n,m=s.x>0,x=s.x+s.width<this.worldWidth,E=this.currentScreenX<tt,w=this.currentScreenX>t-tt,p=l&&E&&d&&m||c&&w&&h&&x;p&&!this.autoScrollTimer?this.autoScrollTimer=this.scene.time.addEvent({delay:16,callback:this.performAutoScroll,callbackScope:this,loop:!0}):!p&&this.autoScrollTimer&&this.stopAutoScroll()}performAutoScroll(){if(!this.dragging||this.dragging.type!=="move"){this.stopAutoScroll();return}const e=this.scene.cameras.main,t=e.width,s=this.currentZones.find(D=>D.id===this.dragging?.zoneId);if(!s)return;let n=0;if(this.currentScreenX<tt){if(s.x<=0){this.stopAutoScroll();return}const p=(tt-this.currentScreenX)/tt;n=-xi*p}else if(this.currentScreenX>t-tt){if(s.x+s.width>=this.worldWidth){this.stopAutoScroll();return}const p=(this.currentScreenX-(t-tt))/tt;n=xi*p}if(n===0)return;const r=e.scrollX+n,o=0,l=Math.max(0,this.worldWidth-e.width/e.zoom),d=Math.max(o,Math.min(l,r))-e.scrollX;if(l<=0){this.stopAutoScroll();return}if(d===0){this.stopAutoScroll();return}const h=s.x+d,m=Math.max(0,Math.min(this.worldWidth-s.width,h)),x=m-s.x;if(x===0){this.stopAutoScroll();return}const E=e.scrollX+x,w=Math.max(0,Math.min(l,E));if(Math.abs(w-e.scrollX)>Math.abs(x)*2){this.stopAutoScroll();return}e.scrollX=w,this.wouldOverlap(s.id,m,s.width)||(Dt(s.id,{x:m}),this.dragging.originalX+=x,this.dragging.startX+=x)}stopAutoScroll(){this.autoScrollTimer&&(this.autoScrollTimer.destroy(),this.autoScrollTimer=null)}updateDrag(e){if(!this.dragging)return;const t=e-this.dragging.startX,s=this.currentZones.find(r=>r.id===this.dragging?.zoneId);if(!s)return;const n=this.getZoneBounds(s.id);if(this.dragging.type==="left"){let r=this.dragging.originalX+t,o=this.dragging.originalWidth-t;if(r<0&&(o+=r,r=0),o<ht&&(r=this.dragging.originalX+this.dragging.originalWidth-ht,o=ht),r<n.minX){const l=n.minX-r;r=n.minX,o-=l}o>=ht&&!this.wouldOverlap(s.id,r,o)&&Dt(s.id,{x:r,width:o})}else if(this.dragging.type==="right"){let r=this.dragging.originalWidth+t;r<ht&&(r=ht),s.x+r>this.worldWidth&&(r=this.worldWidth-s.x),s.x+r>n.maxRight&&(r=n.maxRight-s.x),r>=ht&&!this.wouldOverlap(s.id,s.x,r)&&Dt(s.id,{width:r})}else if(this.dragging.type==="move"){let r=this.dragging.originalX+t;const o=s.width;if(r<0&&(r=0),r+o>this.worldWidth&&(r=this.worldWidth-o),!this.wouldOverlap(s.id,r,o))Dt(s.id,{x:r});else{const l=this.findNonOverlappingPosition(s.id,r,o);l!==null&&Dt(s.id,{x:l})}}}findNonOverlappingPosition(e,t,s){const n=this.currentZones.filter(h=>h.id!==e).sort((h,m)=>h.x-m.x);if(n.length===0)return Math.max(0,Math.min(t,this.worldWidth-s));let r=t,o=1/0;const l=n[0];if(l.x>=s){const h=l.x-s,m=Math.max(0,Math.min(t,h)),x=Math.abs(m-t);x<o&&(o=x,r=m)}for(let h=0;h<n.length-1;h++){const m=n[h],x=n[h+1],E=m.x+m.width,w=x.x;if(w-E>=s){const D=E,p=w-s,v=Math.max(D,Math.min(t,p)),f=Math.abs(v-t);f<o&&(o=f,r=v)}}const c=n[n.length-1],d=c.x+c.width;if(this.worldWidth-d>=s){const h=d,m=this.worldWidth-s,x=Math.max(h,Math.min(t,m)),E=Math.abs(x-t);E<o&&(o=E,r=x)}return o<1/0&&!this.wouldOverlap(e,r,s)?r:null}handlePointerUp(e){if(this.dragging&&(this.stopAutoScroll(),this.scene.data.set("isDraggingItem",!1),Mt(!1),this.dragging=null),this.pendingZoneSelection){let n=Date.now()-this.pendingZoneSelection.startTime<this.TAP_MAX_DURATION;n&&e&&e.worldX!==void 0&&(n=Math.abs(e.worldX-this.pendingZoneSelection.worldX)<this.TAP_MAX_DISTANCE),n&&Zt(this.pendingZoneSelection.zoneId),this.pendingZoneSelection=null}if(this.pendingTap&&this.currentEditMode==="dialogs"){if(Date.now()-this.pendingTap.startTime<this.TAP_MAX_DURATION){let n=!0;e&&e.worldX!==void 0&&(n=Math.abs(e.worldX-this.pendingTap.worldX)<this.TAP_MAX_DISTANCE),n&&this.showTempAddButton(this.pendingTap.worldX,this.pendingTap.worldY)}this.pendingTap=null}}handlePointerDown(e){if(xt()||this.currentEditMode!=="dialogs"||this.dragging)return;const t=e.downElement;if(t&&t.tagName?.toUpperCase()!=="CANVAS")return;const s=e.worldX;for(const l of this.currentZones)if(s>=l.x&&s<=l.x+l.width)return;const n=Date.now(),r=n-this.lastClickTime,o=Math.abs(s-this.lastClickX);if(r<this.DOUBLE_CLICK_THRESHOLD&&o<this.DOUBLE_CLICK_DISTANCE){this.createZoneAtPosition(s),this.lastClickTime=0,this.hideTempAddButton();return}this.lastClickTime=n,this.lastClickX=s,this.pendingTap={worldX:s,worldY:e.worldY,startTime:n},this.currentSelectedId&&Zt(null)}showTempAddButton(e,t){const s=this.scene.cameras.main,{screenX:n,screenY:r}=yt(e,t,s);Fe.emit($e.TEMP_ZONE_BUTTON_SHOW,{screenX:n,screenY:r,worldX:e})}hideTempAddButton(){Fe.emit($e.TEMP_ZONE_BUTTON_HIDE,{})}createZoneAtPosition(e){this.createZoneAt(e)}createNewZone(){const e=this.scene.cameras.main,t=e.worldView.x+e.worldView.width/2;this.createZoneAt(t)}createZoneAt(e){let t=e-yi/2;const s=yi;if(t=Math.max(0,Math.min(this.worldWidth-s,t)),this.wouldOverlap("",t,s)){const r=this.findNonOverlappingPosition("",t,s);if(r===null){console.warn("No room for a new dialog zone");return}t=r}const n=Nn(t,s);n.x=t,Wa(n),Zt(n.id)}updateSelectionVisuals(){if(this.currentEditMode!=="dialogs"){ns(null);return}if(!this.currentSelectedId){ns(null);return}const e=this.currentZones.find(o=>o.id===this.currentSelectedId);if(!e){ns(null);return}const t=this.scene.cameras.main,s=e.x+e.width/2,{screenX:n}=yt(s,0,t),r=t.height*.65;ns({screenX:n,screenY:r})}destroy(){this.hideTempAddButton();for(const e of this.unsubscribers)e();this.unsubscribers=[],this.createZoneSubscription&&this.createZoneSubscription.unsubscribe(),this.createZoneAtSubscription&&this.createZoneAtSubscription.unsubscribe(),this.stopAutoScroll(),this.scene.input.off("pointerdown",this.handlePointerDown,this),this.scene.input.off("pointermove",this.handlePointerMove,this),this.scene.input.off("pointerup",this.handlePointerUp,this),window.removeEventListener("pointerup",this.boundWindowPointerUp),window.removeEventListener("pointermove",this.boundWindowPointerMove),this.clearVisuals(),this.graphics&&(this.graphics.destroy(),this.graphics=null),this.dragging=null}}class Mr extends N.Scene{parallaxLayers=null;cameraController;playerController;gridOverlay;itemsController;framesController;socialsController;dialogZoneRenderer;config;minimapSubscription;isShuttingDown=!1;get itemManager(){return this.itemsController?.getManager()}resetZoom(){this.cameraController?.resetToFit()}constructor(){super({key:Qe.BUILDER})}init(e){this.config=e.config}preload(){Ki(this),gs.preloadAssets(this),mi.preloadAssets(this),vi.preloadAssets(this)}create(){this.isShuttingDown=!1,this.initializeScene()}initializeScene(){Gi(this),this.physics.world.setBounds(0,0,this.config.worldWidth,this.config.worldHeight);const e=this.config.worldHeight-Lt;this.cameraController=new xr(this,this.config.worldWidth,this.config.worldHeight),this.playerController=new Er(this,this.config.worldWidth,this.config.worldHeight),this.gridOverlay=new Cr(this,this.config.worldWidth,this.config.worldHeight),this.itemsController=new Dr(this,e,this.config.worldWidth,this.config.worldHeight),this.framesController=new mi(this,this.config.worldWidth,this.config.worldHeight),this.socialsController=new vi(this,this.config.worldWidth,this.config.worldHeight),this.dialogZoneRenderer=new $r(this,this.config.worldWidth,this.config.worldHeight),this.createBackground(),this.gridOverlay.create(),this.createGroundReference(),this.playerController.create(this.config.playerStartX,this.config.playerStartY),this.itemsController.create(this.config.placedItems||[]),this.framesController.create(this.config.placedFrames||[]),this.socialsController.create(this.config.placedSocials||[]),this.dialogZoneRenderer.create(),this.cameraController.setup(),this.cameraController.centerOn(this.config.playerStartX,this.config.playerStartY),this.minimapSubscription=Fe.on($e.MINIMAP_NAVIGATE,t=>{this.navigateToPosition(t.worldX,t.worldY)}),this.scale.on("resize",this.handleResize,this),this.events.on("shutdown",this.shutdown,this)}async createBackground(){const e=qt.getCurrentConfig();try{await Ui(this,e)}catch(t){console.error("Failed to load background:",t);return}this.parallaxLayers&&(ua(this.parallaxLayers),this.parallaxLayers=null),this.parallaxLayers=Vi(this,this.config.worldWidth,this.config.worldHeight,e)}createGroundReference(){ss.createVisualGround(this,{worldWidth:this.config.worldWidth,worldHeight:this.config.worldHeight,height:Lt})}update(){this.parallaxLayers&&ji(this.parallaxLayers,this.cameras.main),this.itemManager?.updateSelectionVisuals(),this.framesController?.updateSelectionVisuals(),this.socialsController?.updateSelectionVisuals(),this.dialogZoneRenderer?.updateSelectionVisuals();const e=this.cameras.main,t=this.data.get("playerSprite");Fa({scrollX:e.worldView.x,scrollY:e.worldView.y,viewWidth:e.width,viewHeight:e.height,worldWidth:this.config.worldWidth,worldHeight:this.config.worldHeight,zoom:e.zoom,playerX:t?.x??this.config.playerStartX,playerY:t?.y??this.config.playerStartY})}navigateToPosition(e,t){this.cameraController.centerOn(e,t)}handleResize(e){!this.cameras?.main||!this.config||(this.cameraController?.handleResize(),this.gridOverlay&&this.gridOverlay.redraw())}shutdown(){this.isShuttingDown||(this.isShuttingDown=!0,this.scale.off("resize",this.handleResize,this),this.minimapSubscription&&this.minimapSubscription.unsubscribe(),this.cameraController&&this.cameraController.destroy(),this.playerController&&this.playerController.destroy(),this.gridOverlay&&this.gridOverlay.destroy(),this.itemsController&&this.itemsController.destroy(),this.framesController&&this.framesController.destroy(),this.socialsController&&this.socialsController.destroy(),this.dialogZoneRenderer&&this.dialogZoneRenderer.destroy())}}An();class Ar{currentLanguage="cs";setLanguage(e){this.currentLanguage=e,localStorage.setItem("language",e)}getLanguage(){const e=localStorage.getItem("language");return(e==="cs"||e==="en")&&(this.currentLanguage=e),this.currentLanguage}toggleLanguage(){return this.currentLanguage=this.currentLanguage==="cs"?"en":"cs",this.setLanguage(this.currentLanguage),this.currentLanguage}}const Sn=new Ar;let qe=null;function Lr(i){qe=i}function Or(){if(!qe)return console.error("Scene manager not initialized"),null;try{return qe.scene.getScene(Qe.GAME)?.mapConfig||null}catch(i){return console.error("Failed to get map config:",i),null}}function Hr(i){if(!qe)return console.error("Scene manager not initialized"),!1;try{return qe.scene.getScene(Qe.GAME)?(qe.scene.stop(Qe.GAME),Ha(i),qe.scene.start(Qe.BUILDER,{config:i}),!0):(console.error("GameScene not found"),!1)}catch(e){return console.error("Failed to switch to builder:",e),!1}}function Rr(){if(console.log("[SceneManager] switchToGame called"),!qe)return console.error("Scene manager not initialized"),!1;try{return console.log("[SceneManager] Stopping builder scene..."),qe.scene.stop(Qe.BUILDER),console.log("[SceneManager] Exiting builder mode..."),Ra(),console.log("[SceneManager] Starting game scene..."),qe.scene.start(Qe.GAME,{useBuilderConfig:!0}),console.log("[SceneManager] switchToGame completed successfully"),!0}catch(i){return console.error("Failed to switch to game:",i),!1}}function Xr(){if(!qe){console.error("Scene manager not initialized");return}try{qe.scene.start(Qe.GAME)}catch(i){console.error("Failed to start game scene:",i)}}var Fr=R('<button class="close-btn svelte-yrmttr" title="Close">×</button>'),Wr=R('<div class="resize-handle resize-handle-nw svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M9 9L1 1M5 1L1 1L1 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" fill="none"></path></svg></div>  <div class="resize-handle resize-handle-ne svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M1 9L9 1M5 1L9 1L9 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" fill="none"></path></svg></div>  <div class="resize-handle resize-handle-sw svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M9 1L1 9M1 5L1 9L5 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" fill="none"></path></svg></div>  <div class="resize-handle resize-handle-se svelte-yrmttr"><svg width="10" height="10" viewBox="0 0 10 10" class="svelte-yrmttr"><path d="M1 1L9 9M9 5L9 9L5 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" fill="none"></path></svg></div>',1),Zr=R("<div><!></div> <!>",1),Yr=R('<div data-ui=""><div class="panel-header svelte-yrmttr"><span class="panel-title svelte-yrmttr"> </span> <!> <div class="header-buttons svelte-yrmttr"><button class="minimize-btn svelte-yrmttr"> </button> <!></div></div> <!></div>');function Ht(i,e){we(e,!0);const t=()=>L(gt,"$isDraggingInBuilder",s),[s,n]=Ae();let r=1e3,o=me(e,"initialRight",3,10),l=me(e,"initialTop",3,60),c=me(e,"width",3,280),d=me(e,"minWidth",3,200),h=me(e,"minHeight",3,100),m=me(e,"maxWidth",3,600),x=me(e,"maxHeight",3,800),E=me(e,"resizable",3,!1),w=me(e,"startMinimized",3,!1),C=me(e,"showClose",3,!1),D=Q(nt(w())),p=Q(!1),v=Q(nt({x:0,y:0})),f=Q(nt({width:c(),height:e.height??0})),u=Q(!1),g=Q(!1),S=Q("se"),b=Q(nt({x:0,y:0})),I=Q(null),M=Q(!1),_=Q(nt(r)),P=Q(null),$=Q("");function A(){r++,O(_,r,!0)}function Y(H,B,se){let Pe=H;const Be=window.innerWidth-se-10;Pe>Be&&(Pe=Math.max(10,Be)),Pe<10&&(Pe=10);let He=B;const et=window.innerHeight-40;return He>et&&(He=Math.max(10,et)),He<10&&(He=10),{x:Pe,y:He}}Xe(()=>{if(typeof window>"u"||a(M))return;const H=localStorage.getItem(`panel-state-${e.panelId}`);if(H)try{const B=JSON.parse(H),se=E()&&B.width?B.width:c(),ue=Y(B.x,B.y,se);O(v,ue,!0),E()&&B.width&&B.height&&O(f,{width:B.width,height:B.height},!0);const pe=E()?{x:ue.x,y:ue.y,width:a(f).width,height:a(f).height}:{x:ue.x,y:ue.y};O($,JSON.stringify(pe),!0)}catch{O(v,{x:window.innerWidth-c()-o(),y:l()},!0)}else O(v,{x:window.innerWidth-c()-o(),y:l()},!0);O(M,!0)}),Xe(()=>{if(!a(M))return;const H=E()?{x:a(v).x,y:a(v).y,width:a(f).width,height:a(f).height}:{x:a(v).x,y:a(v).y},B=JSON.stringify(H);B!==a($)&&(O($,B,!0),localStorage.setItem(`panel-state-${e.panelId}`,B))}),Xe(()=>{if(!a(M))return;function H(){if(!a(I))return;const B=E()?a(f).width:c();let se=a(v).x,ue=a(v).y,pe=!1;const Pe=window.innerWidth-B;a(v).x>Pe&&(se=Math.max(10,Pe),pe=!0);const Be=window.innerHeight-40;a(v).y>Be&&(ue=Math.max(10,Be),pe=!0),a(v).x<0&&(se=10,pe=!0),a(v).y<0&&(ue=10,pe=!0),pe&&O(v,{x:se,y:ue},!0)}return window.addEventListener("resize",H),()=>{window.removeEventListener("resize",H)}});function F(){O(D,!a(D))}function X(){e.onclose?.()}function q(){if(E())if(a(p))a(P)&&(O(v,{x:a(P).x,y:a(P).y},!0),O(f,{width:a(P).width,height:a(P).height},!0),O(P,null)),O(p,!1);else{O(P,{x:a(v).x,y:a(v).y,width:a(f).width,height:a(f).height},!0);const H=20,B=Math.min(m(),window.innerWidth-H*2),se=Math.min(x(),window.innerHeight-H*2),ue=Math.max(H,(window.innerWidth-B)/2),pe=Math.max(H,(window.innerHeight-se)/2);O(v,{x:ue,y:pe},!0),O(f,{width:B,height:se},!0),O(p,!0)}}function ee(H){H.target.closest("button")||q()}function Ie(H){H.target.closest("button")||(O(u,!0),O(b,{x:H.clientX-a(v).x,y:H.clientY-a(v).y},!0),H.currentTarget.setPointerCapture(H.pointerId),H.preventDefault())}function ve(H){if(!a(u))return;const B=H.clientX-a(b).x,se=H.clientY-a(b).y,ue=window.innerWidth-(a(I)?.offsetWidth??c()),pe=window.innerHeight-40;O(v,{x:Math.max(0,Math.min(B,ue)),y:Math.max(0,Math.min(se,pe))},!0)}function Ce(H){a(u)&&(O(u,!1),H.currentTarget.releasePointerCapture(H.pointerId))}function Te(H){return B=>{E()&&(O(g,!0),O(S,H,!0),B.currentTarget.setPointerCapture(B.pointerId),B.preventDefault(),B.stopPropagation())}}function W(H){if(!a(g)||!a(I))return;const B=a(I).getBoundingClientRect();let se,ue,pe=a(v).x,Pe=a(v).y;const Be=a(S)==="se"||a(S)==="ne",He=a(S)==="se"||a(S)==="sw";Be?se=H.clientX-B.left:(se=B.right-H.clientX,pe=H.clientX),He?ue=H.clientY-B.top:(ue=B.bottom-H.clientY,Pe=H.clientY);const et=Math.max(d(),Math.min(m(),se)),V=Math.max(h(),Math.min(x(),ue));Be||(pe=B.right-et,pe<0&&(pe=0)),He||(Pe=B.bottom-V,Pe<0&&(Pe=0));const Se=Be?window.innerWidth-a(v).x-10:B.right-10,oe=He?window.innerHeight-a(v).y-10:B.bottom-10,ke=Math.min(et,Se),ge=Math.min(V,oe);O(f,{width:ke,height:ge},!0);let Re=!1,Ye=a(v).x,It=a(v).y;!Be&&se>=d()&&(Ye=Math.max(0,pe),Re=!0),!He&&ue>=h()&&(It=Math.max(0,Pe),Re=!0),Re&&O(v,{x:Ye,y:It},!0)}function J(H){a(g)&&(O(g,!1),H.currentTarget.releasePointerCapture(H.pointerId))}function xe(H){H.stopPropagation()}var ae=Yr();let De;ae.__pointerdown=H=>{A(),xe(H)},ae.__click=xe;var fe=k(ae);fe.__pointerdown=Ie,fe.__pointermove=ve,fe.__pointerup=Ce,fe.__dblclick=ee;var re=k(fe),de=k(re),te=T(re,2);{var he=H=>{var B=Me(),se=le(B);Kt(se,()=>e.headerExtra),y(H,B)};G(te,H=>{e.headerExtra&&H(he)})}var ye=T(te,2),Oe=k(ye);Oe.__click=F;var Ue=k(Oe),Ke=T(Oe,2);{var ft=H=>{var B=Fr();B.__click=X,y(H,B)};G(Ke,H=>{C()&&H(ft)})}var Rt=T(fe,2);{var ct=H=>{var B=Zr(),se=le(B);let ue;var pe=k(se);Kt(pe,()=>e.children);var Pe=T(se,2);{var Be=He=>{var et=Wr(),V=le(et),Se=Z(()=>Te("nw"));V.__pointerdown=function(...pt){a(Se)?.apply(this,pt)},V.__pointermove=W,V.__pointerup=J;var oe=T(V,2),ke=Z(()=>Te("ne"));oe.__pointerdown=function(...pt){a(ke)?.apply(this,pt)},oe.__pointermove=W,oe.__pointerup=J;var ge=T(oe,2),Re=Z(()=>Te("sw"));ge.__pointerdown=function(...pt){a(Re)?.apply(this,pt)},ge.__pointermove=W,ge.__pointerup=J;var Ye=T(ge,2),It=Z(()=>Te("se"));Ye.__pointerdown=function(...pt){a(It)?.apply(this,pt)},Ye.__pointermove=W,Ye.__pointerup=J,Ve("pointercancel",V,J),Ve("pointercancel",oe,J),Ve("pointercancel",ge,J),Ve("pointercancel",Ye,J),y(He,et)};G(Pe,He=>{E()&&He(Be)})}z(()=>ue=Ee(se,1,"panel-body svelte-yrmttr",null,ue,{"has-fixed-height":E()&&a(f).height>0})),y(H,B)};G(Rt,H=>{a(D)||H(ct)})}ut(ae,H=>O(I,H),()=>a(I)),z(()=>{De=Ee(ae,1,"draggable-panel svelte-yrmttr",null,De,{minimized:a(D),maximized:a(p),dragging:a(u),resizing:a(g),resizable:E()}),ce(ae,`left: ${a(v).x??""}px; top: ${a(v).y??""}px; width: ${a(D)?"auto":`${E()?a(f).width:c()}px`}; ${E()&&a(f).height>0&&!a(D)?`height: ${a(f).height}px;`:""}${t()?" pointer-events: none;":""} z-index: ${a(_)??""};`),be(de,e.title),U(Oe,"title",a(D)?"Expand":"Minimize"),be(Ue,a(D)?"▲":"▼")}),Ve("pointercancel",fe,Ce),y(i,ae),_e(),n()}at(["pointerdown","click","pointermove","pointerup","dblclick"]);const Ii=10,Br=150,Nr=`
  position: fixed;
  pointer-events: none;
  z-index: 10000;
  opacity: 0.9;
  image-rendering: pixelated;
  filter: drop-shadow(3px 3px 0 rgba(0, 0, 0, 0.5));
  background: rgba(26, 26, 46, 0.9);
`,zr=`
  width: 100%;
  height: 100%;
  object-fit: contain;
  image-rendering: pixelated;
`;function ti(i,e,t){const{previewSize:s,borderColor:n,dataKey:r,eventName:o,onDrop:l}=i,c=s/2,d={startX:0,startY:0,hasMoved:!1,isActivated:!1,pendingKey:null,pendingTarget:null,longPressTimer:null};function h(_,P,$){Fe.emit(o,{[r]:_,canvasX:P,canvasY:$}),l?.()}function m(_,P){const $=document.querySelector("canvas");if(!$)return null;const A=$.getBoundingClientRect();return _>=A.left&&_<=A.right&&P>=A.top&&P<=A.bottom?{canvasX:_-A.left,canvasY:P-A.top}:null}function x(_,P,$){const A=document.createElement("div");return A.className="touch-drag-preview",A.innerHTML=`<img src="${_}" alt="" />`,A.style.cssText=`
      ${Nr}
      top: ${$-c}px;
      left: ${P-c}px;
      width: ${s}px;
      height: ${s}px;
      border: 2px solid ${n};
    `,A.querySelector("img").style.cssText=zr,document.body.appendChild(A),A}function E(_,P,$){_.style.top=`${$-c}px`,_.style.left=`${P-c}px`}function w(){d.longPressTimer&&(clearTimeout(d.longPressTimer),d.longPressTimer=null),d.pendingKey=null,d.pendingTarget=null,d.isActivated=!1,d.hasMoved=!1}function C(){w();const _=e();_.touchDragElement&&(_.touchDragElement.remove(),t({touchDragElement:null})),t({draggedKey:null}),is(!1)}function D(_,P){if(!_.dataTransfer)return;t({draggedKey:P}),is(!0),_.dataTransfer.effectAllowed="copy",_.dataTransfer.setData(r,P);const A=_.target.querySelector("img")?.cloneNode(!0);A&&(A.style.cssText="position: absolute; top: -1000px;",document.body.appendChild(A),_.dataTransfer.setDragImage(A,c,c),requestAnimationFrame(()=>A.remove()))}function p(){t({draggedKey:null}),is(!1)}function v(_){_.preventDefault(),_.dataTransfer&&(_.dataTransfer.dropEffect="copy")}function f(_){_.preventDefault();const P=_.dataTransfer?.getData(r);if(!P)return;const $=m(_.clientX,_.clientY);$&&h(P,$.canvasX,$.canvasY)}function u(_,P){if(!d.pendingKey||!d.pendingTarget||d.isActivated)return;d.isActivated=!0,t({draggedKey:d.pendingKey}),is(!0);const $=d.pendingTarget.querySelector("img");if($){const A=x($.src,_,P);t({touchDragElement:A})}}function g(_,P){if(_.touches.length!==1)return;const $=_.touches[0];d.startX=$.clientX,d.startY=$.clientY,d.hasMoved=!1,d.isActivated=!1,d.pendingKey=P,d.pendingTarget=_.currentTarget,d.longPressTimer=setTimeout(()=>{d.pendingKey&&!d.hasMoved&&u($.clientX,$.clientY)},Br)}function S(_){const P=_.touches[0],$=P.clientX-d.startX,A=P.clientY-d.startY;if(!d.hasMoved&&(Math.abs($)>Ii||Math.abs(A)>Ii)&&(d.hasMoved=!0,!d.isActivated)){if(Math.abs(A)>Math.abs($)){w();return}u(P.clientX,P.clientY)}const Y=e();d.isActivated&&Y.touchDragElement&&(E(Y.touchDragElement,P.clientX,P.clientY),_.preventDefault())}function b(_){const P=e(),$=d.isActivated,A=P.draggedKey;if($&&A&&d.hasMoved){const Y=_.changedTouches[0],F=m(Y.clientX,Y.clientY);F&&h(A,F.canvasX,F.canvasY)}C()}function I(){const _=document.querySelector("canvas");return _?(_.addEventListener("dragover",v),_.addEventListener("drop",f),()=>{_.removeEventListener("dragover",v),_.removeEventListener("drop",f)}):()=>{}}function M(){return document.addEventListener("touchmove",S,{passive:!1}),document.addEventListener("touchend",b),document.addEventListener("touchcancel",b),()=>{document.removeEventListener("touchmove",S),document.removeEventListener("touchend",b),document.removeEventListener("touchcancel",b)}}return{onDragStart:D,onDragEnd:p,onTouchStart:g,setupCanvasListeners:I,setupTouchListeners:M}}var Kr=R('<span class="palette-hint svelte-ntcafk">Drag to place</span>'),Gr=R('<div data-ui="" draggable="true" role="button" tabindex="0"><img class="item-preview svelte-ntcafk"/></div>'),Ur=R('<div class="palette-content svelte-ntcafk" role="toolbar" tabindex="-1"><div class="palette-grid svelte-ntcafk"></div></div>');function Vr(i,e){we(e,!0);const t=()=>L(_t,"$isItemPaletteOpen",n),s=()=>L(Ze,"$builderEditMode",n),[n,r]=Ae(),o="#4a90e2",l=600,c=Qs;function d(){return window.innerWidth<l}function h(){d()&&_t.set(!1)}let m=Q(null),x=Q(null);const E=ti({previewSize:48,borderColor:o,dataKey:"assetKey",eventName:$e.ASSET_DROPPED,onDrop:h},()=>({draggedKey:a(m),touchDragElement:a(x)}),u=>{"draggedKey"in u&&O(m,u.draggedKey??null,!0),"touchDragElement"in u&&O(x,u.touchDragElement??null,!0)});function w(u){u.stopPropagation()}function C(){_t.set(!1)}function D(u){const g=document.querySelector("canvas");if(!g)return;const S=g.getBoundingClientRect(),b=S.width/2,I=S.height/2;Fe.emit($e.ASSET_DROPPED,{assetKey:u,canvasX:b,canvasY:I}),h()}ms(()=>E.setupCanvasListeners()),Xe(()=>E.setupTouchListeners());var p=Me(),v=le(p);{var f=u=>{Ht(u,{panelId:"item-palette",title:"Items",initialRight:10,initialTop:60,width:280,height:400,minWidth:200,minHeight:160,maxWidth:500,maxHeight:600,resizable:!0,showClose:!0,onclose:C,headerExtra:S=>{var b=Kr();y(S,b)},children:(S,b)=>{var I=Ur();I.__pointerdown=w;var M=k(I);ze(M,21,()=>c,Ge,(_,P)=>{var $=Gr();let A;$.__touchstart=F=>E.onTouchStart(F,a(P).key),$.__dblclick=()=>D(a(P).key),ce($,"",{},{"--accent-color":o});var Y=k($);z(()=>{A=Ee($,1,"palette-item svelte-ntcafk",null,A,{dragging:a(m)===a(P).key}),U($,"title",`${a(P).name??""} (double-click to place)`),U(Y,"src",a(P).path),U(Y,"alt",a(P).name)}),Ve("dragstart",$,F=>E.onDragStart(F,a(P).key)),Ve("dragend",$,function(...F){E.onDragEnd?.apply(this,F)}),y(_,$)}),y(S,I)},$$slots:{headerExtra:!0,default:!0}})};G(v,u=>{t()&&s()==="items"&&u(f)})}y(i,p),_e(),r()}at(["pointerdown","touchstart","dblclick"]);var jr=R('<span class="palette-hint svelte-jnw59q">Drag to place</span>'),qr=R('<div data-ui="" draggable="true" role="button" tabindex="0"><img class="item-preview svelte-jnw59q"/></div>'),Jr=R('<div class="palette-content svelte-jnw59q" role="toolbar" tabindex="-1"><div class="palette-grid svelte-jnw59q"></div></div>');function Qr(i,e){we(e,!0);const t=()=>L(St,"$isFramePaletteOpen",n),s=()=>L(Ze,"$builderEditMode",n),[n,r]=Ae(),o="#9b59b6",l=fs;let c=Q(null),d=Q(null);const h=ti({previewSize:64,borderColor:o,dataKey:"frameKey",eventName:$e.FRAME_DROPPED,onDrop:()=>{St.set(!1)}},()=>({draggedKey:a(c),touchDragElement:a(d)}),p=>{"draggedKey"in p&&O(c,p.draggedKey??null,!0),"touchDragElement"in p&&O(d,p.touchDragElement??null,!0)});function m(p){p.stopPropagation()}function x(){St.set(!1)}function E(p){const v=document.querySelector("canvas");if(!v)return;const f=v.getBoundingClientRect(),u=f.width/2,g=f.height/2;Fe.emit($e.FRAME_DROPPED,{frameKey:p,canvasX:u,canvasY:g}),St.set(!1)}ms(()=>h.setupCanvasListeners()),Xe(()=>h.setupTouchListeners());var w=Me(),C=le(w);{var D=p=>{Ht(p,{panelId:"frame-palette",title:"Frames",initialRight:10,initialTop:60,width:320,height:400,minWidth:220,minHeight:200,maxWidth:600,maxHeight:600,resizable:!0,showClose:!0,onclose:x,headerExtra:f=>{var u=jr();y(f,u)},children:(f,u)=>{var g=Jr();g.__pointerdown=m;var S=k(g);ze(S,21,()=>l,Ge,(b,I)=>{var M=qr();let _;M.__touchstart=$=>h.onTouchStart($,a(I).key),M.__dblclick=()=>E(a(I).key),ce(M,"",{},{"--accent-color":o});var P=k(M);z(()=>{_=Ee(M,1,"palette-item svelte-jnw59q",null,_,{dragging:a(c)===a(I).key}),U(M,"title",`${a(I).name??""} (double-click to place)`),U(P,"src",a(I).path),U(P,"alt",a(I).name)}),Ve("dragstart",M,$=>h.onDragStart($,a(I).key)),Ve("dragend",M,function(...$){h.onDragEnd?.apply(this,$)}),y(b,M)}),y(f,g)},$$slots:{headerExtra:!0,default:!0}})};G(C,p=>{t()&&s()==="frames"&&p(D)})}y(i,w),_e(),r()}at(["pointerdown","touchstart","dblclick"]);var eo=R('<span class="palette-hint svelte-whpd9j">Drag to place</span>'),to=R('<div data-ui="" draggable="true" role="button" tabindex="0"><img class="item-preview svelte-whpd9j"/> <span class="item-name svelte-whpd9j"> </span></div>'),so=R('<div class="palette-content svelte-whpd9j" role="toolbar" tabindex="-1"><div class="palette-grid svelte-whpd9j"></div></div>');function io(i,e){we(e,!0);const t=()=>L(bt,"$isSocialPaletteOpen",n),s=()=>L(Ze,"$builderEditMode",n),[n,r]=Ae(),o=Ot.SOCIAL.css,l=ps;let c=Q(null),d=Q(null);const h=ti({previewSize:64,borderColor:o,dataKey:"socialKey",eventName:$e.SOCIAL_DROPPED,onDrop:()=>{bt.set(!1)}},()=>({draggedKey:a(c),touchDragElement:a(d)}),p=>{"draggedKey"in p&&O(c,p.draggedKey??null,!0),"touchDragElement"in p&&O(d,p.touchDragElement??null,!0)});function m(p){p.stopPropagation()}function x(){bt.set(!1)}function E(p){const v=document.querySelector("canvas");if(!v)return;const f=v.getBoundingClientRect(),u=f.width/2,g=f.height/2;Fe.emit($e.SOCIAL_DROPPED,{socialKey:p,canvasX:u,canvasY:g}),bt.set(!1)}ms(()=>h.setupCanvasListeners()),Xe(()=>h.setupTouchListeners());var w=Me(),C=le(w);{var D=p=>{Ht(p,{panelId:"social-palette",title:"Socials",initialRight:10,initialTop:60,width:280,height:350,minWidth:200,minHeight:200,maxWidth:500,maxHeight:500,resizable:!0,showClose:!0,onclose:x,headerExtra:f=>{var u=eo();y(f,u)},children:(f,u)=>{var g=so();g.__pointerdown=m;var S=k(g);ze(S,21,()=>l,Ge,(b,I)=>{var M=to();let _;M.__touchstart=F=>h.onTouchStart(F,a(I).key),M.__dblclick=()=>E(a(I).key);let P;var $=k(M),A=T($,2),Y=k(A);z(()=>{_=Ee(M,1,"palette-item svelte-whpd9j",null,_,{dragging:a(c)===a(I).key}),U(M,"title",`${a(I).name??""} (double-click to place)`),P=ce(M,"",P,{"--accent-color":o}),U($,"src",a(I).path),U($,"alt",a(I).name),be(Y,a(I).name)}),Ve("dragstart",M,F=>h.onDragStart(F,a(I).key)),Ve("dragend",M,function(...F){h.onDragEnd?.apply(this,F)}),y(b,M)}),y(f,g)},$$slots:{headerExtra:!0,default:!0}})};G(C,p=>{t()&&s()==="socials"&&p(D)})}y(i,w),_e(),r()}at(["pointerdown","touchstart","dblclick"]);var no=R("<button> </button>"),ao=R('<div class="language-tabs svelte-ng6pis"></div>');function bn(i,e){we(e,!0);let t=me(e,"accentColor",3,"#88ddff");var s=ao();ze(s,21,()=>ga,Ge,(n,r)=>{var o=no();let l;o.__click=()=>e.onselect(a(r).code);let c;var d=k(o);z(()=>{l=Ee(o,1,"lang-tab svelte-ng6pis",null,l,{active:e.selectedLanguage===a(r).code}),c=ce(o,"",c,{"--accent-color":t()}),be(d,a(r).label)}),y(n,o)}),y(i,s),_e()}at(["click"]);var ro=R("<button></button>"),oo=R('<div class="color-picker svelte-1jc3e0j"></div>'),lo=R('<div class="color-section svelte-1jc3e0j"><span class="color-label-title svelte-1jc3e0j"> </span> <button class="color-button svelte-1jc3e0j" title="Change color"><span class="color-preview svelte-1jc3e0j"></span> <span class="color-label svelte-1jc3e0j">Change</span></button> <!></div>');function Ws(i,e){we(e,!0);let t=me(e,"label",3,"Color"),s=me(e,"accentColor",3,"#88ddff"),n=Q(!1),r=Q(null);Xe(()=>{a(n)&&a(r)&&requestAnimationFrame(()=>{a(r)?.scrollIntoView({behavior:"smooth",block:"nearest"})})});function o(p){e.onselect(p)}function l(){O(n,!a(n))}var c=lo(),d=k(c),h=k(d),m=T(d,2);m.__click=l;let x;var E=k(m);let w;var C=T(m,2);{var D=p=>{var v=oo();ze(v,21,()=>e.colors,Ge,(f,u)=>{var g=ro();let S;g.__click=()=>o(a(u));let b;z(()=>{S=Ee(g,1,"color-swatch svelte-1jc3e0j",null,S,{selected:e.selectedColor===a(u)}),U(g,"title",a(u)),b=ce(g,"",b,{background:a(u),"--accent-color":s()})}),y(f,g)}),ut(v,f=>O(r,f),()=>a(r)),y(p,v)};G(C,p=>{a(n)&&p(D)})}z(()=>{be(h,t()),x=ce(m,"",x,{"--accent-color":s()}),w=ce(E,"",w,{background:e.selectedColor})}),y(i,c),_e()}at(["click"]);const Ei=50,Ci=400,co=400,ho=70;var uo=R('<div class="form-section svelte-jhtkop"><div class="form-group svelte-jhtkop"><label class="svelte-jhtkop"> </label> <input type="text" class="svelte-jhtkop"/></div> <div class="form-group svelte-jhtkop"><label class="svelte-jhtkop"> </label> <textarea rows="6" class="svelte-jhtkop"></textarea></div></div>');function go(i,e){we(e,!0);let t=me(e,"titlePlaceholder",3,"Enter title..."),s=me(e,"contentPlaceholder",3,"Enter text..."),n=me(e,"idPrefix",3,"text-form"),r=me(e,"accentColor",3,"#88ddff");function o(v){const f=v.target;e.ontitlechange(f.value)}function l(v){const f=v.target;e.oncontentchange(f.value)}var c=uo();let d;var h=k(c),m=k(h),x=k(m),E=T(m,2);E.__input=o;var w=T(h,2),C=k(w),D=k(C),p=T(C,2);p.__input=l,z(()=>{d=ce(c,"",d,{"--accent-color":r()}),U(m,"for",`${n()??""}-title`),be(x,`Title (max ${Ei} chars)`),U(E,"id",`${n()??""}-title`),Gt(E,e.title),U(E,"placeholder",t()),U(E,"maxlength",Ei),U(C,"for",`${n()??""}-content`),be(D,`Content (max ${Ci} chars)`),U(p,"id",`${n()??""}-content`),Gt(p,e.content),U(p,"placeholder",s()),U(p,"maxlength",Ci)}),y(i,c),_e()}at(["input"]);var fo=R('<div class="panel-content svelte-zzlycq"><!> <!> <div class="panel-extras svelte-zzlycq"><!></div> <div class="panel-footer svelte-zzlycq"><!> <!></div></div>');function po(i,e){we(e,!0);const t=()=>L(Ns,"$dialogZones",r),s=()=>L(bs,"$selectedDialogZoneId",r),n=()=>L(Ks,"$isDialogZonePanelOpen",r),[r,o]=Ae(),l="#88ddff";let c=Q(nt(qi)),d=Z(()=>t().find(u=>u.id===s())??null),h=Z(()=>a(d)?.texts.find(u=>u.language===a(c))??null);function m(u){s()&&oi(s(),a(c),{title:u})}function x(u){s()&&oi(s(),a(c),{content:u})}function E(){s()&&(hn(s()),ai())}function w(){ai()}function C(u){s()&&Dt(s(),{color:u})}function D(u){O(c,u,!0)}var p=Me(),v=le(p);{var f=u=>{Ht(u,{panelId:"dialog-zone-panel",title:"Dialog Zone",initialRight:10,initialTop:160,width:280,height:450,minWidth:250,minHeight:370,maxWidth:500,maxHeight:700,resizable:!0,showClose:!0,onclose:w,children:(g,S)=>{var b=fo(),I=k(b);bn(I,{get selectedLanguage(){return a(c)},onselect:D,accentColor:l});var M=T(I,2);{let F=Z(()=>a(h)?.title??""),X=Z(()=>a(h)?.content??"");go(M,{get title(){return a(F)},get content(){return a(X)},ontitlechange:m,oncontentchange:x,titlePlaceholder:"Enter title...",contentPlaceholder:"Enter dialog text...",idPrefix:"dialog",accentColor:l})}var _=T(M,2),P=k(_);Ws(P,{get colors(){return Hs},get selectedColor(){return a(d).color},onselect:C,label:"Zone Color",accentColor:l});var $=T(_,2),A=k($);ie(A,{variant:"cyan",onclick:w,children:(F,X)=>{var q=ne("CONFIRM");y(F,q)},$$slots:{default:!0}});var Y=T(A,2);ie(Y,{variant:"red",onclick:E,children:(F,X)=>{var q=ne("DELETE");y(F,q)},$$slots:{default:!0}}),y(g,b)},$$slots:{default:!0}})};G(v,u=>{a(d)&&n()&&u(f)})}y(i,p),_e(),o()}var mo=R("<button> </button>"),vo=R("<option> </option>"),yo=R("<button> </button>"),So=R('<a target="_blank" rel="noopener noreferrer" class="url-preview svelte-ds1z4d">Test link ↗</a>'),bo=R('<button><img class="svelte-ds1z4d"/></button>'),wo=R('<div class="style-picker svelte-ds1z4d"></div>'),_o=R('<div class="panel-content svelte-ds1z4d"><!> <div class="frame-size-row svelte-ds1z4d"><div class="frame-size-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Frame Size</span> <div class="size-buttons svelte-ds1z4d"></div></div> <div class="rotate-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Rotate</span> <button class="rotate-btn svelte-ds1z4d"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-ds1z4d"><path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg></button></div></div> <div class="panel-extras svelte-ds1z4d"><div class="text-section svelte-ds1z4d"><label for="frame-text" class="svelte-ds1z4d">Text</label> <textarea id="frame-text" placeholder="Enter text..." rows="3" class="svelte-ds1z4d"></textarea></div> <div class="size-rotation-row svelte-ds1z4d"><div class="size-section svelte-ds1z4d"><label for="text-size" class="svelte-ds1z4d">Text Size</label> <select id="text-size" class="svelte-ds1z4d"></select></div></div> <div class="text-align-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Text Alignment</span> <div class="align-buttons svelte-ds1z4d"></div></div> <div class="url-section svelte-ds1z4d"><label for="frame-url" class="svelte-ds1z4d">Link URL (opens on click)</label> <input id="frame-url" type="url" placeholder="https://example.com" class="svelte-ds1z4d"/> <!></div> <!> <!> <div class="style-section svelte-ds1z4d"><span class="section-label svelte-ds1z4d">Frame Style</span> <button class="style-button svelte-ds1z4d" title="Change frame style"><img alt="Current frame" class="style-preview svelte-ds1z4d"/> <span class="style-label svelte-ds1z4d">Change Style</span></button> <!></div></div> <div class="panel-footer svelte-ds1z4d"><!> <!></div></div>');function xo(i,e){we(e,!0);const t=()=>L(Bs,"$builderPreviewLanguage",o),s=()=>L(Ta,"$selectedFrame",o),n=()=>L(Jt,"$selectedFrameId",o),r=()=>L(vs,"$isFramePanelOpen",o),[o,l]=Ae(),c="#9b59b6";let d=Z(t),h=Z(s),m=Z(()=>a(h)?.texts.find(X=>X.language===a(d))??null),x=Z(()=>a(h)?ur(a(h).scale??4):"M");function E(X){const q=X.target;if(!n()||!a(h))return;const ee=a(h).texts.map(Ie=>Ie.language===a(d)?{...Ie,text:q.value}:Ie);ee.some(Ie=>Ie.language===a(d))||ee.push({language:a(d),text:q.value}),it(n(),{texts:ee})}function w(X){const q=X.target;n()&&it(n(),{url:q.value||void 0})}function C(X){n()&&it(n(),{backgroundColor:X})}function D(X){n()&&it(n(),{textColor:X})}function p(X){const q=X.target;n()&&it(n(),{textSize:parseInt(q.value,10)})}function v(X){n()&&it(n(),{scale:hr(X)})}function f(X){n()&&it(n(),{textAlign:X})}function u(){if(!n()||!a(h))return;const q=(a(h).rotation??0)===0?90:0;it(n(),{rotation:q})}function g(){n()&&qs(n())}function S(){Sa(),Yt(null)}function b(X){_a(X)}let I=Q(!1),M=Q(null),_=Q(null);function P(X){n()&&it(n(),{frameKey:X})}function $(){O(I,!a(I))}Xe(()=>{a(I)&&a(M)&&requestAnimationFrame(()=>{a(M)?.scrollIntoView({behavior:"smooth",block:"nearest"})})}),Xe(()=>{if(!a(I))return;function X(q){const ee=q.target;a(M)&&!a(M).contains(ee)&&a(_)&&!a(_).contains(ee)&&O(I,!1)}return document.addEventListener("click",X),()=>document.removeEventListener("click",X)});var A=Me(),Y=le(A);{var F=X=>{Ht(X,{panelId:"frame-panel",title:"Edit Frame",initialRight:10,initialTop:160,width:280,height:520,minWidth:250,minHeight:450,maxWidth:500,maxHeight:700,resizable:!0,showClose:!0,onclose:S,children:(q,ee)=>{var Ie=_o(),ve=k(Ie);bn(ve,{get selectedLanguage(){return a(d)},onselect:b,accentColor:c});var Ce=T(ve,2),Te=k(Ce),W=T(k(Te),2);ze(W,21,()=>Object.entries(mn),Ge,(V,Se)=>{var oe=Z(()=>Pi(a(Se),2));let ke=()=>a(oe)[0],ge=()=>a(oe)[1].label;var Re=mo();let Ye;Re.__click=()=>v(ke());var It=k(Re);z(()=>{Ye=Ee(Re,1,"size-btn svelte-ds1z4d",null,Ye,{active:a(x)===ke()}),U(Re,"title",ge()),be(It,ke())}),y(V,Re)});var J=T(Te,2),xe=T(k(J),2);xe.__click=u;var ae=T(Ce,2),De=k(ae),fe=T(k(De),2);fe.__input=E;var re=T(De,2),de=k(re),te=T(k(de),2);te.__change=p,ze(te,21,()=>cr,Ge,(V,Se)=>{var oe=vo(),ke=k(oe),ge={};z(()=>{be(ke,`${a(Se)??""}px`),ge!==(ge=a(Se))&&(oe.value=(oe.__value=a(Se))??"")}),y(V,oe)});var he;Fn(te);var ye=T(re,2),Oe=T(k(ye),2);ze(Oe,21,()=>dr,Ge,(V,Se)=>{let oe=()=>a(Se).value,ke=()=>a(Se).label;var ge=yo();let Re;ge.__click=()=>f(oe());var Ye=k(ge);z(()=>{Re=Ee(ge,1,"align-btn svelte-ds1z4d",null,Re,{active:(a(h).textAlign??yn)===oe()}),U(ge,"title",ke()),be(Ye,ke())}),y(V,ge)});var Ue=T(ye,2),Ke=T(k(Ue),2);Ke.__input=w;var ft=T(Ke,2);{var Rt=V=>{var Se=So();z(()=>U(Se,"href",a(h).url)),y(V,Se)};G(ft,V=>{a(h).url&&V(Rt)})}var ct=T(Ue,2);{let V=Z(()=>a(h).textColor??vn);Ws(ct,{get colors(){return lr},get selectedColor(){return a(V)},onselect:D,label:"Text Color",accentColor:c})}var H=T(ct,2);Ws(H,{get colors(){return or},get selectedColor(){return a(h).backgroundColor},onselect:C,label:"Background Color",accentColor:c});var B=T(H,2),se=T(k(B),2);se.__click=$;var ue=k(se);ut(se,V=>O(_,V),()=>a(_));var pe=T(se,2);{var Pe=V=>{var Se=wo();ze(Se,21,()=>fs,Ge,(oe,ke)=>{var ge=bo();let Re;ge.__click=()=>P(a(ke).key);var Ye=k(ge);z(()=>{Re=Ee(ge,1,"style-item svelte-ds1z4d",null,Re,{selected:a(h).frameKey===a(ke).key}),U(ge,"title",a(ke).name),U(Ye,"src",a(ke).path),U(Ye,"alt",a(ke).name)}),y(oe,ge)}),ut(Se,oe=>O(M,oe),()=>a(M)),y(V,Se)};G(pe,V=>{a(I)&&V(Pe)})}var Be=T(ae,2),He=k(Be);ie(He,{variant:"purple",onclick:S,children:(V,Se)=>{var oe=ne("CONFIRM");y(V,oe)},$$slots:{default:!0}});var et=T(He,2);ie(et,{variant:"red",onclick:g,children:(V,Se)=>{var oe=ne("DELETE");y(V,oe)},$$slots:{default:!0}}),z(V=>{U(xe,"title",a(h).rotation===90?"Portrait (click to rotate)":"Landscape (click to rotate)"),Gt(fe,a(m)?.text??""),he!==(he=a(h).textSize??cs)&&(te.value=(te.__value=a(h).textSize??cs)??"",Ai(te,a(h).textSize??cs)),Gt(Ke,a(h).url??""),U(ue,"src",V)},[()=>fs.find(V=>V.key===a(h).frameKey)?.path??""]),y(q,Ie)},$$slots:{default:!0}})};G(Y,X=>{r()&&a(h)&&X(F)})}y(i,A),_e(),l()}at(["click","input","change"]);var Io=R("<button> </button>"),Eo=R('<a target="_blank" rel="noopener noreferrer" class="url-preview svelte-1v3ae2c">Test link ↗</a>'),Co=R('<button><img class="svelte-1v3ae2c"/></button>'),To=R('<div class="style-picker svelte-1v3ae2c"></div>'),Do=R('<div class="panel-content svelte-1v3ae2c"><div class="social-size-row svelte-1v3ae2c"><div class="social-size-section svelte-1v3ae2c"><span class="section-label svelte-1v3ae2c">Size</span> <div class="size-buttons svelte-1v3ae2c"></div></div></div> <div class="panel-extras svelte-1v3ae2c"><div class="url-section svelte-1v3ae2c"><label for="social-url" class="svelte-1v3ae2c">Link URL (opens on click)</label> <input id="social-url" type="url" placeholder="https://example.com" class="svelte-1v3ae2c"/> <!></div> <div class="style-section svelte-1v3ae2c"><span class="section-label svelte-1v3ae2c">Social Icon</span> <button class="style-button svelte-1v3ae2c" title="Change social icon"><img alt="Current social" class="style-preview svelte-1v3ae2c"/> <span class="style-label svelte-1v3ae2c"> </span></button> <!></div></div> <div class="panel-footer svelte-1v3ae2c"><!> <!></div></div>');function Po(i,e){we(e,!0);const t=()=>L(Ia,"$selectedSocial",r),s=()=>L(Qt,"$selectedSocialId",r),n=()=>L(ys,"$isSocialPanelOpen",r),[r,o]=Ae(),l=Ot.SOCIAL.css;let c=Z(t),d=Z(()=>a(c)?br(a(c).scale??At):"M"),h=Z(()=>a(c)?ps.find(b=>b.key===a(c).socialKey):null);function m(b){const I=b.target;s()&&ls(s(),{url:I.value||void 0})}function x(b){s()&&ls(s(),{scale:Sr(b)})}function E(){s()&&Js(s())}function w(){wa(),Bt(null)}let C=Q(!1),D=Q(null),p=Q(null);function v(b){s()&&ls(s(),{socialKey:b})}function f(){O(C,!a(C))}Xe(()=>{a(C)&&a(D)&&requestAnimationFrame(()=>{a(D)?.scrollIntoView({behavior:"smooth",block:"nearest"})})}),Xe(()=>{if(!a(C))return;function b(I){const M=I.target;a(D)&&!a(D).contains(M)&&a(p)&&!a(p).contains(M)&&O(C,!1)}return document.addEventListener("click",b),()=>document.removeEventListener("click",b)});var u=Me(),g=le(u);{var S=b=>{Ht(b,{panelId:"social-panel",title:"Edit Social",initialRight:10,initialTop:160,width:280,height:350,minWidth:250,minHeight:300,maxWidth:400,maxHeight:500,resizable:!0,showClose:!0,onclose:w,children:(I,M)=>{var _=Do(),P=k(_),$=k(P),A=T(k($),2);ze(A,21,()=>Object.entries(ts),Ge,(re,de)=>{var te=Z(()=>Pi(a(de),2));let he=()=>a(te)[0],ye=()=>a(te)[1].label;var Oe=Io();let Ue;Oe.__click=()=>x(he());var Ke=k(Oe);z(()=>{Ue=Ee(Oe,1,"size-btn svelte-1v3ae2c",null,Ue,{active:a(d)===he()}),U(Oe,"title",ye()),be(Ke,he())}),y(re,Oe)});var Y=T(P,2),F=k(Y),X=T(k(F),2);X.__input=m;var q=T(X,2);{var ee=re=>{var de=Eo();z(()=>U(de,"href",a(c).url)),y(re,de)};G(q,re=>{a(c).url&&re(ee)})}var Ie=T(F,2),ve=T(k(Ie),2);ve.__click=f;var Ce=k(ve),Te=T(Ce,2),W=k(Te);ut(ve,re=>O(p,re),()=>a(p));var J=T(ve,2);{var xe=re=>{var de=To();ze(de,21,()=>ps,Ge,(te,he)=>{var ye=Co();let Oe;ye.__click=()=>v(a(he).key);var Ue=k(ye);z(()=>{Oe=Ee(ye,1,"style-item svelte-1v3ae2c",null,Oe,{selected:a(c).socialKey===a(he).key}),U(ye,"title",a(he).name),U(Ue,"src",a(he).path),U(Ue,"alt",a(he).name)}),y(te,ye)}),ut(de,te=>O(D,te),()=>a(D)),y(re,de)};G(J,re=>{a(C)&&re(xe)})}var ae=T(Y,2),De=k(ae);ie(De,{variant:"pink",onclick:w,children:(re,de)=>{var te=ne("CONFIRM");y(re,te)},$$slots:{default:!0}});var fe=T(De,2);ie(fe,{variant:"red",onclick:E,children:(re,de)=>{var te=ne("DELETE");y(re,te)},$$slots:{default:!0}}),z(()=>{ce(_,`--accent-color: ${l}`),Gt(X,a(c).url??""),U(Ce,"src",a(h)?.path??""),be(W,a(h)?.name??"Select")}),y(I,_)},$$slots:{default:!0}})};G(g,b=>{n()&&a(c)&&b(S)})}y(i,u),_e(),o()}at(["click","input"]);var ko=R("<div> </div>"),$o=R('<div class="frame-content-layer svelte-1vp2oo0"></div>');function wn(i,e){we(e,!0);const t=()=>L(sn,"$placedFrames",d),s=()=>L(Ji,"$isBuilderMode",d),n=()=>L(js,"$builderCameraInfo",d),r=()=>L(Zi,"$gameCameraInfo",d),o=()=>L(Bs,"$builderPreviewLanguage",d),l=()=>L(Vt,"$currentLanguage",d),c=()=>L(zs,"$draggingFramePositions",d),[d,h]=Ae();let m=Z(t),x=Z(()=>s()?n().scrollX:r().scrollX),E=Z(()=>s()?n().scrollY:r().scrollY),w=Z(()=>s()?n().zoom:r().zoom),C=Z(()=>s()?o():l()),D=Z(c);function p(g){const S=a(D).get(g.id);return S||{x:g.x,y:g.y}}function v(g){const S=g.scale??lt,b=g.rotation===90,{textWidth:I,textHeight:M}=Nt(S,b),_=p(g),P=(_.x-a(x))*a(w),$=(_.y-a(E))*a(w);return{x:P,y:$,width:I*a(w),height:M*a(w)}}function f(g){return(g.texts.find(b=>b.language===a(C))||g.texts[0]||{text:""}).text||""}var u=$o();ze(u,21,()=>a(m),g=>g.id,(g,S)=>{const b=Z(()=>v(a(S))),I=Z(()=>f(a(S))),M=Z(()=>(a(S).textSize??cs)*a(w)),_=Z(()=>a(S).textColor??vn),P=Z(()=>a(S).textAlign??yn);var $=Me(),A=le($);{var Y=F=>{var X=ko();let q;var ee=k(X);z(()=>{q=Ee(X,1,"frame-text svelte-1vp2oo0",null,q,{"align-top":a(P)==="top","align-center":a(P)==="center","align-bottom":a(P)==="bottom"}),ce(X,`
          left: ${a(b).x??""}px;
          top: ${a(b).y??""}px;
          width: ${a(b).width??""}px;
          height: ${a(b).height??""}px;
          font-size: ${a(M)??""}px;
          color: ${a(_)??""};
        `),be(ee,a(I))}),y(F,X)};G(A,F=>{a(I)&&F(Y)})}y(g,$)}),y(i,u),_e(),h()}var Mo=R('<div class="temp-zone-button svelte-130i47e"><!></div>');function Ao(i,e){we(e,!0);const t=()=>L(js,"$builderCameraInfo",r),s=()=>L(Ze,"$builderEditMode",r),n=()=>L(gt,"$isDraggingInBuilder",r),[r,o]=Ae();let l=Q(null),c=null,d=null,h=Q(null);function m(p){c&&clearTimeout(c),O(l,p,!0),O(h,t()?.scrollX??null,!0),c=setTimeout(()=>{O(l,null),O(h,null)},2e3)}function x(){a(l)&&(Fe.emit($e.DIALOG_ZONE_CREATE_AT,{worldX:a(l).worldX}),O(l,null),O(h,null),c&&(clearTimeout(c),c=null))}function E(){O(l,null),O(h,null),c&&(clearTimeout(c),c=null)}ms(()=>{d=Fe.on($e.TEMP_ZONE_BUTTON_SHOW,m);const p=Fe.on($e.TEMP_ZONE_BUTTON_HIDE,E);return()=>{d?.unsubscribe(),p.unsubscribe()}}),Ln(()=>{c&&clearTimeout(c)}),Xe(()=>{s()!=="dialogs"&&(O(l,null),O(h,null))}),Xe(()=>{const p=t()?.scrollX;a(l)&&a(h)!==null&&p!==void 0&&Math.abs(p-a(h))>10&&(O(l,null),O(h,null),c&&(clearTimeout(c),c=null))});var w=Me(),C=le(w);{var D=p=>{var v=Mo(),f=k(v);ie(f,{variant:"cyan",width:"90px",onclick:x,children:(u,g)=>{var S=ne("+ ZONE");y(u,S)},$$slots:{default:!0}}),z(()=>ce(v,`left: ${a(l).screenX??""}px; top: ${a(l).screenY-50}px;${n()?" pointer-events: none;":""}`)),y(p,v)};G(C,p=>{a(l)&&s()==="dialogs"&&p(D)})}y(i,w),_e(),o()}var Lo=R('<div class="item-controls svelte-1is3rex"><div class="controls-row svelte-1is3rex"><!> <!> <!> <!></div></div>');function Oo(i,e){we(e,!0);const t=()=>L(Gs,"$selectedItem",h),s=()=>L(an,"$selectedItemScreenPosition",h),n=()=>L(Ss,"$selectedItemId",h),r=()=>L(tn,"$itemDepthLayer",h),o=()=>L(Da,"$selectedItemPhysicsEnabled",h),l=()=>L(Pa,"$selectedItemFlipX",h),c=()=>L(Ze,"$builderEditMode",h),d=()=>L(gt,"$isDraggingInBuilder",h),[h,m]=Ae();let x=Z(()=>t()?Na(t().assetKey):!1),E=Z(()=>{const g=s();if(!g)return null;const S=10,b=40,I=a(x)?380:290;let M=g.screenY-g.itemHeight/2-45;const _=S+b;M<_&&(M=g.screenY+g.itemHeight/2+10);const P=window.innerHeight-b-S;M>P&&(M=P);let $=g.screenX;const A=I/2,Y=A+S,F=window.innerWidth-A-S;return $<Y&&($=Y),$>F&&($=F),{x:$,y:M}});function w(){if(!n())return;const g=r()==="behind"?"front":"behind",S=Ys(g);Ma(),Aa(n(),S)}function C(){n()&&La(n(),!o())}function D(){n()&&Oa(n(),!l())}function p(){n()&&(cn(n()),Us())}var v=Me(),f=le(v);{var u=g=>{var S=Lo(),b=k(S),I=k(b);{let A=Z(()=>r()==="behind"?"blue":"orange"),Y=Z(()=>o()?"Solid items must be behind player":"Toggle item depth: behind or in front of player");ie(I,{get variant(){return a(A)},get title(){return a(Y)},onclick:w,get disabled(){return o()},children:(F,X)=>{var q=ne();z(()=>be(q,r()==="behind"?"Front":"Back")),y(F,q)},$$slots:{default:!0}})}var M=T(I,2);{let A=Z(()=>l()?"orange":"blue");ie(M,{get variant(){return a(A)},title:"Flip item horizontally",onclick:D,children:(Y,F)=>{var X=ne("Flip");y(Y,X)},$$slots:{default:!0}})}var _=T(M,2);{var P=A=>{{let Y=Z(()=>o()?"orange":"blue");ie(A,{get variant(){return a(Y)},title:"Toggle physics: item will block player movement",onclick:C,children:(F,X)=>{var q=ne();z(()=>be(q,o()?"Ghost":"Solid")),y(F,q)},$$slots:{default:!0}})}};G(_,A=>{a(x)&&A(P)})}var $=T(_,2);ie($,{variant:"red",title:"Delete selected item",onclick:p,children:(A,Y)=>{var F=ne("DEL");y(A,F)},$$slots:{default:!0}}),z(()=>ce(S,`left: ${a(E).x??""}px; top: ${a(E).y??""}px;${d()?" pointer-events: none;":""}`)),y(g,S)};G(f,g=>{c()!=="dialogs"&&n()&&a(E)&&g(u)})}y(i,v),_e(),m()}var Ho=R('<div class="frame-controls svelte-eqt3a9"><div class="controls-row svelte-eqt3a9"><!> <!></div></div>');function Ro(i,e){we(e,!0);const t=()=>L(rn,"$selectedFrameScreenPosition",o),s=()=>L(Jt,"$selectedFrameId",o),n=()=>L(Ze,"$builderEditMode",o),r=()=>L(gt,"$isDraggingInBuilder",o),[o,l]=Ae();let c=Z(()=>{const w=t();if(!w)return null;const C=10,D=40,p=190;let v=w.screenY-w.frameHeight/2-45;const f=C+D;v<f&&(v=w.screenY+w.frameHeight/2+10);const u=window.innerHeight-D-C;v>u&&(v=u);let g=w.screenX;const S=p/2,b=S+C,I=window.innerWidth-S-C;return g<b&&(g=b),g>I&&(g=I),{x:g,y:v}});function d(){Qi()}function h(){s()&&(qs(s()),Yt(null))}var m=Me(),x=le(m);{var E=w=>{var C=Ho(),D=k(C),p=k(D);ie(p,{variant:"purple",title:"Edit frame content (or double-click)",onclick:d,children:(f,u)=>{var g=ne("EDIT");y(f,g)},$$slots:{default:!0}});var v=T(p,2);ie(v,{variant:"red",title:"Delete selected frame",onclick:h,children:(f,u)=>{var g=ne("DEL");y(f,g)},$$slots:{default:!0}}),z(()=>ce(C,`left: ${a(c).x??""}px; top: ${a(c).y??""}px;${r()?" pointer-events: none;":""}`)),y(w,C)};G(x,w=>{n()!=="dialogs"&&s()&&a(c)&&w(E)})}y(i,m),_e(),l()}var Xo=R('<div class="zone-controls svelte-sm01rq"><div class="controls-row svelte-sm01rq"><!> <!> <!></div></div>');function Fo(i,e){we(e,!0);const t=()=>L(on,"$selectedDialogZoneScreenPosition",o),s=()=>L(bs,"$selectedDialogZoneId",o),n=()=>L(Ze,"$builderEditMode",o),r=()=>L(gt,"$isDraggingInBuilder",o),[o,l]=Ae();let c=Z(()=>{const C=t();if(!C)return null;const D=10,p=120,v=85;let f=C.screenY;const u=D+p/2,g=window.innerHeight-p/2-D;f<u&&(f=u),f>g&&(f=g);let S=C.screenX;const b=v/2,I=b+D,M=window.innerWidth-b-D;return S<I&&(S=I),S>M&&(S=M),{x:S,y:f}});function d(){ln()}function h(){s()&&(hn(s()),Zt(null))}function m(){Zt(null)}var x=Me(),E=le(x);{var w=C=>{var D=Xo(),p=k(D),v=k(p);ie(v,{variant:"cyan",title:"Edit zone content (or double-click)",onclick:d,children:(g,S)=>{var b=ne("EDIT");y(g,b)},$$slots:{default:!0}});var f=T(v,2);ie(f,{variant:"red",title:"Delete selected zone",onclick:h,children:(g,S)=>{var b=ne("DEL");y(g,b)},$$slots:{default:!0}});var u=T(f,2);ie(u,{variant:"default",title:"Deselect zone",onclick:m,children:(g,S)=>{var b=ne("DONE");y(g,b)},$$slots:{default:!0}}),z(()=>ce(D,`left: ${a(c).x??""}px; top: ${a(c).y??""}px;${r()?" pointer-events: none;":""}`)),y(C,D)};G(E,C=>{n()==="dialogs"&&s()&&a(c)&&C(w)})}y(i,x),_e(),l()}var Wo=R('<div class="social-controls svelte-1v4dckp"><div class="controls-row svelte-1v4dckp"><!> <!></div></div>');function Zo(i,e){we(e,!0);const t=()=>L(nn,"$selectedSocialScreenPosition",o),s=()=>L(Qt,"$selectedSocialId",o),n=()=>L(Ze,"$builderEditMode",o),r=()=>L(gt,"$isDraggingInBuilder",o),[o,l]=Ae();let c=Z(()=>{const w=t();if(!w)return null;const C=10,D=40,p=190;let v=w.screenY-w.socialHeight/2-45;const f=C+D;v<f&&(v=w.screenY+w.socialHeight/2+10);const u=window.innerHeight-D-C;v>u&&(v=u);let g=w.screenX;const S=p/2,b=S+C,I=window.innerWidth-S-C;return g<b&&(g=b),g>I&&(g=I),{x:g,y:v}});function d(){en()}function h(){s()&&(Js(s()),Bt(null))}var m=Me(),x=le(m);{var E=w=>{var C=Wo(),D=k(C),p=k(D);ie(p,{variant:"pink",title:"Edit social settings (or double-click)",onclick:d,children:(f,u)=>{var g=ne("EDIT");y(f,g)},$$slots:{default:!0}});var v=T(p,2);ie(v,{variant:"red",title:"Delete selected social",onclick:h,children:(f,u)=>{var g=ne("DEL");y(f,g)},$$slots:{default:!0}}),z(()=>ce(C,`left: ${a(c).x??""}px; top: ${a(c).y??""}px;${r()?" pointer-events: none;":""}`)),y(w,C)};G(x,w=>{n()!=="dialogs"&&s()&&a(c)&&w(E)})}y(i,m),_e(),l()}var Yo=R('<div class="hstack svelte-8vtf35"><!></div>');function Bo(i,e){let t=me(e,"gap",3,"10px"),s=me(e,"align",3,"center");var n=Yo(),r=k(n);Kt(r,()=>e.children??Je),z(()=>ce(n,`gap: ${t()??""}; align-items: ${(s()==="start"?"flex-start":s()==="end"?"flex-end":s())??""};`)),y(i,n)}var No=R('<div class="vstack svelte-1y4dqnf"><!></div>');function zo(i,e){let t=me(e,"gap",3,"10px"),s=me(e,"align",3,"stretch");var n=No(),r=k(n);Kt(r,()=>e.children??Je),z(()=>ce(n,`gap: ${t()??""}; align-items: ${(s()==="start"?"flex-start":s()==="end"?"flex-end":s())??""};`)),y(i,n)}var Ko=R("<div><!></div>");function Ti(i,e){const t=()=>L(gt,"$isDraggingInBuilder",s),[s,n]=Ae();let r=me(e,"padding",3,"10px");var o=Ko();let l;var c=k(o);Kt(c,()=>e.children??Je),z(()=>{l=Ee(o,1,`fixed fixed--${e.position??""}`,"svelte-vwlo0e",l,{"dragging-in-builder":t()}),ce(o,`--padding: ${r()??""};`)}),y(i,o),n()}var Go=R("<div><!> <!></div>"),Uo=R("<!> <!>",1),Vo=R("<!> <!> <!> <!>",1),jo=R("<div><!></div>"),qo=R("<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!>",1);function Jo(i,e){we(e,!0);const t=()=>L(Ss,"$selectedItemId",m),s=()=>L(Jt,"$selectedFrameId",m),n=()=>L(bs,"$selectedDialogZoneId",m),r=()=>L(Qt,"$selectedSocialId",m),o=()=>L(Ze,"$builderEditMode",m),l=()=>L(us,"$gridSnappingEnabled",m),c=()=>L(_t,"$isItemPaletteOpen",m),d=()=>L(St,"$isFramePaletteOpen",m),h=()=>L(bt,"$isSocialPaletteOpen",m),[m,x]=Ae(),E=600;let w=Q(nt(typeof window<"u"?window.innerWidth<E:!1)),C=Z(()=>a(w)&&(t()!==null||s()!==null||n()!==null||r()!==null));Xe(()=>{function ee(){O(w,window.innerWidth<E)}return window.addEventListener("resize",ee),()=>window.removeEventListener("resize",ee)});function D(){console.log("[BuilderUI] handleSave called, switching to game...");const ee=Rr();console.log("[BuilderUI] switchToGame result:",ee)}function p(){ma()}function v(){Fe.emit($e.DIALOG_ZONE_CREATE)}var f=qo(),u=le(f);Oo(u,{});var g=T(u,2);Ro(g,{});var S=T(g,2);Fo(S,{});var b=T(S,2);Zo(b,{});var I=T(b,2);{var M=ee=>{Vr(ee,{})},_=ee=>{var Ie=Me(),ve=le(Ie);{var Ce=W=>{po(W,{})},Te=W=>{var J=Me(),xe=le(J);{var ae=fe=>{Qr(fe,{})},De=fe=>{var re=Me(),de=le(re);{var te=he=>{io(he,{})};G(de,he=>{o()==="socials"&&he(te)},!0)}y(fe,re)};G(xe,fe=>{o()==="frames"?fe(ae):fe(De,!1)},!0)}y(W,J)};G(ve,W=>{o()==="dialogs"?W(Ce):W(Te,!1)},!0)}y(ee,Ie)};G(I,ee=>{o()==="items"?ee(M):ee(_,!1)})}var P=T(I,2);xo(P,{});var $=T(P,2);Po($,{});var A=T($,2);wn(A,{});var Y=T(A,2);Ao(Y,{});var F=T(Y,2),X=T(F,2);Ti(X,{position:"top-left",children:(ee,Ie)=>{var ve=Go();let Ce;var Te=k(ve);ie(Te,{variant:"green",width:"100px",onclick:D,children:(J,xe)=>{var ae=ne("SAVE");y(J,ae)},$$slots:{default:!0}});var W=T(Te,2);{let J=Z(()=>l()?"blue":"orange");ie(W,{get variant(){return a(J)},width:"80px",onclick:p,title:"Toggle grid snapping",children:(xe,ae)=>{var De=ne();z(()=>be(De,l()?"FREE":"SNAP")),y(xe,De)},$$slots:{default:!0}})}z(()=>Ce=Ee(ve,1,"left-buttons svelte-1vm8op7",null,Ce,{"hide-left":a(C)})),y(ee,ve)},$$slots:{default:!0}});var q=T(X,2);Ti(q,{position:"top-right",children:(ee,Ie)=>{var ve=jo();let Ce;var Te=k(ve);zo(Te,{align:"end",children:(W,J)=>{var xe=Vo(),ae=le(xe);{let de=Z(()=>o()==="items"&&c()?"orange":"blue");ie(ae,{get variant(){return a(de)},onclick:()=>{o()==="items"?va():(Xt("items"),_t.set(!0))},title:"Edit items",children:(te,he)=>{var ye=ne("ITEMS");y(te,ye)},$$slots:{default:!0}})}var De=T(ae,2);{let de=Z(()=>o()==="frames"&&d()?"orange":"purple");ie(De,{get variant(){return a(de)},onclick:()=>{o()==="frames"?ya():(Xt("frames"),St.set(!0))},title:"Edit text frames",children:(te,he)=>{var ye=ne("FRAMES");y(te,ye)},$$slots:{default:!0}})}var fe=T(De,2);{let de=Z(()=>o()==="socials"&&h()?"orange":"pink");ie(fe,{get variant(){return a(de)},onclick:()=>{o()==="socials"?ba():(Xt("socials"),bt.set(!0))},title:"Edit social icons",children:(te,he)=>{var ye=ne("SOCIALS");y(te,ye)},$$slots:{default:!0}})}var re=T(fe,2);Bo(re,{children:(de,te)=>{var he=Uo(),ye=le(he);{var Oe=Ke=>{ie(Ke,{variant:"cyan",width:"100px",onclick:v,title:"Create new dialog zone at center of view",children:(ft,Rt)=>{var ct=ne("+ ZONE");y(ft,ct)},$$slots:{default:!0}})};G(ye,Ke=>{o()==="dialogs"&&Ke(Oe)})}var Ue=T(ye,2);{let Ke=Z(()=>o()==="dialogs"?"orange":"cyan");ie(Ue,{get variant(){return a(Ke)},onclick:()=>{o()==="dialogs"?Xt("items"):Xt("dialogs")},title:"Edit dialog zones",children:(ft,Rt)=>{var ct=ne("DIALOGS");y(ft,ct)},$$slots:{default:!0}})}y(de,he)},$$slots:{default:!0}}),y(W,xe)},$$slots:{default:!0}}),z(()=>Ce=Ee(ve,1,"right-buttons svelte-1vm8op7",null,Ce,{"hide-right":a(C)})),y(ee,ve)},$$slots:{default:!0}}),y(i,f),_e(),x()}var Qo=R('<img class="skin-preview-img svelte-crre06"/>'),el=R('<canvas width="96" height="96" class="skin-preview svelte-crre06"></canvas>'),tl=R('<button type="button"><div class="skin-preview-container svelte-crre06"><!></div> <span class="skin-name svelte-crre06"> </span></button>'),sl=R('<button class="background-card svelte-crre06" type="button"><div class="preview-container svelte-crre06"><img class="preview-image svelte-crre06"/></div> <span class="background-name svelte-crre06"> </span></button>'),il=R('<div class="background-select-screen svelte-crre06"><div class="content svelte-crre06"><h1 class="title svelte-crre06">SELECT CHARACTER</h1> <div class="skins-grid svelte-crre06"></div> <div class="builder-link svelte-crre06"><!></div> <h1 class="title svelte-crre06">SELECT BACKGROUND</h1> <div class="backgrounds-grid svelte-crre06"></div></div></div>');function nl(i,e){we(e,!0);function t(){window.location.href="./builder.html"}const s=st,n=Ne;let r=Q(nt(Ut.getSkinId())),o=nt({}),l=nt({});Xe(()=>{n.forEach(f=>{const u=os(f),g=new Image;g.onload=()=>{l[f.id]=!0},g.onerror=()=>{l[f.id]=!1,d(f)},g.src=`./${u}/preview.png`})});function c(f){return`./${os(f)}/preview.png`}function d(f){const u=o[f.id];if(!u)return;const g=u.getContext("2d");if(!g)return;const S=f.frameWidth??48,b=f.frameHeight??48,I=os(f),M=new Image;M.src=`./${I}/idle.png`,M.onload=()=>{g.clearRect(0,0,u.width,u.height),g.imageSmoothingEnabled=!1;const _=u.width/S,P=u.height/b,$=Math.min(_,P),A=S*$,Y=b*$,F=(u.width-A)/2,X=(u.height-Y)/2;g.drawImage(M,0,0,S,b,F,X,A,Y)}}function h(f){return`./assets/backgrounds/${f}/preview.png`}function m(f){O(r,f,!0),Ut.setSkin(f),Li.set(f)}function x(f){qt.setBackgroundByIndex(f),Oi.set(s[f].name),Hi.set(!0),Xr()}var E=il(),w=k(E),C=T(k(w),2);ze(C,21,()=>n,Ge,(f,u)=>{var g=tl();let S;g.__click=()=>m(a(u).id);var b=k(g),I=k(b);{var M=A=>{var Y=Qo();z(F=>{U(Y,"src",F),U(Y,"alt",a(u).name)},[()=>c(a(u))]),y(A,Y)},_=A=>{var Y=el();ut(Y,(F,X)=>o[X.id]=F,F=>o?.[F.id],()=>[a(u)]),y(A,Y)};G(I,A=>{l[a(u).id]?A(M):A(_,!1)})}var P=T(b,2),$=k(P);z(()=>{S=Ee(g,1,"skin-card svelte-crre06",null,S,{selected:a(r)===a(u).id}),be($,a(u).name)}),y(f,g)});var D=T(C,2),p=k(D);ie(p,{variant:"purple",onclick:t,children:(f,u)=>{var g=ne("✨ CHARACTER BUILDER");y(f,g)},$$slots:{default:!0}});var v=T(D,4);ze(v,21,()=>s,Ge,(f,u,g)=>{var S=sl();S.__click=()=>x(g);var b=k(S),I=k(b),M=T(b,2),_=k(M);z(P=>{U(I,"src",P),U(I,"alt",a(u).name),be(_,a(u).name)},[()=>h(a(u).folder)]),y(f,S)}),y(i,E),_e()}at(["click"]);var al=R("<div> </div>"),rl=R('<div class="dialog-content svelte-1jd14ss"> </div>'),ol=R("<div><!> <!></div>");function ll(i,e){we(e,!0);const t=()=>L(Un,"$activeDialogText",n),s=()=>L(Wi,"$playerScreenPosition",n),[n,r]=Ae();let o=Z(()=>t()?.title&&t()?.content),l=Z(()=>Math.max(10,window.innerHeight-s().y+ho)),c=Z(()=>window.innerWidth<=co),d=Z(()=>a(c)?50:s().x),h=Z(()=>a(c)?"percent":"px");var m=Me(),x=le(m);{var E=w=>{var C=ol();let D;var p=k(C);{var v=g=>{var S=al();let b;var I=k(S);z(()=>{b=Ee(S,1,"dialog-title svelte-1jd14ss",null,b,{"has-divider":a(o)}),be(I,t().title)}),y(g,S)};G(p,g=>{t().title&&g(v)})}var f=T(p,2);{var u=g=>{var S=rl(),b=k(S);z(()=>be(b,t().content)),y(g,S)};G(f,g=>{t().content&&g(u)})}z(()=>{D=Ee(C,1,"dialog-bubble svelte-1jd14ss",null,D,{narrow:a(c)}),ce(C,`bottom: ${a(l)??""}px; left: ${a(d)??""}${a(h)??""};`)}),y(w,C)};G(x,w=>{t()&&w(E)})}y(i,m),_e(),r()}var cl=R('<div class="game-mask mask-top svelte-ptsgmd"></div> <div class="game-mask mask-bottom svelte-ptsgmd"></div> <div class="game-mask mask-left svelte-ptsgmd"></div> <div class="game-mask mask-right svelte-ptsgmd"></div> <div class="game-frame svelte-ptsgmd"><div class="frame-border frame-top svelte-ptsgmd"></div> <div class="frame-border frame-bottom svelte-ptsgmd"></div> <div class="frame-border frame-left svelte-ptsgmd"></div> <div class="frame-border frame-right svelte-ptsgmd"></div> <div class="frame-corner corner-top-left svelte-ptsgmd"></div> <div class="frame-corner corner-top-right svelte-ptsgmd"></div> <div class="frame-corner corner-bottom-left svelte-ptsgmd"></div> <div class="frame-corner corner-bottom-right svelte-ptsgmd"></div></div>',1);function dl(i,e){we(e,!1);const t=()=>L(Kn,"$gameFrameColor",n),s=()=>L(Yi,"$gameWorldDimensions",n),[n,r]=Ae(),o=rt(),l=rt(),c=rt(),d=rt(),h=rt(),m=rt(),x=rt();ot(()=>t(),()=>{O(o,t())}),ot(()=>s(),()=>{O(l,s())}),ot(()=>a(l),()=>{O(c,`
    top: ${a(l).offsetY}px;
    left: ${a(l).offsetX}px;
    width: ${a(l).worldWidth}px;
    height: ${a(l).worldHeight}px;
  `)}),ot(()=>a(l),()=>{O(d,a(l).offsetY)}),ot(()=>a(l),()=>{O(h,a(l).offsetX)}),ot(()=>a(l),()=>{O(m,a(l).offsetX+a(l).worldWidth)}),ot(()=>a(l),()=>{O(x,a(l).offsetY+a(l).worldHeight)}),ki();var E=cl(),w=le(E),C=T(w,2),D=T(C,2),p=T(D,2),v=T(p,2);z(()=>{ce(w,`height: ${a(d)??""}px; background: ${a(o)??""};`),ce(C,`top: ${a(x)??""}px; background: ${a(o)??""};`),ce(D,`top: ${a(d)??""}px; height: ${a(l),zt(()=>a(l).worldHeight)??""}px; width: ${a(h)??""}px; background: ${a(o)??""};`),ce(p,`top: ${a(d)??""}px; height: ${a(l),zt(()=>a(l).worldHeight)??""}px; left: ${a(m)??""}px; background: ${a(o)??""};`),ce(v,`--frame-thickness: 16px; --frame-color: ${a(o)??""}; ${a(c)??""}`)}),y(i,E),_e(),r()}var hl=R("<!> <!>",1),ul=R('<div class="touch-controls"><p class="touch-text">Tap and hold<br/>where you want<br/>to move</p></div>'),gl=R('<div class="desktop-controls"><div class="key-row"><div class="pixel-key">A</div> <div class="pixel-key">W</div> <div class="pixel-key">D</div></div> <p class="or-text">or</p> <div class="key-row"><div class="pixel-key">←</div> <div class="pixel-key">↑</div> <div class="pixel-key">→</div></div></div>'),fl=R('<div class="loader-overlay"><div class="pixel-loader"></div></div>'),pl=R('<!> <div class="game-ui-wrapper svelte-13dvmla"><!> <!> <!> <dialog class="pixel-dialog"><h1>CONTROLS</h1> <div class="controls-content"><!></div></dialog> <!></div>',1);function ml(i,e){we(e,!1);const t=()=>L(Ft,"$showControlsDialog",h),s=()=>L(Xi,"$hasPlayerMoved",h),n=()=>L(Hi,"$hasSelectedBackground",h),r=()=>L(Gn,"$gameFrameVisible",h),o=()=>L(Ji,"$isBuilderMode",h),l=()=>L(Vt,"$currentLanguage",h),c=()=>L(Ri,"$isTouchDevice",h),d=()=>L(Rs,"$isLoading",h),[h,m]=Ae();let x=rt();function E(){const u=Sn.toggleLanguage();Vt.set(u)}function w(u){!a(x)?.open||u.target.closest(".pixel-button")||Ft.set(!1)}function C(){const u=Or();if(!u){console.error("Cannot enter builder mode: map config not found");return}Hr(u)}ot(()=>(a(x),t()),()=>{a(x)&&(t()?a(x).showModal():a(x).close())}),ot(()=>(s(),a(x),Ft),()=>{s()&&a(x)?.open&&Ft.set(!1)}),ki(),Wn();var D=Me();Ve("pointerdown",On,w);var p=le(D);{var v=u=>{nl(u,{})},f=u=>{var g=pl(),S=le(g);{var b=W=>{dl(W,{})};G(S,W=>{r()&&!o()&&W(b)})}var I=T(S,2),M=k(I);{var _=W=>{Jo(W,{})},P=W=>{var J=hl(),xe=le(J);ll(xe,{});var ae=T(xe,2);wn(ae,{}),y(W,J)};G(M,W=>{o()?W(_):W(P,!1)})}var $=T(M,2);{var A=W=>{ie(W,{position:"top-left",variant:"green",width:"120px",onclick:C,title:"Toggle Builder Mode",children:(J,xe)=>{var ae=ne("BUILD");y(J,ae)},$$slots:{default:!0}})};G($,W=>{o()||W(A)})}var Y=T($,2);{var F=W=>{ie(W,{position:"top-right",variant:"default",width:"100px",onclick:E,title:"Toggle Language (L)",children:(J,xe)=>{var ae=ne();z(De=>be(ae,De),[()=>(l(),zt(()=>l().toUpperCase()))]),y(J,ae)},$$slots:{default:!0}})};G(Y,W=>{o()||W(F)})}var X=T(Y,2),q=T(k(X),2),ee=k(q);{var Ie=W=>{var J=ul();y(W,J)},ve=W=>{var J=gl();y(W,J)};G(ee,W=>{c()?W(Ie):W(ve,!1)})}ut(X,W=>O(x,W),()=>a(x));var Ce=T(X,2);{var Te=W=>{var J=fl();y(W,J)};G(Ce,W=>{d()&&W(Te)})}y(u,g)};G(p,u=>{n()?u(f,!1):u(v)})}y(i,D),_e(),m()}ia();const _n=document.getElementById("game-ui");if(!_n)throw new Error("game-ui element not found!");Hn(ml,{target:_n});Vt.set(Sn.getLanguage());Li.set(Ut.getSkinId());Oi.set(qt.getCurrentConfig().name);const vl={type:N.AUTO,width:800,height:600,parent:"game-container",backgroundColor:"#000000",pixelArt:!0,roundPixels:!0,scale:{mode:N.Scale.RESIZE,autoCenter:N.Scale.CENTER_BOTH},input:{activePointers:3},physics:{default:"arcade",arcade:{gravity:{y:1e3,x:0},debug:!1}},audio:{noAudio:!0},scene:[]},_s=new N.Game(vl);_s.scene.add(Qe.GAME,wr);_s.scene.add(Qe.BUILDER,Mr);Lr(_s);const yl=_s.device.input.touch;Ri.set(yl);const Sl=performance.getEntriesByType("navigation")[0]&&performance.getEntriesByType("navigation")[0].type==="reload",bl=sessionStorage.getItem("hasSeenControlsHint");(!bl||Sl)&&(sessionStorage.setItem("hasSeenControlsHint","true"),Ft.set(!0));
//# sourceMappingURL=main-BIbGAjh9.js.map
